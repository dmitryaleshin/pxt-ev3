var pxt;!function(s){{var e=s.runner||(s.runner={});e.startDebuggerAsync=function(e){new t(e).start()};class t{constructor(e){this.container=e,this.pkgLoaded=!1,this.intervalRunning=!1}start(){this.initializeWebsocket(),this.intervalRunning||(this.intervalRunning=!0,this.intervalId=setInterval(()=>{if(!this.ws)try{this.initializeWebsocket()}catch(e){console.warn(`Connection to server failed, retrying in ${t.RETRY_MS} ms`)}},t.RETRY_MS)),this.session=new pxsim.SimDebugSession(this.container),this.session.start(this)}initializeWebsocket(){s.BrowserUtils.isLocalHost()&&s.Cloud.localToken&&(s.debug("initializing debug pipe"),this.ws=new WebSocket("ws://localhost:3234/"+s.Cloud.localToken+"/simdebug"),this.ws.onopen=e=>{s.debug("debug: socket opened")},this.ws.onclose=e=>{s.debug("debug: socket closed"),this.closeListener&&this.closeListener(),this.session.stopSimulator(),this.ws=void 0},this.ws.onerror=e=>{s.debug("debug: socket closed due to error"),this.errorListener&&this.errorListener(e.type),this.session.stopSimulator(),this.ws=void 0},this.ws.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch(e){s.debug("debug: could not parse message")}t&&("runner"===t.type?this.handleRunnerMessage(t):("request"===t.type&&"launch"===t.command&&this.sendRunnerMessage("configure",{projectDir:t.arguments.projectDir}),this.dataListener(t)))})}send(e){this.ws.send(e)}onData(e){this.dataListener=e}onError(e){this.errorListener=e}onClose(e){this.closeListener=e}close(){this.session&&this.session.stopSimulator(!0),this.intervalRunning&&(clearInterval(this.intervalId),this.intervalId=void 0),this.ws&&this.ws.close()}handleRunnerMessage(e){switch(e.subtype){case"ready":this.sendRunnerMessage("ready");break;case"runcode":this.runCode(e)}}runCode(e){const t=[];e.breakpoints.forEach(e=>{t.push([e.id,{verified:!0,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn,source:{path:e.fileName}}])}),this.session.runCode(e.code,e.usedParts,e.usedArguments,new pxsim.BreakpointMap(t),s.appTarget.simulator.boardDefinition)}sendRunnerMessage(e,t={}){t.subtype=e,t.type="runner",this.send(JSON.stringify(t))}}t.RETRY_MS=2500,e.DebugRunner=t}}(pxt=pxt||{}),function(f){{var e=f.runner||(f.runner={});function l(){return{blocksAspectRatio:window.innerHeight<window.innerWidth?1.62:1/1.62,snippetClass:"lang-blocks",signatureClass:"lang-sig",blocksClass:"lang-block",blocksXmlClass:"lang-blocksxml",diffBlocksXmlClass:"lang-diffblocksxml",diffClass:"lang-diff",diffStaticPythonClass:"lang-diffspy",diffBlocksClass:"lang-diffblocks",staticPythonClass:"lang-spy",simulatorClass:"lang-sim",linksClass:"lang-cards",namespacesClass:"lang-namespaces",apisClass:"lang-apis",codeCardClass:"lang-codecard",packageClass:"lang-package",jresClass:"lang-jres",assetJSONClass:"lang-assetsjson",projectClass:"lang-project",snippetReplaceParent:!0,simulator:!0,showEdit:!0,hex:!0,tutorial:!1,showJavaScript:!1,hexName:f.appTarget.id}}function c(e){"undefined"!=typeof hljs&&(e.hasClass("highlight")?hljs.highlightBlock(e[0]):e.find("code.highlight").each(function(e,t){hljs.highlightBlock(t)}),p(e))}function p(e){e.find("span.hljs-comment:contains(@highlight)").each((e,t)=>{try{{var n=t;const a=$(n),o=document.createElement("span");o.className="highlight-line";let s=n.nextSibling;if(s&&s.nodeType==Node.TEXT_NODE){let e=s.textContent,t=e.indexOf("\n");if(!(t<0)){for(s.textContent=e.substring(0,t+1),$(document.createTextNode(e.substring(t+1).replace(/^\s+/,""))).insertAfter($(s)),s=s.nextSibling;s;){var i=s.nextSibling;if(s.nodeType==Node.TEXT_NODE){const a=(e=s.textContent).indexOf("\n");if(!(a<0)){o.appendChild(document.createTextNode(e.substring(0,a))),s.textContent=e.substring(a+1);break}}o.appendChild(s),s=i}$(o).insertAfter(a),a.remove()}}return}}catch(e){f.reportException(e)}})}function v(e,t){e.append($('<div class="ui content js"><div class="subheading"><i class="ui icon xicon js"></i>JavaScript</div></div>').append(t)),c(t)}function k(e,t){e.append($('<div class="ui content py"><div class="subheading"><i class="ui icon xicon python"></i>Python</div></div>').append(t)),c(t)}function b(e,t){var s=$('<a class="item" role="button" tabindex="0"><i role="presentation" aria-hidden="true"></i><span class="ui desktop only"></span></a>');return s.attr("aria-label",e),s.attr("title",e),s.find("i").attr("class",t),s.find("span").text(e),s.keypress(e=>{var t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}),s}function u(i,e,a,t,s,n,o={}){let r=$('<div class="ui bottom attached tabular icon small compact menu hideprint"> <div class="right icon menu"></div></div>'),l=$('<div class="ui top attached segment codewidget"></div>'),c=r.find(".right.menu");var d=f.appTarget.appTheme||{};if(o.showEdit&&!d.hideDocsEdit&&n){const e=b(lf("Edit"),"edit icon"),{package:a,compileBlocks:h,compilePython:v}=n,k=a.host();if(s&&h?(a.setPreferredEditor(f.BLOCKS_PROJECT_NAME),k.writeFile(a,f.MAIN_BLOCKS,h.outfiles[f.MAIN_BLOCKS])):t&&v?(a.setPreferredEditor(f.PYTHON_PROJECT_NAME),k.writeFile(a,f.MAIN_PY,h.outfiles[f.MAIN_PY])):a.setPreferredEditor(f.JAVASCRIPT_PROJECT_NAME),i.assetJSON)for(const f of Object.keys(i.assetJSON))a.config.files.indexOf(f)<0&&a.config.files.push(f),k.writeFile(a,f,i.assetJSON[f]);const o=a.compressToFileAsync();e.click(()=>{f.tickEvent("docs.btn",{button:"edit"}),o.then(e=>{window.open((i.pxtUrl||f.appTarget.appTheme.homeUrl||"").replace(/\/$/,"")+"/#project:"+ts.pxtc.encodeBase64(f.Util.uint8ArrayToString(e)),"pxt")})}),c.append(e)}i.showJavaScript||!s&&!t?(l.append(a),p(),m()):s?(l.append(s),u(),m()):t&&(l.append(t),p(),u()),o.run&&!d.hideDocsSimulator&&(n=b(lf("Run"),"play icon").click(()=>{if(f.tickEvent("docs.btn",{button:"sim"}),l.find(".sim")[0])l.find(".sim").remove(),g(l);else{let e="81.97%";f.appTarget.simulator&&(e=100/f.appTarget.simulator.aspectRatio+"%");var t=i.package?"&deps="+encodeURIComponent(i.package):"",t=x(i)+"#nofooter=1"+t,s=i.assetJSON?`data-assets="${encodeURIComponent(JSON.stringify(i.assetJSON))}"`:"",n=encodeURIComponent(a.text()),t=$(`<div class="ui card sim"><div class="ui content"><div style="position:relative;height:0;padding-bottom:${e};overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${t}" data-code="${n}" ${s} allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div></div></div>`);l.append(t),g(t)}}),c.append(n)),o.hexname&&o.hex&&(d=b(lf("Download"),"download icon").click(()=>{f.tickEvent("docs.btn",{button:"hex"}),f.BrowserUtils.browserDownloadBinText(o.hex,o.hexname,{contentType:f.appTarget.compile.hexMimeType})}),c.append(d));n=$("<div class=codesnippet></div>");function p(){var e;s&&(e=b(lf("Blocks"),"icon xicon blocks").click(()=>{var e,t;f.tickEvent("docs.btn",{button:"blocks"}),l.find(".blocks")[0]?(l.find(".blocks").remove(),g(l)):(e=a?a.parent():l,t=s,e.append($('<div class="ui content blocks"/>').append(t)),g(s))}),c.append(e))}function u(){var e;a&&(o.showJs?v(l,a):(e=b("JavaScript","icon xicon js").click(()=>{f.tickEvent("docs.btn",{button:"js"}),l.find(".js")[0]?(l.find(".js").remove(),g(l)):(v(s?s.parent():l,a),g(a))}),c.append(e)))}function m(){var e;t&&(o.showPy?k(l,t):(e=b("Python","icon xicon python").click(()=>{f.tickEvent("docs.btn",{button:"py"}),l.find(".py")[0]?(l.find(".py").remove(),g(l)):(k(s?s.parent():l,t),g(t))}),c.append(e)))}function g(e){null!=(e=e[0])&&e.scrollIntoView({behavior:"smooth",block:"center"})}c.children().length&&n.append(r),n.append(l),e.replaceWith(n)}e.defaultClientRenderOptions=l;let t,o=[];function m(e,t,s){var n;return e&&(n=$("."+e).first())[0]?(s.emPixels||(s.emPixels=18),s.layout||(s.layout=f.blocks.BlockLayout.Align),s.splitSvg=!0,o.push({el:n,source:n.text(),options:s,render:t}),n.addClass("lang-shadow"),n.removeClass(e),m(e,t,s)):Promise.resolve()}function g(e){return e&&e.kind==ts.SyntaxKind.ExpressionStatement&&e.expression&&e.expression.kind==ts.SyntaxKind.CallExpression?(e=e.expression,pxtc.pxtInfo(e).callInfo):null}function h(e){return t=t||f.runner.decompileSnippetAsync("",e)}function r(e,t){var s,n,i;t&&(s=/^\/(v\d+)/.exec(t.url),n=/^\/(v\d+)/.exec(window.location.pathname),i=/#doc/i.test(window.location.href),t.url&&!s&&n&&!i&&(t.url=`/${n[1]}/`+t.url),e.append(f.docs.codeCard.render(t,{hideHeader:!0,shortName:!0})))}function y(e,t,s){var n=t.attributes,i=!n.blockHidden&&Blockly.Blocks[n.blockId];if(null!=i&&i.codeCard){const t=f.U.clone(i.codeCard);s&&(t.style=s),r(e,t)}else r(e,{name:t.qName,description:n.jsDoc,url:n.help||void 0,style:s})}function w(e,t,a,o){return m(t,(e,n)=>{var t=n.compileProgram;if(t){const s=t.getSourceFile(f.MAIN_TS).statements.slice(0),i=$("<div />").addClass("ui cards");i.attr("role","listbox"),s.forEach(s=>{const e=s.kind,t=g(s);if(t&&n.apiInfo&&n.apiInfo.byQName[t.qName]){const f=n.apiInfo.byQName[t.qName],s=f.attributes,e=Blockly.Blocks[s.blockId];if(o){const o=f,t=n.compileBlocks.blocksInfo.apis.byQName[o.namespace];r(i,{name:t.attributes.blockNamespace||t.name,url:t.attributes.help||"reference/"+(t.attributes.blockNamespace||t.name).toLowerCase(),description:t.attributes.jsDoc,blocksXml:e&&e.codeCard?e.codeCard.blocksXml:s.blockId?`<xml xmlns="http://www.w3.org/1999/xhtml"><block type="${s.blockId}"></block></xml>`:void 0})}else y(i,f)}else switch(e){case ts.SyntaxKind.ExpressionStatement:{const n=s;switch(n.expression.kind){case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:r(i,{name:"Boolean",url:"blocks/logic/boolean",description:lf("True or false values"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="logic_boolean"><field name="BOOL">TRUE</field></block></xml>'});break;default:f.debug("card expr kind: "+n.expression.kind)}break}case ts.SyntaxKind.IfStatement:r(i,{name:o?"Logic":"if",url:"blocks/logic"+(o?"":"/if"),description:o?lf("Logic operators and constants"):lf("Conditional statement"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_if"></block></xml>'});break;case ts.SyntaxKind.WhileStatement:r(i,{name:o?"Loops":"while",url:"blocks/loops"+(o?"":"/while"),description:o?lf("Loops and repetition"):lf("Repeat code while a condition is true."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="device_while"></block></xml>'});break;case ts.SyntaxKind.ForOfStatement:r(i,{name:o?"Loops":"for of",url:"blocks/loops"+(o?"":"/for-of"),description:o?lf("Loops and repetition"):lf("Repeat code for each item in a list."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_for_of"></block></xml>'});break;case ts.SyntaxKind.BreakStatement:r(i,{name:o?"Loops":"break",url:"blocks/loops"+(o?"":"/break"),description:o?lf("Loops and repetition"):lf("Break out of the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="break_keyword"></block></xml>'});break;case ts.SyntaxKind.ContinueStatement:r(i,{name:o?"Loops":"continue",url:"blocks/loops"+(o?"":"/continue"),description:o?lf("Loops and repetition"):lf("Skip iteration and continue the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="continue_keyboard"></block></xml>'});break;case ts.SyntaxKind.ForStatement:{let e=s,t=!0;3==e.condition.getChildCount()&&(t=!("0"==e.condition.getChildAt(0).getText()||e.condition.getChildAt(1).kind==ts.SyntaxKind.LessThanToken)),r(i,t?{name:o?"Loops":"for",url:"blocks/loops"+(o?"":"/for"),description:o?lf("Loops and repetition"):lf("Repeat code for a given number of times using an index."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_simple_for"></block></xml>'}:{name:o?"Loops":"repeat",url:"blocks/loops"+(o?"":"/repeat"),description:o?lf("Loops and repetition"):lf("Repeat code for a given number of times."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_repeat_ext"></block></xml>'});break}case ts.SyntaxKind.VariableStatement:r(i,{name:o?"Variables":"variable declaration",url:"blocks/variables"+(o?"":"/assign"),description:o?lf("Variables"):lf("Assign a value to a named variable."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="variables_set"></block></xml>'});break;default:f.debug("card kind: "+e)}}),(e=a?e.parent():e).replaceWith(i)}},{package:e.package,aspectRatio:e.blocksAspectRatio,assets:e.assetJSON})}function x(e){return e.pxtUrl?e.pxtUrl+"/--run":f.webConfig&&f.webConfig.runUrl?f.webConfig.runUrl:"/--run"}function C(i){const a={showEdit:!!i.showEdit,run:!!i.simulator};$("code.lang-python").each((e,t)=>{var s,n;s=t,"undefined"!=typeof hljs&&($(s).text($(s).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(s),p($(s))),n=f.U.clone(a),u(i,$(s).parent(),$(s),void 0,void 0,void 0,n),$(t).removeClass("lang-python")})}e.renderAsync=function(d){f.analytics.enable(),(d=d||l()).pxtUrl&&(d.pxtUrl=d.pxtUrl.replace(/\/$/,"")),d.showEdit&&(d.showEdit=!f.BrowserUtils.isIFrame()),(i=d).packageClass&&($("."+i.packageClass).each((e,t)=>{let s=$(t),n=s.text().split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).join(",");i.package=i.package?i.package+","+n:n,(s=i.snippetReplaceParent?s.parent():s).remove()}),$(".lang-config").each((e,t)=>{let s=$(t);(s=i.snippetReplaceParent?s.parent():s).remove()}));{var t=d;let n,i;t.jresClass&&$("."+t.jresClass).each((e,t)=>{var s=$(t);i=s.text(),t.parentElement.remove()}),t.assetJSONClass&&$("."+t.assetJSONClass).each((e,t)=>{var s=$(t);n=s.text(),t.parentElement.remove()}),t.assetJSON=function(e,t){if(e||t){var s=f.tutorial.parseAssetJson(e)||{};if(t){const e=JSON.parse(t);s[f.TILEMAP_JRES]=JSON.stringify(e),s[f.TILEMAP_CODE]=f.emitTilemapsFromJRes(e)}return s}}(n,i)}o=[];{t=d;let e=$("code.lang-ghost");(e=t.snippetReplaceParent?e.parent():e).remove()}(r=d).simulatorClass&&$("."+r.simulatorClass).each((e,t)=>{let s=$(t),n="81.97%";f.appTarget.simulator&&(n=100/f.appTarget.simulator.aspectRatio+"%");var t=$(`<div class="ui card"><div class="ui content">
                    <div style="position:relative;height:0;padding-bottom:${n};overflow:hidden;">
                    <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe>
                    </div>
                    </div></div>`),i=r.package?"&deps="+encodeURIComponent(r.package):"",i=x(r)+"#nofooter=1"+i,a=encodeURIComponent(s.text().trim()),o=t.find("iframe");o.attr("src",i),o.attr("data-code",a),r.assetJSON&&o.attr("data-assets",JSON.stringify(r.assetJSON)),(s=r.snippetReplaceParent?s.parent():s).replaceWith(t)});{var n=d;const a={showEdit:!!n.showEdit,run:!!n.simulator};function s(e,t){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),p($(e)));var s=f.U.clone(a);t&&(s.run=!1,s.showEdit=!1),u(n,$(e).parent(),$(e),void 0,void 0,void 0,s)}$("code.lang-typescript").each((e,t)=>{s(t,!1),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-ignore").each((e,t)=>{$(t).removeClass("lang-typescript-ignore"),$(t).addClass("lang-typescript"),s(t,!0),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-invalid").each((e,t)=>{$(t).removeClass("lang-typescript-invalid"),$(t).addClass("lang-typescript"),s(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("invalid"),$(t).parent("div").prepend($("<i>",{class:"icon ban"})),$(t).addClass("invalid")}),$("code.lang-typescript-valid").each((e,t)=>{$(t).removeClass("lang-typescript-valid"),$(t).addClass("lang-typescript"),s(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("valid"),$(t).parent("div").prepend($("<i>",{class:"icon check"})),$(t).addClass("valid")})}return C(d),Promise.resolve().then(()=>function e(t,s){if(!t)return Promise.resolve();let n=$("."+t).first();if(!n[0])return Promise.resolve();n.removeClass(t);var i=f.gallery.parseCodeCardsHtml(n[0]);return i||n.append($("<div/>").addClass("ui segment warning").text("invalid codecard format")),function(e,t,o){if(t&&0!=t.length)if(0==t.length){var s=f.docs.codeCard.render(t[0],o);e.replaceWith(s)}else{let a=document.createElement("div");a.className="ui cards",a.setAttribute("role","listbox"),t.forEach(t=>{const s=/^\/(v\d+)/.exec(t.url),e=/^\/(v\d+)/.exec(window.location.pathname),n=/#doc/i.test(window.location.href),i=(t.url&&!s&&e&&!n&&(t.url="/"+e[1]+t.url),f.docs.codeCard.render(t,o));if(a.appendChild(i),"package"==t.cardType){const s=f.github.parseRepoId((t.url||"").replace(/^\/pkg\//,""));s&&f.packagesConfigAsync().then(e=>{switch(f.github.repoStatus(s,e)){case f.github.GitRepoStatus.Banned:i.remove();break;case f.github.GitRepoStatus.Approved:t.imageUrl=f.github.mkRepoIconUrl(s),a.insertBefore(f.docs.codeCard.render(t,o),i),i.remove()}}).catch(e=>{f.reportException(e),f.debug("failed to load repo "+t.url)})}}),e.replaceWith(a)}return Promise.resolve()}(n=s.snippetReplaceParent?n.parent():n,i,{hideHeader:!0}).then(()=>f.U.delay(1,e(t,s)))}(d.codeCardClass,d)).then(()=>{return e=d,"core"==f.appTarget.id?Promise.resolve():h(e).then(e=>{let s={};const n=e.compileBlocks.blocksInfo;n.blocks.forEach(e=>{var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];if(!s[t]){const e=n.apis.byQName[t];e&&e.attributes.color&&(s[t]=e.attributes.color)}});let i="";return Object.keys(s).forEach(e=>{var t=s[e]||"#dddddd";i+=`
                        span.docs.${e.toLowerCase()} {
                            background-color: ${t} !important;
                            border-color: ${f.toolbox.fadeColor(t,.1,!1)} !important;
                        }
                    `}),i}).then(s=>(Object.keys(f.toolbox.blockColors).forEach(e=>{var t=f.toolbox.getNamespaceColor(e);s+=`
                        span.docs.${e.toLowerCase()} {
                            background-color: ${t} !important;
                            border-color: ${f.toolbox.fadeColor(t,.1,!1)} !important;
                        }
                    `}),s)).then(e=>{var t=document.createElement("style");t.id="namespaceColors",t.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t.appendChild(document.createTextNode(e))});var e}).then(()=>{{var o=d;(o=f.Util.clone(o)).emPixels=18,o.snippetMode=!0;const r=$(":not(pre) > code");let a=0;return function e(){if(a>=r.length)return Promise.resolve();const n=$(r[a++]),t=n.text(),s=/^(\|+)([^\|]+)\|+$/.exec(t);if(s){const o=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(s[2]),r=o[2]?o[2].trim().toLowerCase():"",a=1==s[1].length?"docs inlinebutton "+r:"docs inlineblock "+r,t=o[3].trim();return n.replaceWith($(`<span class="${a}"/>`).text(f.U.rlf(t))),e()}var i=/^\[(.+)\]$/.exec(t);return i?(i=i[1],f.runner.decompileSnippetAsync(i,o).then(t=>{if(t.blocksSvg){let e=$('<span class="block"/>').append(t.blocksSvg);var s=g(t.compileProgram.getSourceFile(f.MAIN_TS).statements[0]);if(s&&t.apiInfo){const f=t.apiInfo.byQName[s.qName];f&&f.attributes.help&&(e=$('<a class="ui link"/>').attr("href","/reference/"+f.attributes.help).append(e))}n.replaceWith(e)}return f.U.delay(1,e())})):e()}()}}).then(()=>w(d,d.linksClass,d.snippetReplaceParent,!1)).then(()=>w(d,d.namespacesClass,d.snippetReplaceParent,!0)).then(()=>{{var e=d,r=d.snippetReplaceParent,t=e.apisClass;if(!t)return Promise.resolve();const s=$("."+t);return s.length?h(e).then(e=>{const t=e.compileBlocks.blocksInfo,o=f.Util.values(t.apis.byQName).filter(e=>!(e.attributes.hidden||e.attributes.deprecated||e.attributes.blockAliasFor||!e.attributes.jsDoc||!e.attributes.block||/^__/.test(e.name)));s.each((e,t)=>{let s=$(t);const n=f.Util.toDictionary(s.text().split("\n"),e=>e),i=o.filter(e=>!!n[e.attributes.blockNamespace||e.namespace]);if(i.length){i.sort((e,t)=>{var s=!e.attributes.blockHidden&&Blockly.Blocks[e.attributes.blockId],n=!t.attributes.blockHidden&&Blockly.Blocks[t.attributes.blockId];return!!s!=!!n?(n?1:0)-(s?1:0):e.name.localeCompare(t.name)});const a=$("<div />").addClass("ui divided items");a.attr("role","listbox"),i.forEach(e=>y(a,e,"item")),(s=r?s.parent():s).replaceWith(a)}})}):Promise.resolve()}}).then(()=>{return m((o=d).signatureClass,(e,t)=>{var s=t.compileProgram;if(s){s=g(s.getSourceFile(f.MAIN_TS).statements[0]);if(s&&t.apiInfo){s=t.apiInfo.byQName[s.qName];if(s){var n=Blockly.Blocks[s.attributes.blockId],n=(null==(n=null==n?void 0:n.codeCard)?void 0:n.blocksXml)||void 0,n=n?f.blocks.render(n):null!=(n=t.compileBlocks)&&n.success?t.blocksSvg:void 0,n=n?$(n):void 0,i=ts.pxtc.service.displayStringForSymbol(s,!1,t.apiInfo).split("\n")[1]+";",i=$('<code class="lang-typescript highlight"/>').text(i),a=(null==(a=null==(a=f.appTarget)?void 0:a.appTheme)?void 0:a.python)&&ts.pxtc.service.displayStringForSymbol(s,!0,t.apiInfo).split("\n")[1],a=a&&$('<code class="lang-python highlight"/>').text(a);if(o.snippetReplaceParent&&(e=e.parent()),f.Util.isTranslationMode()){const f=$('<div class="ui segment" />');f.append($('<div class="ui header"><i class="ui xicon globe"></i></div>')),s.attributes.translationId&&f.append($('<div class="ui message">').text(s.attributes.translationId)),s.attributes.jsDoc&&f.append($('<div class="ui message">').text(s.attributes.jsDoc)),f.insertAfter(e)}u(o,e,i,a,n,t,{showJs:!0,showPy:!0,hideGutter:!0})}}}},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,assets:o.assetJSON});var o}).then(()=>{{var l=d;if(l.tutorial)return m(l.snippetClass,(e,t)=>{t=t.blocksSvg,l.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:l.package,snippetMode:!1,aspectRatio:l.blocksAspectRatio,assets:l.assetJSON});let r=0;return m(l.snippetClass,(e,t)=>{var s=t.compileBlocks&&t.compileBlocks.success?$(t.blocksSvg):void 0,n=t.compilePython&&t.compilePython.success&&t.compilePython.outfiles[f.MAIN_PY],i=$('<code class="lang-typescript highlight"/>').text(e.text().trim()),n=n?$('<code class="lang-python highlight"/>').text(n.trim()):void 0,a=(l.snippetReplaceParent&&(e=e.parent()),t.compileJS&&t.compileJS.success),a=l.hex&&a&&t.compileJS.outfiles[pxtc.BINARY_HEX]?t.compileJS.outfiles[pxtc.BINARY_HEX]:void 0,o=`${f.appTarget.nickname||f.appTarget.id}-${l.hexName||""}-${r++}.hex`;u(l,e,i,n,s,t,{showEdit:l.showEdit,run:l.simulator,hexname:o,hex:a})},{package:l.package,aspectRatio:l.blocksAspectRatio,assets:l.assetJSON})}}).then(()=>{return m((s=d).blocksClass,(e,t)=>{t=t.blocksSvg,s.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:s.package,snippetMode:!0,aspectRatio:s.blocksAspectRatio,assets:s.assetJSON});var s}).then(()=>{return(s=d).blocksXmlClass?function t(s,n,i){let a=$("."+s).first();return a[0]?(i.emPixels||(i.emPixels=18),i.splitSvg=!0,f.runner.compileBlocksAsync(a.text(),i).then(e=>{try{n(a,e)}catch(e){f.reportException(e),a.append($("<div/>").addClass("ui segment warning").text(e.message))}return a.removeClass(s),f.U.delay(1,t(s,n,i))})):Promise.resolve()}(s.blocksXmlClass,(e,t)=>{t=t.blocksSvg,s.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:s.package,snippetMode:!0,aspectRatio:s.blocksAspectRatio,assets:s.assetJSON}):Promise.resolve();var s}).then(()=>{return(s=d).diffBlocksXmlClass?function t(s,n,i){let a=$("."+s).first();if(!a[0])return Promise.resolve();i.emPixels||(i.emPixels=18),i.splitSvg=!0;const e=a.text().split(/-{10,}/),o=e[0],r=e[1];return f.runner.compileBlocksAsync("",i).then(e=>{a.removeClass(s);try{const t=f.blocks.diffXml(o,r);t?(e.blocksSvg=t.svg,n(a,e)):a.text("no changes")}catch(e){f.reportException(e),a.append($("<div/>").addClass("ui segment warning").text(e.message))}return f.U.delay(1,t(s,n,i))})}(s.diffBlocksXmlClass,(e,t)=>{t=t.blocksSvg,s.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:s.package,snippetMode:!0,aspectRatio:s.blocksAspectRatio,assets:s.assetJSON}):Promise.resolve();var s}).then(()=>{return(c=d).diffBlocksClass?function i(a){let o=$("."+a).first();if(!o[0])return Promise.resolve();const{fileA:r,fileB:l}=f.diff.split(o.text(),{removeTrailingSemiColumns:!0});return f.U.promiseMapAllSeries([r,l],e=>f.runner.decompileSnippetAsync(e,{generateSourceMap:!0})).then(t=>{try{const i=f.blocks.decompiledDiffAsync(r,t[0].compileBlocks,l,t[1].compileBlocks,{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}),a=f.diff.render(r,l,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});let e;var[s,n]=t.map(e=>e.compilePython&&e.compilePython.outfiles&&e.compilePython.outfiles[f.MAIN_PY]);s&&n&&(e=f.diff.render(s,n,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})),u(c,o.parent(),$(a),e&&$(e),$(i.svg),void 0,{showEdit:!1,run:!1,hexname:void 0,hex:void 0})}catch(e){f.reportException(e),o.append($("<div/>").addClass("ui segment warning").text(e.message))}return f.U.delay(1,i(a))})}(c.diffBlocksClass):Promise.resolve();var c}).then(()=>{return(o=d).diffClass?function e(t){let s=$("."+t).first();if(!s[0])return Promise.resolve();var{fileA:n,fileB:i}=f.diff.split(s.text());try{const e=f.diff.render(n,i,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});o.snippetReplaceParent&&(s=s.parent());var a=$('<div class="ui segment codewidget"/>').append(e);s.removeClass(t),s.replaceWith(a)}catch(e){f.reportException(e),s.append($("<div/>").addClass("ui segment warning").text(e.message))}return f.U.delay(1,e(t))}(o.diffClass):Promise.resolve();var o}).then(()=>{{var i=d;const a={showEdit:!!i.showEdit,run:!!i.simulator};return m(i.staticPythonClass,(e,t)=>{var s,n=t.compilePython;n&&n.success&&(n=(s=e.clone().removeClass("lang-shadow").addClass("highlight")).clone().addClass("lang-python").text(n.outfiles[f.MAIN_PY]),s.addClass("lang-typescript"),c(n),u(i,e.parent(),s,n,void 0,t,a))},{package:i.package,snippetMode:!0,assets:i.assetJSON})}}).then(()=>{return(a=d).projectClass?function e(){let t=$("."+a.projectClass).first(),s=t[0];if(!s)return Promise.resolve();t.removeClass(a.projectClass);var n,i=f.Cloud.parseScriptId(s.innerText);return i?(a.snippetReplaceParent&&(s=s.parentElement,n=document.createElement("div"),s.parentElement.insertBefore(n,s),s.parentElement.removeChild(s),s=n),f.runner.renderProjectAsync(s,i).then(()=>e())):e()}():Promise.resolve();var a}).then(()=>{{const a={};return function e(){var t=o.shift();if(!t)return Promise.resolve();const{el:s,options:n,render:i}=t;return f.runner.decompileSnippetAsync(s.text(),n).then(e=>{var t=e.compileJS&&e.compileJS.diagnostics&&e.compileJS.diagnostics.filter(e=>e.category==pxtc.DiagnosticCategory.Error);t&&t.length&&t.forEach(e=>f.reportError("docs.decompile",""+e.messageText,{code:e.code+""})),e.blocksSvg.querySelectorAll("defs *").forEach(e=>{a[e.id]?e.remove():a[e.id]=!0}),i(s,e)},e=>{f.reportException(e),s.append($("<div/>").addClass("ui segment warning").text(e.message))}).finally(()=>(s.removeClass("lang-shadow"),e()))}().then(()=>{Blockly.Workspace.getAll().forEach(e=>e.dispose()),f.blocks.cleanRenderingWorkspace()})}});var r,i}}}(pxt=pxt||{}),function(m){{var g=m.runner||(m.runner={}),e;class P{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={}}getKsPkg(){return this.ksPkg}getPkgId(){return(this.ksPkg||this).id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFiles(e){this.files=e}getAllFiles(){return m.Util.mapMap(this.files,(e,t)=>t)}}class A{constructor(){this.githubPackageCache={}}readFile(e,t){e=c(e);return m.U.lookup(e.files,t)}writeFile(e,t,s){c(e).files[t]=s}getHexInfoAsync(e){return m.hexloader.getHexInfoAsync(this,e)}cacheStoreAsync(e,t){return Promise.resolve()}cacheGetAsync(e){return Promise.resolve(null)}patchDependencies(e,t,s){if(s){var n=m.github.parseRepoId(s);if(n)for(const t of Object.keys(e.dependencies)){var i=e.dependencies[t],i=m.github.parseRepoId(i);if(i&&n.fullName==i.fullName)return m.semver.strcmp(n.tag,i.tag)<0&&(e.dependencies[t]=s),!0}}return!1}downloadPackageAsync(s,t){let n,i=s.verProtocol(),a=("github"==i&&(n=this.githubPackageCache[s._verspec]),c(s));return(n?Promise.resolve(n):s.commonDownloadAsync()).then(e=>{if(e)return"github"!=i||n||(this.githubPackageCache[s._verspec]=m.Util.clone(e)),a.setFiles(e),Promise.resolve();if("empty"==i){if(0==Object.keys(a.files).length&&a.setFiles(d()),t&&t.length){const n=c(s).files,i=JSON.parse(n[m.CONFIG_NAME]);t.forEach(e=>{o(i,e)}),n[m.CONFIG_NAME]=m.Package.stringifyConfig(i)}return Promise.resolve()}if("docs"!=i)return"invalid"==i?(m.log("skipping invalid pkg "+s.id),Promise.resolve()):Promise.reject(`Cannot download ${s.version()}; unknown protocol`);{let e=d(),t=JSON.parse(e[m.CONFIG_NAME]);return s.verArgument().split(",").forEach(e=>{o(t,e)}),t.yotta||(t.yotta={}),t.yotta.ignoreConflicts=!0,e[m.CONFIG_NAME]=m.Package.stringifyConfig(t),a.setFiles(e),Promise.resolve()}})}}let u,r,l;function o(e,t){var s=/^([a-zA-Z0-9_-]+)(=(.+))?$/.exec(t);if(s){if(s[3]&&this&&this.patchDependencies(e,s[1],s[3]))return;e.dependencies[s[1]]=s[3]||"*"}else console.warn("unknown package syntax "+t)}function c(e){var t=e._editorPkg;if(t)return t;let s=null;e!=g.mainPkg&&(s=c(g.mainPkg));t=new P(e,s);return e==g.mainPkg&&(t.topPkg=t),e._editorPkg=t}function d(){var e=m.appTarget.tsprj,t=m.U.clone(e.files);return t[m.CONFIG_NAME]=m.Package.stringifyConfig(e.config),t[m.MAIN_BLOCKS]="",t}function p(e){console.error(e)}function h(e,s,t){var n=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj";let i,a,o;return r&&r._verspec==n?(g.mainPkg=r,i=g.mainPkg.host(),a=Promise.resolve(),o=Promise.resolve()):(i=g.mainPkg.host(),g.mainPkg=new m.MainPackage(i),g.mainPkg._verspec=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj",a=i.downloadPackageAsync(g.mainPkg,t),o=g.mainPkg.installAllAsync(),r=g.mainPkg),a.then(()=>i.readFile(g.mainPkg,m.CONFIG_NAME)).then(e=>e?o.then(()=>{var e,t;s&&((e=c(g.mainPkg)).files[m.MAIN_TS]=s,(t=JSON.parse(e.files[m.CONFIG_NAME])).name=window.location.href.split("/").pop().split(/[?#]/)[0],e.files[m.CONFIG_NAME]=m.Package.stringifyConfig(t),g.mainPkg.config.name=t.name,-1==g.mainPkg.config.files.indexOf(m.MAIN_BLOCKS))&&g.mainPkg.config.files.push(m.MAIN_BLOCKS)}).catch(e=>{p(lf("Cannot load extension: {0}",e.message))}):Promise.resolve())}function f(e){var t=g.mainPkg.getTargetOptions();return t.isNative=!!e,t.hasHex=!!e,g.mainPkg.getCompileOptionsAsync(t)}function s(e,t){return f(e).then(e=>{t&&t(e);e=pxtc.compile(e);return e.diagnostics&&0<e.diagnostics.length&&e.diagnostics.forEach(e=>{console.error(e.messageText)}),e})}async function v(n){var e;await h(n.id,n.code,n.dependencies);let i=!1;const a=m.appTarget.versions.target;let t=await s(!1,e=>{var t;if(n.assets){const g=JSON.parse(n.assets);for(const n of Object.keys(g)){const i=g[n];if(e.fileSystem[n]=i,e.sourceFiles.indexOf(n)<0&&e.sourceFiles.push(n),/\.jres$/.test(n)){const g=JSON.parse(i);e.jres=m.inflateJRes(g,e.jres)}}}if(n.code&&(e.fileSystem[m.MAIN_TS]=n.code),e.target.preferredEditor===m.PYTHON_PROJECT_NAME){e.target.preferredEditor=m.JAVASCRIPT_PROJECT_NAME,e.ast=!0;const g=S(pxtc.compile(e).ast,e);e.apisInfo=g,e.target.preferredEditor=m.PYTHON_PROJECT_NAME}var s=null==(t=g.mainPkg.config.targetVersions)?void 0:t.target;if(s&&a&&m.semver.cmp(m.semver.parse(s),m.semver.parse(a))<0)for(const g of Object.keys(e.fileSystem))!m.Util.startsWith(g,"pxt_modules")&&m.Util.endsWith(g,".ts")&&(i=!0,e.fileSystem[g]=m.patching.patchJavaScript(s,e.fileSystem[g]))});return 0<(null==(e=t.diagnostics)?void 0:e.length)&&i&&(m.log("Compile with upgrade rules failed, trying again with original code"),t=await s(!1,e=>{n.code&&(e.fileSystem[m.MAIN_TS]=n.code)})),t.diagnostics&&0<t.diagnostics.length&&console.error("Diagnostics",t.diagnostics),pxtc.buildSimJsInfo(t)}function k(e){let t={};try{var s=window.localStorage.getItem(e);s&&(t=JSON.parse(s))}catch(e){}return t}function b(e,t){if(g.editorLanguageMode=e,t==m.Util.localeInfo())return Promise.resolve();{const g=/^live-/;return g.test(t)&&m.Util.enableLiveLocalizationUpdates(),m.Util.updateLocalizationAsync({targetId:m.appTarget.id,baseUrl:m.webConfig.commitCdnUrl,code:t.replace(g,""),pxtBranch:m.appTarget.versions.pxtCrowdinBranch,targetBranch:m.appTarget.versions.targetCrowdinBranch})}}function y(e){var t=e.data;if(t)switch(t.type){case"fileloaded":var s=t,n=s.name;b(/\.ts$/i.test(n)?l.TypeScript:l.Blocks,s.locale);break;case"popout":n=/((\/v[0-9+])\/)?[^\/]*#(doc|md):([^&?:]+)/i.exec(window.location.href);if(n){const e=m.webConfig.docsUrl||"/--docs";s=n[2]||"",n="doc"==n[3]?m.webConfig.isStatic?`/docs${n[4]}.html`:""+n[4]:e+"?md="+n[4];window.parent&&window.parent.postMessage({type:"opendoc",url:m.BrowserUtils.urlJoin(s,n)},"*")}break;case"localtoken":t&&t.localToken&&(m.Cloud.localToken=t.localToken,a.forEach(e=>e()),a=[])}}function w(t,s){return m.Cloud.privateGetTextAsync(s+"/text").then(e=>JSON.parse(e)).then(e=>x(t,e,s))}function x(e,t,s=null,n=!1){const i=JSON.parse(t[m.CONFIG_NAME])||{};let a=`# ${i.name} ${i.version||""}

`;const o="README.md";t[o]&&(a+=t[o].replace(/^#+/,"$0#")+"\n"),i.files.filter(e=>e!=m.CONFIG_NAME&&e!=o).filter(e=>g.editorLanguageMode==l.Blocks==/\.blocks?$/.test(e)).forEach(e=>{/^main\.(ts|blocks)$/.test(e)||(a+=`
## ${e}
`),/\.ts$/.test(e)?a+=`\`\`\`typescript
${t[e]}
\`\`\`
`:/\.blocks?$/.test(e)?a+=`\`\`\`blocksxml
${t[e]}
\`\`\`
`:a+=`\`\`\`${e.substr(e.indexOf("."))}
${t[e]}
\`\`\`
`});var r=i&&i.dependencies&&Object.keys(i.dependencies).filter(e=>e!=m.appTarget.corepkg);if(r&&r.length&&(a+=`
## ${lf("Extensions")} #extensions

${r.map(e=>`* ${e}, `+i.dependencies[e]).join("\n")}

\`\`\`package
${r.map(e=>e+"="+i.dependencies[e]).join("\n")}
\`\`\`
`),s){let e=(m.appTarget.appTheme.shareUrl||"https://makecode.com/")+s;n&&(e="`"+e+"`"),a+=`
${e}

`}return console.debug("print md: "+a),C(e,a,{print:!0})}function C(e,t,s={}){var t=m.docs.renderMarkdown({template:'\n<aside id=button class=box>\n   <a class="ui primary button" href="@ARGS@">@BODY@</a>\n</aside>\n\n<aside id=vimeo>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="vimeo" data-id="@ARGS@" data-placeholder="/thumbnail/1024/vimeo/@ARGS@" data-icon="video play">\n    </div>\n</div></div>\n</aside>\n\n<aside id=youtube>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="youtube" data-id="@ARGS@" data-placeholder="https://img.youtube.com/vi/@ARGS@/0.jpg">\n    </div>\n</div></div>\n</aside>\n\n<aside id=section>\n    \x3c!-- section @ARGS@ --\x3e\n</aside>\n\n<aside id=hide class=box>\n    <div style=\'display:none\'>\n        @BODY@\n    </div>\n</aside>\n\n<aside id=avatar class=box>\n    <div class=\'avatar @ARGS@\'>\n        <div class=\'avatar-image\'></div>\n        <div class=\'ui compact message\'>\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=hint class=box>\n    <div class="ui info message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=codecard class=box>\n    <pre><code class="lang-codecard">@BODY@</code></pre>\n</aside>\n\n<aside id=tutorialhint class=box>\n    <div class="ui hint message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=reminder class=box>\n    <div class="ui warning message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=alert class=box>\n    <div class="ui negative message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=tip class=box>\n    <div class="ui positive message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n\x3c!-- wrapped around ordinary content --\x3e\n<aside id=main-container class=box>\n    <div class="ui text">\n        @BODY@\n    </div>\n</aside>\n\n\x3c!-- used for \'column\' box - they are collected and wrapped in \'column-container\' --\x3e\n<aside id=column class=aside>\n    <div class=\'column\'>\n        @BODY@\n    </div>\n</aside>\n<aside id=column-container class=box>\n    <div class="ui three column stackable grid text">\n        @BODY@\n    </div>\n</aside>\n@breadcrumb@\n@body@',markdown:t,theme:m.appTarget.appTheme}),n=s.blocksAspectRatio||window.innerHeight<window.innerWidth?1.62:1/1.62,t=($(e).html(t),$(e).find("a").attr("target","_blank"),m.runner.defaultClientRenderOptions());return t.tutorial=!!s.tutorial,t.blocksAspectRatio=n||t.blocksAspectRatio,t.showJavaScript=g.editorLanguageMode==l.TypeScript,s.print&&(t.showEdit=!1,t.simulator=!1),m.runner.renderAsync(t).then(()=>{$(e).find('a[href^="/"]').removeAttr("target").each((e,t)=>{$(t).attr("href","#doc:"+$(t).attr("href").replace(/^\//,""))}),$(e).find(".ui.embed").embed()})}m.react.getTilemapProject||(m.react.getTilemapProject=()=>(u||(u=new m.TilemapProject).loadPackage(g.mainPkg),u)),g.initFooter=function(i,e){if(i){let e=m.appTarget.appTheme,t=$("body"),s=$(i),n=$("<a/>").attr("href",e.homeUrl).attr("target","_blank");s.append(n),e.organizationLogo?n.append($("<img/>").attr("src",m.Util.toDataUri(e.organizationLogo))):n.append(lf("powered by {0}",e.title)),t.mouseenter(e=>s.fadeOut()),t.mouseleave(e=>s.fadeIn())}},g.showError=p,g.generateHexFileAsync=function(t){return h(t.id).then(()=>s(!0,e=>{t.code&&(e.fileSystem[m.MAIN_TS]=t.code)})).then(e=>(e.diagnostics&&0<e.diagnostics.length&&console.error("Diagnostics",e.diagnostics),e.outfiles[pxtc.BINARY_HEX]))},g.generateVMFileAsync=function(t){return m.setHwVariant("vm"),h(t.id).then(()=>s(!0,e=>{t.code&&(e.fileSystem[m.MAIN_TS]=t.code)})).then(e=>(console.log(e),e))},g.simulateAsync=async function(e,i){var t;const s=i.builtJsInfo||await v(i),{js:a,fnArgs:n,parts:o,usedBuiltinParts:r}=s;if(!a)return void console.error("Program failed to compile");var l={onSimulatorCommand:e=>{if("restart"===e.command&&(u.storedState=k(i.id),c.run(a,u)),"setstate"==e.command&&e.stateKey&&e.stateValue){var t=i.id,s=e.stateKey,e=e.stateValue,n=k(t);if(t){e?n[s]=e:delete n[s];try{window.localStorage.setItem(t,JSON.stringify(n))}catch(t){}}}}};l.messageSimulators=null==(t=null==(t=m.appTarget)?void 0:t.simulator)?void 0:t.messageSimulators;let c=new pxsim.SimulatorDriver(e,l),d=m.appTarget.simulator.boardDefinition,p=k(i.id),u={boardDefinition:d,parts:o,builtinParts:r,fnArgs:n,cdnUrl:m.webConfig.commitCdnUrl,localizedStrings:m.Util.getLocalizedStrings(),highContrast:i.highContrast,storedState:p,light:i.light,single:i.single};return m.appTarget.simulator&&!i.fullScreen&&(u.aspectRatio=o.length&&m.appTarget.simulator.partsAspectRatio?m.appTarget.simulator.partsAspectRatio:m.appTarget.simulator.aspectRatio),c.run(a,u),s},g.buildSimJsInfo=v,(e=l=g.LanguageMode||(g.LanguageMode={}))[e.Blocks=0]="Blocks",e[e.TypeScript=1]="TypeScript",g.editorLanguageMode=l.Blocks,g.setEditorContextAsync=b,g.startRenderServer=function(){m.tickEvent("renderer.ready");const t=[];let s;m.editor.initEditorExtensionsAsync().then(()=>{window.addEventListener("message",function(e){e=e.data;"renderblocks"==e.type&&(t.push(e),function e(){if(!s){const i=t.shift();if(i){const a=i.options||{},o=(a.splitSvg=!1,m.tickEvent("renderer.job"),/^\s*<xml/.test(i.code));s=(async()=>{await m.BrowserUtils.loadBlocklyAsync();var e=(s=(o?await m.runner.compileBlocksAsync(i.code,a):await g.decompileSnippetAsync(i.code,i.options)).blocksSvg).viewBox.baseVal.width,t=s.viewBox.baseVal.height,s=s?await m.blocks.layout.blocklyToSvgAsync(s,0,0,e,t):void 0;let n;try{n=s?await m.BrowserUtils.encodeToPngAsync(s.xml,{width:e,height:t}):void 0}catch(e){console.warn(e)}window.parent.postMessage({source:"makecode",type:"renderblocks",id:i.id,width:null==s?void 0:s.width,height:null==s?void 0:s.height,svg:null==s?void 0:s.svg,uri:n||(null==s?void 0:s.xml),css:null==s?void 0:s.css},"*")})().catch(e=>{window.parent.postMessage({source:"makecode",type:"renderblocks",id:i.id,error:e.message},"*")}).finally(()=>{s=void 0,e()})}}}())},!1),window.parent.postMessage({source:"makecode",type:"renderready",versions:m.appTarget.versions},"*")})},g.startDocsServer=function(e,r,t){m.tickEvent("docrenderer.ready");const s=[];function n(a,o){m.debug("rendering "+a),t&&$(t).hide(),$(r).hide(),$(e).show(),m.U.delay(100).then(()=>{switch(a){case"print":var e=window.localStorage.printjob;return delete window.localStorage.printjob,x(r,JSON.parse(e),void 0,!0).then(()=>pxsim.print(1e3));case"project":return x(r,JSON.parse(o)).then(()=>pxsim.print(1e3));case"projectid":return w(r,JSON.parse(o)).then(()=>pxsim.print(1e3));case"doc":return s=r,i=(i=o).replace(/^\//,""),m.Cloud.markdownAsync(i).then(e=>C(s,e,{path:i}));case"book":{var n=r;var t=o;t=t.replace(/^\//,""),m.tickEvent("book",{id:t}),m.log("rendering book from "+t);let s;return $("#loading").find(".loader").addClass("text").text(lf("Compiling your book (this may take a minute)")),m.U.delay(100).then(()=>m.Cloud.markdownAsync(t)).then(e=>{s=m.docs.buildTOC(e),m.log("TOC: "+JSON.stringify(s,null,2));const t=[];return m.docs.visitTOC(s,e=>{/^\//.test(e.path)&&!/^\/pkg\//.test(e.path)&&t.push(e)}),m.U.promisePoolAsync(4,t,async t=>{try{var e=await m.Cloud.markdownAsync(t.path);t.markdown=e}catch(e){t.markdown=`_${t.path} failed to load._`}})}).then(e=>{let t=s[0].name;return m.docs.visitTOC(s,e=>{e.markdown&&(t+="\n\n"+e.markdown)}),C(n,t)});return}default:return C(r,o)}var s,i}).catch(e=>{$(r).html(`
                    <img style="height:4em;" src="${m.appTarget.appTheme.docsLogo}" />
                    <h1>${lf("Oops")}</h1>
                    <h3>${lf("We could not load the documentation, please check your internet connection.")}</h3>
                    <button class="ui button primary" id="tryagain">${lf("Try Again")}</button>`),$(r).find("#tryagain").click(()=>{n(a,o)}),window.parent&&window.parent.postMessage({type:"docfailed",docType:a,src:o},"*")}).finally(()=>{$(e).hide(),t&&$(t).show(),$(r).show()}).then(()=>{})}function i(e,t){t?(pxsim.U.addClass(e,"disabled"),e.setAttribute("aria-disabled","true")):(pxsim.U.removeClass(e,"disabled"),e.setAttribute("aria-disabled","false"))}function a(){let e=/^#(doc|md|tutorial|book|project|projectid|print):([^&?:]+)(:([^&?:]+):([^&?:]+))?/i.exec(window.location.hash);e&&(t&&(s.push(window.location.hash),10<s.length&&s.shift(),1<s.length)&&i(t,!1),(e[4]?b(/^blocks$/.test(e[4])?l.Blocks:l.TypeScript,e[5]):Promise.resolve()).then(()=>n(e[1],decodeURIComponent(e[2]))))}t&&(t.addEventListener("click",()=>{t&&(1<s.length&&(s.pop(),window.location.hash=s.pop()),s.length<=1)&&i(t,!0)}),i(t,!0)),m.editor.initEditorExtensionsAsync().then(()=>{window.addEventListener("message",y,!1),window.addEventListener("hashchange",()=>{a()},!1),parent.postMessage({type:"sidedocready"},"*"),setTimeout(()=>a(),1)})},g.renderProjectAsync=w,g.renderProjectFilesAsync=x;let n,i;function S(e,t){i=i||{};var s=Object.keys(t.fileSystem).sort().join(";");return i[s]||(i[s]=pxtc.getApiInfo(e,t.jres)),i[s]}g.renderMarkdownAsync=C,g.decompileSnippetAsync=function(t,l){const{assets:c,forceCompilation:s,snippetMode:d,generateSourceMap:p}=l||{};return h(l&&l.packageId?"pub:"+l.packageId:l&&l.package?"docs:"+l.package:null,t).then(()=>f(!!m.appTarget.compile&&m.appTarget.compile.hasHex)).then(e=>{if(t&&(e.fileSystem[m.MAIN_TS]=t),e.ast=!0,c)for(const m of Object.keys(c))e.sourceFiles.indexOf(m)<0&&e.sourceFiles.push(m),e.fileSystem[m]=c[m];let i,a,o,r=(a=s?(i=pxtc.compile(e))&&i.ast:pxtc.getTSProgram(e,n),n=a,m.appTarget.appTheme.python&&(o=ts.pxtc.transpile.tsToPy(a,m.MAIN_TS)),S(a,e));return ts.pxtc.localizeApisAsync(r,g.mainPkg).then(()=>{var e=pxtc.getBlocksInfo(r),t=(m.blocks.initializeAndInject(e),null==c?void 0:c[m.TILEMAP_JRES]),s=null==c?void 0:c[m.IMAGES_JRES],e=((t||s)&&((u=new m.TilemapProject).loadPackage(g.mainPkg),t&&u.loadTilemapJRes(JSON.parse(t),!0),s)&&u.loadAssetsJRes(JSON.parse(s)),pxtc.decompiler.decompileToBlocks(e,a.getSourceFile(m.MAIN_TS),{snippetMode:d,generateSourceMap:p}));if(e.diagnostics&&0<e.diagnostics.length&&e.diagnostics.forEach(e=>console.error(e.messageText)),!e.success)return{package:g.mainPkg,compileProgram:a,compileJS:i,compileBlocks:e,apiInfo:r};m.debug(e.outfiles[m.MAIN_BLOCKS]);var n=m.blocks.render(e.outfiles[m.MAIN_BLOCKS],l);return(t||s)&&(u=null),{package:g.mainPkg,compileProgram:a,compileJS:i,compileBlocks:e,compilePython:o,apiInfo:r,blocksSvg:n}})})},g.compileBlocksAsync=function(i,a){const o=(a||{})["assets"];return h(a&&a.packageId?"pub:"+a.packageId:a&&a.package?"docs:"+a.package:null,"").then(()=>f(!!m.appTarget.compile&&m.appTarget.compile.hasHex)).then(e=>{if(e.ast=!0,o)for(const m of Object.keys(o))e.sourceFiles.indexOf(m)<0&&e.sourceFiles.push(m),e.fileSystem[m]=o[m];const n=S(pxtc.compile(e).ast,e);return ts.pxtc.localizeApisAsync(n,g.mainPkg).then(()=>{var e=pxtc.getBlocksInfo(n),e=(m.blocks.initializeAndInject(e),null==o?void 0:o[m.TILEMAP_JRES]),t=null==o?void 0:o[m.IMAGES_JRES],s=((e||t)&&((u=new m.TilemapProject).loadPackage(g.mainPkg),e&&u.loadTilemapJRes(JSON.parse(e),!0),t)&&u.loadAssetsJRes(JSON.parse(t)),m.blocks.render(i,a));return(e||t)&&(u=null),{package:g.mainPkg,blocksSvg:s,apiInfo:n}})})};let a=[];g.initCallbacks=[],g.init=function(){!function(){m.setAppTarget(window.pxtTargetBundle),m.Util.assert(!!m.appTarget);var e=window.location.href;let t,s=!1;if(/[&?]translate=1/.test(e)&&!m.BrowserUtils.isIE())t=ts.pxtc.Util.TRANSLATION_LOCALE,s=!0,m.Util.enableLiveLocalizationUpdates();else{const g=/PXT_LANG=(.*?)(?:;|$)/.exec(document.cookie),A=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(e),n=(t=A?A[3]:g&&g[1]||m.appTarget.appTheme.defaultLocale||navigator.userLanguage||navigator.language,m.appTarget.appTheme.defaultLocale),i=null==t?void 0:t.toLocaleLowerCase(),a=m.BrowserUtils.isLocalHostDev()&&(!i||(n?n.toLocaleLowerCase()===i:"en"===i||"en-us"===i));(!(m.BrowserUtils.isPxtElectron()||a||m.appTarget.appTheme.disableLiveTranslations)||null!=A&&A[1])&&m.Util.enableLiveLocalizationUpdates(),s=!!A&&!!A[2]}const n=m.appTarget.versions,i=($&&$.fn&&$.fn.embed&&$.fn.embed.settings&&$.fn.embed.settings.sources&&$.fn.embed.settings.sources.youtube&&($.fn.embed.settings.sources.youtube.url="//www.youtube.com/embed/{id}?rel=0"),m.webConfig);return m.Util.updateLocalizationAsync({targetId:m.appTarget.id,baseUrl:i.commitCdnUrl,code:t,pxtBranch:n?n.pxtCrowdinBranch:"",targetBranch:n?n.targetCrowdinBranch:"",force:s}).then(()=>{g.mainPkg=new m.MainPackage(new A)})}().then(()=>{for(let e=0;e<g.initCallbacks.length;++e)g.initCallbacks[e]()})},(e=window.ksRunnerWhenLoaded)&&e()}}(pxt=pxt||{});