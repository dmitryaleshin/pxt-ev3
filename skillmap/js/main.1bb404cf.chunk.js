(this.webpackJsonpskillsmap=this.webpackJsonpskillsmap||[]).push([[0],{41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(R,_,e){"use strict";e.r(_);var H,B,f=e(0),c=e.n(f),_=e(23),_=e.n(_),t=e(8),a=e(17),j=e(9),x=e(1),D="ADD_SKILL_MAP",F="CLEAR_SKILL_MAPS",V="CLEAR_METADATA",W="CHANGE_SELECTED_ITEM",G="SET_SKILL_MAP_COMPLETED",z="SET_HEADERID_FOR_ACTIVITY",q="OPEN_ACTIVITY",Y="CLOSE_ACTIVITY",K="SAVE_AND_CLOSE_ACTIVITY",$="RESTART_ACTIVITY",Q="SET_USER",J="UPDATE_USER_COMPLETED_TAGS",X="RESET_USER",Z="SET_PAGE_TITLE",ee="SET_PAGE_DESCRIPTION",te="SET_PAGE_INFO_URL",ae="SET_PAGE_BACKGROUND_IMAGE_URL",re="SET_PAGE_BANNER_IMAGE_URL",ne="SET_PAGE_THEME",ie="SET_PAGE_SOURCE_URL",ce="SET_PAGE_ALTERNATE_URLS",oe="SHOW_COMPLETION_MODAL",se="SHOW_RESTART_ACTIVITY_MODAL",le="SHOW_RESET_USER_MODAL",ue="SHOW_CARRYOVER_MODAL",de="SHOW_SHARE_MODAL",pe="SHOW_LOGIN_MODAL",he="SHOW_LOGIN_PROMPT",me="SHOW_DELETE_ACCOUNT_MODAL",fe="HIDE_MODAL",ve="SET_USER_PROFILE",ye="USER_LOG_OUT",ge="SHOW_USER_PROFILE",be="HIDE_USER_PROFILE",ke="SET_SHARE_STATUS",Ie="SET_CLOUD_STATUS",Oe="SET_READY_RESOURCES",r=e(2),C=e.n(r),p=e(3),Se="-SHOWN-LOGIN-PROMPT";function we(e){var t={cmd:"",arg:""},e=/^(\w+)(:([:./\-+=\w]+))?/.exec((e||window.location.hash).replace(/^#/,""));return t=e?{cmd:e[1],arg:e[3]||""}:t}function Ce(){return(Ce=Object(p.a)(C.a.mark(function e(t,a){var r,n,i;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:n="unknown",e.t0=t,e.next="docs"===e.t0?6:"github"===e.t0?9:"local"===e.t0?12:15;break;case 6:return r=Ee(a),n="approved",e.abrupt("break",17);case 9:return e.next=11,function(){return je.apply(this,arguments)}(a);case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,function(){return xe.apply(this,arguments)}(a);case 14:return e.abrupt("return",e.sent);case 15:return r=a,e.abrupt("break",17);case 17:if(pxt.BrowserUtils.isSafari())return e.prev=18,e.next=21,Ue(r);e.next=31;break;case 21:i=e.sent,e.next=29;break;case 24:return e.prev=24,e.t1=e.catch(18),e.next=28,Ue(r);case 28:i=e.sent;case 29:e.next=34;break;case 31:return e.next=33,Ue(r);case 33:i=e.sent;case 34:return e.abrupt("return",{text:i,identifier:r,status:n});case 35:case"end":return e.stop()}},e,null,[[18,24]])}))).apply(this,arguments)}function je(){return(je=Object(p.a)(C.a.mark(function e(t){var a,r,n,i,c,o,s,l;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=pxt.github.parseRepoId(t),e.next=3,pxt.packagesConfigAsync();case 3:r=e.sent,o=pxt.github.parseRepoId(a.slug),o=pxt.github.repoStatus(o,r),n="unknown",e.t0=o,e.next=e.t0===pxt.github.GitRepoStatus.Banned?10:e.t0===pxt.github.GitRepoStatus.Approved?13:16;break;case 10:return n="banned",i="https://github.com/"+a.fullName,e.abrupt("break",18);case 13:return n="approved",i=void 0,e.abrupt("break",18);case 16:return i="https://github.com/"+a.fullName,e.abrupt("break",18);case 18:if(e.t1=a.tag,e.t1){e.next=23;break}return e.next=22,pxt.github.latestVersionAsync(a.slug,r,!0);case 22:e.t1=e.sent;case 23:if(c=e.t1){e.next=27;break}return pxt.log("skillmap github tag not found at ".concat(a.fullName)),e.abrupt("return",void 0);case 27:return a.tag=c,e.next=30,pxt.github.downloadPackageAsync("".concat(a.slug,"#").concat(a.tag),r);case 30:if(o=e.sent)return l=Ae(a),s=l.identifier,l=l.fileName,e.abrupt("return",{text:pxt.tutorial.resolveLocalizedMarkdown(a,o.files,l),identifier:s,reportId:i,status:n});e.next=34;break;case 34:return e.abrupt("return",void 0);case 35:case"end":return e.stop()}},e)}))).apply(this,arguments)}function xe(){return(xe=Object(p.a)(C.a.mark(function e(t){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o())return t=t.replace(/^\//,"").replace(/\.md$/,""),e.next=4,fetch("docs/"+t+".md");e.next=9;break;case 4:return a=e.sent,e.next=7,a.text();case 7:return a=e.sent,e.abrupt("return",{text:a,identifier:t,status:"approved"});case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ee(e){e=e.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,"");var t=(null==(t=window.pxtTargetBundle)?void 0:t.name)||"arcade";return"".concat("https://www.makecode.com/api","/md/").concat(t,"/").concat(e)}function Ae(e){var t=(e.fileName||"skillmap").replace(/^\/?blob\/main\//,"").replace(/^\/?blob\/master\//,"").replace(/\.md$/,"");return{identifier:e.fullName+"#"+t,fileName:t}}function Ne(){return(Ne=Object(p.a)(C.a.mark(function e(t,a){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var r,n;if(t)return e.next=3,r="/api/".concat(encodeURIComponent(t),"/abusereports"),n=a,new Promise(function(e,t){var a=new XMLHttpRequest;a.addEventListener("error",function(e){t(e)}),a.addEventListener("load",function(){try{e(a.responseText)}catch(e){t(e)}}),a.open("POST",r,!0),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(n))});e.next=3;break;case 3:return e.abrupt("return");case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ue(r){return new Promise(function(e,t){var a=new XMLHttpRequest;a.addEventListener("error",function(e){t(e)}),a.addEventListener("load",function(){try{e(a.responseText)}catch(e){t(e)}}),a.open("GET",r),a.send()})}function Pe(){function e(){return(65536|function(){var e=new Uint8Array(4),t=e;if(window.crypto)window.crypto.getRandomValues(t);else for(var a=0;a<t.length;++a)t[a]=Math.floor(255*Math.random());return new Uint32Array(e.buffer)[0]}()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()}function o(){return"localhost"===window.location.hostname}function Me(e){return"".concat(o()?"":"/static/skillmap","/").concat(e.replace(/^\//,""))}function m(e,t){var a,r;(t=t||{}).page=B,t.pageTitle=H,null!=(a=(r=window).pxtTickEvent)&&a.call(r,e,t)}var E=e(10);function A(e,t,a,r){return!(null==(e=N(e,t,a,r))||!e.isCompleted)}function Te(e,t,a,r){var n,i,c,o=e&&a&&Le(e,t,a,r)?"notstarted":"locked";return e&&(a&&t&&!function(e,t,a){var r,n=Object(E.a)(t.prerequisites);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("tag"===i.type){if(!e.completedTags[a])return;var c=e.completedTags[a][i.tag];if(void 0===c||c<i.numberCompleted)return}else if("map"===i.type&&!function(a,r,n,i){return!Object.keys(null==n?void 0:n.activities).some(function(e){var t;return!(null!=(t=Re(a,r,n.mapId))&&null!=(t=t.activityState[e])&&t.isCompleted)&&e!==i})}(e,a,t))return}}catch(e){n.e(e)}finally{n.f()}return 1}(e,a,t)?o="locked":(e=N(e,t,a.mapId,r))&&(e.isCompleted?(o=e.currentStep&&e.maxSteps&&e.currentStep<e.maxSteps?"restarted":"completed",c=e.headerId):e.headerId&&(o="inprogress"),n=null==e?void 0:e.currentStep,i=null==e?void 0:e.maxSteps)),{status:o,currentStep:n,maxSteps:i,completedHeadedId:c}}function Le(n,i,c,o){return c.root.activityId===o||function e(t){if(A(n,i,c.mapId,t.activityId)){if(t.next.some(function(e){return e.activityId===o}))return!0;var a,r=Object(E.a)(t.next);try{for(r.s();!(a=r.n()).done;)if(e(a.value))return!0}catch(e){r.e(e)}finally{r.f()}}return!1}(c.root)}function Re(e,t,a){return e.mapProgress[t]?e.mapProgress[t][a]:void 0}function N(e,t,a,r){return null==(e=Re(e,t,a))?void 0:e.activityState[r]}function _e(t,a){return t.mapProgress&&t.mapProgress[a]&&0!=Object.keys(t.mapProgress[a]).length&&Object.keys(t.mapProgress[a]).some(function(e){return 0!=Object.keys(t.mapProgress[a][e].activityState).length})}function He(t,a){return Object.keys(t.activities).filter(function(e){return!U(t.activities[e])}).filter(function(e){return function t(e){{var a;if(U(e))return a=[],e.next.forEach(function(e){return a=a.concat(t(e))}),a}return e.next}(t.activities[e]).map(function(e){return e.activityId}).some(function(e){return e===a})}).map(function(e){return t.activities[e]})}function Be(t,a,r,e){return He(r,e).map(function(e){return N(t,a,r.mapId,e.activityId)}).filter(function(e){return!!e})}function De(e,t,a,r){e=Be(e,t,a,r).filter(function(e){return(null==e?void 0:e.isCompleted)&&e.maxSteps===e.currentStep}).sort(function(e,t){return(t.completedTime||0)-(e.completedTime||0)});return null==e?void 0:e[0]}function Fe(e,t,a,r){var n,i;return!!(e&&a&&r&&"activity"===r.kind)&&(i=null==(n=Be(e,t,a,r.activityId))?void 0:n.some(function(e){return(null==e?void 0:e.isCompleted)&&e.maxSteps===e.currentStep}),r.allowCodeCarryover)&&0<n.length&&i&&Le(e,t,a,r.activityId)}function U(e){return"reward"===e.kind||"completion"===e.kind}function Ve(e,a,r){return Object.values(null!=(e=e.mapProgress[a])?e:[]).filter(function(e){var t;return!r||!(null!=(t=r.mapProgress[a])&&t[e.mapId])||0===Object.keys(r.mapProgress[a][e.mapId].activityState).length}).map(function(e){return Object.values(e.activityState)}).reduce(function(e,t){return e.concat(t,[])},[]).map(function(e){return e.headerId}).filter(function(e){return!!e})}var P={title:lf("Game Maker Guide"),description:lf("Level up your game making skills by completing the tutorials in this guide."),pageSourceStatus:"unknown",pageSourceUrl:"default",user:{version:pxt.skillmap.USER_VERSION,isDebug:!0,id:Pe(),mapProgress:{},completedTags:{}},theme:{backgroundColor:"var(--body-background-color)",pathColor:"#BFBFBF",strokeColor:"#000000",rewardNodeColor:"var(--primary-color)",rewardNodeForeground:"#000000",unlockedNodeColor:"var(--secondary-color)",unlockedNodeForeground:"#000000",lockedNodeColor:"#BFBFBF",lockedNodeForeground:"#000000",completedNodeColor:"var(--secondary-color)",completedNodeForeground:"#000000",selectedStrokeColor:"var(--hover-color)",pathOpacity:.5},maps:{},auth:{signedIn:!1},cloudState:{}};function We(e,t,a,r,n,i,c,o){var o=7<arguments.length&&void 0!==o&&o,a=a.mapId,s=(s=N(e,t,a,r))||{isCompleted:!1,activityId:r,currentStep:i,maxSteps:c,headerId:n},l=(null==(l=e.mapProgress)?void 0:l[t])||{};return Object(x.a)(Object(x.a)({},e),{},{mapProgress:Object(x.a)(Object(x.a)({},e.mapProgress),{},Object(j.a)({},t,Object(x.a)(Object(x.a)({},l),{},Object(j.a)({},a,Object(x.a)(Object(x.a)({},(null==l?void 0:l[a])||{mapId:a}),{},{activityState:Object(x.a)(Object(x.a)({},(null==l||null==(e=l[a])?void 0:e.activityState)||{}),{},Object(j.a)({},r,Object(x.a)(Object(x.a)({},s),{},{headerId:n,currentStep:i,maxSteps:c,isCompleted:s.isCompleted||o})))})))))})}function Ge(e,t,a,r){return{type:q,mapId:e,activityId:t,previousHeaderId:a,carryoverCode:r}}function ze(){return{type:K}}function qe(e,t){return{type:oe,mapId:e,activityId:t}}function Ye(e,t){return{type:ue,mapId:e,activityId:t}}function Ke(){return{type:pe}}function $e(){return{type:be}}function Qe(e,t){return{type:ke,headerId:e,url:t}}var Je,Xe,M=Object(a.b)(function(){var c,o,e,t,a,r,n,i,s,l,u,d,p,h,m,f,v,y=0<arguments.length&&void 0!==arguments[0]?arguments[0]:P,g=1<arguments.length?arguments[1]:void 0;switch(g.type){case D:return Object(x.a)(Object(x.a)({},y),{},{maps:Object(x.a)(Object(x.a)({},y.maps),{},Object(j.a)({},g.map.mapId,g.map))});case F:return Object(x.a)(Object(x.a)({},y),{},{maps:{}});case V:return Object(x.a)(Object(x.a)({},y),{},{title:P.title,description:P.description,infoUrl:P.infoUrl,backgroundImageUrl:void 0,bannerImageUrl:void 0,alternateSourceUrls:void 0,theme:Object(x.a)({},P.theme)});case W:return Object(x.a)(Object(x.a)({},y),{},{selectedItem:{mapId:g.mapId,activityId:g.activityId}});case G:return Object(x.a)(Object(x.a)({},y),{},{user:Object(x.a)(Object(x.a)({},y.user),{},{mapProgress:Object(x.a)(Object(x.a)({},y.user.mapProgress),{},Object(j.a)({},y.pageSourceUrl,Object(x.a)(Object(x.a)({},null==(b=y.user.mapProgress)?void 0:b[y.pageSourceUrl]),{},Object(j.a)({},g.mapId,Object(x.a)(Object(x.a)({},null==(b=y.user.mapProgress)||null==(b=b[y.pageSourceUrl])?void 0:b[g.mapId]),{},{completionState:"completed"})))))})});case q:return Object(x.a)(Object(x.a)({},y),{},{editorView:{currentMapId:g.mapId,currentActivityId:g.activityId,state:"active",allowCodeCarryover:!!g.carryoverCode,previousHeaderId:g.previousHeaderId,currentHeaderId:null==(b=N(y.user,y.pageSourceUrl,g.mapId,g.activityId))?void 0:b.headerId}});case K:return Object(x.a)(Object(x.a)({},y),{},{editorView:Object(x.a)(Object(x.a)({},y.editorView),{},{state:"saving"})});case Y:var b=y.maps[y.editorView.currentMapId],k=y.editorView.currentActivityId,k=g.finished?(k=k,I=[(v=b).activities[k]],v=v.activities[k].next.filter(U),I.concat(v)):[],I=k.find(U),O=I&&(null==(v=y.user.mapProgress[y.pageSourceUrl])||null==(O=v[b.mapId])?void 0:O.activityState[I.activityId]);return Object(x.a)(Object(x.a)({},y),{},{selectedItem:I&&!O?{mapId:b.mapId,activityId:I.activityId}:y.selectedItem,editorView:void 0,user:g.finished?(l=y.user,u=y.pageSourceUrl,d=b,O=k.map(function(e){return e.activityId}),h=d.mapId,m=!1,f={},O.forEach(function(e){var t=N(l,u,h,e);m=m||U(d.activities[e])&&!(null!=t&&t.isCompleted),f[e]=t||{isCompleted:!0,activityId:e,headerId:"",currentStep:0},f[e].isCompleted=!0,f[e].completedTime=Date.now()}),O=(null==(O=l.mapProgress)?void 0:O[u])||{},Object(x.a)(Object(x.a)({},l),{},{mapProgress:Object(x.a)(Object(x.a)({},l.mapProgress),{},Object(j.a)({},u,Object(x.a)(Object(x.a)({},O),{},Object(j.a)({},h,Object(x.a)(Object(x.a)({},(null==O?void 0:O[h])||{mapId:h}),{},{activityState:Object(x.a)(Object(x.a)({},(null==O||null==(p=O[h])?void 0:p.activityState)||{}),f),completionState:m?"transitioning":null==O||null==(p=O[h])?void 0:p.completionState})))))})):y.user});case $:return Object(x.a)(Object(x.a)({},y),{},{modal:void 0,editorView:{state:"active",currentMapId:g.mapId,currentActivityId:g.activityId,allowCodeCarryover:!!g.carryoverCode,previousHeaderId:g.previousHeaderId},user:We(y.user,y.pageSourceUrl,y.maps[g.mapId],g.activityId)});case z:var S=(null==(k=y.editorView)?void 0:k.currentActivityId)===g.activityId&&(null==(p=y.editorView)?void 0:p.currentMapId)===g.mapId;return Object(x.a)(Object(x.a)({},y),{},{editorView:S?Object(x.a)(Object(x.a)({},y.editorView),{},{currentHeaderId:g.id}):y.editorView,user:We(y.user,y.pageSourceUrl,y.maps[g.mapId],g.activityId,g.id,g.currentStep,g.maxSteps,g.isCompleted)});case Q:var w=y.pageSourceUrl,C=(S=g.user,e=pxt.skillmap.USER_VERSION,t=w,a=y.maps,i=pxt.semver.parse(S.version||"0.0.0"),e=pxt.semver.parse(e),s=S,0!==pxt.semver.cmp(i,e)&&0===pxt.semver.cmp(i,pxt.semver.parse("0.0.0"))&&0<(null==(e=(null==S?void 0:S.mapProgress)&&Object.keys(null==S?void 0:S.mapProgress))?void 0:e.length)&&S.mapProgress[e[0]].activityState&&(r=S,n={},Object.keys(a).forEach(function(e){r.mapProgress[e]&&(n[e]=r.mapProgress[e])}),s=Object(x.a)(Object(x.a)({},r),{},{mapProgress:Object(j.a)({},t,n)})),s);return y.alternateSourceUrls&&(c=C,i=w,e=y.alternateSourceUrls,C=0===e.length?c:(o=c.mapProgress[i]||{},e.forEach(function(e){var e=we(e),t=e.cmd,a=e.arg,r=a;switch(t){case"github":var n=pxt.github.parseRepoId(a),n=n&&Ae(n),r=(null==n?void 0:n.identifier)||a;break;case"docs":r=Ee(a)}var i=c.mapProgress[r];i&&Object.keys(i).forEach(function(t){var a;o[t]?(a=i[t].activityState,Object.keys(a).forEach(function(e){o[t].activityState[e]||(o[t].activityState[e]=a[e])})):o[t]=i[t]})}),Object(x.a)(Object(x.a)({},c),{},{mapProgress:Object(x.a)(Object(x.a)({},c.mapProgress),{},Object(j.a)({},i,o))}))),C.mapProgress[w]||(C.mapProgress[w]={}),Object.keys(y.maps).forEach(function(e){C.mapProgress[w][e]||(C.mapProgress[w][e]={completionState:"incomplete",mapId:e,activityState:{}})}),Object(x.a)(Object(x.a)({},y),{},{user:C});case X:return pxt.storage.removeLocal(y.pageSourceUrl+Se),Object(x.a)(Object(x.a)({},y),{},{user:Object(x.a)(Object(x.a)({},y.user),{},{completedTags:Object(x.a)(Object(x.a)({},y.user.completedTags),{},Object(j.a)({},y.pageSourceUrl,{})),mapProgress:Object(x.a)(Object(x.a)({},y.user.mapProgress),{},Object(j.a)({},y.pageSourceUrl,{}))})});case J:return y.pageSourceUrl?Object(x.a)(Object(x.a)({},y),{},{user:Object(x.a)(Object(x.a)({},y.user),{},{completedTags:Object(x.a)(Object(x.a)({},y.user.completedTags),{},Object(j.a)({},y.pageSourceUrl,function(e,t,a){var r,n={},i=Object(E.a)(a);try{for(i.s();!(r=i.n()).done;)for(var c=r.value,o=0,s=Object.keys(c.activities);o<s.length;o++){var l=s[o],u=c.activities[l];if(A(e,t,c.mapId,u.activityId)&&"activity"===u.kind){var d,p=Object(E.a)(u.tags);try{for(p.s();!(d=p.n()).done;){var h=d.value;n[h]||(n[h]=0),n[h]++}}catch(e){p.e(e)}finally{p.f()}}}}catch(e){i.e(e)}finally{i.f()}return n}(y.user,y.pageSourceUrl,Object.keys(y.maps).map(function(e){return y.maps[e]}))))})}):y;case ke:return Object(x.a)(Object(x.a)({},y),{},{shareState:g.headerId||g.url?{headerId:g.headerId,url:g.url}:void 0});case Ie:return Object(x.a)(Object(x.a)({},y),{},{cloudState:Object(x.a)(Object(x.a)({},y.cloudState),{},Object(j.a)({},g.headerId,g.status))});case Z:return Object(x.a)(Object(x.a)({},y),{},{title:g.title});case ee:return Object(x.a)(Object(x.a)({},y),{},{description:g.description});case te:return Object(x.a)(Object(x.a)({},y),{},{infoUrl:g.infoUrl});case ae:return Object(x.a)(Object(x.a)({},y),{},{backgroundImageUrl:g.backgroundImageUrl});case re:return Object(x.a)(Object(x.a)({},y),{},{bannerImageUrl:g.bannerImageUrl});case ne:return Object(x.a)(Object(x.a)({},y),{},{theme:g.theme});case ie:return Object(x.a)(Object(x.a)({},y),{},{pageSourceUrl:g.url,pageSourceStatus:g.status});case ce:return Object(x.a)(Object(x.a)({},y),{},{alternateSourceUrls:g.urls});case oe:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"completion",currentMapId:g.mapId,currentActivityId:g.activityId}});case ue:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"carryover",currentMapId:g.mapId,currentActivityId:g.activityId}});case se:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"restart-warning",currentMapId:g.mapId,currentActivityId:g.activityId}});case"SHOW_REPORT_ABUSE_MODAL":return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"report-abuse",currentMapId:g.mapId,currentActivityId:g.activityId}});case le:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"reset"}});case de:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"share",currentMapId:g.mapId,currentActivityId:g.activityId}});case pe:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"login"}});case he:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"login-prompt"}});case me:return Object(x.a)(Object(x.a)({},y),{},{modal:{type:"delete-account"}});case ge:return Object(x.a)(Object(x.a)({},y),{},{showProfile:!0});case be:return Object(x.a)(Object(x.a)({},y),{},{showProfile:!1});case fe:return Object(x.a)(Object(x.a)({},y),{},{modal:void 0});case ve:return Object(x.a)(Object(x.a)({},y),{},{auth:Object(x.a)(Object(x.a)({},y.auth),{},{profile:g.profile,signedIn:!(null==(a=g.profile)||!a.id)})});case"SET_USER_PREFERENCES":return Object(x.a)(Object(x.a)({},y),{},{auth:Object(x.a)(Object(x.a)({},y.auth),{},{preferences:g.preferences})});case ye:return Object(x.a)(Object(x.a)({},y),{},{auth:Object(x.a)(Object(x.a)({},y.auth),{},{signedIn:!1})});case Oe:return Object(x.a)(Object(x.a)({},y),{},{readyResources:g.resources});default:return y}}),s=e(4),r=e(5),a=e(7),n=e(6),Ze=e(29),et=e(12);function tt(){return Xe||(Je=new pxt.skillmap.IndexedDBWorkspace,Xe=Je.initAsync().then(function(e){return Je})),Xe}function at(){return rt.apply(this,arguments)}function rt(){return(rt=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tt();case 2:return t=e.sent,e.next=5,t.getUserStateAsync();case 5:return t=(t=e.sent)||{id:Pe(),completedTags:{},mapProgress:{},version:pxt.skillmap.USER_VERSION},e.abrupt("return",t);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function nt(){return it.apply(this,arguments)}function it(){return(it=Object(p.a)(C.a.mark(function e(){var t,a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,at();case 2:return t=e.sent,e.next=5,ft();case 5:if(e.sent)return e.next=8,function(){return It.apply(this,arguments)}();e.next=10;break;case 8:a=e.sent,t=Object(x.a)(Object(x.a)({},t),{},{mapProgress:(null==a?void 0:a.mapProgress)||{},completedTags:(null==a?void 0:a.completedTags)||{}});case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ct(){return ot.apply(this,arguments)}function ot(){return(ot=Object(p.a)(C.a.mark(function e(t){var a,r;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isDebug)return e.abrupt("return");e.next=2;break;case 2:return e.next=4,tt();case 4:return r=e.sent,e.next=7,null==(a=pxt.auth.client())?void 0:a.loggedInAsync();case 7:if(e.sent){e.next=10;break}return e.next=10,r.saveUserStateAsync(t);case 10:return e.next=12,function(){return kt.apply(this,arguments)}({mapProgress:t.mapProgress,completedTags:t.completedTags});case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}u=pxt.auth.AuthClient,Object(a.a)(i,u),dt=Object(n.a)(i),Object(r.a)(i,[{key:"onSignedIn",value:function(){return Promise.resolve()}},{key:"onSignedOut",value:function(){return M.dispatch({type:ye}),Promise.resolve()}},{key:"onSignInFailed",value:function(){return Promise.resolve()}},{key:"onUserProfileChanged",value:function(){var e=this.getState();return e.profile&&pxt.auth.generateUserProfilePicDataUrl(e.profile),M.dispatch((e=e.profile,{type:ve,profile:e})),Promise.resolve()}},{key:"onUserPreferencesChanged",value:function(e){return Promise.resolve()}},{key:"onStateCleared",value:function(){return Promise.resolve()}},{key:"onProfileDeleted",value:(ut=Object(p.a)(C.a.mark(function e(t){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=M.getState(),e.next=3,null==(a=a.readyResources)?void 0:a.exportCloudProjectsToLocal(t);case 3:case"end":return e.stop()}},e)})),function(e){return ut.apply(this,arguments)})},{key:"onApiError",value:function(e){return Promise.resolve()}},{key:"logoutAsync",value:(lt=Object(p.a)(C.a.mark(function e(t){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=M.getState(),a=a.user,e.next=4,ct(a);case 4:Object(Ze.a)(Object(et.a)(i.prototype),"logoutAsync",this).call(this,t);case 5:case"end":return e.stop()}},e,this)})),function(e){return lt.apply(this,arguments)})}]);var st,lt,ut,dt,pt=i;function i(){return Object(s.a)(this,i),dt.apply(this,arguments)}function l(){return ht.apply(this,arguments)}function ht(){return(ht=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(pxt.auth.hasIdentity()){e.next=2;break}return e.abrupt("return",void 0);case 2:if(st)return e.abrupt("return",st);e.next=4;break;case 4:return st=new Promise(function(){var a=Object(p.a)(C.a.mark(function e(t,a){var r;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new pt,e.next=3,r.initAsync();case 3:return e.next=5,r.authCheckAsync();case 5:return e.next=7,r.initialUserPreferencesAsync();case 7:t(r);case 8:case"end":return e.stop()}},e)}));return function(e,t){return a.apply(this,arguments)}}()),e.abrupt("return",st);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function mt(){return(mt=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:return t=e.sent,e.next=5,null==t?void 0:t.authCheckAsync();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ft(){return vt.apply(this,arguments)}function vt(){return(vt=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:return t=e.sent,e.next=5,null==t?void 0:t.loggedInAsync();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function yt(){return(yt=Object(p.a)(C.a.mark(function e(t){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.auth.loginCallbackAsync(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function gt(){return bt.apply(this,arguments)}function bt(){return(bt=Object(p.a)(C.a.mark(function e(t){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:return a=e.sent,e.next=5,null==a?void 0:a.logoutAsync(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kt(){return(kt=Object(p.a)(C.a.mark(function e(t){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:return a=e.sent,e.next=5,null==a?void 0:a.patchUserPreferencesAsync({op:"replace",path:["skillmap"],value:t});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function It(){return(It=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:if(t=e.sent)return e.next=6,t.userPreferencesAsync();e.next=8;break;case 6:return t=e.sent,e.abrupt("return",null==t?void 0:t.skillmap);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}e(41);u=f.Component,Object(a.a)(g,u),Et=Object(n.a)(g),Object(r.a)(g,[{key:"getItemOnClick",value:function(e){return function(){return e.onClick(e.id)}}},{key:"render",value:function(){var a=this,e=this.props,t=e.icon,r=e.picture,n=e.items,e=e.className,i=this.state.expanded;return f.createElement("div",{className:"dropdown ".concat(e," ").concat(i?"expanded":""),tabIndex:0,role:"button",onClick:this.handleOnClick,onBlur:this.handleOnBlur},r||f.createElement("i",{className:"icon ".concat(t)}),i&&f.createElement("div",{className:"dropdown-menu"},n.map(function(e,t){return f.createElement("div",{key:t,className:"dropdown-item",onClick:a.getItemOnClick(e),role:"menuitem"},e.label)})))}}]);var Ot,St,wt,Ct,jt,xt,Et,At=g,u=(u=f.Component,Object(a.a)(y,u),xt=Object(n.a)(y),Object(r.a)(y,[{key:"getSettingItems",value:function(){var t=this,e=[];return this.props.showReportAbuse&&e.push({id:"report",label:lf("Report Abuse"),onClick:function(e){m("skillmap.reportabuse"),window.open(t.reportAbuseUrl)}}),this.props.activityOpen||e.push({id:"reset",label:lf("Reset All"),onClick:function(){m("skillmap.reset.warning"),t.props.dispatchShowResetUserModal()}}),e}},{key:"getOrganizationLogo",value:function(e){var t=e.organizationWideLogo;return f.createElement("div",{className:"header-logo"},t?f.createElement("img",{src:o()?"./assets/".concat(t):t,alt:lf("{0} Logo",e.organization)}):f.createElement("span",{className:"name"},e.organization))}},{key:"getTargetLogo",value:function(e){var t=this.props.activityOpen;return f.createElement("div",{className:"ui item logo brand ".concat(t?"":"noclick")},e.useTextLogo?[f.createElement("span",{className:"name",key:"org-name",onClick:this.onBackClicked},e.organizationText),f.createElement("span",{className:"name-short",key:"org-name-short",onClick:this.onBackClicked},e.organizationShortText||e.organizationText)]:e.logo||e.portraitLogo?f.createElement("img",{className:"logo",src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):f.createElement("span",{className:"name"}," ",e.boardName))}},{key:"getHelpItems",value:function(){var e=[];return this.props.activityOpen&&e.push({id:"feedback",label:lf("Feedback"),onClick:this.onBugClicked}),e}},{key:"getUserMenu",value:function(){var e=this,t=this.props,a=t.signedIn,t=t.profile,r=[],n=(a&&r.push({id:"profile",label:lf("My Profile"),onClick:this.onProfileClicked},{id:"signout",label:lf("Sign Out"),onClick:this.onLogoutClicked}),null!=t&&null!=(n=t.idp)&&null!=(n=n.picture)&&n.dataUrl?f.createElement("div",{className:"avatar"},f.createElement("img",{src:null==t||null==(n=t.idp)||null==(n=n.picture)?void 0:n.dataUrl,alt:lf("User Menu")})):void 0),t=f.createElement("span",{className:"circle"},pxt.auth.userInitials(t));return f.createElement("div",{className:"user-menu"},a?f.createElement(At,{icon:"user",items:r,picture:n||t,className:"header-dropdown"}):f.createElement(Nt,{className:"sign-in",icon:"xicon cloud-user",title:lf("Sign In"),label:lf("Sign In"),onClick:function(){pxt.tickEvent("skillmap.usermenu.signin"),e.props.dispatchShowLoginModal()}}))}},{key:"render",value:function(){var e=this.props.activityOpen,t=pxt.auth.hasIdentity(),a=null==(a=pxt.appTarget)?void 0:a.appTheme,r=this.getSettingItems(),n=this.getHelpItems();return f.createElement("div",{className:"header"},f.createElement("div",{className:"header-left"},this.getOrganizationLogo(a),this.getTargetLogo(a)),f.createElement("div",{className:"spacer"}),f.createElement("div",{className:"header-right"},e&&f.createElement(Nt,{icon:"icon arrow left",title:lf("Return to activity selection"),onClick:this.onBackClicked}),f.createElement(Nt,{icon:"icon home",title:lf("Return to the editor homepage"),onClick:this.onHomeClicked}),0<(null==n?void 0:n.length)&&f.createElement(At,{icon:"help circle",className:"header-dropdown",items:n}),0<(null==r?void 0:r.length)&&f.createElement(At,{icon:"setting",className:"header-dropdown",items:r}),t&&this.getUserMenu()))}}]),y),Nt=function(e){var t=e.icon,a=e.label,r=e.title,n=e.onClick,e=e.className;return f.createElement("div",{className:"header-button ".concat(a?"with-label":"icon-only"," ").concat(e),title:r,role:"button",onClick:n},f.createElement("i",{className:t}),a&&f.createElement("span",{className:"header-button-label"},a))},d={dispatchSaveAndCloseActivity:ze,dispatchShowResetUserModal:function(){return{type:le}},dispatchShowLoginModal:Ke,dispatchShowUserProfile:function(){return{type:ge}}},Ut=Object(t.b)(function(e,t){if(!e)return{};null!=(r=e.editorView)&&r.currentHeaderId&&A(e.user,e.pageSourceUrl,e.editorView.currentMapId,e.editorView.currentActivityId)&&e.editorView.currentHeaderId;var a,r=!!e.editorView;return null==(a=e.editorView)||!a.currentActivityId||null!=(a=e.maps[e.editorView.currentMapId])&&a.activities[e.editorView.currentActivityId],{activityOpen:r,currentMapId:r&&(null==(a=e.editorView)?void 0:a.currentMapId),currentActivityId:r&&(null==(a=e.editorView)?void 0:a.currentActivityId),showReportAbuse:"unknown"===e.pageSourceStatus,signedIn:e.auth.signedIn,profile:e.auth.profile}},d)(u),v=(e(42),o()?"http://localhost:3232/index.html":(d=window.pxtTargetBundle.appTheme.embedUrl,!pxt.webConfig&&window.pxtConfig&&pxt.setupWebConfig(window.pxtConfig),null!=(u=pxt.webConfig)&&u.targetUrl&&null!=(u=pxt.webConfig)&&u.relprefix?pxt.webConfig.targetUrl+pxt.webConfig.relprefix.substr(0,pxt.webConfig.relprefix.length-3):(u=/\/([\da-zA-Z\.]+)(?:--)?/i.exec(window.location.pathname),"".concat(d.replace(/\/$/,""),"/").concat((null==u?void 0:u[1])||"")))),u=(d=f.Component,Object(a.a)(h,d),jt=Object(n.a)(h),Object(r.a)(h,[{key:"componentDidUpdate",value:(Ct=Object(p.a)(C.a.mark(function e(){var t,a,r,n=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.shareHeaderId,r=this.state,a=r.frameState,r=r.pendingShare,"project-open"===a&&this.props.save?this.setState({frameState:"closing-project"},Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.closeActivityAsync();case 2:case"end":return e.stop()}},e)}))):"no-project"===a&&this.props.activityId&&this.setState({frameState:"opening-project",loadPercent:0},Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.startActivityAsync();case 2:case"end":return e.stop()}},e)}))),t&&!r&&this.setState({pendingShare:!0},Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.shareProjectAsync();case 2:case"end":return e.stop()}},e)})));case 4:case"end":return e.stop()}},e,this)})),function(){return Ct.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onMessageReceived),Pt(".usabilla_live_button_container",!0),Pt("footer",!0);var e=document.getElementById("root");e&&pxt.BrowserUtils.removeClass(e,"editor")}},{key:"render",value:function(){var e=this.props,t=e.title,e=e.activityId,a=this.state,r=a.frameState,a=a.loadPercent,n=lf("Loading..."),i="opening-project"===r,r=i||"closing-project"===r,c=v;return"/"!==v.charAt(v.length-1)||o()||(c=v.substr(0,v.length-1)),c+="?controller=1&skillsMap=1&noproject=1&nocookiebanner=1&ws=browser",f.createElement("div",{className:"makecode-frame-outer",style:{display:e?"block":"none"}},f.createElement("div",{className:"makecode-frame-loader ".concat(r?"":"hidden")},f.createElement("img",{src:Me("assets/logo.svg"),alt:"MakeCode Logo"}),i&&f.createElement("div",{className:"makecode-frame-loader-bar"},f.createElement("div",{className:"makecode-frame-loader-fill",style:{width:a+"%"}})),f.createElement("div",{className:"makecode-frame-loader-text"},n)),f.createElement("iframe",{className:"makecode-frame",src:c,title:t,ref:this.handleFrameRef}))}},{key:"sendMessageAsync",value:function(a){var r=this;return new Promise(function(t){function e(e){e.response=!0,e.id=r.nextId+++"",r.pendingMessages[e.id]={original:e,handler:t},r.ref.contentWindow.postMessage(e,"*")}if(r.ref)if(r.ref.contentWindow){for(;r.messageQueue.length;)e(r.messageQueue.shift());e(a)}else r.messageQueue.push(a)})}},{key:"startActivityAsync",value:(wt=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.activityHeaderId)return e.next=3,this.sendMessageAsync({type:"pxteditor",action:"openheader",headerId:this.props.activityHeaderId});e.next=5;break;case 3:e.next=8;break;case 5:return this.isNewActivity=!0,e.next=8,this.sendMessageAsync({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,title:this.props.title,activityType:"tutorial",carryoverPreviousCode:this.props.carryoverCode,previousProjectHeaderId:this.props.previousHeaderId});case 8:case"end":return e.stop()}},e,this)})),function(){return wt.apply(this,arguments)})},{key:"closeActivityAsync",value:(St=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendMessageAsync({type:"pxteditor",action:"saveproject"});case 2:return this.props.dispatchCloseActivity("finished"===this.finishedActivityState),this.props.dispatchUpdateUserCompletedTags(),this.finishedActivityState=void 0,e.next=7,this.sendMessageAsync({type:"pxteditor",action:"unloadproject"});case 7:this.setState({frameState:"no-project"});case 8:case"end":return e.stop()}},e,this)})),function(){return St.apply(this,arguments)})},{key:"shareProjectAsync",value:(Ot=Object(p.a)(C.a.mark(function e(){var t,a,r;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props,t=a.shareHeaderId,a=a.dispatchSetShareStatus,e.next=3,this.sendMessageAsync({type:"pxteditor",action:"shareproject",headerId:t});case 3:r=e.sent,a(t,r.resp.shortid),this.setState({pendingShare:!1});case 6:case"end":return e.stop()}},e,this)})),function(){return Ot.apply(this,arguments)})},{key:"handleTutorialEvent",value:function(e){var t=this.props,a=t.dispatchSetHeaderIdForActivity,r=t.dispatchSaveAndCloseActivity,n=t.mapId,i=t.activityId,c=t.progress;switch(e.tutorialEvent){case"progress":i&&a(n,i,e.projectHeaderId,e.currentStep+1,e.totalSteps,e.isCompleted||!(null==c||!c.isCompleted));break;case"loaded":this.onEditorLoaded();break;case"completed":this.onTutorialFinished();break;case"exit":r()}}},{key:"onEditorLoaded",value:function(){var e=this.props,t=e.mapId,e=e.activityId;t&&e&&(m("skillmap.activity.loaded",{path:t,activity:e}),this.setState({frameState:"project-open"}),this.isNewActivity)&&(this.isNewActivity=!1)}},{key:"onTutorialFinished",value:function(){var e=this.props,t=e.mapId,a=e.activityId,r=e.signedIn,e=e.pageSourceUrl,t=(m("skillmap.activity.complete",{path:t,activity:a}),this.finishedActivityState="finished",this.props.dispatchSaveAndCloseActivity(),pxt.storage.getLocal(e+Se));r||t||(this.props.dispatchShowLoginPrompt(),pxt.storage.setLocal(e+Se,"true"))}}]),h);function h(e){var a;return Object(s.a)(this,h),(a=jt.call(this,e)).ref=void 0,a.messageQueue=[],a.finishedActivityState=void 0,a.nextId=0,a.pendingMessages={},a.isNewActivity=!1,a.handleFrameRef=function(e){e&&e.contentWindow&&(window.addEventListener("message",a.onMessageReceived),e.addEventListener("load",a.handleFrameReload),a.ref=e,Pt(".usabilla_live_button_container",!1),Pt("footer",!1),(e=document.getElementById("root"))&&pxt.BrowserUtils.addClass(e,"editor"),a.props.onFrameLoaded(function(e){return a.sendMessageAsync(e)}))},a.handleFrameReload=function(){a.setState({frameState:"loading"})},a.onMessageReceived=function(e){var t=e.data;if("opening-project"===a.state.frameState&&a.setState({loadPercent:Math.min((a.state.loadPercent||0)+4,95)}),"pxteditor"===t.type&&t.id&&a.pendingMessages[t.id])a.pendingMessages[t.id].handler(t),delete a.pendingMessages[t.id];else switch(t.action){case"newproject":"loading"===a.state.frameState&&a.setState({frameState:"no-project"});break;case"tutorialevent":a.handleTutorialEvent(t);break;case"projectcloudstatus":a.props.dispatchSetCloudStatus(t.headerId,t.status)}},a.state={frameState:"loading",workspaceReady:!1,loadPercent:0,pendingShare:!1},a}function y(){var t;Object(s.a)(this,y);for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(t=xt.call.apply(xt,[this].concat(a))).reportAbuseUrl="https://github.com/contact/report-content",t.onBackClicked=function(){var e=t.props;m("skillmap.activity.back",{path:e.currentMapId||"",activity:e.currentActivityId||""}),t.props.dispatchSaveAndCloseActivity()},t.onHomeClicked=function(){m("skillmap.home");var e,t=null==(t=pxt.webConfig)?void 0:t.relprefix.substr(0,pxt.webConfig.relprefix.length-3);pxt.appTarget.appTheme.homeUrl&&t?((null==(e=pxt.appTarget.appTheme.homeUrl)?void 0:e.lastIndexOf("/"))===(null==(e=pxt.appTarget.appTheme.homeUrl)?void 0:e.length)-1&&(t=t.substr(1)),window.open(pxt.appTarget.appTheme.homeUrl+t)):window.open(pxt.appTarget.appTheme.homeUrl)},t.onBugClicked=function(){var e,t;m("skillmap.bugreport"),null!=(e=(t=window).usabilla_live)&&e.call(t,"click")},t.onLogoutClicked=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return pxt.tickEvent("skillmap.usermenu.signout"),e.next=3,gt(location.hash);case 3:case"end":return e.stop()}},e)})),t.onProfileClicked=function(){pxt.tickEvent("skillmap.profile"),t.props.dispatchShowUserProfile()},t}function g(e){var t;return Object(s.a)(this,g),(t=Et.call(this,e)).handleOnClick=function(){t.setState({expanded:!t.state.expanded})},t.handleOnBlur=function(){t.setState({expanded:!1})},t.state={expanded:!1},t}function Pt(e,t){e=document.querySelector(e);null!=e&&e.style&&(e.style.display=t?"":"none")}var Mt,Tt,Lt,Rt,_t,d={dispatchSetHeaderIdForActivity:function(e,t,a,r,n,i){return{type:z,mapId:e,activityId:t,id:a,currentStep:r,maxSteps:n,isCompleted:i}},dispatchCloseActivity:function(){return{type:Y,finished:0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},dispatchSaveAndCloseActivity:ze,dispatchUpdateUserCompletedTags:function(){return{type:J}},dispatchSetShareStatus:Qe,dispatchShowLoginPrompt:function(){return{type:he}},dispatchSetCloudStatus:function(e,t){return{type:Ie,headerId:e,status:t}}},Ht=Object(t.b)(function(e,t){var a,r,n,i,c,o,s,l,u,d=null!=(d=e.shareState)&&d.url||null==(d=e.shareState)?void 0:d.headerId;return e&&e.editorView?(a=(o=e.editorView).currentActivityId,r=o.currentMapId,n=o.currentHeaderId,i=o.state,c=o.allowCodeCarryover,o=o.previousHeaderId,l=null==(s=null==(s=e.maps[r])?void 0:s.activities[a])?void 0:s.displayName,u=N(e.user,e.pageSourceUrl,r,a),{tutorialPath:s.url,title:l,mapId:r,activityId:a,activityHeaderId:n,activityType:s.type,carryoverCode:c,previousHeaderId:o,progress:u,save:"saving"===i,shareHeaderId:d,signedIn:e.auth.signedIn,pageSourceUrl:e.pageSourceUrl}):{shareHeaderId:d}},d)(u),b=(e(43),d=f.Component,Object(a.a)(w,d),_t=Object(n.a)(w),Object(r.a)(w,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions,r=e.className,e=e.fullscreen;return f.createElement("div",{className:"modal-overlay ".concat(r||""," ").concat(e&&"fullscreen"),onClick:this.handleCloseClick,role:"region"},f.createElement("div",{className:"modal",onClick:this.handleModalClick,role:"dialog"},f.createElement("div",{className:"modal-header"},e&&f.createElement("div",{className:"close button",onClick:this.handleCloseClick},f.createElement("i",{className:"icon arrow left"}),lf("Go Back")),f.createElement("div",{className:"modal-title"},t),!e&&f.createElement("div",{className:"spacer"}),!e&&f.createElement("div",{className:"modal-close-icon",onClick:this.handleCloseClick,role:"button"},f.createElement("i",{className:"icon close"}))),f.createElement("div",{className:"modal-body"},this.props.children),a&&0<a.length&&f.createElement("div",{className:"modal-actions"},a.map(function(e,t){return e.url?f.createElement("a",{key:t,className:"modal-button ".concat(e.className||""),href:e.url,onClick:e.onClick,target:"_blank",rel:"noopener noreferrer",role:"button"},e.label):f.createElement("div",{key:t,className:"modal-button ".concat(e.className||""),onClick:e.onClick,role:"button"},e.label)}))))}}]),w),d=(u=f.Component,Object(a.a)(S,u),Rt=Object(n.a)(S),Object(r.a)(S,[{key:"render",value:function(){var e=this.props,t=e.activity;switch(e.type){case"completion":return t?this.renderCompletionModal():f.createElement("div",null);case"restart-warning":return t?this.renderRestartWarning():f.createElement("div",null);case"report-abuse":return this.renderReportAbuse();case"reset":return this.renderResetWarning();case"carryover":return this.renderCodeCarryoverModal();case"share":return this.renderShareModal();case"login":return this.renderLoginModal(!1);case"login-prompt":return this.renderLoginModal(!0);case"delete-account":return this.renderDeleteAccountModal();default:return f.createElement("div",null)}}},{key:"getCompletionActionText",value:function(e){switch(e.kind){case"activity":return lf("Start Activity");case"map":return lf("Start Skill Map");case"editor":return lf("Keep Building");default:return lf("Learn More")}}},{key:"getCompletionActions",value:function(e){var n=this,t=this.props,i=t.userState,c=t.pageSourceUrl,o=t.mapId,s=t.skillMap,l=t.activity,u=t.dispatchOpenActivity,d=t.dispatchShowCarryoverModal,p=l,h=[];return null!=e&&e.forEach(function(e){var t={label:e.label||n.getCompletionActionText(e),url:e.url};switch(e.kind){case"activity":var a=null==s?void 0:s.activities[e.activityId||""];a&&(t.onClick=function(){m("skillmap.reward.action.activity",{path:o,activity:p.activityId,nextActivityId:a.activityId}),n.handleOnClose(),Fe(i,c,s,a)?d(s.mapId,a.activityId):u(o,a.activityId)},h.push(t));break;case"editor":var r=De(i,c,s,l.activityId);null!=r&&r.headerId&&(t.onClick=function(){m("skillmap.reward.action.editor",{path:o,activity:p.activityId}),window.open("".concat(v,"#skillmapimport:").concat(r.headerId))},h.push(t));break;default:t.onClick=function(){return m("skillmap.reward.action.".concat(e.kind),{path:o,activity:p.activityId,url:t.url||""})},h.push(t)}}),h}},{key:"renderCompletionModal",value:function(){var e,t=this.props,a=t.skillMap,r=t.type,t=t.activity;return r&&a?(r=t,t=lf("You Did It!"),e=lf("Congratulations on completing {0}. Take some time to explore any activities you missed, or reset your progress to try again. But first, be sure to claim your reward using the button below.","{0}").split("{0}"),f.createElement("div",{className:"confetti-container"},f.createElement(b,{title:t,actions:this.getCompletionActions(r.actions),className:"completion",onClose:this.handleOnClose},e[0],f.createElement("strong",null,a.displayName),e[1],f.createElement("div",{className:"completion-reward",onClick:this.handleRewardClick},f.createElement("i",{className:"icon gift"}),f.createElement("span",null,lf("Claim your reward!")))),Array(100).fill(0).map(function(e,t){var a={animationDelay:"".concat(t%100*.1,"s"),left:"".concat(+Math.floor(100*Math.random()),"%")};return f.createElement("div",{key:t,style:a,className:"confetti ".concat(.5<Math.random()?"reverse":""," color-").concat(Math.floor(9*Math.random()))})}))):f.createElement("div",null)}},{key:"renderRestartWarning",value:function(){var e=this.props,t=e.mapId,a=e.activity,r=e.dispatchRestartActivity,n=e.showCodeCarryoverModal,i=e.dispatchShowCarryoverModal,e=lf("Restart Activity?"),c=lf("Are you sure you want to restart {0}? You won't lose your path progress but the code you have written for this activity will be deleted.","{0}").split("{0}"),o=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESTART"),onClick:function(){m("skillmap.activity.restart",{path:t,activity:a.activityId}),(n?i:r)(t,a.activityId)}}];return f.createElement(b,{title:e,actions:o,onClose:this.handleOnClose},c[0],f.createElement("strong",null,a.displayName),c[1])}},{key:"renderResetWarning",value:function(){var e=this.props,t=e.dispatchResetUser,a=e.dispatchHideModal,e=lf("Reset All Activities?"),r=lf("Are you sure you want to reset? This will permanently erase all progress and delete the project created for each tutorial. This action cannot be undone."),n=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESET"),onClick:function(){m("skillmap.reset"),t(),a()}}];return f.createElement(b,{title:e,actions:n,onClose:this.handleOnClose},r)}},{key:"renderReportAbuse",value:function(){var e=this.props,t=e.pageSourceUrl,a=e.dispatchHideModal;return f.createElement(b,{title:"Report Abuse",actions:[{label:"REPORT",onClick:function(){m("skillmap.reportabuse"),function(){Ne.apply(this,arguments)}(t||"",{text:document.querySelector(".report-abuse-text").value}),a()}}],onClose:this.handleOnClose},f.createElement("textarea",{className:"report-abuse-text",placeholder:"Describe the content and explain why you are reporting it for abuse. Provide as much detail as possible!"}))}},{key:"renderCodeCarryoverModal",value:function(){var e,t,a=this.props,r=a.skillMap,n=a.activity,i=a.pageSourceUrl,c=a.userState,o=a.dispatchHideModal,s=a.dispatchRestartActivity,a=lf("Keep code from previous activity?"),l=lf("Do you want to start with your code from {0} or start fresh with starter code? Your images, tilemaps, tiles, and animations will stick around either way.").split("{0}"),u=De(c,i,r,n.activityId),d=r.activities[null==u?void 0:u.activityId];return d?(c=[{label:lf("START FRESH"),onClick:(t=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:m("skillmap.startfresh",{path:r.mapId,activity:n.activityId,previousActivity:d.activityId}),s(r.mapId,n.activityId,u.headerId,!1),o();case 3:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{label:lf("KEEP CODE"),onClick:(e=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:m("skillmap.keepcode",{path:r.mapId,activity:n.activityId,previousActivity:d.activityId}),s(r.mapId,n.activityId,u.headerId,!0),o();case 3:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})}],f.createElement(b,{title:a,actions:c,onClose:this.handleOnClose},l[0],f.createElement("strong",null,d.displayName),l[1])):f.createElement("div",null)}},{key:"renderShareModal",value:function(){var e,a=this,t=this.props,r=t.userState,n=t.pageSourceUrl,i=t.mapId,c=t.activity,o=t.shareState,s=t.dispatchSetShareStatus,t=this.state.loading,o=null==o?void 0:o.url,l=o?lf("Share Project"):lf("Publish Project"),u=[];return o||(u.push({label:lf("Cancel"),onClick:function(){return a.handleOnClose}}),u.push({label:lf("Publish"),onClick:(e=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:m("skillmap.share",{path:i,activity:c.activityId}),a.setState({loading:!0}),t=N(r,n,i,c.activityId),s(null==t?void 0:t.headerId);case 4:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})})),f.createElement(b,{title:l,actions:u,onClose:this.handleOnClose},o?f.createElement("div",null,lf("Your project is ready! Use the address below to share your projects.")):f.createElement("div",{className:"share-disclaimer"},lf("You need to publish your project to share it or embed it in other web pages. You acknowledge having consent to publish this project.")),t&&!o&&f.createElement("div",{className:"share-loader"},f.createElement("div",{className:"ui active inline loader"}),f.createElement("span",null,lf("Loading..."))),o&&f.createElement("div",{className:"share-input"},f.createElement("input",{type:"text",readOnly:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,value:"https://makecode.com/".concat(o),onClick:this.handleShareInputClick}),f.createElement("div",{className:"share-copy",onClick:this.handleShareCopyClick,role:"button"},f.createElement("i",{className:"icon copy"}),lf("Copy"))))}},{key:"renderLoginModal",value:function(e){var t,a=this,r=null!=(n=this.state.checkboxSelected)&&n,n=lf("Sign in icon"),i=pxt.auth.identityProvider("microsoft"),c=[];return c.push({label:lf("Sign In"),onClick:(t=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:pxt.tickEvent("skillmap.signindialog.signin",{provider:i.name||"",rememberMe:r.toString()}),pxt.auth.client().loginAsync(i.id,r,{hash:location.hash});case 2:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})}),f.createElement(b,{title:e?lf("Save your Completed Activity"):lf("Sign into MakeCode Arcade"),onClose:this.handleOnClose,actions:c,className:"sign-in"},f.createElement("div",{className:"description"},f.createElement("p",null,lf("Sign in with your Microsoft Account. We'll save your projects to the cloud, where they're accessible from anywhere.")),f.createElement("div",{className:"container"},e&&f.createElement("img",{src:Me("/assets/cloud-user.svg"),alt:n,className:"icon cloud-user"}),f.createElement("p",null,lf("Don't have a Microsoft Account? Start signing in to create one!"),f.createElement("a",{href:"https://aka.ms/cloudsave",target:"_blank",onClick:function(){m("skillmap.signindialog.learn"),window.open("https://aka.ms/cloudsave","_blank")}},f.createElement("i",{className:"icon external alternate"}),lf("Learn more")))),f.createElement("div",{className:"remember",onClick:function(){var e=!r;m("skillmap.signindialog.rememberme",{rememberMe:e.toString()}),a.setState({checkboxSelected:e})}},f.createElement("i",{className:"icon square outline ".concat(r?"check":"")}),lf("Remember me"))))}},{key:"renderDeleteAccountModal",value:function(){var e,t=this,a=this.state.checkboxSelected,r=[];return r.push({label:lf("Confirm"),className:a?"confirm":"confirm disabled",onClick:(e=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a)return m("skillmap.profile.delete"),t.props.dispatchHideModal(),t.props.dispatchCloseUserProfile(),e.next=6,pxt.auth.client().deleteProfileAsync();e.next=7;break;case 6:location.reload();case 7:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})}),r.push({label:lf("Back to safety"),className:"disagree",onClick:this.props.dispatchHideModal}),f.createElement(b,{title:lf("Delete Profile"),className:"delete",actions:r,onClose:this.handleOnClose},f.createElement("div",null," ",lf("Are you sure? This cannot be reversed! Your cloud-saved projects will be converted to local projects on this device.")),f.createElement("div",{className:"confirm-delete checkbox",onClick:function(){t.setState({checkboxSelected:!a})}},f.createElement("i",{className:"icon square outline ".concat(a?"check":"")}),lf("I understand this is permanent. No undo.")))}}]),S),u={dispatchHideModal:function(){return{type:fe}},dispatchRestartActivity:function(e,t,a,r){return{type:$,mapId:e,activityId:t,previousHeaderId:a,carryoverCode:r}},dispatchOpenActivity:Ge,dispatchResetUser:function(){return{type:X}},dispatchShowCarryoverModal:Ye,dispatchCloseUserProfile:$e,dispatchSetShareStatus:Qe},Bt=Object(t.b)(function(e,t){var a,r,n,i,c,o,s;return e?(a=e.pageSourceUrl,r=e.shareState,n=(c=e.modal||{}).currentMapId,i=c.currentActivityId,c=c.type,o=e.editorView?e.maps[e.editorView.currentMapId]:n&&e.maps[n],s=!n||!i||null==(s=e.maps[n])?void 0:s.activities[i],{type:c,pageSourceUrl:a,skillMap:o,userState:e.user,showCodeCarryoverModal:o&&s&&Fe(e.user,e.pageSourceUrl,o,s),mapId:n,activity:n&&i?e.maps[n].activities[i]:void 0,shareState:r}):{}},u)(d),Dt=(e(44),u=f.Component,Object(a.a)(O,u),Lt=Object(n.a)(O),Object(r.a)(O,[{key:"getIcon",value:function(e,t){switch(t){case"reward":return"";case"completion":return"";default:switch(e){case"locked":return"";case"completed":return"";default:return""}}}},{key:"getIconClass",value:function(e,t){switch(t){case"reward":case"completion":return"graph-icon";default:switch(e){case"locked":case"completed":return"graph-icon";default:return"graph-icon-x"}}}},{key:"getNodeMarker",value:function(e,t,a,r){var n=t/50,i=t/576;return"notstarted"!==e?f.createElement("g",null):f.createElement("g",{transform:"translate(".concat(t/2-12*n," ").concat(-t/2-9*n,")")},f.createElement("title",null,lf("Not Started")),f.createElement("g",{transform:"scale(".concat(i/2,")")},f.createElement("path",{fill:a,stroke:r,strokeWidth:"50",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"})))}},{key:"render",value:function(){var e=this.state.hover,t=this.props,a=t.width,r=t.position,n=t.selected,i=t.status,c=t.kind,t=t.theme,o=e?t.unlockedNodeColor:t.unlockedNodeForeground,s=e?t.unlockedNodeForeground:t.unlockedNodeColor,l=("locked"===i?(s=e?t.lockedNodeForeground:t.lockedNodeColor,o=e?t.lockedNodeColor:t.lockedNodeForeground):"activity"!==c?(s=e?t.rewardNodeForeground:t.rewardNodeColor,o=e?t.rewardNodeColor:t.rewardNodeForeground):"completed"===i&&(s=e?t.completedNodeForeground:t.completedNodeColor,o=e?t.completedNodeColor:t.completedNodeForeground),a/8),u=a/12.5;return f.createElement("g",{className:"graph-activity ".concat(n?"selected":""," ").concat(e?"hover":""),transform:"translate(".concat(r.x," ").concat(r.y,")"),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:this.handleRef},n&&("activity"!==c?f.createElement("circle",{className:"highlight",cx:0,cy:0,r:a/2+l,stroke:t.selectedStrokeColor}):f.createElement("rect",{className:"highlight",x:-a/2-l,y:-a/2-l,width:a+2*l,height:a+2*l,rx:a/6,stroke:t.selectedStrokeColor})),"activity"!==c?f.createElement("circle",{cx:0,cy:0,r:a/2,fill:s,stroke:o,strokeWidth:"2"}):f.createElement("rect",{x:-a/2,y:-a/2,width:a,height:a,rx:a/10,fill:s,stroke:o,strokeWidth:"2"}),"activity"===c&&this.getNodeMarker(i,a,t.selectedStrokeColor,t.strokeColor),f.createElement("text",{dy:u,textAnchor:"middle",alignmentBaseline:"middle",dominantBaseline:"middle",fill:o,className:this.getIconClass(i,c)},this.getIcon(i,c)))}}]),O),Ft=(d=f.Component,Object(a.a)(I,d),Tt=Object(n.a)(I),Object(r.a)(I,[{key:"render",value:function(){var t,a,e=this.props,r=e.points,n=e.strokeWidth,e=e.color,i="M 0 0",c="";return r.forEach(function(e){t=e,a&&(i+=" l ".concat(((null==(e=t)?void 0:e.x)||0)-a.x," ").concat(((null==(e=t)?void 0:e.y)||0)-a.y),c=" l ".concat(a.x-((null==(e=t)?void 0:e.x)||0)," ").concat(a.y-((null==(e=t)?void 0:e.y)||0)," ").concat(c)),a=t}),f.createElement("g",{transform:"translate(".concat(r[0].x||0," ").concat(r[0].y||0,")")},f.createElement("path",{stroke:e,strokeWidth:n,d:"".concat(i," ").concat(c)}))}}]),I),d=(u=f.Component,Object(a.a)(k,u),Mt=Object(n.a)(k),Object(r.a)(k,[{key:"componentDidUpdate",value:function(e){"transitioning"===e.completionState&&setTimeout(function(){m("skillmap.graph.reward.auto",{path:e.map.mapId,activity:e.selectedActivityId||""}),e.dispatchSetSkillMapCompleted(e.map.mapId),e.dispatchShowCompletionModal(e.map.mapId,e.selectedActivityId)},400)}},{key:"render",value:function(){var a=this,e=this.props,r=e.unit,t=e.items,n=e.paths,i=e.map,c=e.user,o=e.selectedActivityId,s=e.pageSourceUrl,l=e.theme;return f.createElement("g",{className:"skill-graph"},f.createElement("g",{opacity:l.pathOpacity},n.map(function(e,t){return f.createElement(Ft,{key:"graph-activity-".concat(t),strokeWidth:3*r,color:l.strokeColor,points:e.points})}),n.map(function(e,t){return f.createElement(Ft,{key:"graph-activity-".concat(t),strokeWidth:3*r-4,color:l.pathColor,points:e.points})})),t.map(function(e,t){return f.createElement(Dt,{key:"graph-activity-".concat(t),theme:l,kind:e.activity.kind,activityId:e.activity.activityId,position:e.position,width:5*r,selected:e.activity.activityId===o,onItemSelect:a.onItemSelect,onItemDoubleClick:a.onItemDoubleClick,status:Te(c,s,i,e.activity.activityId).status})}))}}]),k),u={dispatchChangeSelectedItem:function(e,t){return{type:W,mapId:e,activityId:t}},dispatchShowCompletionModal:qe,dispatchSetSkillMapCompleted:function(e){return{type:G,mapId:e}},dispatchOpenActivity:Ge,dispatchShowCarryoverModal:Ye},Vt=Object(t.b)(function(e,t){var a,r;return e?(r=null==(r=e.user)||null==(r=r.mapProgress)?void 0:r[e.pageSourceUrl],{user:e.user,pageSourceUrl:e.pageSourceUrl,theme:e.theme,selectedActivityId:e.selectedItem&&(null==(a=t.map)?void 0:a.mapId)==e.selectedItem.mapId?e.selectedItem.activityId:void 0,completionState:null==r||null==(a=r[t.map.mapId])?void 0:a.completionState}):{}},u)(d),Wt=(e(20),10);function k(e){var u;return Object(s.a)(this,k),(u=Mt.call(this,e)).onItemSelect=function(e,t){var a=u.props,r=a.user,n=a.pageSourceUrl,i=a.map,c=(a.completionState,a.selectedActivityId),o=a.dispatchChangeSelectedItem,a=a.dispatchShowCompletionModal,r=Te(r,n,i,e).status;"completion"===t&&"completed"===r?(m("skillmap.graph.reward.select",{path:i.mapId,activity:e}),o(i.mapId,e),a(i.mapId,e)):e!==c?(m("skillmap.graph.item.select",{path:i.mapId,activity:e}),o(i.mapId,e)):(m("skillmap.graph.item.deselect",{path:i.mapId,activity:e}),o(void 0))},u.onItemDoubleClick=function(e,t){var a=u.props,r=a.user,n=a.pageSourceUrl,i=a.map,c=a.dispatchOpenActivity,a=a.dispatchShowCarryoverModal,o=Te(r,n,i,e).status,s=i.activities[e],l=(m("skillmap.activity.open.doubleclick",{path:i.mapId,activity:e,status:o||""}),N(r,n,i.mapId,s.activityId));!Fe(r,n,i,s)||null!=l&&l.headerId?"activity"==t&&"locked"!==o&&c(i.mapId,e):a(i.mapId,e)},u}function I(){return Object(s.a)(this,I),Tt.apply(this,arguments)}function O(e){var t;return Object(s.a)(this,O),(t=Lt.call(this,e)).handleClick=function(){t.props.onItemSelect&&t.props.onItemSelect(t.props.activityId,t.props.kind)},t.handleDoubleClick=function(){t.props.onItemDoubleClick&&t.props.onItemDoubleClick(t.props.activityId,t.props.kind)},t.handleRef=function(e){e&&(e.addEventListener("mouseenter",function(){t.setState({hover:!0})}),e.addEventListener("mouseleave",function(){t.setState({hover:!1})}))},t.state={hover:!1},t}function S(e){var r;return Object(s.a)(this,S),(r=Rt.call(this,e)).handleOnClose=function(){r.setState({loading:!1,data:void 0,checkboxSelected:!1}),r.props.dispatchHideModal(),r.props.dispatchSetShareStatus()},r.handleRewardClick=function(){var e=r.props,t=e.mapId,a=e.skillMap,e=(e.type,e.activity);m("skillmap.reward",{path:t,activity:e.activityId}),window.open(e.url||a.completionUrl)},r.handleShareInputClick=function(e){e.target.select()},r.handleShareCopyClick=function(){var e=r.props,e=(m("skillmap.share.copy",{path:e.mapId,activity:e.activity.activityId}),document.querySelector(".share-input input"));e&&(e.select(),document.execCommand("copy"))},r.state={},r}function w(){var e;Object(s.a)(this,w);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=_t.call.apply(_t,[this].concat(a))).handleModalClick=function(e){e.stopPropagation()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}function Gt(e,t){return{x:zt(e),y:qt(t)}}function zt(e){return(12*e+4)*Wt}function qt(e){return(9*e+4)*Wt}function Yt(e){for(var t=[],a=[e],r={};0<a.length;){var n=a.shift();n&&!r[n.activityId]&&(r[n.activityId]=!0,t.push(n),a=n.next.concat(a))}return t}function Kt(n){var e=function(){for(var e=[],t=[n],a={};0<t.length;){var r=t.shift();r&&!a[r.activityId]&&(a[r.activityId]=!0,e.push(r),t=t.concat(r.next))}return e}(),a={};return e.forEach(function(e){var t=e.next.slice();e.next.length=0,a[e.activityId]=JSON.parse(JSON.stringify(e)),e.next=t}),Object.keys(a).forEach(function(e){return a[e].next=a[e].nextIds.map(function(e){return a[e]})}),a[n.activityId]}e(45);u=f.Component,Object(a.a)(la,u),Zt=Object(n.a)(la),Object(r.a)(la,[{key:"render",value:function(){var e=this.props,t=e.graphs,a=e.graphSize,e=e.backgroundImageUrl,r=this.state.backgroundSize,n=0,i=a.width/a.height,c=r.width/r.height,r=e&&0<r.width&&0<r.height,o=Math.max(400,a.height),s=Math.max(600,a.width),i=(r&&(.05<i-c?o=s*(1/c):i-c<-.05&&(s=o*c)),Math.max(o-a.height,0)/2),c=Math.max(s-a.width,0)/2;return f.createElement("div",{className:"skill-graph-wrapper"},f.createElement("div",{className:"skill-graph-content ".concat(r?"has-background":"")},f.createElement("div",{className:"skill-graph-activities"},f.createElement("svg",{viewBox:"-".concat(40+c," -").concat(40+i," ").concat(s+80," ").concat(o+80),preserveAspectRatio:"xMidYMid meet"},t.map(function(e,t){return n+=e.height,f.createElement("g",{key:t,transform:"translate(0, ".concat(n-e.height,")")},f.createElement(Vt,Object.assign({unit:Wt},e)))}))),e&&f.createElement("div",{className:"skill-graph-background"},f.createElement("img",{src:e,alt:lf("Background Image"),onLoad:this.onImageLoad}))))}}]);var $t,Qt,Jt,Xt,Zt,d=la,ea=Object(t.b)(function(e,t){var a;return e?(t=null!=(e=t.maps.map(function(e){var t,a,n=e,e=[],e="manual"===n.layout?e.concat((p=n.root,t=[],(p=Yt(Kt(p)).filter(function(e){return"layout"!==e.kind})).forEach(function(i){var e,c;t.indexOf(i.activityId)<0&&(t.push(i.activityId),i.depth=(null==(e=i.position)?void 0:e.depth)||0,i.offset=(null==(e=i.position)?void 0:e.offset)||0,c=[],i.next.forEach(function(e,t){var a=(null==(a=e.position)?void 0:a.depth)||0,e=(null==(e=e.position)?void 0:e.offset)||0,r=[{depth:i.depth,offset:i.offset}],n=(null!=(n=i.edges)&&n[t]&&i.edges[t].forEach(function(e){var t=r[r.length-1];e.depth!==t.depth&&e.offset!==t.offset&&r.push({depth:t.depth,offset:e.offset}),r.push(e)}),r[r.length-1]);a!==n.depth&&e!==n.offset&&r.push({depth:n.depth,offset:e}),r.push({depth:a,offset:e}),c.push(r)}),i.edges=c)}),p)):e.concat(function(){for(var e=Kt(n.root),a=[e],r={},i={},c=0;0<a.length;)!function(){var e,t,n=a.shift();n&&!i[n.activityId]&&(i[n.activityId]=!0,(t=null==(t=n.parents)?void 0:t[0])?(0==(e=r[t.activityId]||{depth:0,offset:0}).depth?(e.depth=1,n.offset=t.offset+e.offset):(c+=1,e.offset=c,n.offset=c),n.depth=t.depth+e.depth,r[t.activityId]=e):(n.depth=0,n.offset=0),(t=n.next.map(function(e){return e.parents?e.parents.push(n):e.parents=[n],e})).filter(function(e){return i[e.activityId]}).forEach(function(e){var t,a,r;a=n,(t=e).parents&&a.parents&&(t.parents.forEach(function(e){0<=a.parents.indexOf(e)&&(r=e)}),r)&&1==Math.abs(r.nextIds.indexOf(t.activityId)-r.nextIds.indexOf(a.activityId))&&t.depth==a.depth||(e.offset+=1,c=Math.max(c,e.offset),e.depth=Math.max(e.depth,n.depth+1))}),a=t.concat(a))}();var e=Yt(e).filter(function(e){return"layout"!==e.kind}),o={};return e.forEach(function(e){null==o[e.depth]&&(o[e.depth]=[]),o[e.depth].push(e.offset)}),e.forEach(function(e){var t,a;e.next&&0!=e.next.length||1!=(null==(t=e.parents)?void 0:t.length)||(t=e.parents[0],2<((a=(a=o[e.depth])[a.indexOf(e.offset)-1])?e.offset-a:Math.abs(e.depth-t.depth)+Math.abs(e.offset-t.offset))&&(e.depth=t.depth,e.offset=(a||t.offset)+1))}),e.forEach(function(i){var c;i.parents&&(i.edges=[],c=i.parents.some(function(e){return e.offset==i.offset})||2<i.parents.length,i.parents.forEach(function(e){var t,a,r,n=[{depth:e.depth,offset:e.offset}];c?(t=(r=o[i.depth]).indexOf(i.offset),a=i.offset>e.offset&&!(r[t+1]-r[t]<i.offset-e.offset),r=i.offset<e.offset&&!(r[t]-r[t-1]<e.offset-i.offset),n.push(a||r?{depth:i.depth,offset:e.offset}:{depth:e.depth,offset:i.offset})):n.push({depth:e.depth,offset:i.offset}),n.push({depth:i.depth,offset:i.offset}),null!=(t=i.edges)&&t.push(n)}))}),e}()),r=0,i=0,c=[],o=[],s=Object(E.a)(e);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.depth,d=l.offset;c.push({activity:l,position:Gt(u,d)}),l.edges&&l.edges.forEach(function(e){var t=[];e.forEach(function(e){return t.push(Gt(e.depth,e.offset))}),o.push({points:t})}),r=Math.max(r,l.depth),i=Math.max(i,l.offset)}}catch(n){s.e(n)}finally{s.f()}var p=zt(r)+40,e=qt(i)+40;return{map:n,items:c,paths:o,width:p,height:e}}))&&e.length?e.map(function(e){return e.width}).reduce(function(e,t){return Math.max(e,t)}):0,a=null!=e&&e.length?e.map(function(e){return e.height}).reduce(function(e,t){return e+t}):0,{graphs:e,graphSize:{width:t,height:a}}):{}})(d),d=(u=f.Component,Object(a.a)(sa,u),Xt=Object(n.a)(sa),Object(r.a)(sa,[{key:"getActivityActionText",value:function(){switch(this.props.status){case"locked":return lf("LOCKED");case"completed":return lf("VIEW CODE");case"inprogress":case"restarted":return lf("CONTINUE");default:return lf("START")}}},{key:"isCompleted",value:function(e){return"completed"===e||"restarted"===e}},{key:"render",value:function(){var e=this.props,t=e.status,e=e.completedHeaderId,a=t&&"notstarted"!==t&&"locked"!==t;return"locked"===t?f.createElement("div",null):f.createElement("div",{className:"actions ".concat(e?"grid":"")},f.createElement("div",{className:"action-button",role:"button",onClick:this.handleActionButtonClick},this.getActivityActionText()),a&&f.createElement("div",{className:"action-button",role:"button",onClick:this.handleRestartButtonClick},lf("Restart")),a&&f.createElement("div",{className:"action-button",role:"button",onClick:this.handleShareButtonClick},lf("Share")),e&&f.createElement("div",{className:"action-button",role:"button",onClick:this.handleSaveToProjectsClick},lf("Save to My Projects")))}}]),sa),u={dispatchOpenActivity:Ge,dispatchShowRestartActivityWarning:function(e,t){return{type:se,mapId:e,activityId:t}},dispatchShowShareModal:function(e,t){return{type:de,mapId:e,activityId:t}},dispatchShowCarryoverModal:Ye},ta=Object(t.b)(function(e,t){var a;return e?(t=(a=e.maps[t.mapId]).activities[t.activityId],{showCodeCarryoverModal:Fe(e.user,e.pageSourceUrl,a,t)}):{}},u)(d),d=(u=f.Component,Object(a.a)(oa,u),Jt=Object(n.a)(oa),Object(r.a)(oa,[{key:"getRewardActionText",value:function(){return"certificate"!==this.props.type?lf("Claim Reward"):lf("Claim Certificate")}},{key:"render",value:function(){return"locked"===this.props.status?f.createElement("div",null):f.createElement("div",{className:"actions"},f.createElement("div",{className:"action-button",role:"button",onClick:this.handleActionButtonClick},this.getRewardActionText()))}}]),oa),u={dispatchOpenActivity:Ge,dispatchShowCompletionModal:qe},aa=Object(t.b)(null,u)(d),d=(u=f.Component,Object(a.a)(ca,u),Qt=Object(n.a)(ca),Object(r.a)(ca,[{key:"render",value:function(){var e=pxt.cloud.cloudStatus[this.props.cloudStatus];return f.createElement("div",{className:"cloud-action"},this.props.signedIn?f.createElement("div",{className:"cloud-indicator"},f.createElement("div",{className:"ui tiny cloudicon xicon ".concat(e.icon),title:e.tooltip,tabIndex:-1}),e.longStatus):f.createElement("div",{className:"sign-in-button",onClick:this.props.dispatchShowLoginModal},lf("Sign in to Save")))}}]),ca),u={dispatchShowLoginModal:Ke},ra=Object(t.b)(function(e,t){var a=e.user,r=e.pageSourceUrl,n=e.selectedItem,i="none";return null!=n&&n.activityId?(r=null==(a=N(a,r,n.mapId,n.activityId))?void 0:a.headerId)&&(i=e.cloudState&&e.cloudState[r]||i):i="synced",{signedIn:e.auth.signedIn,cloudStatus:i}},u)(d),d=(e(46),u=f.Component,Object(a.a)(T,u),$t=Object(n.a)(T),Object(r.a)(T,[{key:"getStatusLabel",value:function(e){switch(e){case"locked":return lf("Locked");case"completed":return lf("Completed");default:return null}}},{key:"getStatusIcon",value:function(e){switch(e){case"locked":return"lock";case"completed":return"check circle";default:return null}}},{key:"render",value:function(){var e=this.props,t=e.mapId,a=e.title,r=e.subtitle,n=e.description,i=e.infoUrl,c=e.imageUrl,o=e.details,s=e.node,l=e.status,e=e.completedHeaderId,u=this.getStatusLabel(l),d=!s,p=s&&!U(s),h=p&&s.tags||void 0,m=pxt.auth.hasIdentity();return f.createElement("div",{className:"info-panel"},f.createElement("div",{className:"info-panel-image"},c?f.createElement("img",{src:c,alt:lf("Preview of activity content")}):f.createElement("i",{className:"icon image"})),f.createElement("div",{className:"info-panel-content"},r&&f.createElement("div",{className:"info-panel-subtitle"},r),f.createElement("div",{className:"info-panel-title"},a),u&&f.createElement("div",{className:"info-panel-label"},f.createElement("i",{className:"ui icon ".concat(this.getStatusIcon(l))}),f.createElement("span",null,u)),f.createElement("div",{className:"info-panel-description"},n),d&&i&&f.createElement("a",{className:"info-panel-link",href:i,target:"_blank",rel:"noopener noreferrer"},lf("Learning Outcomes")),h&&0<h.length&&f.createElement("div",{className:"info-panel-tags"},h.map(function(e,t){return f.createElement("div",{key:t},e)})),f.createElement("div",{className:"info-panel-detail"},null==o?void 0:o.map(function(e,t){return f.createElement("div",{key:"detail_".concat(t)},e)})),f.createElement("div",{className:"tablet-spacer"}),!d&&(p?f.createElement(ta,{mapId:t,activityId:s.activityId,status:l,completedHeaderId:e}):f.createElement(aa,{mapId:t,activityId:s.activityId,status:l,type:s.type})),m&&f.createElement(ra,null)))}}]),T),na=Object(t.b)(function(e,t){var a,r,n,i,c,o,s,l,u,d,p=e.user,h=e.pageSourceUrl,m=e.maps,f=e.selectedItem,v=e.infoUrl,y=f&&(null==(y=e.maps[f.mapId])?void 0:y.activities[f.activityId]),g="activity"===(null==y?void 0:y.kind),b=[];return m&&(null!=f&&f.activityId&&m[f.mapId]?(r=m[f.mapId],i=(c=Te(e.user,e.pageSourceUrl,r,f.activityId)).status,o=c.currentStep,n=c.maxSteps,i=i,c=c.completedHeadedId,g&&(b.push(n?"".concat(o,"/").concat(n," ").concat(lf("Steps")):lf("Not Started")),b.push(g?y.type:"")),r&&(a=r.displayName)):p&&(o=Object.keys(m),d=u=l=s=0,o.forEach(function(t){var a=m[t].activities;Object.keys(a).filter(function(e){return"activity"==a[e].kind}).forEach(function(e){return++l&&A(p,h,t,e)&&++s}),Object.keys(a).filter(function(e){return U(a[e])}).forEach(function(e){return++d&&A(p,h,t,e)&&++u})}),b.push("".concat(s,"/").concat(l," ").concat(lf("Complete"))),b.push(d?"".concat(u,"/").concat(d," ").concat(lf("Reward(s)")):""))),{mapId:null==f?void 0:f.mapId,title:(null==y?void 0:y.displayName)||e.title,subtitle:a,description:(g?y:e).description,infoUrl:v,imageUrl:y?null==y?void 0:y.imageUrl:e.bannerImageUrl,node:y,status:i,details:b,completedHeaderId:c}})(d),ia=e(28);function T(){return Object(s.a)(this,T),$t.apply(this,arguments)}function ca(){return Object(s.a)(this,ca),Qt.apply(this,arguments)}function oa(){var n;Object(s.a)(this,oa);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(n=Jt.call.apply(Jt,[this].concat(t))).handleActionButtonClick=function(){var e=n.props,t=e.status,a=e.mapId,r=e.activityId,e=e.dispatchShowCompletionModal;if("locked"!==t)return m("skillmap.sidebar.reward",{path:a,activity:r}),e(a,r)},n}function sa(){var c;Object(s.a)(this,sa);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(c=Xt.call.apply(Xt,[this].concat(t))).handleActionButtonClick=function(){var e=c.props,t=e.status,a=e.mapId,r=e.activityId,n=e.dispatchOpenActivity,i=e.dispatchShowCarryoverModal,e=e.showCodeCarryoverModal;"locked"!==t&&("notstarted"===(m("skillmap.activity.open",{path:a,activity:r,status:t||""}),t)&&e?i:n)(a,r)},c.handleRestartButtonClick=function(){var e=c.props,t=e.mapId,a=e.activityId,r=e.status,e=e.dispatchShowRestartActivityWarning;m("skillmap.sidebar.restart",{path:t,activity:a,status:r||""}),e(t,a)},c.handleShareButtonClick=function(){var e=c.props,t=e.mapId,a=e.activityId,r=e.status,e=e.dispatchShowShareModal;m("skillmap.sidebar.share",{path:t,activity:a,status:r||""}),e(t,a)},c.handleSaveToProjectsClick=function(){var e=c.props,t=e.completedHeaderId;m("skillmap.export",{path:e.mapId||"",activity:e.activityId||""}),window.open("".concat(v,"#skillmapimport:").concat(t))},c}function la(e){var t;return Object(s.a)(this,la),(t=Zt.call(this,e)).onImageLoad=function(e){t.setState({backgroundSize:{width:e.target.naturalWidth,height:e.target.naturalHeight}})},t.state={backgroundSize:{width:0,height:0}},t}function ua(p){var e=function(){var e,t=p.split("\n"),a=[],r=null,n=null,i=null,c=Object(E.a)(t);try{for(c.s();!(e=c.n()).done;){var o,s,l=e.value;if(l.trim()){if(l.startsWith("#")){var u=/^(#+)\s*(.+)$/.exec(l);if(u){d(),r={headerKind:1===u[1].length?"single":2===u[1].length?"double":"triple",header:u[2],attributes:{}},i=n=null;continue}}r&&(o=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(l),s=/^ {4}([*-])\s+(.*)$/.exec(l),o?o[1]?(n&&i&&(r.attributes[n]=i.trim()),n=o[1].toLowerCase(),i=o[2]):n&&(i+=o[2]):s&&n&&(r.listAttributes||(r.listAttributes={}),r.listAttributes[n]||(r.listAttributes[n]=[]),s[2])&&r.listAttributes[n].push(s[2].trim()))}else i&&(i+="\n")}}catch(e){c.e(e)}finally{c.f()}return d(),a;function d(){r&&(n&&i&&(r.attributes[n]=i.trim()),a.push(r))}}();null!=e&&e.length||L("Cannot parse content: ".concat(p));for(var t,a,r,n,i,c,o,s,l,u=[],d=-1,h=0;h<e.length;h++)"single"===e[h].headerKind?(a=e[h],l=s=o=c=i=n=r=void 0,r=a.attributes.primarycolor,n=a.attributes.secondarycolor,i=a.attributes.tertiarycolor,c=a.attributes.highlightcolor,o=a.attributes.unlockednodecolor,s=a.attributes.lockednodecolor,l=a.attributes.completednodecolor,t={title:a.attributes.name||a.header,description:a.attributes.description,infoUrl:function(e){if(e)return fa(e)?e.replace(/\?[\s\S]+$/gi,""):va(e)?"".concat(e.startsWith("/")?"":"/").concat(e):void L("URL: ".concat(e," must be to Github or MakeCode documentation"))}(a.attributes.infourl),backgroundImageUrl:a.attributes.backgroundurl,bannerImageUrl:a.attributes.bannerurl,alternateSources:ya(a.attributes.alternatesources),theme:{backgroundColor:i||"var(--body-background-color)",pathColor:r||"#BFBFBF",strokeColor:"#000000",rewardNodeColor:c||"var(--primary-color)",rewardNodeForeground:c?ma(c):"#000000",unlockedNodeColor:o||n||"var(--secondary-color)",unlockedNodeForeground:o||n?ma(o||n):"#000000",lockedNodeColor:s||r||"#BFBFBF",lockedNodeForeground:s||r?ma(s||r):"#000000",completedNodeColor:l||n||"var(--secondary-color)",completedNodeForeground:l||n?ma(l||n):"#000000",selectedStrokeColor:c||"var(--primary-color)",pathOpacity:.5}}):"double"===e[h].headerKind&&(0<=d&&u.push(da(e[d],e.slice(d+1,h))),d=h);return(0<d||0===u.length)&&u.push(da(e[d],e.slice(d+1,e.length))),{maps:u,metadata:t}}function da(e,t){var i=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,completionUrl:e.attributes.completionurl,prerequisites:[],activities:{},allowCodeCarryover:!e.attributes.allowcodecarryover||!ha(e.attributes.allowcodecarryover)};if("manual"===e.attributes.layout&&(t.layout="manual"),e.attributes.required){var a,r=e.attributes.required.split(","),n=Object(E.a)(r);try{for(n.s();!(a=n.n()).done;){var i=a.value,c=/^\s*(?:(\d+) +)?(.+)$/.exec(i);c[1]?t.prerequisites.push({type:"tag",tag:c[2].trim(),numberCompleted:parseInt(c[1])}):t.prerequisites.push({type:"map",mapId:c[2].trim()})}}catch(e){n.e(e)}finally{n.f()}}return t}(e),t=t.map(pa),a=t.filter(function(e){return"activity"===e.kind});i.allowCodeCarryover&&a.forEach(function(e){void 0===e.allowCodeCarryover&&(e.allowCodeCarryover=!0)}),i.root=t[0];var r,n=Object(E.a)(t);try{for(n.s();!(r=n.n()).done;){var c=r.value;i.activities[c.activityId]&&L("Duplicate activity id '".concat(c.activityId,"' in map '").concat(i.mapId,"'")),i.activities[c.activityId]=c}}catch(e){n.e(e)}finally{n.f()}var o,s=Object(E.a)(t);try{for(s.s();!(o=s.n()).done;){var l,u=o.value,d=Object(E.a)(u.nextIds);try{for(d.s();!(l=d.n()).done;){var p=l.value;i.activities[p]||L("Unknown activity id '".concat(p,"' in map '").concat(i.mapId,"'")),u.next.push(i.activities[p])}}catch(e){d.e(e)}finally{d.f()}}}catch(e){s.e(e)}finally{s.f()}var h={};!function e(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(a[t.activityId])console.warn("Loop in map '".concat(i.mapId,"' detected"));else{a[t.activityId]=!0,h[t.activityId]=!0;var r,n=Object(E.a)(t.next);try{for(n.s();!(r=n.n()).done;)e(r.value,Object(x.a)({},a))}catch(e){n.e(e)}finally{n.f()}}}(i.root);var m,f=Object(E.a)(t);try{for(f.s();!(m=f.n()).done;){var v=m.value;h[v.activityId]||console.warn("Unreachable activity detected '".concat(v.activityId,"' in map '").concat(i.mapId,"'"))}}catch(e){f.e(e)}finally{f.f()}return i}function pa(e){var r,n={activityId:e.header.toLowerCase(),imageUrl:e.attributes.imageurl,next:[],displayName:e.attributes.name||e.header,nextIds:ya(e.attributes.next)};if(e.attributes.position&&(a=e.attributes.position.split(" "),n.position={depth:parseInt(a[0])||0,offset:parseInt(a[1])||0}),e.attributes.edges&&(r=ya(e.attributes.edges,!(n.edges=[]),";"),null!=(a=n.nextIds))&&a.forEach(function(e,t){var a,t=ya(r[t])||[];null!=(a=n.edges)&&a.push(t.map(function(e){e=e.split(" ");return{depth:parseInt(e[0])||0,offset:parseInt(e[1])||0}}))}),"reward"===e.attributes.kind||"completion"===e.attributes.kind){var t=e,a=n;if(a=Object(x.a)(Object(x.a)({},a),{},{kind:t.attributes.kind||"reward",url:t.attributes.url}),t.attributes.type&&"certificate"===(o=t.attributes.type.toLowerCase())&&(a.type=o),null!=(o=t.listAttributes)&&o.actions){var i,c=[],o=t.listAttributes.actions,s=Object(E.a)(o);try{for(s.s();!(i=s.n()).done;){var l,u,d=i.value.split(":"),p=Object(ia.a)(d),h=p[0],m=p.slice(1),f=/\s*\[\s*(.*)\s*\](?:\(([^\s]+)\))?/gi.exec(m.join(":")),v=null==f?void 0:f[1],y=null==f?void 0:f[2];switch(h){case"activity":c.push({kind:"activity",label:v,activityId:y});break;case"map":y&&((l=fa(y)?"github":va(y)?"docs":void 0)||L("URL: ".concat(y," must be to Github or MakeCode documentation")),c.push({kind:"map",label:v,url:"#".concat(l,":").concat(y)}));break;case"docs":y&&(va(u=(y.startsWith("/")?"":"/")+y)||L("URL: ".concat(u," must be to MakeCode documentation")),c.push({kind:"docs",label:v,url:u}));break;case"editor":c.push({kind:"editor",label:v})}}}catch(t){s.e(t)}finally{s.f()}c.length&&(a.actions=c)}return a}if("layout"===e.attributes.kind)return o=n,Object(x.a)(Object(x.a)({},o),{},{kind:"layout",next:[]});var g=n,b=Object(x.a)(Object(x.a)({},g),{},{kind:"activity",description:e.attributes.description,url:e.attributes.url,tags:ya(e.attributes.tags),allowCodeCarryover:!e.attributes.allowcodecarryover||!ha(e.attributes.allowcodecarryover)});if(e.attributes.type&&"tutorial"===(g=e.attributes.type.toLowerCase())&&(b.type=g),e.attributes.editor){var k=e.attributes.editor.toLowerCase();switch(k){case"py":case"blocks":case"js":b.editor=k;break;default:b.editor="blocks"}}return b.url||L("Activity '".concat(b.activityId,"' is missing attribute 'url'")),b.type||L("Activity '".concat(b.activityId,"' is missing attribute 'type'")),b}function ha(e){if(e)switch(e.toLowerCase().trim()){case"0":case"no":case"n":case"off":case"false":return 1;default:return}}function ma(e){return e=e.replace("#",""),382.5<Number.parseInt(e.slice(0,2),16)+Number.parseInt(e.slice(2,4),16)+Number.parseInt(e.slice(4),16)?"#000000":"#ffffff"}function fa(e){return e.match(/^(https?:\/\/)?(www\.)?github\.com\//gi)}function va(e){return e.indexOf(".")<0}function ya(e,t,a){var r,t=1<arguments.length&&void 0!==t&&t;return e?(e=e.split(2<arguments.length&&void 0!==a?a:",").map(function(e){return e.trim().toLowerCase()}).filter(function(e){return!!e}),t?e:(r={},e.forEach(function(e){return r[e]=e}),Object.keys(r))):[]}function L(e){throw e}u=f.Component,Object(a.a)(Ua,u),wa=Object(n.a)(Ua),Object(r.a)(Ua,[{key:"render",value:function(){return this.props.showProfile?this.renderUserProfile():f.createElement("div",null)}}]);var ga,ba,ka,Ia,Oa,Sa,wa,d=Ua,u={dispatchCloseUserProfile:$e,dispatchShowDeleteAccountModal:function(){return{type:me}}},Ca=Object(t.b)(function(e,t){return e?{signedIn:e.auth.signedIn,profile:e.auth.profile,showProfile:e.showProfile}:{}},u)(d),ja=(Object(r.a)(Na,[{key:"exportCloudProjectsToLocal",value:function(e){return this.sendMessageAsync({type:"pxteditor",action:"convertcloudprojectstolocal",userId:e})}}]),Na),xa=(Object(r.a)(Aa,[{key:"setSendMessageAsync",value:function(e){this.resources.sendMessageAsync=e,this.checkComplete()}},{key:"setAppMounted",value:function(){this.appMounted=!0,this.checkComplete()}},{key:"checkComplete",value:function(){var e;this.resolve&&this.appMounted&&this.resources.sendMessageAsync&&(M.dispatch((e=this.resources,{type:Oe,resources:e})),this.resolve(this.resources))}}]),Aa),d=(e(47),e(48),u=c.a.Component,Object(a.a)(Ea,u),Sa=Object(n.a)(Ea),Object(r.a)(Ea,[{key:"parseHashAsync",value:(Oa=Object(p.a)(C.a.mark(function e(){var t,a,r;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.targetConfigAsync();case 2:return t=e.sent,a=window.location.hash.replace("#",""),a=a&&null!=(r=t.skillMap)&&null!=(r=r.pathAliases)&&r[a]?we(t.skillMap.pathAliases[a]):we(window.location.hash||(null==(r=t.skillMap)?void 0:r.defaultPath)),e.next=7,this.fetchAndParseSkillMaps(a.cmd,a.arg);case 7:case"end":return e.stop()}},e,this)})),function(){return Oa.apply(this,arguments)})},{key:"initLocalizationAsync",value:(Ia=Object(p.a)(C.a.mark(function e(){var t,a,r,n,i,c,o;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=pxt.appTarget.appTheme,n=window.location.href,t=!1,a=void 0,/[&?]translate=1/.test(n)&&!pxt.BrowserUtils.isIE()?a=ts.pxtc.Util.TRANSLATION_LOCALE:((n=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href))&&0<=window.location.hash.indexOf(n[0])&&pxt.BrowserUtils.changeHash(window.location.hash.replace(n[0],"")),a=n?n[3]:pxt.BrowserUtils.getCookieLang()||r.defaultLocale||navigator.userLanguage||navigator.language,t=!!n&&!!n[2]),r=pxt.appTarget.id,n=pxt.appTarget.versions.pxtCrowdinBranch,i=pxt.appTarget.versions.targetCrowdinBranch,o=pxt.appTarget.appTheme.defaultLocale,c=null==(c=a)?void 0:c.toLocaleLowerCase(),o=pxt.BrowserUtils.isLocalHostDev()&&(!c||(o?o.toLocaleLowerCase()===c:"en"===c||"en-us"===c)),pxt.BrowserUtils.isPxtElectron()||o||pxt.Util.enableLiveLocalizationUpdates(),e.next=16,function(){return Pa.apply(this,arguments)}({targetId:r,baseUrl:"",code:a,pxtBranch:n,targetBranch:i,force:t});case 16:pxt.Util.isLocaleEnabled(a)&&pxt.BrowserUtils.setCookieLang(a);case 17:case"end":return e.stop()}},e)})),function(){return Ia.apply(this,arguments)})},{key:"fetchAndParseSkillMaps",value:(ka=Object(p.a)(C.a.mark(function e(t,a){var r,n,i,c,o,s,l,u,d,p,h,m,f,v,y=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){return Ce.apply(this,arguments)}(t,a);case 2:if(v=e.sent,r=null==v?void 0:v.text,n=null==v?void 0:v.identifier,v=null==v?void 0:v.status,r&&n&&v)try{"banned"===v?this.handleError(lf("This GitHub repository has been banned.")):(B=n,this.props.dispatchSetPageSourceUrl(n,v),this.props.dispatchClearMetadata()),c=ua(r),o=c.maps,s=c.metadata,0<(null==o?void 0:o.length)&&(i=o,this.props.dispatchClearSkillMaps(),o.forEach(function(e){y.props.dispatchAddSkillMap(e)})),s&&(l=s.title,u=s.description,d=s.infoUrl,p=s.backgroundImageUrl,h=s.bannerImageUrl,m=s.theme,f=s.alternateSources,H=l,this.props.dispatchSetPageTitle(l),u&&this.props.dispatchSetPageDescription(u),d&&this.props.dispatchSetPageInfoUrl(d),p&&this.props.dispatchSetPageBackgroundImageUrl(p),h&&this.props.dispatchSetPageBannerImageUrl(h),f&&this.props.dispatchSetPageAlternateUrls(f),m)&&this.props.dispatchSetPageTheme(m),this.setState({error:void 0})}catch(e){this.handleError(e)}else this.setState({error:lf("No content loaded.")});return e.next=9,nt();case 9:v=e.sent,n&&!v.completedTags[n]&&(v.completedTags[n]={}),this.applyQueryFlags(v,i,n),this.loadedUser=v,this.props.dispatchSetUser(v);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return ka.apply(this,arguments)})},{key:"cloudSyncCheckAsync",value:(ba=Object(p.a)(C.a.mark(function e(){var t,a,r,n,i,c,o,s,l,u,d,p,h,m,f,v,y,g,b,k,I,O,S,w;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready();case 2:return t=e.sent,e.next=5,ft();case 5:if(e.sent)return a=M.getState(),e.next=9,at();e.next=29;break;case 9:return r=e.sent,e.next=12,nt();case 12:return n=e.sent,o=Ve(r,a.pageSourceUrl,n),e.next=16,t.sendMessageAsync({type:"pxteditor",action:"savelocalprojectstocloud",headerIds:o});case 16:if(!(i=e.sent.resp.headerIdMap)){e.next=27;break}for(c=Object(x.a)(Object(x.a)({},n),{},{mapProgress:{}}),o=Object.keys(r.mapProgress),s=0,l=o;s<l.length;s++)for(u=l[s],c.mapProgress[u]=Object(x.a)({},r.mapProgress[u]),d=Object.keys(r.mapProgress[u]),p=0,h=d;p<h.length;p++)if(m=h[p],!_e(n,u))for(c.mapProgress[u][m]=Object(x.a)({},r.mapProgress[u][m]),c.completedTags[u]=r.completedTags[u],f={},c.mapProgress[u][m].activityState=f,v=r.mapProgress[u][m].activityState,y=0,g=Object.keys(v);y<g.length;y++)b=g[y],(k=v[b]).headerId&&(f[b]=Object(x.a)(Object(x.a)({},k),{},{headerId:i[k.headerId]||k.headerId}));for(I=Object.keys(n.mapProgress),O=0,S=I;O<S.length;O++)w=S[O],_e(n,w)&&(c.mapProgress[w]=Object(x.a)({},n.mapProgress[w]),c.completedTags[w]=n.completedTags[w]);return this.props.dispatchSetUser(c),e.next=26,ct(c);case 26:n=c;case 27:return e.next=29,t.sendMessageAsync({type:"pxteditor",action:"requestprojectcloudstatus",headerIds:Ve(n,a.pageSourceUrl)});case 29:this.setState({cloudSyncCheckHasFinished:!0});case 30:case"end":return e.stop()}},e,this)})),function(){return ba.apply(this,arguments)})},{key:"componentDidMount",value:(ga=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.unsubscribeChangeListener=M.subscribe(this.onStoreChange),this.queryFlags=function(){var a={},e=window.location.search;return e&&new URLSearchParams(e).forEach(function(e,t){"true"!==e.toLowerCase()&&"1"!==e||(e="true"),a[t]=e}),a}(),this.queryFlags.authcallback)return e.next=5,function(){return yt.apply(this,arguments)}(this.queryFlags);e.next=5;break;case 5:return e.next=7,function(){return mt.apply(this,arguments)}();case 7:return e.next=9,this.initLocalizationAsync();case 9:return e.next=11,this.parseHashAsync();case 11:this.readyPromise.setAppMounted();case 12:case"end":return e.stop()}},e,this)})),function(){return ga.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,r=e.backgroundImageUrl,e=e.theme,n=this.state.error,i=Object.keys(t).map(function(e){return t[e]});return c.a.createElement("div",{className:"app-container ".concat(pxt.appTarget.id)},c.a.createElement(Ut,null),c.a.createElement("div",{className:"skill-map-container ".concat(a?"hidden":""),style:{backgroundColor:e.backgroundColor}},n?c.a.createElement("div",{className:"skill-map-error"},n):c.a.createElement(ea,{maps:i,backgroundImageUrl:r}),!n&&c.a.createElement(na,null)),c.a.createElement(Ht,{onFrameLoaded:this.onMakeCodeFrameLoaded}),c.a.createElement(Bt,null),c.a.createElement(Ca,null))}},{key:"applyQueryFlags",value:function(e,t,a){var r=a||"default";if("true"===this.queryFlags.debugNewUser&&(e.isDebug=!0,e.mapProgress=Object(j.a)({},r,{}),e.completedTags={}),"true"===this.queryFlags.debugCompleted&&(e.isDebug=!0,e.mapProgress=Object(j.a)({},r,{}),t)){var n,i=Object(E.a)(t);try{for(i.s();!(n=i.n()).done;){var c=n.value;e.mapProgress[r][c.mapId]={completionState:"completed",mapId:c.mapId,activityState:{}};for(var o=0,s=Object.keys(c.activities);o<s.length;o++){var l,u=s[o],d=c.activities[u];if(e.mapProgress[r][c.mapId].activityState[d.activityId]?e.mapProgress[r][c.mapId].activityState[d.activityId].isCompleted=!0:e.mapProgress[r][c.mapId].activityState[d.activityId]={activityId:d.activityId,isCompleted:!0},"activity"===d.kind&&null!=(l=d.tags)&&l.length&&a){var p,h=Object(E.a)(d.tags);try{for(h.s();!(p=h.n()).done;){var m=p.value;e.completedTags[a][m]||(e.completedTags[a][m]=0),e.completedTags[a][m]++}}catch(e){h.e(e)}finally{h.f()}}}}}catch(e){i.e(e)}finally{i.f()}}}}]),Ea);function Ea(e){var a,t,r;return Object(s.a)(this,Ea),(a=Sa.call(this,e)).queryFlags={},a.unsubscribeChangeListener=void 0,a.loadedUser=void 0,a.readyPromise=void 0,a.ready=function(){return a.readyPromise.promise()},a.handleHashChange=(r=Object(p.a)(C.a.mark(function e(t){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.parseHashAsync();case 2:t.stopPropagation(),t.preventDefault();case 4:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)}),a.handleError=function(e){e=e||lf("Oops! Couldn't load content, please check the URL and markdown file.");console.error(e),a.setState({error:e})},a.onMakeCodeFrameLoaded=(t=Object(p.a)(C.a.mark(function e(t){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.readyPromise.setSendMessageAsync(t);case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),a.onStoreChange=Object(p.a)(C.a.mark(function e(){var t;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=M.getState(),(t=t.user)===a.loadedUser||a.loadedUser&&t.id!==a.loadedUser.id);else if(!a.props.signedIn||a.props.signedIn&&a.state.cloudSyncCheckHasFinished)return e.next=5,ct(t);e.next=6;break;case 5:a.loadedUser=t;case 6:case"end":return e.stop()}},e)})),a.state={cloudSyncCheckHasFinished:!1},a.readyPromise=new xa,window.addEventListener("hashchange",a.handleHashChange),a.cloudSyncCheckAsync(),a}function Aa(){var t=this;Object(s.a)(this,Aa),this.promise_=void 0,this.resources=void 0,this.appMounted=void 0,this.resolve=void 0,this.promise=function(){return t.promise_},this.resources=new ja,this.promise_=new Promise(function(e){t.resolve=e,t.checkComplete()})}function Na(){Object(s.a)(this,Na),this.sendMessageAsync=void 0}function Ua(){var i;Object(s.a)(this,Ua);for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(i=wa.call.apply(wa,[this].concat(t))).renderUserProfile=function(){var e=i.props.profile;return f.createElement(b,{title:(null==e||null==(e=e.idp)?void 0:e.displayName)||"",fullscreen:!0,onClose:i.handleOnClose},f.createElement("div",{className:"profiledialog"},i.getAccountPanel(),i.getFeedbackPanel()))},i.getAccountPanel=function(){var e,t=i.props.profile,a=(null==t||null==(a=t.idp)?void 0:a.provider)&&pxt.auth.identityProvider(null==t||null==(a=t.idp)?void 0:a.provider),r=f.createElement("div",{className:"profile-pic avatar"},f.createElement("img",{src:null==t||null==(r=t.idp)||null==(r=r.picture)?void 0:r.dataUrl,alt:lf("User")})),n=f.createElement("div",{className:"profile-pic avatar"},f.createElement("span",null,pxt.auth.userInitials(t)));return f.createElement("div",{className:"account panel ui card"},f.createElement("div",{className:"header-text"},f.createElement("label",null,lf("Profile"))),null!=t&&null!=(e=t.idp)&&null!=(e=e.picture)&&e.dataUrl?r:n,f.createElement("div",{className:"row-span-two"},f.createElement("label",{className:"title"},lf("Name")),f.createElement("p",{className:"value"},(null==t||null==(e=t.idp)?void 0:e.displayName)||(null==t||null==(r=t.idp)?void 0:r.username))),f.createElement("div",{className:"row-span-two"},f.createElement("label",{className:"title"},lf("Username")),f.createElement("p",{className:"value"},null==t||null==(n=t.idp)?void 0:n.username)),f.createElement("div",{className:"row-span-two"},f.createElement("label",{className:"title"},lf("Provider")),f.createElement("p",{className:"value"},null==a?void 0:a.name)),f.createElement("div",{className:"row-span-two",onClick:i.handleSignout},f.createElement("div",{className:"ui icon button"},f.createElement("span",{className:"xicon ".concat(null==t||null==(e=t.idp)?void 0:e.provider)}),f.createElement("span",null," ",lf("Sign out")," "))),f.createElement("div",{className:"row-span-two"},f.createElement("a",{className:"ui",title:lf("delete profile"),onClick:i.handleDeleteAccountClick},lf("I want to delete my profile")," ")))},i.handleOnClose=function(){i.props.dispatchCloseUserProfile()},i.getFeedbackPanel=function(){return f.createElement("div",{className:"feedback panel ui card"},f.createElement("div",{className:"header-text"},f.createElement("label",null,lf("Feedback"))),f.createElement("div",{className:"row-span-two"},lf("What do you think about the Sign In & Cloud Save feature? Is there something you'd like to change? Did you encounter issues? Please let us know!")),f.createElement("div",{className:"row-span-two"},f.createElement("a",{className:"ui",title:lf("Provide feedback in a from"),href:"https://aka.ms/AAcnpaj",target:"_blank"},f.createElement("i",{className:"icon external alternate"}),lf("Take the Survey"))))},i.handleSignout=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:pxt.tickEvent("skillmap.userprofile.signout"),gt(location.hash);case 2:case"end":return e.stop()}},e)})),i.handleDeleteAccountClick=Object(p.a)(C.a.mark(function e(){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.props.dispatchShowDeleteAccountModal();case 1:case"end":return e.stop()}},e)})),i}function Pa(){return(Pa=Object(p.a)(C.a.mark(function e(t){var a,r,n,i,c;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.targetId,a=t.baseUrl,r=t.pxtBranch,n=t.targetBranch,t.force,i=t.code,e.next=4,pxt.Util.downloadTranslationsAsync(c,a,i,r,n,pxt.Util.liveLocalizationEnabled(),ts.pxtc.Util.TranslationsKind.SkillMap);case 4:c=e.sent,pxt.Util.setUserLanguage(i),c&&pxt.Util.setLocalizedStrings(c);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}e={dispatchAddSkillMap:function(e){return{type:D,map:e}},dispatchClearSkillMaps:function(){return{type:F}},dispatchClearMetadata:function(){return{type:V}},dispatchSetPageTitle:function(e){return{type:Z,title:e}},dispatchSetPageDescription:function(e){return{type:ee,description:e}},dispatchSetPageInfoUrl:function(e){return{type:te,infoUrl:e}},dispatchSetUser:function(e){return{type:Q,user:e}},dispatchSetPageSourceUrl:function(e,t){return{type:ie,url:e,status:t}},dispatchSetPageAlternateUrls:function(e){return{type:ce,urls:e}},dispatchSetPageBackgroundImageUrl:function(e){return{type:ae,backgroundImageUrl:e}},dispatchSetPageBannerImageUrl:function(e){return{type:re,bannerImageUrl:e}},dispatchSetPageTheme:function(e){return{type:ne,theme:e}}},a=Object(t.b)(function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView,backgroundImageUrl:e.backgroundImageUrl,theme:e.theme,signedIn:e.auth.signedIn}:{}},e)(d),u=window.pxtTargetBundle;u.bundledpkgs={},pxt.setAppTarget(u),pxt.Cloud.apiRoot="https://www.makecode.com/api/",o()||pxt.setupWebConfig(window.pxtConfig),_.a.render(c.a.createElement(t.a,{store:M},c.a.createElement(a,null)),document.getElementById("root"))}},[[49,1,2]]]);