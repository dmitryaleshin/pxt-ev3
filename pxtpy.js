var pxt;!function(e){var t;e=e.py||(e.py={}),(t=e.VarModifier||(e.VarModifier={}))[t.NonLocal=0]="NonLocal",t[t.Global=1]="Global",e.isIndex=function(e){return"Index"===e.kind},e.isSubscript=function(e){return"Subscript"===e.kind}}(pxt=pxt||{}),function(D){{var M=D.py||(D.py={}),q=D.blocks;let A,w,v,i,P,I,_,K,L,F,y=0,t=0,R=0,s="???";function d(e){return null==e}function ee(e){return null!=e}function c(e){return D.tickEvent("python.todo.statement",{kind:e.kind}),q.mkStmt(q.mkText("TODO: "+e.kind))}function r(e){return D.tickEvent("python.todo.expression",{kind:e.kind}),q.mkText(" {TODO: "+e.kind+"} ")}const X=a({primType:"string"}),m=a({primType:"number"}),je=a({primType:"boolean"}),Ve=a({primType:"void"}),Y=a({primType:"any"});let O;const He={str:X,string:X,number:m,bool:je,void:Ve,any:Y};function te(e){e=D.U.flatClone(e);return delete e.pyAST,delete e.pyInstanceType,delete e.pyRetType,delete e.pySymbolType,delete e.moduleTypeMarker,delete e.declared,e.parameters&&(e.parameters=e.parameters.map(e=>(delete(e=D.U.flatClone(e)).pyType,e))),e}function B(e){if("("==e[0]&&D.U.endsWith(e,")"))return B(e.slice(1,-1));var t=e.indexOf(" => ");if(0<t){const D=e.slice(t+4);if(-1==D.indexOf(")[]")){const n=B(D),r=e.slice(1,t-1);return ne(n,(r?r.split(/, /):[]).map(e=>B(e.replace(/\w+\??: /,""))))}}if(D.U.endsWith(e,"[]"))return S(B(e.slice(0,-2)));if("_py.Array"===e)return S(Y);const n=D.U.lookup(He,e);if(n)return n;if(e&&!isNaN(e))return m;if("T"==e||"U"==e)return a({primType:"'"+e});if(0<=e.indexOf("|"))return a({primType:"@union",typeArgs:e.split("|").map(e=>e.trim()).map(B)});let r=o(e+"@type")||o(e);return r?7==r.kind?m:8==r.kind||9==r.kind?r.pyInstanceType||a({classType:r}):6==r.kind?m:(G(null,9502,D.U.lf("'{0}' is not a type near '{1}'",e,s||"???")),a({primType:e})):(G(null,9501,D.U.lf("unknown type '{0}' near '{1}'",e,s||"???")),a({primType:e}))}function k(e){if(!e.pySymbolType){if(s=e.pyQName,e.parameters){pxtc.service.isTaggedTemplate(e)&&(e.parameters=[{name:"literal",description:"",type:"string",options:{}}]);for(var t of e.parameters)t.pyType||(t.pyType=B(t.type))}var n=e.pyRetType;if(be(e)?e.pyRetType=a({moduleType:e}):e.retType?e.pyRetType=B(e.retType):e.pyRetType||(D.U.oops("no type for: "+e.pyQName),e.pyRetType=a({})),n&&$(e.pyAST,n,e.pyRetType),3==e.kind||1==e.kind){n=e.parameters.map(e=>e.pyType);if(n.some(d))return G(null,9526,D.U.lf("function symbol is missing parameter types near '{1}'",s||"???")),a({});e.pySymbolType=ne(e.pyRetType,n.filter(ee))}else e.pySymbolType=e.pyRetType;8!=e.kind&&9!=e.kind||(e.pyInstanceType=a({classType:e})),s=void 0}return e.pySymbolType}function o(e){return D.U.lookup(w,e)||D.U.lookup(A,e)}function h(e){if(e)return(e=o(e))&&k(e),e}function a(e={}){e=D.U.flatClone(e);return e.tid=++t,e}function S(e){return a({primType:"@array",typeArgs:[e]})}function ne(e,t){return a({primType:"@fn"+t.length,typeArgs:[e].concat(t)})}function re(e){return D.U.startsWith(e.primType||"","@fn")}function ie(e){return e.primType&&!D.U.startsWith(e.primType,"@")}function se(e){return D.U.startsWith(e.primType||"","@union")}function b(){return v.currFun||v.currClass||v.currModule}function oe(){let e=b();for(;e&&e.parent;)e=e.parent;return e}function ae(){return"main"==v.currModule.name&&!v.currFun&&!v.currClass}function x(t,e,n,r){let i=(r=r||b()).vars[t],s=null==i?void 0:i.symbol;if(!s){let e=g(r);e&&(e+=".");var o=e+t;s=!ye(r)||n!==M.VarModifier.Global&&n!==M.VarModifier.NonLocal?ye(r)?de(4,t):l(4,o):l(4,t),i={symbol:s,modifier:n},r.vars[t]=i}for(var a of Object.keys(e))s[a]=e[a];return i}function E(e){return e.unifyWith?(e.unifyWith=E(e.unifyWith),e.unifyWith):e}function g(e){let t=e,n="";return t.parent&&"FunctionDef"!==t.parent.kind&&"AsyncFunctionDef"!==t.parent.kind&&((n=g(t.parent))?n+=".":n=""),"Module"==e.kind&&"main"==e.name?"":e.name?n+e.name:n+"?"+e.kind}function le(e){var t,n=D.U.lookup(Ze,e);if(n)return n;for(t of D.U.values(v.currModule.vars)){var r=t.symbol;if(r.isImport){if(r.expandsTo==e)return r.pyName||G(null,9553,lf("missing pyName")),r.pyName;if(r.isImport&&D.U.startsWith(e,(r.expandsTo||"")+"."))return r.pyName+e.slice(r.expandsTo.length)}}return e}function N(e){return(e=E(e)).primType?e.typeArgs&&"@array"==e.primType?N(e.typeArgs[0])+"[]":re(e)&&e.typeArgs?"("+e.typeArgs.slice(1).map(e=>"_: "+N(e)).join(", ")+") => "+N(e.typeArgs[0]):se(e)&&e.typeArgs?e.typeArgs.map(N).join(" | "):e.primType+"":e.classType&&e.classType.pyQName?le(e.classType.pyQName)+"":e.moduleType&&e.moduleType.pyQName?le(e.moduleType.pyQName)+"":"any"}function G(e,t,n){var r;I.push((e=e,r=pxtc.DiagnosticCategory.Error,t=t,n=n,(e=e||i)&&v&&v.currModule?{fileName:P,start:e.startPos,length:e.endPos-e.startPos,line:void 0,column:void 0,code:t,category:r,messageText:n}:{fileName:P,start:0,length:0,line:void 0,column:void 0,code:t,category:r,messageText:n}))}function U(e){return e.primType||e.classType||(e.moduleType?(e.moduleType.moduleTypeMarker||(e.moduleType.moduleTypeMarker={}),e.moduleType.moduleTypeMarker):null)}function ue(e){return!U(E(e))}function pe(e,t,n){(t=E(t)).classType!=n&&(ue(t)?t.classType=n:$(e,t,(k(e=n),e.pyInstanceType||G(null,9527,D.U.lf("Instance type symbol '{0}' is missing pyInstanceType",e)),e.pyInstanceType)))}function C(e,t){$(e,Q(e),t)}function $(t,n,r){if(n!==r&&(n=E(n))!==(r=E(r))&&!me(n)&&!me(r)){if("any"===n.primType)return n.unifyWith=r;var e,i,s=U(n),o=U(r);if(s&&o)if(s===o){if(n.unifyWith=r,n.typeArgs&&r.typeArgs)for(let e=0;e<Math.min(n.typeArgs.length,r.typeArgs.length);++e)$(t,n.typeArgs[e],r.typeArgs[e]);n.unifyWith=r}else e=n,i=r,G(t,9500,D.U.lf("types not compatible: {0} and {1}",N(e),N(i)));else s&&!o?$(t,r,n):(R++,n.unifyWith=r)}}function ce(e,t){var n=E(Q(e)),t=E(t);!function e(t,n){var r=E(t),t=E(n);if(r===t)return 1;const i=U(r),s=U(t);if(i===s)return 1;if(i&&s){if(fe(i)&&fe(s)&&i.extendsTypes&&i.extendsTypes.length&&i.extendsTypes.some(e=>e===s.qName))return 1;if(se(t))for(var o of t.typeArgs||[])if(e(r,o))return 1}}(n,t)&&(re(n)||re(t)||ie(n)||ie(t))&&$(e,n,t)}function fe(e){return!(null==(e=e)||!e.name)}function me(e){return null!=(e=null==e?void 0:e.primType)&&e.startsWith("'")}function de(e,t){var n=/(.*)\.(.*)/.exec(t),r=n?n[2]:t;return{kind:e,name:r,pyName:r,qName:t,pyQName:t,namespace:n?n[1]:"",attributes:{},pyRetType:a()}}function l(e,t){let n=w[t];return n?n.kind=e:((n=de(e,t)).pyQName||G(null,9527,D.U.lf("Symbol '{0}' is missing pyQName",t)),w[n.pyQName]=n),n}function ye(e){let t=e;for(;t;){if("FunctionDef"==t.kind)return 1;t=t.parent}}function ke(t,n,r){if(!n.symInfo){let e=g(n);D.U.endsWith(e,".__init__")&&(e=e.slice(0,-9)+".__constructor"),ye(r=r||b())?n.symInfo=de(t,e):n.symInfo=l(t,e);t=n.symInfo;t.pyAST=n,t.pyName||G(null,9528,D.U.lf("Symbol '{0}' is missing pyName",t.qName||t.name)),r.vars[t.pyName]={symbol:t}}return n.symInfo}function xe(e){let t=e.symInfo.qName;return D.U.values(w).filter(e=>e.namespace==t&&2==e.kind)}function T(e,t,n=!1,r=!1){var i=e.pyQName+"."+t,s=h(i);if(s)return s;if(!r)for(var o of e.extendsTypes||[]){o=h(o);if(o){o==e&&D.U.userError("field lookup loop on: "+o.qName+" / "+t);o=T(o,t,!0);if(o)return o}}return!n&&e.pyAST&&"ClassDef"==e.pyAST.kind?((s=l(2,i)).isInstance=!0,s):null}function ge(e,t,n=!1){const r=Q(e),i=[(s=E(r)).classType,...Te(s.primType),s.moduleType].filter(ee);var s,o,a;for(o of i){var l=T(o,t,n);if(l)return r.moduleType?l.isInstance&&G(null,9505,D.U.lf("the field '{0}' of '{1}' is not static",t,o.pyQName)):(l.isInstance||G(null,9504,D.U.lf("the field '{0}' of '{1}' is static",t,o.pyQName)),(V(a=e,"super")&&0==a.args.length||"Name"==(a=e).kind&&"self"==a.id&&(v.currClass||G(null,9529,D.U.lf("no class context found for {0}",l.pyQName)),l.namespace!=v.currClass.symInfo.qName))&&(l.isProtected=!0)),l}return null}function Te(e){let t=[];return"@array"==e?t=[o("_py.Array"),o("Array")]:"string"==e&&(t=[o("_py.String"),o("String")]),t.filter(e=>!!e)}function ve(e){let t=b(),n=D.U.lookup(t.vars,e);if(n)return n;for(;t;){var r=D.U.lookup(t.vars,e);if(r)return r;for(;(t=t.parent)&&"ClassDef"==t.kind;);}return null}function he(e){if(!e)return null;const t=e.indexOf(".");if(0<t){const n=ve(e.slice(0,t)),r=null==n?void 0:n.symbol;r&&r.pyQName!=r.pyName&&(e=r.pyQName+e.slice(t))}else{const t=ve(e);if(t)return t}let n=h(e);return n?{symbol:n}:void 0}function Se(e){return null==(e=he(e))?void 0:e.symbol}function Q(e){return e.tsType?E(e.tsType):(e.tsType=a(),e.tsType)}function be(e){if(e)switch(e.kind){case 5:case 9:case 8:case 6:return 1;default:return}}function Ee(e){var t=D.U.flatClone(v);let n;try{n=e()}finally{v=t}return n}function Ne(e,t){return 0==t.length?q.mkText(""):q.mkGroup([q.mkText("/* TODO: "+e+" "),q.mkGroup(t),q.mkText(" */"),q.mkNewLine()])}function Ue(e){var t=H(e.value);return e.arg?q.mkInfix(q.mkText(e.arg),"=",t):q.mkGroup([q.mkText("**"),t])}function Ce(e){if(!e)return a();var t=W(e);if(t){var n=o(t+"@type")||o(t);if(n){if(k(n),6==n.kind)return m;if(n.pyInstanceType)return n.pyInstanceType}else if(He[t])return He[t];G(e,9506,D.U.lf("cannot find type '{0}'",t))}else if(M.isSubscript(e)&&"List"===W(e.value)&&M.isIndex(e.slice))return S(Ce(e.slice.value));return G(e,9507,D.U.lf("invalid type syntax")),a({})}const Je={Sub:1,Div:1,Pow:1,LShift:1,RShift:1,BitOr:1,BitXor:1,BitAnd:1,FloorDiv:1,Mult:1},Xe={Add:"+",Sub:"-",Mult:"*",MatMult:"Math.matrixMult",Div:"/",Mod:"%",Pow:"**",LShift:"<<",RShift:">>",BitOr:"|",BitXor:"^",BitAnd:"&",FloorDiv:"Math.idiv",And:"&&",Or:"||",Eq:"==",NotEq:"!=",Lt:"<",LtE:"<=",Gt:">",GtE:">=",Is:"===",IsNot:"!==",In:"py.In",NotIn:"py.NotIn"},Ye={Invert:"~",Not:"!",UAdd:"P+",USub:"P-"},Ze={"adafruit_bus_device.i2c_device.I2CDevice":"pins.I2CDevice"};function u(e){v.blockDepth++;e=q.mkBlock(e.map(J));return v.blockDepth--,e}function Ae(e){e.vars||(e.vars={},e.parent=b(),e.blockDepth=v.blockDepth)}function we(e,t=!1){return"any"===N(e)?t?q.mkText(": any"):q.mkText(""):q.mkText(": "+N(e))}function e(e,t){try{return Ee(t)}catch(t){return console.log(t),q.mkStmt(Ne("conversion failed for "+(e.name||e.kind),[]))}}function Pe(e){if(e&&e.pyAST&&"FunctionDef"==e.pyAST.kind)return(e=e.pyAST).callers&&1==e.callers.length&&!e.callers[0].inCalledPosition}function Ie(m,d=!1){return e(m,()=>{var e=!!v.currClass&&!v.currFun,t=ae(),n=!!v.currFun,r=(Ae(m),Se(g(m))),i=ke(e?1:3,m);if(!d&&(r&&r.declared===y&&G(m,9520,lf("Duplicate function declaration")),i.declared=y,Pe(i)))return q.mkText("");e&&(i.isInstance=!0),v.currFun=m;let s="",o=m.name;var r=[Ne("decorators",m.decorator_list.filter(e=>"property"==W(e)?!(s="get"):"Attribute"!=e.kind||"setter"!=e.attr||"Name"!=e.value.kind||(o=e.value.id,!(s="set"))).map(H))],a=(1<=m.body.length&&"Raise"==m.body[0].kind&&(m.alwaysThrows=!0),e?(v.currClass||G(m,9531,lf("method '{0}' is missing current class context",i.pyQName)),i.pyRetType||G(m,9532,lf("method '{0}' is missing a return type",i.pyQName)),"__init__"==m.name?(r.push(q.mkText("constructor")),pe(m,i.pyRetType,v.currClass.symInfo)):("__get__"!=o&&"__set__"!=o||(a=null==(a=m.vars.value)?void 0:a.symbol,"__set__"==o&&a&&(c=T(v.currClass.symInfo,"__get__"))&&c.pyAST&&"FunctionDef"==c.pyAST.kind&&$(m,a.pyRetType,c.pyRetType),o=o.replace(/_/g,"")),s=s||("_"==o[0]?i.isProtected?"protected":"private":"public"),r.push(q.mkText(s+" "),j(o)))):(D.U.assert(!s),"_"==m.name[0]||t||d||n?r.push(q.mkText("function "),j(o)):r.push(q.mkText("export function "),j(o))),m.returns?Ce(m.returns):i.pyRetType),l=(r.push(function(i,e){const s=i.args;s.kwonlyargs.length&&G(i,9517,D.U.lf("keyword-only arguments not supported yet"));var t=s.args.slice();if(e?("self"!=t[0].arg&&G(i,9518,D.U.lf("first argument of method has to be called 'self'")),t.shift()):t.some(e=>"self"==e.arg)&&G(i,9519,D.U.lf("non-methods cannot have an argument called 'self'")),!i.symInfo.parameters){let r=s.defaults.length-t.length;i.symInfo.parameters=t.map(e=>{e.annotation||G(i,9519,D.U.lf("Arg '{0}' missing annotation",e.arg));let t=Ce(e.annotation),n="";return 0<=r&&(n=q.flattenNode([H(s.defaults[r])]).output,$(e,t,Q(s.defaults[r]))),r++,{name:e.arg,description:"",type:"",initializer:n,default:n,pyType:t}})}e=i.symInfo.parameters.map(e=>{var t=x(e.name,{isParam:!0}),t=null==t?void 0:t.symbol,t=(e.pyType||G(i,9530,D.U.lf("parameter '{0}' missing pyType",e.name)),$(i,k(t),e.pyType),[j(e.name),we(e.pyType,!0)]);return e.default&&t.push(q.mkText(" = "+e.default)),q.mkGroup(t)});return s.vararg&&e.push(q.mkText("TODO *"+s.vararg.arg)),s.kwarg&&e.push(q.mkText("TODO **"+s.kwarg.arg)),q.H.mkParenthesizedExpression(q.mkCommaSep(e))}(m,e),a&&E(a)!=Ve?we(a):q.mkText("")),k(i),m.body.map(J));if("__init__"==m.name){v.currClass||G(m,9533,lf("__init__ method '{0}' is missing current class context",i.pyQName));for(var u of xe(v.currClass)){var p=u.pyAST;p&&p.value&&l.push(q.mkStmt(q.mkText(`this.${z(u.pyName)} = `),H(p.value)))}}var c=Ge(m);r.push(q.mkBlock(c.concat(l)));let f=q.mkGroup(r);return d?r[r.length-1].noFinalNewline=!0:f=q.mkStmt(f),f})}const et={FunctionDef:e=>Ie(e),ClassDef:r=>e(r,()=>{Ae(r);var e=ke(8,r),t=(D.U.assert(!v.currClass),ae()),t=((v.currClass=r).isNamespace=r.decorator_list.some(e=>"Name"==e.kind&&"namespace"==e.id),r.isNamespace?[q.mkText("namespace "),j(r.name)]:[Ne("keywords",r.keywords.map(Ue)),Ne("decorators",r.decorator_list.map(H)),q.mkText(t?"class ":"export class "),j(r.name)]),e=(!r.isNamespace&&0<r.bases.length&&("Enum"==W(r.bases[0])?r.isEnum=!0:(t.push(q.mkText(" extends ")),t.push(q.mkCommaSep(r.bases.map(H))),(n=(n=Se(f(r.bases[0])))&&n.pyAST&&"ClassDef"==n.pyAST.kind?n.pyAST:null)&&(r.baseClass=n,e.extendsTypes=[n.symInfo.pyQName]))),u(r.body)),n=(t.push(e),xe(r).filter(e=>2==e.kind&&e.isInstance).map(e=>(e.pyName&&e.pyRetType||G(r,9535,lf("field definition missing py name or ret type",e.qName)),e)).map(e=>q.mkStmt(e.pyName&&"_"==e.pyName[0]?e.isProtected?q.mkText("protected "):q.mkText("private "):q.mkText(""),j(e.pyName),we(e.pyRetType))));return e.children=n.concat(e.children),q.mkStmt(q.mkGroup(t))}),Return:e=>{var t;return e.value?((t=v.currFun)&&(t.symInfo.pyRetType||G(e,9536,lf("function '{0}' missing return type",t.symInfo.pyQName)),C(e.value,t.symInfo.pyRetType)),q.mkStmt(q.mkText("return "),H(e.value))):q.mkStmt(q.mkText("return"))},AugAssign:e=>{var t=Xe[e.op];return 3<t.length?q.mkStmt(q.mkInfix(H(e.target),"=",q.H.mkCall(t,[H(e.target),H(e.value)]))):q.mkStmt(H(e.target),q.mkText(" "+t+"= "),H(e.value))},Assign:e=>n(e),AnnAssign:e=>n(e),For:e=>{var t,n,r,i,s;if(D.U.assert(0==e.orelse.length),e.target.forTargetEndPos=e.endPos,V(e.iter,"range"))return t=e.iter,n=H(e.target),r=j(f(e.target)),C(e.target,m),i=1==t.args.length?q.mkText("0"):H(t.args[0]),s=H(t.args[1==t.args.length?0:1]),q.mkStmt(q.mkText("for ("),q.mkInfix(n,"=",i),q.mkText("; "),q.mkInfix(r,"<",s),q.mkText("; "),3<=t.args.length?q.mkInfix(r,"+=",H(t.args[2])):q.mkPostfix([r],"++"),q.mkText(")"),u(e.body));if(1<y){const D=Q(e.target);C(e.iter,Q(e.iter)==X?D:S(D))}return q.mkStmt(q.mkText("for ("),H(e.target),q.mkText(" of "),H(e.iter),q.mkText(")"),u(e.body))},While:e=>(D.U.assert(0==e.orelse.length),q.mkStmt(q.mkText("while ("),H(e.test),q.mkText(")"),u(e.body))),If:e=>{let n=e=>{var t=[q.mkText("if ("),H(e.test),q.mkText(")"),u(e.body)];return e.orelse.length&&(t[t.length-1].noFinalNewline=!0,1==e.orelse.length&&"If"==e.orelse[0].kind?(t.push(q.mkText(" else ")),D.U.pushRange(t,n(e.orelse[0]))):t.push(q.mkText(" else"),u(e.orelse))),t};return q.mkStmt(q.mkGroup(n(e)))},With:r=>{if(1==r.items.length&&(i="pins.I2CDevice",(s=Q(r.items[0].context_expr)).classType&&s.classType.pyQName==i||N(s)==i)){let e=r.items[0],t=[],n=H(e.context_expr);return e.optional_vars&&(s=W(e.optional_vars))&&(i=null==(i=x(s,{isLocal:!0}))?void 0:i.symbol,s=z(s),t.push(q.mkStmt(q.mkText("const "+s+" = "),n)),i.pyRetType||G(r,9537,lf("function '{0}' missing return type",i.pyQName)),C(e.context_expr,i.pyRetType),n=q.mkText(s)),t.push(q.mkStmt(q.mkInfix(n,".",q.mkText("begin()")))),D.U.pushRange(t,r.body.map(J)),t.push(q.mkStmt(q.mkInfix(n,".",q.mkText("end()")))),q.mkGroup(t)}var i,s;let o=[],e=r.items.map((e,t)=>{let n="with"+t;return e.optional_vars&&(x(t=f(e.optional_vars),{isLocal:!0}),n=z(t)),o.push(q.mkStmt(q.mkText(n+".end()"))),q.mkStmt(q.mkText("const "+n+" = "),q.mkInfix(H(e.context_expr),".",q.mkText("begin()")))});return D.U.pushRange(e,r.body.map(J)),D.U.pushRange(e,o),q.mkBlock(e)},Raise:e=>{let t,n=e.exc||e.cause;return n?(t=(t=n&&"Call"==n.kind&&1==n.args.length?H(n.args[0]):t)||q.mkGroup([q.mkText("`"),H(n),q.mkText("`")]),q.mkStmt(q.H.mkCall("control.fail",[t]))):q.mkStmt(q.mkText("throw"))},Assert:e=>(e.msg||G(e,9537,lf("assert missing message")),q.mkStmt(q.H.mkCall("control.assert",[e.test,e.msg].filter(e=>!!e).map(H)))),Import:e=>{for(var t of e.names)t.asname&&x(t.asname,{expandsTo:t.name}),n=e,t=t.name,r=void 0,r=h(t),r||G(n,9503,D.U.lf("No module named '{0}'",t));var n,r;return q.mkText("")},ImportFrom:e=>{var t,n,r,i,s=[];for(t of e.names)"*"==t.name?(e.module||G(e,9538,lf("import missing module name")),x(e.module,{isImportStar:!0})):(r=h(n=e.module+"."+t.name),i=t.asname||t.name,be(r)?(x(i,{isImport:r,expandsTo:n}),s.push(q.mkStmt(q.mkText(`import ${z(i)} = `+n)))):x(i,{expandsTo:n}));return q.mkGroup(s)},ExprStmt:e=>{return"Str"==e.value.kind?((t=e.value.s).trim().split(/\n/).length<=1?t=t.trim():t+="\n",q.mkStmt(q.mkText("/** "+t+" */"))):q.mkStmt(H(e.value));var t},Pass:e=>q.mkStmt(q.mkText("")),Break:e=>q.mkStmt(q.mkText("break")),Continue:e=>q.mkStmt(q.mkText("continue")),Delete:e=>(G(e,9550,D.U.lf("delete statements are unsupported")),c(e)),Try:e=>{var t,n=[q.mkText("try"),u(e.body.concat(e.orelse))];for(t of e.handlers)n.push(q.mkText("catch ("),t.name?j(t.name):q.mkText("_")),t.type&&n.push(q.mkText("/* instanceof "),H(t.type),q.mkText(" */")),n.push(q.mkText(")"),u(t.body));return e.finalbody.length&&n.push(q.mkText("finally"),u(e.finalbody)),q.mkStmt(q.mkGroup(n))},AsyncFunctionDef:e=>(G(e,9551,D.U.lf("async function definitions are unsupported")),c(e)),AsyncFor:e=>(G(e,9552,D.U.lf("async for statements are unsupported")),c(e)),AsyncWith:e=>(G(e,9553,D.U.lf("async with statements are unsupported")),c(e)),Global:e=>{var t=oe();b();for(const q of e.names)D.U.lookup(t.vars,q)||G(e,9521,D.U.lf("No binding found for global variable")),x(q,{},M.VarModifier.Global).firstRefPos<e.startPos&&G(e,9522,D.U.lf("Variable referenced before global declaration"));return q.mkStmt(q.mkText(""))},Nonlocal:e=>{var t=oe(),n=b();for(const q of e.names){var r=Be(q,n);r&&r!==t&&r.vars[q].modifier!==M.VarModifier.Global||G(e,9523,D.U.lf("No binding found for nonlocal variable")),x(q,{},M.VarModifier.NonLocal).firstRefPos<e.startPos&&G(e,9524,D.U.lf("Variable referenced before nonlocal declaration"))}return q.mkStmt(q.mkText(""))}};function n(e){let t,n,r,i;if("Assign"===e.kind){if(1!=e.targets.length)return G(e,9553,D.U.lf("multi-target assignment statements are unsupported")),c(e);i=e.targets[0],r=e.value,t=null,n=null}else{if("AnnAssign"!==e.kind)return e;i=e.target,r=e.value||null,t=e.annotation,n=Ce(t),C(i,n)}let s,o="",a=!!r&&V(r,"const"),l=W(i)||"";if(ae()||v.currClass||v.currFun||"_"==l[0]||(o="export "),l&&v.currClass&&!v.currFun){a=!(!r||!v.currClass.isNamespace);var u=T(v.currClass.symInfo,l);if(u||G(e,9544,lf("cannot get class field")),0==y)return q.mkText("/* skip for now */");u.pyRetType||G(e,9539,lf("function '{0}' missing return type",u.pyQName)),C(i,u.pyRetType),u.isInstance=!1,o=v.currClass.isNamespace?`export ${a?"const":"let"} `:"static "}if(!r)return G(e,9555,D.U.lf("unable to determine value of assignment")),c(e);if(C(i,Q(r)),a)return x(f(i),{}),/^static /.test(o)||/const/.test(o)||(o+="const "),q.mkStmt(q.mkText(o),q.mkInfix(H(i),"=",H(r)));var p;if(!o&&"Tuple"==i.kind)return u=i,p=[q.mkText("let "),q.mkText("[")],u.elts.filter(e=>"Name"!==e.kind).length?(G(e,9556,D.U.lf("non-trivial tuple assignment unsupported")),c(e)):(e=u.elts.map(e=>e).map(function(e){return Le(e,"identifierCompletion"),Q(e),Re(e),_e(e,!0)}),p.push(q.mkCommaSep(e)),p.push(q.mkText("]")),q.mkStmt(q.mkInfix(q.mkGroup(p),"=",H(r))));if("Name"===i.kind){const D=b().vars[l],e=null==D?void 0:D.symbol;e&&4===e.kind&&void 0===D.modifier&&(void 0===D.firstAssignPos||D.firstAssignPos>i.startPos)&&(D.firstAssignPos=i.startPos,D.firstAssignDepth=v.blockDepth)}if(t&&n&&("NameConstant"===r.kind&&null===r.value||"List"===r.kind&&0===r.elts.length)){const D=N(n);s=q.mkInfix(H(i),":",q.mkText(D))}return s=s||H(i),q.mkStmt(q.mkText(o),q.mkInfix(s,"=",H(r)))}function _e(e,t=!1){let n=e.id,r=he(n),i=null==r?void 0:r.symbol,s=b().vars[n],o=null==s?void 0:s.symbol;return void 0===e.isdef&&(!i||4===i.kind&&i!==o?(r=v.currClass&&!v.currFun?(e.isdef=!1,x(n,{})):x(n,{isLocal:e.isdef=!0}),i=r.symbol):e.isdef=!1,e.symbolInfo=i,e.tsType||G(e,9540,lf("definition missing ts type")),i.pyRetType||G(e,9568,lf("missing py return type")),$(e,e.tsType,i.pyRetType)),e.isdef&&$e(r,b())&&(e.isdef=!1),Oe(r,e),e.isdef&&!t?q.mkGroup([q.mkText("let "),j(n)]):j(n)}function z(e){return q.isReservedWord(e)?e+"_":e}function W(e){var t;if("Name"==e.kind)return(n=null==(n=ve(t=e.id))?void 0:n.symbol)&&n.expandsTo?n.expandsTo:t;if("Attribute"==e.kind){var n=W(e.value);if(n)return n+"."+e.attr}}function f(e){var t=W(e);return t||G(null,9542,lf("Cannot get name of unknown expression kind '{0}'",e.kind)),t}function j(e){return"self"==e?q.mkText("this"):q.mkText(z(e))}function V(e,t){return"Call"==e.kind&&W(e.func)===t}function p(e,t,n){t=Xe[t];return D.U.assert(!!t),3<t.length?q.H.mkCall(t,[e,n]):q.mkInfix(e,t,n)}const tt={memoryview:{n:"",t:O},const:{n:"",t:m},"micropython.const":{n:"",t:m}},Z=function(){let n={};return Object.keys(pxtc.ts2PyFunNameMap).forEach(e=>{var t=pxtc.ts2PyFunNameMap[e];t&&t.n&&(e={n:e,t:function(e){switch(e){case ts.SyntaxKind.StringKeyword:return X;case ts.SyntaxKind.NumberKeyword:return m;case ts.SyntaxKind.BooleanKeyword:return je;case ts.SyntaxKind.VoidKeyword:return Ve;case ts.SyntaxKind.AnyKeyword:return Y;default:return O}}(t.t),scale:t.scale},n[t.n]=e)}),Object.keys(tt).forEach(e=>{n[e]=tt[e]}),n}();function Ke(e){return K&&e.startPos<=K.position&&K.position<=e.endPos}function Le(e,t){100<y&&K&&null==L&&(K.type==t||"symbol"==K.type)&&Ke(e)&&(L=e,F=b())}function Fe(e,t){t&&t.pyAST&&"FunctionDef"==t.pyAST.kind&&((t=t.pyAST).callers||(t.callers=[]),t.callers.indexOf(e)<0)&&t.callers.push(e)}const nt={BoolOp:t=>{let n=H(t.values[0]);for(let e=1;e<t.values.length;++e)n=p(n,t.op,H(t.values[e]));return n},BinOp:t=>{var e,n,r=function(){if("Mod"!=t.op||"Str"!=t.left.kind||"Tuple"!=t.right.kind&&"List"!=t.right.kind)return null;{let e=t.left.s,i=t.right.elts,s=(i=i.slice(),[q.mkText("`")]);return e.replace(/([^%]+)|(%[\d\.]*([a-zA-Z%]))/g,(e,t,n,r)=>{return t?s.push(q.mkText(t.replace(/[`\\$]/g,e=>"\\"+e))):(t=(t=i.shift())?H(t):q.mkText("???"),s.push(q.mkText("${"),t,q.mkText("}"))),""}),s.push(q.mkText("`")),q.mkGroup(s)}}();return r||(e=H(t.left),n=H(t.right),We(t.left)&&We(t.right)&&"Add"===t.op?q.H.extensionCall("concat",[e,n],!1):(r=p(e,t.op,n),Je[t.op]&&(C(t.left,m),C(t.right,m),t.tsType||G(t,9570,lf("binary op missing ts type")),$(t,t.tsType,m)),r))},UnaryOp:e=>{var t=Ye[e.op];return D.U.assert(!!t),q.mkInfix(null,t,H(e.operand))},Lambda:e=>(G(e,9574,D.U.lf("lambda expressions are not supported yet")),r(e)),IfExp:e=>q.mkInfix(q.mkInfix(H(e.test),"?",H(e.body)),":",H(e.orelse)),Dict:n=>{v.blockDepth++;var e=n.keys.map((e,t)=>{t=n.values[t];return void 0===e?r(n):q.mkStmt(q.mkInfix(H(e),":",H(t)),q.mkText(","))}),e=q.mkBlock(e);return v.blockDepth--,e},Set:e=>r(e),ListComp:e=>r(e),SetComp:e=>r(e),DictComp:e=>r(e),GeneratorExp:n=>{if(1==n.generators.length&&"Comprehension"==n.generators[0].kind){let t=n.generators[0];if(0==t.ifs.length)return Ee(()=>{var e=f(t.target);return x(e,{isParam:!0}),q.mkInfix(H(t.iter),".",q.H.mkCall("map",[q.mkGroup([j(e),q.mkText(" => "),H(n.elt)])]))})}return r(n)},Await:e=>r(e),Yield:e=>r(e),YieldFrom:e=>r(e),Compare:t=>{var e;if(1==t.ops.length&&("In"==t.ops[0]||"NotIn"==t.ops[0]))return E(Q(t.comparators[0]))==X&&C(t.left,X),e=q.mkInfix(H(t.comparators[0]),".",q.H.mkCall("indexOf",[H(t.left)])),q.mkInfix(e,"In"==t.ops[0]?">=":"<",q.mkText("0"));let n=p(H(t.left),t.ops[0],H(t.comparators[0]));for(let e=1;e<t.ops.length;++e)n=p(n,"And",p(H(t.comparators[e-1]),t.ops[e],H(t.comparators[e])));return n},Call:n=>{n.func.inCalledPosition=!0;let t,r,i=W(n.func),e=Se(i),s=e&&8==e.kind,o=e,a="";var l;s?o=Se(e.pyQName+".__constructor"):"Attribute"==n.func.kind&&(l=n.func,r=l.value,(t=Q(r)).classType||t.primType)&&(a=l.attr,o=ge(r,a,!0))&&(a=o.name);let u=n.args.slice();if("super"==i&&0==u.length)return v.currClass&&v.currClass.baseClass&&(n.tsType||G(n,9543,lf("call expr missing ts type")),pe(n,n.tsType,v.currClass.baseClass.symInfo)),q.mkText("super");if(V(n,"int")&&1===u.length&&u[0]){const D=u[0],n=H(D),t=Q(D);if("string"===t.primType)return q.mkGroup([q.mkText("parseInt"),q.mkText("("),n,q.mkText(")")]);if("number"===t.primType)return q.mkGroup([q.mkInfix(q.mkText("Math"),".",q.mkText("trunc")),q.mkText("("),n,q.mkText(")")])}if(!o){let e=D.U.lookup(Z,i);if((a=e?"":a)&&(i=N(t)+"."+a,(e=D.U.lookup(Z,i))||"@array"!=U(E(t))||(i="Array."+a,e=D.U.lookup(Z,i))),a="",e)if("."==e.n[0]&&u.length){if(r=u.shift(),t=Q(r),a=e.n.slice(1),(o=ge(r,a))&&2==o.kind)return q.mkInfix(H(r),".",q.mkText(a))}else o=h(e.n)}if(V(n,"str"))return $(n,n.tsType,X),q.mkInfix(q.mkText('""'),"+",H(n.args[0]));o||G(n,9508,D.U.lf("can't find called function '{0}'",i));let p=o?o.parameters:null,c=[];if(p){for(u.length>p.length&&G(n,9510,D.U.lf("too many arguments in call to '{0}'",o.pyQName));u.length<p.length;)u.push(null);u=u.slice(0,p.length);for(let t of n.keywords){var f=p.findIndex(e=>e.name==t.arg);f<0?G(t,9511,D.U.lf("'{0}' doesn't have argument named '{1}'",o.pyQName,t.arg)):null!=u[f]?G(t,9512,D.U.lf("argument '{0} already specified in call to '{1}'",t.arg,o.pyQName)):u[f]=t.value}for(let e=u.length-1;0<=e&&p[e].initializer&&null==u[e];e--)u.pop();for(let e=0;e<u.length;++e){var m=u[e];if(null!=m||p[e].initializer)if(m){p[e].pyType||G(n,9545,lf("formal arg missing py type"));const D=p[e].pyType;"any"!==D.primType&&ce(m,D),"Name"==m.kind&&Pe(m.symbolInfo)?c.push(Ie(m.symbolInfo.pyAST,!0)):c.push(H(m))}else p[e].initializer||G(n,9547,lf("formal arg missing initializer")),c.push(q.mkText(p[e].initializer));else G(n,9513,D.U.lf("missing argument '{0}' in call to '{1}'",p[e].name,o.pyQName)),c.push(q.mkText("null"))}}else o&&G(n,9509,D.U.lf("calling non-function")),c=u.map(H);if(!L&&K&&"signature"==K.type&&Ke(n)){L=n,F=b();for(let e=K.auxResult=0;e<u.length;++e){K.auxResult=e;var d=u[e];if(!d)break;if(d.startPos<=K.position&&K.position<=d.endPos)break}}if(o){o.pyRetType||G(n,9549,lf("function missing pyRetType"));if(r&&We(r)&&t){var y=n;var k=o;var x=t;switch(k.qName){case"Array.pop":case"Array.removeAt":case"Array.shift":case"Array.find":case"Array.get":case"Array._pickRandom":C(y,x.typeArgs[0]);break;case"Array.concat":case"Array.slice":case"Array.filter":case"Array.fill":C(y,x);break;case"Array.reduce":if("Call"===y.kind&&1<y.args.length){const k=Q(y.args[1]);k&&C(y,k)}break;case"Array.map":C(y,S(Y));break;default:C(y,k.pyRetType)}}else C(n,o.pyRetType);n.symbolInfo=o;if(o.attributes.py2tsOverride){const D=function(e){var t=new RegExp(/([^\$]*\()?([^\$\(]*)\$(\d)(?:(?:(?:=(\d+|'[a-zA-Z0-9_]*'|false|true|null|undefined))|(\?)|))/,"y"),n=[];let r,i=0;for(;i=t.lastIndex,(r=t.exec(e))&&(r[1]&&n.push({kind:"text",text:r[1]}),n.push({kind:"arg",prefix:r[2],index:parseInt(r[3]),default:r[4],isOptional:!!r[5]})),r;);return null!=i?n.push({kind:"text",text:e.substr(i)}):n.push({kind:"text",text:e}),{parts:n}}(o.attributes.py2tsOverride);if(D)return a&&!r&&G(n,9550,lf("missing recv")),(l=function(e,t,n){var r=[];for(const n of e.parts)if("text"===n.kind)r.push(q.mkText(n.text));else if(t[n.index]||n.default)n.prefix&&r.push(q.mkText(n.prefix)),t[n.index]?r.push(t[n.index]):r.push(q.mkText(n.default));else if(!n.isOptional)return;return n?q.mkInfix(n,".",q.mkGroup(r)):q.mkGroup(r)}(D,c,a?H(r):void 0))||G(n,9555,lf("buildOverride failed unexpectedly")),l}else if(o.attributes.pyHelper)return q.mkGroup([q.mkInfix(q.mkText("_py"),".",q.mkText(o.attributes.pyHelper)),q.mkText("("),q.mkCommaSep(r?[H(r)].concat(c):c),q.mkText(")")])}let g=a?q.mkInfix(H(r),".",q.mkText(a)):H(n.func),T=[g,q.mkText("("),q.mkCommaSep(c),q.mkText(")")];return o&&1==c.length&&pxtc.service.isTaggedTemplate(o)&&(T=[g,(l=c[0]).type==q.NT.Prefix&&'"'==l.op[0]?q.mkText(q.backtickLit(JSON.parse(l.op))):l]),s&&(e&&e.pyQName||G(n,9551,lf("missing namedSymbol or pyQName")),T[0]=q.mkText(le(e.pyQName)),T.unshift(q.mkText("new "))),q.mkGroup(T)},Num:e=>(e.tsType||G(e,9556,lf("tsType missing")),$(e,e.tsType,m),q.mkText(e.ns)),Str:e=>(e.tsType||G(e,9557,lf("tsType missing")),$(e,e.tsType,X),q.mkText(q.stringLit(e.s))),FormattedValue:e=>r(e),JoinedStr:e=>r(e),Bytes:e=>q.mkText(`hex\`${D.U.toHex(new Uint8Array(e.s))}\``),NameConstant:e=>(null!==e.value&&(e.tsType||G(e,9558,lf("tsType missing")),$(e,e.tsType,je)),q.mkText(JSON.stringify(e.value))),Ellipsis:e=>r(e),Constant:e=>r(e),Attribute:e=>{let t=H(e.value),n=Q(e.value),r=ge(e.value,e.attr),i=e.attr;var s;return Le(e,"memberCompletion"),r?(e.symbolInfo=r,Fe(e,r),e.tsType&&r.pyRetType||G(e,9559,lf("tsType or pyRetType missing")),$(e,e.tsType,r.pyRetType),i=r.name):n.moduleType?(s=h(n.moduleType.pyQName+"."+e.attr))?(e.symbolInfo=s,Fe(e,s),C(e,k(s)),i=s.name):G(e,9514,D.U.lf("module '{0}' has no attribute '{1}'",n.moduleType.pyQName,e.attr)):2<y&&G(e,9515,D.U.lf("unknown object type; cannot lookup attribute '{0}'",e.attr)),q.mkInfix(t,".",q.mkText(z(i)))},Subscript:e=>{var t,n;return"Index"==e.slice.kind?(n=E(Q(e.value)),We(e.value)?C(e,n.typeArgs[0]):"string"===n.primType?C(e,n):2<y&&ue(Q(e))&&C(e,Y),n=e.slice.value,2<y&&ue(Q(n))&&C(n,m),q.mkGroup([H(e.value),q.mkText("["),H(n),q.mkText("]")])):"Slice"==e.slice.kind?(C(e,n=Q(e.value)),(t=e.slice).step?(n="string"===(null==n?void 0:n.primType),q.H.mkCall(n?"_py.stringSlice":"_py.slice",[H(e.value),t.lower?H(t.lower):q.mkText("null"),t.upper?H(t.upper):q.mkText("null"),H(t.step)])):q.mkInfix(H(e.value),".",q.H.mkCall("slice",[t.lower?H(t.lower):q.mkText("0"),t.upper?H(t.upper):null].filter(ee)))):r(e)},Starred:e=>q.mkGroup([q.mkText("... "),H(e.value)]),Name:e=>{var t,n;return Le(e,"identifierCompletion"),"self"==e.id&&v.currClass?(e.tsType||G(e,9560,lf("missing tsType")),pe(e,e.tsType,v.currClass.symInfo),q.mkText("this")):(n=null==(t=Re(e))?void 0:t.symbol)&&n.isImport?j(n.name):(Oe(t,e),0<=e.ctx.indexOf("Load")?n?null!=n&&n.qName?j(n.qName.replace("@type","")):(G(e,9561,lf("missing qName")),j("unknown")):j(f(e)):_e(e))},List:De,Tuple:De};function Re(e){let t=he(e.id),n=null==t?void 0:t.symbol;var r;if(t||(r=D.U.lookup(Z,e.id))&&(t=he(r.n)),t&&n){if(e.symbolInfo=n,e.tsType||G(e,9562,lf("missing tsType")),$(e,e.tsType,k(n)),n.isImport)return t;Fe(e,n),e.forTargetEndPos&&t.forVariableEndPos!==e.forTargetEndPos&&(t.forVariableEndPos?t.lastRefPos=t.forVariableEndPos+1:t.forVariableEndPos=e.forTargetEndPos)}else 0<y&&G(e,9516,D.U.lf("name '{0}' is not defined",e.id));return t}function Oe(e,t){if(e){if(e.modifier===M.VarModifier.Global){const M=oe();M&&M.vars[e.symbol.name]&&(e=M.vars[e.symbol.name])}else if(e.modifier===M.VarModifier.NonLocal){const M=Be(e.symbol.name,b());M&&(e=M.vars[e.symbol.name])}(void 0===e.firstRefPos||e.firstRefPos>t.startPos)&&(e.firstRefPos=t.startPos),(void 0===e.lastRefPos||e.lastRefPos<t.startPos)&&(e.lastRefPos=t.startPos)}}function De(e){return e.tsType||G(e,9563,lf("missing tsType")),$(e,e.tsType,S(e.elts[0]?Q(e.elts[0]):a())),q.mkGroup([q.mkText("["),q.mkCommaSep(e.elts.map(H)),q.mkText("]")])}function Me(e){return e.startPos+":"+e.endPos}function H(e){i=e;var t=nt[e.kind],t=(t||D.U.oops(e.kind+" - unknown expr"),Q(e),t(e));return t.id=Me(e),t}function J(e){i=e;var t=et[e.kind];t||D.U.oops(e.kind+" - unknown stmt");let n=(e._comments||[]).map(e=>e.value),r=t(e);return(r=n.length?q.mkGroup(n.map(e=>q.mkStmt(q.H.mkComment(e))).concat(r)):r).id=Me(e),r}function qe(e){return!e||(e.type==q.NT.Prefix&&""==e.op?e.children.every(qe):e.type==q.NT.NewLine)}function Be(e,t){var n;if(t)return(n=t.vars&&t.vars[e])&&n.modifier!=M.VarModifier.NonLocal?t:Be(e,t.parent)}function Ge(e){var t,n,r=[];for(const i of Object.keys(e.vars))t=e.vars[i],$e(t,e)&&r.push((t=null==t?void 0:t.symbol,n=void 0,n=j(t.name),t=N(k(t)),q.mkStmt(q.mkGroup([q.mkText("let "),n,q.mkText(": "+t+";")]))));return r}function $e(e,t){return 4===e.symbol.kind&&!e.symbol.isParam&&void 0===e.modifier&&(e.lastRefPos>e.forVariableEndPos||e.firstRefPos<e.firstAssignPos||e.firstAssignDepth>t.blockDepth)&&("Module"!==t.kind||"main"!==t.name||0!==e.firstAssignDepth)}function Qe(e){var t;if(D.U.assert("Module"==e.kind),!e.tsBody)return v={currClass:void 0,currFun:void 0,currModule:t=e,blockDepth:0},P=t.tsFilename.replace(/\.ts$/,".py"),e.vars||(e.vars={}),(t=Ge(e).concat(e.body.map(J))).every(qe)?void 0:"main"==e.name?t:[q.mkText("namespace "+e.name+" "),q.mkBlock(t)]}function ze(e){y=e,I=[],R=0,i=void 0}function We(e){e=E(Q(e));return e&&"@array"===e.primType}M.py2ts=function(t){var n=[],e={},r=(I=[],D.U.assert(!!t.sourceFiles,"missing sourceFiles! Cannot convert py to ts"),t.sourceFiles.filter(e=>D.U.endsWith(e,".py")));if(0==r.length)return{outfiles:e,diagnostics:I,success:0===I.length,sourceMap:[]};let i=(e,t)=>e.substr(0,e.length-t.length),s=D.U.toDictionary(r,e=>i(e,".py")),o=t.sourceFiles.filter(e=>D.U.endsWith(e,".ts")).filter(e=>i(e,".ts")in s);D.U.assert(!!t.apisInfo,"missing apisInfo! Cannot convert py to ts"),P=r[0];var a=t.apisInfo,l=o;w={},A={};var u,p=D.U.toDictionary(l,e=>e);for(u of D.U.values(a.byQName))if(!p.hasOwnProperty(u.fileName)){let t=u;t.extendsTypes&&(t.extendsTypes=t.extendsTypes.filter(e=>e!=t.qName)),t.pyQName&&t.qName||G(null,9526,D.U.lf("Symbol '{0}' is missing qName for '{1}'",t.name,t.pyQName?"ts":"py")),A[t.pyQName]=t,A[t.qName]=t}O=B("Buffer"),_=t,K=void 0,t.generatedFiles||(t.generatedFiles=[]);for(const M of r){var c=M,f=M.replace(/\.py$/,"").replace(/.*\//,""),m=t.fileSystem[M];try{P=M;var d=D.py.lex(m),y=D.py.parse(m,c,d);D.U.pushRange(I,y.diagnostics),n.push({kind:"Module",body:y.stmts,blockDepth:0,name:f,source:m,tsFilename:c.replace(/\.py$/,".ts")})}catch(e){console.log("Parse error",e)}}var k,l=I;for(let e=0;e<5;++e){ze(e);for(var x of n)try{Qe(x)}catch(e){console.log("Conv pass error",e)}if(0==R)break}ze(1e3),L=void 0,K=t.syntaxInfo||{position:0,type:"symbol"};let g=[];for(k of n)try{var T=Qe(k);if(!T)continue;var v=q.flattenNode(T);function h(e){var t=e.id.split(":");if(2==t.length)return{py:{startPos:(t=t.map(e=>parseInt(e)))[0],endPos:t[1]},ts:{startPos:e.startPos,endPos:e.endPos}}}t.sourceFiles.push(k.tsFilename),t.generatedFiles.push(k.tsFilename),t.fileSystem[k.tsFilename]=v.output,e[k.tsFilename]=v.output,g=v.sourceMap.map(h).filter(e=>!!e)}catch(e){console.log("Conv error",e)}I=l.concat(I);let S={};a=D.U.values(A).concat(D.U.values(w));let b=[];var E=e=>{(e=>{switch(e.kind){case 6:case 7:case 4:case 3:case 5:return!0;case 2:case 1:return!e.isInstance;default:return!1}})(e)&&b.indexOf(e)<0&&(e=te(e),S[e.qName||e.name]=e)};for(let e=F;e;e=e.parent)e&&e.vars&&D.U.values(e.vars).map(e=>e.symbol).forEach(E);if(a.forEach(E),K&&L){if(L=L,K.beginPos=L.startPos,K.endPos=L.endPos,K.symbols||(K.symbols=[]),b=K.symbols.slice(),"memberCompletion"==K.type&&"Attribute"==L.kind){const D=Q(L.value);if(D.moduleType)for(var N of a)N.isInstance||N.namespace!=D.moduleType.qName||K.symbols.push(N);else if(D.classType||D.primType){const M=D.classType||Te(D.primType).reduce((e,t)=>e||t,null);if(M){M.extendsTypes&&M.qName||G(null,9567,lf("missing extendsTypes or qName"));var U,C=M.extendsTypes.concat(M.qName);for(U of a)U.isInstance&&0<=C.indexOf(U.namespace)&&K.symbols.push(U)}}}else"identifierCompletion"==K.type?K.symbols=D.U.values(S):(r=L.symbolInfo)&&K.symbols.push(r);K.symbols=K.symbols.map(te)}l=function(){for(var e of I)M.patchPosition(e,t.fileSystem[e.fileName]);return I}();return{outfiles:e,success:0===l.length,diagnostics:l,syntaxInfo:K,globalNames:S,sourceMap:g}}}}(pxt=pxt||{}),function(w){{var P=w.py||(w.py={}),e;let h;(e=h=P.TokenType||(P.TokenType={}))[e.Id=0]="Id",e[e.Op=1]="Op",e[e.Keyword=2]="Keyword",e[e.Number=3]="Number",e[e.String=4]="String",e[e.NewLine=5]="NewLine",e[e.Comment=6]="Comment",e[e.Indent=7]="Indent",e[e.Dedent=8]="Dedent",e[e.EOF=9]="EOF",e[e.Error=10]="Error",P.keywords={False:!0,None:!0,True:!0,and:!0,as:!0,assert:!0,async:!0,await:!0,break:!0,class:!0,continue:!0,def:!0,del:!0,elif:!0,else:!0,except:!0,finally:!0,for:!0,from:!0,global:!0,if:!0,import:!0,in:!0,is:!0,lambda:!0,nonlocal:!0,not:!0,or:!0,pass:!0,raise:!0,return:!0,try:!0,while:!0,with:!0,yield:!0};let S,b,E=[];const I={"%":"Mod","&":"BitAnd","*":"Mult","**":"Pow","+":"Add","-":"Sub","/":"Div","//":"FloorDiv","<<":"LShift",">>":"RShift","@":"MatMult","^":"BitXor","|":"BitOr"},_={"!":"Bang","!=":"NotEq","(":"LParen",")":"RParen",",":"Comma","->":"Arrow",".":"Dot",":":"Colon",";":"Semicolon","<":"Lt","<=":"LtE","=":"Assign","==":"Eq",">":"Gt",">=":"GtE","[":"LSquare","]":"RSquare","{":"LBracket","}":"RBracket","~":"Invert"},K={b:/^[_0-1]$/,B:/^[_0-1]$/,o:/^[_0-7]$/,O:/^[_0-7]$/,x:/^[_0-9a-fA-F]$/,X:/^[_0-9a-fA-F]$/},L={b:2,B:2,o:8,O:8,x:16,X:16};let N,U,C=0,A=0;function r(t,n){let r=0,i=0;for(let e=0;e<t;++e)10==n.charCodeAt(e)&&(r++,i=e);return{line:r,column:t-i-1}}function s(e){switch(e.type){case h.Id:return`id(${e.value})`;case h.Op:return"'"+b[e.value]+"'";case h.Keyword:return e.value;case h.Number:return`num(${e.value})`;case h.String:return e.stringPrefix+JSON.stringify(e.value);case h.NewLine:return"<nl>";case h.Comment:return`/* ${e.value} */`;case h.Indent:return"indent"+e.value;case h.Dedent:return"dedent";case h.Error:return`[ERR: ${e.value}]`;case h.EOF:return"End of file";default:return"???"}}P.position=r,P.patchPosition=function(e,t){var n;e.start||e.length?(n=r(e.start,t),e.line=n.line,e.column=n.column,0<e.length&&(n=r(e.start+e.length-1,t),e.endLine=n.line,e.endColumn=n.column+2)):(e.start=0,e.length=0,e.line=0,e.column=0)},P.tokenToString=s,P.friendlyTokenToString=function(e,t){let n=e.endPos-e.startPos,r="";return r=(r=0==n?s(e):20<n?"`"+t.slice(e.startPos,e.startPos+20)+"`...":"`"+t.slice(e.startPos,e.endPos)+"`").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/\t/g,"\\t")},P.tokensToString=function(e){let t="",n=0;for(var r of e){var i=s(r);70<n+i.length&&(n=0,t+="\n"),0!=n&&(t+=" "),t+=i,n+=i.length,r.type!=h.NewLine&&r.type!=h.Comment||(n=0,t+="\n")}return t},P.lex=function(e){if(0==E.length){var t,n,r={'"':f,"'":f,"#":k,"\\":y,".":g};S=w.U.clone(_);for(t of Object.keys(I))S[t]=I[t],S[t+"="]=I[t]+"Assign";b={};for(n of Object.keys(S))b[S[n]]=n;for(let t=0;t<128;++t)if(P.rx.isIdentifierStart(t))E[t]=o;else{var i=String.fromCharCode(t);if(r.hasOwnProperty(i))E[t]=r[i];else if(S.hasOwnProperty(i)){let e=!1,r=S[i];for(var s of Object.keys(S))s!=i&&s.startsWith(i)&&(e=!0);E[t]=e?()=>{var e,t=r,n=U.slice(A,C+1);2==n.length&&S.hasOwnProperty(n)&&(e=U.slice(A,C+2),t=3==e.length&&S.hasOwnProperty(e)?(C+=2,S[e]):(C++,S[n])),a(t)}:()=>a(r)}else P.rx.isSpace(t)?E[t]=()=>{}:13==t?E[t]=()=>{10==U.charCodeAt(C)&&C++,m()}:P.rx.isNewline(t)?E[t]=m:T(t)?E[t]=x:E[t]=v}}for(U=e,N=[],C=0,A=0,d();C<U.length;){A=C;const w=U.charCodeAt(C++);w<128?E[w]():P.rx.isIdentifierStart(w)?o():P.rx.isSpace(w)||(P.rx.isNewline(w)?m:v)()}return A=C,m(),u(h.EOF,""),N;function u(e,t,n){e={type:e,value:t,startPos:A,endPos:C,auxValue:n};return N.push(e),e}function p(e){u(h.Error,e)}function o(){for(;P.rx.isIdentifierChar(U.charCodeAt(C));)C++;var e=U.slice(A,C),t=U.charCodeAt(C);P.keywords.hasOwnProperty(e)?u(h.Keyword,e):34==t||39==t?l(e):u(h.Id,e)}function a(e){u(h.Op,e)}function c(e){switch(e){case 97:return 7;case 98:return 8;case 102:return 12;case 110:return 10;case 114:return 13;case 116:return 9;case 118:return 11;default:return 0}}function l(e){var t,n,r=U.charCodeAt(C++);let i=!1,s=(U.charCodeAt(C)==r&&U.charCodeAt(C+1)==r&&(C+=2,i=!0),0<=(e=e.toLowerCase()).indexOf("r")),o="",a="";for(;;){const h=U.charCodeAt(C++);if(h==r){if(!i)break;if(U.charCodeAt(C)==r&&U.charCodeAt(C+1)==r){C+=2;break}a+="\\"+String.fromCharCode(r),o+=String.fromCharCode(r)}else if(92==h){let e=U.charCodeAt(C++);13==e&&10==U.charCodeAt(C)&&(e=10,C++),34==e||39==e||92==e?(s&&(a+="\\",o+="\\"),a+="\\"+String.fromCharCode(e),o+=String.fromCharCode(e)):!s&&c(e)?(a+="\\"+String.fromCharCode(e),o+=String.fromCharCode(c(e))):P.rx.isNewline(e)?s&&(o+="\\"+String.fromCharCode(e),a=(a+="\\\\")+(10==e?"\\n":"\\u"+("0000"+e.toString(16)).slice(-4))):s||48!=e?s||117!=e&&120!=e?(a+="\\\\"+String.fromCharCode(e),o+="\\"+String.fromCharCode(e)):(n=117==e?4:2,t=U.slice(C,C+n),C+=n,n=parseInt(t,16),isNaN(n)&&p(w.U.lf("invalid unicode or hex escape")),a+="\\"+String.fromCharCode(e)+t,o+=String.fromCharCode(n)):(a+="\\\\x00",o+="\0")}else{if(isNaN(h)){p(w.U.lf("end of file in a string"));break}if(P.rx.isNewline(h)&&!i){p(w.U.lf("new line in a string"));break}o+=String.fromCharCode(h),a+=String.fromCharCode(h)}}var l=u(h.String,o);l.quoted=a,l.stringPrefix=e}function f(){C--,l("")}function m(){u(h.NewLine,""),d()}function d(){let e=0;for(;;){var t=U.charCodeAt(C);if(9!=t){if(32!=t)break;e++}else e=e+8&-8;C++}u(h.Indent,""+e)}function y(){var e=U.charCodeAt(C);P.rx.isNewline(e)?(C++,13==e&&10==U.charCodeAt(C)&&C++):p(w.U.lf("unexpected character after line continuation character"))}function k(){for(u(h.NewLine,"");C<U.length&&!P.rx.isNewline(U.charCodeAt(C));)C++;u(h.Comment,U.slice(A+1,C)),13==U.charCodeAt(C)&&10==U.charCodeAt(C+1)&&C++,C++,d()}function x(){let e=U[A],t="";if("0"==e){var n,r=U[C];const s=K[r];if(s){for(C++;;){const w=U[C];if(!s.test(w))break;t+=w,C++}return void(t?(n=parseInt(t,L[r]),isNaN(n)&&p(w.U.lf("invalid number")),u(h.Number,e+r+t,n)):p(w.U.lf("expecting numbers to follow 0b, 0o, 0x")))}}let i=!1,s=!1,o=!1;for(C=A;;){const w=U.charCodeAt(C);if((!o||43!=w&&45!=w)&&(o=!1,95!=w)&&!T(w))if(s||i||46!=w){if(s||69!=w&&101!=w)break;s=!0,o=!0}else i=!0;t+=String.fromCharCode(w),C++}!i&&!s&&"0"==e&&1<t.length&&!/^0+/.test(t)&&p(w.U.lf("unexpected leading zero"));r=parseFloat(t);isNaN(r)&&p(w.U.lf("invalid number")),u(h.Number,t,r)}function g(){T(U.charCodeAt(C))?x():u(h.Op,"Dot")}function T(e){return 48<=e&&e<=57}function v(){p(w.U.lf("invalid token"))}}}}(pxt=pxt||{}),function(m){{var d=m.py||(m.py={});let l,i,s,o,a,u,p,c,f;function y(){return i[a]}function k(){for(;i[a];a++){var t=i[a];if(t.type!=d.TokenType.Comment){if(0<=l&&t.type==d.TokenType.Op)switch(t.value){case"LParen":case"LSquare":case"LBracket":l++;break;case"RParen":case"RSquare":case"RBracket":l--}if(t.type!=d.TokenType.Error){if(0<l){if(t.type==d.TokenType.NewLine||t.type==d.TokenType.Indent)continue}else if(t.type==d.TokenType.Indent){if(i[a+1].type==d.TokenType.NewLine){a++;continue}var n=parseInt(t.value),e=p[p.length-1];if(n==e)continue;if(e<n)return p.push(n);{t.type=d.TokenType.Dedent;let e=0;for(;p.length;){var r=p[p.length-1];if(!(n<r)){for(r!=n&&g(9552,m.U.lf("inconsitent indentation"));1<e;)i.splice(a,0,t),e--;return}p.pop(),e++}}}return}g(9551,t.value)}else u.push(t)}}function x(){(c=y()).type!=d.TokenType.EOF&&(a++,k())}function g(e,t){t=t||m.U.lf("invalid syntax"),e=e||9550;var n=y(),t={code:e,category:pxtc.DiagnosticCategory.Error,messageText:m.U.lf("{0} near {1}",t,d.friendlyTokenToString(n,s)),fileName:o,start:n.startPos,length:n.endPos?n.endPos-n.startPos:0,line:0,column:0};d.patchPosition(t,s),f.push(t),9572!=e&&100<f.length&&m.U.userError(m.U.lf("too many parse errors"))}function t(e,t){var n=y();(n.type==e&&n.value==t||(g(9553,m.U.lf("expecting {0}",d.tokenToString({type:e,value:t,startPos:0,endPos:0}))),n.type!=d.TokenType.NewLine))&&x()}function T(){t(d.TokenType.NewLine,"")}function v(e){t(d.TokenType.Keyword,e)}function h(e){t(d.TokenType.Op,e)}function S(){var e=y();return e.type==d.TokenType.Keyword?e.value:""}function b(){var e=y();return e.type==d.TokenType.Op?e.value:""}const he={if:function e(){var t=E("If");return x(),t.test=I(),t.body=r(),"elif"==S()?t.orelse=[e()]:t.orelse=U(),N(t)},while:function(){var e=E("While");return v("while"),e.test=I(),e.body=r(),e.orelse=U(),N(e)},for:function(){var e=E("For");return v("for"),e.target=Y(),w(e.target),v("in"),e.iter=A(),e.body=r(),e.orelse=U(),N(e)},try:function(){var e=E("Try");v("try"),e.body=r();let t=!(e.handlers=[]);for(;"except"==S();){var n=E("ExceptHandler");e.handlers.push(n),x(),"Colon"!=b()?(t&&g(),n.type=I(),"as"==S()?(x(),n.name=q()):n.name=void 0):(t=!0,n.type=void 0,n.name=void 0),n.body=r()}return e.orelse=U(),0==e.handlers.length&&e.orelse.length&&g(),"finally"==S()?(x(),e.finalbody=r()):e.finalbody=[],N(e)},with:function(){var e=E("With");return v("with"),e.items=xe(m.U.lf("with item"),z),e.body=r(),N(e)},def:function(){var e=E("FunctionDef");return v("def"),e.name=q(),h("LParen"),e.args=te(!0),h("RParen"),e.returns=void 0,"Arrow"==b()&&(x(),e.returns=I()),e.body=r(),N(e)},class:function(){var e,t=E("ClassDef");return v("class"),t.name=q(),"LParen"==b()?(e=Te(),t.bases=e.args,t.keywords=e.keywords):(t.bases=[],t.keywords=[]),t.body=r(),N(t)}},Se={del:function(){var e=E("Delete");return v("del"),e.targets=D(m.U.lf("expression"),L),N(e)},pass:function(){var e=E("Pass");return v("pass"),N(e)},break:function(){var e=E("Break");return x(),N(e)},continue:function(){var e=E("Continue");return x(),N(e)},return:function(){var e=E("Return");return x(),n()?e.value=void 0:e.value=A(),N(e)},raise:function(){var e=E("Raise");return v("raise"),e.exc=void 0,e.cause=void 0,n()||(e.exc=I(),"from"==S()&&(x(),e.cause=I())),N(e)},global:C,nonlocal:function(){var e=C();return e.kind="Nonlocal",e},import:function(){var e=E("Import");return x(),e.names=xe(m.U.lf("import name"),V),N(e)},from:function(){var e,t=E("ImportFrom");return x(),t.level=function(){let e=0;for(;;){if("Dot"==b())e+=1;else{if("Ellipsis"!=b())return e;e+=3}x()}}(),y().type==d.TokenType.Id?t.module=j():t.module=void 0,t.level||t.module||g(),v("import"),"Mult"==b()?(x(),(e=E("Alias")).name="*",t.names=[e]):"LParen"==b()?(x(),t.names=D(m.U.lf("import name"),H),h("RParen")):t.names=D(m.U.lf("import name"),H),N(t)},assert:function(){var e=E("Assert");return x(),e.test=I(),"Comma"==b()?(x(),e.msg=I()):e.msg=void 0,N(e)},yield:function(){var e;return y(),x(),"from"==S()?(e=E("YieldFrom")).value=I():(e=E("Yield"),n()||(e.value=A())),W(N(e))}};function r(){if(h("Colon"),y().type!=d.TokenType.NewLine)return ee();{let e;if(x(),y().type!=d.TokenType.Indent)g(9554,m.U.lf("expected an indented block")),e=P();else{var t=parseInt(y().value);for(x(),e=P();;){if(y().type==d.TokenType.Dedent){const m=isNaN(t)||parseInt(y().value)<t;if(x(),m)break}if(m.U.pushRange(e,P()),y().type==d.TokenType.EOF)break}}return e}}function E(e,t){t=t||y();return{startPos:t.startPos,endPos:t.endPos,kind:e}}function N(e){return e.endPos=c.endPos,e}function U(){return"else"==S()?(x(),r()):[]}function z(){var e=E("WithItem");return e.context_expr=I(),e.optional_vars=void 0,"as"==S()&&(x(),e.optional_vars=L()),N(e)}function W(e){var t=E("ExprStmt");return t.startPos=e.startPos,t.endPos=e.endPos,t.value=e,t}function n(){var e=y();return e.type==d.TokenType.NewLine||e.type==d.TokenType.Op&&"Semicolon"==e.value}function C(){var e=E("Global");for(x(),e.names=[];e.names.push(q()),"Comma"==b();)x();return N(e)}function j(){let e="";for(;;){if(e+=q(),"Dot"!=b())return e;e+=".",x()}}function V(){var e=E("Alias");return e.name=j(),"as"==S()?(x(),e.asname=q()):e.asname=void 0,N(e)}function H(){var e=E("Alias");return e.name=q(),"as"==S()?(x(),e.asname=q()):e.asname=void 0,N(e)}function J(e,t){e=E("Tuple",e);return e.elts=t,N(e)}function e(e){var t=y(),e=D(m.U.lf("expression"),e),n=e[0];return 1!=e.length?J(t,e):n}function X(){return e(F)}function A(){return e(I)}function Y(){return e(L)}function w(e){"Tuple"==e.kind?e.elts.forEach(w):e.ctx="Store"}function Z(){var e=m.U.lookup(Se,S());return(e||function(){let e=y(),t=X(),n=b();if("Assign"==n){var r=E("Assign");for(r.targets=[t];;){if(x(),t=X(),"Assign"!=(n=b())){r.value=t;break}r.targets.push(t)}return r.targets.forEach(w),N(r)}var i;return"Colon"==n?((i=E("AnnAssign")).target=t,x(),i.annotation=I(),"Assign"==b()&&(x(),i.value=I()),i.simple=e.type==d.TokenType.Id&&"Name"==t.kind?1:0,w(i.target),N(i)):m.U.endsWith(n,"Assign")?((i=E("AugAssign")).target=t,i.op=n.replace("Assign",""),x(),i.value=A(),w(i.target),N(i)):"Semicolon"==n||y().type==d.TokenType.NewLine?((i=E("ExprStmt")).value=t,N(i)):(g(9555,m.U.lf("unexpected token")),x(),null)})()}function ee(){for(var e=[Z()];"Semicolon"==b()&&(x(),y().type!=d.TokenType.NewLine);)e.push(Z());return T(),e.filter(e=>!!e)}function P(){for(var e,t=f.length,n=y().type==d.TokenType.Indent,r=(n&&(x(),g(9573,m.U.lf("unexpected indent"))),[]);"MatMult"==b();)x(),r.push(ve()),T();let i=S(),s=m.U.lookup(he,S()),o=[],a=u;if(u=[],"class"==i||"def"==i?((e=s()).decorator_list=r,o=[e]):r.length?g(9556,m.U.lf("decorators not allowed here")):o=s?[s()]:ee(),a.length&&o.length&&(o[0]._comments=a),f.length>t){for(l=-1;c.type!=d.TokenType.Dedent&&c.type!=d.TokenType.NewLine&&(x(),y().type!=d.TokenType.EOF););n&&y().type===d.TokenType.Dedent&&x(),l=0}return o}function te(t){var n=E("Arguments");for(n.args=[],n.defaults=[],n.kwonlyargs=[],n.kw_defaults=[],n.vararg=void 0;;){var e=b();if("Colon"==e||"RParen"==e)break;if("Mult"==e)n.vararg&&g(9557,m.U.lf("multiple *arg")),x(),y().type==d.TokenType.Id?n.vararg=r():n.vararg=void 0;else if("Pow"==e)n.kwarg&&g(9558,m.U.lf("multiple **arg")),x(),n.kwarg=r();else{n.kwarg&&g(9559,m.U.lf("arguments after **"));let e,t=r();"Assign"==b()&&(x(),e=I()),void 0!==n.vararg&&e?(n.kwonlyargs.push(t),n.kw_defaults.push(e)):(n.args.push(t),e?n.defaults.push(e):n.defaults.length&&g(9560,m.U.lf("non-default argument follows default argument")))}if("Comma"!=b())break;x()}return n.kwarg||(n.kwarg=void 0),n.vararg||(n.vararg=void 0),N(n);function r(){var e=E("Arg");return e.arg=q(),e.annotation=void 0,t&&"Colon"==b()&&(x(),e.annotation=I()),e}}function ne(e){var t=E("Lambda");return x(),t.args=te(!1),h("Colon"),t.body=(e?me:I)(),N(t)}function I(){var e,t;return"lambda"==S()?ne():(t=y(),e=_(),"if"==S()?((t=E("IfExp",t)).body=e,v("if"),t.test=_(),v("else"),t.orelse=I(),N(t)):e)}function re(e,t){var n=y(),r=t();if(S()!=e)return r;var i=E("BoolOp",n);for(i.op="or"==e?"Or":"And",i.values=[r];S()==e;)v(e),i.values.push(t());return N(i)}function ie(){return re("and",se)}function _(){return re("or",ie)}function se(){if("not"==S())return e=E("UnaryOp"),x(),e.op="Not",e.operand=se(),N(e);var e=y(),t=L();if(!oe())return t;var n=E("Compare",e);for(n.left=t,n.comparators=[],n.ops=[];;){let e=oe();if(!e)break;x(),"NotIn"==e?v("in"):"Is"==e&&"not"==S()&&(x(),e="IsNot"),n.ops.push(e),n.comparators.push(L())}return N(n)}const G={Lt:"Lt",Gt:"Gt",Eq:"Eq",GtE:"GtE",LtE:"LtE",NotEq:"NotEq",in:"In",not:"NotIn",is:"Is"};function oe(){return G[b()]||G[S()]||null}const $={Invert:"Invert",Sub:"USub",Add:"UAdd"};function K(e,t){let n=y(),r=e();for(;;){var i=b();if(!(i&&0<=t.indexOf(","+i+",")))return r;var s=E("BinOp",n);s.left=r,s.op=i,x(),s.right=e(),r=s}}function ae(){return K(B,",Mult,MatMult,Div,Mod,FloorDiv,")}function le(){return K(ae,",Add,Sub,")}function ue(){return K(le,",LShift,RShift,")}function pe(){return K(ue,",BitAnd,")}function ce(){return K(pe,",BitXor,")}function L(){return K(ce,",BitOr,")}function fe(){let e,t=y();var n;if("Colon"!=b()&&(e=I()),"Colon"==b())return(n=E("Slice",t)).lower=e,x(),r=b(),n.upper="Colon"!=r&&"Comma"!=r&&"RSquare"!=r?I():void 0,n.step=void 0,"Colon"==b()&&(x(),"Comma"!=(r=b()))&&"RSquare"!=r&&(n.step=I()),N(n);e||g(9570,m.U.lf("unable to parse lower subscript"));var r=E("Index");return r.value=e,N(r)}function F(){var e;return"Mult"==b()?((e=E("Starred")).value=L(),N(e)):I()}function me(){return"lambda"==S()?ne(!0):_()}function R(){for(var e=[];;){var t=E("Comprehension");for(t.is_async=0,e.push(t),v("for"),t.target=Y(),w(t.target),v("in"),t.iter=_(),t.ifs=[];"if"==S();)x(),t.ifs.push(me());if("for"!=S())return e}}function de(){var e,t,n=y();return"Mult"==b()?(e=E("Starred"),x(),e.value=I(),N(e)):"Pow"==b()?(e=E("Keyword"),x(),e.arg=void 0,e.value=I(),N(e)):(e=I(),"Assign"==b()?("Name"!=e.kind&&g(9561,m.U.lf("invalid keyword argument; did you mean ==?")),x(),(t=E("Keyword",n)).arg=e.id||"???",t.value=I(),N(t)):"for"==S()?((t=E("GeneratorExp",n)).elt=e,t.generators=R(),N(t)):e)}function O(){var e=E("NameConstant");return e.value=null,x(),N(e)}function ye(){var t,n=y();if(n.type==d.TokenType.Id)return t=E("Name"),x(),t.id=n.value,t.ctx="Load",N(t);if(n.type==d.TokenType.Number)return t=E("Num"),x(),t.ns=n.value,t.n=n.auxValue,N(t);if(n.type!=d.TokenType.String)return n.type==d.TokenType.Keyword?"None"==n.value||"True"==n.value||"False"==n.value?(t=E("NameConstant"),x(),t.value="True"==n.value||"False"!=n.value&&null,N(t)):(g(9564,m.U.lf("expecting atom")),O()):n.type==d.TokenType.Op?"LParen"==(t=n.value)?ge("RParen","Tuple","GeneratorExp"):"LSquare"==t?ge("RSquare","List","ListComp"):("LBracket"==t?function(){let s=y();var e,t,n;return x(),"Pow"==b()?(x(),r(void 0,L())):"RBracket"==b()?(e=E("Dict",s),x(),e.keys=[],e.values=[],N(e)):"Starred"!=(e=F()).kind&&"Colon"==b()?(x(),r(e,I())):(e=e,"for"==S()?("Starred"==e.kind&&g(9562,m.U.lf("iterable unpacking cannot be used in comprehension")),(t=E("SetComp",s)).elt=e,t.generators=R()):((t=E("Set",s)).elts=[e],"Comma"==b()?(n=M("RBracket",m.U.lf("set element"),F),t.elts=[e].concat(n)):h("RBracket")),N(t));function o(){var e;return"Pow"==b()?(x(),[null,L()]):(e=I(),h("Colon"),[e,I()])}function r(e,t){var n;if("for"==S())return e||g(9563,m.U.lf("dict unpacking cannot be used in dict comprehension")),(n=E("DictComp",s)).key=e,n.value=t,n.generators=R(),N(n);var r,i=E("Dict",s);if(i.keys=[e],i.values=[t],"Comma"==b())for(r of M("RBracket",m.U.lf("dict element"),o))2<=r.length&&r[0]&&r[1]&&(i.keys.push(r[0]),i.values.push(r[1]));else h("RBracket");return N(i)}}:(g(9565,m.U.lf("unexpected operator")),O))():(g(9566,m.U.lf("unexpected token")),O());{x();let e=n.value;for(;y().type==d.TokenType.String;)e+=y().value,x();return"b"==n.stringPrefix?((t=E("Bytes",n)).s=m.U.toArray(m.U.stringToUint8Array(e)),N(t)):((t=E("Str",n)).s=e,N(t))}}function ke(){var e=b();return"RParen"==e||"RSquare"==e||"RBracket"==e||"Colon"==e||"Semicolon"==e||m.U.endsWith(e,"Assign")||"in"==S()||y().type==d.TokenType.NewLine}function D(e,t){var n=[];if(ke())return n;for(;;){n.push(t());var r="Comma"==b();if(r&&x(),ke())return n;if(!r)return g(9567,m.U.lf("expecting {0}",e)),n}}function xe(e,t){for(var n=[];n.push(t()),"Comma"==b();)x();return n}function M(e,t,n){x();var r=[];if(b()!=e)for(;;){r.push(n());var i="Comma"==b();if(i&&x(),b()==e)break;if(!i){g(9568,m.U.lf("expecting {0}",t));break}}return h(e),r}function ge(e,t,n){var r,i=y();return x(),b()==e?(x(),(r=E(t,i)).elts=[],N(r)):(r=F(),"for"==S()?((n=E(n,i)).elt=r,n.generators=R(),h(e),N(n)):"Comma"==b()?(n=E(t,i),x(),n.elts=D(m.U.lf("expression"),F),n.elts.unshift(r),h(e),N(n)):(h(e),"List"==t?((n=E(t,i)).elts=[r],N(n)):r))}function q(){var e=y();return e.type!=d.TokenType.Id&&g(9569,m.U.lf("expecting identifier")),x(),e.value}function Te(){var e,t=[],n=[];for(e of M("RParen",m.U.lf("argument"),de))("Keyword"==e.kind?n:(n.length&&g(9570,m.U.lf("positional argument follows keyword argument")),t)).push(e);return{args:t,keywords:n}}function ve(){let e=y(),t=ye();for(;;){n=e,r=t,l=a=o=s=i=void 0;s="LParen"==(l=b())?((i=E("Call",n)).func=r,a=Te(),i.args=a.args,i.keywords=a.keywords,N(i)):"LSquare"==l?(a=y(),(i=E("Subscript",n)).value=r,0==(s=M("RSquare",m.U.lf("subscript"),fe)).length?g(9571,m.U.lf("need non-empty index list")):1==s.length?i.slice=s[0]:s.every(e=>"Index"==e.kind)?((o=s[0]).value=J(a,s.map(e=>e.value)),i.slice=o):((o=E("ExtSlice",a)).dims=s,i.slice=N(o)),N(i)):"Dot"==l?((a=E("Attribute",n)).value=r,x(),a.attr=q(),N(a)):r;if(s===t)return t;t=s}var n,r,i,s,o,a,l}function B(){var e,t;return $[b()]?((t=E("UnaryOp")).op=$[b()],x(),t.operand=B(),N(t)):(y(),t=ve(),"Pow"==b()?(e=E("BinOp"),x(),e.left=t,e.op="Pow",e.right=B(),N(e)):t)}const Q={kind:1,id:2,n:3,s:4,func:5,key:6,elt:7,elts:8,keys:9,left:10,ops:11,comparators:12,names:13,items:14,test:15,targets:16,dims:17,context_expr:18,name:19,bases:20,type:21,inClass:22,target:23,annotation:24,simple:25,op:26,operand:27,right:28,values:29,iter:30,ifs:31,is_async:32,value:33,slice:34,attr:35,generators:36,args:37,keywords:38,body:39,handlers:40,orelse:41,finalbody:42,decorator_list:43,kwonlyargs:44,kw_defaults:45,defaults:46,arg:47},be={lineno:1,col_offset:1,startPos:1,endPos:1,kind:1},Ee={body:1,orelse:1,finalbody:1},Ne={_comments:1,ctx:1,ns:1};d.dump=function(e,u=!1){const p=(n,r)=>{if(Array.isArray(r)){let t="";for(let e=0;e<r.length;++e)0<e&&(t+=", "),t+=p(n,r[e]);return"["+t+"]"}if(!r||!r.kind)return JSON.stringify(r);let e="",t=Object.keys(r);t.sort((e,t)=>(Q[e]||100)-(Q[t]||100)||m.U.strcmp(e,t));for(var i of t)if(!(m.U.lookup(be,i)||u&&m.U.lookup(Ne,i)))if(e&&(e+=", "),e+=i+"=",Array.isArray(r[i])&&r[i].length&&m.U.lookup(Ee,i)){e+="[\n";var s,o=n+"  ";for(s of r[i])e+=o+p(o,s)+"\n";e+=n+"]"}else if("_comments"==i){e+="[\n";var a,l=n+"  ";for(a of r[i])e+=l+JSON.stringify(a.value)+"\n";e+=n+"]"}else e+=p(n,r[i]);return r.kind+"("+e+")"};let t="";for(var n of e)t+=p("",n)+"\n";return t},d.parse=function(e,t,n){s=e,o=t,i=n,l=0,a=0,u=[],p=[0],f=[];let r=[];try{if(c=i[0],k(),y().type!=d.TokenType.EOF)for(r=P();y().type!=d.TokenType.EOF;)m.U.pushRange(r,P())}catch(e){g(9572,m.U.lf("exception: {0}",e.message))}return{stmts:r,diagnostics:f}}}}(pxt=pxt||{}),function(O){function D(e,t,n){e={fileName:e.getSourceFile().fileName,start:e.getStart(),length:e.getEnd()-e.getStart(),line:void 0,column:void 0,code:t,category:pxtc.DiagnosticCategory.Error,messageText:n},t=new Error(n);throw t.pyDiagnostic=e,t}function e(t){return e=>(e||"").split("\n").map(e=>""+M.INDENT.repeat(t)+e).join("\n")}var M;(M=O.py||(O.py={})).decompileToPython=function(e,t){var n={blocksInfo:void 0,outfiles:{},diagnostics:[],success:!0,times:{}};try{var r=function(e,n){const f=e.getTypeChecker(),r=(new ts.pxtc.LSHost(e),e.getSourceFile(n)),i=pxtc.decompiler.buildCommentMap(r),t=O.U.toSet(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EnvironmentError","Exception","False","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","NameError","None","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","True","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError","_","__build_class__","__debug__","__doc__","__import__","__loader__","__name__","__package__","__spec__","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","copyright","credits","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","license","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","quit","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip",...Object.keys(O.py.keywords)],e=>e),[s,o]=ts.pxtc.decompiler.buildRenameMap(e,r,{takenNames:t,declarations:"all"}),a=pxtc.getApiInfo(e),p=O.U.mapMap(a.byQName,(e,t)=>t.fileName==n?void 0:t),u=M.computeScopeVariableLookup(r);{let t=(e=r).getChildren().map(g).reduce((e,t)=>e.concat(t),[]).reduce((e,t)=>t||e[e.length-1]?[...e,t]:e,[]);return i.filter(e=>!e.owner).forEach(e=>t.push(...c(e))),t.join("\n")}function v(e){if(!e.getSourceFile())return null;let t=e.getText();var n=f.getSymbolAtLocation(e),n=(n&&(t=f.getFullyQualifiedName(n)),p[t]);if(n&&n.attributes.alias)return n.attributes.alias;if(n&&n.pyQName){if(n.isInstance){if(ts.isPropertyAccessExpression(e))return null;const t=new RegExp(`(?:^|.)${n.namespace}.(.+)`).exec(n.pyQName);if(t)return t[1]}return n.pyQName}return t in pxtc.ts2PyFunNameMap?pxtc.ts2PyFunNameMap[t].n:null}function h(e){var t=v(e);if(t)return t;if(!ts.isIdentifier(e))return O.tickEvent("depython.todo.advancedname"),D(e,3001,"Unsupported advanced name format: "+e.getText());let n=e.text;if(e.getSourceFile()){const O=s.getRenameForPosition(e.getStart());O&&(n=O.name)}return n}function m(e,t){return 0!=(e.flags&t)}function l(e,t){return m(f.getTypeAtLocation(e),t)}function S(e){return l(e,ts.TypeFlags.StringLike)}function x(e){return l(e,ts.TypeFlags.NumberLike)}function g(e){switch(e.kind){case ts.SyntaxKind.SyntaxList:return e._children.map(g).reduce((e,t)=>e.concat(t),[]);case ts.SyntaxKind.EndOfFileToken:case ts.SyntaxKind.OpenBraceToken:case ts.SyntaxKind.CloseBraceToken:return[];default:return n=T(t=e),pxtc.decompiler.getCommentsForStatement(t,i).map(c).reduce((e,t)=>e.concat(t),[]).concat(n)}var t,n}function c(e){var t=[];if(e.kind===pxtc.decompiler.CommentKind.SingleLine)t.push("# "+e.text);else{t.push('"""');for(const n of e.lines)t.push(n);t.push('"""')}return t}function T(s){{if(ts.isVariableStatement(s))return s.declarationList.declarations.map(C).reduce((e,t)=>e.concat(t),[]);if(ts.isClassDeclaration(s))return k=s,O.tickEvent("depython.todo.classes"),D(k,3016,"Unsupported: classes are not supported in Python right now.");if(ts.isEnumDeclaration(s)){k=s;var t=[],n=(t.push(`class ${h(k.name)}(Enum):`),k.members.every(e=>!!e.initializer)),r=!k.members.every(e=>!!e.initializer),i;if(!n&&!r)return O.tickEvent("depython.todo.enummix"),D(k,3005,"Unsupported enum decleration: has mixture of explicit and implicit initialization");if(n)return O.tickEvent("depython.todo.enuminit"),D(k,3006,"Unsupported: explicit enum initialization");let e=0;for(i of k.members)t.push(M.indent1(h(i.name)+" = "+e++));return t}var n,r,o,o,a,l,u,p,c,e,f,m,e,f,e,f,m;if(ts.isExpressionStatement(s))return(n=E((r=s).expression))||([n,r]=R(r.expression),r.length?["",...r,...n,""]:[...r,...n]);if(ts.isFunctionDeclaration(s))return U(s);if(ts.isIfStatement(s))return{supportStmts:o,ifStmt:a,rest:l}=function i(s){let o=[],[e,t]=R(s.expression);o=o.concat(t);let n=`if ${w(e)}:`,a=[],r=b(s.thenStatement);if(a=a.concat(r),s.elseStatement)if(ts.isIfStatement(s.elseStatement)){let{supportStmts:e,ifStmt:t,rest:n}=i(s.elseStatement),r="el"+t;o=o.concat(e),a.push(r),a=a.concat(n)}else{a.push("else:");let e=b(s.elseStatement);a=a.concat(e)}return{supportStmts:o,ifStmt:n,rest:a}}(o=s),o.concat([a]).concat(l);if(ts.isForStatement(s)){if(a=function(e){if(!e.initializer)return null;if(e.initializer.kind!==ts.SyntaxKind.VariableDeclarationList)return null;var t=e.initializer;if(1!==t.declarations.length)return null;var t=t.declarations[0],n=h(t.name);if(!t.initializer||!function(e){return function t(e,n){let r=e=>t(e,n);return ts.isBinaryExpression(e)?r(e.left)&&r(e.right):ts.isPropertyAccessExpression(e)?r(e.expression):ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e)?e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken&&r(e.operand):ts.isParenthesizedExpression(e)?r(e.expression):ts.isArrayLiteralExpression(e)?e.elements.map(r).reduce((e,t)=>e&&t,!0):ts.isElementAccessExpression(e)?r(e.expression)&&(!e.argumentExpression||r(e.argumentExpression)):n(e)}(e,e=>{switch(e.kind){case ts.SyntaxKind.PropertyAccessExpression:case ts.SyntaxKind.BinaryExpression:case ts.SyntaxKind.ParenthesizedExpression:case ts.SyntaxKind.ArrayLiteralExpression:case ts.SyntaxKind.ElementAccessExpression:case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:return!0;case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:case ts.SyntaxKind.Identifier:case ts.SyntaxKind.ThisKeyword:return!1;case ts.SyntaxKind.PrefixUnaryExpression:case ts.SyntaxKind.PostfixUnaryExpression:return e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken}return!1})}(t.initializer)||!x(t.initializer))return null;var[t,r]=R(t.initializer);if(r.length)return null;r=w(t);if(!e.condition)return null;if(!ts.isBinaryExpression(e.condition))return null;if(!ts.isIdentifier(e.condition.left))return null;if(h(e.condition.left)!=n)return null;if(!x(e.condition.right))return null;var[t,i]=R(e.condition.right);if(i.length)return null;let s=w(t),o=s;if(e.condition.operatorToken.kind===ts.SyntaxKind.LessThanEqualsToken&&function(e){var t=Math.floor(Number(e));return t!==1/0&&String(t)===e}(s))o=""+(Number(s)+1);else if(e.condition.operatorToken.kind!==ts.SyntaxKind.LessThanToken)return null;return e.incrementor&&(ts.isPostfixUnaryExpression(e.incrementor)||ts.isPrefixUnaryExpression(e.incrementor))&&e.incrementor.operator===ts.SyntaxKind.PlusPlusToken&&r<o?{name:n,fromIncl:r,toExcl:o}:null}(o=s))return{name:a,fromIncl:p,toExcl:u}=a,a="0"===p?`for ${a} in range(${u}):`:`for ${a} in range(${p}, ${u}):`,p=b(o.statement),[a].concat(p);let e,t=[];o.initializer&&(t=ts.isVariableDeclarationList(o.initializer)?(u=o.initializer.declarations.map(C).reduce((e,t)=>e.concat(t),[]),t.concat(u)):([a,p]=R(o.initializer),t.concat(p).concat(a)));let n=`while ${e=o.condition?([a,c]=R(o.condition),t=t.concat(c),w(a)):"True"}:`,r=(t.push(n),T(o.statement).map(M.indent1));return 0!==r.length||o.incrementor||(r=[M.indent1("pass")]),t=t.concat(r),o.incrementor&&(c=E(o.incrementor),t=c?t.concat(c.map(M.indent1)):([a,o]=R(o.incrementor),t.concat(o).concat(a.map(M.indent1)))),t}if(ts.isForOfStatement(s)){if(l=s,!ts.isVariableDeclarationList(l.initializer))return O.tickEvent("depython.todo.forof.complexexp"),D(l,3003,"Unsupported expression in for..of initializer: "+l.initializer.getText());if(1!==(m=l.initializer.declarations.map(e=>h(e.name))).length)return O.tickEvent("depython.todo.forof.multidecl"),D(l,3004,"Unsupported multiple declerations in for..of: "+l.initializer.getText());let e=m[0],[t,n]=R(l.expression),r=n,i=(r=r.concat(P(`for ${e} in `,t,":")),b(l.statement));return r=r.concat(i)}return ts.isWhileStatement(s)?([e,f]=R((m=s).expression),m=b(m.statement),e=P("while ",e,":"),f.concat(e).concat(m)):ts.isReturnStatement(s)?(f=s).expression?([f,e]=R(f.expression),f=P("return ",f),e.concat(f)):["return"]:ts.isBlock(s)?N(s):ts.isTypeAliasDeclaration(s)?(d=s,y=pxtc.emitPyTypeFromTypeNode(d.type),[h(d.name)+" = "+y]):ts.isEmptyStatement(s)?[]:ts.isModuleDeclaration(s)?(y=h((d=s).name),d=d.body&&d.body.getChildren().map(g).reduce((e,t)=>e.concat(t),[]).map(e=>M.indent1(e)),["@namespace",`class ${y}:`].concat(d||[])):ts.isBreakStatement(s)?["break"]:ts.isContinueStatement(s)?["continue"]:(O.tickEvent("depython.todo.statement",{statement:s.kind}),D(s,3002,`Not supported in MakeCode Python: ${ts.SyntaxKind[s.kind]} (${s.kind})`))}var d,y,k}function b(e){let t=T(e).map(M.indent1);return t=t.length<1?[M.indent1("pass")]:t}function E(e){var t,n;return t=e,!ts.isPrefixUnaryExpression(t)&&!ts.isPostfixUnaryExpression(t)||t.operator!==ts.SyntaxKind.MinusMinusToken&&t.operator!==ts.SyntaxKind.PlusPlusToken?null:([t,n]=R(e.operand),e=e.operator===ts.SyntaxKind.MinusMinusToken?" -= 1":" += 1",(n=n).push(w(t)+e),n)}function N(e){return e.getChildren().map(g).reduce((e,t)=>e.concat(t),[])}function U(e,t,n,o){let r=[];e.kind!==ts.SyntaxKind.MethodDeclaration&&e.kind!==ts.SyntaxKind.Constructor||r.push("self");var n=(n?function(n,r){var i=[],s={};for(let t=0;t<Math.max(n.length,r.length);t++){let e;var o;n[t]?(e=n[t],s[h(e.name)]=!0):(o=h((e=r[t]).name),s[o]&&(o=pxtc.decompiler.getNewName(o,s),e=Object.assign({altName:o},r[t]))),i.push(e)}return ts.createNodeArray(i,!1)}(e.parameters,n):e.parameters).map(r=>{{var i=!o;let e=r.altName||h(r.name),t="",n=(r.type&&i&&(i=pxtc.emitPyTypeFromTypeNode(r.type))&&-1===i.indexOf("(TODO")&&(t=": "+i),"");if(r.initializer){var[i,s]=R(r.initializer);if(s.length)return O.tickEvent("depython.todo.complexinit"),D(r,3007,"Unsupported: complex expression in parameter default value not supported. Expression: "+r.initializer.getText());n=" = "+w(i)}return""+e+t+n}});let i,s=(r=r.concat(n)).join(", "),a=[];if(t)i=t;else{if(!e.name)return O.tickEvent("depython.todo.anonymousfunc"),D(e,3012,"Unsupported: anonymous function decleration");i=h(e.name)}if(a.push(`def ${i}(${s}):`),!e.body)return O.tickEvent("depython.todo.funcwithoutbody"),D(e,3013,"Unsupported: function decleration without body");let l=[];return ts.isBlock(e.body)?l=N(e.body):([n,t]=R(e.body),(l=l.concat(t)).concat(n)),l.length?((t=u.getExplicitGlobals(e).map(e=>h(e)))&&t.length&&l.unshift("global "+t.join(", ")),(n=u.getExplicitNonlocals(e).map(e=>h(e)))&&n.length&&l.unshift("nonlocal "+n.join(", ")),a=a.concat(l.map(M.indent1))):a.push(M.indent1("pass")),a}function C(r){let i=[],s=h(r.name);if(r.initializer){let e,[t,n]=R(r.initializer);i=i.concat(n),e=r.type?`${s}: ${pxtc.emitPyTypeFromTypeNode(r.type)} = `+w(t):s+" = "+w(t),i.push(e)}return i}function A(e,t){return[[e],t||[]]}function w(e,t="\n"){return e.join(t)}function P(e="",t,n=""){return t[0]=e+t[0],t[t.length-1]=t[t.length-1]+n,t}function I(e,t){switch(e){case ts.SyntaxKind.BarBarToken:return"or";case ts.SyntaxKind.AmpersandAmpersandToken:return"and";case ts.SyntaxKind.ExclamationToken:return"not";case ts.SyntaxKind.LessThanToken:return"<";case ts.SyntaxKind.LessThanEqualsToken:return"<=";case ts.SyntaxKind.GreaterThanToken:return">";case ts.SyntaxKind.GreaterThanEqualsToken:return">=";case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsToken:return"==";case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:return"!=";case ts.SyntaxKind.EqualsToken:return"=";case ts.SyntaxKind.PlusToken:return"+";case ts.SyntaxKind.MinusToken:return"-";case ts.SyntaxKind.AsteriskToken:return"*";case ts.SyntaxKind.PlusEqualsToken:return"+=";case ts.SyntaxKind.MinusEqualsToken:return"-=";case ts.SyntaxKind.PercentToken:return"%";case ts.SyntaxKind.SlashToken:return"/";case ts.SyntaxKind.PlusPlusToken:case ts.SyntaxKind.MinusMinusToken:return O.tickEvent("depython.todo.unsupportedop",{op:e}),D(t,3008,"Unsupported ++ and -- in an expression (not a statement or for loop)");case ts.SyntaxKind.AmpersandToken:return"&";case ts.SyntaxKind.CaretToken:return"^";case ts.SyntaxKind.LessThanLessThanToken:return"<<";case ts.SyntaxKind.GreaterThanGreaterThanToken:return">>";case ts.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return O.tickEvent("depython.todo.unsupportedop",{op:e}),D(t,3009,"Unsupported operator: >>>");case ts.SyntaxKind.AsteriskAsteriskToken:return"**";case ts.SyntaxKind.AsteriskAsteriskEqualsToken:return"**=";case ts.SyntaxKind.PercentEqualsToken:return"%=";case ts.SyntaxKind.AsteriskEqualsToken:return"*=";case ts.SyntaxKind.SlashEqualsToken:return"/=";default:return O.tickEvent("depython.todo.unsupportedop",{op:e}),D(t,3008,`Unsupported Python operator (code: ${e})`)}}function d(e){var t;return ts.isPropertyAccessExpression(e)?(t=(t=h(e.name)).substr(t.lastIndexOf(".")+1),ts.isIdentifier(e.expression)?[t]:d(e.expression).concat([t])):ts.isIdentifier(e)?[h(e)]:[]}function y(e,t,n,r){let i="",s=(t&&(i=d(t).map(O.U.snakify).join("_")),[]);if(n&&1<n.length&&r&&1<r.length)for(let e=0;e<n.length&&e<r.length;e++){var o=r[e];m(f.getTypeAtLocation(o),ts.TypeFlags.EnumLike)&&(o=d(o).map(O.U.snakify),s=s.concat(o))}let a=s.join("_"),l="",u=(i||a||!e||(l=h(e.name)),([i,a,l].filter(e=>e).map(O.U.snakify).map(e=>e.toLowerCase()).join("_")||"my_callback").split("_"));4<u.length&&(u=function(e){var t={},n=[];for(var r of e)r in t||(t[r]=!0,n.push(r));return n}(u));for(var p=O.U.toDictionary(["any","on","event"],e=>e);2<u.length;){var c=function(e,t){let n=[],r=!1;for(var i of e)i in t&&!r?r=!0:n.push(i);return n}(u,p);if(c.length==u.length)break;u=c}return(u=["on",...u]).join("_")}function _(i){var e=i.join(", ");return 60<e.length&&1<i.length?i.map((e,t)=>{var n,r=","==e.charAt(e.length-1)?"":",";return 0==t?(e=1<(n=e.split("\n")).length?n.shift()+"\n"+M.indent1(n.join("\n")):e)+r:t==i.length-1?M.indent1(e):M.indent1(e+r)}):[e]}function K(s){let e=f.getTypeAtLocation(s.expression),t=f.typeToTypeNode(e),o=ts.createNodeArray([]);if(ts.isFunctionTypeNode(t)&&(o=t.parameters,s.arguments)&&o.length<s.arguments.length)return O.tickEvent("depython.todo.argparammismatch",{kind:s.kind}),D(s,3010,"TODO: Unsupported call site where caller the arguments outnumber the callee parameters: "+s.getText());var n=(n=s.expression).getSourceFile()&&(n=n.getText(),p[n])||null;if(s.arguments&&n&&"TD_ID"==n.attributes.shim)return R(s.arguments[0]);if(ts.isPropertyAccessExpression(s.expression)&&"toString"===s.expression.name.getText()){const[O,D]=R(s.expression.expression);return[P("str(",O,")"),D]}let[r,i]=R(s.expression),a=w(r),l=(s.arguments||ts.createNodeArray()).map((e,t,n)=>{return e=e,t=o[t],r=s.expression,i=o,n=n,(ts.isFunctionExpression(e)||ts.isArrowFunction(e))&&t&&t.type&&ts.isFunctionTypeNode(t.type)?L(e,y(t,r,i,n),void 0,!0):R(e);var r,i}),u=l.map(([,e])=>e).reduce((e,t)=>e.concat(t),i);return 0===a.indexOf("_py.py_")?l.length<=0?(O.tickEvent("depython.todo._pynoargs"),D(s,3014,"Unsupported: call expression has no arguments for _py.py_ fn")):(a=a.substr(7).split("_").filter((e,t)=>0!==t).join("_"),[P(`${l.shift()[0]}.${a}(`,_(l.map(([e])=>e).reduce((e,t)=>e.concat(t),[])),")"),u]):[P(a+"(",_(l.map(([e])=>e).reduce((e,t)=>e.concat(t),[])),")"),u]}function L(e,t,n,r){t=e.name?h(e.name):("string"!=typeof(t=t||"my_function")&&(t=h(t)),o[t]?pxtc.decompiler.getNewName(t,o):(o[t]=!0,t));return A(t,U(e,t,n,r))}function F(e){switch(e){case ts.SyntaxKind.ExclamationToken:return" ";case ts.SyntaxKind.PlusToken:case ts.SyntaxKind.MinusToken:return"";default:return" "}}function R(l){if(ts.isBinaryExpression(l)){var u=l;let e=S(u.left),t=S(u.right),n=u.operatorToken.kind===ts.SyntaxKind.PlusToken&&(e||t),[r,i]=R(u.left),s=(n&&!e&&(r=P("str(",r,")")),I(u.operatorToken.kind,u)),[o,a]=R(u.right);return n&&!t&&(o=P("str(",o,")")),u=i.concat(a),[P(w(r)+" "+s+" ",o),u]}if(ts.isPropertyAccessExpression(l))return(o=v(u=l))?A(o):([o,a]=R(u.expression),A("length"===(u=h(u.name))?`len(${w(o)})`:w(o)+"."+u,a));var e,t,n,r,i,s,o,a,p,c,f,m,d,y,k,x,g,T;if(ts.isCallExpression(l))return K(l);if(ts.isNewExpression(l))return K(l);if(ts.isFunctionExpression(l)||ts.isArrowFunction(l))return L(l);if(ts.isPrefixUnaryExpression(l))return a=I((o=l).operator,o),[c,p]=R(o.operand),A(""+a+F(o.operator)+w(c),p);if(ts.isPostfixUnaryExpression(l))return p=I((c=l).operator,c),[f,m]=R(c.operand),c=F(c.operator),A(""+w(f)+c+p,m);if(ts.isParenthesizedExpression(l))return[f,m]=R((f=l).expression),A(`(${w(f)})`,m);if(ts.isArrayLiteralExpression(l))return t=(e=(e=l).elements.map(R)).map(([,e])=>e).reduce((e,t)=>e.concat(t),[]),[P("[",_(e.map(([e])=>e).reduce((e,t)=>e.concat(t),[])),"]"),t];if(ts.isElementAccessExpression(l))return(e=l).argumentExpression?([t,i]=R(e.expression),[r,n]=R(e.argumentExpression),i=i.concat(n),A(`${w(t)}[${w(r)}]`,i)):(O.tickEvent("depython.todo.accesswithoutexp"),D(e,3015,"Unsupported: element access expression without an argument expression"));if(ts.isNoSubstitutionTemplateLiteral(l)||ts.isTaggedTemplateExpression(l))return n=l,ts.isNoSubstitutionTemplateLiteral(n)?A(`"""
${M.indent1(n.text.trim())}
"""`):([r,i]=R(n.tag),[n,s]=R(n.template),i=i.concat(s),A(`${w(r)}(${w(n)})`,i));switch(l.kind){case ts.SyntaxKind.TrueKeyword:return A("True");case ts.SyntaxKind.FalseKeyword:return A("False");case ts.SyntaxKind.ThisKeyword:return A("self");case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:return A("None")}return ts.isIdentifier(l)?"undefined"==(s=l).text?A("None"):A(h(s)):ts.isNumericLiteral(l)||ts.isStringLiteral(l)?A(l.getText()):ts.isConditionalExpression(l)?([d,T]=R((x=l).condition),[y,k]=R(x.whenTrue),[x,g]=R(x.whenFalse),T=T.concat(k).concat(g),A(`${y} if ${w(d)} else `+w(x),T)):(O.tickEvent("depython.todo.expression",{kind:l.kind}),D(l,3017,"Unsupported expression kind: "+l.kind))}}(e,t),i=t.replace(/(\.py)?\.\w*$/i,"")+".py";n.outfiles[i]=r}catch(e){e.pyDiagnostic?n.diagnostics=[e.pyDiagnostic]:O.reportException(e),n.success=!1}return n},M.INDENT="    ",M.indent=e,M.indent1=e(1)}(pxt=pxt||{}),function(e){e=e.py||(e.py={});{e=e.rx||(e.rx={});const t=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/;e.isIdentifierStart=function(e){return ts.pxtc.isIdentifierStart(e,ts.pxtc.ScriptTarget.ES5)},e.isIdentifierChar=function(e){return ts.pxtc.isIdentifierPart(e,ts.pxtc.ScriptTarget.ES5)},e.isSpace=function(e){return!!(32===e||9===e||11===e||12===e||160===e||5760<=e&&t.test(String.fromCharCode(e)))},e.isNewline=function(e){return 10===e||13===e||8232===e||8233===e}}}(pxt=pxt||{}),function(e){function o(e){const o={refs:[],children:[],owner:void 0};return function t(n){var r;if(!n)return o;if(ts.isPropertyAccessOrQualifiedName(n))return o;if(ts.isIdentifier(n))return{refs:[{kind:"read",node:n,varName:n.text}],children:[],owner:void 0};if(ts.isVariableDeclaration(n)||ts.isParameter(n)){const o=t(n.initializer);return{refs:[...o.refs,{kind:"decl",node:n,varName:n.name.getText()}],children:o.children,owner:void 0}}if(ts.isPrefixUnaryExpression(n)||ts.isPostfixUnaryExpression(n)){const o=t(n.operand),s=n.operand.getText();return a(o,{refs:[{kind:"assign",node:n,varName:s}],children:[],owner:void 0})}if(r=n,i=[ts.SyntaxKind.EqualsToken,ts.SyntaxKind.PlusEqualsToken,ts.SyntaxKind.MinusEqualsToken,ts.SyntaxKind.AsteriskEqualsToken,ts.SyntaxKind.AsteriskAsteriskEqualsToken,ts.SyntaxKind.SlashEqualsToken,ts.SyntaxKind.PercentEqualsToken,ts.SyntaxKind.LessThanLessThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken,ts.SyntaxKind.AmpersandEqualsToken,ts.SyntaxKind.BarEqualsToken,ts.SyntaxKind.CaretEqualsToken],ts.isBinaryExpression(r)&&i.some(e=>r.operatorToken.kind===e)){const o=t(n.right);let e;n.operatorToken.kind!==ts.SyntaxKind.EqualsToken&&(e=t(n.left));var i=n.left.getText();return a(e,a(o,{refs:[{kind:"assign",node:n,varName:i}],children:[],owner:void 0}))}if(ts.isFunctionExpression(n)||ts.isArrowFunction(n)||ts.isFunctionDeclaration(n)||ts.isMethodDeclaration(n)){i=null==(s=n.name)?void 0:s.getText();let e;i&&(e={kind:"decl",node:n,varName:i});var s=a(n.parameters.map(e=>t(e)).reduce(a,o),t(n.body));return s.owner=n,{refs:e?[e]:[],children:[s],owner:void 0}}return n.getChildren().map(t).reduce(a,o)}(e);function a(e,t){return e&&t?{refs:[...e.refs,...t.refs],children:[...e.children,...t.children],owner:e.owner||t.owner}:e||t||o}}function p(e,t,n=[]){var r=[],i=[],s=[],o=[],a={};for(const p of e.refs)"read"===p.kind||"assign"===p.kind?(a[p.varName]?s:function(t){return n.map(e=>e[t.varName]).reduce((e,t)=>t||e,void 0)}(p)?i:t&&t[p.varName]?r:o).push(p):a[p.varName]=p;const l=t||a,u=t?[...n,a]:[];return{globalUsage:r,nonlocalUsage:i,localUsage:s,environmentUsage:o,children:e.children.map(e=>p(e,l,u)),owner:e.owner}}function a(e){return e.kind+":"+e.varName}var l;(l=e.py||(e.py={})).computeScopeVariableLookup=function(e){const t=p(o(e)),r=new Map,i=new Map;return function e(t){var n=s([...(n=t).globalUsage,...n.environmentUsage].filter(e=>"assign"===e.kind).map(e=>e)),n=(r.set(t.owner,n),s(t.nonlocalUsage.filter(e=>"assign"===e.kind).map(e=>e)));i.set(t.owner,n),t.children.forEach(e)}(t),{getExplicitGlobals:e=>r.get(e)||[],getExplicitNonlocals:e=>i.get(e)||[]};function n(e){e=e.node.operand||e.node.left;return ts.isIdentifier(e)?e:void 0}function s(e){return e.map(n).filter(e=>!!e).map(e=>e).reduce((e,t)=>e.find(e=>e.text===t.text)?e:[...e,t],[])}},l.toStringVariableScopes=function(e){var e=o(e),t=p(e);return function e(t){return[t.refs.map(a).join(", "),...t.children.map(e).map(e=>e.map(l.indent1)).map(e=>["{",...e,"}"]).reduce((e,t)=>[...e,...t],[])]}(e).join("\n")+"\n\n\n"+function e(t){var n=t.globalUsage.map(a).join(", "),r=t.nonlocalUsage.map(a).join(", "),i=t.localUsage.map(a).join(", "),s=t.environmentUsage.map(a).join(", ");return[n?"global "+n:"",r?"nonlocal "+r:"",i?"local "+i:"",s?"env "+s:"",...t.children.map(e).map(e=>e.map(l.indent1)).map(e=>["{",...e,"}"]).reduce((e,t)=>[...e,...t],[])].filter(e=>!!e)}(t).join("\n")}}(pxt=pxt||{});