var pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(e){{e=e.accessibility||(e.accessibility={});let t;e.makeFocusable=function(e){e.setAttribute("focusable","true"),e.setAttribute("tabindex","0")},e.enableKeyboardInteraction=function(e,t,s){t&&e.addEventListener("keydown",e=>{e="number"==typeof e.which?e.which:e.keyCode;32!==e&&13!==e||t()}),s&&e.addEventListener("keyup",e=>{e="number"==typeof e.which?e.which:e.keyCode;32!==e&&13!==e||s()})},e.setAria=function(e,t,s){t&&!e.hasAttribute("role")&&e.setAttribute("role",t),s&&!e.hasAttribute("aria-label")&&e.setAttribute("aria-label",s)},e.setLiveContent=function(e){t||((t=document.createElement("div")).setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-hidden","false"),t.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(t)),t.textContent!==e&&(t.textContent=e)}}}(pxsim=pxsim||{}),function(m){const h="blue",d="red",c="orange",r=e=>0<e.reduce((e,t)=>e+(t?1:0),0);function f(e,t){var s,i,r={};for(s in e)r[s]=e[s];for(i in t)r[i]=t[i];return r}function u(e){m.U.assert(!!e,"Invalid pin: "+e);e=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(e);return e?e[2]:void 0}function p(e){return"-Z"===e.orientation&&"male"===e.style}m.readPin=u;class t{constructor(e){this.availablePowerPins={top:{fiveVolt:m.mkRange(26,51).map(e=>({type:"breadboard",row:"+",col:""+e})),threeVolt:m.mkRange(26,51).map(e=>({type:"breadboard",row:"+",col:""+e})),ground:m.mkRange(26,51).map(e=>({type:"breadboard",row:"-",col:""+e}))},bottom:{fiveVolt:m.mkRange(1,26).map(e=>({type:"breadboard",row:"+",col:""+e})),threeVolt:m.mkRange(1,26).map(e=>({type:"breadboard",row:"+",col:""+e})),ground:m.mkRange(1,26).map(e=>({type:"breadboard",row:"-",col:""+e}))}},this.opts=e}allocPartIRs(n,o,d){let a=[];const l=(i,e,r,t)=>{var n=[];for(let s=0;s<i.numberOfPins;s++){let e,t=i.pinDefinitions[s];if("string"==typeof t.target)e=t.target;else{var o=t.target.pinInstantiationIdx;if(!r||void 0===r[o])return void console.log(`error: parts no pin found for PinInstantiationIdx: ${o}. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)`);e=r[o]}var o=i.visual.pinLocations[s],a=d.yOffset+o.y,l=Math.round(a/i.visual.pinDistance),a=a-l*i.visual.pinDistance,u=d.xOffset+o.x,h=Math.round(u/i.visual.pinDistance),l={partRelativeRowIdx:l,partRelativeColIdx:h,xOffset:u-h*i.visual.pinDistance,yOffset:a};n.push({def:t,loc:o,target:e,bbFit:l})}return{name:e,def:i,pins:n,partParams:t||{},bbFit:d}},e=n.instantiations||[];return n.instantiation&&e.push(n.instantiation),e.forEach(e=>{if("singleton"===e.kind)a.push(l(n,o));else if("function"===e.kind){let r=e,t=r.fullyQualifiedName.split(","),s={};t.forEach(e=>{this.opts.fnArgs[e]&&this.opts.fnArgs[e].forEach(e=>{s[e]=1})});e=Object.keys(s);e&&e.length?e.forEach(e=>{e=e.split(",");if(e.length!=r.argumentRoles.length)console.log(`error: parts mismatch between number of arguments at callsite (function name: ${t}) vs number of argument roles in part definition (part: ${o}).`);else{let s=[],i={};e.forEach((e,t)=>{var t=r.argumentRoles[t];void 0!==t.partParameter&&(i[t.partParameter]=e),void 0!==t.pinInstantiationIdx&&(t=t.pinInstantiationIdx,e=u(e),s[t]=e)}),a.push(l(n,o,s,i))}}):console.log("error: parts failed to read pin(s) from callsite for: "+t)}}),a.filter(e=>!!e)}computePartDimensions(e,t){let s=e.visual.pinLocations,i=e.pinDefinitions,r=e.numberOfPins;m.U.assert(s.length===r,`Mismatch between "numberOfPins" and length of "visual.pinLocations" for "${t}"`),m.U.assert(i.length===r,`Mismatch between "numberOfPins" and length of "pinDefinitions" for "${t}"`),m.U.assert(0<r,`Part "${t}" has no pins`);let n,o,a,l,u=s.map((e,t)=>{return s={idx:t},e=e,t=i[t],f(f(s,e),t);var s}).filter(e=>"-Z"===e.orientation),h=0<u.length,d=e.visual.pinDistance;var c,p;return h?(t=u[0],c=Math.ceil(t.x/d),p=Math.ceil(t.y/d),n=c*d-t.x,o=p*d-t.y,a=Math.ceil((n+e.visual.width)/d)+1,l=Math.ceil((o+e.visual.height)/d)+1):(a=Math.ceil(e.visual.width/d),l=Math.ceil(e.visual.height/d),n=a*d-e.visual.width,o=l*d-e.visual.height),{xOffset:n,yOffset:o,rowCount:l,colCount:a}}allocColumns(e){var t=e.length,s=m.visuals.BREADBOARD_MID_COLS-e.map(e=>e.colCount).reduce((e,t)=>e+t,0);s<=0&&console.log("Not enough breadboard space!");let i=Math.floor(s/(t-1+2)),r=s-i*(t-1),n=Math.floor(r/2),o=(Math.ceil(r/2),1+n);return e.map(e=>{var t=o;return o+=e.colCount+i,t})}placeParts(e){const i=m.visuals.BREADBOARD_MID_ROWS+2;let r=this.allocColumns(e.map(e=>e.bbFit)),n=e.map(e=>{let t=i-e.bbFit.rowCount,s=Math.floor(t/2);return s=(s=4<s?4:s)<1?1:s});return e.map((e,t)=>{var s=n[t];return f({startColumnIdx:r[t],startRowIdx:s},e)})}nextColor(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=m.visuals.GPIO_WIRE_COLORS.map(e=>e)),this.availableWireColors.pop()}allocWireIRs(l){let u=[],e=l.pins.map((e,t)=>{let s,i,r=e.target,n=l.startColumnIdx+e.bbFit.partRelativeColIdx,o=m.visuals.getColumnName(n),a=l.startRowIdx+e.bbFit.partRelativeRowIdx;return 7<=a&&(a-=2),s=p(e.def)?{type:"breadboard",row:a<5?"j":"a",col:o,style:e.def.style}:{type:"breadboard",row:m.visuals.getRowName(a),col:o,xOffset:e.bbFit.xOffset/l.def.visual.pinDistance,yOffset:e.bbFit.yOffset/l.def.visual.pinDistance,style:e.def.style},i="ground"===r?h:"threeVolt"===r?d:"fiveVolt"===r?c:"number"==typeof e.def.colorGroup?u[e.def.colorGroup]||(u[e.def.colorGroup]=this.nextColor()):this.nextColor(),{start:s,end:r,color:i,pinIdx:t}});return f(l,{wires:e})}allocLocation(s,i){if("ground"===s||"threeVolt"===s||"fiveVolt"==s){if("ground"===s&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===s&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};if("fiveVolt"===s&&this.powerUsage.singleFiveVolt)return{type:"dalboard",pin:this.getBoardFiveVoltPin()};m.U.assert(!!i.referenceBBPin);var i=this.opts.getBBCoord(i.referenceBBPin),r=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(e=>this.opts.getBBCoord(e));r[0]&&r[1]||console.debug(`No more available "${s}" locations!`);let e,t=0==m.visuals.findClosestCoordIdx(i,r);t?"ground"===s?e=this.availablePowerPins.top.ground:"threeVolt"===s?e=this.availablePowerPins.top.threeVolt:"fiveVolt"===s&&(e=this.availablePowerPins.top.fiveVolt):"ground"===s?e=this.availablePowerPins.bottom.ground:"threeVolt"===s?e=this.availablePowerPins.bottom.threeVolt:"fiveVolt"===s&&(e=this.availablePowerPins.bottom.fiveVolt);r=e.map(e=>this.opts.getBBCoord(e)),i=m.visuals.findClosestCoordIdx(i,r),r=e[i];return(t?(this.availablePowerPins.top.ground.splice(i,1),this.availablePowerPins.top):(this.availablePowerPins.bottom.ground.splice(i,1),this.availablePowerPins.bottom)).threeVolt.splice(i,1),r}if("breadboard"===s.type)return s;if("MOSI"===s||"MISO"===s||"SCK"===s)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:this.opts.boardDef.spiPins[s]};if("SDA"===s||"SCL"===s)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:this.opts.boardDef.i2cPins[s]};m.U.assert("string"==typeof s,"Unknown location type: "+s);i=this.opts.boardDef.gpioPinMap[s]||s;return i?{type:"dalboard",pin:i}:void console.debug("unknown pin location for "+s)}getBoardGroundPin(){var e=this.opts.boardDef.groundPins&&this.opts.boardDef.groundPins[0]||null;return e||console.debug("No available ground pin on board!"),e}getBoardThreeVoltPin(){var e=this.opts.boardDef.threeVoltPins&&this.opts.boardDef.threeVoltPins[0]||null;return e||console.debug("No available 3.3V pin on board!"),e}getBoardFiveVoltPin(){var e=this.opts.boardDef.fiveVoltPins&&this.opts.boardDef.fiveVoltPins[0]||null;return e||console.debug("No available 5V pin on board!"),e}allocPowerWires(e){var t=this.getBoardGroundPin(),s=this.getBoardThreeVoltPin(),i=this.getBoardFiveVoltPin();let r,n,o=(n=this.opts.boardDef.attachPowerOnRight?(r={type:"breadboard",row:"-",col:"50"},{type:"breadboard",row:"-",col:"25"}):(r={type:"breadboard",row:"-",col:"26"},{type:"breadboard",row:"-",col:"1"}),[]),a=[],l=[];e.bottomGround&&e.topGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:r}),end:this.allocLocation("ground",{referenceBBPin:n}),color:h}),e.topGround?o.push({start:this.allocLocation("ground",{referenceBBPin:r}),end:{type:"dalboard",pin:t},color:h}):e.bottomGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:t},color:h}),e.bottomThreeVolt&&e.bottomGround?a.push({start:this.allocLocation("threeVolt",{referenceBBPin:r}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:d}):e.bottomFiveVolt&&e.bottomGround&&l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:r}),end:this.allocLocation("fiveVolt",{referenceBBPin:n}),color:c}),e.topThreeVolt?a.push({start:this.allocLocation("threeVolt",{referenceBBPin:r}),end:{type:"dalboard",pin:s},color:d}):e.bottomThreeVolt&&a.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:s},color:c}),e.topFiveVolt&&!e.topThreeVolt?l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:r}),end:{type:"dalboard",pin:i},color:d}):e.bottomFiveVolt&&!e.bottomThreeVolt&&l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:c});t=[];0<o.length&&t.push({wireIndices:o.map((e,t)=>t)});let u=o.length;return 0<a.length&&t.push({wireIndices:a.map((e,t)=>t+u)}),0<l.length&&t.push({wireIndices:a.map((e,t)=>t+u+a.length)}),{wires:o.concat(a).concat(l),assembly:t}}allocWire(e){const s=[e.start,e.end],i=s.map(e=>"ground"===e||"threeVolt"===e||"fiveVolt"===e);let r=s.map((e,t)=>i[t]?void 0:this.allocLocation(e,{}));if((r=r.map((e,t)=>{return e||(e=r[1-t],this.allocLocation(s[t],{referenceBBPin:e}))}))[0]&&r[1])return{start:r[0],end:r[1],color:e.color}}allocPart(i){var e=i.pins.filter(e=>p(e.def)).map(e=>{let t=i.startRowIdx+e.bbFit.partRelativeRowIdx;7<=t&&(t-=2);var s=m.visuals.getRowName(t),e=i.startColumnIdx+e.bbFit.partRelativeColIdx;return{type:"breadboard",row:s,col:m.visuals.getColumnName(e)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:e,params:i.partParams,simulationBehavior:i.def.simulationBehavior}}allocAll(){var e=this.opts.partsList.map(e=>({name:e,def:this.opts.partDefs[e]})).filter(e=>!!e.def);if(0<e.length){let s=e.map(e=>this.computePartDimensions(e.def,e.name)),i=[];e.forEach((e,t)=>{t=s[t],e=this.allocPartIRs(e.def,e.name,t);i=i.concat(e)});var e=this.placeParts(i).map(e=>this.allocWireIRs(e)),t=e.map(e=>e.wires).reduce((e,t)=>e.concat(t),[]).map(e=>{return e=[e.start,e.end],t=e.map(e=>"ground"===e),s=e.map(e=>"threeVolt"===e),i=e.map(e=>"fiveVolt"===e),e=e.map(t=>{{let e=!1;return"string"!=typeof t&&"breadboard"===t.type&&(t=t.row,e=0<=["a","b","c","d","e"].indexOf(t)),e}}),t=r(t),s=r(s),i=r(i),e=r(e),{topGround:t&&!e,topThreeVolt:s&&!e,topFiveVolt:i&&!e,bottomGround:t&&e,bottomThreeVolt:s&&e,bottomFiveVolt:i&&e,singleGround:t,singleThreeVolt:s,singleFiveVolt:i};var t,s,i}),t=(this.powerUsage=((t=t.reduce((e,t)=>({topGround:e.topGround||t.topGround,topThreeVolt:e.topThreeVolt||t.topThreeVolt,topFiveVolt:e.topFiveVolt||t.topFiveVolt,bottomGround:e.bottomGround||t.bottomGround,bottomThreeVolt:e.bottomThreeVolt||t.bottomThreeVolt,bottomFiveVolt:e.bottomFiveVolt||t.bottomFiveVolt,singleGround:t.singleGround?null===e.singleGround:e.singleGround,singleThreeVolt:t.singleThreeVolt?null===e.singleThreeVolt:e.singleThreeVolt,singleFiveVolt:t.singleFiveVolt?null===e.singleFiveVolt:e.singleFiveVolt}),{topGround:!1,topThreeVolt:!1,topFiveVolt:!1,bottomGround:!1,bottomThreeVolt:!1,bottomFiveVolt:!1,singleGround:null,singleThreeVolt:null,singleFiveVolt:null})).singleGround&&(t.topGround=t.bottomGround=!1),t.singleThreeVolt&&(t.topThreeVolt=t.bottomThreeVolt=!1),t.singleFiveVolt&&(t.topFiveVolt=t.bottomFiveVolt=!1),t),this.allocPowerWires(this.powerUsage)),e=e.map((e,t)=>{var s=this.allocPart(e),i=e.wires.map(e=>this.allocWire(e));if(!i.some(e=>!e)){const r=[];return e.wires.forEach((e,t)=>{r[e.pinIdx]=t}),{part:s,wires:i,assembly:e.def.assembly.map(e=>({part:e.part,wireIndices:(e.pinIndices||[]).map(e=>r[e])}))}}}).filter(e=>!!e),t=[t].concat(e).filter(e=>e.assembly&&e.assembly.length),e=!t.some(e=>e.part&&e.part.breadboardConnections&&0<e.part.breadboardConnections.length||e.wires&&e.wires.some(e=>"breadboard"==e.end.type&&"croc"!=e.end.style||"breadboard"==e.start.type&&"croc"!=e.start.style));return{partsAndWires:t,wires:[],parts:[],hideBreadboard:e}}return{partsAndWires:[],wires:[],parts:[]}}}m.allocateDefinitions=function(e){return new t(e).allocAll()}}(pxsim=pxsim||{}),function(e){{var n=e.protocol||(e.protocol={});class t{constructor(e){this.seq=0,this.type=e}}n.Message=t,n.Response=class extends t{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};class s extends t{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}n.Event=s,n.Source=class{constructor(e,t,s=0,i,r){this.name=e,this.path=t,this.sourceReference=s,i&&(this.origin=i),r&&(this.adapterData=r)}},n.Scope=class{constructor(e,t,s=!1){this.name=e,this.variablesReference=t,this.expensive=s}},n.StackFrame=class{constructor(e,t,s,i=0,r=0){this.id=e,this.source=s,this.line=i,this.column=r,this.name=t}},n.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}},n.Variable=class{constructor(e,t,s=0,i,r){this.name=e,this.value=t,this.variablesReference=s,"number"==typeof r&&(this.namedVariables=r),"number"==typeof i&&(this.indexedVariables=i)}},n.Breakpoint=class{constructor(e,t,s,i){this.verified=e;"number"==typeof t&&(this.line=t),"number"==typeof s&&(this.column=s),i&&(this.source=i)}},n.Module=class{constructor(e,t){this.id=e,this.name=t}},n.CompletionItem=class{constructor(e,t,s=0){this.label=e,this.start=t,this.length=s}},n.StoppedEvent=class extends s{constructor(e,t,s=null){super("stopped"),this.body={reason:e,threadId:t},s&&(this.body.text=s)}},n.ContinuedEvent=class extends s{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}},n.InitializedEvent=class extends s{constructor(){super("initialized")}},n.TerminatedEvent=class extends s{constructor(e){super("terminated"),"boolean"==typeof e&&(this.body={restart:e})}},n.OutputEvent=class extends s{constructor(e,t="console",s){super("output"),this.body={category:t,output:e},void 0!==s&&(this.body.data=s)}},n.ThreadEvent=class extends s{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}},n.BreakpointEvent=class extends s{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}},n.ModuleEvent=class extends s{constructor(e,t){super("module"),this.body={reason:e,module:t}}};class i{constructor(){this._pendingRequests={}}start(e){this._sequence=1,this.host=e,this.host.onData(e=>{var t;"request"===e.type?this.dispatchRequest(e):"response"===e.type&&(t=this._pendingRequests[(e=e).seq])&&(delete this._pendingRequests[e.seq],t(e))})}stop(){this.host&&this.host.close()}sendEvent(e){this.send("event",e)}sendResponse(e){0<e.seq?console.error("attempt to send more than one response for command "+e.command):this.send("response",e)}sendRequest(t,e,s,i){const r={command:t};if(e&&0<Object.keys(e).length&&(r.arguments=e),this.send("request",r),i){this._pendingRequests[r.seq]=i;const t=setTimeout(()=>{clearTimeout(t);var e=this._pendingRequests[r.seq];e&&(delete this._pendingRequests[r.seq],e(new n.Response(r,"timeout")))},s)}}send(e,t){if(t.type=e,t.seq=this._sequence++,this.host){const e=JSON.stringify(t);this.host.send(e)}}dispatchRequest(e){}}n.ProtocolServer=i;class o extends i{constructor(){super(...arguments),this._debuggerLinesStartAt1=!1,this._debuggerColumnsStartAt1=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0}shutdown(){}dispatchRequest(e){var t=new n.Response(e);try{if("initialize"===e.command){var s=e.arguments;if("boolean"==typeof s.linesStartAt1&&(this._clientLinesStartAt1=s.linesStartAt1),"boolean"==typeof s.columnsStartAt1&&(this._clientColumnsStartAt1=s.columnsStartAt1),"path"!==s.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null);else{const e=t;e.body={},this.initializeRequest(e,s)}}else"launch"===e.command?this.launchRequest(t,e.arguments):"attach"===e.command?this.attachRequest(t,e.arguments):"disconnect"===e.command?this.disconnectRequest(t,e.arguments):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments):"continue"===e.command?this.continueRequest(t,e.arguments):"next"===e.command?this.nextRequest(t,e.arguments):"stepIn"===e.command?this.stepInRequest(t,e.arguments):"stepOut"===e.command?this.stepOutRequest(t,e.arguments):"stepBack"===e.command?this.stepBackRequest(t,e.arguments):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments):"goto"===e.command?this.gotoRequest(t,e.arguments):"pause"===e.command?this.pauseRequest(t,e.arguments):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments):"scopes"===e.command?this.scopesRequest(t,e.arguments):"variables"===e.command?this.variablesRequest(t,e.arguments):"setVariable"===e.command?this.setVariableRequest(t,e.arguments):"source"===e.command?this.sourceRequest(t,e.arguments):"threads"===e.command?this.threadsRequest(t):"evaluate"===e.command?this.evaluateRequest(t,e.arguments):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments):"completions"===e.command?this.completionsRequest(t,e.arguments):this.customRequest(e.command,t,e.arguments)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack})}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,this.sendResponse(e)}disconnectRequest(e,t){this.sendResponse(e),this.shutdown()}launchRequest(e,t){this.sendResponse(e)}attachRequest(e,t){this.sendResponse(e)}setBreakPointsRequest(e,t){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t){this.sendResponse(e)}configurationDoneRequest(e,t){this.sendResponse(e)}continueRequest(e,t){this.sendResponse(e)}nextRequest(e,t){this.sendResponse(e)}stepInRequest(e,t){this.sendResponse(e)}stepOutRequest(e,t){this.sendResponse(e)}stepBackRequest(e,t){this.sendResponse(e)}restartFrameRequest(e,t){this.sendResponse(e)}gotoRequest(e,t){this.sendResponse(e)}pauseRequest(e,t){this.sendResponse(e)}sourceRequest(e,t){this.sendResponse(e)}threadsRequest(e){this.sendResponse(e)}stackTraceRequest(e,t){this.sendResponse(e)}scopesRequest(e,t){this.sendResponse(e)}variablesRequest(e,t){this.sendResponse(e)}setVariableRequest(e,t){this.sendResponse(e)}evaluateRequest(e,t){this.sendResponse(e)}stepInTargetsRequest(e,t){this.sendResponse(e)}gotoTargetsRequest(e,t){this.sendResponse(e)}completionsRequest(e,t){this.sendResponse(e)}customRequest(e,t,s){this.sendErrorResponse(t,1014,"unrecognized request",null)}sendErrorResponse(e,t,s,i){let r;"number"==typeof t?(r={id:t,format:s},i&&(r.variables=i),r.showUser=!0):r=t,e.success=!1,o.formatPII(r.format,!0,r.variables),e.body||(e.body={}),e.body.error=r,this.sendResponse(e)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(e):o.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(e):o.path2uri(e):e}static path2uri(e){let t=e.replace(/\\/g,"/");return"/"!==t[0]&&(t="/"+t),encodeURI("file://"+t)}static uri2path(e){return e}static formatPII(e,s,i){return e.replace(o._formatPIIRegexp,function(e,t){return!(s&&0<t.length&&"_"!==t[0])&&i[t]&&i.hasOwnProperty(t)?i[t]:e})}}o._formatPIIRegexp=/{([^}]+)}/g,n.DebugSession=o}}(pxsim=pxsim||{}),function(e){function a(e){e=e.replace(/\\/g,"/");const t=[];return e.split("/").forEach(e=>{".."===e&&t.length?t.pop():e&&"."!==e&&t.push(e)}),t}(e=e.util||(e.util={})).injectPolyphils=function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return void 0!==e&&null!=e&&this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError("this is null or not defined");let t=Object(this),s=t.length>>>0,i=arguments[1],r=i>>0,n=r<0?Math.max(s+r,0):Math.min(r,s),o=arguments[2],a=void 0===o?s:o>>0,l=a<0?Math.max(s+a,0):Math.min(a,s);for(;n<l;)t[n]=e,n++;return t}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this);const s=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");var i=arguments[1];let r=0;for(;r<s;){const s=t[r];if(e.call(i,s,r,t))return s;r++}}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint8Array.prototype.some||Object.defineProperty(Uint8Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint16Array.prototype.some||Object.defineProperty(Uint16Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint32Array.prototype.some||Object.defineProperty(Uint32Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint8Array.prototype.reverse||Object.defineProperty(Uint8Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint16Array.prototype.reverse||Object.defineProperty(Uint16Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint32Array.prototype.reverse||Object.defineProperty(Uint32Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Math.imul||(Math.imul=function(e,t){var s=65535&e,i=65535&t;return s*i+((e>>>16&65535)*i+s*(t>>>16&65535)<<16>>>0)|0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");var s=Object(e);for(let e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},writable:!0,configurable:!0}),Promise.prototype.finally||(Promise.prototype.finally=Promise.prototype.finally||{finally(t){const s=e=>Promise.resolve(t()).then(e);return this.then(e=>s(()=>e),e=>s(()=>Promise.reject(e)))}}.finally)},e.Lazy=class{constructor(e){this._func=e,this._evaluated=!1}get value(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value}},e.getNormalizedParts=a,e.normalizePath=function(e){return a(e).join("/")},e.relativePath=function(e,t){var s=a(e),i=a(t);let r=0;for(;s[r]===i[r]&&++r!==s.length&&r!==i.length;);var n=s.slice(r),o=i.slice(r);for(let e=0;e<n.length;e++)o.unshift("..");return o.join("/")},e.pathJoin=function(...e){let t="";return e.forEach(e=>{e.replace(/\\/g,"/"),e.lastIndexOf("/")===e.length-1&&(e=e.slice(0,e.length-1)),t+="/"+e}),t},e.toArray=function(t){if(Array.isArray(t))return t;var s=[];for(let e=0;e<t.length;++e)s.push(t[e]);return s}}(pxsim=pxsim||{}),function(o){function u(e,t){switch(typeof e){case"string":case"number":case"boolean":return e;case"function":return{text:"(function)",type:"function"};case"undefined":return null;case"object":var s,i;return e?e instanceof o.RefObject?(t&&(t[e.id]=e),i=(s=o.RefObject.toDebugString(e)).startsWith("[")?"array":s,{id:e.id,preview:s,hasFields:null!==e.fields||s.startsWith("["),type:i}):e._width&&e._height?{text:e._width+"x"+e._height,type:"image"}:{text:"(object)",type:"object"}:null;default:throw new Error}}function a(e,s,t,i){{var r=e,n;e=t;const l={};for(n of Object.keys(r))/^__/.test(n)||!/___\d+$/.test(n)||i&&-1===i.indexOf(n)||(l[n]=u(r[n],s));if(r.fields&&e)for(var o of e)o=o.substring(o.lastIndexOf(".")+1),l[o]=u(function(e,t){let s={pc:0,arg0:t,fn:e,parent:{}};for(;s.fn;)s=s.fn(s);return s.retval}(r.vtable.iface[o],r),s);if(r.fields)for(var a of Object.keys(r.fields).filter(e=>!e.startsWith("_")))l[a]=u(r.fields[a],s);else Array.isArray(r.data)&&r.data.forEach((e,t)=>{l[t]=u(e,s)});return l}}o.getWarningMessage=function(e){let t={type:"debugger",subtype:"warning",breakpointIds:[],message:e},s=o.runtime.currFrame;for(;null!=s;)t.breakpointIds.push(s.lastBrkId),s=s.parent;return t},o.BreakpointMap=class{constructor(e){this.fileMap={},this.idMap={},e.forEach(e=>{var[t,s]=e;this.fileMap[s.source.path]||(this.fileMap[s.source.path]=[]),this.fileMap[s.source.path].push(e),this.idMap[t]=s});for(const e in this.fileMap){var t=this.fileMap[e];this.fileMap[e]=t.sort(([,e],[,t])=>e.line===t.line?t.endLine===e.endLine?e.column-t.column:t.endLine-e.endLine:e.line-t.line)}}getById(e){return this.idMap[e]}verifyBreakpoint(e,t){var s=this.fileMap[e];let i;if(s)for(const[e,r]of s)r.line<=t.line&&r.endLine>=t.line&&(i=[e,r]);return i?(i[1].verified=!0,i):[-1,{verified:!1}]}},o.dumpHeap=a,o.injectEnvironmentGlobals=function(e,t){var s=o.runtime.environmentGlobals;if(Object.keys(s).length){const i=e.environmentGlobals={};Object.keys(s).forEach(e=>i[e]=u(o.runtime.environmentGlobals[e],t))}},o.getBreakpointMsg=function(e,t,s){for(var i={},r={type:"debugger",subtype:"breakpoint",breakpointId:t,globals:a(o.runtime.globals,i,void 0,s),stackframes:[]};null!=e;){var n=function(s,i){var e=s.fn?s.fn.info:null;if(e){var t={thisParam:u(s.argL,i),params:[]};if(e.argumentNames){const a=e.argumentNames;t.params=a.map((e,t)=>({name:e,value:u(s["arg"+t],i)}))}return{locals:a(s,i),funcInfo:e,breakpointId:s.lastBrkId,callLocationId:s.callLocIdx,arguments:t}}}(e,i);n&&r.stackframes.push(n),e=e.parent}return{msg:r,heap:i}};class t extends o.protocol.DebugSession{constructor(e){super(),this.driver=new o.SimulatorDriver(e,{onDebuggerBreakpoint:e=>this.onDebuggerBreakpoint(e),onDebuggerWarning:e=>this.onDebuggerWarning(e),onDebuggerResume:()=>this.onDebuggerResume(),onStateChanged:e=>this.onStateChanged(e)})}runCode(e,t,s,i,r){this.breakpoints=i,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new o.protocol.InitializedEvent),this.driver.run(e,{parts:t,fnArgs:s,boardDefinition:r})}stopSimulator(e=!1){this.driver.stop(e)}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsConfigurationDoneRequest=!0,this.sendResponse(e)}disconnectRequest(e,t){this.sendResponse(e),this.shutdown()}launchRequest(e,t){this.projectDir||(this.projectDir=o.util.normalizePath(t.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(e)}setBreakPointsRequest(s,i){s.body={breakpoints:[]};const r=[];i.breakpoints.forEach(e=>{var t;this.breakpoints?([e,t]=this.breakpoints.verifyBreakpoint(o.util.relativePath(this.projectDir,i.source.path),e),s.body.breakpoints.push(t),t.verified&&r.push(e)):s.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(r),this.sendResponse(s)}continueRequest(e,t){this.driver.resume(o.SimulatorDebuggerCommand.Resume),this.sendResponse(e)}nextRequest(e,t){this.driver.resume(o.SimulatorDebuggerCommand.StepOver),this.sendResponse(e)}stepInRequest(e,t){this.driver.resume(o.SimulatorDebuggerCommand.StepInto),this.sendResponse(e)}stepOutRequest(e,t){this.driver.resume(o.SimulatorDebuggerCommand.StepOut),this.sendResponse(e)}pauseRequest(e,t){this.driver.resume(o.SimulatorDebuggerCommand.Pause),this.sendResponse(e)}threadsRequest(e){e.body={threads:[{id:t.THREAD_ID,name:"main"}]},this.sendResponse(e)}stackTraceRequest(e,t){if(this.lastBreak){const t=this.state.getFrames();e.body={stackFrames:t}}this.sendResponse(e)}scopesRequest(e,t){this.state&&(e.body={scopes:this.state.getScopes(t.frameId)}),this.sendResponse(e)}variablesRequest(e,t){this.state&&(e.body={variables:this.state.getVariables(t.variablesReference)}),this.sendResponse(e)}onDebuggerBreakpoint(e){this.lastBreak=e,this.state=new s(this.lastBreak,this.breakpoints,this.projectDir),e.exceptionMessage?(e=e.exceptionMessage.replace(/___\d+/g,""),this.sendEvent(new o.protocol.StoppedEvent("exception",t.THREAD_ID,e))):this.sendEvent(new o.protocol.StoppedEvent("breakpoint",t.THREAD_ID))}onDebuggerWarning(e){}onDebuggerResume(){this.sendEvent(new o.protocol.ContinuedEvent(t.THREAD_ID,!0))}onStateChanged(e){switch(e){case o.SimulatorState.Paused:break;case o.SimulatorState.Running:this.sendEvent(new o.protocol.ContinuedEvent(t.THREAD_ID,!0));break;case o.SimulatorState.Stopped:this.sendEvent(new o.protocol.TerminatedEvent)}}fixBreakpoints(){for(const t in this.breakpoints.idMap){var e=this.breakpoints.idMap[t];e.source.path=o.util.pathJoin(this.projectDir,e.source.path),e.line=this.convertDebuggerLineToClient(e.line),e.endLine=this.convertDebuggerLineToClient(e.endLine),e.column=this.convertDebuggerColumnToClient(e.column),e.endColumn=this.convertDebuggerColumnToClient(e.endColumn)}}}t.THREAD_ID=1,o.SimDebugSession=t;class s{constructor(e,t,s){this._message=e,this._map=t,this._dir=s,this._currentId=1,this._frames={},this._vars={};e=this.nextId();this._vars[e]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:e,expensive:!1}}getFrames(){return this._message.stackframes.map((e,t)=>{var s=this._map.getById(e.breakpointId);if(s)return{id:(this._frames[e.breakpointId]=e).breakpointId,name:e.funcInfo?e.funcInfo.functionName:0===t?"main":"anonymous",line:s.line,column:s.column,endLine:s.endLine,endColumn:s.endLine,source:s.source}}).filter(e=>!!e)}getScopes(e){var t=this._frames[e];if(t){const e=this.nextId();return this._vars[e]=this.getVariableValues(t.locals),[{name:"Locals",variablesReference:e,expensive:!1},this._globalScope]}return[this._globalScope]}getVariables(e){e=this._vars[e];return e&&e.value||[]}getVariableValues(n){return new o.util.Lazy(()=>{var s=[];for(const r in n){var i=n[r];let e,t=0;null===i?e="null":void 0===i?e="undefined":"object"==typeof i?(e="(object)",t=this.nextId(),this._vars[t]=this.getVariableValues(i)):e=i.toString();i=r.substr(0,r.lastIndexOf("___"));s.push({name:i,value:e,variablesReference:t})}return s})}nextId(){return this._currentId++}}}(pxsim=pxsim||{}),function(o){function a(e=0){function t(){try{window.print()}catch(e){}}e?setTimeout(t,e):t()}function l(e,t){i({type:"pxtsim",action:"event",tick:e,data:t})}function i(e){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}function s(){setInterval(()=>{o.Runtime.postMessage({type:"simulator",command:"reload"})},3e3)}o.print=a;{var r=o.Embed||(o.Embed={});function u(e){e.origin;var t,s=e.data||{},e=s.type;if(e)switch(e){case"run":d(s);break;case"instructions":o.instructions.renderInstructions(s);break;case"stop":h();break;case"mute":c(s.mute);break;case"stopsound":o.AudioContextManager.stopAll();break;case"print":a();break;case"recorder":var i=s;if(n)switch(i.action){case"start":n.startRecording(i.width);break;case"stop":n.stopRecording()}break;case"screenshot":o.Runtime.postScreenshotAsync(s);break;case"custom":o.handleCustomMessage&&o.handleCustomMessage(s);break;case"pxteditor":break;case"debugger":n&&n.handleDebuggerMsg(s);break;case"simulator":var r=s;switch(r.command){case"focus":l("simulator.focus",{timestamp:r.timestamp});break;case"blur":l("simulator.blur",{timestamp:r.timestamp})}default:t=s,n&&!n.dead&&n.board.receiveMessage(t)}}let n;function h(){n&&(n.kill(),n.board)&&n.board.kill()}function d(e){h(),e.mute&&c(e.mute),e.localizedStrings&&o.localization.setLocalizedStrings(e.localizedStrings);const t=new o.Runtime(e);(n=t).board.initAsync(e).then(()=>{t===n&&t.run(e=>{o.dumpLivePointers(),o.Runtime.postMessage({type:"toplevelcodefinished"})})})}function c(e){o.AudioContextManager.mute(e)}r.start=function(){if(window.addEventListener("message",u,!1),r.frameid=window.location.hash.slice(1),"serviceWorker"in navigator&&-1!==window.location.href.indexOf("---simulator")&&!o.U.isLocalHost()){const o=window.location.pathname,t=o.substring(1,o.indexOf("---"));navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",e=>{e=e.data;e&&"serviceworker"===e.type&&"activated"===e.state&&e.ref===t&&s()});var e=window.location.href.replace(/---simulator.*$/,"---simserviceworker");navigator.serviceWorker.register(e).then(function(e){console.log("Simulator ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("Simulator ServiceWorker registration failed: ",e)})}o.Runtime.postMessage({type:"ready",frameid:r.frameid})},r.stop=h,r.run=d}o.tickEvent=l,o.reportError=function(e,t,s){i({type:"pxtsim",action:"event",tick:"error",category:e,message:t,data:s})},o.reload=s}(pxsim=pxsim||{}),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(e){pxsim.Embed.start()}),function(x){{var e=x.instructions||(x.instructions={});const l=e=>e+"x",[s,i]=[816*.95,1056*.95],r=s-86.4,n=i-86.4,[o,u]=[1,1],h=r/u-48*u,d=`
            .instr-panel {
                margin: 20px;
                padding: 24px;
                border-width: 4px;
                border-color: gray;
                border-style: solid;
                border-radius: 20px;
                display: inline-block;
                width: ${h}px;
                height: ${n/o-48*o}px;
                position: relative;
                overflow: hidden;
                page-break-inside: avoid;
            }
            .board-svg {
                margin: 0 auto;
                display: block;
                position: absolute;
                bottom: 24px;
                left: ${(h-465)/2+24}px;
            }
            .panel-num-outer {
                position: absolute;
                left: -4px;
                top: -4px;
                width: 120px;
                height: 120px;
                border-width: 4px;
                border-style: solid;
                border-color: gray;
                border-radius: 20px 0 20px 0;
            }
            .panel-num {
                margin: 10px 0;
                text-align: center;
                font-size: 80px;
            }
            .cmp-div {
                display: inline-block;
            }
            .reqs-div {
                margin-left: 144px;
                margin-top: 5px;
            }
            .partslist-wire,
            .partslist-cmp {
                margin: 10px;
            }
            .partslist-wire {
                display: inline-block;
            }
            `;function a(e,t){let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),i={l:0,t:0,w:0,h:0},r=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=(s.appendChild(r),r.appendChild(e.el),{viewBox:`${e.x} ${e.y} ${e.w} `+e.h,preserveAspectRatio:"xMidYMid"});i.w=e.w,i.h=e.h;var o,a,l,u,e=e=>{i.h*=e,i.w*=e,n.width=i.w,n.height=i.h},e=(t.cmpScale&&e(t.cmpScale),t.cmpWidth&&t.cmpWidth<i.w?e(t.cmpWidth/i.w):t.cmpHeight&&t.cmpHeight<i.h&&e(t.cmpHeight/i.h),x.svg.hydrate(r,n),i.l),h=i.t,d=i.w,c=i.h,p=e=>{var t;e<i.l&&(t=i.l-e,i.l=e,i.w+=t)},m=e=>{var t=i.l+i.w;t<e&&(e=e-t,i.w+=e)},f=e=>{var t;e<i.t&&(t=i.t-e,i.t=e,i.h+=t)},g=e=>{var t=i.t+i.h;t<e&&(e=e-t,i.h+=e)},[b,v]=[-.3,.3],y=[1.4,1],w=(t&&t.top&&(u=(w=t.topSize)/y[0],[a,o]=[e+d/2,h-3-(l=w/y[1])/2],w=x.visuals.mkTxt(a,o,w,0,t.top,b,v),x.U.addClass(w,"cmp-lbl"),s.appendChild(w),w=u*t.top.length,f(o-l/2),p(a-w/2),m(a+w/2)),t&&t.bot&&(o=(u=t.botSize)/y[0],[a,w]=[e+d/2,h+c+3+(l=u/y[1])/2],u=x.visuals.mkTxt(a,w,u,0,t.bot,b,v),x.U.addClass(u,"cmp-lbl"),s.appendChild(u),u=o*t.bot.length,g(w+l/2),p(a-u/2),m(a+u/2)),t&&t.right&&(w=(o=t.rightSize)/y[1],[a,u]=[e+d+5+(l=o/y[0]*t.right.length)/2,h+c/2],d=x.visuals.mkTxt(a,u,o,0,t.right,b,v),x.U.addClass(d,"cmp-lbl"),s.appendChild(d),f(u-w/2),m(a+l/2),g(u+w/2)),t&&t.left&&(d=(o=t.leftSize)/y[1],[a,l]=[e-5-(m=o/y[0]*t.left.length)/2,h+c/2],u=x.visuals.mkTxt(a,l,o,0,t.left,b,v),x.U.addClass(u,"cmp-lbl"),s.appendChild(u),f(l-d/2),p(a-m/2),g(l+d/2)),{viewBox:`${i.l} ${i.t} ${i.w} `+i.h,width:1.7*i.w,height:1.7*i.h,preserveAspectRatio:"xMidYMid"}),e=(x.svg.hydrate(s,w),document.createElement("div"));return e.appendChild(s),e}function c(e,t){let s,i=x.runtime.board;return a(s="wire"==e?x.visuals.mkWirePart([0,0],t.wireClr||"red",t.crocClips):"string"==typeof(e=e).builtIn?(0,i.builtinPartVisuals[e.builtIn])([0,0]):x.visuals.mkGenericPartSVG(e),t)}function p(e,t,s=!1){t={state:x.runtime.board,boardDef:e.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:e.allAlloc.requiresBreadboard,partDefs:e.cmpDefs,maxWidth:t+"px",fnArgs:e.fnArgs,wireframe:s,partsList:[]},e=new x.visuals.BoardHost(x.visuals.mkBoardView({visual:t.boardDef.visual,boardDef:t.boardDef,wireframe:t.wireframe}),t),s=e.getView();return x.U.addClass(s,"board-svg"),e}function m(){var e=document.createElement("div");return x.U.addClass(e,"instr-panel"),e}function t(t,e){e.boardDef.pinStyles||(e.boardDef.pinStyles={}),e.configData&&x.setConfigData(e.configData.cfg,e.configData.cfgKey);var s,i={type:"run",code:"",boardDefinition:e.boardDef,partDefinitions:e.partDefinitions},i=(x.runtime=new x.Runtime(i),x.runtime.board=null,x.initCurrentRuntime(i),document.createElement("style")),i=(i.textContent+=d,document.head.appendChild(i),e.partDefinitions),r=new x.visuals.Breadboard({}),n=function(e){let t=x.allocateDefinitions(e),r=[],n=[],o=1,s=(t.partsAndWires.forEach(e=>{let s=e.part,i=e.wires;e.assembly.forEach((e,t)=>{e.part&&s&&(n[o+t]=[s]),e.wireIndices&&0<e.wireIndices.length&&i&&(r[o+t]=e.wireIndices.map(e=>i[e]))}),o+=e.assembly.length}),o-1),i=t.partsAndWires.map(e=>e.part).filter(e=>!!e),a=t.partsAndWires.map(e=>e.wires||[]).reduce((e,t)=>e.concat(t),[]),l={},u=[];return a.forEach(e=>{l[e.color]||(l[e.color]=[],u.push(e.color)),l[e.color].push(e)}),{boardDef:e.boardDef,cmpDefs:e.partDefs,fnArgs:e.fnArgs,allAlloc:t,stepToWires:r,stepToCmps:n,allWires:a,allCmps:i,lastStep:s,colorToWires:l,allWireColors:u}}({boardDef:e.boardDef,partDefs:i,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:r.getCoord.bind(r)}),i=(n.allAlloc.requiresBreadboard=!0,i=n,r=document.getElementById("front-panel"),(s=p(i,400,!1)).addAll(i.allAlloc),r.appendChild(s.getView()),function(i){let r=m();var e=a((e=i.boardDef,x.visuals.mkBoardView({visual:e.visual,boardDef:e}).getView()),{left:l(1),leftSize:30,cmpScale:.17}),e=(r.appendChild(e),a(new x.visuals.Breadboard({}).getSVGAndSize(),{left:l(1),leftSize:30,cmpScale:.25}));return r.appendChild(e),i.allCmps.forEach(e=>{let t=1;"buttonpair"===e.visual.builtIn&&(t=2);e=c(e.visual,{left:l(t),leftSize:30,cmpScale:.3});x.U.addClass(e,"partslist-cmp"),r.appendChild(e)}),i.allWireColors.forEach(e=>{var t=i.colorToWires[e].length,s=i.boardDef.pinStyles[e]||"female",t=c("wire",{left:l(t),leftSize:20,wireClr:e,cmpScale:.23,crocClips:"croc"==s});x.U.addClass(t,"partslist-wire"),r.appendChild(t)}),r}(n));t.appendChild(i);for(let e=0;e<=n.lastStep;e++){var o=function(e,s){var t=m(),i=p(s,465,!0),r=i,n=e,o=s,a=r.getView();0<n&&x.U.addClass(a,"grayed");for(let s=0;s<=n;s++){var l=o.stepToCmps[s],l=(l&&l.forEach(e=>{var t=r.addPart(e);s===n&&(e.breadboardConnections.forEach(e=>r.highlightBreadboardPin(e)),x.U.addClass(t.element,"notgrayed"))}),o.stepToWires[s]);l&&l.forEach(e=>{var t=r.addWire(e);t&&s===n&&("breadboard"==e.start.type?r.highlightBreadboardPin(e.start):r.highlightBoardPin(e.start.pin),"breadboard"==e.end.type?r.highlightBreadboardPin(e.end):r.highlightBoardPin(e.end.pin),r.highlightWire(t))})}t.appendChild(i.getView()),a=document.createElement("div"),x.U.addClass(a,"panel-num-outer"),x.U.addClass(a,"noselect"),t.appendChild(a),i=document.createElement("div"),x.U.addClass(i,"panel-num"),i.textContent=e+1+"",a.appendChild(i);let u=document.createElement("div"),h=(x.U.addClass(u,"reqs-div"),t.appendChild(u),s.stepToWires[e]||[]),d=e=>{var t,s;return"breadboard"===e.type?({row:t,col:s}=e,`(${t},${s})`):e.pin};return h.forEach(e=>{let t=!1;"dalboard"==e.end.type&&(t="croc"==s.boardDef.pinStyles[e.end.pin]);e=c("wire",{top:d(e.end),topSize:10,bot:d(e.start),botSize:10,wireClr:e.color,cmpHeight:40,crocClips:t});x.U.addClass(e,"cmp-div"),u.appendChild(e)}),(s.stepToCmps[e]||[]).forEach(n=>{("buttonpair"===n.visual.builtIn?[n.breadboardConnections[0],n.breadboardConnections[2]]:[n.breadboardConnections[0]]).forEach((e,t)=>{let s;var i;s=e?({row:e,col:i}=e,`(${e},${i})`):"";let r=1.5;"buttonpair"===n.visual.builtIn&&(r*=.5);e=c(n.visual,{top:s,topSize:10,cmpHeight:50,cmpScale:r});x.U.addClass(e,"cmp-div"),u.appendChild(e)})}),t}(e,n);t.appendChild(o)}e.print&&x.print(2e3)}e.renderParts=t,e.renderInstructions=function(e){document.getElementById("proj-title").innerText=e.options.name||"",t(document.body,e.options)}}}(pxsim=pxsim||{}),function(d){function i(e,t="sim: check failed"){if(!e)throw new Error(t)}d.quiet=!1,d.check=i,d.title="";let e,t,s,r,n,o={},a={};d.getConfig=function(e){return a.hasOwnProperty(e+"")?a[e+""]:null},d.getConfigKey=function(e){return o.hasOwnProperty(e)?o[e]:null},d.getAllConfigKeys=function(){return Object.keys(o)},d.setConfigKey=function(e,t){o[e]=t},d.setConfig=function(e,t){a[e]=t},d.setConfigData=function(e,t){a=e,o=t},d.getConfigData=function(){return{cfg:a,cfgKey:o}},d.setTitle=function(e){d.title=e};class l{constructor(){d.runtime?this.id=d.runtime.registerLiveObject(this):this.id=0}destroy(){}scan(e){throw d.U.userError("scan not implemented")}gcKey(){throw d.U.userError("gcKey not implemented")}gcSize(){throw d.U.userError("gcSize not implemented")}gcIsStatic(){return!1}print(){d.runtime&&d.runtime.refCountingDebug&&console.log("RefObject id:"+this.id)}toDebugString(){return"(object)"}static toAny(e){return e&&e.toAny?e.toAny():e}static toDebugString(e){return null===e?"null":void 0===e?"undefined;":e.vtable&&e.vtable.name?e.vtable.name:e.toDebugString?e.toDebugString():"string"==typeof e?JSON.stringify(e):e.toString()}}d.RefObject=l;class u{constructor(e,t,s){this.func=e,this.caps=t,this.args=s}}d.FnWrapper=u;class h extends l{constructor(){super(...arguments),this.fields={}}scan(e){for(var t of Object.keys(this.fields))e(t,this.fields[t])}gcKey(){return this.vtable.name}gcSize(){return this.vtable.numFields+1}destroy(){this.fields=null,this.vtable=null}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefRecord id:${this.id} (${this.vtable.name})`)}}d.RefRecord=h;class c extends l{constructor(){super(...arguments),this.fields=[]}scan(t){for(let e=0;e<this.fields.length;++e)t("_cap"+e,this.fields[e])}gcKey(){return d.functionName(this.func)}gcSize(){return this.fields.length+3}isRef(e){return i(0<=e&&e<this.fields.length),e<this.len}ldclo(e){return i(0<=(e>>=2)&&e<this.fields.length),this.fields[e]}destroy(){this.fields=null,this.func=null}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefAction id:${this.id} len:`+this.fields.length)}}d.RefAction=c;{var p=e=d.pxtcore||(d.pxtcore={});p.seedAddRandom=function(e){},p.mkAction=function(t,e){var s=new c;s.len=t,s.func=e;for(let e=0;e<t;++e)s.fields.push(null);return s},p.runAction=function(e,t){d.getResume()(e instanceof c?new u(e.func,e.fields,t):new u(e,null,t))};let h={};p.dumpPerfCounters=function(){if(d.runtime&&d.runtime.perfCounters){let e="calls,us,name\n";for(var t of d.runtime.perfCounters){t.lastFew.sort();const d=t.lastFew[t.lastFew.length>>1];e+=`${t.numstops},${t.value},${t.name},${d}\n`}{var i=e;let s="";const a=(e,t)=>{s+=e.length>=t?e:("              "+e).slice(-t)},l=e=>a(""+Math.round(e),6),u=(e,t)=>{a(Math.round(t)+"",8),s+=" /",l(e),s+=" =",l(t/e)};for(var r of i.split(/\n/))if(r&&/^\d/.test(r)){const i=r.split(/,/);let e=h[i[2]];e||(h[i[2]]=e={stops:0,us:0,meds:[]}),r=i[2],s+=25<=r.length?r:(r+"                         ").slice(0,25);var r=parseInt(i[0]),n=parseInt(i[1]),o=(u(r,n),s+=" |",u(r-e.stops,n-e.us),s+=" ~",parseInt(i[3])),o=(l(o),10<e.meds.length&&e.meds.shift(),e.meds.push(o),e.meds.slice()),o=(o.sort((e,t)=>e-t),o[o.length>>1]);s+=" ~~",l(o),e.stops=r,e.us=n,s+="\n"}console.log(s)}}}}class m extends l{constructor(){super(...arguments),this.v=void 0}scan(e){e("*",this.v)}gcKey(){return"LOC"}gcSize(){return 2}destroy(){}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefRefLocal id:${this.id} v:`+this.v)}}d.RefRefLocal=m;class f extends l{constructor(){super(...arguments),this.vtable=d.mkMapVTable(),this.data=[]}scan(e){for(var t of this.data)e(t.key,t.val)}gcKey(){return"{...}"}gcSize(){return 2*this.data.length+4}findIdx(t){t+="";for(let e=0;e<this.data.length;++e)if(this.data[e].key==t)return e;return-1}destroy(){super.destroy();for(let e=0;e<this.data.length;++e)this.data[e].val=0;this.data=[]}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefMap id:${this.id} size:`+this.data.length)}toAny(){const t={};return this.data.forEach(e=>{t[e.key]=l.toAny(e.val)}),t}}function g(){d.runtime&&d.runtime.dumpLivePointers()}var b;function v(e,t){return t+="",e instanceof h?e.fields[t]:(t=e.findIdx(t))<0?void 0:e.data[t].val}function y(e,t,s){var i;t+="",e instanceof h?e.fields[t]=s:(i=e.findIdx(t))<0?e.data.push({key:t,val:s}):e.data[i].val=s}d.RefMap=f,d.dumpLivePointers=g,(p=t=d.numops||(d.numops={})).toString=function(e){return null===e?"null":void 0===e?"undefined":e.toString()},p.toBoolDecr=function(e){return!!e},p.toBool=function(e){return!!e},(p=s=d.langsupp||(d.langsupp={})).toInt=function(e){return 0|e},p.toFloat=function(e){return e},p.ignore=function(e){return e},(p=e=d.pxtcore||(d.pxtcore={})).ptrOfLiteral=function(e){return e},p.debugMemLeaks=function(){g()},p.templateHash=function(){return 0},p.programHash=function(){return 0},p.programName=function(){return d.title},p.programSize=function(){return 0},p.afterProgramPage=function(){return 0},p.getConfig=function(e,t){e=d.getConfig(e);return null==e?t:e},p.toInt=function(e){return e>>0},p.toUInt=function(e){return e>>>0},p.toDouble=function(e){return e},p.toFloat=function(e){return e},p.fromInt=function(e){return e},p.fromUInt=function(e){return e},p.fromDouble=function(e){return e},p.fromFloat=function(e){return e},p.fromBool=function(e){return!!e},(b=r=d.pxtrt||(d.pxtrt={})).toInt8=function(e){return(255&e)<<24>>24},b.toInt16=function(e){return(65535&e)<<16>>16},b.toInt32=function(e){return 0|e},b.toUInt32=function(e){return e>>>0},b.toUInt8=function(e){return 255&e},b.toUInt16=function(e){return 65535&e},b.nullFix=function(e){return null==e||!1===e?0:!0===e?1:e},b.nullCheck=function(e){null==e&&d.U.userError("Dereferencing null/undefined value.")},b.panic=function(e){d.U.userError("PANIC! Code "+e)},b.stringToBool=function(e){return e?1:0},b.ptrToBool=function(e){return e?1:0},b.emptyToNull=function(e){return""==e?0:e},b.ldlocRef=function(e){return e.v},b.stlocRef=function(e,t){e.v=t},b.mklocRef=function(){return new m},b.stclo=function(e,t,s){return i(0<=t&&t<e.fields.length),i(null===e.fields[t]),e.fields[t]=s,e},b.runtimeWarning=function(e){d.Runtime.postMessage(d.getWarningMessage(e))},b.mkMap=function(){return new f},b.mapGet=function(e,t){return v(e,b.mapKeyNames[t])},b.mapSet=function(e,t,s){return y(e,b.mapKeyNames[t],s)},b.mapGetByString=v,b.mapDeleteByString=function(e,t){e instanceof f||b.panic(923);t=e.findIdx(t);return 0<=t&&e.data.splice(t,1),!0},b.mapSetGeneric=y,b.mapGetGeneric=v,b.mapSetByString=y,b.keysOf=function(e){var t=new d.RefCollection;if(e instanceof f)for(var s of e.data)t.push(s.key);return t},(p=e=d.pxtcore||(d.pxtcore={})).mkClassInstance=function(e){i(!!e.methods);var t=new h;return t.vtable=e,t},p.switch_eq=function(e,t){return e==t},p.typeOf=function(e){return typeof e},(p=n=d.thread||(d.thread={})).panic=r.panic,p.pause=function(e){let t=d.getResume();d.runtime.schedule(()=>{t()},e)},p.runInBackground=function(e){d.runtime.runFiberAsync(e)},p.forever=function(t){r.nullCheck(t),function e(){d.runtime.runFiberAsync(t).then(()=>d.U.delay(20)).then(e)}()}}(pxsim=pxsim||{}),function(n){class t extends n.RefObject{constructor(){super(),this.data=[]}scan(t){for(let e=0;e<this.data.length;++e)t("["+e+"]",this.data[e])}gcKey(){return"[...]"}gcSize(){return this.data.length+2}toArray(){return this.data.slice(0)}toAny(){return this.data.map(e=>n.RefObject.toAny(e))}toDebugString(){let t="[";for(let e=0;e<this.data.length;++e){0<e&&(t+=",");var s=n.RefObject.toDebugString(this.data[e]);if(100<t.length+s.length){0==e&&(t+=s.substr(0,100)),t+="...";break}t+=s}return t+="]"}destroy(){var t=this.data;for(let e=0;e<t.length;++e)t[e]=0;this.data=[]}isValidIndex(e){return 0<=e&&e<this.data.length}push(e){this.data.push(e)}pop(){return this.data.pop()}getLength(){return this.data.length}setLength(e){this.data.length=e}getAt(e){return this.data[e]}setAt(e,t){this.data[e]=t}insertAt(e,t){this.data.splice(e,0,t)}removeAt(e){return this.data.splice(e,1)[0]}indexOf(e,t){return this.data.indexOf(e,t)}print(){}}let e,s,i,r,o,a,l,u;var h;function d(e){return e<<16>>16}function c(e,t){return n.pxtrt.nullFix(e)==n.pxtrt.nullFix(t)}function p(e,t){if(n.pxtrt.nullCheck(e),e.isValidIndex(t))return e.removeAt(t)}function m(e,t,s){return n.pxtrt.nullCheck(e),e.indexOf(t,s)}n.RefCollection=t,(g=e=n.Array_||(n.Array_={})).mk=function(){return new t},g.isArray=function(e){return e instanceof t},g.length=function(e){return n.pxtrt.nullCheck(e),e.getLength()},g.setLength=function(e,t){n.pxtrt.nullCheck(e),e.setLength(t)},g.push=function(e,t){n.pxtrt.nullCheck(e),e.push(t)},g.pop=function(e,t){return n.pxtrt.nullCheck(e),e.pop()},g.getAt=function(e,t){return n.pxtrt.nullCheck(e),e.getAt(t)},g.removeAt=p,g.insertAt=function(e,t,s){n.pxtrt.nullCheck(e),e.insertAt(t,s)},g.setAt=function(e,t,s){n.pxtrt.nullCheck(e),e.setAt(t,s)},g.indexOf=m,g.removeElement=function(e,t){n.pxtrt.nullCheck(e);t=m(e,t,0);return 0<=t?(p(e,t),1):0},(g=s=n.Math_||(n.Math_={})).imul=Math.imul||function(e,t){var s=65535&e,i=65535&t;return s*i+((e>>>16&65535)*i+s*(t>>>16&65535)<<16>>>0)|0},g.idiv=function(e,t){return(0|e)/(0|t)|0},g.round=function(e){return Math.round(e)},g.roundWithPrecision=function(e,t){if((t|=0)<=0)return Math.round(e);if(0==e)return 0;let s=0;for(;0==s&&t<21;){var i=Math.pow(10,t++);s=Math.round(e*i+Number.EPSILON)/i}return s},g.ceil=function(e){return Math.ceil(e)},g.floor=function(e){return Math.floor(e)},g.sqrt=function(e){return Math.sqrt(e)},g.pow=function(e,t){return Math.pow(e,t)},g.clz32=function(e){return Math.clz32(e)},g.log=function(e){return Math.log(e)},g.log10=function(e){return Math.log10(e)},g.log2=function(e){return Math.log2(e)},g.exp=function(e){return Math.exp(e)},g.sin=function(e){return Math.sin(e)},g.sinh=function(e){return Math.sinh(e)},g.cos=function(e){return Math.cos(e)},g.cosh=function(e){return Math.cosh(e)},g.tan=function(e){return Math.tan(e)},g.tanh=function(e){return Math.tanh(e)},g.asin=function(e){return Math.asin(e)},g.asinh=function(e){return Math.asinh(e)},g.acos=function(e){return Math.acos(e)},g.acosh=function(e){return Math.acosh(e)},g.atan=function(e){return Math.atan(e)},g.atanh=function(e){return Math.atanh(e)},g.atan2=function(e,t){return Math.atan2(e,t)},g.trunc=function(e){return 0<e?Math.floor(e):Math.ceil(e)},g.random=function(){return Math.random()},g.randomRange=function(e,t){var s;return e==t?e:(t<e&&(s=e,e=t,t=s),Math.floor(e)==e&&Math.floor(t)==t?e+Math.floor(Math.random()*(t-e+1)):e+Math.random()*(t-e))},(g=i=n.Number_||(n.Number_={})).lt=function(e,t){return e<t},g.le=function(e,t){return e<=t},g.neq=function(e,t){return!c(e,t)},g.eq=c,g.eqDecr=function(e,t){return n.pxtrt.nullFix(e)==n.pxtrt.nullFix(t)},g.gt=function(e,t){return t<e},g.ge=function(e,t){return t<=e},g.div=function(e,t){return 0|Math.floor(e/t)},g.mod=function(e,t){return e%t},g.bnot=function(e){return~e},g.toString=function(e){return e+""},(g=r=n.thumb||(n.thumb={})).adds=function(e,t){return e+t|0},g.subs=function(e,t){return e-t|0},g.divs=function(e,t){return 0|Math.floor(e/t)},g.muls=function(e,t){return s.imul(e,t)},g.ands=function(e,t){return e&t},g.orrs=function(e,t){return e|t},g.eors=function(e,t){return e^t},g.lsls=function(e,t){return e<<t},g.lsrs=function(e,t){return e>>>t},g.asrs=function(e,t){return e>>t},g.bnot=function(e){return~e},g.ignore=function(e){return e},(g=o=n.avr||(n.avr={})).adds=function(e,t){return d(e+t)},g.subs=function(e,t){return d(e-t)},g.divs=function(e,t){return d(Math.floor(e/t))},g.muls=function(e,t){return d(s.imul(e,t))},g.ands=function(e,t){return d(e&t)},g.orrs=function(e,t){return d(e|t)},g.eors=function(e,t){return d(e^t)},g.lsls=function(e,t){return d(e<<t)},g.lsrs=function(e,t){return(65535&e)>>>t},g.asrs=function(e,t){return d(e>>t)},g.bnot=function(e){return~e},g.ignore=function(e){return e},(g=a=n.String_||(n.String_={})).stringConv=function(e){const t=n.getResume();e instanceof n.RefRecord&&e.vtable.toStringMethod?n.runtime.runFiberAsync(e.vtable.toStringMethod,e).then(()=>{t(n.runtime.currFrame.retval+"")}):t(e+"")},g.mkEmpty=function(){return""},g.fromCharCode=function(e){return String.fromCharCode(e)},g.toNumber=function(e){return parseFloat(e)},g.concat=function(e,t){return e+t},g.substring=function(e,t,s){return n.pxtrt.nullCheck(e),e.slice(t,t+s)},g.equals=function(e,t){return e==t},g.compare=function(e,t){return e==t?0:e<t?-1:1},g.compareDecr=function(e,t){return e==t?0:e<t?-1:1},g.length=function(e){return e.length},g.substr=function(e,t,s){return e.substr(t,s)},g.charAt=function(e,t){return e.charAt(t)},g.charCodeAt=function(e,t){return n.pxtrt.nullCheck(e),s=e,i=t,n.pxtrt.nullCheck(s),0<=i&&i<s.length?e.charCodeAt(t):0;var s,i},g.indexOf=function(e,t,s){return n.pxtrt.nullCheck(e),null==t?-1:e.indexOf(t,s)},g.lastIndexOf=function(e,t,s){return n.pxtrt.nullCheck(e),null==t?-1:e.lastIndexOf(t,s)},g.includes=function(e,t,s){return n.pxtrt.nullCheck(e),null!=t&&e.includes(t,s)},(g=l=n.Boolean_||(n.Boolean_={})).toString=function(e){return e?"true":"false"},g.bang=function(e){return!e};class f extends n.RefObject{constructor(e){super(),this.data=e,this.isStatic=!1}scan(e){}gcKey(){return"Buffer"}gcSize(){return 2+(this.data.length+3>>2)}gcIsStatic(){return this.isStatic}print(){}toDebugString(){return u.toHex(this)}}n.RefBuffer=f;{var g=u=n.BufferMethods||(n.BufferMethods={});let r;function b(e){let t=function(){switch(e){case r.Int8LE:return-1;case r.UInt8LE:return 1;case r.Int16LE:return-2;case r.UInt16LE:return 2;case r.Int32LE:return-4;case r.UInt32LE:return 4;case r.Int8BE:return-10;case r.UInt8BE:return 10;case r.Int16BE:return-20;case r.UInt16BE:return 20;case r.Int32BE:return-40;case r.UInt32BE:return 40;case r.Float32LE:return 4;case r.Float32BE:return 40;case r.Float64LE:return 8;case r.Float64BE:return 80;default:throw n.U.userError("bad format")}}(),s=!1,i=(t<0&&(s=!0,t=-t),!1);return 10<=t&&(i=!0,t/=10),{size:t,signed:s,swap:i,isFloat:e>=r.Float32LE}}function v(e){return new f(new Uint8Array(e))}function y(e,t){return n.pxtrt.nullCheck(e),0<=t&&t<e.data.length}function w(e,t){return y(e,t)?e.data[t]:0}function x(e){e.isStatic&&n.U.userError("Writing to read only buffer.")}function C(e,t,s){y(e,t)&&(x(e),e.data[t]=s)}function S(e,t,s=0,i=-1){s<0||s>e.data.length||(i<0&&(i=e.data.length),i=Math.min(i,e.data.length-s),x(e),e.data.fill(t,s,s+i))}function k(t,s,i,r,n){if(i.buffer===t.buffer)k(t,s,i.slice(r,r+n),0,n);else for(let e=0;e<n;++e)t[s+e]=i[r+e]}(h=r=g.NumberFormat||(g.NumberFormat={}))[h.Int8LE=1]="Int8LE",h[h.UInt8LE=2]="UInt8LE",h[h.Int16LE=3]="Int16LE",h[h.UInt16LE=4]="UInt16LE",h[h.Int32LE=5]="Int32LE",h[h.Int8BE=6]="Int8BE",h[h.UInt8BE=7]="UInt8BE",h[h.Int16BE=8]="Int16BE",h[h.UInt16BE=9]="UInt16BE",h[h.Int32BE=10]="Int32BE",h[h.UInt32LE=11]="UInt32LE",h[h.UInt32BE=12]="UInt32BE",h[h.Float32LE=13]="Float32LE",h[h.Float64LE=14]="Float64LE",h[h.Float32BE=15]="Float32BE",h[h.Float64BE=16]="Float64BE",g.getNumber=function(t,e,s){var i=b(e);if(i.isFloat)return e=t.data.buffer.slice(s,s+i.size),i.swap&&new Uint8Array(e).reverse(),new(4==i.size?Float32Array:Float64Array)(e)[0];let r=0;for(let e=0;e<i.size;++e){r<<=8;var n=i.swap?s+e:s+i.size-e-1;r|=t.data[n]}return i.signed?(e=32-8*i.size,r=r<<e>>e):r>>>=0,r},g.setNumber=function(t,e,s,i){var r=b(e);if(r.isFloat){var n=new Uint8Array(r.size);4==r.size?new Float32Array(n.buffer)[0]=i:new Float64Array(n.buffer)[0]=i,r.swap&&n.reverse();for(let e=0;e<r.size;++e)t.data[s+e]=n[e]}else for(let e=0;e<r.size;++e){var o=r.swap?s+r.size-e-1:s+e;t.data[o]=255&i,i>>=8}},g.createBuffer=v,g.createBufferFromHex=function(t){var s=v(t.length>>1);for(let e=0;e<t.length;e+=2)s.data[e>>1]=parseInt(t.slice(e,e+2),16);return s.isStatic=!0,s},g.isReadOnly=function(e){return e.isStatic},g.getBytes=function(e){return e.data},g.getUint8=w,g.getByte=w,g.setUint8=function(e,t,s){C(e,t,s)},g.setByte=C,g.length=function(e){return e.data.length},g.fill=S,g.slice=function(e,t,s){return t=Math.min(e.data.length,t),s<0&&(s=e.data.length),s=Math.min(s,e.data.length-t),new f(e.data.slice(t,t+s))},g.toHex=function(t){var s="0123456789abcdef";let i="";for(let e=0;e<t.data.length;++e)i=(i+=s[t.data[e]>>4])+s[15&t.data[e]];return i},g.toString=function(e){return n.U.fromUTF8Array(e.data)};const R=-2147483648;g.shift=function(e,t,s,i){i<0&&(i=e.data.length-s),s<0||s+i>e.data.length||s+i<s||0==i||0==t||t==R||0!=i&&0!=t&&t!=R&&(t<=-i||i<=t?S(e,0):(x(e),t<0?(k(e.data,s+(t=-t),e.data,s,i-t),e.data.fill(0,s,s+t)):(k(e.data,s,e.data,s+t,i-=t),e.data.fill(0,s+i,s+i+t))))},g.rotate=function(n,o,a,l){if(l<0&&(l=n.data.length-a),!(a<0||a+l>n.data.length||a+l<a||0==l||0==o||o==R)){x(n),o<0&&(o+=l<<8),(o%=l)<0&&(o+=l);let e=n.data,t=o,s=0,i=t,r=l;for(;s!=i;){var u=e[s+a];e[s+++a]=e[i+a],e[i+++a]=u,i==r?i=t:s==t&&(t=i)}}},g.write=function(e,t,s,i=0,r=-1){r<0&&(r=s.data.length),i<0||t<0||t>e.data.length||(r=Math.min(s.data.length-i,e.data.length-t))<0||(x(e),k(e.data,t,s.data,i,r))}}}(pxsim=pxsim||{}),function(t){(t.control||(t.control={})).createBufferFromUTF8=function(e){return new t.RefBuffer(t.U.toUTF8Array(e))}}(pxsim=pxsim||{}),function(e){{e=e.localization||(e.localization={});let i={};function r(e,i){return 0==i.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,s){let r=i[parseInt(t)],n="",o=/^:f(\d*)\.(\d+)/.exec(s);if(o){let e=parseInt(o[2]),t=parseInt(o[1])||0,s=/^0/.test(o[1])?"0":" ",i=r.toFixed(e);if(0<t&&0<e&&(t+=e+1),0<t)for(;i.length<t;)i=s+i;n=i}else n=":x"==s?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==s?/^\s*[euioah]/.test(n.toLowerCase())?n="an "+n:/^\s*[bcdfgjklmnpqrstvwxz]/.test(n.toLowerCase())&&(n="a "+n):":s"==s?n=1==r?"":"s":":q"==s?n=a(n):":jq"==s?n=l(n):":uri"==s?n=encodeURIComponent(n).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==s?n=encodeURI(n).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==s&&(n=(100*r).toFixed(1).toString()+"%"),n})}function a(e){return e&&e.replace(/([^\w .!?\-$])/g,e=>"&#"+e.charCodeAt(0)+";")}function l(e){return e.replace(/[^\w .!?\-$]/g,e=>{e=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-e.length)+e})}e.setLocalizedStrings=function(e){i=e||{}},e.lf=function(e,...t){let s=i[e]||e;return r(s=s.replace(/^\{(id|loc):[^\}]+\}/g,""),t)},e.fmt_va=r,e.htmlEscape=a,e.jsStringQuote=l}}(pxsim=pxsim||{}),function(pxsim){const MIN_MESSAGE_WAIT_MS=200;let tracePauseMs=0,U,pxtcore;!function(e){function t(e){return e.split(/\s+/).filter(e=>!!e)}function s(e){for(;e.firstChild;)e.removeChild(e.firstChild)}let i;e.containsClass=function(s,e){return t(e).every(e=>{return e=e,(t=s).classList?t.classList.contains(e):!((t.className+"").split(/\s+/).indexOf(e)<0);var t})},e.addClass=function(s,e){t(e).forEach(e=>{var t;e=e,(t=s).classList?t.classList.add(e):(t.className+"").split(/\s+/).indexOf(e)<0&&(t.className.baseVal+=" "+e)})},e.removeClass=function(s,e){t(e).forEach(e=>{var t;t=e,(e=s).classList?e.classList.remove(t):e.className.baseVal=(e.className+"").split(/\s+/).filter(e=>e!=t).join(" ")})},e.remove=function(e){e.parentElement.removeChild(e)},e.removeChildren=s,e.clear=function(e){s(e)},e.assert=function(e,t="Assertion failed"){if(!e)throw new Error(t)},e.repeatMap=function(t,s){t=t||0;var i=[];for(let e=0;e<t;++e)i.push(s(e));return i},e.userError=function(e){e=new Error(e);throw e.isUserError=!0,e},e.now=function(){return Date.now()},e.perfNowUs=function(){return 1e3*(i=i||("undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now))()};const r=Promise.resolve();async function n(t,s,i){let r=0;const n=[],o=[];for(let e=0;e<t;e++){const t=(async()=>{for(;r<s.length;){var e=r++,t=s[e];o[e]=await i(t)}})();n.push(t)}try{await Promise.all(n)}catch(t){throw r=s.length,t}return o}function o(){return"undefined"!=typeof window&&!!window.pxtElectron}function a(){return"undefined"!=typeof window&&!!window.ipcRenderer}function l(){return o()||a()}function u(){try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)}catch(e){return!1}}e.nextTick=function(e){r.then(e)},e.delay=async function(t,e){e=await e;return await new Promise(e=>setTimeout(()=>e(),t)),e},e.promiseMapAll=function(e,t){return Promise.all(e.map(e=>t(e)))},e.promiseMapAllSeries=function(e,t){return n(1,e,t)},e.promisePoolAsync=n,e.promiseTimeout=async function(s,e,i){let r,n;var t=new Promise((e,t)=>{n=e,r=setTimeout(()=>{n=void 0,clearTimeout(r),t(i||`Promise timed out after ${s}ms`)},s)});return Promise.race([e,t]).then(e=>(n&&(clearTimeout(r),n()),e))},e.stringToUint8Array=function(t){var s=t.length,i=new Uint8Array(s);for(let e=0;e<s;++e)i[e]=255&t.charCodeAt(e);return i},e.uint8ArrayToString=function(t){let s=t.length,i="";for(let e=0;e<s;++e)i+=String.fromCharCode(t[e]);return i},e.fromUTF8=function(t){if(!t)return"";let s="";for(let e=0;e<t.length;++e){var i=255&t.charCodeAt(e);s+=37==i||127<i?"%"+i.toString(16):t.charAt(e)}return decodeURIComponent(s)},e.toUTF8=function(s,i){let r="";if(s)for(let t=0;t<s.length;++t){let e=s.charCodeAt(t);var n;e<=127?r+=s.charAt(t):e<=2047?r+=String.fromCharCode(192|e>>6,128|63&e):(!i&&55296<=e&&e<=56319&&(n=s.charCodeAt(++t),isNaN(n)||(e=65536+(e-55296<<10)+(n-56320))),r+=e<=65535?String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e):String.fromCharCode(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return r},e.toUTF8Array=function(e){return(new TextEncoder).encode(e)},e.fromUTF8Array=function(e){return(new TextDecoder).decode(e)},e.isPxtElectron=o,e.isIpcRenderer=a,e.isElectron=l,e.isLocalHost=u,e.isLocalHostDev=function(){return u()&&!l()},e.unique=function(e,s){let i=[],r={};return e.forEach(e=>{var t=s(e);r.hasOwnProperty(t)||(r[t]=null,i.push(e))}),i}}(U=pxsim.U||(pxsim.U={}));class BreakLoopException{}function getResume(){return pxsim.runtime.getResume()}pxsim.BreakLoopException=BreakLoopException,function(e){function t(e){var t=pxsim.runtime.currTryFrame(),s=(t||U.userError("unhandled exception: "+e),t.handlerFrame);throw(pxsim.runtime.currFrame=s).pc=t.handlerPC,s.tryFrame=t.parent,s.thrownValue=e,s.hasThrownValue=!0,new BreakLoopException}e.beginTry=function(e){pxsim.runtime.currFrame.tryFrame={parent:pxsim.runtime.currTryFrame(),handlerPC:e,handlerFrame:pxsim.runtime.currFrame}},e.endTry=function(){var e=pxsim.runtime.currFrame;e.tryFrame=e.tryFrame.parent},e.throwValue=t,e.getThrownValue=function(){var e=pxsim.runtime.currFrame;return U.assert(e.hasThrownValue),e.hasThrownValue=!1,e.thrownValue},e.endFinally=function(){var e=pxsim.runtime.currFrame;e.hasThrownValue&&(e.hasThrownValue=!1,t(e.thrownValue))}}(pxtcore=pxsim.pxtcore||(pxsim.pxtcore={})),pxsim.getResume=getResume;const SERIAL_BUFFER_LENGTH=16;class BaseBoard{constructor(){this.messageListeners=[],this.serialOutBuffer="",this.messages=[],this.lastSerialTime=0,this.debouncedPostAll=()=>{var e=Date.now();e-this.lastSerialTime>MIN_MESSAGE_WAIT_MS?(clearTimeout(this.serialTimeout),this.messages.length&&(Runtime.postMessage({type:"bulkserial",data:this.messages,id:pxsim.runtime.id,sim:!0}),this.messages=[],this.lastSerialTime=e)):this.serialTimeout=setTimeout(this.debouncedPostAll,50)},this.id=pxsim.Embed.frameid||"b"+Math.round(2147483647*Math.random()),this.bus=new pxsim.EventBus(pxsim.runtime,this)}updateView(){}receiveMessage(e){pxsim.runtime&&!pxsim.runtime.dead&&this.dispatchMessage(e)}dispatchMessage(e){for(const t of this.messageListeners)t(e)}addMessageListener(e){this.messageListeners.push(e)}get storedState(){return this.runOptions?(this.runOptions.storedState||(this.runOptions.storedState={}),this.runOptions.storedState):{}}initAsync(e){return this.runOptions=e,Promise.resolve()}setStoredState(e,t){null==t?delete this.storedState[e]:this.storedState[e]=t,Runtime.postMessage({type:"simulator",command:"setstate",stateKey:e,stateValue:t})}onDebuggerResume(){}screenshotAsync(e){return Promise.resolve(void 0)}kill(){}writeSerial(e){this.serialOutBuffer+=e,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(this.messages.push({time:Date.now(),data:this.serialOutBuffer}),this.debouncedPostAll(),this.serialOutBuffer="")}}pxsim.BaseBoard=BaseBoard;class CoreBoard extends BaseBoard{constructor(){super(),this.updateSubscribers=[],this.updateView=()=>{this.updateSubscribers.forEach(e=>e())},this.builtinParts={},this.builtinVisuals={},this.builtinPartVisuals={}}kill(){super.kill(),pxsim.AudioContextManager.stopAll()}}pxsim.CoreBoard=CoreBoard;class BareBoard extends BaseBoard{}function initBareRuntime(){pxsim.runtime.board=new BareBoard;var e=pxsim;e.basic={pause:pxsim.thread.pause,showNumber:e=>{var t=getResume();console.log("SHOW NUMBER:",e),U.nextTick(t)}},e.serial={writeString:e=>pxsim.runtime.board.writeSerial(e)},e.pins={createBuffer:pxsim.BufferMethods.createBuffer},e.control={inBackground:pxsim.thread.runInBackground,createBuffer:pxsim.BufferMethods.createBuffer,dmesg:e=>console.log("DMESG: "+e),deviceDalVersion:()=>"sim",__log:(e,t)=>console.log("LOG: "+t.trim())}}let LogType;pxsim.initBareRuntime=initBareRuntime,function(e){e[e.UserSet=0]="UserSet",e[e.BackAdd=1]="BackAdd",e[e.BackRemove=2]="BackRemove"}(LogType=LogType||{});class EventQueue{constructor(e,t){this.runtime=e,this.valueToArgs=t,this.max=5,this.events=[],this.awaiters=[],this._handlers=[],this._addRemoveLog=[]}push(e,t){if(0<this.awaiters.length)if(t){const e=this.awaiters.shift();e&&e()}else{const e=this.awaiters.slice();this.awaiters=[],e.forEach(e=>e())}return 0==this.handlers.length||this.events.length>this.max||(this.events.push(e),this.lock)?Promise.resolve():this.poke()}poke(){this.lock=!0;var e=this.events;return this.events=[],U.promiseMapAllSeries(e,t=>U.promiseMapAllSeries(this.handlers,e=>this.runtime.runFiberAsync(e,...this.valueToArgs?this.valueToArgs(t):[t]))).then(()=>0<this.events.length?this.poke():(this.lock=!1,this._addRemoveLog.forEach(e=>{e.log===LogType.BackAdd?this.addHandler(e.act):e.log===LogType.BackRemove?this.removeHandler(e.act):this.setHandler(e.act)}),this._addRemoveLog=[],Promise.resolve()))}get handlers(){return this._handlers}setHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.UserSet}):this._handlers=[e]}addHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.BackAdd}):-1==this._handlers.indexOf(e)&&this._handlers.push(e)}removeHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.BackRemove}):-1!=(e=this._handlers.indexOf(e))&&this._handlers.splice(e,1)}addAwaiter(e){this.awaiters.push(e)}}function bind(e){const i=e.arg0,r=e.fn;return e=>{let t=0;for(;e.hasOwnProperty("arg"+t);)t++;var s=e;for(let e=t;0<e;e--)s["arg"+e]=s["arg"+(e-1)];return e.arg0=i,r(e)}}function _leave(e,t){return e.parent.retval=t,e.parent}function syntheticRefAction(t){return pxtcore.mkAction(0,e=>_leave(e,t(e)))}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;class TimeoutScheduled{constructor(e,t,s,i){this.id=e,this.fn=t,this.totalRuntime=s,this.timestampCall=i}}pxsim.TimeoutScheduled=TimeoutScheduled;class PausedTimeout{constructor(e,t){this.fn=e,this.timeRemaining=t}}function mkVTable(e){return{name:e.name,numFields:e.numFields,classNo:e.classNo,methods:e.methods,iface:e.iface,lastSubtypeNo:e.lastSubtypeNo,toStringMethod:e.toStringMethod,maxBgInstances:e.maxBgInstances}}pxsim.PausedTimeout=PausedTimeout,pxsim.mkVTable=mkVTable;let mapVTable=null;function mkMapVTable(){return mapVTable=mapVTable||mkVTable({name:"_Map",numFields:0,classNo:0,lastSubtypeNo:0,methods:null})}function functionName(e){e=e.info;return e?`${e.functionName} (${e.fileName}:${e.line+1}:${e.column+1})`:"()"}pxsim.mkMapVTable=mkMapVTable,pxsim.functionName=functionName;class Runtime{constructor(msg){this.numGlobals=1e3,this.dead=!1,this.running=!1,this.idleTimer=void 0,this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0,this.startTime=0,this.startTimeUs=0,this.pausedTime=0,this.lastPauseTimestamp=0,this.globals={},this.environmentGlobals={},this.otherFrames=[],this.loopLock=null,this.loopLockWaitList=[],this.heapSnapshots=[],this.timeoutsScheduled=[],this.timeoutsPausedOnBreakpoint=[],this.pausedOnBreakpoint=!1,this.traceDisabled=!1,this.perfOffset=0,this.perfElapsed=0,this.perfStack=0,this.refCountingDebug=!1,this.refObjId=1,this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;let threadId=0,breakpoints=null,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),userGlobals,__this=this;this.traceDisabled=!!msg.traceDisabled;const evalIface={runtime:this,oops:oops,doNothing:doNothing,pxsim:pxsim,globals:this.globals,setupYield:setupYield,maybeYield:maybeYield,setupDebugger:setupDebugger,isBreakFrame:isBreakFrame,breakpoint:breakpoint,trace:trace,checkStack:checkStack,leave:_leave,checkResumeConsumed:checkResumeConsumed,setupResume:setupResume,setupLambda:setupLambda,checkSubtype:checkSubtype,failedCast:failedCast,buildResume:buildResume,mkVTable:mkVTable,bind:bind,leaveAccessor:leaveAccessor};function oops(e){throw new Error("sim error: "+e)}function doNothing(e){return e.pc=-1,_leave(e,e.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;)__this.loopLockWaitList.shift()()}let yieldReset=()=>{};function setupYield(e){yieldReset=e}function loopForSchedule(e){const t=new Object,s=e.pc;return __this.loopLock=t,__this.otherFrames.push(e),()=>{__this.dead||(U.assert(e.pc==s),U.assert(__this.loopLock===t),__this.loopLock=null,loop(e),flushLoopLock())}}function maybeYield(e,t,s){if(__this.pausedOnBreakpoint)return!1;__this.cleanScheduledExpired(),yieldReset();var i=Date.now();return 20<=i-lastYield&&(lastYield=i,e.pc=t,e.r0=s,setTimeout(loopForSchedule(e),5),!0)}function setupDebugger(e,t){return(breakpoints=new Uint8Array(e))[0]=msg.breakOnStart?1:0,userGlobals=t,breakpoints}function isBreakFrame(t){if(!breakFrame)return!0;for(let e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(t,s,e,i){let r={};__this.loopLock=r,U.assert(!dbgResume),U.assert(!dbgHeap),t.pc=s,t.r0=i;var{msg:i,heap:e}=pxsim.getBreakpointMsg(t,e,userGlobals);return dbgHeap=e,pxsim.injectEnvironmentGlobals(i,e),Runtime.postMessage(i),breakpoints[0]=0,breakFrame=null,__this.pauseScheduled(),dbgResume=e=>{if(dbgResume=null,dbgHeap=null,__this.dead)return null;switch(__this.resumeAllPausedScheduled(),__this.board.onDebuggerResume(),pxsim.runtime=__this,U.assert(t.pc==s),breakpoints[0]=0,breakFrame=null,e.subtype){case"resume":break;case"stepover":breakpoints[0]=1,breakFrame=t;break;case"stepinto":breakpoints[0]=1;break;case"stepout":breakpoints[0]=1,breakFrame=t.parent||t}U.assert(__this.loopLock==r),__this.loopLock=null,__this.otherFrames.push(t),loop(t),flushLoopLock()},null}function trace(e,t,s,i){if(setupResume(t,s),"<main>"===i.functionName||"main.ts"===i.fileName){if(!pxsim.runtime.traceDisabled){const s=pxsim.getBreakpointMsg(t,e,userGlobals)["msg"];s.subtype="trace",Runtime.postMessage(s)}pxsim.thread.pause(tracePauseMs||1)}else pxsim.thread.pause(0);checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var s=t;if(s.setBreakpoints&&breakpoints){breakpoints.fill(0);for(var i of s.setBreakpoints)breakpoints[i]=1}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakpoints[0]=1,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t);break;case"variables":s=t;let e;if(dbgHeap){const t=dbgHeap[s.variablesReference];void 0!==t&&(e=pxsim.dumpHeap(t,dbgHeap,s.fields))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:t.seq,variables:e})}}function removeFrame(t){var s=__this.otherFrames;for(let e=s.length-1;0<=e;--e)if(s[e]===t)return s.splice(e,1);U.userError("frame cannot be removed!")}function loop(t){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock),__this.perfStartRuntime(),removeFrame(t);try{for(pxsim.runtime=__this;t;)__this.currFrame=t,__this.currFrame.overwrittenPC=!1,t=t.fn(t),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(t=__this.currFrame);__this.perfStopRuntime()}catch(e){var s,i;e instanceof BreakLoopException?U.nextTick(loopForSchedule(__this.currFrame)):(__this.perfStopRuntime(),__this.errorHandler?__this.errorHandler(e):(console.error("Simulator crashed, no error handler",e.stack),{msg:s,heap:i}=pxsim.getBreakpointMsg(t,t.lastBrkId,userGlobals),pxsim.injectEnvironmentGlobals(s,i),s.exceptionMessage=e.message,s.exceptionStack=e.stack,Runtime.postMessage(s),__this.postError&&__this.postError(e)))}}}function checkStack(e){100<e&&U.userError("Stack overflow")}function actionCall(e){return e.depth=e.parent.depth+1,checkStack(e.depth),e.pc=0,e}function setupTop(e){e=setupTopCore(e);return setupResume(e,0),e}function setupTopCore(e){let t={parent:null,pc:0,depth:0,threadId:++threadId,fn:()=>(e&&e(t.retval),null)};return t}function topCall(e,t){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0);t={parent:setupTopCore(t),fn:e,depth:0,pc:0};__this.otherFrames=[t],loop(actionCall(t))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(e,t){currResume=buildResume(e,t)}function leaveAccessor(t,s){if(t.stage2Call){var i={pc:0,fn:null,depth:t.depth,parent:t.parent};let e=1;for(;t.hasOwnProperty("arg"+e);)i["arg"+(e-1)]=t["arg"+e],e++;return setupLambda(i,s),i}return t.parent.retval=s,t.parent}function setupLambda(e,t,s){if(s){const t=e;for(let e=1;e<s;++e)t["arg"+(e-1)]=t["arg"+e];delete t["arg"+(s-1)]}t instanceof pxsim.RefAction?(e.fn=t.func,e.caps=t.fields):"function"==typeof t?e.fn=t:oops("calling non-function")}function checkSubtype(e,t){return!!e&&(t===(e=e.vtable)||e&&t.classNo<=e.classNo&&e.classNo<=t.lastSubtypeNo)}function failedCast(e){pxsim.control&&pxsim.control.dmesgValue&&pxsim.control.dmesgValue(e),oops("failed cast on "+e)}function buildResume(r,t){currResume&&oops("already has resume"),r.pc=t;let s=Date.now(),n=(__this.otherFrames.push(r),i=>{if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var e=Date.now();if(3<e-s&&(lastYield=e),U.assert(r.pc==t),i instanceof pxsim.FnWrapper){let e=i,t={parent:r,fn:e.func,lambdaArgs:e.args,pc:0,caps:e.caps,depth:r.depth+1},s={};return __this.loopLock=s,removeFrame(r),__this.otherFrames.push(t),U.nextTick(()=>{U.assert(__this.loopLock===s),__this.loopLock=null,loop(actionCall(t)),flushLoopLock()})}return r.retval=i,loop(r)}__this.loopLockWaitList.push(()=>n(i))}});return n}const entryPoint=msg.code&&eval(msg.code)(evalIface);this.run=e=>topCall(entryPoint,e),this.getResume=()=>{currResume||oops("noresume");var e=currResume;return currResume=null,e},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=e=>{currResume=null,0<=e&&(this.currFrame.pc=e),this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}registerLiveObject(e){return this.refObjId++}runningTime(){return U.now()-this.startTime-this.pausedTime}runningTimeUs(){return 4294967295&U.perfNowUs()-this.startTimeUs>>0}runFiberAsync(s,i,r,n){return new Promise((e,t)=>U.nextTick(()=>{(pxsim.runtime=this).setupTop(e),pxtcore.runAction(s,[i,r,n])}))}currTryFrame(){for(let e=this.currFrame;e;e=e.parent)if(e.tryFrame)return e.tryFrame;return null}traceObjects(){const n={};for(;2<this.heapSnapshots.length;)this.heapSnapshots.shift();const t={count:0,size:0,name:"TOTAL"},s={TOTAL:t};function o(e,t,s=null){if(t instanceof pxsim.RefObject)if(!t.gcIsStatic()){var i=n[t.id];if(i)return s&&i.pointers.push([s,e]);const r={obj:t,path:null,pointers:[[s,e]]};n[t.id]=r,t.scan((e,t)=>{t instanceof pxsim.RefObject&&!n[t.id]&&o(e,t,r)})}}this.heapSnapshots.push({visited:n,statsByType:s});for(var e of Object.keys(this.globals))o(e.replace(/___\d+$/,""),this.globals[e]);const i=this.otherFrames.slice();this.currFrame&&i.indexOf(this.currFrame)<0&&i.unshift(this.currFrame);for(const n of this.getThreads()){const t="Thread-"+this.rootFrame(n).threadId;for(let e=n;e;e=e.parent){const n=t+"."+functionName(e.fn);for(var r of Object.keys(e))if(/^(r0|arg\d+|.*___\d+)/.test(r)){const i=e[r];i instanceof pxsim.RefObject&&o(n+"."+(r=r.replace(/___.*/,"")),i)}if(e.caps)for(var a of e.caps)o(n+".cap",a)}}const l=Object.keys(n).map(e=>n[e]),u=(l.sort((e,t)=>t.obj.gcSize()-e.obj.gcSize()),t=>{if(null==t.path){let e="";t.path="(cycle)";for(var[s,i]of t.pointers){if(null==s)return void(t.path=i);u(s);s=s.path+"."+i;(!e||e.length>s.length)&&(e=s)}t.path=e}});l.forEach(u);var h=[t];for(const n of l){const o=n.obj.gcSize(),i=n.obj.gcKey(),l=(s.hasOwnProperty(i)||h.push(s[i]={count:0,size:0,name:i}),s[i]);l.size+=o,l.count++,t.size+=o,t.count++}h.sort((e,t)=>e.size-t.size);let d="";const c=e=>("        "+e.toString()).slice(-7);for(const n of h)d+=c(4*n.size)+c(n.count)+" "+n.name+"\n";var p=e=>c(4*e.obj.gcSize())+" "+e.obj.gcKey()+" "+e.path,m=l.slice(0,20).map(p).join("\n");let f="";if(3<=this.heapSnapshots.length){const n=this.heapSnapshots[this.heapSnapshots.length-3].visited,t=this.heapSnapshots[this.heapSnapshots.length-2].visited,o=e=>e instanceof pxsim.RefRecord&&!!(e.vtable&&e.vtable.maxBgInstances&&s[e.gcKey()].count<=e.vtable.maxBgInstances);f=l.filter(e=>!n[e.obj.id]&&t[e.obj.id]).filter(e=>!o(e.obj)).map(p).join("\n")}return"Threads:\n"+this.threadInfo()+"\n\nSummary:\n"+d+"\n\nLarge Objects:\n"+m+"\n\nNew Objects:\n"+f}getThreads(){var e=this.otherFrames.slice();return this.currFrame&&e.indexOf(this.currFrame)<0&&e.unshift(this.currFrame),e}rootFrame(e){let t=e;for(;t.parent;)t=t.parent;return t}threadInfo(){var e;let t="";for(e of this.getThreads()){t+=`Thread ${this.rootFrame(e).threadId}:
`;for(var s of pxsim.getBreakpointMsg(e,e.lastBrkId).msg.stackframes){s=s.funcInfo;t+=`   at ${s.functionName} (${s.fileName}:${s.line+1}:${s.column+1})
`}t+="\n"}return t}static postMessage(e){e&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(e,"*"),Runtime.messagePosted)&&Runtime.messagePosted(e)}static postScreenshotAsync(t){var e=pxsim.runtime&&pxsim.runtime.board;return(e?e.screenshotAsync().catch(e=>{console.debug("screenshot failed")}):Promise.resolve(void 0)).then(e=>Runtime.postMessage({type:"screenshot",data:e,delay:t&&t.delay}))}static requestToggleRecording(){var e=pxsim.runtime;e&&Runtime.postMessage({type:"recorder",action:e.recording?"stop":"start"})}restart(){this.kill(),setTimeout(()=>pxsim.Runtime.postMessage({type:"simulator",command:"restart"}),500)}kill(){this.dead=!0,this.stopRecording(),this.stopIdle(),this.setRunning(!1)}updateDisplay(){this.board.updateView(),this.postFrame()}startRecording(e){!this.recording&&this.running&&(this.recording=!0,this.recordingTimer=setInterval(()=>this.postFrame(),66),this.recordingLastImageData=void 0,this.recordingWidth=e)}stopRecording(){this.recording&&(this.recordingTimer&&clearInterval(this.recordingTimer),this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0)}postFrame(){if(this.recording&&this.running){let r=pxsim.U.now();this.board.screenshotAsync(this.recordingWidth).then(t=>{if(this.recordingLastImageData&&t&&this.recordingLastImageData.data.byteLength==t.data.byteLength){const r=this.recordingLastImageData.data,s=t.data,i=r.byteLength;let e=0;for(e=0;e<i&&r[e]==s[e];++e);if(e==i)return}this.recordingLastImageData=t,Runtime.postMessage({type:"screenshot",data:t,time:r})})}}queueDisplayUpdate(){this.numDisplayUpdates++}maybeUpdateDisplay(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())}setRunning(e){this.running!=e&&(this.running=e,this.running?(this.startTime=U.now(),this.startTimeUs=U.perfNowUs(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"running"})):(this.stopRecording(),this.stopIdle(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"killed"})),this.stateChanged)&&this.stateChanged()}dumpLivePointers(){}setupPerfCounters(e){e&&e.length&&(this.perfCounters=e.map(e=>new PerfCounter(e)))}perfStartRuntime(){0!==this.perfOffset?this.perfStack++:this.perfOffset=U.perfNowUs()-this.perfElapsed}perfStopRuntime(){this.perfStack?this.perfStack--:(this.perfElapsed=this.perfNow(),this.perfOffset=0)}perfNow(){return 0===this.perfOffset&&U.userError("bad time now"),U.perfNowUs()-this.perfOffset|0}startPerfCounter(e){this.perfCounters&&((e=this.perfCounters[e]).start&&U.userError("startPerf"),e.start=this.perfNow())}stopPerfCounter(t){if(this.perfCounters){var t=this.perfCounters[t],s=(t.start||U.userError("stopPerf"),this.perfNow()-t.start);t.start=0,t.value+=s,t.numstops++;let e=t.lastFewPtr++;e>=t.lastFew.length&&(e=0,t.lastFewPtr=1),t.lastFew[e]=s}}startIdle(){void 0===this.idleTimer&&(this.idleTimer=setInterval(()=>{var e;this.running&&!this.pausedOnBreakpoint&&(e=this.board.bus)&&e.queueIdle()},20))}stopIdle(){void 0!==this.idleTimer&&(clearInterval(this.idleTimer),this.idleTimer=void 0)}schedule(t,e){if(e<=0&&(e=0),this.pausedOnBreakpoint)return this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(t,e)),-1;const s=U.now(),i=new TimeoutScheduled(-1,t,e,s);return i.id=setTimeout(()=>{var e=this.timeoutsScheduled.indexOf(i);0<=e&&this.timeoutsScheduled.splice(e,1),t()},e),this.timeoutsScheduled.push(i),i.id}pauseScheduled(){this.pausedOnBreakpoint=!0,this.timeoutsScheduled.forEach(e=>{clearTimeout(e.id);let t=U.now()-e.timestampCall,s=e.totalRuntime-t;s<=0&&(s=1),this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(e.fn,s))}),this.lastPauseTimestamp=U.now(),this.timeoutsScheduled=[]}resumeAllPausedScheduled(){this.pausedOnBreakpoint=!1,this.timeoutsPausedOnBreakpoint.forEach(e=>{this.schedule(e.fn,e.timeRemaining)}),this.lastPauseTimestamp&&(this.pausedTime+=U.now()-this.lastPauseTimestamp,this.lastPauseTimestamp=0),this.timeoutsPausedOnBreakpoint=[]}cleanScheduledExpired(){let s=U.now();this.timeoutsScheduled=this.timeoutsScheduled.filter(e=>{var t=s-e.timestampCall;return e.totalRuntime>t})}}pxsim.Runtime=Runtime;class PerfCounter{constructor(e){this.name=e,this.start=0,this.numstops=0,this.value=0,this.lastFew=new Uint32Array(32),this.lastFewPtr=0}}pxsim.PerfCounter=PerfCounter}(pxsim=pxsim||{}),function(l){let r,i;var e;(e=r=l.SimulatorState||(l.SimulatorState={}))[e.Unloaded=0]="Unloaded",e[e.Stopped=1]="Stopped",e[e.Pending=2]="Pending",e[e.Starting=3]="Starting",e[e.Running=4]="Running",e[e.Paused=5]="Paused",e[e.Suspended=6]="Suspended",(e=i=l.SimulatorDebuggerCommand||(l.SimulatorDebuggerCommand={}))[e.StepInto=0]="StepInto",e[e.StepOver=1]="StepOver",e[e.StepOut=2]="StepOut",e[e.Resume=3]="Resume",e[e.Pause=4]="Pause";const n="pxtdriver";l.SimulatorDriver=class{constructor(e,t={}){this.container=e,this.options=t,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.breakpointsSet=!1,this._runOptions={},this.state=r.Unloaded,this._allowedOrigins=[],this.frameCleanupTimeout=void 0,this.debuggerSeq=1,this.debuggerResolvers={},this._allowedOrigins.push(window.location.origin),t.parentOrigin&&this._allowedOrigins.push(t.parentOrigin),this._allowedOrigins.push(this.getSimUrl().origin);const s=null==t?void 0:t.messageSimulators;s&&Object.keys(s).map(e=>s[e]).forEach(e=>{this._allowedOrigins.push(new URL(e.url).origin),e.localHostUrl&&this._allowedOrigins.push(new URL(e.localHostUrl).origin)}),this._allowedOrigins=l.U.unique(this._allowedOrigins,e=>e)}isDebug(){return this._runOptions&&!!this._runOptions.debug}isTracing(){return this._runOptions&&!!this._runOptions.trace}hasParts(){return this._runOptions&&this._runOptions.parts&&!!this._runOptions.parts.length}setDirty(){this.state==l.SimulatorState.Running&&this.suspend()}setPending(){this.setState(r.Pending)}focus(){var e=this.simFrames()[0];e&&e.focus()}registerDependentEditor(e){e&&(this._dependentEditors||(this._dependentEditors=[]),this._dependentEditors.push(e))}dependentEditors(){return this._dependentEditors&&(this._dependentEditors=this._dependentEditors.filter(e=>!!e.parent),this._dependentEditors.length||(this._dependentEditors=void 0)),this._dependentEditors}setStarting(){this.setState(r.Starting)}setHwDebugger(e){e?(this.hwdbg=e,this.setState(r.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(r.Running),this.stop())}handleHwDebuggerMsg(e){this.hwdbg&&this.handleMessage(e)}setThemes(e){l.U.assert(e&&0<e.length),this.themes=e}startRecording(e){this.simFrames()[0]&&this.postMessage({type:"recorder",action:"start",source:n,width:e})}stopRecording(){this.postMessage({type:"recorder",source:n,action:"stop"})}setFrameState(e){var t=e.nextElementSibling,s=t.nextElementSibling;switch(this.state){case r.Pending:case r.Starting:t.style.display="",t.className="",s.style.display="";break;case r.Stopped:case r.Suspended:l.U.addClass(e,this.state==r.Stopped||this._runOptions&&this._runOptions.autoRun?this.stoppedClass:this.invalidatedClass),this._runOptions&&this._runOptions.autoRun?t.style.display="none":(t.style.display="",t.className="videoplay xicon icon"),s.style.display="none",this.scheduleFrameCleanup();break;default:l.U.removeClass(e,this.stoppedClass),l.U.removeClass(e,this.invalidatedClass),t.style.display="none",s.style.display="none"}}setState(e){this.state!=e&&(this.state=e,this.freeze(this.state==r.Paused),this.simFrames().forEach(e=>this.setFrameState(e)),this.options.onStateChanged)&&this.options.onStateChanged(this.state)}freeze(e){const s="pause-overlay";e?l.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(e=>{var t;e.querySelector("div."+s)||((t=document.createElement("div")).className=s,t.onclick=e=>(e.preventDefault(),!1),e.appendChild(t))}):l.util.toArray(this.container.querySelectorAll("div.simframe div."+s)).forEach(e=>e.parentElement.removeChild(e))}simFrames(e=!1){var t=l.util.toArray(this.container.getElementsByTagName("iframe")),s=this.loanedIFrame();return s&&!e&&t.unshift(s),t}getSimUrl(){var t=this.options.simUrl||(window.pxtConfig||{}).simUrl||location.origin+"/sim/simulator.html";try{return new URL(t)}catch(e){return new URL(t,location.origin)}}postMessage(s,i,r){var e;if(this.hwdbg)this.hwdbg.postMessage(s);else{var n=this.dependentEditors();let t=this.simFrames();r&&(t=t.filter(e=>e.id===r));const a=s;if(i&&null!=a&&a.broadcast){const r=!(null==(e=this._currentRuntime)||!e.single),a=window.parent&&window.parent!==window.window?window.parent:window.opener;if(this.options.nestedEditorSim&&a){if(i!==a){const l=this.options.parentOrigin||window.location.origin;a.postMessage(s,l)}}else if(n)n.forEach(e=>{i!==e&&e.postMessage(s,window.location.origin)});else if(!r){const i="messagepacket"===s.type&&s.channel,r=i&&this.options.messageSimulators&&this.options.messageSimulators[i];if(r){n=t.find(e=>e.dataset.messagechannel===i);if(n)n.dataset.runid!=this.runId&&this.startFrame(n);else{const e=(l.U.isLocalHost()&&/localhostmessagesims=1/i.test(window.location.href)&&r.localHostUrl||r.url).replace("$PARENT_ORIGIN$",encodeURIComponent(this.options.parentOrigin||""));var o=this.createFrame(e);this.container.appendChild(o),(n=o.firstElementChild).dataset.messagechannel=i,l.U.addClass(o,"simmsg"),l.U.addClass(o,"simmsg"+i),r.permanent&&(n.dataset.permanent="true"),this.startFrame(n),t=this.simFrames()}}else{const l=t.filter(e=>!e.dataset.messagechannel);l.length<2?(this.container.appendChild(this.createFrame()),t=this.simFrames()):l[1].dataset.runid!=this.runId&&this.startFrame(l[1])}}}for(let e=0;e<t.length;++e){const r=t[e];if((!i||r.contentWindow!=i)&&r.contentWindow&&(this.postMessageCore(r,s),"recorder"==s.type)&&"start"==s.action)break}}}postMessageCore(e,t){var s,i,r;if(e.contentWindow.postMessage(t,e.dataset.origin),l.U.isLocalHostDev()&&null!=(s=null==(s=pxt)?void 0:s.appTarget)&&s.id)try{e.contentWindow.postMessage(t,`https://trg-${null==(r=null==(i=pxt)?void 0:i.appTarget)?void 0:r.id}.userpxt.io/---simulator`)}catch(e){}}createFrame(e){var t=document.createElement("div");t.className="simframe ui embed";const s=document.createElement("iframe");s.id="sim-frame-"+this.nextId(),s.title=l.localization.lf("Simulator"),s.allowFullscreen=!0,s.setAttribute("allow","autoplay"),s.setAttribute("sandbox","allow-same-origin allow-scripts"),s.className="no-select";var e=(e||this.getSimUrl())+"#"+s.id,e=(s.src=e,s.frameBorder="0",s.dataset.runid=this.runId,s.dataset.origin=new URL(e).origin||"*",t.appendChild(s),document.createElement("i")),i=(e.className="videoplay xicon icon",e.style.display="none",e.onclick=e=>(e.preventDefault(),this.state!=r.Running&&this.state!=r.Starting&&(this.options.restart?this.options.restart():this.start()),s.focus(),!1),t.appendChild(e),document.createElement("div"));return i.className="ui active loader",e.style.display="none",t.appendChild(i),this._runOptions&&this.applyAspectRatioToFrame(s),t}preload(e){this.simFrames().length||(this.container.appendChild(this.createFrame()),this.applyAspectRatio(e),this.setStarting())}stop(e=!1,t=!1){this.clearDebugger(),this.postMessage({type:"stop",source:n}),this.setState(t?r.Starting:r.Stopped),e&&this.unload()}suspend(){this.postMessage({type:"stop",source:n}),this.setState(r.Suspended)}unload(){this.cancelFrameCleanup(),l.U.removeChildren(this.container),this.setState(r.Unloaded),this._runOptions=void 0,this._currentRuntime=void 0,this.runId=void 0}mute(e){this._currentRuntime&&(this._currentRuntime.mute=e),this.postMessage({type:"mute",source:n,mute:e})}stopSound(){this.postMessage({type:"stopsound",source:n})}isLoanedSimulator(e){return!!this.loanedSimulator&&this.loanedIFrame()==e}loanSimulator(){return this.loanedSimulator||(this.loanedSimulator=this.container.firstElementChild||this.createFrame(),this.loanedSimulator.parentNode&&this.container.removeChild(this.loanedSimulator)),this.loanedSimulator}unloanSimulator(){this.loanedSimulator&&(this.loanedSimulator.parentNode&&this.loanedSimulator.parentNode.removeChild(this.loanedSimulator),this.container.insertBefore(this.loanedSimulator,this.container.firstElementChild),delete this.loanedSimulator)}loanedIFrame(){return this.loanedSimulator&&this.loanedSimulator.parentNode&&this.loanedSimulator.querySelector("iframe")}cancelFrameCleanup(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=void 0)}scheduleFrameCleanup(){this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(()=>{this.frameCleanupTimeout=void 0,this.cleanupFrames()},5e3)}applyAspectRatio(t){(t||this._runOptions)&&this.simFrames().forEach(e=>this.applyAspectRatioToFrame(e,t))}applyAspectRatioToFrame(e,t){var s;let i=t;if(void 0===i){const t=parseFloat(e.dataset.aspectratio);isNaN(t)||(i=t)}if(void 0===i){const t=e.dataset.messagechannel;if(t){const e=null==(s=null==(s=null==(s=this.options)?void 0:s.messageSimulators)?void 0:s[t])?void 0:s.aspectRatio;e&&(i=e)}}void 0===i&&(i=(null==(t=this._runOptions)?void 0:t.aspectRatio)||1.22),e.parentElement.style.paddingBottom=100/i+"%"}cleanupFrames(){var e=this.simFrames(!0);e.shift(),e.filter(e=>!e.dataset.permanent).forEach(e=>{this.state!=r.Stopped&&e.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(e.parentElement):e.parentElement.remove())})}hide(t){var e;this.suspend(),this.options.removeElement&&((e=this.simFrames()).forEach(e=>{this.options.removeElement(e.parentElement,t)}),0==e.length)&&t&&t()}unhide(){this.options.unhideElement&&this.simFrames().forEach(e=>{this.options.unhideElement(e.parentElement)})}run(e,t={}){this._runOptions=t,this.runId=this.nextId(),this._currentRuntime={type:"run",source:n,boardDefinition:t.boardDefinition,parts:t.parts,builtinParts:t.builtinParts,fnArgs:t.fnArgs,code:e,partDefinitions:t.partDefinitions,mute:t.mute,highContrast:t.highContrast,light:t.light,cdnUrl:t.cdnUrl,localizedStrings:t.localizedStrings,refCountingDebug:t.refCountingDebug,version:t.version,clickTrigger:t.clickTrigger,breakOnStart:t.breakOnStart,storedState:t.storedState,ipc:t.ipc,single:t.single,dependencies:t.dependencies},this.start()}restart(){this.stop(),this.cleanupFrames(),this.start()}areBreakpointsSet(){return this.breakpointsSet}start(){if(this.clearDebugger(),this.addEventListeners(),this.applyAspectRatio(),this.scheduleFrameCleanup(),this._currentRuntime){this.breakpointsSet=!1;let e=this.simFrames()[0];var t;e?this.startFrame(e):(t=this.createFrame(),this.container.appendChild(t),e=t.firstElementChild),this.debuggingFrame=e.id,this.setState(r.Running),this.setTraceInterval(this.traceInterval)}}startFrame(e){var t;return!(!this._currentRuntime||!e.contentWindow||((t=JSON.parse(JSON.stringify(this._currentRuntime))).frameCounter=++this.frameCounter,t.options={theme:this.themes[this.nextFrameId++%this.themes.length]},t.id=t.options.theme+"-"+this.nextId(),e.dataset.runid=this.runId,e.dataset.runtimeid=t.id,e.id!==this.debuggingFrame&&(t.traceDisabled=!0,t.breakOnStart=!1),this.postMessageCore(e,t),this.traceInterval&&this.setTraceInterval(this.traceInterval),this.applyAspectRatioToFrame(e),this.setFrameState(e),0))}handleMessage(e,t){switch(e.type||""){case"ready":{const r=e.frameid,t=document.getElementById(r);t&&(this.startFrame(t),this.options.revealElement)&&this.options.revealElement(t),this.options.onSimulatorReady&&this.options.onSimulatorReady();break}case"status":{const t=e.frameid,s=document.getElementById(t);if(s){const t=e;if(t.runtimeid==s.dataset.runtimeid)switch(t.state){case"running":this.setState(r.Running);break;case"killed":this.setState(r.Stopped)}}break}case"simulator":this.handleSimulatorCommand(e);break;case"serial":case"pxteditor":case"screenshot":case"custom":case"recorder":case"addextensions":break;case"aspectratio":{const r=e,t=r.frameid,i=document.getElementById(t);i&&(i.dataset.aspectratio=r.value+"",this.applyAspectRatioToFrame(i));break}case"debugger":this.handleDebuggerMessage(e);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:this.postMessage(e,t)}}addEventListeners(){this.listener||(this.listener=e=>{this.hwdbg||!l.U.isLocalHost()&&this._allowedOrigins.indexOf(e.origin)<0||this.handleMessage(e.data,e.source)},window.addEventListener("message",this.listener,!1))}removeEventListeners(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)}resume(e){let t;switch(e){case i.Resume:t="resume",this.setState(r.Running);break;case i.StepInto:t="stepinto",this.setState(r.Running);break;case i.StepOut:t="stepout",this.setState(r.Running);break;case i.StepOver:t="stepover",this.setState(r.Running);break;case i.Pause:t="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:t,source:n})}setBreakpoints(e){this.breakpointsSet=!0,this.postDebuggerMessage("config",{setBreakpoints:e},void 0,this.debuggingFrame)}setTraceInterval(e){this.traceInterval=e,this.postDebuggerMessage("traceConfig",{interval:e})}variablesAsync(e,t){return this.postDebuggerMessageAsync("variables",{variablesReference:e,fields:t},this.debuggingFrame).then(e=>e,e=>{})}handleSimulatorCommand(e){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(e)}clearDebugger(){const t=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(e=>{e=this.debuggerResolvers[e].reject;e(t)}),this.debuggerResolvers={},this.debuggerSeq++}handleDebuggerMessage(e){if("trace"!==e.subtype&&console.log("DBG-MSG",e.subtype,e),e.seq){const r=this.debuggerResolvers[e.seq]["resolve"];r&&r(e)}switch(e.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(e);break;case"breakpoint":var t=e;if(this.state==r.Running){t.exceptionMessage?this.suspend():(this.setState(r.Paused),1<this.simFrames(!0).length&&this.resume(i.Pause)),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(t);let e=t.exceptionMessage+"\n";for(var s of t.stackframes){s=s.funcInfo;e+=`   at ${s.functionName} (${s.fileName}:${s.line+1}:${s.column+1})
`}t.exceptionMessage&&console.error(e)}else console.error("debugger: trying to pause from "+this.state);break;case"trace":{const i=e;this.state==r.Running&&this.options.onTraceMessage&&this.options.onTraceMessage(i);break}default:t=e.req_seq;if(t){const r=this.debuggerResolvers[t]["resolve"];r&&(delete this.debuggerResolvers[t],r(e))}}}postDebuggerMessageAsync(i,r={},n){return new Promise((e,t)=>{var s=this.debuggerSeq++;this.debuggerResolvers[s.toString()]={resolve:e,reject:t},this.postDebuggerMessage(i,r,s,n)})}postDebuggerMessage(e,t={},s,i){t=JSON.parse(JSON.stringify(t));t.type="debugger",t.subtype=e,t.source=n,s&&(t.seq=s),this.postMessage(t,void 0,i)}nextId(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")}get stoppedClass(){return this.options&&this.options.stoppedClass||"grayscale"}get invalidatedClass(){return this.options&&this.options.invalidatedClass||"sepia"}}}(pxsim=pxsim||{}),function(E){function e(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function t(){return"undefined"!=typeof window&&!!window.PointerEvent}E.mkRange=function(e,t){for(var s=[];e<t;e++)s.push(e);return s},E.EventBus=class{constructor(e,t,s){this.runtime=e,this.board=t,this.valueToArgs=s,this.queues={},this.backgroundHandlerFlag=!1,this.nextNotifyEvent=1024,this.schedulerID=15,this.idleEventID=2,this.board.addMessageListener(this.handleMessage.bind(this))}handleMessage(e){"eventbus"===e.type&&this.queue(e.id,e.eventid,e.value)}setBackgroundHandlerFlag(){this.backgroundHandlerFlag=!0}setNotify(e,t){this.notifyID=e,this.notifyOneID=t}setIdle(e,t){this.schedulerID=e,this.idleEventID=t}start(e,t,s,i=!1){s=(s?"back":"fore")+":"+e+":"+t;return!this.queues[s]&&i&&(this.queues[s]=new E.EventQueue(this.runtime,this.valueToArgs)),this.queues[s]}listen(e,t,s){e==this.schedulerID&&t==this.idleEventID&&this.runtime.startIdle();e=this.start(e,t,this.backgroundHandlerFlag,!0);this.backgroundHandlerFlag?e.addHandler(s):e.setHandler(s),this.backgroundHandlerFlag=!1}removeBackgroundHandler(t){Object.keys(this.queues).forEach(e=>{e.startsWith("back:")&&this.queues[e].removeHandler(t)})}getQueues(e,t,s){var i=[this.start(0,0,s)];return 0==e&&0==t||(t&&i.push(this.start(0,t,s)),e&&i.push(this.start(e,0,s)),e&&t&&i.push(this.start(e,t,s))),i}queue(e,t,s=null){if(!E.runtime.pausedOnBreakpoint){const i=this.notifyID&&this.notifyOneID&&e==this.notifyOneID;i&&(e=this.notifyID);e=this.getQueues(e,t,!0).concat(this.getQueues(e,t,!1));this.lastEventValue=t,this.lastEventTimestampUs=E.U.perfNowUs(),E.U.promiseMapAllSeries(e,e=>e?e.push(s,i):Promise.resolve())}}queueIdle(){this.schedulerID&&this.idleEventID&&this.queue(this.schedulerID,this.idleEventID)}wait(e,t,s){this.start(e,t,!1,!0).addAwaiter(s)}getLastEventValue(){return this.lastEventValue}getLastEventTime(){return 4294967295&this.lastEventTimestampUs-E.runtime.startTimeUs}},E.AnimationQueue=class{constructor(s){this.runtime=s,this.queue=[],this.process=()=>{var e,t=this.queue[0];t&&!this.runtime.dead&&(s=this.runtime,e=t.frame(),s.queueDisplayUpdate(),s.maybeUpdateDisplay(),!1===e?(this.queue.shift(),this.queue[0]&&(this.queue[0].setTimeoutHandle=setTimeout(this.process,this.queue[0].interval)),t.whenDone(!1)):t.setTimeoutHandle=setTimeout(this.process,t.interval))}}cancelAll(){var e,t=this.queue;this.queue=[];for(e of t)e.whenDone(!0),e.setTimeoutHandle&&clearTimeout(e.setTimeoutHandle)}cancelCurrent(){var e=this.queue[0];e&&(this.queue.shift(),e.whenDone(!0),e.setTimeoutHandle)&&clearTimeout(e.setTimeoutHandle)}enqueue(e){e.whenDone||(e.whenDone=()=>{}),this.queue.push(e),1==this.queue.length&&this.process()}executeAsync(s){return E.U.assert(!s.whenDone),new Promise((e,t)=>{s.whenDone=e,this.enqueue(s)})}};{var s=E.AudioContextManager||(E.AudioContextManager={});let y,i,r,n,o=0,w=!1;function I(){return y=y||function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()}function a(){p(0),o=0,n&&n.pause()}function l(){a(),h()}function u(e,t){e.gain.value&&e.gain.setTargetAtTime(0,I().currentTime,.015),setTimeout(()=>{e.disconnect(),t&&t.disconnect()},450)}s.mute=function(e){w=e,l();var t=I();!e&&t&&"suspended"===t.state&&t.resume()},s.stopAll=l,s.stop=function(){if(a(),r){try{u(r,i)}catch(e){}r=void 0,i=void 0}},s.frequency=function(){return o};const P=[null,"triangle","sawtooth","sine"];let x,C,S=[],k=[];const D=[];class B{mute(){this.gain?u(this.gain,this.generator):this.generator&&(this.generator.stop(),this.generator.disconnect()),this.gain=null,this.generator=null}remove(){var e=D.indexOf(this);0<=e&&D.splice(e,1),this.mute()}}let R=1;function h(){for(R++;D.length;)D[0].remove()}function d(l){const u=R;let h=I(),d=0,c=new B,p=-1,m=-1,f=0;5<D.length&&D[0].remove(),D.push(c);const g=(e,t)=>e/1024/4*(t?.5:1),b=()=>{c.mute(),f=0,p=-1,m=-1},v=()=>{if(d>=l.data.length||!l.data[d])return E.U.delay(f).then(b);var e=l.data[d],t=E.BufferMethods.getNumber(l,E.BufferMethods.NumberFormat.UInt16LE,d+2),s=E.BufferMethods.getNumber(l,E.BufferMethods.NumberFormat.UInt16LE,d+4),i=E.BufferMethods.getNumber(l,E.BufferMethods.NumberFormat.UInt16LE,d+6),r=E.BufferMethods.getNumber(l,E.BufferMethods.NumberFormat.UInt16LE,d+8),n=E.BufferMethods.getNumber(l,E.BufferMethods.NumberFormat.UInt16LE,d+10),o=11<=e&&e<=15,a=4==e||16<=e&&e<=18,i=g(i,o),r=g(r,o);if(!h||u!=R)return E.U.delay(s);if(p!=e||m!=t||t!=n){if(c.generator)return E.U.delay(f).then(()=>(b(),v()));if(c.generator=w?null:function(e,t){let s,i=P[e];if(i)(r=I().createOscillator()).type=i,r.frequency.value=t;else{if(4==e)s=function(){if(!C){var s=(C=I().createBuffer(1,131072,I().sampleRate)).getChannelData(0);let t=251771520;for(let e=0;e<131072;e+=4)32768&(t=(t=(t^=t<<13)^t>>17)^t<<5)?(s[e]=1,s[e+1]=1,s[e+2]=-1,s[e+3]=-1):(s[e]=0,s[e+1]=0,s[e+2]=0,s[e+3]=0)}return C}();else if(5==e)s=function(){if(!x){var s=(x=I().createBuffer(1,1e5,I().sampleRate)).getChannelData(0);let t=251771520;for(let e=0;e<1e5;e++)t=(t=(t^=t<<13)^t>>17)^t<<5,s[e]=(1023&t)/512-1}return x}();else if(11<=e&&e<=15)s=function(t){if(!k[t]){var e=I().createBuffer(1,1024,I().sampleRate),s=e.getChannelData(0);for(let e=0;e<1024;e++)s[e]=e<t/100*1024?1:-1;k[t]=e}return k[t]}(10*(e-10));else{if(!(16<=e&&e<=18))return null;s=function(t){if(!S[t]){var e=I().createBuffer(1,1024,I().sampleRate),s=e.getChannelData(0),i=[770763591,3356908179],r=[15,31,63];for(let e=0;e<1024;e+=4){var n=e/4;0!=(i[(n&=r[t-4])>>5]&1<<(31&n))?(s[e]=1,s[e+1]=1,s[e+2]=-1,s[e+3]=-1):(s[e]=0,s[e+1]=0,s[e+2]=0,s[e+3]=0)}S[t]=e}return S[t]}(e-16+4)}var r=I().createBufferSource();r.buffer=s,r.loop=!0,4==e||16<=e&&e<=18?r.playbackRate.value=t/(I().sampleRate/4):5!=e&&(r.playbackRate.value=t/(I().sampleRate/1024))}return r}(e,t),!c.generator)return E.U.delay(s);if(p=e,m=t,c.gain=h.createGain(),c.gain.gain.value=0,c.gain.gain.setTargetAtTime(i,y.currentTime,.015),n!=t)if(null!=c.generator.frequency)c.generator.frequency.linearRampToValueAtTime(n,h.currentTime+(f+s)/1e3);else if(null!=c.generator.playbackRate){const E=a?4:1024;c.generator.playbackRate.linearRampToValueAtTime(n/(I().sampleRate/E),h.currentTime+(f+s)/1e3)}c.generator.connect(c.gain),c.gain.connect(h.destination),c.generator.start()}d+=12,c.gain.gain.setValueAtTime(i,h.currentTime+f/1e3),f+=s;o=0!==r&&50<s?(f-50)/1e3:(f-10)/1e3;return c.gain.gain.linearRampToValueAtTime(r,h.currentTime+o),v()};return v().then(()=>c.remove())}function c(e,t){if(!(e<0)){o=e;var s=I();if(s){t=Math.max(0,Math.min(1,t));try{i||(i=s.createOscillator(),(r=s.createGain()).gain.value=0,i.type="triangle",i.connect(r),r.connect(s.destination),i.start(0)),p(t)}catch(e){return i=void 0,void(r=void 0)}i.frequency.value=e,p(t)}}}function p(e){null!=r&&r.gain&&r.gain.setTargetAtTime(w?0:e,y.currentTime,.015)}s.muteAllChannels=h,s.queuePlayInstructions=function(e,t){const s=R;E.U.delay(e).then(()=>s!=R?Promise.resolve():d(t))},s.playInstructionsAsync=d,s.tone=c,s.setCurrentToneGain=p,s.playBufferAsync=function(i){return i?new Promise(e=>{function t(){e&&e(),e=void 0}var s="data:audio/wav;base64,"+window.btoa(function(t){let s=t.length,i="";for(let e=0;e<s;++e)i+=String.fromCharCode(t[e]);return i}(i.data));n=new Audio(s),w&&(n.volume=0),n.onended=()=>t(),n.onpause=()=>t(),n.onerror=()=>t(),n.play()}):Promise.resolve()},s.playPCMBufferStreamAsync=function(h,d,e=.3,c){return new Promise(r=>{let n=[],o=I().currentTime,a=!1;function l(){const e=c&&c();for(;!a&&n.length<3&&!e;){const e=h();if(!e||!e.length){a=!0;break}i=s=t=void 0;var t=e,s=I().createBuffer(1,t.length,d);if(s.copyToChannel)s.copyToChannel(t,0);else{const d=s.getChannelData(0);for(let e=0;e<t.length;e++)d[e]=t[e]}var i=I().createBufferSource();n.push(i),i.connect(u.gain),i.buffer=s,i.addEventListener("ended",()=>{n.shift().disconnect(),l()}),i.start(o),o+=s.duration}a&&0===n.length&&(u.remove(),r&&r(),r=void 0)}const u=new B;u.gain=I().createGain(),u.gain.gain.value=0,w||u.gain.gain.setValueAtTime(e,I().currentTime),u.gain.connect(I().destination),5<D.length&&D[0].remove(),D.push(u),l()})},s.sendMidiMessage=function(e){var t,s,i,e=e.data;e.length&&(t=e[0]>>4,s=15&e[0],i=e[1]||0,i=440*Math.pow(2,(i-69)/12),e=e[2]||0,8==t||9==t&&0==e?a():9==t&&(c(i,1),9==s)&&setTimeout(()=>a(),500))}}E.isTouchEnabled=e,E.hasPointerEvents=t,E.pointerEvents=t()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:e()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim=pxsim||{}),function(S){function r(t,s){return e=>e*(s/t)}function s(e,t){var s=e[0]-t[0],e=e[1]-t[1];return s*s+e*e}var t;(t=S.visuals||(S.visuals={})).translateEl=function(e,t){S.svg.hydrate(e,{transform:`translate(${t[0]} ${t[1]})`})},t.composeSVG=function(e){var[t,s]=[e.el1,e.el2];S.U.assert(0==t.x&&0==t.y&&0==s.x&&0==s.y,"el1 and el2 x,y offsets not supported");let i=(e,t,s)=>S.svg.hydrate(e,{x:t,y:s}),r=(e,t,s)=>S.svg.hydrate(e,{width:t+"px",height:s+"px"}),n=e.scaleUnit2,o=e.scaleUnit2/e.scaleUnit1,a=t.w*o,l=t.h*o;r(t.el,a,l);var u=+s.w,h=+s.h;r(s.el,u,h);let[d,c,p,m]=e.margin,f=e.middleMargin,g=Math.max(a,u),b=c+(g-a)/2,v=d,y=(i(t.el,b,v),c+(g-u)/2),w=v+l+f;i(s.el,y,w);var x,u=[v,v+l,w,w+h],h=S.svg.elt("svg",{version:"1.0",viewBox:`0 0 ${c+g+m} `+(d+l+f+h+p),class:"sim-bb"}),C=(x=h,C=e.maxWidth,e=e.maxHeight,C&&S.svg.hydrate(x,{width:C}),e&&S.svg.hydrate(x,{height:e}),i(h,0,0),S.svg.child(h,"g"));return h.appendChild(t.el),h.appendChild(s.el),{under:C,over:S.svg.child(h,"g"),host:h,edges:u,scaleUnit:n,toHostCoord1:e=>{var[e,t]=e;return[e*o+b,t*o+v]},toHostCoord2:e=>{var[e,t]=e;return[+e+y,+t+w]}}},t.mkScaleFn=r,t.mkImageSVG=function(e){var t=r(e.imageUnitDist,e.targetUnitDist),s=t(e.width),t=t(e.height),i=S.svg.elt("image",{width:s,height:t});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+e.image),{el:i,w:s,h:t,x:0,y:0}},t.findDistSqrd=s,t.findClosestCoordIdx=function(t,e){return e.map(e=>s(t,e)).reduce((e,t,s,i)=>t<i[e]?s:e,0)},t.mkTxt=function(e,t,s,i,r,n,o){var a=S.svg.elt("text"),n=(n=n||-.33333)*s*r.length;return S.svg.hydrate(a,{style:`font-size:${s}px;`,transform:`translate(${e} ${t}) rotate(${i}) translate(${n} ${(o=o||.3)*s})`}),S.U.addClass(a,"noselect"),a.textContent=r,a},t.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],t.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},t.mapWireColor=function(e){return t.WIRE_COLOR_MAP[e]||e},t.PIN_DIST=15,t.rgbToHsl=function(e){let t,s,i,[r,n,o]=e,[a,l,u]=[r/255,n/255,o/255],h=Math.min(a,l,u),d=Math.max(a,l,u),c=d-h,p=d+h;return i=p/2*100,s=0==c?t=0:(d===a?t=(l-u)/c%6*60:d===l?t=60*((u-a)/c+2):d===u&&(t=60*((a-l)/c+4)),50<i?c/(2-p)*100:c/p*100),[Math.floor(t),Math.floor(s),Math.floor(i)]}}(pxsim=pxsim||{}),function(a){var i,e;function r(e,t,s){e={class:e,d:t},s&&(e.title=s),t=i.elt("path");return i.hydrate(t,e),t}function n(e,t=!1){var s=i.elt("linearGradient");return i.hydrate(s,{id:e,x1:"0%",y1:"0%",x2:t?"100%":"0%",y2:t?"0%":"100%"}),i.child(s,"stop",{offset:"0%"}),i.child(s,"stop",{offset:"100%"}),i.child(s,"stop",{offset:"100%"}),i.child(s,"stop",{offset:"100%"}),s}function s(e){var t=i.elt("title");return t.textContent=e,t}(e=i=a.svg||(a.svg={})).parseString=function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").getElementsByTagName("svg").item(0)},e.toDataUri=function(e){return"data:image/svg+xml,"+encodeURI(e)},e.cursorPoint=function(e,t,s){return e.x=null!=s.clientX?s.clientX:s.pageX,e.y=null!=s.clientY?s.clientY:s.pageY,e.matrixTransform(t.getScreenCTM().inverse())},e.rotateElement=function(e,t,s,i){e.setAttribute("transform",`translate(${t},${s}) rotate(${i+90}) translate(${-t},${-s})`)},e.hydrate=function(e,t){for(var s in t)"title"==s?i.title(e,t[s]):e.setAttributeNS(null,s,t[s])},e.elt=function(e,t){e=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&i.hydrate(e,t),e},e.child=function(e,t,s){t=i.elt(t,s);return e.appendChild(t),t},e.mkPath=r,e.path=function(e,t,s,i){t=r(t,s,i);return e.appendChild(t),t},e.fill=function(e,t){e.style.fill=t},e.filter=function(e,t){e.style.filter=t},e.fills=function(e,t){e.forEach(e=>e.style.fill=t)},e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.onClick=function(t,s){let i=!1;a.pointerEvents.down.forEach(e=>t.addEventListener(e,e=>i=!0,!1)),t.addEventListener(a.pointerEvents.up,e=>!i||(i=!1,s(e),e.preventDefault(),!1),!1)},e.buttonEvents=function(t,s,i,r,n){let o=!1;a.pointerEvents.down.forEach(e=>t.addEventListener(e,e=>(o=!0,i&&i(e),!0),!1)),t.addEventListener(a.pointerEvents.move,e=>!o||(s&&s(e),e.preventDefault(),!1),!1),t.addEventListener(a.pointerEvents.up,e=>{o=!1,r&&r(e)},!1),t.addEventListener(a.pointerEvents.leave,e=>{o=!1,r&&r(e)},!1),t.addEventListener("keydown",e=>{o=!1,n&&n(e)})},e.mkLinearGradient=n,e.linearGradient=function(e,t,s=!1){t=n(t,s);return e.appendChild(t),t},e.setGradientColors=function(e,t,s){e&&(e.childNodes[0].style.stopColor=t,e.childNodes[1].style.stopColor=t,e.childNodes[2].style.stopColor=s,e.childNodes[3].style.stopColor=s)},e.setGradientValue=function(e,t){e.childNodes[1].getAttribute("offset")!=t&&(e.childNodes[1].setAttribute("offset",t),e.childNodes[2].setAttribute("offset",t))},e.animate=function(e,t){a.U.addClass(e,t);t=e.parentElement;t&&(t.removeChild(e),t.appendChild(e))},e.mkTitle=s,e.title=function(e,t){t=s(t);return e.appendChild(t),t},e.toHtmlColor=function(e){return`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&1})`}}(pxsim=pxsim||{}),function(e){class t{constructor(e){this.id=e}}e.Button=t,e.ButtonPairState=class{constructor(e){this.props=e,this.usesButtonAB=!1,this.aBtn=new t(this.props.ID_BUTTON_A),this.bBtn=new t(this.props.ID_BUTTON_B),this.abBtn=new t(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0}}}(pxsim=pxsim||{}),(pxsim||(pxsim={})).CompassState=class{constructor(){this.usesHeading=!1,this.heading=90}},(pxsim||(pxsim={})).FileSystemState=class{constructor(){this.files={}}append(e,t){this.files[e]=(this.files[e]||"")+t}remove(e){delete this.files[e]}},(pxsim||(pxsim={})).LightSensorState=class{constructor(){this.usesLightLevel=!1,this.lightLevel=128}},function(l){var u;(u=l.visuals||(l.visuals={})).mkBoardView=e=>{var t=e.visual;return new u.GenericBoardSvg({visualDef:t,boardDef:e.boardDef,wireframe:e.wireframe})},u.BoardHost=class{constructor(e,t){this.parts=[],this.boardView=e,(this.opts=t).boardDef.pinStyles||(t.boardDef.pinStyles={}),this.state=t.state;let s=t.partsList,i=0<s.length||t.forceBreadboardLayout;if(i){this.breadboard=new u.Breadboard({wireframe:t.wireframe});const e=t.boardDef.marginWhenBreadboarding||[0,0,40,0],n=u.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[e[0],e[1],20,e[3]],middleMargin:e[2],maxWidth:t.maxWidth,maxHeight:t.maxHeight}),o=n.under,a=n.over;this.view=n.host;var r=n.edges,r=(this.fromMBCoord=n.toHostCoord1,this.fromBBCoord=n.toHostCoord2,this.partGroup=a,this.partOverGroup=l.svg.child(this.view,"g"),this.style=l.svg.child(this.view,"style",{}),this.defs=l.svg.child(this.view,"defs",{}),this.wireFactory=new u.WireFactory(o,a,r,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this)),l.allocateDefinitions({boardDef:t.boardDef,partDefs:t.partDefs,fnArgs:t.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:s}));(r.partsAndWires.length||t.forceBreadboardLayout)&&(this.addAll(r),r.requiresBreadboard||t.forceBreadboardRender)?r.hideBreadboard&&this.breadboard&&this.breadboard.hide():i=!1}if(!i){delete this.breadboard,delete this.wireFactory,delete this.partOverGroup,delete this.partGroup,delete this.style,delete this.defs,delete this.fromBBCoord,delete this.fromMBCoord;const u=this.boardView.getView().el;this.view=u,this.partGroup=l.svg.child(this.view,"g"),this.partOverGroup=l.svg.child(this.view,"g"),t.maxWidth&&l.svg.hydrate(this.view,{width:t.maxWidth}),t.maxHeight&&l.svg.hydrate(this.view,{height:t.maxHeight})}this.state.updateSubscribers.push(()=>this.updateState())}highlightBoardPin(e){this.boardView.highlightPin(e)}highlightBreadboardPin(e){this.breadboard.highlightLoc(e)}highlightWire(e){e.wires.forEach(e=>{l.U.addClass(e,"highlight"),e.style.visibility="visible"}),l.U.addClass(e.endG,"highlight")}getView(){return this.view}screenshotAsync(r){var e=this.view.cloneNode(!0);e.setAttribute("width",this.view.width.baseVal.value+""),e.setAttribute("height",this.view.height.baseVal.value+"");const t=(new XMLSerializer).serializeToString(e),n="data:image/svg+xml,"+encodeURIComponent(t.replace(/\s+/g," ").replace(/"/g,"'"));return new Promise((s,e)=>{const i=document.createElement("img");i.onload=()=>{var e=document.createElement("canvas"),t=(e.width=i.width,e.height=i.height,0<r?(e.width=r,e.height=i.height*r/i.width|0):e.width<200?(e.width*=2,e.height*=2):480<e.width&&(e.width/=2,e.height/=2),e.getContext("2d"));t.drawImage(i,0,0,e.width,e.height),s(t.getImageData(0,0,e.width,e.height))},i.onerror=e=>{console.log(e),s(void 0)},i.src=n})}updateState(){this.parts.forEach(e=>e.updateState())}getBBCoord(e){e=this.breadboard.getCoord(e);return this.fromBBCoord(e)}getPinCoord(e){var t=this.boardView.getCoord(e);if(t)return this.fromMBCoord(t);console.error("Unable to find coord for pin: "+e)}getLocCoord(e){let t;return(t="breadboard"===e.type?this.getBBCoord(e):(e=e.pin,this.getPinCoord(e)))||console.debug("Unknown location: "+name),t}getPinStyle(e){return"breadboard"!=e.type&&this.opts.boardDef.pinStyles[e.pin]||"female"}addPart(e){let t=null;e.simulationBehavior?(s=e.simulationBehavior,i=this.state.builtinVisuals[s],s=this.state.builtinParts[s],(t=i()).init(this.state.bus,s,this.view,e.params)):(i=e.visual,t=new u.GenericPart(i)),this.parts.push(t),this.partGroup.appendChild(t.element),t.overElement&&this.partOverGroup.appendChild(t.overElement),t.defs&&t.defs.forEach(e=>this.defs.appendChild(e)),this.style.textContent+=t.style||"";var s=e.startColumnIdx,i=e.startRowIdx,i={type:"breadboard",row:u.getRowName(i),col:u.getColumnName(s),xOffset:e.bbFit.xOffset/e.visual.pinDistance,yOffset:e.bbFit.yOffset/e.visual.pinDistance},s=this.getBBCoord(i),i=(t.moveToCoord(s),`sim-${e.name}-cmp`);return l.U.addClass(t.element,i),l.U.addClass(t.element,"sim-cmp"),t.updateTheme(),t.updateState(),t}addWire(e){return this.wireFactory.addWire(e.start,e.end,e.color)}addAll(i){i.partsAndWires.forEach(e=>{var t=e.wires,s=t&&t.every(e=>this.wireFactory.checkWire(e.start,e.end)),e=(s&&t.forEach(e=>i.wires.push(this.addWire(e))),e.part);!e||t&&!s||i.parts.push(this.addPart(e))}),i.requiresBreadboard=!!i.wires.length||!!i.parts.length}}}(pxsim=pxsim||{}),function(C){{var S=C.visuals||(C.visuals={});S.BREADBOARD_MID_ROWS=10,S.BREADBOARD_MID_COLS=30;const B=[4,4],e=S.BREADBOARD_MID_ROWS+B.length,_=[4,9,14,19],t=25+_.length,T=15*(S.BREADBOARD_MID_COLS+3),A=15*(e+4+5.5),F=A*(2/3),M=.16666666666666669*A,s=15*(S.BREADBOARD_MID_COLS-1),L=(T-s)/2,U=M+(F-15*(e-1))/2,O=15*(t-1),N=(T-O)/2,V=(M-15)/2,q=N,W=V+M+F,G=-90,i="abcdefghij".split("").reverse();function k(e){return""+(e+1)}function R(e){return i[e]}function E(a){let l=a.xOffset||0,t=a.yOffset||0,u=[],h=C.svg.elt("g"),d=a.colStartIdx||0,s=a.rowStartIdx||0,c=e=>e?e.slice(0,e.length):[],p=(e,t)=>{let s,i=0;for(;0<=(s=e.indexOf(t));)e.splice(s,1),i+=1;return i},m=0,f=c(a.rowIdxsWithGap);for(let e=0;e<a.rowCount;e++){let i=0,r=c(a.colIdxsWithGap),n=t+e*a.pinDist+m*a.pinDist,o=e+s;for(let s=0;s<a.colCount;s++){let t=l+s*a.pinDist+i*a.pinDist,e=s+d;const m=e=>(C.svg.hydrate(e.el,"circle"==e.el.tagName?{cx:t,cy:n}:{x:t-.5*e.w,y:n-.5*e.h}),h.appendChild(e.el),e.el);var g=m(a.mkPin()),b=m(a.mkHoverPin()),v=a.getRowName(o),y=a.getColName(e),w=a.getGroupName?a.getGroupName(o,e):null,g={el:g,hoverEl:b,cx:t,cy:n,row:v,col:y,group:w};u.push(g),i+=p(r,e)}m+=p(f,o)}return{g:h,allPins:u}}function I(){var e=C.svg.elt("rect");return C.svg.hydrate(e,{class:"sim-bb-pin",rx:2,ry:2,width:6,height:6}),{el:e,w:6,h:6,x:0,y:0}}function P(){var e=C.svg.elt("rect"),t=6*1.3;return C.svg.hydrate(e,{class:"sim-bb-pin-hover",rx:2,ry:2,width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}}function D(e,t,s,i,r,n,o){let a=S.mkTxt(e,t,s,i,r),l=(C.U.addClass(a,"sim-bb-label"),o&&o.forEach(e=>C.U.addClass(a,e)),S.mkTxt(e,t,1.3*s,i,r));return C.U.addClass(l,"sim-bb-label-hover"),o&&o.forEach(e=>C.U.addClass(l,e)),{el:a,hoverEl:l,txt:r,group:n}}S.getColumnName=k,S.getRowName=R,S.mkGrid=E,S.Breadboard=class{constructor(e){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),e.wireframe&&C.U.addClass(this.bb,"sim-bb-outline")}hide(){this.bb.style.display="none"}updateLocation(e,t){C.svg.hydrate(this.bb,{x:e+"px",y:t+"px"})}getPin(e,t){e=this.rowColToPin[e];return e&&e[t]||null}getCoord(e){var{row:e,col:t,xOffset:s,yOffset:i}=e,e=this.getPin(e,t);return e?[e.cx+15*(s||0),e.cy+15*(i||0)]:null}getPinDist(){return 15}buildDom(){this.bb=C.svg.elt("svg",{version:"1.0",viewBox:`0 0 ${T} `+A,class:"sim-bb",width:T+"px",height:A+"px"}),this.styleEl=C.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=C.svg.child(this.bb,"defs",{}),C.svg.child(this.bb,"rect",{class:"sim-bb-background",width:T,height:A,rx:4.5,ry:4.5});let i="sim-bb-channel-grad",e=C.svg.elt("linearGradient");C.svg.hydrate(e,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(e),C.svg.child(e,"stop",{offset:"0%",style:"stop-color: #AAA;"}),C.svg.child(e,"stop",{offset:"20%",style:"stop-color: #CCC;"}),C.svg.child(e,"stop",{offset:"80%",style:"stop-color: #CCC;"}),C.svg.child(e,"stop",{offset:"100%",style:"stop-color: #AAA;"});var t=(e,t,s)=>{s=C.svg.child(this.bb,"rect",{class:"sim-bb-channel "+(s||""),y:e-t/2,width:T,height:t});return s.setAttribute("fill",`url(#${i})`),s};t(M+F/2,15,"sim-bb-mid-channel"),t(M,.75,"sim-bb-sml-channel"),t(M+F,.75,"sim-bb-sml-channel");const s=(e,t)=>(e<S.BREADBOARD_MID_ROWS/2?"b":"t")+k(t),r=e=>0===e?"-":"+",n=(e,t)=>{t=t<25?"b":"t";return r(e)+t};var t=E({xOffset:L,yOffset:U,rowCount:S.BREADBOARD_MID_ROWS,colCount:S.BREADBOARD_MID_COLS,pinDist:15,mkPin:I,mkHoverPin:P,getRowName:R,getColName:k,getGroupName:s,rowIdxsWithGap:B}),t=(t.g,this.allPins=this.allPins.concat(t.allPins),E({xOffset:q,yOffset:W,rowCount:2,colCount:25,pinDist:15,mkPin:I,mkHoverPin:P,getRowName:r,getColName:k,getGroupName:n,colIdxsWithGap:_})),t=(t.g,this.allPins=this.allPins.concat(t.allPins),E({xOffset:N,yOffset:V,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:I,mkHoverPin:P,getRowName:r,getColName:k,getGroupName:n,colIdxsWithGap:_.map(e=>e+25)})),o=(t.g,this.allPins=this.allPins.concat(t.allPins),this.allPins.forEach(e=>{var{el:e,row:t,col:s,hoverEl:i}=e,t=`(${t},${s})`;C.svg.hydrate(e,{title:t}),C.svg.hydrate(i,{title:t})}),this.allPins.forEach(e=>{let t=this.rowColToPin[e.row];(t=t||(this.rowColToPin[e.row]={}))[e.col]=e}),(e,t,s,i,r,n)=>{var[e,t]=this.getCoord({type:"breadboard",row:e,col:t});return D(e+s,t+i,10.5,-90,r,n)});for(let e=0;e<S.BREADBOARD_MID_COLS;e++){var a=k(e),l=o(R(0),a,0,-15,a,s(0,e)),l=(this.allLabels.push(l),S.BREADBOARD_MID_ROWS-1),a=o(R(l),a,0,15,a,s(l,e));this.allLabels.push(a)}for(let e=0;e<S.BREADBOARD_MID_ROWS;e++){var u=R(e),h=o(u,"1",-15,0,u),h=(this.allLabels.push(h),o(u,k(S.BREADBOARD_MID_COLS-1),15,0,u));this.allLabels.push(h)}let d=[D(13.05,M+F+12,30,G,"-",n(0,0),["sim-bb-blue"]),D(12,M+F+M-12,25.5,G,"+",n(1,0),["sim-bb-red"]),D(T-12+1.05,M+F+12,30,G,"-",n(0,24),["sim-bb-blue"]),D(T-12,M+F+M-12,25.5,G,"+",n(1,24),["sim-bb-red"])],c=(this.allLabels=this.allLabels.concat(d),[D(13.05,12,30,G,"-",n(0,25),["sim-bb-blue"]),D(12,M-12,25.5,G,"+",n(1,25),["sim-bb-red"]),D(T-12+1.05,12,30,G,"-",n(0,49),["sim-bb-blue"]),D(T-12,M-12,25.5,G,"+",n(1,49),["sim-bb-red"])]),p=(this.allLabels=this.allLabels.concat(c),{});this.allLabels.forEach(e=>{var t=e["txt"];(p[t]=p[t]||[]).push(e)}),this.allPins.forEach(t=>{let{row:e,col:s}=t,i=this.rowColToLbls[e]||(this.rowColToLbls[e]={}),r=i[s]||(i[s]=[]);"-"===t.row||"+"===t.row?Number(s)<=25?d.filter(e=>e.group==t.group).forEach(e=>r.push(e)):c.filter(e=>e.group==t.group).forEach(e=>r.push(e)):(p[e].forEach(e=>r.push(e)),p[s].forEach(e=>r.push(e)))});const m=22.5+O,f=(m-O)/2,g=(e,t,s,i)=>{var r=C.svg.elt("rect");return C.svg.hydrate(r,{class:"sim-bb-bar "+i,x:e,y:t-1.5,width:m,height:3}),{el:r,group:s}};t=[g(q-f,W-9,n(0,49),"sim-bb-blue"),g(q-f,15+W+9,n(1,49),"sim-bb-red"),g(N-f,V-9,n(0,0),"sim-bb-blue"),g(N-f,15+V+9,n(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(t),this.allPowerBars.forEach(e=>this.bb.appendChild(e.el));let b=this.allPins.map(e=>e.group).filter((e,t,s)=>s.indexOf(e)==t),v=b.map(e=>C.svg.elt("g")),y=(v.forEach(e=>C.U.addClass(e,"sim-bb-pin-group")),v.forEach((e,t)=>C.U.addClass(e,"group-"+b[t])),{}),w=(b.forEach((e,t)=>y[e]=v[t]),{}),x=(this.allPins.forEach((e,t)=>{var s=e.group;(w[s]||(w[s]=[])).push(e)}),b.forEach(e=>{var t=w[e],[t,s]=[t.map(e=>e.cx),t.map(e=>e.cy)],i=e=>e.reduce((e,t)=>e<t?e:t),r=e=>e.reduce((e,t)=>t<e?e:t),[t,i,r,s]=[i(t),r(t),i(s),r(s)],n=C.svg.elt("rect"),i=Math.max(i-t,1e-4),s=Math.max(s-r,1e-4);C.svg.hydrate(n,{x:t,y:r,width:i,height:s}),C.U.addClass(n,"sim-bb-group-wire"),y[e].appendChild(n)}),this.allPins.forEach(e=>{var t=y[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)}),C.svg.elt("g"));C.svg.hydrate(x,{class:"sim-bb-group-misc"}),v.push(x),this.allLabels.forEach(e=>{var t;(e.group?((t=y[e.group]).appendChild(e.el),t):(x.appendChild(e.el),x)).appendChild(e.hoverEl)}),v.forEach(e=>this.bb.appendChild(e))}getSVGAndSize(){return{el:this.bb,y:0,x:0,w:T,h:A}}highlightLoc(e){var{row:e,col:t}=e,{}=this.rowColToPin[e][t];this.rowColToLbls[e][t].forEach(e=>{C.U.addClass(e.el,"highlight"),C.U.addClass(e.hoverEl,"highlight")})}}}}(pxsim=pxsim||{}),function(m){{var f=m.visuals||(m.visuals={});f.BOARD_SYTLE=`
        .noselect {
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none;   /* Chrome/Safari/Opera */
            -khtml-user-select: none;    /* Konqueror */
            -moz-user-select: none;      /* Firefox */
            -ms-user-select: none;       /* Internet Explorer/Microsoft Edge */
            user-select: none;           /* Non-prefixed version, currently
                                            not supported by any browser */
        }

        .sim-board-pin {
            fill:#999;
            stroke:#000;
            stroke-width:${f.PIN_DIST/3}px;
        }
        .sim-board-pin-lbl {
            fill: #333;
        }
        .gray-cover {
            fill:#FFF;
            opacity: 0.3;
            stroke-width:0;
            visibility: hidden;
        }
        .sim-board-pin-hover {
            visibility: hidden;
            pointer-events: all;
            stroke-width:${f.PIN_DIST/6}px;
        }
        .sim-board-pin-hover:hover {
            visibility: visible;
        }
        .sim-board-pin-lbl {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-lbl {
            visibility: visible;
        }
        .sim-board-pin-lbl {
            fill: #555;
        }
        .sim-board-pin-lbl-hover {
            fill: red;
        }
        .sim-board-outline .sim-board-pin-lbl-hover {
            fill: black;
        }
        .sim-board-pin-lbl,
        .sim-board-pin-lbl-hover {
            font-family:"Lucida Console", Monaco, monospace;
            pointer-events: all;
            stroke-width: 0;
        }
        .sim-board-pin-lbl-hover {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,
        .sim-board-pin-lbl.highlight {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,
        .sim-board-pin-lbl-hover.highlight {
            visibility: visible;
        }
        /* Graying out */
        .grayed .sim-board-pin-lbl:not(.highlight) {
            fill: #AAA;
        }
        .grayed .sim-board-pin:not(.highlight) {
            fill:#BBB;
            stroke:#777;
        }
        .grayed .gray-cover {
            visibility: inherit;
        }
        .grayed .sim-cmp:not(.notgrayed) {
            opacity: 0.3;
        }
        /* Highlighting */
        .sim-board-pin-lbl.highlight {
            fill: #000;
            font-weight: bold;
        }
        .sim-board-pin.highlight {
            fill:#999;
            stroke:#000;
        }
        `;const g=.7*f.PIN_DIST,b=1.5*g,v=.66666*f.PIN_DIST,y=.66666*f.PIN_DIST+f.PIN_DIST/3;let p=0;f.GenericBoardSvg=class{constructor(e){this.props=e,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=p++;let n=e.visualDef,t=e.wireframe&&n.outlineImage?n.outlineImage:n.image,s=f.mkImageSVG({image:t,width:n.width,height:n.height,imageUnitDist:n.pinDist,targetUnitDist:f.PIN_DIST}),o=f.mkScaleFn(n.pinDist,f.PIN_DIST);this.width=s.w,this.height=s.h;var i=s.el;this.element=m.svg.elt("svg"),m.svg.hydrate(this.element,{version:"1.0",viewBox:`0 0 ${this.width} `+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),e.wireframe&&m.U.addClass(this.element,"sim-board-outline"),this.style=m.svg.child(this.element,"style",{}),this.style.textContent+=f.BOARD_SYTLE,this.defs=m.svg.child(this.element,"defs",{}),this.g=m.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(i),this.background=i,m.svg.hydrate(i,{class:"sim-board"});const a=()=>{var e=m.svg.elt("circle"),t=v;return m.svg.hydrate(e,{class:"sim-board-pin",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},l=()=>{var e=m.svg.elt("circle"),t=y;return m.svg.hydrate(e,{class:"sim-board-pin-hover",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},u=()=>{var e=m.svg.elt("rect"),t=v;return m.svg.hydrate(e,{class:"sim-board-pin",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},h=()=>{var e=m.svg.elt("rect"),t=y;return m.svg.hydrate(e,{class:"sim-board-pin-hover",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}};let r=n.pinBlocks.map((t,e)=>{var s=o(t.x)+f.PIN_DIST/2,i=o(t.y)+f.PIN_DIST/2,r=t.labels.length,s=f.mkGrid({xOffset:s,yOffset:i,rowCount:1,colCount:r,pinDist:f.PIN_DIST,mkPin:n.useCrocClips?a:u,mkHoverPin:n.useCrocClips?l:h,getRowName:()=>""+(e+1),getColName:e=>t.labels[e],getGroupName:()=>t.labels.join(" ")});return s.allPins,s.g,m.U.addClass(s.g,"sim-board-pin-group"),s}),d=[];r.forEach((e,s)=>e.allPins.forEach((e,t)=>{this.allPins.push(e),d.push(n.pinBlocks[s])})),this.allPins.forEach(e=>{var t=e.col;m.svg.hydrate(e.el,{title:t}),m.svg.hydrate(e.hoverEl,{title:t})}),this.allPins.forEach(e=>{this.pinNmToPin[e.col]=e});const c=(e,t,s,i,r)=>{let n,o;return n="below"===r?(o=e,t+12+.25*s*i.length):(o=e,t-11-.32*s*i.length),f.mkTxt(o,n,s,-90,i)};this.allLabels=this.allPins.map((e,t)=>{var s,i,r,t=d[t];return s=e.cx,i=e.cy,e=e.col,t=t.labelPosition||"above",r=c(s,i,g,e,t),m.U.addClass(r,"sim-board-pin-lbl"),s=c(s,i,b,e,t),m.U.addClass(s,"sim-board-pin-lbl-hover"),{el:r,hoverEl:s,txt:e}}),this.allPins.forEach((e,t)=>{t=this.allLabels[t];this.pinNmToLbl[e.col]=t}),this.allPins.forEach((e,t)=>{t=this.allLabels[t];this.g.appendChild(e.el),this.g.appendChild(e.hoverEl),this.g.appendChild(t.el),this.g.appendChild(t.hoverEl)})}findPin(e){let t=this.pinNmToPin[e];return t=!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])?this.pinNmToPin[e]:t}findPinLabel(e){let t=this.pinNmToLbl[e];return t=!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])?this.pinNmToLbl[e]:t}getCoord(e){e=this.findPin(e);return e?[e.cx,e.cy]:null}mkGrayCover(e,t,s,i){var r=m.svg.elt("rect");return m.svg.hydrate(r,{x:e,y:t,width:s,height:i,class:"gray-cover"}),r}getView(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}}getPinDist(){return f.PIN_DIST}highlightPin(e){var t=this.findPinLabel(e),e=this.findPin(e);t&&e&&(m.U.addClass(t.el,"highlight"),m.U.addClass(t.hoverEl,"highlight"),m.U.addClass(e.el,"highlight"),m.U.addClass(e.hoverEl,"highlight"))}}}}(pxsim=pxsim||{}),function(t){function s(e){return i.mkImageSVG({image:e.image,width:e.width,height:e.height,imageUnitDist:e.pinDistance,targetUnitDist:i.PIN_DIST})}var i;(i=t.visuals||(t.visuals={})).mkGenericPartSVG=s,i.GenericPart=class{constructor(e){this.style="",this.defs=[];e=s(e).el;this.element=t.svg.elt("g"),this.element.appendChild(e)}moveToCoord(e){i.translateEl(this.element,e)}init(e,t,s){}updateState(){}updateTheme(){}}}(pxsim=pxsim||{}),function(v){{var y=v.visuals||(v.visuals={}),e;const a=y.PIN_DIST/2.5;function i(e){return e.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function w(e,t,s,i){var r=e=>e[0]+", "+e[1],[n,o]=e,[a,l]=t,u=l-o,e=v.svg.mkPath("sim-bb-wire",`M${r(e)} C${r([n,o+u*s])} ${r([a,l-u*s])} `+r(t));return v.U.addClass(e,"wire-stroke-"+i),e}function x(e,t,s){var i=e=>e[0]+", "+e[1],e=v.svg.mkPath("sim-bb-wire",`M${i(e)} L`+i(t));return v.U.addClass(e,"wire-stroke-"+s),e}function r(e,t){var s=y.PIN_DIST/4,i=v.svg.elt("circle"),r=e[0],e=e[1],n=a/2+s/2;return v.svg.hydrate(i,{cx:r,cy:e,r:n,class:"sim-bb-wire-end"}),v.U.addClass(i,"wire-fill-"+t),i.style["stroke-width"]=s+"px",i}function o(e,t){var s=.24*y.PIN_DIST,i=10*s,r=2*s,n=6*s,o=y.PIN_DIST/4,[e,a]=e,t=t?-1:1,l=v.svg.elt("g"),u=v.svg.elt("rect"),h=e-r/2,d=a-i/2,c=(v.svg.hydrate(u,{x:h,y:d,width:r,height:i,rx:.5,ry:.5,class:"sim-bb-wire-end"}),u.style["stroke-width"]=o+"px",v.svg.elt("rect")),a=a+t*(i/2+n/2)-n/2;return v.svg.hydrate(c,{x:e-s/2,y:a,width:s,height:n,class:"sim-bb-wire-bare-end"}),c.style.fill="#bbb",l.appendChild(c),l.appendChild(u),{el:l,x:h-o,y:Math.min(d,a),w:r+2*o,h:i+n}}function b(e,t){var s=.24*y.PIN_DIST,i=4*s,r=10*s,n=3.5*s,s=3.5*s,o=y.PIN_DIST/4,[e,a]=e,l=t?-1:1,u=v.svg.elt("g"),h=v.svg.elt("polygon"),d=e-i/2,c=a-r/2,p=t?.15:.3,m=t?.7:1-.7,t=t?.3:.15,p=(v.svg.hydrate(h,{points:[[d+i*p,c],[d+i*(1-p),c],[d+i,c+r*m],[d+i*(1-t),c+r],[d+i*t,c+r],[d,c+r*m]].map(e=>e[0]+","+e[1]).join(" ")}),v.svg.hydrate(h,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=o+"px",v.svg.elt("rect")),t=n,m=a+l*(r/2+t/2)-t/2;return v.svg.hydrate(p,{x:e-s/2,y:m,width:s,height:t,class:"sim-bb-wire-bare-end"}),u.appendChild(p),u.appendChild(h),{el:u,x:d-o,y:Math.min(c,m),w:i+2*o,h:r+t}}y.WIRES_CSS=`
        .sim-bb-wire {
            fill:none;
            stroke-linecap: round;
            stroke-width:${a}px;
            pointer-events: none;
        }
        .sim-bb-wire-end {
            stroke:#333;
            fill:#333;
        }
        .sim-bb-wire-bare-end {
            fill: #ccc;
        }
        .sim-bb-wire-hover {
            stroke-width: ${a}px;
            visibility: hidden;
            stroke-dasharray: ${y.PIN_DIST/10},${y.PIN_DIST/1.5};
            /*stroke-opacity: 0.4;*/
        }
        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {
            stroke: #777;
            fill: #777;
        }
        .grayed .sim-bb-wire:not(.highlight) {
            stroke: #CCC;
        }
        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {
            stroke: red;
            fill: red;
        }
        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {
            stroke: #FFF;
            fill: #FFF;
        }
        `,(e=y.WireEndStyle||(y.WireEndStyle={}))[e.BBJumper=0]="BBJumper",e[e.OpenJumper=1]="OpenJumper",e[e.Croc=2]="Croc",y.mkWirePart=function(e,t,s=!1){var i=v.svg.elt("g"),[e,r]=e,a=[e-15,r-50],l=[e+15,r+50],r=(t=y.mapWireColor(t),e=(s?b:o)(a,!0),function(e){var t=e=>e[0]+", "+e[1],[s,i]=a,[r,n]=l,o=n-i,o=v.svg.mkPath("sim-bb-wire",`M${t(a)} C${t([s,i+.8*o])} ${t([r,n-.8*o])} `+t(l));return o.style.stroke=e,{el:o,x:Math.min(s,r),y:Math.min(i,n),w:Math.abs(s-r),h:Math.abs(i-n)}}(t)),s=o(l,!1),t=(i.appendChild(r.el),i.appendChild(e.el),i.appendChild(s.el),Math.min(e.x,s.x)),r=Math.max(e.x+e.w,s.x+s.w),n=Math.min(e.y,s.y);return{el:i,x:t,y:n,w:r-t,h:Math.max(e.y+e.h,s.y+s.h)-n}},y.WireFactory=class{constructor(e,t,s,i,r,n){this.nextWireId=0,this.styleEl=i,this.styleEl.textContent+=y.WIRES_CSS,this.underboard=e,this.overboard=t,this.boardEdges=s,this.getLocCoord=r,this.getPinStyle=n}indexOfMin(t){let s=0,i=t[0];for(let e=1;e<t.length;e++)t[e]<i&&(i=t[e],s=e);return s}closestEdgeIdx(t){var e=this.boardEdges.map(e=>Math.abs(t[1]-e));return this.indexOfMin(e)}closestEdge(e){return this.boardEdges[this.closestEdgeIdx(e)]}drawWire(a,l,e){var u=[],h=v.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),d=e=>{var t=y.PIN_DIST/2,s=this.closestEdge(e),s=s-e[1]<0?s-t:s+t;return[e[0],s]},c=this.nextWireId++,p=i(e),t=r(a,p),s=r(l,p),m=v.svg.child(h,"g",{class:"sim-bb-wire-ends-g"}),f=(m.appendChild(t),m.appendChild(s),this.closestEdgeIdx(a)),g=this.closestEdgeIdx(l);if(f==g){var b=x(a,l,p);h.appendChild(b),u.push(b)}else{let e,t,s=d(a),i=d(l),r=x(a,s,p),n=x(l,i,p),o=(t=1!=f&&2!=f||1!=g&&2!=g?(e=x(s,i,p),x(s,i,p)):(e=w(s,i,.7,p),w(s,i,.7,p)),v.U.addClass(t,"sim-bb-wire-hover"),h.appendChild(r),u.push(r),h.appendChild(n),u.push(n),this.underboard.appendChild(e),u.push(e),h.appendChild(t),u.push(t),"sim-bb-wire-id-"+c);b=e=>v.U.addClass(e,o);b(m),b(t),this.styleEl.textContent+=`
                    .${o}:hover ~ .${o}.sim-bb-wire-hover {
                        visibility: visible;
                    }`}d=`
                .wire-stroke-${p} {
                    stroke: ${y.mapWireColor(e)};
                }
                .wire-fill-${p} {
                    fill: ${y.mapWireColor(e)};
                }
                `;return this.styleEl.textContent+=d,{endG:m,end1:t,end2:s,wires:u}}drawWireWithCrocs(n,o,e,a=!1){var l=[],u=v.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),h=e=>{var t=y.PIN_DIST/2,s=this.closestEdge(e),s=s-e[1]<0?s-t:s+t;return[e[0],s]},d=this.nextWireId++,c=i(e),t=r(n,c),p=o,[s,m]=o;[s,m]=o=[s,m+40];var f=[s,m+-17],s=(a?function(){var e=.24*y.PIN_DIST,t=4*e,s=1.2*e,i=10*e,r=y.PIN_DIST/4,[n,o]=f,a=v.svg.elt("g"),l=v.svg.elt("rect"),u=n-s/2,h=o+10-t/2,d=(v.svg.hydrate(l,{x:u,y:h,width:s,height:t,rx:.5,ry:.5,class:"sim-bb-wire-end"}),l.style["stroke-width"]=r+"px",v.svg.elt("rect")),o=o+10+-1*(t/2+i/2)-i/2;return v.svg.hydrate(d,{x:n-e/2,y:o,width:e,height:i,class:"sim-bb-wire-bare-end"}),d.style.fill="#bbb",a.appendChild(d),a.appendChild(l),{el:a,x:u-r,y:Math.min(h,o),w:s+2*r,h:t+i}}():b(f,!0)).el,m=v.svg.child(u,"g",{class:"sim-bb-wire-ends-g"}),g=(m.appendChild(t),this.closestEdgeIdx(n)),p=this.closestEdgeIdx(p);if(g==p){a=x(n,o,c);u.appendChild(a),l.push(a)}else{let e,t,s=h(n),i=x(n,s,c),r=(t=1!=g&&2!=g||1!=p&&2!=p?(e=x(s,o,c),x(s,o,c)):(e=w(s,o,.7,c),w(s,o,.7,c)),v.U.addClass(t,"sim-bb-wire-hover"),u.appendChild(i),l.push(i),this.underboard.appendChild(e),l.push(e),"sim-bb-wire-id-"+d);const a=e=>v.U.addClass(e,r);a(m),a(t),this.styleEl.textContent+=`
                    .${r}:hover ~ .${r}.sim-bb-wire-hover {
                        visibility: visible;
                    }`}m.appendChild(s);a=`
                .wire-stroke-${c} {
                    stroke: ${y.mapWireColor(e)};
                }
                .wire-fill-${c} {
                    fill: ${y.mapWireColor(e)};
                }
                `;return this.styleEl.textContent+=a,{endG:m,end1:t,end2:s,wires:l}}checkWire(e,t){e=this.getLocCoord(e),t=this.getLocCoord(t);return!!e&&!!t}addWire(e,t,s){var i,r=this.getLocCoord(e),n=this.getLocCoord(t);if(r&&n)return i=this.getPinStyle(t),"dalboard"==t.type&&"croc"==i?this.drawWireWithCrocs(r,n,s):this.drawWire(r,n,s);console.debug(`unable to allocate wire for ${e} or `+t)}}}}(pxsim=pxsim||{});