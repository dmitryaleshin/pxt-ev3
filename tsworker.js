const worker=(t,g,e)=>class extends t{constructor(t,e){super(t,e),this.weightCache={},this.service=g.createLanguageService(this)}async getCompletionsAtPosition(r,n){const o=await super.getCompletionsAtPosition(r,n);if(o){o.entries=o.entries.filter(t=>!t.name.startsWith("_"));const e=this.service.getProgram(),s=e.getSourceFile(r),a=s.getFullText();let t=n-1;for(;0<t&&g.isIdentifierPart(a.charCodeAt(n),g.ScriptTarget.ES5);)t--;if(0<(t="."!==a.charAt(t)?-1:t)){const r=findInnerMostNodeAtPosition(s,t-1,g),n=e.getTypeChecker(),a=n.getTypeAtLocation(r),c=(null==a?void 0:a.symbol)||n.getSymbolAtLocation(r);if(c){const r=n.getFullyQualifiedName(c);if(!this.weightCache[r]){this.weightCache[r]={};const n=[],o=(c.members&&n.push(c.members),c.exports&&n.push(c.exports),parseCommentString(getComments(c,g)));let t=[];if(o.groups)try{const r=JSON.parse(o.groups);Array.isArray(t)&&!t.some(t=>"string"!=typeof t)&&(t=r)}catch(r){}const s={},a={};for(const o of n)o.forEach(t=>{var e,n=parseCommentString(getComments(t,g));let o=0;"TD_ID"===n.shim?this.weightCache[r][t.name]="hidden":(n.weight&&(o=parseInt(n.weight)),(e=n.advanced||!n.block?s:a)[n=n.block?n.group||"*":"ts-only"]||(e[n]=[]),e[n].push([t.name,o]))});const e=["*"].concat(t);for(const r of Object.keys(s).concat(Object.keys(a)))-1===e.indexOf(r)&&e.push(r);var i=[];for(const r of e)a[r]&&i.push(...a[r].sort((t,e)=>e[1]-t[1]).map(t=>t[0]));for(const r of e)s[r]&&i.push(...s[r].sort((t,e)=>e[1]-t[1]).map(t=>t[0]));for(let t=0;t<i.length;t++)this.weightCache[r][i[t]]=weightToSortText(i.length-t)}o.entries=o.entries.filter(t=>"hidden"!==this.weightCache[r][t.name]);for(const g of o.entries){const n=this.weightCache[r][g.name]||weightToSortText(0);g.sortText=n+g.name}}}}return o}};function findInnerMostNodeAtPosition(t,e,n){for(var o of t.getChildren())if(!(o.kind>=n.SyntaxKind.FirstPunctuation&&o.kind<=n.SyntaxKind.LastPunctuation)){var r=o.getStart(),i=o.getEnd();if(r<=e&&e<i)return findInnerMostNodeAtPosition(o,e,n)}return t&&t.kind===n.SyntaxKind.SourceFile?null:t}function getComments(t,n){return t.getDeclarations()?t.getDeclarations().map(t=>{const e=t.getSourceFile();return e&&(t=n.getLeadingCommentRangesOfNode(t,e))?t.map(t=>e.text.slice(t.pos,t.end)).join("\n"):""}).join("\n"):""}function parseCommentString(t){const c={};if(t){let a=!0;for(;a;)a=!1,t=t.replace(/\/\/%[ \t]*([\w\.-]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,(t,e,n,o,r,i,s)=>{n=r?JSON.parse(r):n?r||i||s:"true";return c[e]=n,a=!0,"//% "})}return c}function weightToSortText(t){t="string"==typeof t?parseInt(t):t;let e=9999-t+"";for(;e.length<4;)e="0"+e;return e}self.customTSWorkerFactory=worker;