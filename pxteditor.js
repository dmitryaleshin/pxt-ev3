var pxt;!function(i){{var o=i.editor||(i.editor={}),n;let e,t,r,s;(n=e=o.SimState||(o.SimState={}))[n.Stopped=0]="Stopped",n[n.Pending=1]="Pending",n[n.Starting=2]="Starting",n[n.Running=3]="Running",o.isBlocks=function(e){return i.U.endsWith(e.name,".blocks")},(n=t=o.ErrorListState||(o.ErrorListState={})).HeaderOnly="errorListHeader",n.Expanded="errorListExpanded",(n=r=o.FilterState||(o.FilterState={}))[n.Hidden=0]="Hidden",n[n.Visible=1]="Visible",n[n.Disabled=2]="Disabled",o.initExtensionsAsync=e=>Promise.resolve({}),o.initFieldExtensionsAsync=e=>Promise.resolve({}),o.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",o.initEditorExtensionsAsync=function(){if(!s&&(s=Promise.resolve(),i.appTarget)&&i.appTarget.appTheme&&i.appTarget.appTheme.extendFieldEditors){const e={};s=s.then(()=>i.BrowserUtils.loadBlocklyAsync()).then(()=>i.BrowserUtils.loadScriptAsync("fieldeditors.js")).then(()=>i.editor.initFieldExtensionsAsync(e)).then(e=>{e.fieldEditors&&e.fieldEditors.forEach(e=>{i.blocks.registerFieldEditor(e.selector,e.editor,e.validator)})})}return s}}}(pxt=pxt||{}),function(n){{var e=n.editor||(n.editor={});const l={};function a(e,t,r,s){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:r,error:s},"*")}function o(s){return new Promise((e,t)=>{var r=n.Util.clone(s);r.id=ts.pxtc.Util.guidGen(),s.response&&(l[r.id]={resolve:e,reject:t}),window.parent.postMessage(r,"*"),s.response||e(void 0)})}e.bindEditorMessages=function(r){const t=(n.appTarget.appTheme.allowParentController||n.shell.isControllerMode())&&n.BrowserUtils.isIFrame(),s=n.appTarget.appTheme.allowPackageExtensions,o=n.appTarget.appTheme.allowSimulatorTelemetry;(t||s||o)&&window.addEventListener("message",e=>{const i=e.data;if(!i||!/^pxt(host|editor|pkgext|sim)$/.test(i.type))return!1;if("pxtpkgext"===i.type&&s)r().then(e=>{e.handleExtensionRequest(i)});else if("pxtsim"===i.type&&o){const r=i;"event"===r.action&&(r.category||r.message?n.reportError(r.category,r.message,r.data):n.tickEvent(r.tick,r.data))}else if(t){let t,e=Promise.resolve();if("pxthost"==i.type){const r=l[i.id];r?e=e.then(()=>r.resolve(i)):n.debug("pxthost: unknown request "+i.id)}else"pxteditor"==i.type&&(e=e.then(()=>r().then(r=>{const s=i;switch(n.debug("pxteditor: "+s.action),s.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then(()=>r.openJavaScript());case"switchpython":return Promise.resolve().then(()=>r.openPython());case"switchblocks":return Promise.resolve().then(()=>r.openBlocks());case"startsimulator":return Promise.resolve().then(()=>r.startSimulator());case"restartsimulator":return Promise.resolve().then(()=>r.restartSimulator());case"hidesimulator":return Promise.resolve().then(()=>r.collapseSimulator());case"showsimulator":return Promise.resolve().then(()=>r.expandSimulator());case"closeflyout":return Promise.resolve().then(()=>r.closeFlyout());case"unloadproject":return Promise.resolve().then(()=>r.unloadProjectAsync());case"saveproject":return r.saveProjectAsync();case"redo":return Promise.resolve().then(()=>{var e=r.editor;e&&e.hasRedo()&&e.redo()});case"undo":return Promise.resolve().then(()=>{var e=r.editor;e&&e.hasUndo()&&e.undo()});case"setscale":{const n=i;return Promise.resolve().then(()=>r.editor.setScale(n.scale))}case"stopsimulator":{const n=i;return Promise.resolve().then(()=>r.stopSimulator(n.unload))}case"newproject":{const n=i;return Promise.resolve().then(()=>r.newProject(n.options))}case"importproject":{const n=i;return Promise.resolve().then(()=>r.importProjectAsync(n.project,{filters:n.filters,searchBar:n.searchBar}))}case"openheader":{const n=i;return r.openProjectByHeaderIdAsync(n.headerId)}case"startactivity":{const s=i;let e,t=s.path;return/^([jt]s|py|blocks?):/i.test(t)&&(e=/^py:/i.test(t)?n.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(t)?n.JAVASCRIPT_PROJECT_NAME:n.BLOCKS_PROJECT_NAME,t=t.substr(t.indexOf(":")+1)),Promise.resolve().then(()=>r.startActivity({activity:s.activityType,path:t,title:s.title,editor:e,previousProjectHeaderId:s.previousProjectHeaderId,carryoverPreviousCode:s.carryoverPreviousCode}))}case"importtutorial":{const n=i;return Promise.resolve().then(()=>r.importTutorialAsync(n.markdown))}case"proxytosim":{const n=i;return Promise.resolve().then(()=>r.proxySimulatorMessage(n.content))}case"renderblocks":{const n=i;return Promise.resolve().then(()=>r.renderBlocksAsync(n)).then(e=>e.xml.then(e=>{t=e.xml}))}case"renderpython":{const n=i;return Promise.resolve().then(()=>r.renderPythonAsync(n)).then(e=>{t=e.python})}case"toggletrace":{const n=i;return Promise.resolve().then(()=>r.toggleTrace(n.intervalSpeed))}case"settracestate":{const n=i;return Promise.resolve().then(()=>r.setTrace(n.enabled,n.intervalSpeed))}case"setsimulatorfullscreen":{const n=i;return Promise.resolve().then(()=>r.setSimulatorFullScreen(n.enabled))}case"togglehighcontrast":return Promise.resolve().then(()=>r.toggleHighContrast());case"togglegreenscreen":return Promise.resolve().then(()=>r.toggleGreenScreen());case"print":return Promise.resolve().then(()=>r.printCode());case"pair":return r.pairAsync();case"info":return Promise.resolve().then(()=>{t={versions:n.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:n.appTarget.appTheme.availableLocales}});case"shareproject":{const n=i;return r.anonymousPublishHeaderByIdAsync(n.headerId).then(e=>{t=e})}case"savelocalprojectstocloud":{const n=i;return r.saveLocalProjectsToCloudAsync(n.headerIds).then(e=>{t={headerIdMap:e}})}case"requestprojectcloudstatus":{const n=i;return r.requestProjectCloudStatus(n.headerIds)}case"convertcloudprojectstolocal":{const n=i;return r.convertCloudProjectsToLocal(n.userId)}case"setlanguagerestriction":{const n=i;if("no-blocks"===n.restriction)throw console.warn("no-blocks language restriction is not supported"),new Error("no-blocks language restriction is not supported");return r.setLanguageRestrictionAsync(n.restriction)}}return Promise.resolve()})));e.then(()=>a(i,t,!0,void 0),e=>a(i,t,!1,e))}return!0},!1)},e.enableControllerAnalytics=function(){if(n.appTarget.appTheme.allowParentController&&n.BrowserUtils.isIFrame()){const r=n.tickEvent,s=(n.tickEvent=function(e,t){r&&r(e,t),o({type:"pxthost",action:"event",tick:e,response:!1,data:t})},n.reportException),i=(n.reportException=function(e,t){s&&s(e,t);try{o({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}},n.reportError);n.reportError=function(e,t,r){i&&i(e,t,r),o({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:r})}}},e.shouldPostHostMessages=function(){return n.appTarget.appTheme.allowParentController&&n.BrowserUtils.isIFrame()},e.postHostMessageAsync=o}}(pxt=pxt||{}),function(i){function r(e){return"experiments-"+("object"==typeof e?e.id:e)}function s(){const r=i.savedAppTheme(),s={},e=o();return e.forEach(e=>{var t=n(e);r[e.id]=!!t,t&&(s[e.id]=t?1:0)}),e.length&&Object.keys(s).length&&(i.tickEvent("experiments.loaded",s),i.reloadAppTargetVariant()),i.appTarget.appTheme}function o(){const t=i.appTarget.appTheme.experiments;return t?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419",enableOnline:!0},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release"),enableOnline:!0},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"accessibleBlocks",name:lf("Accessible Blocks"),description:lf("Use the WASD keys to move and modify blocks."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6850"},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")},{id:"blocksErrorList",name:lf("Blocks Error List"),description:lf("Show an error list panel for Blocks")}].filter(e=>-1<t.indexOf(e.id)&&!(i.BrowserUtils.isPxtElectron()&&e.enableOnline)):[]}function n(e){return!!i.storage.getLocal(r(e))}function t(e,t){t!=n(e)&&(t?i.storage.setLocal(r(e),"1"):i.storage.removeLocal(r(e)),s())}var e;(e=(e=i.editor||(i.editor={})).experiments||(e.experiments={})).syncTheme=s,e.all=o,e.clear=function(){o().forEach(e=>i.storage.removeLocal(r(e))),s()},e.someEnabled=function(){return o().some(e=>n(e))},e.isEnabled=n,e.toggle=function(e){t(e,!n(e))},e.state=function(){const t={};return o().forEach(e=>t[e.id]=n(e)),JSON.stringify(t)},e.setState=t}(pxt=pxt||{}),function(o){function n(e){var t=o.appTarget.appTheme.invertedMonaco,r=!(!o.appTarget.appTheme.monacoFieldEditors||!o.appTarget.appTheme.monacoFieldEditors.length),s=o.BrowserUtils.isAndroid(),e=monaco.editor.create(e,{model:null,ariaLabel:o.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:r,glyphMargin:r||o.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!s,comments:!s,strings:!s},acceptSuggestionOnCommitCharacter:!s,acceptSuggestionOnEnter:s?"off":"on",accessibilitySupport:s?"off":"on"});return e.layout(),e}var e;(e=o.vs||(o.vs={})).syncModels=function(t,i,o,e){if(!e){let e=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),s={};t.sortedDeps().forEach(r=>{r.getFiles().forEach(e=>{var t=r.id+"/"+e;/\.(ts)$/.test(e)&&t!=o&&(monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]||(e=r.readFile(e)||"\n",i[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(e,t)),s[t]="1")})}),Object.keys(e).filter(e=>/\.(ts)$/.test(e)&&!s[e]).forEach(e=>{i[e].dispose()})}},e.initMonacoAsync=function(i){return new Promise((r,e)=>{if("object"==typeof window.monaco)r(n(i));else{let t=window.MonacoPaths,e=()=>{var e=window.require;e.config({paths:t}),e(["vs/editor/editor.main"],()=>{monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript&&(monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setWorkerOptions({customWorkerPath:o.webConfig.typeScriptWorkerJs}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1})),r(n(i))})};var s;window.require?e():((s=document.createElement("script")).type="text/javascript",s.src=t["vs/loader"],s.addEventListener("load",e),document.body.appendChild(s))}})},e.createEditor=n}(pxt=pxt||{}),function(r){(r.workspace||(r.workspace={})).freshHeader=function(e,t){return{target:r.appTarget.id,targetVersion:r.appTarget.versions.target,name:e,meta:{},editor:r.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:r.U.guidGen(),recentUse:t,modificationTime:t,cloudUserId:null,cloudCurrent:!1,cloudVersion:null,cloudLastSyncTime:0,isDeleted:!1}}}(pxt=pxt||{}),function(e){{e=e.editor||(e.editor={});const r={};e.registerMonacoFieldEditor=function(e,t){r[e]=t},e.getMonacoFieldEditor=function(e){return r[e]}}}(pxt=pxt||{}),function(s){(s.editor||(s.editor={})).MonacoReactFieldEditor=class{getId(){return"image-editor"}showEditorAsync(e,t,r){return this.fileType=e,this.editrange=t,this.host=r,this.initAsync().then(()=>{var e=this.textToValue(r.getText(t));return e?(this.fv=s.react.getFieldEditorView(this.getFieldEditorId(),e,this.getOptions()),this.fv.onHide(()=>{this.onClosed()}),this.fv.show(),new Promise((e,t)=>{this.resolver=e,this.rejecter=t})):Promise.resolve(null)})}onClosed(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)}dispose(){this.onClosed()}initAsync(){return Promise.resolve()}textToValue(e){return null}resultToText(e){return e+""}getFieldEditorId(){return""}getOptions(){return null}}}(pxt=pxt||{}),function(o){{var e=o.editor||(o.editor={}),t="image-editor";class r extends e.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`");var t=o.parseAssetTSReference(e);if(t){const{type:e,name:r}=t,s=r.trim(),i=o.react.getTilemapProject();this.isAsset=!0;t=i.lookupAssetByName("image",s);if(t)return t;{const e=i.createNewImage();return s&&!i.isNameTaken("image",s)&&o.validateAssetName(s)&&(e.meta.displayName=s),e}}return{type:"image",id:"",internalID:0,bitmap:o.sprite.imageLiteralToBitmap(e).data(),meta:{},jresData:""}}resultToText(e){var t;if(null!=(t=e.meta)&&t.displayName){const t=o.react.getTilemapProject();return e=this.isAsset||t.lookupAsset(e.type,e.id)?t.updateAsset(e):t.createNewProjectImage(e.bitmap,e.meta.displayName),this.isAsset=!0,o.getTSReferenceForAsset(e,this.isPython)}return o.sprite.bitmapToImageLiteral(o.sprite.Bitmap.fromData(e.bitmap),this.isPython?"python":"typescript")}getFieldEditorId(){return"image-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}}e.MonacoSpriteEditor=r,e.spriteEditorDefinition={id:t,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:img|assets\\s*\\.\\s*image)\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:r},e.registerMonacoFieldEditor(t,e.spriteEditorDefinition)}}(pxt=pxt||{}),function(i){{var e=i.editor||(i.editor={}),t="tilemap-editor";class r extends e.MonacoReactFieldEditor{textToValue(e){var e=this.readTilemap(e),t=i.react.getTilemapProject();return i.sprite.addMissingTilemapTilesAndReferences(t,e),e}readTilemap(t){var r=i.react.getTilemapProject();if(/^\s*tiles\s*\./.test(t)&&(this.isTilemapLiteral=!1,t)){try{return{type:"tilemap",id:"",internalID:0,meta:{},data:i.sprite.decodeTilemap(t,"typescript",r)}}catch(e){}return null}this.isTilemapLiteral=!0;var t=/^\s*(tilemap(?:8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(t),e=(t[2]||t[3]||"").trim();let s;if(this.tilemapLiteral=t[1],e&&(t=ts.pxtc.escapeIdentifier(e),s=r.getTilemap(t)),!s){let e=16;"tilemap8"===this.tilemapLiteral?e=8:"tilemap32"===this.tilemapLiteral&&(e=32);const[t]=r.createNewTilemap(void 0,e,16,16);s=r.getTilemap(t),t}return s}resultToText(e){var t=i.react.getTilemapProject();return t.pushUndo(),i.sprite.updateTilemapReferencesFromResult(t,e),this.isTilemapLiteral?(t.updateAsset(e),i.getTSReferenceForAsset(e,"python"===this.fileType)):i.sprite.encodeTilemap(e.data,"typescript"===this.fileType?"typescript":"python")}getFieldEditorId(){return"tilemap-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}getCreateTilemapRange(){var t=this.editrange.getStartPosition();let e,r=this.editrange.getEndPosition(),s=1;for(;;){e=new monaco.Range(r.lineNumber,r.column,r.lineNumber+1,0);var i=this.host.getText(e);for(let e=0;e<i.length;e++)if("("===i.charAt(e))s++;else if(")"===i.charAt(e)&&0===--s){const s=new monaco.Position(r.lineNumber,r.column+e+2);return monaco.Range.fromPositions(t,s)}if((r=e.getEndPosition()).lineNumber>t.lineNumber+20)return null}}}e.MonacoTilemapEditor=r,e.tilemapEditorDefinition={id:t,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:r},e.registerMonacoFieldEditor(t,e.tilemapEditorDefinition)}}(pxt=pxt||{});