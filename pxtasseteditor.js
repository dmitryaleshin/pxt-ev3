!function n(r,o,a){function s(t,e){if(!o[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};r[t][0].call(i.exports,function(e){return s(r[t][1][e]||e)},i,i.exports,n,r,o,a)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HomeAccessibilityMenu=i.EditorAccessibilityMenu=void 0;const n=e("react"),r=e("./auth"),o=e("./data"),a=e("./sui");class s extends o.Component{constructor(e){super(e),this.state={},this.openJavaScript=this.openJavaScript.bind(this),this.openPython=this.openPython.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.goHome=this.goHome.bind(this)}openJavaScript(){pxt.tickEvent("accmenu.editor.openJS",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()}openPython(){pxt.tickEvent("accmenu.editor.openPY",void 0,{interactiveConsent:!0}),this.props.parent.openPython()}showLanguagePicker(){pxt.tickEvent("accmenu.editor.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.editor.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}goHome(){pxt.tickEvent("accmenu.editor.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}UNSAFE_componentWillReceiveProps(e){var t={};null!=e.highContrast&&(t.highContrast=e.highContrast),0<Object.keys(t).length&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.highContrast!=t.highContrast}renderCore(){var e=this.getData(r.HIGHCONTRAST),t=pxt.appTarget.appTheme,i=!pxt.shell.isControllerMode();return n.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon js",text:lf("Skip to JavaScript editor"),onClick:this.openJavaScript}),t.python?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon python",text:lf("Skip to Python editor"),onClick:this.openPython}):void 0,t.selectLanguage?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,i?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"home",text:lf("Go Home"),onClick:this.goHome}):void 0)}}i.EditorAccessibilityMenu=s;class l extends o.Component{constructor(e){super(e),this.state={},this.newProject=this.newProject.bind(this),this.importProjectDialog=this.importProjectDialog.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this)}newProject(){pxt.tickEvent("accmenu.home.new",void 0,{interactiveConsent:!0}),this.props.parent.newProject()}importProjectDialog(){pxt.tickEvent("accmenu.home.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showLanguagePicker(){pxt.tickEvent("accmenu.home.langpicker"),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}UNSAFE_componentWillReceiveProps(e){var t={};null!=e.highContrast&&(t.highContrast=e.highContrast),0<Object.keys(t).length&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.highContrast!=t.highContrast}renderCore(){var e=this.state["highContrast"],t=pxt.appTarget.appTheme;return n.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"add circle",text:lf("New Project"),onClick:this.newProject}),n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"upload",text:lf("Import Project"),onClick:this.importProjectDialog}),t.selectLanguage?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?n.createElement(a.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0)}}i.HomeAccessibilityMenu=l},{"./auth":8,"./data":67,"./sui":129,react:320}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibleBlocksInfo=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class a extends r.Component{constructor(e){super(e),this.state={shown:!1},this.handleOnClose=this.handleOnClose.bind(this)}handleOnClose(){this.setState({shown:!0})}render(){return this.state.shown?n.createElement("div",null):n.createElement(o.Modal,{isOpen:!this.state.shown,onClose:this.handleOnClose,closeIcon:!0,dimmer:!0,header:lf("Move, edit, and insert blocks using your keyboard")},n.createElement("div",{className:"ui equal width grid"},n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Navigate")),n.createElement("span",{className:"ui small"},lf("Use the WASD keys to move between blocks. Hold shift to move on the workspace."))),n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Modify")),n.createElement("span",{className:"ui small"},lf("Press Enter to 'mark' a block, then X to disconnect, I to reconnect."))),n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Insert")),n.createElement("span",{className:"ui small"},lf("Use T to open the toolbox. Inside the toolbox, use WASD to navigate, and Enter to insert.")))),n.createElement("div",{className:"ui grid"},n.createElement("strong",null,n.createElement("a",{href:"https://developers.google.com/blockly/guides/configure/web/keyboard-nav"},lf("See the official Blockly Documentation for additional detail")))))}}i.AccessibleBlocksInfo=a},{"./data":67,"./sui":129,react:320}],3:[function(o,t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ksVersion=e.ProjectView=e.getBlocksEditor=e.getEditorAsync=e.hasEditor=void 0;const H=o("react"),E=o("react-dom"),m=o("./workspace"),s=o("./cloudsync"),a=o("./data"),q=o("./package"),g=o("./core"),z=o("./sui"),p=o("./simulator"),u=o("./compiler"),G=o("./cmds"),C=o("./appcache"),r=o("./screenshot"),_=o("./hidbridge"),te=o("./share"),V=o("./lang"),W=o("./accessibility"),$=o("./tutorial"),ie=o("./sidebarTutorial"),ne=o("./editortoolbar"),l=o("./dialogs"),re=o("./identity"),K=o("./container"),oe=o("./scriptsearch"),J=o("./projects"),ae=o("./scriptmanager"),se=o("./extensions"),S=o("./sounds"),T=o("./make"),c=o("./blocksSnippets"),h=o("./monacoSnippets"),le=o("./greenscreen"),ce=o("./accessibleblocks"),A=o("./socketbridge"),Y=o("./auth"),f=o("./cloud"),de=o("./user"),X=o("./headerbar"),ue=o("./sidepanel"),i=o("./monaco"),N=o("./pxtjson"),n=o("./serial"),d=o("./blocks"),I=o("./gitjson"),O=o("./components/assetEditor/editor"),P=o("./draganddrop"),pe=o("./notification"),D=o("./electron"),L=o("./blocklyFieldView");var b=pxt.Cloud,v=pxt.Util;const R=o("./hinttooltip"),M=o("./mergeProjects");let Q,y,Z;function w(){return Q?Promise.resolve(Q):(Z=Z||[],new Promise(e=>{Z.push(e)}))}pxsim.util.injectPolyphils(),e.hasEditor=function(){return!!Q},e.getEditorAsync=w,e.getBlocksEditor=function(){return Q?Q.blocksEditor:null};class ee extends Y.Component{constructor(e){super(e),this.allEditors=[],this.screenshotHandlers=[],this.highContrastSubscriber={subscriptions:[],onDataChanged:()=>{this.onHighContrastChanged()}},this.cloudStatusSubscriber={subscriptions:[],onDataChanged:e=>this.onCloudStatusChanged(e)},this.autoRunSimulatorDebounced=pxtc.Util.debounce(()=>{v.now()-this.lastChangeTime<1e3?pxt.debug("sim: skip auto, debounced"):this.state.active?this.blocksEditor&&this.blocksEditor.isDropdownDivVisible()?pxt.debug("sim: skip blocks auto, field editor is open"):this.editor!==this.serialEditor?this.state.debugging||this.state.tracing?pxt.debug("sim: don't restart when debugging or tracing"):this.state.collapseEditorTools?pxt.debug("sim: don't restart when simulator collapsed"):!pxt.BrowserUtils.isSkillmapEditor()||this.state.header?this.runSimulator({debug:!!this.state.debugging,background:!0}):pxt.debug("sim: don't restart when no project is open"):pxt.debug("sim: don't restart when entering console view"):pxt.debug("sim: skip blocks auto, !active")},1e3,!0),this._slowTypeCheck=0,this.typecheckDebouncer=new pxtc.Util.AdaptiveDebouncer(()=>{if(!this.editor.isIncomplete()){const i=v.now(),n=(this.saveFileAsync(),this.editor.snapshotState());u.typecheckAsync().then(e=>{var t=v.now();if(!pxt.options.light&&1e4<t-i&&1<this._slowTypeCheck++&&(pxt.tickEvent("light.typecheck"),pxt.options.light=!0),pxt.tickEvent("typecheck.complete",{editor:this.getPreferredEditor()}),this.editor.setDiagnostics(this.editorFile,n),a.invalidate("open-pkg-meta:"+q.mainEditorPkg().getPkgId()),this.state.autoRun){const i=q.mainEditorPkg().outputPkg.files["output.txt"];i&&!i.numDiagnosticsOverride&&this.state.autoRun&&this.autoRunSimulatorDebounced()}this.maybeShowPackageErrors()})}}),this.markdownChangeHandler=v.debounce(()=>{this.state.currFile&&/\.md$/i.test(this.state.currFile.name)&&this.setSideMarkdown(this.editor.getCurrentSource())},3e3,!1),this.editorChangeHandler=v.debounce(()=>{this.editor.isIncomplete()||(this.saveFileAsync(),this.typecheck(),this.isTutorial()&&pxt.appTarget.appTheme.tutorialCodeValidation&&this.editor.validateTutorialCode(this.state.tutorialOptions)),this.markdownChangeHandler()},500,!1),this.hexFileImporters=[{id:"default",canImport:e=>e.meta.cloudId=="ks/"+pxt.appTarget.id||e.meta.cloudId==pxt.CLOUD_ID+pxt.appTarget.id||v.startsWith(e.meta.cloudId,pxt.CLOUD_ID+pxt.appTarget.id),importAsync:(e,t)=>{var i={target:pxt.appTarget.id,targetVersion:t.meta.targetVersions?t.meta.targetVersions.target:void 0,editor:t.meta.editor,name:t.meta.name,meta:{},pubId:"",pubCurrent:!1},t=JSON.parse(t.source);return m.installAsync(i,t).then(e=>this.loadHeaderAsync(e,null))}}],this.resourceImporters=[new n.ResourceImporter],this.checkWebUSBVariant=!0,this.closeOnEscape=e=>{g.keyCodeFromEvent(e)===g.ESC_KEY&&(e.preventDefault(),this.toggleSimulatorFullscreen())},this.hintManager=new R.HintManager,this.handleScriptManagerDialogClose=()=>{this.home.forceUpdate(),m.syncAsync()},this.handleHomeRef=e=>{this.home=e},this.handleScriptSearchRef=e=>{this.scriptSearch=e},this.handleExtensionRef=e=>{this.extensions=e},this.handleScriptManagerDialogRef=e=>{this.scriptManagerDialog=e},this.handleImportDialogRef=e=>{this.importDialog=e},this.handleExitAndSaveDialogRef=e=>{this.exitAndSaveDialog=e},this.handleNewProjectDialogRef=e=>{this.newProjectDialog=e},this.handleShareEditorRef=e=>{this.shareEditor=e},this.handleLanguagePickerRef=e=>{this.languagePicker=e},this.handleChooseHwDialogRef=e=>{this.chooseHwDialog=e},this.handleLoginDialogRef=e=>{this.loginDialog=e},this.handleProfileDialogRef=e=>{this.profileDialog=e},document.title=pxt.appTarget.title||pxt.appTarget.name,this.reload=!1,this.settings=JSON.parse(pxt.storage.getLocal("editorSettings")||"{}");var e=this.shouldShowHomeScreen(),t=((/hc=(\w+)/.test(window.location.href)||null!=(t=null==(t=window.matchMedia)?void 0:t.call(window,"(forced-colors: active)"))&&t.matches)&&g.setHighContrast(!0),pxt.appTarget.simulator);this.state={showFiles:!1,home:e,active:"visible"==document.visibilityState||pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility,collapseEditorTools:t.headless,simState:pxt.editor.SimState.Stopped,autoRun:this.autoRunOnStart()},this.settings.editorFontSize||(this.settings.editorFontSize=/mobile/i.test(navigator.userAgent)?15:19),this.settings.fileHistory||(this.settings.fileHistory=[]),e&&this.homeLoaded(),this.hwDebug=this.hwDebug.bind(this),this.hideLightbox=this.hideLightbox.bind(this),this.openSimSerial=this.openSimSerial.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.openSerial=this.openSerial.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.showKeymap=this.showKeymap.bind(this),this.toggleKeymap=this.toggleKeymap.bind(this),this.showMiniSim=this.showMiniSim.bind(this),this.setTutorialStep=this.setTutorialStep.bind(this),this.completeTutorialAsync=this.completeTutorialAsync.bind(this),this.exitTutorial=this.exitTutorial.bind(this),this.setEditorOffset=this.setEditorOffset.bind(this),this.initSimulatorMessageHandlers(),pxt.BrowserUtils.useOldTutorialLayout&&this.hintManager.addHint(ee.tutorialCardId,this.tutorialCardHintCallback.bind(this))}autoRunOnStart(){return pxt.appTarget.simulator&&((pxt.options.light?!!pxt.appTarget.simulator.autoRunLight:!!pxt.appTarget.simulator.autoRun)||!!pxt.appTarget.simulator.emptyRunCode)}initSimulatorMessageHandlers(){window.addEventListener("message",e=>{let t=e.data;if(t&&this.state.header)if("addextensions"===t.type){const e=t.extensions;this.addOrUpdateGithubExtensions(e)}else if("screenshot"===t.type){const e=t;if(e.data){var i=this.screenshotHandlers[this.screenshotHandlers.length-1];if(i)i(e);else{const t=pxt.BrowserUtils.imageDataToPNG(e.data);pxt.appTarget.compile.saveAsPNG&&this.encodeProjectAsPNGAsync(t,!1),r.saveAsync(this.state.header,t).then(()=>{pxt.debug("screenshot saved")})}}}else if("recorder"===t.type){const e=t,n=this.screenshotHandlers[this.screenshotHandlers.length-1];n&&n({event:e.action})}},!1)}async addOrUpdateGithubExtensions(e){pxt.tickEvent("package.addextensions");const t=q.mainEditorPkg(),i=await pxt.packagesConfigAsync(),n=null==e?void 0:e.map(e=>pxt.github.parseRepoId(e)).filter(e=>!!e).filter(e=>pxt.github.repoStatus(e,i)!==pxt.github.GitRepoStatus.Banned);if(t&&null!=n&&n.length){var r=n.filter(e=>pxt.github.repoStatus(e,i)!==pxt.github.GitRepoStatus.Approved);if(!r.length||await g.confirmAsync({header:lf("Add extensions?"),jsx:H.createElement(H.Fragment,null,H.createElement("p",null,lf("Add or update these user-provided extensions to your project?")),H.createElement("ul",null,r.map(e=>H.createElement("li",{key:e.fullName},H.createElement("a",{href:"/pkg/"+e.fullName},e.fullName)))),H.createElement("hr",null),H.createElement("p",null,lf("User-provided extension are not endorsed by Microsoft.")))})){pxt.debug("adding extensions "+e);try{g.showLoading("addextensions",lf("adding extensions..."));for(const e of n){pxt.debug("adding "+e.fullName);const{config:i,version:H}=await pxt.github.downloadLatestPackageAsync(e);await t.setDependencyAsync(i.name,H)}this.reloadHeaderAsync()}catch(e){g.handleNetworkError(e)}finally{g.hideLoading("addextensions")}}}}shouldShowHomeScreen(){var e=k(),t=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),i=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode()||/^#editor/.test(window.location.hash);return!t&&!i&&!F(e)}async updateVisibilityAsync(){if(!(pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility)){let e="visible"==document.visibilityState;if(pxt.debug("page visibility: "+e),this.setState({active:e}),a.invalidate("pkg-git-pull-status"),a.invalidate("pkg-git-pr"),a.invalidate("pkg-git-pages"),e||null!=(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)&&t.controller||G.disconnectAsync(),!e&&this.state.autoRun)p.driver.state==pxsim.SimulatorState.Running&&(this.suspendSimulator(),this.setState({resumeOnVisibility:!0})),this.saveFileAsync();else if(e){a.invalidate("header:*");var t=this.state.header?this.state.header.id:"";const e=!this.state.home&&t;!e&&m.isHeadersSessionOutdated()||m.isHeaderSessionOutdated(this.state.header)?(pxt.debug("workspace: changed, reloading..."),await m.syncAsync(),e&&await this.loadHeaderAsync(m.getHeader(t),this.state.editorState)):this.state.resumeOnVisibility?(this.setState({resumeOnVisibility:!1}),this.runSimulator(),G.maybeReconnectAsync(!1,!0)):this.state.home||G.maybeReconnectAsync(!1,!0)}}}saveSettings(){var e;this.reload||((e=this.editorFile)&&e.epkg.getTopHeader()&&this.editor.hasHistory()&&this.pushFileHistory(e.epkg.getTopHeader().id,e.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings)))}pushFileHistory(e,t,i){var n=this.settings;let r={id:e,name:t,pos:i};for(n.fileHistory=n.fileHistory.filter(e=>e.id!=r.id||e.name!=r.name);100<n.fileHistory.length;)n.fileHistory.pop();n.fileHistory.unshift(r)}popFileHistory(){this.settings.fileHistory.shift()}openProjectInLegacyEditor(t){if(!this.editorFile||!this.editorFile.epkg||!this.editorFile.epkg.getTopHeader())return Promise.resolve();const i=this.editorFile.epkg.getTopHeader();return pxt.tickEvent("update.openLegacyEditor",{version:i.targetVersion}),m.copyProjectToLegacyEditor(i,t).then(e=>{this.pushFileHistory(e.id,this.editorFile.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings));e=pxt.appTarget.appTheme;if(e&&e.editorVersionPaths&&e.editorVersionPaths[t]){const i=e.editorVersionPaths[t];window.location.href=pxt.Util.pathJoin(window.location.origin,i+"#editor")}else window.location.href=pxt.Util.pathJoin(window.location.origin,"v"+i.targetVersion+"#editor")}).catch(e=>{g.warningNotification(lf("Importing to older editor version only supported in web browsers"))})}async componentDidUpdate(e,t){this.saveSettings(),this.editor.domUpdate(),p.setState(this.state.header?this.state.header.editor:"",this.state.tutorialOptions&&!!this.state.tutorialOptions.tutorial),this.editor.resize();let i=Promise.resolve();this.editor&&this.editor.isReady&&(i=i.then(()=>this.updateEditorFileAsync())),this.editor&&(i=i.then(()=>{this.editor.updateBreakpoints(),this.editor.updateToolbox()}))}fireResize(){var e;document.createEvent?((e=document.createEvent("Event")).initEvent("resize",!0,!0),window.dispatchEvent(e)):document.fireEvent("onresize")}updateEditorLogo(e,t){if(pxt.appTarget.appTheme.hideMenuBar){var i=document.getElementById("editorlogo");if(i)return i.style.left=e+"px",i.style.display="block",i.style.background=t||"",i.offsetHeight}return 0}saveFileAsync(){return!this.editorFile||this.loadingExample?Promise.resolve():this.saveTypeScriptAsync().then(()=>this.saveCurrentSourceAsync())}saveProjectAsync(){return this.saveFileAsync().then(()=>q.mainEditorPkg().buildAssetsAsync()).then(()=>this.state.header&&m.saveAsync(this.state.header))}saveCurrentSourceAsync(){var e=this.editor.getCurrentSource();return e!=this.editorFile.content&&p.setDirty(),this.editor.isIncomplete()?Promise.resolve():this.editorFile.setContentAsync(e)}isEmbedSimActive(){return this.state.embedSimView}isBlocksActive(){return!this.state.embedSimView&&this.editor==this.blocksEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_BLOCKS}isJavaScriptActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_TS}isPythonActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_PY}isAssetsActive(){return!this.state.embedSimView&&this.editor==this.assetEditor&&this.editorFile&&this.editorFile.name==pxt.ASSETS_FILE}isAnyEditeableJavaScriptOrPackageActive(){return this.editor==this.textEditor&&this.editorFile&&!this.editorFile.isReadonly()&&/(\.ts|pxt.json)$/.test(this.editorFile.name)}openPython(e=!0){if(!this.updatingEditorFile)if(this.setState({tracing:!1}),this.isPythonActive())this.state.embedSimView&&this.setState({embedSimView:!1}),e&&this.textEditor.editor.focus();else if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openPython();else if(this.isJavaScriptActive())this.openPythonAsync();else{const e=q.mainEditorPkg().files[pxt.MAIN_PY];e?this.setFile(e):this.updateFileAsync(pxt.MAIN_PY,"# ...",!1)}}openJavaScript(t=!0){if(!this.updatingEditorFile)if(this.isJavaScriptActive())this.state.embedSimView&&this.setState({embedSimView:!1}),t&&this.textEditor.editor.focus();else{if(this.textEditor&&(this.textEditor.giveFocusOnLoading=t),this.isBlocksActive())this.blocksEditor.openTypeScript();else if(this.isPythonActive())this.openTypeScriptAsync();else{const t=q.mainEditorPkg().files;let e=t[pxt.MAIN_TS];e=e||t[Object.keys(t).find(e=>/\.ts$/.test(e))],this.setFile(e)}pxt.shell.setEditorLanguagePref("js")}}openBlocks(){var e,t;this.updatingEditorFile||(this.isBlocksActive()?this.state.embedSimView&&this.setState({embedSimView:!1}):(e=q.mainEditorPkg().files[pxt.MAIN_BLOCKS],this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView?this.textEditor.openBlocks():this.isAnyEditeableJavaScriptOrPackageActive()||!e.content?this.saveFileAsync().then(()=>this.textEditor.openBlocks()):(t=this.state.header)&&t.editor!==pxt.BLOCKS_PROJECT_NAME?this.textEditor.openBlocks():this.setFile(e),this.shouldTryDecompile=!1))}async openBlocksAsync(){if(!this.updatingEditorFile)if(this.isBlocksActive())this.state.embedSimView&&this.setState({embedSimView:!1});else{const t=q.mainEditorPkg();t.files[pxt.MAIN_BLOCKS]||t.setContentAsync(pxt.MAIN_BLOCKS,"");var e=t.files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)await this.textEditor.openBlocksAsync();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!e.content)await this.saveFileAsync(),await this.textEditor.openBlocksAsync();else{const t=this.state.header;t&&t.editor!==pxt.BLOCKS_PROJECT_NAME?await this.textEditor.openBlocksAsync():this.setFile(e)}this.shouldTryDecompile=!1}}openAssets(){var e=q.mainEditorPkg();e&&(e.lookupFile("this/"+pxt.ASSETS_FILE)||e.setFile(pxt.ASSETS_FILE,"\n",!0),this.saveFileAsync().then(()=>this.setFile(q.mainEditorPkg().lookupFile("this/"+pxt.ASSETS_FILE))))}openSettings(){this.setFile(q.mainEditorPkg().lookupFile("this/pxt.json"))}openSimSerial(){this.openSerial(!0)}openDeviceSerial(){this.openSerial(!1)}openSerial(e){var t;pxt.appTarget.serial&&pxt.appTarget.serial.useEditor&&(this.editor==this.serialEditor&&this.serialEditor.isSim==e||(t=q.mainEditorPkg())&&(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE)||t.setFile(pxt.SERIAL_EDITOR_FILE,"serial\n",!0),this.serialEditor.setSim(e),pxt.tickEvent("serial."+(e?"simulator":"device")+"EditorOpened"),this.setFile(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE))))}openPreviousEditor(){this.preserveUndoStack=!0;const t=this.state.header.id,e=this.settings.fileHistory[0];this.editorFile&&e.id==t&&e.name==this.editorFile.getName()&&this.popFileHistory();var i=this.settings.fileHistory.find(e=>e.id==t);if(i){const t=q.mainEditorPkg().lookupFile(i.name);if(t)return void this.setSideFile(t)}i=!!q.mainEditorPkg().files[pxt.MAIN_BLOCKS];"monacoEditor"!=this.prevEditorId&&i?this.openBlocks():this.openJavaScript(!1)}openTypeScriptAsync(){return this.saveTypeScriptAsync(!0)}openPythonAsync(){const t=q.mainEditorPkg().files[pxt.MAIN_PY];if(t){const i=q.mainEditorPkg().files[pxt.MAIN_TS].content;return this.textEditor.convertPythonToTypeScriptAsync().then(e=>e==i?(pxt.debug("ts -> py shortcut"),this.setFile(t),Promise.resolve()):this.convertTypeScriptToPythonAsync())}return this.convertTypeScriptToPythonAsync()}convertTypeScriptToPythonAsync(){this.editor.snapshotState();const t=this.isBlocksActive()?"blocks":"ts",i=this.editorFile.content,n=q.mainEditorPkg();var e=n.getCachedTranspile(t,i,"py"),r=(e=e?this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,e,!0):this.saveTypeScriptAsync(!1).then(()=>u.pyDecompileAsync(pxt.MAIN_TS)).then(e=>{if(e&&e.success)return e=e.outfiles[pxt.MAIN_PY],n.cacheTranspile(t,i,"py",e),this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,e,!0);{const t=new Error("Failed to convert to Python.");return pxt.reportException(t),Promise.reject(t)}}).then(()=>(pxt.shell.setEditorLanguagePref("py"),Promise.resolve()))).then(()=>{},e=>g.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to Python."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then(()=>{}));return g.showLoadingAsync("switchtopython",lf("switching to Python..."),e),r}openSimView(){this.state.embedSimView?this.startStopSimulator():(this.setState({embedSimView:!0}),this.startSimulator())}shouldPreserveUndoStack(){return this.preserveUndoStack}typecheckNow(){this.saveFileAsync(),this.typecheck()}showPackageErrorsOnNextTypecheck(){this.setState({suppressPackageWarning:!1})}maybeShowPackageErrors(t=!1){if(pxt.perf.measureStart("maybeShowPackageErrors"),this.state.currFile){const t=this.state.currFile;if(!pxt.editor.isBlocks(t)&&t.name!==pxt.MAIN_TS)return!1}if(!this.state.suppressPackageWarning||t){this.setState({suppressPackageWarning:!0});var i=u.getPackagesWithErrors();if(i.length){const n=this.state.header,r=pxt.semver.parse(pxt.appTarget.versions.target),o=pxt.semver.parse(n.targetVersion);let e;return m.isBrowserWorkspace()&&r.major!==o.major&&(e=()=>{this.openProjectInLegacyEditor(o.major)}),l.showPackageErrorDialogAsync(i,u.updatePackagesAsync,e).then(e=>{e?this.reloadHeaderAsync():t||this.openHome()}),pxt.perf.measureEnd("maybeShowPackageErrors"),!0}}return pxt.perf.measureEnd("maybeShowPackageErrors"),!1}typecheck(){this.typecheckDebouncer.trigger()}initEditors(){this.textEditor=new i.Editor(this),this.pxtJsonEditor=new N.Editor(this),this.serialEditor=new n.Editor(this),this.blocksEditor=new d.Editor(this),this.gitjsonEditor=new I.Editor(this),this.assetEditor=new O.AssetEditor(this);let t=()=>{this.editorFile&&(this.editorFile.inSyncWithEditor&&pxt.tickEvent("activity.edit",{editor:this.editor.getId().replace(/Editor$/,"")},{interactiveConsent:!0}),this.editorFile.markDirty()),this.lastChangeTime=v.now(),this.state.simState!=pxt.editor.SimState.Stopped&&pxt.appTarget.simulator&&pxt.appTarget.simulator.stopOnChange&&this.stopSimulator(),this.editor.isIncomplete()||(this.editor==this.textEditor&&this.typecheckDebouncer.poke(),this.editorChangeHandler())};this.allEditors=[this.pxtJsonEditor,this.gitjsonEditor,this.blocksEditor,this.serialEditor,this.assetEditor,this.textEditor],this.allEditors.forEach(e=>e.changeCallback=t),this.editor=this.allEditors[this.allEditors.length-1]}UNSAFE_componentWillMount(){this.initEditors(),this.initDragAndDrop()}componentDidMount(){this.allEditors.forEach(e=>e.prepare()),p.init(document.getElementById("boardview"),{orphanException:e=>{var t;null!=(t=this.editor)&&t.onExceptionDetected(e)},highlightStatement:(e,t)=>{if(this.state.debugging&&!p.driver.areBreakpointsSet()&&t&&!t.exceptionMessage){let e;if(this.isAnyEditeableJavaScriptOrPackageActive()||this.isPythonActive()?e=this.textEditor.getBreakpoints():this.isBlocksActive()&&(e=this.blocksEditor.getBreakpoints()),e=e||[],p.driver.setBreakpoints(e),-1===e.indexOf(t.breakpointId))return this.state.debugFirstRun?(this.dbgStepInto(),this.setState({debugFirstRun:!1})):this.dbgPauseResume(),!0}return!!this.editor&&this.editor.highlightStatement(e,t)},restartSimulator:()=>this.restartSimulator(),onStateChanged:e=>{var t=()=>this.allEditors.forEach(e=>e.simStateChanged());switch(e){case pxsim.SimulatorState.Paused:case pxsim.SimulatorState.Unloaded:case pxsim.SimulatorState.Suspended:case pxsim.SimulatorState.Pending:case pxsim.SimulatorState.Stopped:this.setState({simState:pxt.editor.SimState.Stopped},t);break;case pxsim.SimulatorState.Running:this.setState({simState:pxt.editor.SimState.Running},t)}},onSimulatorReady:()=>{},setState:(e,t)=>{q.mainEditorPkg().setSimState(e,t)},editor:this.state.header?this.state.header.editor:""}),this.forceUpdate(),this.loadBlocklyAsync(),a.subscribe(this.highContrastSubscriber,Y.HIGHCONTRAST),a.subscribe(this.cloudStatusSubscriber,f.HEADER_CLOUDSTATE+":*")}componentWillUnmount(){a.unsubscribe(this.highContrastSubscriber),a.unsubscribe(this.cloudStatusSubscriber)}componentDidCatch(e,t){this.handleCriticalError(e,t)}handleCriticalError(e,t){try{g.killLoadingQueue(),pxsim.U.remove(document.getElementById("loading")),this.setState({hasError:!0}),pxt.tickEvent("pxt.criticalerror",{error:e||"",info:t||""});var i=pxt.storage.getLocal("lastcriticalerror")&&Date.parse(pxt.storage.getLocal("lastcriticalerror"));(!i||isNaN(i)||6e4<Date.now()-i)&&(pxt.storage.setLocal("lastcriticalerror",(new Date).toISOString()),setTimeout(()=>{this.reloadEditor()},2e3))}catch(e){}}pickEditorFor(t){return this.allEditors.filter(e=>e.acceptsFile(t))[0]}updateEditorFileAsync(t=null){if(this.state.active&&!this.updatingEditorFile&&(this.state.currFile!=this.editorFile||t)){let e=!1;return this.updatingEditorFile=!0,g.showLoadingAsync("updateeditorfile",lf("loading editor..."),Promise.resolve()).then(()=>(e=this.state.simState!=pxt.editor.SimState.Stopped,!this.state.currFile.virtual&&!this.state.debugging&&(this.stopSimulator(),e||this.state.autoRun)&&(p.setPending(),this.setState({simState:pxt.editor.SimState.Pending})),this.saveSettings(),this.openingTypeScript?Promise.resolve():this.saveFileAsync())).then(()=>{this.editorFile=this.state.currFile;var e=this.editor;return this.prevEditorId=e.getId(),this.editor=t||this.pickEditorFor(this.editorFile),this.allEditors.forEach(e=>e.setVisible(e==this.editor)),e?e.unloadFileAsync():Promise.resolve()}).then(()=>{var e=this.getData(Y.HIGHCONTRAST);return this.editor.loadFileAsync(this.editorFile,e)}).then(()=>{var e;this.saveFileAsync(),this.editor!=this.textEditor&&this.editor!=this.blocksEditor||this.typecheck(),this.state.editorPosition?(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0})):(e=this.settings.fileHistory.find(e=>e.id==this.state.header.id&&e.name==this.editorFile.getName()))&&this.editor.setViewState(e.pos),K.SideDocs.notify({type:"fileloaded",name:this.editorFile.getName(),locale:pxt.Util.localeInfo()}),this.state.showBlocks&&this.editor==this.textEditor&&this.textEditor.openBlocks()}).finally(()=>{this.updatingEditorFile=!1,this.preserveUndoStack=!1,this.isJavaScriptActive()&&(this.openingTypeScript=!1),this.forceUpdate()}).then(()=>{this.state.currFile.virtual||!e||this.state.autoRun?this.typecheck():this.startSimulator()})}this.state.editorPosition&&this.editorFile==this.state.editorPosition.file&&(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0}))}setFile(t,i){if(t){t.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0);var n=this.state.header;let e=!1;n&&"this"===(t.epkg&&t.epkg.getPkgId())&&(this.isBlocksFile(t.name)?(n.editor=pxt.BLOCKS_PROJECT_NAME,n.pubCurrent=!1,e=!0):this.isTypescriptFile(t.name)?(n.editor=pxt.JAVASCRIPT_PROJECT_NAME,n.pubCurrent=!1,e=!0):this.isPythonFile(t.name)&&(n.editor=pxt.PYTHON_PROJECT_NAME,n.pubCurrent=!1,e=!0),e)&&q.mainPkg.setPreferredEditor(n.editor);n={currFile:t,showBlocks:!1,embedSimView:!1,autoRun:this.autoRunOnStart()};void 0!==i&&(n.editorPosition={lineNumber:i,column:1,file:t}),this.setState(n)}}setSideFile(e,t){e.name!=this.state.currFile.name&&pxt.editor.isBlocks(e)?(pxt.tickEvent("sidebar.showBlocks"),this.openBlocks()):((this.isTextEditor()||this.isPxtJsonEditor())&&(this.textEditor.giveFocusOnLoading=!1),this.setFile(e,t))}navigateToError(t){if(t){let e=t.fileName;/^(pxt_modules|built)\//.test(e)||(e="this/"+e);var i=q.mainEditorPkg().lookupFile(e);i&&this.setSideFile(i,t.line+1)}}removeFile(e,t=!1){const i=()=>{q.mainEditorPkg().removeFileAsync(e.name).then(()=>q.mainEditorPkg().saveFilesAsync()).then(()=>this.reloadHeaderAsync())};t?i():g.confirmAsync({header:lf("Remove {0}",e.name),body:lf("You are about to remove a file from your project. You can't undo this. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then(e=>{e&&i()})}updateFileAsync(e,t,i){const n=q.mainEditorPkg();return n.setContentAsync(e,t).then(()=>{i&&this.setFile(n.lookupFile("this/"+e))}).then(()=>this.reloadHeaderAsync())}isSideDocExpanded(){var e=this.refs.sidedoc;return!!e&&!e.isCollapsed()}setSideMarkdown(e){var t=this.refs.sidedoc;t&&t.setMarkdown(e)}setSideDoc(e,t=!0){var i=this.refs.sidedoc;i&&(e?i.setPath(e,t):i.collapse())}setSideDocCollapsed(e=!0){var t=this.refs.sidedoc;t&&(e&&this.isSideDocExpanded()?t.collapse():e||this.isSideDocExpanded()||t.expand())}setTutorialInstructionsExpanded(e){var t=this.state.tutorialOptions;t.tutorialStepExpanded=e,t.autoexpandStep=e,this.setState({tutorialOptions:t},()=>{this.editor==this.blocksEditor?this.blocksEditor.hideFlyout():this.editor==this.textEditor&&this.textEditor.hideFlyout()})}setTutorialStep(e){this.typecheckNow(),this.stopPokeUserActivity();var t,i=this.refs[ee.tutorialCardId];this.isTutorial()&&-1<e&&((t=this.state.tutorialOptions).tutorialStep=e,t.tutorialStepExpanded=!1,this.setState({tutorialOptions:t},()=>{this.postTutorialProgress(),m.saveAsync(this.state.header)}),t.tutorialStepInfo[e].showHint&&i&&this.showTutorialHint(),t.tutorialStepInfo[e].tutorialCompleted&&pxt.commands.onTutorialCompleted&&pxt.commands.onTutorialCompleted(),this.editor.closeFlyout(),this.textEditor.giveFocusOnLoading&&this.isTextEditor()&&null!=(i=this.textEditor.editor)&&i.focus(),pxt.appTarget.appTheme.tutorialCodeValidation)&&this.editor.validateTutorialCode(this.state.tutorialOptions)}setTutorialCodeStatus(e,t){var i=this.state.tutorialOptions,n=i.tutorialStepInfo[i.tutorialStep];i.metadata.tutorialCodeValidation&&(n.listOfValidationRules=t),this.setState({tutorialOptions:i})}postTutorialProgress(){var e=(null==(e=this.state.tutorialOptions)?void 0:e.tutorialStep)||(null==(e=null==(e=this.state.header)?void 0:e.tutorialCompleted)?void 0:e.steps)||0,t=(null==(t=null==(t=this.state.tutorialOptions)?void 0:t.tutorialStepInfo)?void 0:t.length)||(null==(t=null==(t=this.state.header)?void 0:t.tutorialCompleted)?void 0:t.steps)||0,i=(null==(i=this.state.tutorialOptions)?void 0:i.tutorial)||(null==(i=this.state.header)?void 0:i.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"progress",currentStep:e,totalSteps:t,tutorialId:i,projectHeaderId:null==(e=this.state.header)?void 0:e.id,isCompleted:!(null==(t=this.state.header)||!t.tutorialCompleted)})}postTutorialLoaded(){var e=(null==(e=this.state.tutorialOptions)?void 0:e.tutorial)||(null==(e=this.state.header)?void 0:e.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"loaded",tutorialId:e,projectHeaderId:this.state.header.id})}postTutorialCompleted(){var e=(null==(e=this.state.tutorialOptions)?void 0:e.tutorial)||(null==(e=this.state.header)?void 0:e.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"completed",tutorialId:e,projectHeaderId:this.state.header.id})}postTutorialExit(){var e=(null==(e=this.state.tutorialOptions)?void 0:e.tutorial)||(null==(e=this.state.header)?void 0:e.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"exit",tutorialId:e,projectHeaderId:this.state.header.id})}handleMessage(e){switch(e.type){case"opendoc":window.open(e.url,"_blank"),this.setState({sideDocsCollapsed:!0,sideDocsLoadUrl:""});break;case"tutorial":switch(e.subtype){case"loaded":var t=e,i=(t.toolboxSubset&&0<Object.keys(t.toolboxSubset).length&&(this.setState({editorState:{searchBar:!1,filters:{blocks:t.toolboxSubset,defaultState:pxt.editor.FilterState.Hidden}}}),this.editor.filterToolbox(t.showCategories)),this.state.tutorialOptions);i.tutorialReady=!0,i.tutorialStepInfo=t.stepInfo,this.setState({tutorialOptions:i},()=>m.saveAsync(this.state.header)),i.tutorialStepInfo[0].showHint&&this.showTutorialHint(),g.hideLoading("tutorial");break;case"error":pxt.reportException(e.message),g.errorNotification(lf("We're having trouble loading this tutorial, please try again later.")),this.setState({tutorialOptions:void 0});t=q.mainEditorPkg().header;t.isDeleted=!0,t.tutorial=void 0,m.forceSaveAsync(t,{}).then(()=>{this.openHome()}).finally(()=>g.hideLoading("tutorial"))}}}reloadHeaderAsync(){return this.loadHeaderAsync(this.state.header,this.state.editorState)}tryCheckTargetVersionAsync(e){var t=e||"0.0.0";if(pxt.semver.majorCmp(t,pxt.appTarget.versions.target)<0&&pxt.tickEvent("patch.load.legacy",{targetVersion:t}),0<pxt.semver.majorCmp(t,pxt.appTarget.versions.target)){pxt.tickEvent("patch.load.future",{targetVersion:t});const e=[];return pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.homeUrl&&e.push({label:lf("Get latest"),icon:"external alternate",url:pxt.appTarget.appTheme.homeUrl}),g.dialogAsync({header:lf("Oops, this project is too new!"),body:lf("This project was created in a newer version of this editor. Please try again in that editor."),disagreeLbl:lf("Ok"),buttons:e}).then(()=>this.openHome())}}async loadHeaderAsync(n,e,r=!0){if(!n)return Promise.resolve();var t=this.tryCheckTargetVersionAsync(n.targetVersion);if(t)return t.then(()=>this.openHome());if(m.isHeadersSessionOutdated()&&(pxt.log("multi-tab sync before load"),await m.syncAsync()),r){const e=15e3,r=v.nowSeconds();let i=!1;await Promise.race([pxt.U.delay(15e3).then(()=>{i=!0}),f.syncAsync({hdrs:[n],direction:"down"}).then(e=>{var t;e.length&&(t=v.nowSeconds()-r,i?(pxt.tickEvent("identity.syncOnProjectOpen.timedout",{elapsedSec:t}),e.some(e=>e.id===n.id)&&f.forceReloadForCloudSync()):(pxt.tickEvent("identity.syncOnProjectOpen.syncSuccess",{elapsedSec:t}),n=m.getHeader(n.id)))})])}n&&(m.acquireHeaderSession(n),await this.internalLoadHeaderAsync(n,e))}internalLoadHeaderAsync(o,a){pxt.debug(`loading ${o.id} (pxt v${o.targetVersion})`),this.stopSimulator(!0),pxt.appTarget.simulator&&pxt.appTarget.simulator.aspectRatio&&p.driver.preload(pxt.appTarget.simulator.aspectRatio),this.clearSerial(),this.firstRun=!0,this.allEditors.forEach(e=>e.clearCaches()),this.setState({autoRun:this.autoRunOnStart(),tracing:void 0});var e=this.state.editorState;return e&&a&&(void 0===a.filters&&(a.filters=e.filters),void 0===a.hasCategories&&(a.hasCategories=e.hasCategories),void 0===a.searchBar)&&(a.searchBar=e.searchBar),this.hasCloudSync()&&(o.cloudUserId=null==(e=this.getUserProfile())?void 0:e.id),u.newProjectAsync().then(()=>o.backupRef?m.restoreFromBackupAsync(o):Promise.resolve()).then(()=>q.loadPkgAsync(o.id)).then(()=>(this.state&&this.state.header==o||this.showPackageErrorsOnNextTypecheck(),p.setDirty(),u.newProjectAsync())).then(()=>u.applyUpgradesAsync()).then(()=>this.loadTutorialJresCodeAsync()).then(()=>this.loadTutorialCustomTsAsync()).then(()=>this.loadTutorialTemplateCodeAsync()).then(()=>{var e=q.getEditorPkg(q.mainPkg);q.mainPkg.config.preferredEditor&&(o.editor=q.mainPkg.config.preferredEditor);let t=e.getMainFile();var i=o.editor!=pxt.BLOCKS_PROJECT_NAME&&this.settings.fileHistory.filter(e=>e.id==o.id)[0];if(i){const o=e.lookupFile(i.name);o?t=o:"ts"===q.getExtensionOfFileName(i.name)?t=e.lookupFile("this/"+t.getFileNameWithExtension("ts"))||t:"py"===q.getExtensionOfFileName(i.name)&&(t=e.lookupFile("this/"+t.getFileNameWithExtension("py"))||t)}var n=q.mainPkg.config.name,i=(o.name=n||lf("Untitled"),!i&&o.editor&&t.getVirtualFileName(o.editor)&&(t=e.lookupFile("this/"+t.getVirtualFileName(o.editor))||t),!pxt.editor.isBlocks(t)||t.content||t.content||(t=e.lookupFile("this/"+t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME))||t),null==(n=null==(r=o.tutorial)?void 0:r.metadata)?void 0:n.preferredEditor),r=((t=i?e.lookupFile("this/"+ge(i))||t:t).name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0),this.setState({home:!1,showFiles:!!o.githubId,editorState:a,tutorialOptions:o.tutorial,header:o,projectName:o.name,currFile:t,sideDocsLoadUrl:"",debugging:!1}),q.getEditorPkg(q.mainPkg).onupdate=()=>{this.loadHeaderAsync(o,this.state.editorState)},q.mainPkg.getCompileOptionsAsync().catch(e=>{var t;e instanceof pxt.cpp.PkgConflictError&&(e=e,t=e=>({label:lf("Remove {0}",e.id),class:"pink",icon:"trash",onclick:()=>{g.showLoading("removedep",lf("Removing {0}...",e.id)),q.mainEditorPkg().removeDepAsync(e.id).then(()=>this.reloadHeaderAsync()).finally(()=>g.hideLoading("removedep"))}}),g.dialogAsync({hideCancel:!0,buttons:[t(e.pkg1),t(e.pkg0)],header:lf("Extensions cannot be used together"),body:lf("Extensions '{0}' and '{1}' cannot be used together, because they use incompatible settings ({2}).",e.pkg1.id,e.pkg0.id,e.settingName)}))}),this.pickEditorFor(t)),n=null==(i=null==(n=null==q?void 0:q.mainPkg)?void 0:n.config)?void 0:i.documentation;if(n)this.setSideDoc(n,r==this.blocksEditor);else{const a=e.lookupFile("this/README.md"),r=null==(i=null==a?void 0:a.content)?void 0:i.trim();o.githubId||!r||/#{2,}\s+@autoOpen\s+false\s*/i.test(r)||this.setSideMarkdown(a.content)}return m.saveAsync(o)}).then(()=>this.loadTutorialFiltersAsync()).finally(()=>{pxt.BrowserUtils.changeHash("#editor",!0),document.getElementById("root").focus(),G.maybeReconnectAsync(!1,!0),this.editorLoaded()})}loadTutorialFiltersAsync(){const i=q.mainEditorPkg().header;if(!i||!i.tutorial||!i.tutorial.tutorialMd)return Promise.resolve();pxt.perf.measureStart("loadTutorial loadBlockly");const n=i.tutorial;return"string"==typeof n.tutorialCode&&(n.tutorialCode=[n.tutorialCode]),this.loadBlocklyAsync().then(()=>$.getUsedBlocksAsync(n.tutorialCode,n.tutorial,n.language)).then(e=>{var t={searchBar:!1};null!=e&&e.usedBlocks&&0<Object.keys(e.usedBlocks).length&&(t.filters={blocks:e.usedBlocks,defaultState:pxt.editor.FilterState.Hidden},t.hasCategories=!(i.tutorial.metadata&&i.tutorial.metadata.flyoutOnly)),this.setState({editorState:t}),this.editor.filterToolbox(!0),n.tutorialStepInfo[i.tutorial.tutorialStep].showHint&&this.showTutorialHint()}).catch(e=>{pxt.tickEvent("tutorial.faileddecompile",{tutorial:n.tutorial}),this.setState({editorState:{searchBar:!1,filters:void 0}}),g.warningNotification(lf("Could not filter tutorial blocks, displaying full toolbox."))}).finally(()=>{pxt.perf.measureEnd("loadTutorial loadBlockly")})}async loadTutorialTemplateCodeAsync(){var n,r=q.mainEditorPkg().header;if(r&&r.tutorial&&r.tutorial.templateCode){const l=r.tutorial.templateCode;delete r.tutorial.templateCode;var o=await m.getTextAsync(r.id),a=null==(n=r.tutorial.metadata)?void 0:n.preferredEditor,s=(a&&ge(a)===pxt.ASSETS_FILE&&(o[pxt.MAIN_TS]=l),function(){switch((a||r.editor).toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return pxt.JAVASCRIPT_PROJECT_NAME;case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return pxt.PYTHON_PROJECT_NAME;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return pxt.BLOCKS_PROJECT_NAME}}());if(s===pxt.JAVASCRIPT_PROJECT_NAME)o[pxt.MAIN_TS]=l;else if(s===pxt.PYTHON_PROJECT_NAME){const n=await u.decompilePythonSnippetAsync(l);n&&(o[pxt.MAIN_PY]=n)}else{const n=(await u.decompileBlocksSnippetAsync(l)).outfiles[pxt.MAIN_BLOCKS];n&&(o[pxt.MAIN_BLOCKS]=n)}let e,t,i=o;if(r.tutorial.mergeHeaderId){const n=m.getHeader(r.tutorial.mergeHeaderId);if(n){const l=await m.getTextAsync(n.id);i=M.mergeProjectCode(l,o,!!r.tutorial.mergeCarryoverCode)}}for(const n of Object.keys(i))void 0!==i[n]&&q.mainEditorPkg().setFile(n,i[n]);await m.saveAsync(r);try{e=i[pxt.TILEMAP_JRES]?JSON.parse(i[pxt.TILEMAP_JRES]):null,t=i[pxt.IMAGES_JRES]?JSON.parse(i[pxt.IMAGES_JRES]):null}catch(n){return Promise.reject(n)}s=pxt.react.getTilemapProject();e&&s.loadTilemapJRes(pxt.inflateJRes(e),!0),t&&s.loadAssetsJRes(pxt.inflateJRes(t)),await q.mainEditorPkg().buildAssetsAsync(),await q.mainEditorPkg().saveFilesAsync()}}loadTutorialJresCodeAsync(){var e,t=q.mainEditorPkg().header;if(!t||!t.tutorial||!t.tutorial.jres&&!t.tutorial.assetFiles)return Promise.resolve();var i=t.tutorial.jres||(null==(e=t.tutorial.assetFiles)?void 0:e[pxt.TILEMAP_JRES]),n=null==(n=t.tutorial.assetFiles)?void 0:n[pxt.IMAGES_JRES];let r,o;delete t.tutorial.jres,delete t.tutorial.assetFiles;try{r=i?JSON.parse(i):null,o=n?JSON.parse(n):null}catch(e){return Promise.reject(e)}t=pxt.react.getTilemapProject();return r&&t.loadTilemapJRes(pxt.inflateJRes(r),!0),o&&t.loadAssetsJRes(pxt.inflateJRes(o)),q.mainEditorPkg().buildAssetsAsync()}async loadTutorialCustomTsAsync(){var e=q.mainEditorPkg(),t=e.header;return t&&t.tutorial&&t.tutorial.customTs&&(t=t.tutorial.customTs,await e.setContentAsync(pxt.TUTORIAL_CUSTOM_TS,t),await e.saveFilesAsync()),Promise.resolve()}removeProject(){q.mainEditorPkg().header&&g.confirmDelete(q.mainEditorPkg().header.name,()=>{var e=q.mainEditorPkg().header;return e.isDeleted=!0,m.forceSaveAsync(e,{}).then(()=>this.openHome())})}isHexFile(e){return/\.(hex|uf2)$/i.test(e)}isBlocksFile(e){return/\.blocks$/i.test(e)}isTypescriptFile(e){return/\.ts$/i.test(e)}isPythonFile(e){return/\.py$/i.test(e)}isProjectFile(e){return/\.(pxt|mkcd|mkcd-\w+)$/i.test(e)}isPNGFile(e){return pxt.appTarget.compile.saveAsPNG&&/\.png$/i.test(e)}isAssetFile(e){var t=pxt.appTarget.runtime?pxt.appTarget.runtime.assetExtensions:null;return!!t&&(e=e.replace(/.*\./,"").toLowerCase(),0<=t.indexOf(e))}importProjectCoreAsync(e,t){return(e[0]=="{".charCodeAt(0)?Promise.resolve(pxt.U.uint8ArrayToString(e)):pxt.lzmaDecompressAsync(e)).then(e=>{e=JSON.parse(e);e.target&&e.target==pxt.appTarget.id?e.xml.forEach(e=>{e=pxt.Util.htmlUnescape(e.replace(/^"|"$/g,""));pxt.blocks.loadBlocksXml(this.blocksEditor.editor,e)}):this.importHex(e,t)}).catch(e=>{g.warningNotification(lf("Sorry, we could not import this project or block snippet.")),this.openHome()})}importHexFile(e,t){e&&pxt.cpp.unpackSourceFromHexFileAsync(e).then(e=>this.importHex(e,t)).catch(e=>{pxt.reportException(e),g.warningNotification(lf("Sorry, we could not recognize this file."))})}importBlocksFiles(t,e){t&&ts.pxtc.Util.fileReadAsTextAsync(t).then(e=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:e,[pxt.MAIN_TS]:"  "},name:t.name.replace(/\.blocks$/i,"")||lf("Untitled")})})}importTypescriptFile(t,e){t&&ts.pxtc.Util.fileReadAsTextAsync(t).then(e=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:"",[pxt.MAIN_TS]:e||"  "},name:t.name.replace(/\.ts$/i,"")||lf("Untitled")})})}importProjectFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then(e=>this.importProjectCoreAsync(e,t))}importPNGFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then(e=>pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(e)))).then(e=>this.importProjectCoreAsync(e,t))}importPNGBuffer(e){pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(new Uint8Array(e)))).then(e=>this.importProjectCoreAsync(e))}importAssetFile(i){ts.pxtc.Util.fileReadAsBufferAsync(i).then(e=>{var t=i.name.replace(/.*[\/\\]/,"");return q.mainEditorPkg().saveAssetAsync(t,e)})}importHex(t,i){if(!t||!t.meta){if(!t||!t[pxt.CONFIG_NAME])return g.warningNotification(lf("Sorry, we could not recognize this file.")),void(i&&i.openHomeIfFailed&&this.openHome());t=s.reconstructMeta(t)}if("object"==typeof t.source&&(t.source=JSON.stringify(t.source)),this.hexFileImporters.some(e=>"default"==e.id&&e.canImport(t))){const n=this.tryCheckTargetVersionAsync(t.meta.targetVersions&&t.meta.targetVersions.target);if(n)return void n.then(()=>{i&&i.openHomeIfFailed&&this.newProject()})}if(i&&i.extension){if(pxt.tickEvent("import.extension"),ts.pxtc.Util.jsonTryParse(t.source)){const i=t.meta.name,n=t.meta.name+".json",e=q.mainEditorPkg();e&&(pxt.debug(`adding ${n} to package`),e.setContentAsync(n,t.source).then(()=>e.updateConfigAsync(e=>{e.dependencies||(e.dependencies={}),e.dependencies[i]="pkg:"+n})).then(()=>this.reloadHeaderAsync()))}}else{const n=this.hexFileImporters.filter(e=>e.canImport(t))[0];n?(pxt.tickEvent("import",{id:n.id}),g.hideDialog(),g.showLoading("importhex",lf("loading project...")),pxt.editor.initEditorExtensionsAsync().then(()=>n.importAsync(this,t).then(()=>g.hideLoading("importhex"),e=>{pxt.reportException(e,{importer:n.id}),g.hideLoading("importhex"),g.errorNotification(lf("Oops, something went wrong when importing your project")),i&&i.openHomeIfFailed&&this.openHome()}))):(g.warningNotification(lf("Sorry, we could not import this project.")),pxt.tickEvent("warning.importfailed"),i&&i.openHomeIfFailed&&this.openHome())}}importProjectAsync(e,t){let i=e.header;return i=i||{target:pxt.appTarget.id,targetVersion:void 0,editor:pxt.BLOCKS_PROJECT_NAME,name:lf("Untitled"),meta:{},pubId:"",pubCurrent:!1},m.installAsync(i,e.text).then(e=>this.loadHeaderAsync(e,t))}importTutorialAsync(e){try{var{options:t,editor:i}=pxt.tutorial.getTutorialOptions(e,"untitled","untitled","",!1),n=pxt.gallery.parsePackagesFromMarkdown(e);return this.hintManager.clearViewedHints(),this.createProjectAsync({name:"untitled",tutorial:t,preferredEditor:i,dependencies:n})}catch(e){return v.userError(lf("Could not import tutorial")),Promise.reject(e)}}async importSkillmapProjectAsync(e){var t=new pxt.skillmap.IndexedDBWorkspace,t=(await t.initAsync(),await t.getProjectAsync(e));if(t&&!t.deleted)return t.header.tutorial&&(t.header.tutorialCompleted={id:t.header.tutorial.tutorial,steps:t.header.tutorial.tutorialStepInfo.length},delete t.header.tutorial),this.importProjectAsync(t);t=m.getHeader(e);t?((e=await m.duplicateAsync(t)).tutorial&&(e.tutorialCompleted={id:e.tutorial.tutorial,steps:e.tutorial.tutorialStepInfo.length},delete e.tutorial),e.isSkillmapProject=!1,await m.saveAsync(e),a.invalidate("headers:"),await this.loadHeaderAsync(e)):v.userError(lf("Unable to import skillmap project"))}openProjectByHeaderIdAsync(e){e=m.getHeader(e);return this.loadHeaderAsync(e)}initDragAndDrop(){P.setupDragAndDrop(document.body,e=>e.size<1e6&&this.isHexFile(e.name)||this.isBlocksFile(e.name),e=>{e&&(pxt.tickEvent("dragandrop.open"),this.importFile(e[0]))},t=>{this.isPNGFile(t)&&pxt.Util.httpRequestCoreAsync({url:t,method:"GET",responseArrayBuffer:!0}).then(e=>this.importUri(t,e.buffer)).catch(e=>g.handleNetworkError(e))})}importUri(e,t){this.isPNGFile(e)&&this.importPNGBuffer(t)}importFile(t,e){if(t&&!pxt.shell.isReadOnly())if(this.isHexFile(t.name))this.importHexFile(t,e);else if(this.isBlocksFile(t.name))this.importBlocksFiles(t,e);else if(this.isTypescriptFile(t.name))this.importTypescriptFile(t,e);else if(this.isProjectFile(t.name))this.importProjectFile(t,e);else if(this.isAssetFile(t.name))this.importAssetFile(t);else if(this.isPNGFile(t.name))this.importPNGFile(t,e);else{const e=this.resourceImporters.filter(e=>e.canImport(t))[0];e?e.importAsync(this,t):g.warningNotification(lf("Oops, don't know how to load this file!"))}}importProjectFromFileAsync(e,t){return pxt.lzmaDecompressAsync(e).then(e=>{e=JSON.parse(e);return this.importHex(e,t)}).catch(()=>this.newProject())}syncPreferredEditor(){var e=this.getPreferredEditor();e&&q.mainPkg.setPreferredEditor(e)}exportProjectToFileAsync(){return this.syncPreferredEditor(),q.mainPkg.compressToFileAsync()}exportAsync(){return pxt.debug("exporting project"),this.exportProjectToFileAsync().then(e=>ts.pxtc.encodeBase64(v.uint8ArrayToString(e)))}downloadScreenshotAsync(){return pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!1):this.requestScreenshotAsync().then(e=>pxt.BrowserUtils.browserDownloadDataUri(e,q.genFileName(".png")))}pushScreenshotHandler(e){this.screenshotHandlers.push(e)}popScreenshotHandler(){this.screenshotHandlers.pop()}requestScreenshotAsync(){return this.requestScreenshotPromise||(this.setState({screenshoting:!0}),p.driver.postMessage({type:"screenshot"}),v.promiseTimeout(1e3,this.requestScreenshotPromise=new Promise((t,e)=>{this.pushScreenshotHandler(e=>t(pxt.BrowserUtils.imageDataToPNG(e.data,3)))})).catch(e=>{pxt.tickEvent("screenshot.timeout")}).finally(()=>{this.popScreenshotHandler(),this.requestScreenshotPromise=void 0,this.setState({screenshoting:!1})}))}encodeProjectAsPNGAsync(t,i){return this.exportProjectToFileAsync().then(e=>r.encodeBlobAsync(this.state.header.name,t,e)).then(e=>{var t=q.genFileName(".png");return pxt.BrowserUtils.browserDownloadDataUri(e,t),i?g.dialogAsync({header:lf("Project Saved!"),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1,jsx:H.createElement("div",{className:"ui items"},H.createElement("div",{className:"item"},H.createElement("div",{className:"ui small image"},H.createElement("a",{download:t,className:"ui link",href:e},H.createElement("img",{src:e,alt:lf("Project cartridge"),title:lf("Click to download again")}))),H.createElement("div",{className:"content"},H.createElement("div",{className:"description"},H.createElement("p",null,lf("Your project is saved in this image."),H.createElement("br",null),lf("Import or drag it into the editor to reload it."))))))}):Promise.resolve()})}saveProjectAsPNGAsync(t){return this.requestScreenshotAsync().then(e=>this.encodeProjectAsPNGAsync(e,t))}saveProjectToFileAsync(){var e=q.mainPkg;return fe()?(pxt.BrowserUtils.browserDownloadText(e.readFile(pxt.MAIN_BLOCKS),q.genFileName(".blocks"),{contentType:"application/xml"}),Promise.resolve()):me()?this.saveTutorialTemplateAsync():pxt.commands.saveProjectAsync?(g.infoNotification(lf("Saving...")),this.syncPreferredEditor(),e.saveToJsonAsync().then(e=>pxt.commands.saveProjectAsync(e))):pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!0):this.exportProjectToFileAsync().then(e=>{var t=q.genFileName(".mkcd");pxt.BrowserUtils.browserDownloadUInt8Array(e,t,{contentType:"application/octet-stream"})})}openHome(){pxt.shell.isControllerMode()||pxt.appTarget.appTheme.lockedEditor||this.unloadProjectAsync(!0)}homeLoaded(){pxt.tickEvent("app.home")}editorLoaded(){pxt.tickEvent("app.editor")}unloadProjectAsync(e){return this.stopSimulator(!0),this.showKeymap(!1),G.disconnectAsync(),this.editor&&this.editor.unloadFileAsync(),this.extensions.unload(),this.editorFile=void 0,e&&pxt.BrowserUtils.changeHash("",!0),this.setStateAsync({home:void 0!==e?e:this.state.home,tracing:void 0,fullscreen:void 0,tutorialOptions:void 0,editorState:void 0,debugging:void 0,header:void 0,currFile:void 0,fileState:void 0}).then(()=>(this.allEditors.forEach(e=>e.setVisible(!1)),e&&(this.homeLoaded(),this.showPackageErrorsOnNextTypecheck()),m.syncAsync())).then(()=>{})}reloadEditor(){try{window.removeEventListener("hashchange",he),y&&(pxt.BrowserUtils.isIFrame()&&("pub"===y.cmd||"sandbox"===y.cmd)||"tutorial"==y.cmd)?location.hash=`#${y.cmd}:`+y.arg:this.state&&this.state.home?location.hash="#reload":this.state&&this.state.header&&!this.state.header.isDeleted&&(location.hash="#editor"),location.reload()}catch(e){pxt.reportException(e),location.reload()}}getPreferredEditor(){if(this.editor==this.blocksEditor)return pxt.BLOCKS_PROJECT_NAME;if(this.editor==this.textEditor){if("python"!==this.textEditor.fileType)return pxt.JAVASCRIPT_PROJECT_NAME;return pxt.PYTHON_PROJECT_NAME}}openExtension(e,t){pxt.tickEvent("app.openextension",{extension:e}),this.extensions.showExtensionAsync(e,t)}handleExtensionRequest(e){this.extensions.handleExtensionRequest(e)}newEmptyProject(e,t,i){this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},name:e,documentation:t,preferredEditor:i,filters:{}})}newProject(e={}){return pxt.tickEvent("app.newproject"),g.showLoading("newproject",lf("creating new project...")),this.createProjectAsync(e).then(()=>this.autoChooseBoardAsync()).then(()=>v.delay(500)).finally(()=>g.hideLoading("newproject"))}async createProjectAsync(e){pxt.perf.measureStart("createProjectAsync"),this.setSideDoc(void 0),e.prj||(e.prj=pxt.appTarget.blocksprj);let i=pxt.U.clone(e.prj.config);i.name=e.name||lf("Untitled"),i.documentation=e.documentation;var n=v.clone(e.prj.files);if(e.filesOverride&&(v.jsonCopyFrom(n,e.filesOverride),Object.keys(e.filesOverride).forEach(e=>{-1===i.files.indexOf(e)&&i.files.push(e)})),e.dependencies&&v.jsonMergeFrom(i.dependencies,e.dependencies),e.extensionUnderTest){const t=m.getHeader(e.extensionUnderTest);t&&(i.dependencies[t.name]="workspace:"+t.id)}if(e.tsOnly&&(e.languageRestriction="no-blocks"),e.preferredEditor&&(i.preferredEditor=e.preferredEditor),e.languageRestriction){let t=/\.(blocks)$/;"javascript-only"===e.languageRestriction?(t=/\.(py|blocks)$/,i.preferredEditor=pxt.JAVASCRIPT_PROJECT_NAME):"python-only"===e.languageRestriction&&(i.preferredEditor=pxt.PYTHON_PROJECT_NAME),i.languageRestriction=e.languageRestriction,i.files=i.files.filter(e=>!t.test(e)),delete n[pxt.MAIN_BLOCKS]}i.preferredEditor==pxt.PYTHON_PROJECT_NAME&&i.files.indexOf(pxt.MAIN_PY)<0&&(i.files.push(pxt.MAIN_PY),n[pxt.MAIN_PY]||(n[pxt.MAIN_PY]="\n")),e.tutorial&&e.tutorial.metadata&&(e.tutorial.metadata.codeStart&&(n[pxt.TUTORIAL_CODE_START]=`control._onCodeStart('${pxt.U.htmlEscape(e.tutorial.metadata.codeStart)}')`,i.files.splice(i.files.indexOf(pxt.MAIN_TS),0,pxt.TUTORIAL_CODE_START)),e.tutorial.metadata.codeStop)&&(n[pxt.TUTORIAL_CODE_STOP]=`control._onCodeStop('${pxt.U.htmlEscape(e.tutorial.metadata.codeStop)}')`,i.files.push(pxt.TUTORIAL_CODE_STOP)),n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(i),await pxt.github.cacheProjectDependenciesAsync(i);var t=await m.installAsync({name:i.name,meta:{},editor:e.preferredEditor||e.prj.id,pubId:"",pubCurrent:!1,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,cloudUserId:null==(t=this.getUserProfile())?void 0:t.id,temporary:e.temporary,tutorial:e.tutorial,extensionUnderTest:e.extensionUnderTest,isSkillmapProject:e.skillmapProject},n);await this.loadHeaderAsync(t,{filters:e.filters}),pxt.perf.measureEnd("createProjectAsync")}autoChooseBoardAsync(e){return pxt.appTarget.appTheme.chooseBoardOnNewProject&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition?this.showBoardDialogAsync(e,!1):Promise.resolve()}importExampleAsync(e){const{name:t,path:i,loadBlocks:s,prj:l,preferredEditor:c}=e;return g.showLoading("changingcode",lf("loading...")),this.loadingExample=!0,this.loadActivityFromMarkdownAsync(i,t.toLowerCase(),c).then(e=>{const{filename:t,md:i,features:n,autoChooseBoard:r}=e||{},o=!l&&r,a=!!i&&pxt.gallery.parseExampleMarkdown(t,i);if(a)return e=a,l&&(e.prj=l),s&&c==pxt.BLOCKS_PROJECT_NAME?this.createProjectAsync(e).then(()=>this.loadBlocklyAsync().then(u.getBlocksAsync).then(e=>u.decompileAsync(pxt.MAIN_TS,e)).then(e=>{pxt.debug("example decompilation: "+e.success),e.success&&this.overrideBlocksFile(e.outfiles[pxt.MAIN_BLOCKS])}).then(()=>o&&this.autoChooseBoardAsync(n))):(s||(e.languageRestriction="no-blocks"),e.preferredEditor=c,this.createProjectAsync(e).then(()=>c==pxt.PYTHON_PROJECT_NAME&&"python"!==a.snippetType?u.getApisInfoAsync().then(()=>u.pyDecompileAsync(pxt.MAIN_TS)).then(e=>{pxt.debug("example decompilation: "+e.success),e.success&&this.overrideTypescriptFile(e.outfiles[pxt.MAIN_PY])}).then(()=>o&&this.autoChooseBoardAsync(n)):Promise.resolve()));throw new Error(lf("Example not found or invalid format"))}).catch(e=>(g.warningNotification(lf("Please check your internet connection and check the example is valid.")),pxt.reportException(e),Promise.reject(e))).finally(()=>{this.loadingExample=!1,g.hideLoading("changingcode")})}switchTypeScript(){var e=q.mainEditorPkg(),t=this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),e=e.files[t];this.setFile(e)}saveBlocksToTypeScriptAsync(){return this.blocksEditor.saveToTypeScriptAsync()}saveVirtualFileAsync(e,t,i){t=t||"\n";const n=q.mainEditorPkg(),r=this.editorFile.getVirtualFileName(e);return v.assert(r!=this.editorFile.name),n.setContentAsync(r,t).then(()=>{var e;i&&(e=n.files[r],this.setFile(e))})}saveTypeScriptAsync(t=!1){const i=q.mainEditorPkg();if(!this.editor||!this.state.currFile||this.editorFile.epkg!=i||this.reload)return Promise.resolve();const n=this.editorFile.getExtension(),r=this.editorFile.content;let e=t?this.textEditor.loadMonacoAsync():Promise.resolve();return e=(e="py"==n?e.then(()=>this.saveCurrentSourceAsync()):e).then(()=>{if(t){this.openingTypeScript=!0;const t=i.getCachedTranspile(n,r,"ts");return t?Promise.resolve(t):this.editor.saveToTypeScriptAsync(!0).then(e=>(void 0!==e&&i.cacheTranspile(n,r,"ts",e),e))}return this.editor.saveToTypeScriptAsync()}).then(e=>void 0===e&&t?g.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to JavaScript."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then(e=>{this.isPythonActive()&&pxt.shell.setEditorLanguagePref("py")}):void 0===e||this.editorFile&&this.editorFile.name==this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?Promise.resolve():this.saveVirtualFileAsync(pxt.JAVASCRIPT_PROJECT_NAME,e,t)),t?g.showLoadingAsync("switchtojs",lf("switching to JavaScript..."),e,0):e}resetWorkspace(){return this.reload=!0,window.location.hash="#reload",m.resetAsync().then(()=>this.reloadEditor(),()=>this.reloadEditor())}pairAsync(){return G.pairAsync()}saveAndCompile(){if(this.state.header)return this.setState({isSaving:!0}),(this.state.projectName!==lf("Untitled")?Promise.resolve(!0):this.showRenameProjectDialogAsync()).then(e=>e?this.saveProjectNameAsync().then(()=>this.saveFileAsync()).then(()=>{!pxt.appTarget.compile.hasHex||pxt.appTarget.compile.useMkcd||pxt.appTarget.compile.saveAsPNG||fe()||me()?this.saveProjectToFileAsync().finally(()=>{this.setState({isSaving:!1})}):this.compile(!0)}):(this.setState({isSaving:!1}),Promise.resolve()))}checkForHwVariant(){if(pxt.hwVariant||!pxt.hasHwVariants())return!1;const r=pxt.getHwVariants();return 0!=r.length&&(pxt.usb.isEnabled&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.checkForHwVariantWebUSB&&this.checkWebUSBVariant?pxt.packetio.initAsync(!0).then(e=>{if(e.familyID)for(var t of r){var i,n=pxt.U.clone(pxt.appTarget.compile);if(t.compileServiceVariant&&(i=pxt.appTarget.variants[t.compileServiceVariant]).compile&&pxt.U.jsonCopyFrom(n,i.compile),parseInt(n.uf2Family)===e.familyID)return pxt.setHwVariant(t.name),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"HID-"+pxt.hwVariant}),void this.reloadHeaderAsync().then(()=>this.compile())}this.checkWebUSBVariant=!1,this.checkForHwVariant()},()=>G.pairAsync().then(()=>{this.checkForHwVariant()},e=>{this.checkWebUSBVariant=!1,this.checkForHwVariant()})).then(()=>{pxt.perf.recordMilestone("HID bridge init finished")}):this.showChooseHwDialog(),!0)}beforeCompile(){}async compile(i=!1){var n;if(pxt.tickEvent("compile",{editor:this.getPreferredEditor()}),pxt.debug("compiling..."),!this.checkForHwVariant())if(pxt.appTarget.compile.saveAsPNG&&pxt.hasHwVariants()&&!pxt.hwVariant)this.saveAndCompile();else{let t;if(this.beforeCompile(),pxt.appTarget.compile.useModulator||!pxt.BrowserUtils.isBrowserDownloadInSameWindow()||pxt.BrowserUtils.isBrowserDownloadWithinUserContext()||(t=window.open("")),this.state.compiling)pxt.tickEvent("compile.double");else{let e=this.state.simState!=pxt.editor.SimState.Stopped;e&&this.state.simState==pxt.editor.SimState.Pending&&pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor()&&(e=!1);try{this.setState({compiling:!0,cancelledDownload:!1}),this.clearSerial(),this.editor.beforeCompile(),e&&this.stopSimulator();var r=this.editor.snapshotState();this.syncPreferredEditor();try{var o=await u.compileAsync({native:!0,forceEmit:!0});if(this.editor.setDiagnostics(this.editorFile,r),i||await G.showUnsupportedHardwareMessageAsync(o)){var a=pxt.outputName();if(o.outfiles[a]){o.saveOnly=i,o.userContextWindow=t,o.downloadFileBaseName=q.genFileName(""),o.confirmAsync=g.confirmAsync;var s=this.state.header;if(s&&(o.headerId=s.id),pxt.commands.patchCompileResultAsync&&await pxt.commands.patchCompileResultAsync(o),i)await pxt.commands.saveOnlyAsync(o);else{o.success||this.maybeShowPackageErrors(!0)||g.confirmAsync({header:lf("Compilation failed"),body:lf("Ooops, looks like there are errors in your program."),hideAgree:!0,disagreeLbl:lf("Close")}),e&&(this.runSimulator(),e=!1);var l=Date.now();pxt.tickEvent("deploy.start");try{await pxt.commands.deployAsync(o,{reportError:e=>{pxt.tickEvent("deploy.reporterror"),g.errorNotification(e)},showNotification:e=>g.infoNotification(e)});var c=Date.now()-l;pxt.tickEvent("deploy.finished",{elapsedMs:c})}catch(i){if(i.notifyUser)g.warningNotification(i.message);else{const i=pxt.appTarget.appTheme.useUploadMessage?lf("Upload failed, please try again."):lf("Download failed, please try again.");g.warningNotification(i)}var d=Date.now()-l;if(pxt.tickEvent("deploy.exception",{notifyUser:i.notifyUser,elapsedMs:d}),pxt.reportException(i),t)try{t.close()}catch(i){}}}}else{pxt.tickEvent("compile.noemit");const i=null==(n=o.diagnostics)?void 0:n.find(e=>9043===e.code);void(i?g.warningNotification(i.messageText):g.warningNotification(lf("Compilation failed, please check your code for errors.")))}}else this.setState({cancelledDownload:!0})}catch(i){if(pxt.reportException(i),g.errorNotification(lf("Compilation failed, please contact support.")),t)try{t.close()}catch(i){}}finally{this.setState({compiling:!1,isSaving:!1}),e&&this.runSimulator()}}catch(i){this.setState({compiling:!1,isSaving:!1}),pxt.reportException(i),g.errorNotification(lf("Compilation failed, please try again."))}}}}overrideTypescriptFile(e){this.textEditor&&this.textEditor.overrideFile(e)}overrideBlocksFile(e){this.blocksEditor&&this.blocksEditor.overrideFile(e)}async setLanguageRestrictionAsync(t){if(this.state.header){var i=q.mainEditorPkg(),n=i.files["pxt.json"],r=pxt.Package.parseAndValidConfig(null==n?void 0:n.content);if(r){let e;switch(r.languageRestriction=t,await n.setContentAsync(JSON.stringify(r,null,4)),t){case"blocks-only":case"no-javascript":case"":e=[];break;case"javascript-only":e=[pxt.MAIN_BLOCKS,pxt.MAIN_PY];break;case"python-only":case"no-blocks":e=[pxt.MAIN_BLOCKS];break;case"no-python":e=[pxt.MAIN_PY]}for(const t of e)await i.removeFileAsync(t);switch(t){case"blocks-only":case"no-javascript":case"":case"no-python":if(this.editorFile.name!==pxt.MAIN_BLOCKS)return void this.openBlocksAsync();break;case"javascript-only":case"no-blocks":if(this.editorFile.name!==pxt.MAIN_TS)return void await this.openTypeScriptAsync();break;case"python-only":if(this.editorFile.name!==pxt.MAIN_PY)return void await this.openPythonAsync()}await this.reloadHeaderAsync()}}}startStopSimulator(e){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Pending:break;case pxt.editor.SimState.Running:this.stopSimulator(!1,e);break;default:this.maybeShowPackageErrors(!0),this.startSimulator(e),e&&e.clickTrigger&&p.driver.focus()}}toggleTrace(e){var t=!!this.state.tracing;t?(this.editor.clearHighlightedStatements(),p.setTraceInterval(0)):p.setTraceInterval(e||p.SLOW_TRACE_INTERVAL),this.setState({tracing:!t},()=>{this.state.debugging?this.onDebuggingStart():this.restartSimulator()})}setTrace(e,t){!!this.state.tracing!=e?this.toggleTrace(t):this.state.tracing&&(p.setTraceInterval(t||p.SLOW_TRACE_INTERVAL),this.startSimulator())}proxySimulatorMessage(e){p.proxy({type:"custom",content:e})}toggleSimulatorCollapse(){var e=this.state;pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!e.collapseEditorTools},{interactiveConsent:!0}),e.simState==pxt.editor.SimState.Stopped&&e.collapseEditorTools&&this.startStopSimulator(),e.collapseEditorTools?this.expandSimulator():this.collapseSimulator()}expandSimulator(){pxt.appTarget.simulator.headless?p.unhide():this.startSimulator(),this.setState({collapseEditorTools:!1}),this.fireResize()}collapseSimulator(){p.hide(()=>{this.setState({collapseEditorTools:!0}),this.fireResize()})}setSimulatorFullScreen(e){e?document.removeEventListener("keydown",this.closeOnEscape):(document.addEventListener("keydown",this.closeOnEscape),p.driver.focus()),this.closeFlyout(),this.setState({fullscreen:e})}toggleSimulatorFullscreen(){this.setSimulatorFullScreen(!this.state.fullscreen)}closeFlyout(){this.editor.closeFlyout()}toggleMute(){this.setMute(!this.state.mute)}setMute(e){p.mute(e),this.setState({mute:e})}openInstructions(){const e=this.state.simState!=pxt.editor.SimState.Stopped;e&&this.stopSimulator(),T.makeAsync().finally(()=>{e&&this.startSimulator()})}printCode(){var e,t,i;this.state.header&&(i=q.mainEditorPkg().getAllFiles(),e=pxt.webConfig.docsUrl||"/--docs",t=Q.isBlocksActive()?"blocks":"typescript",window.localStorage.printjob=JSON.stringify(i),i=e+`#print:job:${t}:`+pxt.Util.localeInfo(),g.dialogAsync({header:lf("Print Code"),hasCloseIcon:!0,size:"large",jsx:H.createElement("div",{className:"ui container"},H.createElement("div",{id:"printcontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},H.createElement("iframe",{frameBorder:"0","aria-label":lf("Print preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:i})))}).then(e=>{}))}clearSerial(){var e;this.serialEditor.clear(),null!=(e=this.simulatorSerialIndicator())&&e.clear(),null!=(e=this.deviceSerialIndicator())&&e.clear(),this.setState({simSerialActive:!1,deviceSerialActive:!1})}simulatorSerialIndicator(){return this.refs.simIndicator}deviceSerialIndicator(){return this.refs.devIndicator}shouldStartSimulator(){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Running:return!1}return!!pxt.shell.isControllerMode()||!this.state.home}isSimulatorRunning(){return this.state.simState==pxt.editor.SimState.Running}restartSimulator(){var e=this.state.tracing||this.state.debugging;this.state.simState==pxt.editor.SimState.Stopped||this.debugOptionsChanged()?this.startSimulator():(p.driver.stopSound(),p.driver.restart()),p.driver.focus(),e||this.blocksEditor.clearBreakpoints()}startSimulator(e){pxt.tickEvent("simulator.start");const t=!this.debugOptionsChanged(),i=e&&e.clickTrigger;return pxt.debug(`start sim (autorun ${this.state.autoRun})`),!this.shouldStartSimulator()&&t?(pxt.log("Ignoring call to start simulator, either already running or we shouldn't start."),Promise.resolve()):this.saveFileAsync().then(()=>this.runSimulator({debug:this.state.debugging,clickTrigger:i}))}debugOptionsChanged(){var{debugging:e,tracing:t}=this.state;return!!e!=p.driver.isDebug()||!!t!=p.driver.isTracing()}stopSimulator(e,t){pxt.perf.measureStart("stopSimulator"),pxt.tickEvent("simulator.stop");t=t&&t.clickTrigger,pxt.debug(`sim: stop (autorun ${this.state.autoRun})`),this.runToken&&(this.runToken.cancel(),this.runToken=null),p.stop(e),e=this.state.autoRun&&!t;this.setState({simState:pxt.editor.SimState.Stopped,autoRun:e}),pxt.perf.measureEnd("stopSimulator")}suspendSimulator(){pxt.tickEvent("simulator.suspend"),this.runToken&&(this.runToken.cancel(),this.runToken=null),p.suspend()}showMiniSim(e){this.setState({showMiniSim:e})}onHighContrastChanged(){this.clearSerial(),this.stopSimulator(),this.startSimulator()}onCloudStatusChanged(e){var t=this.getData(e),i=null==t?void 0:t.cloudStatus();if(i){const e={type:"pxteditor",action:"projectcloudstatus",headerId:t.headerId,status:i.value};pxt.editor.postHostMessageAsync(e)}}runSimulator(i={}){const e=this.firstRun&&i.background&&pxt.appTarget.simulator&&!!pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor();this.firstRun&&pxt.BrowserUtils.isSafari()&&this.setMute(!0),pxt.debug(`sim: start run (autorun ${this.state.autoRun}, first ${this.firstRun})`),this.firstRun=!1,this.runToken&&this.runToken.cancel();let n=new pxt.Util.CancellationToken;(this.runToken=n).startOperation();{var t=this.editor?this.editor.getId().replace(/Editor$/,""):"unknown";if(i.background){if(pxt.tickEvent("activity.autorun",{editor:t}),pxt.storage.getLocal("noAutoRun"))return Promise.resolve()}else pxt.tickEvent(i.debug?"debug":"run",{editor:t});i.background||this.editor.beforeCompile(),this.state.tracing&&this.state.debugging&&(i.trace=!0),i.debug&&(i.debugExtensionCode=pxt.appTarget.appTheme.debugExtensionCode&&!this.isBlocksActive()),this.syncPreferredEditor(),p.stop(!1,!0);const r=this.autoRunOnStart()&&this.isBlocksEditor()&&(this.state.autoRun||!!i.clickTrigger),o=this.editor.snapshotState();return this.setStateAsync({simState:pxt.editor.SimState.Starting,autoRun:r}).then(()=>e?Promise.resolve(u.emptyCompileResult()):u.compileAsync(i)).then(e=>{var t;n.isCancelled()?pxt.debug("sim: cancelled"):(this.clearSerial(),this.editor.setDiagnostics(this.editorFile,o),e.outfiles[pxtc.BINARY_JS]?n.isCancelled()||(pxt.debug("sim: run"),t=a.getData(Y.HIGHCONTRAST),p.run(q.mainPkg,i.debug,e,{mute:this.state.mute,highContrast:t,light:pxt.options.light,clickTrigger:i.clickTrigger,storedState:q.mainEditorPkg().getSimState(),autoRun:this.state.autoRun},i.trace),this.blocksEditor.setBreakpointsMap(e.breakpoints,e.procCallLocations),this.textEditor.setBreakpointsMap(e.breakpoints,e.procCallLocations),n.isCancelled()?(pxt.debug("sim: cancelled 2"),p.stop(),this.setState({simState:pxt.editor.SimState.Stopped})):this.setState({showParts:p.driver.hasParts()})):i.background||(g.warningNotification(lf("Oops, we could not run this project. Please check your code for errors.")),p.stop(),this.setState({simState:pxt.editor.SimState.Stopped})))}).finally(()=>{n.isCancelled()||n.resolveCancel(),n=null})}}openNewTab(t,i){if(t&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&!pxt.BrowserUtils.isIOS()){let e=window.location.href.replace(/#.*$/,"");i&&(e=e+(-1<e.indexOf("?")?"&":"?")+"nestededitorsim=1&lockededitor=1"),e+="#header:"+t.id;i=window.open(e,pxt.appTarget.id+t.id);i&&(pxt.log("dependent editor window registered"),p.driver.registerDependentEditor(i))}}createGitHubRepositoryAsync(){var{projectName:e,header:t}=this.state;return s.githubProvider(!0).createRepositoryAsync(e,t).then(e=>e&&this.reloadHeaderAsync())}simDebug(){pxt.tickEvent("menu.debug.sim"),this.stopSimulator(),this.runSimulator({debug:!0})}hwDebug(){pxt.tickEvent("menu.debug.hw");let e=Promise.resolve();return(e=this.state.simState==pxt.editor.SimState.Running&&p.driver.isDebug()?e:this.runSimulator({debug:!0})).then(()=>(p.driver.setHwDebugger({postMessage:e=>{pxt.HWDBG.handleMessage(e)}}),pxt.HWDBG.postMessage=e=>p.driver.handleHwDebuggerMsg(e),Promise.all([u.compileAsync({debug:!0,native:!0}),pxt.packetio.initAsync()]).then(e=>pxt.HWDBG.startDebugAsync(e[0],e[1]))))}toggleDebugging(){var e=!this.state.debugging;this.setState({debugging:e,debugFirstRun:e},()=>{this.setSimulatorFullScreen(!1),this.onDebuggingStart()})}onDebuggingStart(){this.renderCore(),this.editor&&(this.editor.updateBreakpoints(),this.editor.updateToolbox()),this.restartSimulator()}dbgPauseResume(){p.dbgPauseResume()}dbgStepOver(){p.dbgStepOver()}dbgStepInto(){p.dbgStepInto()}dbgInsertBreakpoint(){this.editor.insertBreakpoint()}editText(){this.editor!=this.textEditor&&(this.updateEditorFileAsync(this.textEditor).then(()=>{this.textEditor.editor.focus()}),this.forceUpdate())}hasCloudSync(){return this.isLoggedIn()}showScriptManager(){this.scriptManagerDialog.show()}importProjectDialog(){this.importDialog.show()}renderPythonAsync(e){return u.decompilePythonSnippetAsync(e.ts).then(e=>({python:e}))}blocksScreenshotAsync(e,t){return pxt.blocks.layout.screenshotEnabled()&&this.blocksEditor&&this.blocksEditor.isReady&&this.blocksEditor.editor?pxt.blocks.layout.screenshotAsync(this.blocksEditor.editor,e,t):Promise.resolve(void 0)}renderBlocksAsync(i){return u.getBlocksAsync().then(e=>u.decompileBlocksSnippetAsync(i.ts,e,i)).then(e=>{var e=pxt.blocks.render(e.outfiles[pxt.MAIN_BLOCKS],{snippetMode:i.snippetMode||!1,layout:void 0!==i.layout?i.layout:pxt.blocks.BlockLayout.Align,splitSvg:!1}),t=e.getAttribute("viewBox").split(/\s+/).map(e=>parseInt(e));return{svg:e,xml:pxt.blocks.layout.blocklyToSvgAsync(e,t[0],t[1],t[2],t[3])}})}launchFullEditor(){v.assert(pxt.shell.isSandboxMode());let t=pxt.appTarget.appTheme.embedUrl;/\/$/.test(t)||(t+="/");var e=q.mainPkg,e=q.getEditorPkg(e);pxt.shell.isReadOnly()?(e.header.pubId,t+="#pub:"+e.header.pubId,window.open(t,"_blank")):this.exportAsync().then(e=>{pxt.tickEvent("sandbox.openfulleditor"),t+="#project:"+e,window.open(t,"_blank")})}anonymousPublishAsync(n){pxt.tickEvent("publish"),this.setState({publishing:!0});const r=q.mainPkg,o=q.getEditorPkg(r);return this.saveProjectNameAsync().then(()=>this.saveFileAsync()).then(()=>r.filesToBePublishedAsync(!0)).then(e=>{var t,i;return o.header.pubCurrent&&!n?Promise.resolve(o.header.pubId):(t={description:r.config.description},(i=this.blocksEditor.contentSize())&&(t.blocksHeight=i.height,t.blocksWidth=i.width),m.anonymousPublishAsync(o.header,e,t,n).then(e=>e.id))}).finally(()=>{this.setState({publishing:!1})})}async anonymousPublishHeaderByIdAsync(e){var t=m.getHeader(e),e=await m.getTextAsync(e),i=JSON.stringify(e,null,2)+"\n",t={name:t.name,target:t.target,targetVersion:t.targetVersion,description:lf("Made with ❤️ in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:t.editor,text:e,meta:{versions:pxt.appTarget.versions,blocksHeight:0,blocksWidth:0}};return pxt.debug(`publishing script; ${i.length} bytes`),b.privatePostAsync("scripts",t,!0)}async saveLocalProjectsToCloudAsync(e){return f.saveLocalProjectsToCloudAsync(e)}async requestProjectCloudStatus(e){await f.requestProjectCloudStatus(e)}convertCloudProjectsToLocal(e){return f.convertCloudToLocal(e)}updateHeaderName(e){this.setState({projectName:e}),this.debouncedSaveProjectName||(this.debouncedSaveProjectName=v.debounce(()=>{this.saveProjectNameAsync()},pxt.options.light?2e3:500,!1)),this.debouncedSaveProjectName()}saveProjectNameAsync(){if(!this.state.projectName||!this.state.header)return Promise.resolve();try{return this.updateHeaderNameAsync(this.state.projectName)}catch(e){return pxt.reportException(e),Promise.resolve()}}updateHeaderNameAsync(e){if(q.mainPkg.config.name==e)return Promise.resolve();q.mainPkg.config.name=e,pxt.debug("saving project name to "+e);var t=q.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME),i=JSON.parse(t.content);return i.name=e,t.setContentAsync(pxt.Package.stringifyConfig(i)).then(()=>{this.state.header&&this.setState({projectName:e})})}isTextEditor(){return this.editor==this.textEditor}isPxtJsonEditor(){return this.editor==this.pxtJsonEditor}isBlocksEditor(){return this.editor==this.blocksEditor}loadBlocklyAsync(){return this.blocksEditor.loadBlocklyAsync()}createModalClasses(e){e=[e,-1!=this.rootClasses.indexOf("flyoutOnly")?"flyoutOnly":"",-1!=this.rootClasses.indexOf("inverted-theme")?"inverted-theme":"",-1!=this.rootClasses.indexOf("hideIteration")?"hideIteration":""];return z.cx(e)}showReportAbuse(){var e=this.state.tutorialOptions&&this.state.tutorialOptions.tutorialReportId||this.state.header&&this.state.header.pubCurrent&&this.state.header.pubId;l.showReportAbuseAsync(e)}showAboutDialog(){l.showAboutDialogAsync(this)}showLoginDialog(e){this.loginDialog.show(e)}showProfileDialog(e){this.profileDialog.show(e)}showShareDialog(e){this.shareEditor.show(e)}showLanguagePicker(){this.languagePicker.show()}showImportUrlDialog(){l.showImportUrlDialogAsync().then(e=>{e&&(pxt.github.isGithubId(e)?x:U)(e)},e=>{g.errorNotification(lf("Sorry, the project url looks invalid."))})}showImportGithubDialog(){l.showImportGithubDialogAsync().then(e=>{"NEW"===e?l.showCreateGithubRepoDialogAsync().then(e=>{e&&x(e)}):e&&x(e)},e=>{g.errorNotification(lf("Sorry, that repository looks invalid."))})}showImportFileDialog(t){l.showImportFileDialogAsync(t).then(e=>{e&&(pxt.tickEvent("app.open.file"),this.importFile(e,t))})}showResetDialog(){l.showResetDialogAsync().then(e=>e?Promise.resolve().then(()=>pxt.winrt.releaseAllDevicesAsync()).then(()=>(l.clearDontShowDownloadDialogFlag(),this.resetWorkspace())):Promise.resolve())}showExitAndSaveDialog(){var e;this.setState({debugging:!1}),this.isTutorial()?(pxt.tickEvent("tutorial.exit.home",{tutorial:null==(e=null==(e=this.state.header)?void 0:e.tutorial)?void 0:e.tutorial}),this.exitTutorialAsync().finally(()=>this.openHome())):this.state.projectName!==lf("Untitled")?this.openHome():this.exitAndSaveDialog.show()}askForProjectCreationOptionsAsync(){return this.newProjectDialog.promptUserAsync()}showPackageDialog(){this.scriptSearch.showExtensions()}showBoardDialogAsync(e,t){return this.scriptSearch.showBoardsAsync(e,t)}showModalDialogAsync(e){return g.dialogAsync({header:e.header,body:e.body,hasCloseIcon:!0,buttons:e.buttons})}showExperimentsDialog(){this.scriptSearch.showExperiments()}showChooseHwDialog(e){this.chooseHwDialog&&this.chooseHwDialog.show(e)}showRenameProjectDialogAsync(){var e;return!this.state.header||this.state.header.githubId?Promise.resolve(!1):(e={header:lf("Rename your project"),agreeLbl:lf("Save"),agreeClass:"green",placeholder:lf("Enter your project name here")},g.promptAsync(e).then(i=>null===i?Promise.resolve(!1):new Promise((e,t)=>{this.setState({projectName:i},()=>e())}).then(()=>this.saveProjectNameAsync()).then(()=>!0)))}loadActivityFromMarkdownAsync(i,t,n){const e=m.getHeader(i.split(":")[0]),r=!e&&pxt.Cloud.parseScriptId(i),o=!e&&!r&&pxt.github.parseRepoId(i);let a,s,l,c,d=!0,u={},p=!1;if(/^\//.test(i))a=t||i.split("/").reverse()[0].replace("-"," "),s=pxt.Cloud.markdownAsync(i).then(e=>(d=!0,h(e)));else if(r)pxt.tickEvent("tutorial.shared",{tutorial:r}),s=m.downloadFilesByIdAsync(r).then(e=>{var t=pxt.Package.parseAndValidConfig(e["pxt.json"]);return pxt.Util.jsonMergeFrom(u,t.dependencies),a=t.name||lf("Untitled"),d=!1,l=r,h(e["README.md"])});else if(o&&o.owner&&o.project)pxt.tickEvent("tutorial.github"),pxt.log("loading tutorial from "+o.fullName),s=pxt.packagesConfigAsync().then(t=>{switch(pxt.github.repoStatus(o,t)){case pxt.github.GitRepoStatus.Banned:throw lf("This GitHub repository has been banned.");case pxt.github.GitRepoStatus.Approved:l=void 0;break;default:l="https://github.com/"+o.slug}return(o.tag?Promise.resolve(o.tag):pxt.github.latestVersionAsync(o.slug,t,!0)).then(e=>{if(e)return o.tag=e,pxt.log(`tutorial ${o.fullName} tag: `+e),pxt.github.downloadPackageAsync(o.slug+"#"+o.tag,t);pxt.log("tutorial github tag not found at "+o.fullName)})}).then(e=>{var t=Promise.resolve();return e.files[pxt.TUTORIAL_INFO_FILE]&&t.then(()=>pxt.tutorial.parseCachedTutorialInfo(e.files[pxt.TUTORIAL_INFO_FILE],i)),t.then(()=>e&&f(o,e.files))});else if(e){pxt.tickEvent("tutorial.header"),p=!0;const t=pxt.github.parseRepoId(e.githubId),n=i.split(":")[1]||"README";s=m.getTextAsync(e.id).then(e=>f(t,e,n))}else s=Promise.resolve(void 0);return s.then(e=>({reportId:l,filename:a,autoChooseBoard:d,dependencies:u,features:c,temporary:p,md:e})).catch(e=>{g.handleNetworkError(e),g.errorNotification(lf("Oops, we could not load this activity.")),this.openHome()});function h(e){return e&&(n==pxt.JAVASCRIPT_PROJECT_NAME?e=e.replace(/^```(blocks|block|spy)\b/gm,"```typescript"):n==pxt.PYTHON_PROJECT_NAME&&(e=e.replace(/^```(blocks|block|typescript)\b/gm,"```spy")),pxt.Util.jsonMergeFrom(u,pxt.gallery.parsePackagesFromMarkdown(e)),c=pxt.gallery.parseFeaturesFromMarkdown(e),e)}function f(e,t,i){var n=pxt.Package.parseAndValidConfig(t["pxt.json"]);return n.files.find(e=>/\.ts$/.test(e))?(u={})[e.project]=pxt.github.toGithubDependencyPath(e.slug,e.tag):pxt.Util.jsonMergeFrom(u,n.dependencies),a=n.name||lf("Untitled"),d=!1,h(pxt.tutorial.resolveLocalizedMarkdown(e,t,i))}}startTutorialAsync(c,e,d,u,p,h){var t;return null!=(t=null==(t=this.state.header)?void 0:t.tutorial)&&t.tutorial&&(pxt.tickEvent("recipe.exit",{tutorial:null==(t=null==(t=this.state.header)?void 0:t.tutorial)?void 0:t.tutorial,goto:c}),pxt.tickEvent("tutorial.finish",{tutorial:null==(t=null==(t=this.state.header)?void 0:t.tutorial)?void 0:t.tutorial})),g.hideDialog(),g.showLoading("tutorial",lf("starting tutorial...")),S.initTutorial(),d=d&&!!this.state.header,this.loadActivityFromMarkdownAsync(c,e,u).then(e=>{const{filename:t,dependencies:i,temporary:n,reportId:r,autoChooseBoard:o,features:a,md:s}=e||{};if(!s)throw new Error(lf("Tutorial {0} not found",c));var{options:e,editor:l}=pxt.tutorial.getTutorialOptions(s,c,t,r,!!d),l=(this.hintManager.clearViewedHints(),e.mergeCarryoverCode=h,e.mergeHeaderId=p,u||l);if(d){const c=q.mainEditorPkg().header;return c.tutorial=e,c.tutorialCompleted=void 0,this.loadHeaderAsync(c)}return this.createProjectAsync({name:t,tutorial:e,preferredEditor:l,dependencies:i,temporary:n,skillmapProject:pxt.BrowserUtils.isSkillmapEditor()}).then(()=>o?this.autoChooseBoardAsync(a):Promise.resolve()).then(()=>this.postTutorialProgress())}).catch(e=>{pxt.reportException(e,{tutorialId:c}),g.warningNotification(lf("Please check your internet connection and check the tutorial is valid.")),this.openHome()}).finally(()=>g.hideLoading("tutorial"))}async startActivity(e){var{activity:t,path:i,editor:n,title:r,focus:o,importOptions:a}=e;switch(this.textEditor.giveFocusOnLoading=o,t){case"tutorial":pxt.tickEvent("tutorial.start",{tutorial:i,editor:n}),await this.startTutorialAsync(i,r,!1,n,e.previousProjectHeaderId,e.carryoverPreviousCode);break;case"recipe":pxt.tickEvent("recipe.start",{recipe:i,editor:n}),await this.startTutorialAsync(i,r,!0,n);break;case"example":pxt.tickEvent("example.start",{example:i,editor:n}),await this.importExampleAsync(Object.assign({name:r,path:i,preferredEditor:n},a))}}completeTutorialAsync(){pxt.tickEvent("tutorial.finish",{tutorial:null==(e=null==(e=this.state.header)?void 0:e.tutorial)?void 0:e.tutorial}),pxt.tickEvent("tutorial.complete",{tutorial:null==(e=null==(e=this.state.header)?void 0:e.tutorial)?void 0:e.tutorial}),g.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialCompleted();var e=this.state.header.tutorial;return e&&!this.state.header.isSkillmapProject&&(this.state.tutorialOptions&&this.state.tutorialOptions.tutorialRecipe?this.state.header.tutorialCompleted=void 0:this.state.header.tutorialCompleted={id:e.tutorial,steps:e.tutorialStepInfo.length},this.state.header.tutorial=void 0),pxt.BrowserUtils.isIE()?(this.exitTutorial(),Promise.resolve()):pxt.BrowserUtils.isSkillmapEditor()?this.exitTutorialAsync().finally(()=>{g.hideLoading("leavingtutorial")}):this.exitTutorialAsync().then(()=>{var e=q.mainEditorPkg().header;return this.loadHeaderAsync(e)}).finally(()=>{g.hideLoading("leavingtutorial"),this.postTutorialProgress()}).then(()=>{pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.appTheme.shareFinishedTutorials&&(pxt.tickEvent("tutorial.share",void 0,{interactiveConsent:!1}),this.showShareDialog(lf("Well done! Would you like to share your project?")))})}exitTutorial(e){var t;pxt.tickEvent("tutorial.exit",{tutorial:null==(t=null==(t=this.state.header)?void 0:t.tutorial)?void 0:t.tutorial}),g.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialExit(),this.exitTutorialAsync(e).finally(()=>{g.hideLoading("leavingtutorial"),this.openHome()})}async exitTutorialAsync(e){var t=q.mainEditorPkg().header,i=(t.isDeleted=e,q.mainEditorPkg().getAllFiles());try{await m.saveAsync(t,i),await v.delay(500)}catch(e){}finally{g.resetFocus(),await this.setStateAsync({tutorialOptions:void 0,tracing:void 0,editorState:void 0}),this.state.header&&await m.saveAsync(this.state.header)}}showTutorialHint(e){var t=this.refs[ee.tutorialCardId];t&&t.showHint(!0,e)}isTutorial(){return null!=this.state.tutorialOptions}onTutorialLoaded(){pxt.tickEvent("tutorial.editorLoaded"),this.postTutorialLoaded()}setEditorOffset(){if(this.isTutorial())if(pxt.BrowserUtils.useOldTutorialLayout()){var t=this.refs[ee.tutorialCardId];let e=0;this.state.editorState&&!1===this.state.editorState.hasCategories&&(e+=document.getElementById("headers").offsetHeight),t&&(t=Math.min(t.getCardHeight()+e,18*parseFloat(getComputedStyle(document.documentElement).fontSize)),this.setState({editorOffset:"calc("+t+"px + 2em)"}))}else{t=null===document||void 0===document?void 0:document.getElementById("editorSidebar");t&&pxt.BrowserUtils.isTabletSize()?this.setState({editorOffset:t.offsetHeight+"px"}):this.setState({editorOffset:void 0})}}saveTutorialTemplateAsync(){return q.mainEditorPkg().buildAssetsAsync().then(()=>q.mainPkg.saveToJsonAsync()).then(e=>{pxt.BrowserUtils.browserDownloadText(e.source,q.genFileName(".assets.mkcd"))})}pokeUserActivity(){this.state.tutorialOptions&&this.state.tutorialOptions.tutorial&&this.hintManager.pokeUserActivity(ee.tutorialCardId,this.state.tutorialOptions.tutorialStep,this.state.tutorialOptions.tutorialHintCounter)}stopPokeUserActivity(){this.hintManager.stopPokeUserActivity()}clearUserPoke(){this.setState({pokeUserComponent:null})}setHintSeen(e){this.hintManager.viewedHint(e)}tutorialCardHintCallback(){var e=this.state.tutorialOptions;e.tutorialHintCounter=e.tutorialHintCounter+1,this.setState({pokeUserComponent:ee.tutorialCardId,tutorialOptions:e}),setTimeout(()=>this.clearUserPoke(),1e4)}toggleHighContrast(){g.toggleHighContrast(),pxt.tickEvent("app.highcontrast",{on:g.getHighContrastOnce()?1:0}),this.isSimulatorRunning()&&this.startSimulator()}toggleGreenScreen(){var e=!this.state.greenScreen;pxt.tickEvent("app.greenscreen",{on:e?1:0}),this.setState({greenScreen:e})}toggleAccessibleBlocks(){this.setAccessibleBlocks(!this.state.accessibleBlocks)}setAccessibleBlocks(e){e?Blockly.navigation.enableKeyboardAccessibility():Blockly.navigation.disableKeyboardAccessibility(),this.setState({accessibleBlocks:e}),pxt.tickEvent("app.accessibleblocks",{on:e?1:0})}setBannerVisible(e){this.setState({bannerVisible:e})}hideLightbox(){this.setState({lightbox:!1})}showLightbox(){this.setState({lightbox:!0})}showKeymap(e){this.setState({keymap:e})}toggleKeymap(){this.state.keymap?this.showKeymap(!1):this.showKeymap(!0)}renderCore(){var e=this;if(Q=e,Z){for(;Z.length;)Z.shift()(e);Z=void 0}const t=pxt.appTarget.appTheme,i=pxt.appTarget.simulator,n=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!pxt.shell.isControllerMode(),r=pxt.shell.isSandboxMode(),o=!this.editor.isVisible||this.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME,a=!(r||t.hideSideDocs),s=this.state.tutorialOptions,l=!!s&&!!s.tutorial,c=pxt.appTarget.appTheme.sidebarTutorial,d=l&&!pxt.BrowserUtils.useOldTutorialLayout(),u=l&&s.tutorialStepExpanded,p=l&&s.metadata&&s.metadata.hideIteration,h=this.state.debugging,f=this.state.home&&!r,m=!!this.state.header&&!f,{lightbox:g,greenScreen:b,accessibleBlocks:v}=this.state,y=this.state.editorState&&!1===this.state.editorState.hasCategories,{hideEditorToolbar:w,transparentEditorToolbar:k}=t,x=t.hideMenuBar||p||d&&pxt.appTarget.appTheme.embeddedTutorial,E=i&&i.headless,C=t.selectLanguage,_=m&&!w&&this.editor.hasEditorToolbar(),S=pxt.appTarget.serial&&!!pxt.appTarget.serial.useEditor,T=a&&this.state.sideDocsLoadUrl&&!this.state.sideDocsCollapsed,A=_&&!f&&!r&&!t.simCollapseInMenu&&(!E||h)&&!d,N=this.state.hideEditorFloats||this.state.collapseEditorTools,I=!!t.logoWide,M=!r&&pxt.hasHwVariants(),B=(u||d)&&this.state.editorOffset?{top:this.state.editorOffset}:void 0,j=t.invertedMenu&&t.invertedMonaco,F=this.state.collapseEditorTools?lf("Show the simulator"):lf("Hide the simulator"),U=G.isNativeHost()||pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),O=this.getData(Y.HIGHCONTRAST);var P,D,L,R=["ui",g?"dimmable dimmed":"dimmable",N?"hideEditorFloats":"",this.state.collapseEditorTools?"collapsedEditorTools":"",k?"transparentEditorTools":"",j?"inverted-theme":"",this.state.fullscreen?"fullscreensim":"",this.state.showMiniSim?"miniSim":"",O?"hc":"",T?"sideDocs":"",pxt.shell.layoutTypeClass(),f?"inHome":"",l&&!d?"tutorial":"",u&&!d?"tutorialExpanded":"",d?"tabTutorial":"",c?"sidebarTutorial":"",h?"debugger":"",pxt.options.light?"light":"",pxt.BrowserUtils.isTouchEnabled()?"has-touch":"",x?"hideMenuBar":"",!_||k?"hideEditorToolbar":"",this.state.bannerVisible&&!f?"notificationBannerVisible":"",this.state.debugging?"debugging":"",r&&this.isEmbedSimActive()?"simView":"",U?"app":"",b?"greenscreen":"",I?"logo-wide":"",E?"headless":"",y?"flyoutOnly":"",p?"hideIteration":"",this.editor!=this.blocksEditor?"editorlang-text":"",this.editor==this.textEditor&&this.state.errorListState,"full-abs",pxt.appTarget.appTheme.embeddedTutorial?"tutorial-embed":""],R=(this.rootClasses=R,z.cx(R));return this.state.hasError?H.createElement("div",{id:"root",className:"ui middle aligned center aligned grid",style:{height:"100%",alignItems:"center"}},H.createElement("div",{className:"ui raised segment inverted purple"},H.createElement("h2",null,lf("Oops")),lf("We detected a problem and we will reload the editor in a few seconds.."))):(P=pxt.Util.isUserLanguageRtl(),P=(this.state.collapseEditorTools||P)&&!(this.state.collapseEditorTools&&P),D=!(r||l||this.isAssetsActive()||o||q.mainPkg&&q.mainPkg.config&&q.mainPkg.config.preferredEditor==pxt.BLOCKS_PROJECT_NAME),L=pxt.auth.hasIdentity(),H.createElement("div",{id:"root",className:R},b?H.createElement(le.WebCam,{close:this.toggleGreenScreen}):void 0,v&&H.createElement(ce.AccessibleBlocksInfo,null),x||f?void 0:H.createElement("header",{className:"menubar",role:"banner"},m?H.createElement(W.EditorAccessibilityMenu,{parent:this,highContrast:O}):void 0,H.createElement(pe.NotificationBanner,{parent:this}),H.createElement(X.HeaderBar,{parent:this})),c&&y&&l&&H.createElement(ie.SidebarTutorialCard,{ref:ee.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==ee.tutorialCardId}),l&&!d&&H.createElement("div",{id:"maineditor",className:r?"sandbox":"",role:"main"},!(c&&y)&&l&&H.createElement($.TutorialCard,{ref:ee.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==ee.tutorialCardId}),y&&H.createElement($.WorkspaceHeader,{parent:this})),H.createElement(ue.Sidepanel,{parent:this,inHome:f,showKeymap:this.state.keymap&&i.keymap,showSerialButtons:S,showFileList:D,showFullscreenButton:!E,collapseEditorTools:this.state.collapseEditorTools,simSerialActive:this.state.simSerialActive,devSerialActive:this.state.deviceSerialActive,showMiniSim:this.showMiniSim,openSerial:this.openSerial,handleHardwareDebugClick:this.hwDebug,handleFullscreenButtonClick:this.toggleSimulatorFullscreen,tutorialOptions:d?s:void 0,onTutorialStepChange:this.setTutorialStep,onTutorialComplete:this.completeTutorialAsync,setEditorOffset:this.setEditorOffset}),H.createElement("div",{id:"maineditor",className:(r?"sandbox":"")+(h?"debugging":""),role:"main","aria-hidden":f},A&&H.createElement(z.Button,{id:"computertogglesim",className:"computer only collapse-button large",icon:"inverted chevron "+(P?"right":"left"),title:F,onClick:this.toggleSimulatorCollapse}),this.allEditors.map(e=>e.displayOuter(B))),f?H.createElement("div",{id:"homescreen",className:"full-abs"},H.createElement("div",{className:"ui home projectsdialog"},H.createElement("header",{className:"menubar",role:"banner"},H.createElement(W.HomeAccessibilityMenu,{parent:this,highContrast:O}),H.createElement(X.HeaderBar,{parent:this})),H.createElement(J.Projects,{parent:this,ref:this.handleHomeRef}))):void 0,_&&H.createElement(ne.EditorToolbar,{ref:"editortools",parent:this}),a?H.createElement(K.SideDocs,{ref:"sidedoc",parent:this,sideDocsCollapsed:this.state.sideDocsCollapsed,docsUrl:this.state.sideDocsLoadUrl}):void 0,r?void 0:H.createElement(oe.ScriptSearch,{parent:this,ref:this.handleScriptSearchRef}),r?void 0:H.createElement(se.Extensions,{parent:this,ref:this.handleExtensionRef}),f?H.createElement(J.ImportDialog,{parent:this,ref:this.handleImportDialogRef}):void 0,L?H.createElement(re.LoginDialog,{parent:this,ref:this.handleLoginDialogRef}):void 0,L?H.createElement(de.ProfileDialog,{parent:this,ref:this.handleProfileDialogRef}):void 0,f&&t.scriptManager?H.createElement(ae.ScriptManagerDialog,{parent:this,ref:this.handleScriptManagerDialogRef,onClose:this.handleScriptManagerDialogClose}):void 0,r?void 0:H.createElement(J.ExitAndSaveDialog,{parent:this,ref:this.handleExitAndSaveDialogRef}),r?void 0:H.createElement(J.NewProjectDialog,{parent:this,ref:this.handleNewProjectDialogRef}),M?H.createElement(J.ChooseHwDialog,{parent:this,ref:this.handleChooseHwDialogRef}):void 0,r||!n?void 0:H.createElement(te.ShareEditor,{parent:this,ref:this.handleShareEditorRef,loading:this.state.publishing}),C?H.createElement(V.LanguagePicker,{parent:this,ref:this.handleLanguagePickerRef}):void 0,r?H.createElement(K.SandboxFooter,{parent:this}):void 0,x?H.createElement("div",{id:"editorlogo"},H.createElement("a",{className:"poweredbylogo"})):void 0,g?H.createElement(z.Dimmer,{isOpen:!0,active:g,portalClassName:"tutorial",className:"ui modal",shouldFocusAfterRender:!1,closable:!0,onClose:this.hideLightbox}):void 0))}}function B(){return Q}(e.ProjectView=ee).tutorialCardId="tutorialcard";e={workspace:m,require:o,core:g,getEditor:B,monaco:i,blocks:d,compiler:u,pkg:q,getsrc:function(){pxt.log(Q.editor.getCurrentSource())},sim:p,apiAsync:g.apiAsync,assembleCurrent:function(){u.compileAsync({native:!0}).then(()=>u.assembleAsync(Q.editorFile.content)).then(e=>{e=e.words;pxt.debug("["+e.map(e=>"0x"+e.toString(16)).join(",")+"]")})},log:function(e){console.log(e)},cloudsync:s};function k(){var e=/^#(\w+)(:([:\.\/\-\+\=\w]+))?/.exec(window.location.hash);return e?{cmd:e[1],arg:e[3]||""}:{cmd:"",arg:""}}function j(n,t){if(n){let i=Q;if(i)switch(F(n)&&i.setState({home:!1}),n.cmd){case"doc":pxt.tickEvent("hash.doc"),i.setSideDoc(n.arg,i.editor===i.blocksEditor);break;case"follow":return pxt.tickEvent("hash.follow"),i.newEmptyProject(void 0,n.arg),1;case"newproject":return pxt.tickEvent("hash.newproject"),i.newEmptyProject(),pxt.BrowserUtils.changeHash(""),1;case"newjavascript":return pxt.tickEvent("hash.newjavascript"),i.newProject({prj:pxt.appTarget.blocksprj,filesOverride:{[pxt.MAIN_BLOCKS]:""}}),pxt.BrowserUtils.changeHash(""),1;case"testproject":{pxt.tickEvent("hash.testproject");const t=n.arg,r=m.getHeader(t);if(r){const n=m.getHeaders().filter(e=>e.extensionUnderTest==r.id)[0];n?i.loadHeaderAsync(n):i.newProject({prj:pxt.appTarget.blocksprj,name:lf("test {0}",r.name),extensionUnderTest:t})}return pxt.BrowserUtils.changeHash(""),1}case"gettingstarted":return pxt.tickEvent("hash.gettingstarted"),i.newProject(),pxt.BrowserUtils.changeHash(""),1;case"tutorial":case"example":case"recipe":{pxt.tickEvent("hash."+n.cmd);let e,t=(y=n).arg;return/^([jt]s|py|blocks?):/i.test(t)&&(e=/^py:/i.test(t)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(t)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,t=t.substr(t.indexOf(":")+1)),i.startActivity({activity:n.cmd,path:t,editor:e,focus:!1}),pxt.BrowserUtils.changeHash("editor"),1}case"home":return pxt.tickEvent("hash.home"),i.openHome(),pxt.BrowserUtils.changeHash(""),1;case"sandbox":case"pub":case"edit":return pxt.tickEvent("hash."+n.cmd),pxt.BrowserUtils.changeHash(""),(/^(github:|https:\/\/github\.com\/)/.test(n.arg)?x:U)(n.arg),1;case"header":return pxt.tickEvent("hash."+n.cmd),pxt.BrowserUtils.changeHash(""),i.loadHeaderAsync(m.getHeader(n.arg)),1;case"sandboxproject":case"project":pxt.tickEvent("hash."+n.cmd);var e=v.stringToUint8Array(atob(n.arg));return pxt.BrowserUtils.changeHash(""),g.showLoading("loadingproject",lf("loading project...")),i.importProjectFromFileAsync(e).finally(()=>g.hideLoading("loadingproject")),1;case"reload":return t&&pxt.BrowserUtils.changeHash(""),0;case"skillmapimport":e=n.arg;return g.showLoading("skillmapimport",lf("loading project...")),i.importSkillmapProjectAsync(e).finally(()=>{pxt.BrowserUtils.changeHash(""),g.hideLoading("skillmapimport")}),1;case"github":{const t=pxt.github.parseRepoId(n.arg),[e,o]=n.arg.split(":",2),a=(pxt.BrowserUtils.changeHash(""),s.githubProvider());if(!a)return;if("create-repository"===e){const n=m.getHeader(o);if(n)return a.hasToken()&&(Q.loadHeaderAsync(n).then(()=>a.createRepositoryAsync(n.name,n)).then(e=>e&&Q.reloadHeaderAsync()),1)}else{if("import"===e)return l.showImportGithubDialogAsync(),1;if(t)return x(n.arg,!0),1}break}}}}function F(e){if(e)switch(e.cmd){case"follow":case"newproject":case"newjavascript":case"testproject":case"tutorial":case"example":case"recipe":case"projects":case"sandbox":case"pub":case"edit":case"sandboxproject":case"project":case"header":return 1;default:return}}async function x(t,i){if(!pxt.appTarget.appTheme.githubEditor||pxt.winrt.isWinRT()||pxt.BrowserUtils.isPxtElectron())g.warningNotification(lf("Importing GitHub projects not currently supported")),Q.openHome();else{g.showLoading("loadingheader",lf("importing GitHub project..."));try{t=pxt.github.normalizeRepoId(t);let e=m.getHeaders().find(e=>e.githubId&&pxt.github.normalizeRepoId(e.githubId)==t);if(!e){if(i&&!(await s.githubProvider(!0).routedLoginAsync(t)).accessToken)return void Q.openHome();e=await m.importGithubAsync(t)}e?await Q.loadHeaderAsync(e,null):Q.openHome()}catch(t){g.handleNetworkError(t),Q.openHome()}finally{g.hideLoading("loadingheader")}}}function U(e){g.showLoading("loadingheader",lf("loading project...")),m.installByIdAsync(e).then(e=>Q.loadHeaderAsync(e,null)).catch(e=>{Q.openHome(),g.handleNetworkError(e)}).finally(()=>g.hideLoading("loadingheader"))}window.E=e;const he=e=>{j(k(),!1)};function fe(){try{return/saveblocks=1/.test(window.location.href)&&q.mainPkg.readFile(pxt.MAIN_BLOCKS)}catch(e){}}function me(){try{return/save(?:as)?template=1/i.test(window.location.href)}catch(e){}}function ge(e){var t,i=null==(t=q.getEditorPkg(q.mainPkg))?void 0:t.getMainFile();switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return i.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return i.getVirtualFileName(pxt.PYTHON_PROJECT_NAME);case"assets":case"asset":return pxt.ASSETS_FILE;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return i.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME)}}pxt.winrt.captureInitialActivation(),document.addEventListener("DOMContentLoaded",async()=>{pxt.perf.recordMilestone("DOM loaded"),pxt.setupWebConfig(window.pxtConfig);const u=pxt.webConfig;pxt.options.debug=/dbg=1/i.test(window.location.href),pxt.options.debug&&(pxt.debug=console.debug),pxt.options.light=/light=1/i.test(window.location.href)||pxt.BrowserUtils.isARM()||pxt.BrowserUtils.isIE(),pxt.options.light&&pxsim.U.addClass(document.body,"light");var e=/wsport=(\d+)/i.exec(window.location.href);if(e?(pxt.options.wsPort=parseInt(e[1])||3233,pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],""))):pxt.options.wsPort=3233,pxt.perf.measureStart("setAppTarget"),q.setupAppTarget(window.pxtTargetBundle),pxt.setBundledApiInfo(window.pxtTargetBundle.apiInfo),pxt.perf.measureEnd("setAppTarget"),pxt.analytics.enable(),pxt.editor.enableControllerAnalytics(),e={},"undefined"!=typeof window&&(e["screen.width"]=(t=window.screen).width,e["screen.height"]=t.height,e["screen.availwidth"]=t.availWidth,e["screen.availheight"]=t.availHeight,e["screen.innerWidth"]=window.innerWidth,e["screen.innerHeight"]=window.innerHeight,e["screen.devicepixelratio"]=pxt.BrowserUtils.devicePixelRatio(),t=document.firstElementChild)&&(e["screen.clientWidth"]=t.clientWidth,e["screen.clientHeight"]=t.clientHeight),pxt.tickEvent("editor.loaded",e),pxt.BrowserUtils.isBrowserSupported()||/skipbrowsercheck=1/i.exec(window.location.href)){var t=v.parseQueryString(window.location.href);t.authcallback&&await Y.loginCallbackAsync(t),await Y.initAsync(),f.init(),s.loginCheck(),(e=v.parseQueryString((location.hash||"#").slice(1).replace(/%local_token/,"local_token"))).local_token&&(pxt.storage.setLocal("local_token",e.local_token),location.hash=location.hash.replace(/(%23)?[\#\&\?]*local_token.*/,"")),b.localToken=pxt.storage.getLocal("local_token")||"",y=k(),C.init(()=>Q.reloadEditor()),L.init(),pxt.hexloader.showLoading=e=>g.showLoading("hexcloudcompiler",e),pxt.hexloader.hideLoading=()=>g.hideLoading("hexcloudcompiler"),pxt.docs.requireMarked=()=>o("marked");const n=(e,t)=>Q.importHex(e,t),r=/^(https:\/\/[^/]+)/.exec(window.location.href);r&&(b.apiRoot=r[1]+"/api/"),t.hw&&(pxt.setHwVariant(t.hw),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"QUERY-"+pxt.hwVariant})),pxt.setCompileSwitches(t.compiler||t.compile);var e=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),i=pxt.shell.isControllerMode();let d=pxt.appTarget.appTheme;t.ws?m.setupWorkspace(t.ws):(d.allowParentController||i)&&pxt.BrowserUtils.isIFrame()?m.setupWorkspace("iframe"):e?m.setupWorkspace("mem"):pxt.winrt.isWinRT()?m.setupWorkspace("uwp"):pxt.BrowserUtils.isIpcRenderer()?m.setupWorkspace("idb"):pxt.BrowserUtils.isPxtElectron()?m.setupWorkspace("fs"):m.setupWorkspace("browser"),"iframe"===m.getWorkspaceType()&&pxt.auth.enableAuth(!1),Promise.resolve().then(async()=>{var e;const t=window.location.href;let i=!1;var n=null==(e=Y.userPreferences())?void 0:e.language;let r;if(Y.initialUserPreferencesAsync().then(e=>{var t=pxt.BrowserUtils.getCookieLang();t&&e&&e.language&&e.language!=t&&(pxt.BrowserUtils.setCookieLang(e.language),g.infoNotification(lf("Reload the page to apply your new language preference.")),pxt.tickEvent("identity.preferences.askingUserToReloadToApplyLang"))}),/[&?]translate=1/.test(t)&&!pxt.BrowserUtils.isIE())console.log("translation mode"),i=!0,pxt.Util.enableLiveLocalizationUpdates(),r=ts.pxtc.Util.TRANSLATION_LOCALE;else{const e=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href),u=(e&&0<=window.location.hash.indexOf(e[0])&&pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],"")),!(null==e||!e[1])),t=!(null==e||!e[2]),o=null==e?void 0:e[3],a=pxt.BrowserUtils.getCookieLang(),s=(r=o||n||a||d.defaultLocale||navigator.userLanguage||navigator.language,/staticlang=1/i.test(window.location.href)),g=pxt.appTarget.appTheme.defaultLocale,l=null==r?void 0:r.toLocaleLowerCase(),p=pxt.BrowserUtils.isLocalHostDev()&&(!l||(g?g.toLocaleLowerCase()===l:"en"===l||"en-us"===l)),c=pxt.BrowserUtils.isPxtElectron()||p;(s||c||d.disableLiveTranslations)&&!u||pxt.Util.enableLiveLocalizationUpdates(),i=t}const o=pxt.appTarget.id,a=u.commitCdnUrl,s=pxt.appTarget.versions.pxtCrowdinBranch,l=pxt.appTarget.versions.targetCrowdinBranch;return v.updateLocalizationAsync({targetId:o,baseUrl:a,code:r,pxtBranch:s,targetBranch:l,force:i}).then(()=>{pxt.Util.isLocaleEnabled(r)?(pxt.BrowserUtils.setCookieLang(r),V.setInitialLang(r)):pxt.tickEvent("unavailablelocale",{lang:r,force:i?"true":"false"}),pxt.tickEvent("locale",{lang:pxt.Util.userLanguage(),live:pxt.Util.liveLocalizationEnabled()?"true":"false"}),v.downloadTranslationsAsync(o,a,r,s,l,pxt.Util.liveLocalizationEnabled(),v.TranslationsKind.Sim).then(e=>e&&p.setTranslations(e))})}).then(()=>(pxt.BrowserUtils.initTheme(),((d=pxt.editor.experiments.syncTheme()).allowParentController||d.allowPackageExtensions||d.allowSimulatorTelemetry||pxt.shell.isControllerMode())&&pxt.editor.bindEditorMessages(w),m.initAsync().then(async e=>(await f.syncAsync(),e)))).then(e=>{E.render(H.createElement(ee,null),z.appElement),e&&Q.setState({editorState:e});{if(!pxt.appTarget.appTheme||!pxt.appTarget.appTheme.extendEditor)return Promise.resolve();pxt.debug("loading editor extensions...");const t={blocklyToolbox:c.getToolboxDefinition(),monacoToolbox:h.getToolboxDefinition(),projectView:Q};return pxt.BrowserUtils.loadScriptAsync("editor.js").then(()=>pxt.editor.initExtensionsAsync(t)).then(e=>{e.hexFileImporters&&e.hexFileImporters.forEach(e=>{pxt.debug(`	added hex importer `+e.id),Q.hexFileImporters.push(e)}),e.resourceImporters&&e.resourceImporters.forEach(e=>{pxt.debug(`	added resource importer `+e.id),Q.resourceImporters.push(e)}),e.beforeCompile&&(Q.beforeCompile=e.beforeCompile),e.toolboxOptions&&(e.toolboxOptions.blocklyToolbox&&c.overrideToolbox(e.toolboxOptions.blocklyToolbox),e.toolboxOptions.monacoToolbox)&&h.overrideToolbox(e.toolboxOptions.monacoToolbox),G.setExtensionResult(e)})}}).then(()=>G.initAsync()).then(()=>{pxt.debug("packetio: hook events"),pxt.packetio.configureEvents(()=>a.invalidate("packetio:*"),(e,t)=>{e=v.fromUTF8(v.uint8ArrayToString(e));window.postMessage({type:"serial",id:"n/a",data:e},"*")},(e,t)=>{var i=null==(i=pxt.appTarget.simulator)?void 0:i.messageSimulators;null!=i&&i[e]&&window.postMessage({type:"messagepacket",broadcast:!1,channel:e,data:t,sender:"packetio"},"*")}),window.addEventListener("message",e=>{const t=e.data;"messagepacket"===t.type&&"packetio"!==t.sender&&null!=(e=null==(e=pxt.appTarget.simulator)?void 0:e.messageSimulators)&&e[t.channel]&&pxt.packetio.sendCustomEventAsync(t.channel,t.data).then(()=>{},e=>{g.errorNotification(lf("{0}: {1}",t.channel,e.message))})},!1);var e=pxt.appTarget.serial&&pxt.appTarget.serial.useHF2&&pxt.winrt.isWinRT(),t=pxt.appTarget.serial&&pxt.BrowserUtils.isLocalHost()&&!!b.localToken;if((e||t||pxt.usb.isEnabled)&&!_.shouldUse()&&!pxt.usb.isEnabled){pxt.debug("initializing serial pipe");let e=new WebSocket(`ws://localhost:${pxt.options.wsPort}/${b.localToken}/serial`),i={};e.onopen=e=>{pxt.debug("serial: socket opened")},e.onclose=e=>{pxt.debug("serial: socket closed")},e.onerror=e=>{pxt.debug("serial: error")},e.onmessage=t=>{try{var e=JSON.parse(t.data);e&&"serial"==e.type&&pxt.Util.bufferSerial(i,e.data,e.id)}catch(e){pxt.debug("unknown message: "+t.data)}}}return window.addEventListener("hashchange",he),A.tryInit(),D.initElectron(Q),pxt.winrt.initAsync(n)}).then(()=>pxt.winrt.hasActivationProjectAsync()).then(e=>{var t=Q.shouldShowHomeScreen();if(t&&!e||Q.setState({home:!1}),y.cmd&&j(y,!0))return Promise.resolve();if(e)return pxt.winrt.loadActivationProject();if(pxt.shell.isNoProject())return pxt.editor.postHostMessageAsync({action:"newproject",options:{preferredEditor:"blocks"}}),Promise.resolve();if(t)return Promise.resolve();e=Q.settings.fileHistory.filter(e=>!!m.getHeader(e.id))[0];let i=m.getHeaders()[0];return(i=e?m.getHeader(e.id):i)?Q.loadHeaderAsync(i,Q.state.editorState):(Q.newProject(),Promise.resolve())}).catch(e=>{throw Q.handleCriticalError(e,"Failure in DOM loaded handler"),e}).then(()=>(pxsim.U.remove(document.getElementById("loading")),m.loadedAsync())),document.addEventListener("visibilitychange",async e=>{Q&&await Q.updateVisibilityAsync()}),window.addEventListener("unload",e=>{Q&&Q.saveSettings(),G.disconnectAsync()}),window.addEventListener("resize",e=>{Q&&Q.editor&&(Q.editor.resize(e),pxt.BrowserUtils.isIOS()&&setTimeout(()=>{Q.editor.resize(e)},1e3),!Q.isTutorial()||pxt.BrowserUtils.useOldTutorialLayout()?pxt.BrowserUtils.isTabletSize()?Q.showMiniSim(!0):Q.showMiniSim(!1):Q.isTutorial()&&Q.setEditorOffset())},!1);i=window.ipcRenderer;i&&i.on("responseFromApp",(e,t)=>{try{p.driver.postMessage(JSON.parse(t))}catch(e){}}),window.addEventListener("message",e=>{let t=e.data;if(t)if("parent"!=e.data.__proxy)if("tutorial"!=t.type&&"opendoc"!=t.type){if("sidedocready"===t.type&&pxt.BrowserUtils.isLocalHost()&&b.localToken)K.SideDocs.notify({type:"localtoken",localToken:b.localToken});else if("importfile"==t.type){const e=t;Q&&Q.importFile(new File(e.parts,e.filename))}}else Q&&Q.editor&&Q.handleMessage(t);else{pxt.debug("received parent proxy message"+e.data),delete e.data.__proxy;const t=window.ipcRenderer;t?t.sendToHost("sendToApp",e.data):window.parent&&window!=window.parent&&window.parent.postMessage(e.data,"*")}},!1),pxt.appTarget.appTheme.lockedEditor&&window.addEventListener("contextmenu",function(e){e.preventDefault()},!1)}else pxt.tickEvent("unsupported"),window.location.href="/browsers",g.showLoading("browsernotsupported",lf("Sorry, this browser is not supported."))})},{"./accessibility":1,"./accessibleblocks":2,"./appcache":4,"./auth":8,"./blocklyFieldView":9,"./blocks":10,"./blocksSnippets":11,"./cloud":14,"./cloudsync":15,"./cmds":16,"./compiler":18,"./components/assetEditor/editor":54,"./container":63,"./core":64,"./data":67,"./dialogs":74,"./draganddrop":75,"./editortoolbar":76,"./electron":77,"./extensions":80,"./gitjson":85,"./greenscreen":86,"./headerbar":87,"./hidbridge":88,"./hinttooltip":89,"./identity":91,"./lang":95,"./make":96,"./mergeProjects":99,"./monaco":100,"./monacoSnippets":105,"./notification":107,"./package":108,"./projects":109,"./pxtjson":110,"./screenshot":112,"./scriptmanager":113,"./scriptsearch":114,"./serial":115,"./share":117,"./sidebarTutorial":118,"./sidepanel":119,"./simulator":121,"./socketbridge":126,"./sounds":127,"./sui":129,"./tutorial":132,"./user":134,"./workspace":136,marked:230,react:320,"react-dom":276}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.init=void 0;const n=e("./core"),r=e("./cmds");i.init=function(i){"serviceWorker"in navigator&&!pxt.webConfig.isStatic&&!pxt.BrowserUtils.isLocalHost(!0)&&window.addEventListener("load",function(){const t=pxt.webConfig.relprefix.replace("---","").replace(/^\//,"");navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",e=>{e=e.data;"serviceworker"!==(null==e?void 0:e.type)||"activated"!==e.state||e.ref!==t||pxt.appTarget.appTheme&&pxt.appTarget.appTheme.noReloadOnUpdate||(n.infoNotification(lf("Update download complete. Reloading... ")),setTimeout(()=>{pxt.tickEvent("appcache.updated"),i()},3e3)),e&&r.handleServiceWorkerMessageAsync(e)}),navigator.serviceWorker.register(pxt.webConfig.serviceworkerjs).then(function(e){pxt.debug("ServiceWorker registration successful with scope: "+e.scope)},function(e){pxt.debug("ServiceWorker registration failed: "+e)})})}},{"./cmds":16,"./core":64}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetEditor=void 0;const n=e("react"),r=e("react-dom"),o=e("./components/ImageFieldEditor"),a=e("./components/TilemapFieldEditor"),s=e("./components/ImageEditor/store/imageReducer");document.addEventListener("DOMContentLoaded",()=>{var e;e=document.getElementById("asset-editor-field-div"),r.render(n.createElement(l,null),e)});class l extends n.Component{constructor(e){super(e),this.tilemapName="tilemap_asset",this.tileWidth=16,this.handleMessage=e=>{if(e.data._fromVscode)if("initialize"===e.data.type)switch(this.state.viewType){case"sprite":this.editor.loadJres(e.data.message);break;case"tilemap":this.tilemapName=e.data.name,this.tileWidth=e.data.tileWidth,this.initTilemap(e.data.message)}else"update"===e.data.type&&this.sendJres()},this.refHandler=e=>{this.editor=e,"tilemap"===this.state.viewType&&this.initTilemap()},this.callbackOnDoneClick=()=>{this.sendJres()};let t="sprite";e=/view(?:[:=])([a-zA-Z]+)/i.exec(window.location.href);e&&"tilemap"===e[1]&&(t="tilemap"),this.state={viewType:t},s.setTelemetryFunction(c)}postMessage(e){window.parent.postMessage(e,"*")}initTilemap(e){this.tilemapProject=new pxt.TilemapProject,this.tilemapProject.loadTilemapJRes(e?this.parseJres(e):{});let t=this.tilemapProject.getTilemap(this.tilemapName).data;if(!t){const[e,i]=this.tilemapProject.createNewTilemap(this.tilemapName,this.tileWidth,16,16);t=i,this.tilemapName=e}this.editor.init(t,this.callbackOnDoneClick)}updateTilemap(){var t=this.editor.getValue();if(t.deletedTiles)for(const o of t.deletedTiles)this.tilemapProject.deleteTile(o);if(t.editedTiles)for(const a of t.editedTiles){var e=t.tileset.tiles.findIndex(e=>e.id===a),i=t.tileset.tiles[e];i&&!i.id.startsWith("*")&&(t.tileset.tiles[e]=this.tilemapProject.updateTile(i))}for(let e=0;e<t.tileset.tiles.length;e++){var n,r=t.tileset.tiles[e];r.id.startsWith("*")?(n=this.tilemapProject.createNewTile(r.bitmap),t.tileset.tiles[e]=n):r.jresData||(t.tileset.tiles[e]=this.tilemapProject.resolveTile(r.id))}this.tilemapProject.updateTilemap(this.tilemapName,t)}componentDidMount(){window.addEventListener("message",this.handleMessage,null),this.postMessage({type:"ready",message:this.state.viewType}),c("asset-editor-shown")}componentWillUnmount(){window.removeEventListener("message",this.handleMessage,null)}sendJres(){let e;switch(this.state.viewType){case"sprite":e=this.editor.getJres();break;case"tilemap":this.updateTilemap();var t=this.tilemapProject.getProjectTilesetJRes(),t={jres:t,ts:pxt.emitTilemapsFromJRes(t)};e=JSON.stringify(t)}this.postMessage({type:"update",message:e})}parseJres(e){var t={},e=JSON.parse(e);return pxt.inflateJRes(e,t),t}render(){return"tilemap"===this.state.viewType?n.createElement(a.TilemapFieldEditor,{ref:this.refHandler}):n.createElement(o.ImageFieldEditor,{ref:this.refHandler,singleFrame:!0,doneButtonCallback:this.callbackOnDoneClick})}}function c(e){pxt.tickEvent("asset.editor",{action:e})}i.AssetEditor=l},{"./components/ImageEditor/store/imageReducer":37,"./components/ImageFieldEditor":43,"./components/TilemapFieldEditor":44,react:320,"react-dom":276}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getNewInternalID=i.lookupAsset=i.createTile=i.createProjectImage=i.createNewImageAsset=i.isNameTaken=void 0,i.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},i.createNewImageAsset=function(e,t,i,n){var r=pxt.react.getTilemapProject();switch(e){case"tile":return r.createNewTile(new pxt.sprite.Bitmap(t,i).data(),null,n);case"image":return r.createNewImage(t,i)}return null},i.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},i.createTile=function(e,t,i){return pxt.react.getTilemapProject().createNewTile(e,t,i)},i.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},i.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()}},{}],7:[function(e,t,i){"use strict";let n;function r(){return n=n||function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()}Object.defineProperty(i,"__esModule",{value:!0}),i.loadAsync=i.play=void 0,i.play=function(e,t=1){var i,n;e&&(i=r())&&((n=i.createBufferSource()).buffer=e,(e=i.createGain()).gain.value=t,n.connect(e),e.connect(i.destination),n.start(0))},i.loadAsync=function(i){const n=r();return new Promise((t,e)=>{n.decodeAudioData(i,e=>t(e),()=>{t(void 0)})})}},{}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.apiAsync=i.setImmersiveReaderPrefAsync=i.setLangaugePrefAsync=i.setHighContrastPrefAsync=i.patchUserPreferencesAsync=i.deleteProfileAsync=i.logoutAsync=i.loginCallbackAsync=i.loginAsync=i.initialUserPreferencesAsync=i.authCheckAsync=i.userPreferences=i.userProfile=i.loggedIn=i.hasIdentity=i.initAsync=i.Component=i.HAS_USED_CLOUD=i.READER=i.LANGUAGE=i.HIGHCONTRAST=i.USER_PREFERENCES=i.LOGGED_IN=i.USER_PROFILE=void 0;const n=e("./core"),r=e("./data"),o=e("./cloud");i.USER_PROFILE="auth:profile",i.LOGGED_IN="auth:logged-in";i.USER_PREFERENCES="user-pref:preferences",i.HIGHCONTRAST="user-pref:high-contrast",i.LANGUAGE="user-pref:language",i.READER="user-pref:reader",i.HAS_USED_CLOUD="has-used-cloud";class a extends r.Component{getUserProfile(){return this.getData(i.USER_PROFILE)}getUserPreferences(){return this.getData(i.USER_PREFERENCES)}isLoggedIn(){return this.getData(i.LOGGED_IN)}}i.Component=a;class s extends pxt.auth.AuthClient{async onSignedIn(){var e=this.getState();n.infoNotification(lf("Signed in: {0}",pxt.auth.userName(e.profile))),await o.syncAsync(),pxt.storage.setLocal(i.HAS_USED_CLOUD,"true")}onSignedOut(){return n.infoNotification(lf("Signed out")),Promise.resolve()}onSignInFailed(){return n.errorNotification(lf("Sign in failed. Something went wrong.")),Promise.resolve()}onUserProfileChanged(){var e=this.getState();return pxt.auth.generateUserProfilePicDataUrl(e.profile),r.invalidate("auth:*"),Promise.resolve()}onUserPreferencesChanged(e){for(const t of e)switch(t.path.join("/")){case"language":r.invalidate(i.LANGUAGE);break;case"highContrast":r.invalidate(i.HIGHCONTRAST);break;case"reader":r.invalidate(i.READER)}return Promise.resolve()}async onProfileDeleted(e){await o.convertCloudToLocal(e)}onStateLoaded(){var e=this.getState();return pxt.auth.generateUserProfilePicDataUrl(e.profile),r.invalidate("auth:*"),r.invalidate("user-pref:*"),Promise.resolve()}onApiError(e){return n.handleNetworkError(e),Promise.resolve()}onStateCleared(){return r.invalidate("auth:*"),Promise.resolve()}static authApiHandler(e){var t=pxt.auth.client();if(t){var e=r.stripProtocol(e),i=t.getState();switch(e){case"profile":return Object.assign({},i.profile);case"logged-in":return t.hasUserId()}}return null}static userPreferencesHandler(e){var t=pxt.auth.client();return t?(t.getState().preferences||t.initialUserPreferencesAsync().then(()=>{}),s.internalUserPreferencesHandler(e)):null}static internalUserPreferencesHandler(e){var t,i=pxt.auth.client();if(i){var n=i.getState();switch(r.stripProtocol(e)){case"preferences":return Object.assign({},n.preferences);case"high-contrast":return null!=(t=null==(t=n.preferences)?void 0:t.highContrast)?t:pxt.auth.DEFAULT_USER_PREFERENCES().highContrast;case"language":return null!=(t=null==(t=n.preferences)?void 0:t.language)?t:pxt.auth.DEFAULT_USER_PREFERENCES().language;case"reader":return null!=(t=null==(t=n.preferences)?void 0:t.reader)?t:pxt.auth.DEFAULT_USER_PREFERENCES().reader}return n.preferences}return null}}let l;async function c(){if(pxt.auth.hasIdentity())return l=l||new Promise(async(e,t)=>{var i=new s;await i.initAsync(),await i.authCheckAsync(),await i.initialUserPreferencesAsync(),e(i)})}async function d(e){var t=await c();await(null==t?void 0:t.patchUserPreferencesAsync(e))}i.initAsync=async function(){r.mountVirtualApi("user-pref",{getSync:s.userPreferencesHandler}),r.mountVirtualApi("auth",{getSync:s.authApiHandler});var e=await c();await(null==e?void 0:e.authCheckAsync())},i.hasIdentity=function(){return pxt.auth.hasIdentity()},i.loggedIn=function(){return r.getData(i.LOGGED_IN)},i.userProfile=function(){return r.getData(i.USER_PROFILE)},i.userPreferences=function(){return r.getData(i.USER_PREFERENCES)},i.authCheckAsync=async function(){var e=await c();return null==e?void 0:e.authCheckAsync()},i.initialUserPreferencesAsync=async function(){var e=await c();return null==e?void 0:e.initialUserPreferencesAsync()},i.loginAsync=async function(e,t,i){var n=await c();await(null==n?void 0:n.loginAsync(e,t,i))},i.loginCallbackAsync=async function(e){await pxt.auth.loginCallbackAsync(e)},i.logoutAsync=async function(){var e=await c();await(null==e?void 0:e.logoutAsync("#"))},i.deleteProfileAsync=async function(){var e=await c();await(null==e?void 0:e.deleteProfileAsync())},i.patchUserPreferencesAsync=d,i.setHighContrastPrefAsync=async function(e){await d({op:"replace",path:["highContrast"],value:e})},i.setLangaugePrefAsync=async function(e){await d({op:"replace",path:["language"],value:e})},i.setImmersiveReaderPrefAsync=async function(e){await d({op:"replace",path:["reader"],value:e})},i.apiAsync=async function(e,t,i){var n=await c();return null==n?void 0:n.apiAsync(e,t,i)}},{"./cloud":14,"./core":64,"./data":67}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dismissIfVisible=i.init=i.setContainerClass=i.setEditorBounds=i.FieldEditorView=void 0;const r=e("react"),n=e("react-dom"),o=e("./components/ImageFieldEditor"),a=e("./package");let s,l;class c{constructor(e){this.contentDiv=e,this.resizeContentCore=()=>{this.resizeFrameRef=void 0;var e=this.editorBounds;let t=25,i=25;e.width-2*t<500&&(t=0,i=0),e.height-2*i<610&&(i=(i=Math.min(e.height-610,0)/2)<0?0:i,t=0),t=null!=e.horizontalPadding?e.horizontalPadding:t,i=null!=e.horizontalPadding?e.verticalPadding:i,this.contentBounds={left:e.left+t,top:e.top+i,width:e.width-2*t,height:e.height-2*i},this.contentDiv.style.left=this.contentBounds.left+"px",this.contentDiv.style.top=this.contentBounds.top+"px",this.contentDiv.style.width=this.contentBounds.width+"px",this.contentDiv.style.height=this.contentBounds.height+"px",this.overlayDiv.style.left=e.left+"px",this.overlayDiv.style.top=e.top+"px",this.overlayDiv.style.width=e.width+"px",this.overlayDiv.style.height=e.height+"px",this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize()},this.handleOutsideClick=e=>{var t,i,n;this.contentBounds&&(t=e.clientX,i=e.clientY,n=this.contentBounds,t<n.left||t>n.left+n.width||i<n.top||i>n.top+n.height)&&(e.stopPropagation(),this.hide())}}injectElement(e){n.render(e,this.contentDiv)}setRef(e){(this.componentRef=e)&&this.persistentData&&(e.restorePersistentData(this.persistentData),this.persistentData=void 0)}show(){!this.visible&&this.contentDiv&&(this.visible=!0,this.resize(this.editorBounds),this.contentDiv.style.display="",this.overlayDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.overlayDiv,"blocks-editor-field-overlay"),this.contentDiv.parentElement.appendChild(this.overlayDiv),this.overlayDiv.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("mousedown",this.handleOutsideClick))}hide(){var e,t;this.visible&&this.contentDiv&&(null!=(t=null==(e=this.componentRef)?void 0:e.shouldPreventHide)&&t.call(e)||(this.visible=!1,this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.clearContents(),this.contentDiv.style.display="none",this.overlayDiv.parentElement.removeChild(this.overlayDiv),document.removeEventListener("mousedown",this.handleOutsideClick),this.hideCallback&&this.hideCallback()))}onHide(e){this.hideCallback=e}getResult(){return this.componentRef?this.componentRef.getValue():void 0}resize(e){this.editorBounds=e,this.visible&&(this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.resizeFrameRef=requestAnimationFrame(this.resizeContentCore))}dispose(){this.contentDiv&&(this.hide(),this.contentDiv=null)}getPersistentData(){return this.componentRef.getPersistentData()}restorePersistentData(e){this.componentRef?this.componentRef.restorePersistentData(e):this.persistentData=e}setContainerClass(e){this.contentDiv&&this.contentDiv.classList.contains(this.containerClass)&&this.contentDiv.classList.remove(this.containerClass),this.containerClass=e,this.updateContainerClass()}clearContents(){for(n.unmountComponentAtNode(this.contentDiv);this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild)}updateContainerClass(){this.contentDiv&&this.containerClass&&(this.contentDiv.classList.contains(this.containerClass)||this.contentDiv.classList.add(this.containerClass))}}function d(){l&&l.dispose(),l=void 0}i.FieldEditorView=c,i.setEditorBounds=function(e){l&&l.resize(e),s=e},i.setContainerClass=function(e){l&&l.setContainerClass(e)},i.init=function(){pxt.react.getFieldEditorView=function(e,t,i){l&&l.dispose();var n=e=>{e&&l&&(l.setRef(e),e.init(t,d,i))};switch(l=new c(document.getElementById("blocks-editor-field-div")),e){case"image-editor":l.injectElement(r.createElement(o.ImageFieldEditor,{ref:n,singleFrame:!0}));break;case"animation-editor":l.injectElement(r.createElement(o.ImageFieldEditor,{ref:n,singleFrame:!1}));break;case"tilemap-editor":l.injectElement(r.createElement(o.ImageFieldEditor,{ref:n,singleFrame:!0}))}return s&&l.resize(s),l},pxt.react.getTilemapProject=()=>{var e=a.mainEditorPkg();return e.tilemapProject||(e.tilemapProject=new pxt.TilemapProject,e.tilemapProject.loadPackage(a.mainPkg)),e.tilemapProject}},i.dismissIfVisible=d},{"./components/ImageFieldEditor":43,"./package":108,react:320,"react-dom":276}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const r=e("react"),o=e("react-dom"),a=e("./package"),s=e("./core"),n=e("./toolboxeditor"),l=e("./compiler"),c=e("./toolbox"),d=e("./blocksSnippets"),u=e("./workspace"),p=e("./simulator"),h=e("./dialogs"),f=e("./blocklyFieldView"),m=e("./createFunction"),g=e("./snippetBuilder");var b=pxt.Util;const v=e("./debuggerToolbox"),y=e("./errorList"),w=e("./extensionManager");class k extends n.ToolboxEditor{constructor(e){super(e),this.isFirstBlocklyLoad=!0,this.functionsDialog=null,this.showCategories=!0,this.errorChangesListeners={},this.handleKeyDown=e=>{var t;null!=(t=this.parent.state)&&t.accessibleBlocks&&84===("number"==typeof e.which?e.which:e.keyCode)&&(this.focusToolbox(),e.stopPropagation())},this.markIncomplete=!1,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebuggerToolboxRef=e=>{this.debuggerToolbox=e},this.flyoutBlockXmlCache={},this.flyoutXmlList=[],this.flyouts={},this.listenToBlockErrorChanges=this.listenToBlockErrorChanges.bind(this),this.onErrorListResize=this.onErrorListResize.bind(this)}setBreakpointsMap(e,t){let i={};e&&this.compilationResult&&(e.forEach(e=>{var t=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});t&&(i[t]=e.id)}),this.breakpointsByBlock=i)}setBreakpointsFromBlocks(){this.breakpointsSet=this.getBreakpoints(),p.driver.setBreakpoints(this.breakpointsSet)}getBreakpoints(){const t=[],i=this.breakpointsByBlock;return i&&this.editor&&this.editor.getAllBlocks().forEach(e=>{i[e.id]&&e.isBreakpointSet()&&t.push(this.breakpointsByBlock[e.id])}),t}addBreakpointFromEvent(e){this.breakpointsSet.push(this.breakpointsByBlock[e]),p.driver.setBreakpoints(this.breakpointsSet)}removeBreakpointFromEvent(e){let t=this.breakpointsByBlock[e];this.breakpointsSet.filter(e=>e!=t),p.driver.setBreakpoints(this.breakpointsSet)}clearBreakpoints(){p.driver.setBreakpoints([])}setVisible(e){super.setVisible(e),this.isVisible=e;e="#blocksEditor .blocklyToolboxDiv, #blocksEditor .blocklyWidgetDiv, #blocksEditor .blocklyToolboxDiv";this.isVisible?(pxt.Util.toArray(document.querySelectorAll(e)).forEach(e=>e.style.display=""),this.parent.fireResize()):(pxt.Util.toArray(document.querySelectorAll(e)).forEach(e=>e.style.display="none"),this.editor&&Blockly.hideChaff(),this.toolbox&&this.toolbox.clearExpandedItem())}saveToTypeScriptAsync(i=!1){if(!this.typeScriptSaveable)return Promise.resolve(void 0);this.clearHighlightedStatements();try{return pxt.blocks.compileAsync(this.editor,this.blockInfo,{emitTilemapLiterals:i}).then(e=>{this.compilationResult=e,pxt.tickEvent("activity.blocks.compile");let t=Promise.resolve();return i&&this.parent&&(x(this.editor,e=>e.clearTemporaryAssetData()),t=this.parent.saveCurrentSourceAsync().then(()=>{x(this.editor,e=>e.disposeOfTemporaryAsset())})),t.then(()=>this.compilationResult.source)})}catch(i){return pxt.reportException(i),s.errorNotification(lf("Sorry, we were not able to convert this program.")),Promise.resolve(void 0)}}domUpdate(){if(this.delayLoadXml&&!this.loadingXml){pxt.debug("loading blockly"),pxt.perf.measureStart("domUpdate loadBlockly"),this.loadingXml=!0;const i=document.createElement("div");i.className="ui active dimmer";var t=document.createElement("div");t.className="ui text loader",t.appendChild(document.createTextNode(lf("Loading blocks..."))),i.appendChild(t);let e=document.getElementById("blocksEditor");e.appendChild(i),l.clearCaches(),this.loadingXmlPromise=this.loadBlocklyAsync().then(()=>l.getBlocksAsync()).then(e=>{this.blockInfo=e,pxt.blocks.initialize(this.blockInfo),this.nsMap=this.partitionBlocks(),this.refreshToolbox(),pxt.debug("loading block workspace");e=this.delayLoadXml;this.delayLoadXml=void 0,this.loadBlockly(e),this.resize(),Blockly.svgResize(this.editor),this.isFirstBlocklyLoad=!1}).finally(()=>{try{e.removeChild(i)}catch(e){}this.loadingXml=!1,this.loadingXmlPromise=null,pxt.perf.measureEnd("domUpdate loadBlockly"),this.parent.isTutorial()&&this.parent.onTutorialLoaded()})}}isDropdownDivVisible(){return"undefined"!=typeof Blockly&&Blockly.DropDownDiv&&Blockly.DropDownDiv.isVisible()}beforeCompile(){"undefined"!=typeof Blockly&&(Blockly.DropDownDiv.hide(),Blockly.WidgetDiv.hide())}getTemporaryAssets(){return this.editor?pxtblockly.getTemporaryAssets(this.editor,"image").concat(pxtblockly.getTemporaryAssets(this.editor,"animation")):[]}updateTemporaryAsset(e){this.editor.getBlockById(e.meta.temporaryInfo.blockId).getField(e.meta.temporaryInfo.fieldName).updateAsset(e)}saveBlockly(){return this.delayLoadXml||this.serializeBlocks()}serializeBlocks(e){let t=pxt.blocks.saveWorkspaceXml(this.editor,!e&&this.parent.state&&this.parent.state.header&&!!this.parent.state.header.githubId);return e&&(t=t.replace(/(x|y|id)="[^"]*"/g,"")),pxt.debug(t),t}loadBlockly(e){if(this.serializeBlocks()==e)return this.typeScriptSaveable=!0,pxt.debug("blocks already loaded..."),!1;this.typeScriptSaveable=!1,pxt.blocks.clearWithoutEvents(this.editor);try{var t=e||`<block type="${ts.pxtc.ON_START_TYPE}"></block>`,i=Blockly.Xml.textToDom(t);pxt.blocks.domToWorkspaceNoEvents(i,this.editor),pxtblockly.upgradeTilemapsInWorkspace(this.editor,pxt.react.getTilemapProject()),this.initLayout(),this.editor.clearUndo(),this.reportDeprecatedBlocks(),this.updateGrayBlocks(),this.typeScriptSaveable=!0}catch(e){return pxt.log(e),pxt.blocks.clearWithoutEvents(this.editor),this.switchToTypeScript(),this.changeCallback(),!1}return this.changeCallback(),!0}initLayout(){let n,r,o=!1,e=!this.editor.toolbox_&&this.editor.flyout_,a=(this.editor.getTopComments(!1).forEach(e=>{var e=e.getBoundingRectangle(),t=Math.sqrt(e.left*e.left+e.top*e.top);(void 0===n||t<n)&&(r=e,n=t),o=o||10==e.left&&10==e.top}),[]);this.editor.getTopBlocks(!1).forEach(e=>{const t=e.getBoundingRectangle(),i=Math.sqrt(t.left*t.left+t.top*t.top);(void 0===n||i<n)&&(r=t,n=i);e=!!a.find(e=>e.left===t.left&&e.top===t.top);o=o||e,a.push(t)}),o&&!e?pxt.blocks.layout.flow(this.editor,{useViewWidth:!0}):(r&&(this.editor.getTopComments(!1).forEach(e=>e.moveBy(-r.left,-r.top)),this.editor.getTopBlocks(!1).forEach(e=>e.moveBy(-r.left,-r.top))),this.editor.scrollX=10,this.editor.scrollY=10,this.editor.resizeContents())}initPrompts(){Blockly.alert=function(e,t){return s.confirmAsync({hideCancel:!0,header:lf("Alert"),agreeLbl:lf("Ok"),agreeClass:"positive",agreeIcon:"checkmark",body:e,size:"tiny"}).then(()=>{t&&t()})},Blockly.confirm=function(e,t){return s.confirmAsync({header:lf("Confirm"),body:e,agreeLbl:lf("Yes"),agreeClass:"positive",agreeIcon:"checkmark",disagreeLbl:lf("No"),disagreeClass:"cancel",disagreeIcon:"cancel",size:"tiny"}).then(e=>{t(1==e)})},Blockly.prompt=function(e,t,i,n){return s.promptAsync(Object.assign({header:e,initialValue:t,agreeLbl:lf("Ok"),hasCloseIcon:!0,size:"tiny"},n)).then(e=>{i(e)})},pxt.Util.isTranslationMode()&&(pxt.blocks.promptTranslateBlock=h.promptTranslateBlock)}initBlocklyToolbox(){let e=this;const t=Blockly.Toolbox.prototype.position,i=(Blockly.Toolbox.prototype.position=function(){t.call(this),e.resizeToolbox()},this),n=(Blockly.WorkspaceSvg.prototype.refreshToolboxSelection=function(){var e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.flyout_&&i.toolbox.refreshSelection()},Blockly.hideChaff);Blockly.hideChaff=function(e){n(e),e||i.hideFlyout()}}initWorkspaceSounds(){const i=this,n=Blockly.WorkspaceAudio.prototype.play;Blockly.WorkspaceAudio.prototype.play=function(e,t){i&&i.parent.state.mute&&(t=0),n.call(this,e,t)}}initAccessibleBlocks(){var e;null!=(e=pxt.appTarget.appTheme)&&e.accessibleBlocks&&document.querySelector("#blocksEditor").addEventListener("keydown",this.handleKeyDown);const i=this,n=Blockly.navigation.onBlocklyAction;Blockly.navigation.onBlocklyAction=function(e){var t;return!(null==(t=pxt.appTarget.appTheme)||!t.accessibleBlocks)&&(i.editor.keyboardAccessibilityMode||e.name!==Blockly.navigation.actionNames.TOGGLE_KEYBOARD_NAV||i.parent.setState({accessibleBlocks:!0}),n(e))}}reportDeprecatedBlocks(){const t={};let i=!1;this.blockInfo.blocks.forEach(e=>{e.attributes.deprecated&&(t[e.attributes.blockId]=0)}),this.editor.getAllBlocks().forEach(e=>{0<=t[e.type]&&(t[e.type]++,i=!0)});for(const i in t)0!==t[i]&&pxt.tickEvent("blocks.usingDeprecated",{block:i,count:t[i]})}contentSize(){return this.editor?pxt.blocks.blocksMetrics(this.editor):void 0}isIncomplete(){var e=this.editor&&this.editor.currentGesture_&&this.editor.currentGesture_.isDraggingBlock_;return e&&(this.markIncomplete=!0),e}prepare(){this.isReady=!0}prepareBlockly(e){pxt.perf.measureStart("prepareBlockly");var t=document.getElementById("blocksEditor");if(t){pxsim.U.clear(t),this.editor=Blockly.inject(t,this.getBlocklyOptions(e)),this.editor.options.hasCategories;t=Blockly.Colours;b.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyColors||{}),Blockly.Colours=t;let i=!1;this.editor.addChangeListener(e=>{var t;Blockly.Events.disableOrphans(e),"ui"==e.type&&!this.markIncomplete||(this.changeCallback(),this.markIncomplete=!1),"create"==e.type?("variables_set"==(t=e.xml.getAttribute("type"))&&this.clearFlyoutCaches(),t!==pxtc.TS_STATEMENT_TYPE&&t!==pxtc.TS_OUTPUT_TYPE||this.updateGrayBlocks(),pxt.tickEvent("blocks.create",{block:t},{interactiveConsent:!0}),"SHADOW"==e.xml.tagName&&this.cleanUpShadowBlocks(),this.parent.state.tutorialOptions&&this.parent.state.tutorialOptions.metadata&&this.parent.state.tutorialOptions.metadata.flyoutOnly||this.parent.setState({hideEditorFloats:!1}),u.fireEvent({type:"create",editor:"blocks",blockId:t})):"var_create"==e.type||"var_rename"==e.type||"delete"==e.type?this.clearFlyoutCaches():"ui"==e.type&&("category"==e.element?((t=!!e.newValue)&&pxt.setInteractiveConsent(!0),this.parent.setState({hideEditorFloats:t})):"breakpointSet"==e.element?this.setBreakpointsFromBlocks():"melody-editor"==e.element&&(e.newValue?(i=this.parent.state.simState!=pxt.editor.SimState.Stopped,this.parent.stopSimulator()):i&&this.parent.startSimulator())),null!=this.parent.state.tutorialOptions&&this.parent.pokeUserActivity()}),this.shouldShowCategories()&&this.renderToolbox(),this.hideFlyout(),this.initPrompts(),this.initBlocklyToolbox(),this.initWorkspaceSounds(),this.initAccessibleBlocks(),this.resize(),pxt.perf.measureEnd("prepareBlockly")}}resize(e){this.getBlocksAreaDiv()&&this.getBlocksEditorDiv()&&this.editor&&(Blockly.svgResize(this.editor),this.resizeToolbox(),this.resizeFieldEditorView())}resizeToolbox(){var e;this.getBlocksEditorDiv()&&(e=this.getBlocklyToolboxDiv())&&(this.parent.isBlocksActive()&&this.parent.updateEditorLogo(e.offsetWidth),this.getBlocklyOptions(this.showCategories).horizontalLayout||(e.style.height="100%"))}resizeFieldEditorView(){var e;window&&((e=this.getBlocksEditorDiv())&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()?(e=e.getBoundingClientRect(),f.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height})):f.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight}))}hasUndo(){return!!this.editor&&(0!=this.editor.undoStack_.length||0==this.editor.undoStack_.length&&0==this.editor.redoStack_.length)}undo(){this.editor&&(this.editor.undo(!1),Blockly.hideChaff(),this.parent.forceUpdate())}hasRedo(){return!!this.editor&&0!=this.editor.redoStack_.length}redo(){this.editor&&(this.editor.undo(!0),Blockly.hideChaff(),this.parent.forceUpdate())}zoomIn(){this.editor&&this.editor.zoomCenter(.8)}zoomOut(){this.editor&&this.editor.zoomCenter(-.8)}setScale(e){this.editor&&e!=this.editor.scale&&this.editor.setScale(e)}closeFlyout(){this.editor&&this.hideFlyout()}getId(){return"blocksArea"}display(){var e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=pxt.appTarget.appTheme.blocksErrorList;return r.createElement("div",{className:"blocksAndErrorList"},r.createElement("div",{className:"blocksEditorOuter"},r.createElement("div",{id:"blocksEditor"}),r.createElement(c.ToolboxTrashIcon,{flyoutOnly:e})),t&&r.createElement(y.ErrorList,{isInBlocksEditor:!0,listenToBlockErrorChanges:this.listenToBlockErrorChanges,onSizeChange:this.onErrorListResize}))}onErrorListResize(){this.parent.fireResize()}listenToBlockErrorChanges(e,t){this.errorChangesListeners[e]=t}onBlockErrorChanges(e){for(var t of pxt.U.values(this.errorChangesListeners))t(e)}async validateTutorialCode(e){var t=e["tutorialStep"],i=this.editor.getAllBlocks(),e=await pxt.tutorial.validate(e,i,this.blockInfo);this.parent.setTutorialCodeStatus(t,e)}getBlocksAreaDiv(){return document.getElementById("blocksArea")}getBlocksEditorDiv(){return this.getBlocksAreaDiv()?document.getElementById("blocksEditor"):void 0}getBlocklyToolboxDiv(){var e=this.getBlocksAreaDiv();return e?e.getElementsByClassName("blocklyToolboxDiv")[0]:void 0}moveFocusToFlyout(){var e,t=this.editor.toolbox_.getFlyout();t&&null!=(e=this.parent.state)&&e.accessibleBlocks&&(Blockly.navigation.focusFlyout_(),t.svgGroup_.focus())}focusToolbox(){this.toolbox&&this.toolbox.focus()}renderToolbox(e){var t,i;pxt.shell.isReadOnly()||(t=this.getBlocklyToolboxDiv(),i=r.createElement("div",{className:"blocklyToolbox"},r.createElement(c.Toolbox,{ref:this.handleToolboxRef,editorname:"blocks",parent:this}),r.createElement("div",{id:"debuggerToolbox"})),b.assert(!!t),o.render(i,t),e)||this.toolbox.showLoading()}updateToolbox(){var e,t,i=document.getElementById("debuggerToolbox");i&&(pxt.perf.measureStart("updateToolbox"),t=(e=!!this.parent.state.debugging)?r.createElement(v.DebuggerToolbox,{ref:this.handleDebuggerToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName}):r.createElement("div",null),e?(this.toolbox.hide(),null!=(e=Blockly.selected)&&e.unselect()):(this.debuggerToolbox=null,this.toolbox.show()),o.render(t,i),pxt.perf.measureEnd("updateToolbox"))}showPackageDialog(){pxt.tickEvent("blocks.addpackage"),this.editor.toolbox_&&this.editor.toolbox_.clearSelection(),this.parent.showPackageDialog()}showVariablesFlyout(){this.showFlyoutInternal_(Blockly.Variables.flyoutCategory(this.editor),"variables")}showFunctionsFlyout(){this.showFlyoutInternal_(Blockly.Functions.flyoutCategory(this.editor),"functions")}getViewState(){return{}}setViewState(e){}getCurrentSource(){return this.editor&&!this.delayLoadXml?this.saveBlockly():this.currSource}acceptsFile(e){return"blocks"==e.getExtension()}overrideFile(e){this.delayLoadXml?(this.delayLoadXml=e,this.currSource=e):this.loadBlockly(e)}insertBreakpoint(){var e,t;this.editor&&(e=this.editor.newBlock(pxtc.TS_DEBUGGER_TYPE),t=this.editor.getMetrics(),e.moveBy(t.viewWidth/2,t.viewHeight/3),e.initSvg(),e.render())}loadBlocklyAsync(){return this._loadBlocklyPromise||(pxt.perf.measureStart("loadBlockly"),this._loadBlocklyPromise=pxt.BrowserUtils.loadBlocklyAsync().then(()=>{Blockly.Functions.editFunctionExternalHandler=(e,t)=>{b.delay(10).then(()=>{if(!this.functionsDialog){const e=document.body.appendChild(document.createElement("div"));this.functionsDialog=o.render(r.createElement(m.CreateFunctionDialog,{parent:this.parent}),e)}this.functionsDialog.show(e,t,this.editor)})},pxt.blocks.openHelpUrl=e=>{var t;pxt.tickEvent("blocks.help",{url:e},{interactiveConsent:!0});const i=/^\/pkg\/([^#]+)#(.+)$/.exec(e);if(i){const t=a.mainPkg.deps[i[1]];if(t&&"github"==t.verProtocol())return e=`/pkg/${t.verArgument().replace(/#.*$/,"")}#`+i[2],void window.open(e,i[1])}if(/^github:/.test(e)){e=e.replace(/^github:\/?/,"")+(/\.md$/i.test(e)?"":".md");const i=a.getEditorPkg(a.mainPkg).lookupFile(e),n=null==(t=null==i?void 0:i.content)?void 0:t.trim();n&&(this.parent.setSideMarkdown(n),this.parent.setSideDocCollapsed(!1))}else/^\//.test(e)?this.parent.setSideDoc(e):window.open(e,"docs")},this.prepareBlockly()}).then(()=>pxt.editor.initEditorExtensionsAsync()).then(()=>pxt.perf.measureEnd("loadBlockly"))),this._loadBlocklyPromise}loadFileAsync(t){return b.assert(!this.delayLoadXml),(this.loadingXmlPromise||Promise.resolve()).then(()=>this.loadBlocklyAsync()).then(()=>{pxt.blocks.cleanBlocks(),this.toolbox&&this.toolbox.showLoading(),this.blockInfo=void 0,this.currSource=t.content,this.typeScriptSaveable=!1,this.setDiagnostics(t),this.delayLoadXml=t.content,this.parent.shouldPreserveUndoStack()||pxt.blocks.clearWithoutEvents(this.editor),this.closeFlyout(),this.filterToolbox(),this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.showCategories=this.parent.state.editorState.hasCategories:this.showCategories=!0,this.currFile=t;var e=document.getElementById("blocklySearchInputField");e&&e.value&&(e.value=""),this.extensions=!!pxt.appTarget.appTheme.allowPackageExtensions&&a.allEditorPkgs().map(e=>e.getKsPkg()).filter(e=>{return!(null==(e=null==e?void 0:e.config)||!e.extension)})||[]})}unloadFileAsync(){return this.delayLoadXml=void 0,this.toolbox&&this.toolbox.clearSearch(),Promise.resolve()}switchToTypeScript(){pxt.tickEvent("blocks.switchjavascript"),this.parent.closeFlyout(),this.parent.switchTypeScript()}setDiagnostics(t){if(b.assert(null!=this.editor),this.compilationResult&&!this.delayLoadXml&&!this.loadingXml){this.editor.getAllBlocks().filter(e=>e.isEnabled()).forEach(e=>{e.setWarningText(null),e.setHighlightWarning(!1)});t=t&&t.epkg&&t.epkg.files[t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];if(t&&t.diagnostics){let e=t.diagnostics.filter(e=>e.category==ts.pxtc.DiagnosticCategory.Error),i=this.compilationResult.sourceMap;e.filter(e=>e.category==ts.pxtc.DiagnosticCategory.Error).forEach(e=>{var t=pxt.blocks.findBlockIdByLine(i,{start:e.line,length:0});t&&(t=this.editor.getBlockById(t))&&(e=ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n"),t.setWarningText(e),t.setHighlightWarning(!0))}),this.compilationResult.diagnostics.forEach(e=>{var t;e.blockId&&(t=this.editor.getBlockById(e.blockId))&&(t.setWarningText(e.message),t.setHighlightWarning(!0))}),this.onBlockErrorChanges(this.compilationResult.diagnostics),this.setBreakpointsFromBlocks()}}}highlightStatement(e,t){if(this.compilationResult&&!this.delayLoadXml&&!this.loadingXml)if(this.updateDebuggerVariables(t),e){var i=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});if(i){const e=this.editor.getBlockById(i).getRootBlock();if(i=null!=e&&e.isCollapsed()?e.id:i,this.editor.highlightBlock(i),t){const e=this.editor.getBlockById(i);e.setWarningText(t?t.exceptionMessage:void 0);var t=e.getRelativeToSurfaceXY(),n=e.getHeightWidth(),r=this.editor.scale,o=this.editor.getMetrics();(t.x*r<o.viewLeft+4||(t.x+n.width)*r>o.viewLeft+o.viewWidth-4||t.y*r<o.viewTop+4||(t.y+n.height)*r>o.viewTop+o.viewHeight-4)&&this.editor.centerOnBlock(i)}return!0}}else this.editor.highlightBlock(null);return!1}updateDebuggerVariables(e){var t;this.parent.state.debugging&&this.debuggerToolbox&&(t=Blockly.Variables.allUsedVarModels(this.editor).map(e=>pxtc.escapeIdentifier(e.name)),this.debuggerToolbox.setBreakpoint(e,t))}clearHighlightedStatements(){this.editor.highlightBlock(null),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null)}openTypeScript(){pxt.tickEvent("blocks.showjavascript"),this.parent.closeFlyout(),this.parent.openTypeScriptAsync()}openPython(){pxt.tickEvent("blocks.showpython"),this.parent.closeFlyout(),this.parent.openPythonAsync()}cleanUpShadowBlocks(){this.editor.getTopBlocks(!1).filter(e=>e.isShadow()).forEach(e=>e.dispose(!1))}getBlocklyOptions(e){var t=this.getDefaultOptions(),e=(b.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyOptions||{}),null!=e?e:null!=t.hasCategories?t.hasCategories:this.showCategories),e=(t.hasCategories=e,t.renderer="pxt",e||(this.showCategories=!1),e?document.getElementById("blocklyToolboxDefinitionCategory"):document.getElementById("blocklyToolboxDefinitionFlyout"));return t.toolbox=null!=t.toolbox?t.toolbox:t.readOnly?void 0:e,t}getDefaultOptions(){var e,t;return this.blocklyOptionsCache||(t=pxt.shell.isReadOnly(),e=pxt.appTarget.appTheme,t={media:pxt.webConfig.commitCdnUrl+"blockly/media/",sounds:!0,trashcan:!1,collapse:!!e.blocksCollapsing,comments:!0,disable:!1,readOnly:t,toolboxOptions:{colour:e.coloredToolbox,inverted:e.invertedToolbox},move:{scrollbars:!0,wheel:!0},zoom:{controls:!1,maxScale:2.5,minScale:.2,scaleSpeed:1.5,startScale:pxt.BrowserUtils.isMobile()?.7:.9,pinch:!0},rtl:b.isUserLanguageRtl()},this.blocklyOptionsCache=t)}refreshToolbox(){if(this.blockInfo&&(pxt.perf.measureStart("refreshToolbox"),!pxt.shell.isReadOnly())&&(null==this.parent.state.tutorialOptions||this.parent.state.tutorialOptions.tutorialReady)){this.clearCaches();const e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=this.shouldShowCategories(!e);if(this.editor.toolbox_&&t||this.editor.flyout_&&!t)t?this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}):this.showFlyoutOnlyToolbox();else{t||o.unmountComponentAtNode(this.getBlocklyToolboxDiv());const e=()=>{this.delayLoadXml=this.getCurrentSource(),this.editor=void 0,this.prepareBlockly(t),this.domUpdate(),this.editor.scrollCenter(),t&&this.renderToolbox(!0)};this.loadingXmlPromise?this.loadingXmlPromise.then(e):e()}pxt.perf.measureEnd("refreshToolbox")}}filterToolbox(e){this.showCategories=e,this.refreshToolbox()}async openExtension(t){var e,i,n=this.extensions.filter(e=>e.config.name===t)[0];null!=n&&n.config.extension&&(pxt.tickEvent("blocks.extensions.open",{extension:t}),{name:n,url:e,trusted:i}=await w.resolveExtensionUrl(n),i?(pxt.tickEvent("blocks.extensions.trusted",{extension:t}),this.parent.openExtension(n,e)):(s.errorNotification(lf("Sorry, this extension is not allowed.")),pxt.tickEvent("blocks.extensions.untrusted",{extension:t})))}partitionBlocks(){const n={},i=(this.topBlocks=[],this);function r(e,t){i.subcategoryMap[e]||(i.subcategoryMap[e]={}),i.subcategoryMap[e][t]=!0}return pxt.blocks.injectBlocks(this.blockInfo).forEach(e=>{var t=(e.attributes.blockNamespace||e.namespace).split(".")[0],i=(n[t]||(n[t]=[]),n[t].push(e),e.attributes.subcategory);e.attributes.advanced?r(t,lf("more")):i&&r(t,i),e.attributes.topblock&&this.topBlocks.push(e)}),n}hideFlyout(){this.editor.toolbox_&&this.editor.toolbox_.getFlyout().hide(),this.toolbox&&this.toolbox.clear()}clearCaches(){super.clearCaches(),this.clearFlyoutCaches(),d.clearBuiltinBlockCache()}clearFlyoutCaches(){this.flyoutBlockXmlCache={}}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}shouldShowCategories(e){return(this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.parent.state.editorState:this.getBlocklyOptions(e)).hasCategories}getBuiltinCategory(e){return d.getBuiltinCategory(e)}isBuiltIn(e){return d.isBuiltin(e)}getNamespaceAttrs(e){var t=d.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){var e=Object.keys(this.nsMap).filter(e=>!d.isBuiltin(e)&&!!this.getNamespaceAttrs(e));function t(e){return d.getBuiltinCategory(e).removed}var i=pxt.appTarget.runtime||{};return i.loopsBlocks&&!t("loops")&&e.push("loops"),i.logicBlocks&&!t("logic")&&e.push("logic"),i.variablesBlocks&&!t("variables")&&e.push("variables"),i.mathBlocks&&!t("Math")&&e.push("Math"),i.functionBlocks&&!t("functions")&&e.push("functions"),i.listsBlocks&&!t("arrays")&&e.push("arrays"),i.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}getBlocksForCategory(e,t){return(d.isBuiltin(e)?this.getBuiltInBlocks(e,t):this.getNonBuiltInBlocks(e,t)).concat(this.getExtraBlocks(e,t))}filterBlocks(t,e){return e.filter(e=>!e.attributes.blockHidden&&!(e.attributes.deprecated&&!this.parent.isTutorial())&&(!t&&!e.attributes.subcategory&&!e.attributes.advanced||t&&(e.attributes.advanced&&t==lf("more")||e.attributes.subcategory&&t==e.attributes.subcategory)))}getBuiltInBlocks(e,t){let i=d.getBuiltinCategory(e),n=i.blocks||[];return n=!i.custom&&this.nsMap[e]?this.filterBlocks(t,n.concat(this.nsMap[e])):n}getNonBuiltInBlocks(e,t){return this.filterBlocks(t,this.nsMap[e])||[]}getExtraBlocks(r,e){if(e)return[];let o=[];var t=pxt.appTarget.runtime.onStartNamespace||"loops",t=(r==t&&o.push({name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'}),d.getPauseUntil());return t&&r==t.attributes.blockNamespace&&o.push(t),e||this.extensions.forEach(e=>{const t=e.config,i=t.name,n=t.extension.namespace||i;r==n&&o.push({name:`EXT${i}_BUTTON`,type:"button",attributes:{blockId:`EXT${i}_BUTTON`,label:t.extension.label?b.rlf(t.extension.label):b.lf("Editor"),weight:101,group:t.extension.group},callback:()=>{this.openExtension(i)}})}),pxt.appTarget.appTheme.snippetBuilder&&g.initializeSnippetExtensions(r,o,this.editor,this.parent),o}showFlyout(e){var{nameid:t,subns:i}=e,n=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;"search"==t?this.showSearchFlyout():"topblocks"==t?this.showTopBlocksFlyout():(this.flyoutXmlList=[],this.flyoutBlockXmlCache[t=t+i+(n?"tutorialexpanded":"")]?(pxt.debug("showing flyout with blocks from flyout blocks xml cache"),this.flyoutXmlList=this.flyoutBlockXmlCache[t],this.showFlyoutInternal_(this.flyoutXmlList,t)):this.abstractShowFlyout(e)&&(pxt.Util.isTranslationMode()||(this.flyoutBlockXmlCache[t]=this.flyoutXmlList),this.showFlyoutInternal_(this.flyoutXmlList,t)))}showFlyoutHeadingLabel(e,t,i,n,r){t=t||b.capitalize(i||e),i=("blocklyTreeIcon"+(n?e.toLowerCase():"Default")).replace(/\s/g,""),e=pxt.blocks.createFlyoutHeadingLabel(t,r,n,i);this.flyoutXmlList.push(e)}showFlyoutGroupLabel(e,t,i,n){t=pxt.blocks.createFlyoutGroupLabel(pxt.Util.rlf("{id:group}"+e),t,i,n?"GROUP_HELP_"+e:void 0);n&&this.editor.registerButtonCallback("GROUP_HELP_"+e,()=>{this.helpButtonCallback(e)}),this.flyoutXmlList.push(t)}helpButtonCallback(e){pxt.debug(e+" help icon clicked."),u.fireEvent({type:"ui",editor:"blocks",action:"groupHelpClicked",data:{group:e}})}showFlyoutBlocks(e,t,i){this.parent.state.editorState&&this.parent.state.editorState.filters,i.sort((e,t)=>(null!=t.attributes.weight?t.attributes.weight:50)-(null!=e.attributes.weight?e.attributes.weight:50)).forEach(e=>{(e="button"==e.type?this.getButtonXml(e):this.getBlockXml(e))&&(this.flyoutXmlList=this.flyoutXmlList.concat(e))})}showSearchFlyout(){var e;this.flyoutXmlList=[],this.toolbox.getSearchBlocks().forEach(e=>{e=this.getBlockXml(e,!0);e&&(this.flyoutXmlList=this.flyoutXmlList.concat(e))}),0==this.flyoutXmlList.length&&((e=Blockly.utils.xml.createElement("label")).setAttribute("text",lf("No search results...")),this.flyoutXmlList.push(e)),this.showFlyoutInternal_(this.flyoutXmlList,"search"),this.toolbox.setSearch()}showTopBlocksFlyout(){this.flyoutXmlList=[];var e,t=this.getTopBlocks();0==t.length?((e=Blockly.utils.xml.createElement("label")).setAttribute("text",lf("No basic blocks...")),this.flyoutXmlList.push(e)):(this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),t.forEach(e=>{e=this.getBlockXml(e,!0);e&&(this.flyoutXmlList=this.flyoutXmlList.concat(e))})),this.showFlyoutInternal_(this.flyoutXmlList)}blocksToString(e){let t=null;return e.map(e=>e?e.outerHTML||(t=t||new XMLSerializer).serializeToString(e):"\x3c!-- invalid block here! --\x3e").reduce((e,t)=>e+t,"")}hashBlocks(e){return pxt.Util.codalHash16(this.blocksToString(e))}swapFlyout(e,t){e.setVisible(!1),this.editor.toolbox_.setFlyout(t),t.setVisible(!0);var e=t.workspace_,i=t.targetWorkspace_;e.scale!==i.scale&&t.reflow()}showFlyoutInternal_(t,i="default"){var n,r;if(this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories||!this.editor.toolbox_)this.editor.flyout_&&(this.editor.flyout_.show(t),this.editor.flyout_.scrollToStart());else{const o=this.editor.toolbox_.getFlyout(),a=i in this.flyouts,s=a?this.flyouts[i].blocksHash:0,l=this.hashBlocks(t),c=s===l&&!!s;let e;a?e=this.flyouts[i].flyout:(e=(n=this.editor.toolbox_.workspace_,r=o.svgGroup_,Blockly.Functions.createFlyout(n,r)),this.flyouts[i]={flyout:e,blocksHash:0}),this.flyouts[i].blocksHash=l,this.swapFlyout(o,e),c||e.show(t),e.scrollToStart(),null!=(n=this.parent.state)&&n.accessibleBlocks&&e.svgGroup_.focus()}}showFlyoutOnlyToolbox(){var e=this.getAllCategories();let i=[];e.forEach(e=>{var t=e.blocks;i=i.concat(t),e.subcategories&&e.subcategories.forEach(e=>{e=e.blocks;i=i.concat(e)})});var t=document.createElement("div");o.render(r.createElement(c.ToolboxStyle,{categories:e}),t),document.getElementById("editorcontent").appendChild(t);let n=[];i.forEach(e=>{e=this.getBlockXml(e);e&&(n=n.concat(e))}),this.showFlyoutInternal_(n),this.parent.forceUpdate()}updateGrayBlocks(){if(this.editor){const t=pxt.shell.isPyLangPref();this.editor.getAllBlocks(!1).forEach(e=>{e.type!==pxtc.TS_STATEMENT_TYPE&&e.type!==pxtc.TS_OUTPUT_TYPE||e.setPythonEnabled(t)})}}getBlockXml(r,o,a){const i=this;let s;if(!r.attributes.blockBuiltin){if(r.builtinBlock){if("function_return"===r.attributes.blockId)return[pxt.blocks.mkReturnStatementBlock()];const a=d.allBuiltinBlocks()[r.attributes.blockId];if(a&&a.blockXml&&r.builtinField&&2==r.builtinField.length){const o=r.builtinField[0],i=r.builtinField[1],s=new RegExp(`<field name="${o}">(.*)</field>`,"i");a.blockXml=a.blockXml.replace(s,()=>`<field name="${o}">${i}</field>`)}return a?this.getBlockXml(a,o):void 0}if(r.blockXml)s=Blockly.Xml.textToDom(r.blockXml);else{let n=pxt.blocks.blockSymbol(r.attributes.blockId);if(n){if(!function(e){var t;if((!e.attributes.debug||pxt.options.debug)&&((a||!e.attributes.blockHidden)&&(!e.attributes.deprecated||i.parent.isTutorial())))return t=(e.attributes.blockNamespace||e.namespace).split(".")[0],i.shouldShowBlock(e.attributes.blockId,t,a)}(n))return;var l=pxt.blocks.compileInfo(n);if(s=pxt.blocks.createToolboxBlock(this.blockInfo,n,l),n.attributes.optionalVariableArgs&&n.attributes.toolboxVariableArgs){const a=l.handlerArgs;n.attributes.toolboxVariableArgs.split(";").map(e=>parseInt(e)).filter(e=>e<=a.length&&0<=e).forEach(t=>{var i=document.createElement("mutation");i.setAttribute("numargs",t.toString());for(let e=0;e<t;e++)i.setAttribute("arg"+e,a[e].name);s.appendChild(i)})}else if(l.handlerArgs.length&&!n.attributes.optionalVariableArgs)l.handlerArgs.forEach(e=>{e=Blockly.Xml.textToDom(`
    <value name="HANDLER_${e.name}">
    <shadow type="variables_get_reporter">
    <field name="VAR" variabletype="">${e.name}</field>
    </shadow>
    </value>`);s.appendChild(e)});else{if(n.attributes.mutateDefaults){const r=n.attributes.mutateDefaults.split(";"),a=[];return r.forEach(e=>{var t=s.cloneNode(!0);pxt.blocks.mutateToolboxBlock(t,n.attributes.mutate,e),a.push(t)}),a}if(null!=n.attributes.blockSetVariable&&n.retType&&!a){const r=n.attributes.blockSetVariable;let e,t=e=!r||pxt.blocks.isReservedWord(r)?b.htmlEscape(n.retType.toLowerCase()):b.htmlEscape(r),i=2;for(;function(e,t){e=t.getVariable(e),t=e&&t.getVariableUsesById(e.getId());return t&&t.some(e=>"variables_set"==e.type||"variables_change"==e.type)}(t,this.editor);)t=e+i++;e=t;var l=Blockly.Xml.textToDom(`
<block type="variables_set" gap="${b.htmlEscape((n.attributes.blockGap||8)+"")}">
<field name="VAR" variabletype="">${e}</field>
</block>`),c=document.createElement("value");c.setAttribute("name","VALUE"),c.appendChild(s),c.appendChild(pxt.blocks.mkFieldBlock("math_number","NUM","0",!0)),l.appendChild(c),s=l}}}else pxt.log("Couldn't find block for: "+r.attributes.blockId),pxt.log(r)}return s&&(o&&s.setAttribute("gap",""+(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8)),pxt.Util.toArray(s.querySelectorAll("shadow")).filter(e=>!e.innerHTML).forEach((e,t)=>{var i=e.getAttribute("type"),n=d.allBuiltinBlocks()[i],n=this.getBlockXml(n||{name:i,attributes:{blockId:i}},o,!0);n&&0<n.length&&n[0]&&(e.innerHTML=n[0].innerHTML)})),[s]}pxt.log("ignoring built in block: "+r.attributes.blockId)}getButtonXml(t){return this.editor.registerButtonCallback(t.attributes.blockId,e=>{t.callback()}),[pxt.blocks.createFlyoutButton(t.attributes.blockId,t.attributes.label)]}updateBreakpoints(){if(this.editor){const t=!!this.parent.state.debugging;this.editor.getAllBlocks().forEach(e=>{e.previousConnection&&e.enableBreakpoint(t)}),this.editor.setDebugModeOption(t)}}}function x(e,t){const i=e.getAllBlocks(!1);for(const e of i)for(const i of e.inputList)for(const e of i.fieldRow)(e instanceof pxtblockly.FieldSpriteEditor||e instanceof pxtblockly.FieldAnimationEditor)&&t(e)}i.Editor=k},{"./blocklyFieldView":9,"./blocksSnippets":11,"./compiler":18,"./core":64,"./createFunction":66,"./debuggerToolbox":72,"./dialogs":74,"./errorList":78,"./extensionManager":79,"./package":108,"./simulator":121,"./snippetBuilder":122,"./toolbox":130,"./toolboxeditor":131,"./workspace":136,react:320,"react-dom":276}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getToolboxDefinition=i.overrideToolbox=i.overrideCategory=i.clearBuiltinBlockCache=i.allBuiltinBlocks=i.isBuiltin=i.getBuiltinCategory=i.getPauseUntil=void 0;let n,r,o=null;function a(){return o||((o={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"controls_repeat_ext",attributes:{blockId:"controls_repeat_ext",weight:49},blockXml:'<block type="controls_repeat_ext">\n                    <value name="TIMES">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"device_while",attributes:{blockId:"device_while",weight:48},blockXml:'<block type="device_while">\n                    <value name="COND">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">FALSE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for",attributes:{blockId:"pxt_controls_for",weight:47},blockXml:`<block type="pxt_controls_for">
                    <value name="VAR">
                        <shadow type="variables_get_reporter">
                            <field name="VAR">${lf("{id:var}index")}</field>
                        </shadow>
                    </value>
                    <value name="TO">
                        <shadow type="math_whole_number">
                            <field name="NUM">4</field>
                        </shadow>
                    </value>
                </block>`},{name:"pxt_controls_for_of",attributes:{blockId:"pxt_controls_for_of",weight:46},blockXml:`<block type="pxt_controls_for_of">
                    <value name="VAR">
                        <shadow type="variables_get_reporter">
                            <field name="VAR">${lf("{id:var}value")}</field>
                        </shadow>
                    </value>
                    <value name="LIST">
                        <shadow type="variables_get">
                            <field name="VAR">list</field>
                        </shadow>
                    </value>
                </block>`}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},pxt.appTarget.runtime&&pxt.appTarget.runtime.breakBlock&&o.loops.blocks.push({name:"pxt_break",attributes:{blockId:"break_keyword",weight:30},blockXml:'<block type="break_keyword"></block>'}),pxt.appTarget.runtime&&pxt.appTarget.runtime.continueBlock&&o.loops.blocks.push({name:"pxt_continue",attributes:{blockId:"continue_keyword",weight:29},blockXml:'<block type="continue_keyword"></block>'}),o.logic={name:lf("{id:category}Logic"),nameid:"logic",groups:[lf("Conditionals"),lf("Comparison"),lf("Boolean"),"other"],blocks:[{name:"controls_if",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:49},blockXml:'<block type="controls_if" gap="8">\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"controls_if_else",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:48},blockXml:'<block type="controls_if" gap="8">\n                    <mutation else="1"></mutation>\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_eq",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:47},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_lt",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:46},blockXml:'<block type="logic_compare">\n                    <field name="OP">LT</field>\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_strings",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:45},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_operation_and",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:44},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">AND</field>\n                </block>'},{name:"logic_operation_or",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:43},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">OR</field>\n                </block>'},{name:"logic_negate",attributes:{blockId:"logic_negate",group:lf("Boolean"),weight:42},blockXml:'<block type="logic_negate"></block>'},{name:"logic_boolean_true",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:41},blockXml:'<block type="logic_boolean" gap="8">\n                    <field name="BOOL">TRUE</field>\n                </block>'},{name:"logic_boolean_false",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:40},blockXml:'<block type="logic_boolean">\n                    <field name="BOOL">FALSE</field>\n                </block>'}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},o.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:void 0,custom:!0,customClick:e=>(e.showVariablesFlyout(),!1),attributes:{weight:50.07,icon:"variables",callingConvention:0,paramDefl:{}}},o.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"math_arithmetic_ADD",attributes:{blockId:"math_arithmetic",weight:90},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">ADD</field>\n                    </block>'},{name:"math_arithmetic_MINUS",attributes:{blockId:"math_arithmetic",weight:89},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MINUS</field>\n                    </block>'},{name:"math_arithmetic_TIMES",attributes:{blockId:"math_arithmetic",weight:88},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MULTIPLY</field>\n                    </block>'},{name:"math_arithmetic_DIVIDE",attributes:{blockId:"math_arithmetic",weight:87},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">DIVIDE</field>\n                    </block>'},{name:"math_number",attributes:{blockId:"math_number",weight:86},blockXml:'<block type="math_number" gap="8">\n                        <field name="NUM">0</field>\n                    </block>'},{name:"math_modulo",attributes:{blockId:"math_modulo",weight:85},blockXml:'<block type="math_modulo">\n                        <value name="DIVIDEND">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="DIVISOR">\n                            <shadow type="math_number">\n                                <field name="NUM">1</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_op2_min",attributes:{blockId:"math_op2",weight:84},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">min</field>\n                    </block>'},{name:"math_op2_max",attributes:{blockId:"math_op2",weight:83},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">max</field>\n                    </block>'},{name:"math_op3",attributes:{blockId:"math_op3",weight:82},blockXml:'<block type="math_op3">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_op",attributes:{blockId:"math_js_op",weight:81},blockXml:'<block type="math_js_op">\n                        <field name="OP">sqrt</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_round",attributes:{blockId:"math_js_round",weight:80},blockXml:'<block type="math_js_round">\n                        <field name="OP">round</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},o.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[],custom:!0,customClick:e=>(e.showFunctionsFlyout(),!1),attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},o.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",blocks:[{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:90},blockXml:`<block type="variables_set" gap="8">
                        <field name="VAR" variabletype="">${lf("{id:var}list")}</field>
                        <value name="VALUE">
                            <block type="lists_create_with">
                                <mutation items="2"></mutation>
                                <value name="ADD0">
                                    <shadow type="math_number">
                                        <field name="NUM">0</field>
                                    </shadow>
                                </value>
                                <value name="ADD1">
                                    <shadow type="math_number">
                                        <field name="NUM">1</field>
                                    </shadow>
                                </value>
                            </block>
                        </value>
                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:89},blockXml:`<block type="variables_set">
                        <field name="VAR" variabletype="">${lf("{id:var}text list")}</field>
                        <value name="VALUE">
                            <block type="lists_create_with">
                                <mutation items="3"></mutation>
                                <value name="ADD0">
                                    <shadow type="text">
                                        <field name="TEXT">${lf("a")}</field>
                                    </shadow>
                                </value>
                                <value name="ADD1">
                                    <shadow type="text">
                                        <field name="TEXT">${lf("b")}</field>
                                    </shadow>
                                </value>
                                <value name="ADD2">
                                    <shadow type="text">
                                        <field name="TEXT">${lf("c")}</field>
                                    </shadow>
                                </value>
                            </block>
                        </value>
                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:5},blockXml:'<block type="lists_create_with">\n                        <mutation items="0"></mutation>\n                    </block>'},{name:"lists_index_get",attributes:{blockId:"lists_index_get",group:"Read",weight:87},blockXml:`<block type="lists_index_get">
                        <value name="LIST">
                            <block type="variables_get">
                                <field name="VAR">${lf("{id:var}list")}</field>
                            </block>
                        </value>
                        <value name="INDEX">
                            <shadow type="math_number">
                                <field name="NUM">0</field>
                            </shadow>
                        </value>
                    </block>`},{name:"lists_index_set",attributes:{blockId:"lists_index_set",group:"Modify",weight:86},blockXml:`<block type="lists_index_set">
                        <value name="INDEX">
                            <shadow type="math_number">
                                <field name="NUM">0</field>
                            </shadow>
                        </value>
                        <value name="LIST">
                            <block type="variables_get">
                                <field name="VAR">${lf("{id:var}list")}</field>
                            </block>
                        </value>
                    </block>`},{name:"lists_length",attributes:{blockId:"lists_length",group:"Read",weight:88},blockXml:`<block type="lists_length">
                        <value name="VALUE">
                            <block type="variables_get">
                                <field name="VAR">${lf("{id:var}list")}</field>
                            </block>
                        </value>
                    </block>`}],attributes:{advanced:!0,weight:50.07,icon:"arrays",groups:["Create","Read","Modify","Operations"],callingConvention:0,paramDefl:{}}},o.text={name:lf("{id:category}Text"),nameid:"text",blocks:[{name:"text",attributes:{blockId:"text",weight:90},blockXml:'<block type="text"></block>'},{name:"text_length",attributes:{blockId:"text_length",weight:89},blockXml:`<block type="text_length">
                        <value name="VALUE">
                            <shadow type="text">
                                <field name="TEXT">${lf("Hello")}</field>
                            </shadow>
                        </value>
                    </block>`},{name:"text_join",attributes:{blockId:"text_join",weight:88},blockXml:`<block type="text_join">
                        <mutation items="2"></mutation>
                        <value name="ADD0">
                            <shadow type="text">
                                <field name="TEXT">${lf("Hello")}</field>
                            </shadow>
                        </value>
                        <value name="ADD1">
                            <shadow type="text">
                                <field name="TEXT">${lf("World")}</field>
                            </shadow>
                        </value>
                    </block>`}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},o.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),o}function s(){var e;return n||(e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock)&&(n={name:pxtc.PAUSE_UNTIL_TYPE,attributes:{blockId:pxtc.PAUSE_UNTIL_TYPE,blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight},blockXml:Blockly.Xml.domToText(pxt.blocks.mkPredicateBlock(pxtc.PAUSE_UNTIL_TYPE))}),n}function l(e){return a()[e]}function c(e,t){e=l(e);if(t&&e&&(0===Object.keys(t).length&&(e.removed=!0),t.name&&(e.name=t.name),t.icon&&(e.attributes.icon=t.icon),void 0!==t.weight&&(e.attributes.weight=t.weight),void 0!==t.advanced&&(e.attributes.advanced=t.advanced),null!=t.groups&&(e.groups=t.groups),t.blocks)){let n=100;e.blocks=t.blocks.map((e,t)=>{return e.weight?n=e.weight:n--,e=e,i=n,{name:e.name,snippet:e.snippet,snippetName:e.snippetName,snippetOnly:e.snippetOnly,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,attributes:{blockId:e.blockId,weight:i||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml};var i})}}function d(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map(e=>({name:e.name,snippet:e.snippet,snippetName:e.snippetName,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId})):[]}}i.getPauseUntil=s,i.getBuiltinCategory=l,i.isBuiltin=function(e){return!!a()[e]},i.allBuiltinBlocks=function(){r||(r={},[a().loops,a().logic,a().Math,a().text,a().arrays].forEach(e=>{e.blocks.forEach(e=>{e.attributes.blockId&&!r[e.attributes.blockId]&&(r[e.attributes.blockId]=e)})})),r[ts.pxtc.ON_START_TYPE]={name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'};var e=s();return e&&(r[pxtc.PAUSE_UNTIL_TYPE]=e),r},i.clearBuiltinBlockCache=function(){r=void 0},i.overrideCategory=c,i.overrideToolbox=function(e){c("loops",e.loops),c("logic",e.logic),c("variables",e.variables),c("Math",e.maths),c("text",e.text),c("arrays",e.arrays),c("functions",e.functions)},i.getToolboxDefinition=function(){return{loops:d(a().loops),logic:d(a().logic),variables:d(a().variables),maths:d(a().Math),text:d(a().text),arrays:d(a().arrays),functions:d(a().functions)}}},{}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=i.copyProjectToLegacyEditor=void 0;const a=e("./db"),n=e("./workspace");let r,o;async function s(e){var t=r.getAsync(e.id),e=o.getAsync(e.id),[t,e]=await Promise.all([t,e]);if(t&&e)return{header:t,text:e.files,version:e._rev}}function l(e,t,i){return c(r,o,e,t,i)}function c(e,t,i,n,r){let o="";return(r?t.setAsync({id:i.id,files:r,_rev:n}).then(e=>{o=e}):Promise.resolve()).then(()=>e.setAsync(i)).then(e=>(i._rev=e,o))}i.copyProjectToLegacyEditor=function(e,t){const i=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[t],n=new a.Table(i?i+"-header":"header"),r=new a.Table(i?i+"-text":"text"),o=pxt.Util.clone(e);return delete o._id,delete o._rev,o.id=pxt.Util.guidGen(),s(e).then(e=>c(n,r,o,void 0,e.text)).then(e=>o)},i.provider={getAsync:s,setAsync:l,deleteAsync:function(e,t){return r.deleteAsync(e).then(()=>o.deleteAsync({id:e.id,_rev:e._rev}))},listAsync:async function(){await function(){const n=pxt.semver.parse(pxt.appTarget.versions.target).major,e=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[n];return e?(r=new a.Table(e+"-header"),o=new a.Table(e+"-text"),r.getAllAsync().then(e=>{if(e.length)return Promise.resolve();e=n-1,e=e<0?"":pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[e];let t=new a.Table("header"),i=new a.Table("text");return e&&(t=new a.Table(e+"-header"),i=new a.Table(e+"-text")),t.getAllAsync().then(e=>pxt.Util.promiseMapAll(e,e=>{return t=e,i.getAsync(t.id).then(e=>(delete t._id,delete t._rev,l(t,void 0,e.files)));var t})).then(()=>{})})):(r=new a.Table("header"),o=new a.Table("text"),Promise.resolve())}();var e=new pxt.skillmap.IndexedDBWorkspace,t=(await e.initAsync(),await e.getAllProjectsAsync());for(const i of t)i.header.isSkillmapProject=!0,await n.installAsync(i.header,i.text,!0),await e.deleteProjectAsync(i.header.id);return await 0,r.getAllAsync()},resetAsync:function(){return Promise.resolve()}}},{"./db":68,"./workspace":136}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Carousel=void 0;const n=e("react"),r=e("./sui"),o=e("./data");var a;(e=a=a||{})[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y";class s extends o.Component{constructor(e){super(e),this.arrows=[],this.isDragging=!1,this.definitelyDragging=a.None,this.currentOffset=0,this.index=0,this.childrenElements=[],this.handleContainerRef=e=>{this.container=e},this.handleDragSurfaceRef=e=>{this.dragSurface=e},this.handleArrowRefs=e=>{this.arrows.push(e)},this.handleChildRefs=e=>{e&&this.childrenElements.push(e)},this.updateDimensions=()=>{if(this.container){let e=!1;var t;this.containerWidth=this.container.getBoundingClientRect().width,this.getArrowWidth(),this.childrenElements.length&&((t=this.childrenElements[0].getBoundingClientRect().width)!==this.childWidth&&(this.childWidth=t,e=!0),this.actualPageLength=Math.floor(this.containerWidth/this.childWidth)),this.dragSurface.style.width=this.totalLength()+"px",this.updateArrows(),this.index>=this.maxIndex()&&(e=!0,this.index=this.maxIndex()),e&&this.setPosition(this.indexToOffset(this.index))}},this.state={},this.childrenElements=[],this.arrows=[],this.onLeftArrowClick=this.onLeftArrowClick.bind(this),this.onRightArrowClick=this.onRightArrowClick.bind(this)}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&this.setIndex(e.selectedIndex)}renderCore(){var{rightDisabled:e,leftDisabled:t}=this.state,i=pxt.Util.isUserLanguageRtl();return n.createElement("div",{className:"ui carouselouter"},!t&&n.createElement("span",{role:"button",className:"carouselarrow left aligned",tabIndex:0,title:lf("See previous"),"aria-label":lf("See previous"),onClick:this.onLeftArrowClick,onKeyDown:r.fireClickOnEnter,ref:this.handleArrowRefs},n.createElement(r.Icon,{icon:"circle angle "+(i?"right":"left")})),n.createElement("div",{className:"carouselcontainer",ref:this.handleContainerRef},n.createElement("div",{className:"carouselbody",ref:this.handleDragSurfaceRef},n.Children.map(this.props.children,(e,t)=>e?n.createElement("div",{className:"carouselitem "+(this.props.selectedIndex==t?"selected":""),ref:this.handleChildRefs},n.cloneElement(e,{tabIndex:this.isVisible(t)?0:-1})):void 0))),!e&&n.createElement("span",{role:"button",className:"carouselarrow right aligned",tabIndex:0,title:lf("See more"),"aria-label":lf("See more"),onClick:this.onRightArrowClick,onKeyDown:r.fireClickOnEnter,ref:this.handleArrowRefs},n.createElement(r.Icon,{icon:"circle angle "+(pxt.Util.isUserLanguageRtl()?"left":"right")})))}onLeftArrowClick(){this.onArrowClick(!0)}onRightArrowClick(){this.onArrowClick(!1)}onArrowClick(e){var t=this.index,i=this.container.scrollLeft,n=(this.setIndex(e?this.index-this.actualPageLength:this.index+this.actualPageLength),this.props)["tickId"];if(n&&pxt.tickEvent("carousel.arrow.click",{tickId:n,index:this.index,left:e?-1:1},{interactiveConsent:!0}),e){const e=this.index+this.actualPageLength<t?this.index+this.actualPageLength:t-1;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}else{const e=this.index>t+this.actualPageLength?this.index:t+this.actualPageLength;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}this.container.scrollLeft=i}componentDidMount(){this.initDragSurface(),this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){this.updateDimensions()}initDragSurface(){var e=e=>{this.definitelyDragging=a.None,this.dragStart(c(e),d(e))},t=e=>{this.isDragging&&(this.dragEnd(),this.definitelyDragging)&&(e.preventDefault(),e.stopPropagation())},i=e=>{this.isDragging&&this.dragEnd()},n=t=>{if(this.isDragging){let e=c(t);var i;this.definitelyDragging||(i=d(t),5<Math.abs(e-this.dragStartX)?this.definitelyDragging=a.X:5<Math.abs(i-this.dragStartY)&&(this.definitelyDragging=a.Y)),this.definitelyDragging==a.X&&(t.stopPropagation(),t.preventDefault(),window.requestAnimationFrame(()=>{this.dragMove(e)}))}};this.dragSurface.addEventListener("click",e=>{this.definitelyDragging&&(e.stopPropagation(),e.preventDefault())}),window.PointerEvent?(this.dragSurface.addEventListener("pointerdown",e),this.dragSurface.addEventListener("pointerup",t),this.dragSurface.addEventListener("pointerleave",i),this.dragSurface.addEventListener("pointermove",n)):(this.dragSurface.addEventListener("mousedown",e),this.dragSurface.addEventListener("mouseup",t),this.dragSurface.addEventListener("mouseleave",i),this.dragSurface.addEventListener("mousemove",n),pxt.BrowserUtils.isTouchEnabled()&&(this.dragSurface.addEventListener("touchstart",e),this.dragSurface.addEventListener("touchend",t),this.dragSurface.addEventListener("touchcancel",i),this.dragSurface.addEventListener("touchmove",n)))}dragStart(e,t){this.isDragging=!0,this.dragStartX=e,this.dragStartY=t,this.dragStartOffset=this.currentOffset,this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=0)}dragEnd(){this.isDragging=!1,this.calculateIndex()}dragMove(e){this.dragOffset=e-this.dragStartX;e=pxt.Util.isUserLanguageRtl()?this.dragStartOffset+this.dragOffset:this.dragStartOffset-this.dragOffset;this.setPosition(e)}setPosition(e){this.dragSurface&&(e=Math.min(Math.max(e,-300),this.maxScrollOffset()),this.currentOffset=e,pxt.Util.isUserLanguageRtl()?this.dragSurface.style.marginRight=-e+"px":this.dragSurface.style.marginLeft=-e+"px")}calculateIndex(){var e;this.dragSurface&&(e=Math.round(Math.max(this.currentOffset,0)/this.childWidth),e=this.currentOffset>this.dragStartOffset?e:e-1,this.setIndex(e,200))}setIndex(e,t){e=Math.max(Math.min(e,this.maxIndex()),0);t=t||100*Math.abs(e-this.index),this.index=e,this.updateArrows(),this.animation=new l(this.currentOffset,this.indexToOffset(this.index),t),this.animationId||(this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}isVisible(e){return e>=this.index&&e<this.index+(this.actualPageLength||4)}easeTowardsIndex(e){this.dragSurface&&(this.setPosition(this.animation.getPosition(e)),this.animation.isComplete?(this.animation=void 0,this.animationId=0):this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}indexToOffset(e){return e<=0?0:e===this.maxIndex()?this.totalLength()-this.containerWidth-300+2*this.arrowWidth:e*this.childWidth-this.childWidth*this.props.bleedPercent/100}totalLength(){return n.Children.count(this.props.children)*this.childWidth+300}getArrowWidth(){this.arrows.length&&(this.arrowWidth=0,this.arrows.forEach(e=>{e&&(this.arrowWidth=Math.max(e.getBoundingClientRect().width,this.arrowWidth))}))}maxScrollOffset(){return Math.max(this.totalLength()-this.actualPageLength*this.childWidth+300,0)}maxIndex(){return Math.max(this.childrenElements.length-this.actualPageLength,0)}updateArrows(){var{rightDisabled:e,leftDisabled:t}=this.state||{},i=this.index===this.maxIndex(),n=0===this.index;i===e&&n===t||this.setState({leftDisabled:n,rightDisabled:i})}}i.Carousel=s;class l{constructor(e,t,i){this.start=e,this.end=t,this.millis=i,this.isComplete=!1,this.slope=(t-e)/i}getPosition(e){return this.isComplete?this.end:void 0===this.startTime?(this.startTime=e,this.start):(e=e-this.startTime)>this.millis?(this.isComplete=!0,this.end):this.start+Math.floor(this.slope*e)}}function c(e){return("screenX"in e?e:e.changedTouches[0]).screenX}function d(e){return("screenY"in e?e:e.changedTouches[0]).screenY}},{"./data":67,"./sui":129,react:320}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.init=i.HEADER_CLOUDSTATE=i.requestProjectCloudStatus=i.saveLocalProjectsToCloudAsync=i.convertCloudToLocal=i.forceReloadForCloudSync=i.syncAsync=i.getCloudTempMetadata=i.CloudTempMetadata=i.excludeCloudMetadataFields=i.excludeLocalOnlyMetadataFields=void 0;const o=e("./core"),f=e("./auth"),m=e("./data"),g=e("./workspace"),a=e("./app");var b=pxt.Util;const n=["_rev","_id","cloudVersion","cloudCurrent","cloudLastSyncTime"],r=["cloudVersion","cloudCurrent","cloudLastSyncTime","cloudUserId"];function s(e,t){var i,n=Object.assign({},e);for(i of t)delete n[i];return n}function v(e){return s(e,n)}function l(e){return s(e,r)}function c(o){return new Promise(async(e,t)=>{var i;const n=p(o.id);try{pxt.debug("downloading from cloud: '"+N(o)),n.syncInProgress();var r=await f.apiAsync("/api/user/project/"+o.id);if(r.success){const o=null==(i=f.userProfile())?void 0:i.id,t=r.resp,n={header:v(JSON.parse(t.header)),text:JSON.parse(t.text),version:t.version};n.header.cloudCurrent=!0,n.header.cloudVersion=n.version,n.header.cloudUserId=o,n.header.cloudLastSyncTime=b.nowSeconds(),pxt.tickEvent("identity.cloudApi.getProject.success"),e(n)}else pxt.tickEvent("identity.cloudApi.getProject.failed"),t(r.err)}finally{n.syncFinished()}})}i.excludeLocalOnlyMetadataFields=v,i.excludeCloudMetadataFields=l;class d{constructor(e){this.headerId=e}get justSynced(){return this._justSynced}syncInProgress(){this._syncStartTime=b.nowSeconds(),m.invalidate(i.HEADER_CLOUDSTATE+":"+this.headerId)}syncFinished(){this._syncStartTime=0,this._justSynced=!0,m.invalidate(i.HEADER_CLOUDSTATE+":"+this.headerId),setTimeout(()=>{0===this._syncStartTime&&(this._justSynced=!1,m.invalidate(i.HEADER_CLOUDSTATE+":"+this.headerId))},1500)}cloudStatus(){var e=g.getHeader(this.headerId);if(e&&e.cloudUserId)return f.loggedIn()?0<this._syncStartTime?pxt.cloud.cloudStatus.syncing:e.cloudCurrent?this.justSynced?pxt.cloud.cloudStatus.justSynced:0<e.cloudLastSyncTime?pxt.cloud.cloudStatus.synced:void pxt.reportError("cloudsave",`Invalid project cloud state for project ${N(e)}: user: ${e.cloudUserId}, inProg: ${this._syncStartTime}, cloudCurr: ${e.cloudCurrent}, lastCloud: `+e.cloudLastSyncTime):pxt.cloud.cloudStatus.localEdits:pxt.cloud.cloudStatus.offline}}i.CloudTempMetadata=d;const u={};function p(e){return u[e]||(u[e]=new d(e)),u[e]}let h;async function y(e){return f.hasIdentity()&&f.loggedIn()?(e=null!=e?e:{},h=h||async function(t){try{var i=!t.hdrs;i&&(t.hdrs=E()),pxt.debug(`Synchronizing ${t.hdrs.length} local project(s) with the cloud...`);const l=E(t.hdrs),c=b.nowSeconds();pxt.tickEvent("identity.sync.start");let e=await new Promise(async(e,i)=>{var t,n=await f.apiAsync("/api/user/project");if(n.success){const i=b.nowSeconds(),r=null==(t=f.userProfile())?void 0:t.id,o=n.resp.map(e=>{var t=v(JSON.parse(e.header));return t.cloudUserId=r,t.cloudCurrent=!0,t.cloudLastSyncTime=i,t.cloudVersion=e.version,t});pxt.tickEvent("identity.cloudApi.list.success",{count:o.length}),e(o)}else pxt.tickEvent("identity.cloudApi.list.failed"),i(n.err)});var n=(e=i?e:e.filter(t=>l.some(e=>e.id===t.id))).length-l.length,o=(0!=n&&pxt.debug(Math.abs(n)+` ${0<n?"more":"fewer"} projects found in the cloud.`),e.length?Math.max(...e.map(e=>e.modificationTime)):c);pxt.debug("Last cloud project change was "+(s=o,c-s)+" seconds ago");const d=b.toDictionary(e,e=>e.id),u={},p=w,h=async(e,t)=>{e=await k(e,t);if(e)return u[e.id]=e};let r=[];t.direction&&"up"!==t.direction||await b.promisePoolAsync(10,l,async function(e){var t=N(e);try{if(!e.cloudCurrent)if(e.isDeleted){if("succeeded"!==(await p(e,null)).status)throw new Error(`Failed to save deleted ${t} to the cloud.`)}else{var i=d[e.id];if(i){var n=await p(e,e.cloudVersion);if("conflict"===n.status)await x(e,i);else if("succeeded"!==n.status)throw new Error(`Failed to save ${t} to the cloud.`)}else if("succeeded"!==(await p(e,null)).status)throw pxt.tickEvent("identity.sync.failed.localNewProjectSyncUpFailed"),new Error(`Failed to save new ${t} to the cloud.`)}}catch(e){r.push(e)}}),t.direction&&"down"!==t.direction||await b.promisePoolAsync(10,e,async function(e){var t=N(e);try{var i=g.getHeader(e.id);if(i){if(i.cloudVersion!==e.cloudVersion)if(i.cloudCurrent){if(!await h(i,e))throw new Error("Failed to download cloud project "+t)}else await x(i,e)}else if(!e.isDeleted&&!await h(i,e))throw new Error("Failed to import new cloud project "+t)}catch(e){r.push(e)}}),r.forEach(e=>pxt.debug(e)),r=[];var a=b.nowSeconds()-c;return pxt.tickEvent("identity.sync.finished",{elapsed:a}),m.invalidate("headers:"),b.values(u)}catch(t){pxt.reportException(t),pxt.tickEvent("identity.sync.failed",{exception:t})}var s;return[]}(e).then(e=>e).finally(()=>{h=void 0})):[]}async function w(e,t){var s,l,c,i=await g.getTextAsync(e.id),t=(g.acquireHeaderSession(e),s=e,l=t,c=i,await new Promise(async(e,t)=>{var i,n=p(s.id);try{pxt.debug("uploading to cloud: "+N(s));var r=null==(i=f.userProfile())?void 0:i.id,o=(s.cloudUserId=r,s.cloudCurrent=!1,s.cloudVersion=l,n.syncInProgress(),{id:s.id,header:JSON.stringify(v(s)),text:c?JSON.stringify(c):void 0,version:l}),a=await f.apiAsync("/api/user/project",o);a.success?(s.cloudCurrent=!0,s.cloudVersion=a.resp,s.cloudLastSyncTime=b.nowSeconds(),pxt.tickEvent("identity.cloudApi.setProject.success"),e({header:s,status:"succeeded"})):409===a.statusCode?(pxt.tickEvent("identity.cloudApi.setProject.conflict"),e({header:s,status:"conflict"})):(pxt.tickEvent("identity.cloudApi.setProject.failed"),t(a.err))}finally{n.syncFinished()}}));return"succeeded"===t.status?(await g.saveAsync(e,null,!0),t.header=g.getHeader(e.id)):pxt.tickEvent("identity.toCloud.failed"),t}async function k(e,t){if(e)return i=Object.assign(Object.assign({},e),t),g.acquireHeaderSession(e),e=await c(e),await g.saveAsync(i,e.text,!0),g.getHeader(i.id);if(t){const e=Object.assign({},t);g.acquireHeaderSession(t);var i=await c(t);return await g.importAsync(e,i.text,!0),g.getHeader(e.id)}pxt.tickEvent("identity.fromCloud.failed")}async function x(e,t){pxt.debug("cloud conflict detected for "+N(e));var i,n=e.name+lf(" - Copy"),n=await g.duplicateAsync(e,n);pxt.tickEvent("identity.sync.conflict.createdDuplicate");let r=!1;try{if(a.hasEditor()){const t=await a.getEditorAsync();t.state.home||(null==(i=t.state.header)?void 0:i.id)!==e.id||await t.loadHeaderAsync(n,t.state.editorState,!1)}}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.reloadEditorFailed",{exception:e}),r=!0}try{e=await k(e,t)}catch(e){throw pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.overwriteLocalFailed",{exception:e}),pxt.tickEvent("identity.sync.conflict.failed"),e}try{o.dialogAsync({header:lf("Project '{0}' had a conflict!",e.name),body:lf("Project '{0}' was edited in two places and the changes conflict. The changes on this computer have been saved to '{1}'. The changes made elsewhere remain in '{2}'.",e.name,n.name,e.name),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1})}catch(e){pxt.reportException(e),r=!0}r?pxt.tickEvent("identity.sync.conflict.failed"):pxt.tickEvent("identity.sync.conflict.success")}function E(e){var t;const i=null==(t=f.userProfile())?void 0:t.id;return(e||g.getHeaders(!0,!1)).filter(e=>e.cloudUserId&&e.cloudUserId===i)}i.getCloudTempMetadata=p,i.syncAsync=y,i.forceReloadForCloudSync=function(){o.infoNotification(lf("Cloud synchronization finished. Reloading... ")),setTimeout(()=>{pxt.debug("cloud forcing reload."),pxt.tickEvent("identity.sync.forcingReload"),location.reload()},3e3)},i.convertCloudToLocal=async function(t){if(t){const e=g.getHeaders(!1,!1).filter(e=>e.cloudUserId&&e.cloudUserId===t),i=[];e.forEach(e=>{e=l(e),i.push(g.forceSaveAsync(e,null,!0))}),await Promise.all(i)}},i.saveLocalProjectsToCloudAsync=async function(t){const e=g.getHeaders().filter(e=>null==e.cloudUserId).filter(e=>t.includes(e.id));if(e.length){const t={},i=[];for(const n of e){const e=await g.duplicateAsync(n,n.name);t[n.id]=e.id,i.push(e)}return await y({hdrs:i,direction:"up"}),t}},i.requestProjectCloudStatus=async function(e){for(const t of e){const e=p(t),i=e.cloudStatus(),n={type:"pxteditor",action:"projectcloudstatus",headerId:e.headerId,status:i.value};pxt.editor.postHostMessageAsync(n)}};let C={},_=0,S=0;const T={subscriptions:[],onDataChanged:e=>{var t=e.split("header:"),t=(b.assert(2===t.length,"onHeaderChangeSubscriber has invalid path subscription: "+e),t[1]);if("*"===t)E().forEach(e=>A(e));else{const e=g.getHeader(t);e?A(e):pxt.debug("cannot find header with id: "+t)}}};async function A(e){var t;f.hasIdentity()&&f.loggedIn()&&e.cloudUserId===(null==(t=f.userProfile())?void 0:t.id)&&!e.cloudCurrent&&!g.isHeaderSessionOutdated(e)&&(C[e.id]=!0,clearTimeout(_),t=async()=>{S=0;try{await h}catch(e){h=void 0}var e=E().filter(e=>C[e.id]);C={},y({hdrs:e,direction:"up"})},S=S||b.now(),15e3<b.now()-S?await t():_=setTimeout(t,3e3))}function N(e){return`'${e.name}' (${e.id.substr(0,5)}...)`}function I(e){return"*"==(e=m.stripProtocol(e))?g.getHeaders().map(e=>p(e.id)):p(e)}i.HEADER_CLOUDSTATE="header-cloudstate",i.init=function(){m.mountVirtualApi(i.HEADER_CLOUDSTATE,{getSync:I}),m.subscribe(T,"header:*")}},{"./app":3,"./auth":8,"./core":64,"./data":67,"./workspace":136}],15:[function(e,t,l){"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.loginCheck=l.syncAsync=l.refreshToken=l.resetAsync=l.ensureGitHubTokenAsync=l.githubProvider=l.reconstructMeta=l.ProviderBase=l.setOauth=l.OAUTH_REMEMBER_STATE=l.OAUTH_HASH=l.OAUTH_REDIRECT=l.OAUTH_STATE=l.OAUTH_TYPE=void 0;const n=e("./core"),r=e("./data");var c=pxt.Util;const o=c.lf;let i,a;function s(e){e=new Error(e);return e.isUserError=!0,e.isSyncError=!0,e}l.OAUTH_TYPE="oauthType",l.OAUTH_STATE="oauthState",l.OAUTH_REDIRECT="oauthRedirect",l.OAUTH_HASH="oauthHash",l.OAUTH_REMEMBER_STATE="oauthRememberState";const d="token",u="tokenExp",p="AutoLogin",h="cloudUser";function f(e,t,i,n){var r=ts.pxtc.Util.guidGen();return pxt.storage.setLocal(l.OAUTH_TYPE,e),pxt.storage.setLocal(l.OAUTH_STATE,r),pxt.storage.setLocal(l.OAUTH_REDIRECT,i||window.location.hash),pxt.storage.setLocal(l.OAUTH_HASH,n),t?pxt.storage.setLocal(l.OAUTH_REMEMBER_STATE,r):pxt.storage.removeLocal(l.OAUTH_REMEMBER_STATE),r}function m(){pxt.storage.removeLocal(l.OAUTH_TYPE),pxt.storage.removeLocal(l.OAUTH_STATE),pxt.storage.removeLocal(l.OAUTH_REDIRECT),pxt.storage.removeLocal(l.OAUTH_HASH),pxt.storage.removeLocal(l.OAUTH_REMEMBER_STATE)}l.setOauth=f,l.ProviderBase=class{constructor(e,t,i,n){this.name=e,this.friendlyName=t,this.icon=i,this.urlRoot=n,this._token=pxt.storage.getLocal(this.name+d)}syncError(e){throw s(e)}user(){return pxt.Util.jsonTryParse(pxt.storage.getLocal(this.name+h))}setUser(e){e?pxt.storage.setLocal(this.name+h,JSON.stringify(e)):pxt.storage.removeLocal(this.name+h),r.invalidate("sync:user"),r.invalidate("github:user")}token(){if(!this.hasTokenExpired())return this._token}reqAsync(e){var t=this.token();if(t)return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,/^https:\/\//.test(e.url)||(e.url=this.urlRoot+e.url),e.allowHttpErrors=!0,c.requestAsync(e);throw this.pleaseLogin()}getJsonAsync(t){return this.reqAsync({url:t}).then(e=>{if(e.statusCode<300)return e.json;throw this.syncError(o("Invalid {0} response {1} at {2}",this.friendlyName,e.statusCode,t))})}fileSuffix(){return".mkcd-"+pxt.appTarget.id}createFileNameWithSuffix(e){return e.replace(/[~"#%&*:<>?/\\{|}]+/g,"_")+this.fileSuffix()}parseTime(e){return Math.round(new Date(e).getTime()/1e3)}pleaseLogin(){var e=o("Please log in to {0}",this.friendlyName),e=(n.infoNotification(e),s(e));return e.isLoginError=!0,e}loginCheck(){this.token()&&(this.hasTokenExpired()?pxt.storage.getLocal(this.name+p)?this.pleaseLogin():(pxt.storage.setLocal(this.name+p,"yes"),this.loginAsync(void 0,!0).then(e=>e&&this.setNewToken(e.accessToken,e.rememberMe,e.expiresIn))):this!==a&&(a=this,y()))}loginAsync(e,t){return c.userError("Not implemented"),Promise.resolve(void 0)}loginInner(){var e=this.name,e=(n.showLoading(e+"login",o("Signing you in to {0}...",this.friendlyName)),f(e,!1)),t=pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name],i=window.location.protocol+"//"+window.location.host+"/oauth-redirect",e={client_id:t.client_id,response_type:"token",state:e,redirect_uri:i,scope:"",expires_in:86400};return t.redirect&&(e.redirect=t.redirect),e}loginCompleteInner(){var e=this.name;n.hideLoading(e+"login")}loginCallback(e,t){var i=this.name;pxt.storage.removeLocal(i+p),this.setNewToken(t.access_token,e,parseInt(t.expires_in)),this.setUser(void 0)}setNewToken(e,t,i){var n=this.name,r=n+d,n=n+u;this._token=e,t?(e?(pxt.storage.setLocal(r,e),i?(t=Math.round(Date.now()/1e3+.75*i),pxt.storage.setLocal(n,t+"")):pxt.storage.removeLocal(n)):(pxt.storage.removeLocal(r),pxt.storage.removeLocal(n)),y()):(pxt.debug("token storage non-opted in"),pxt.storage.removeLocal(r),pxt.storage.removeLocal(n))}hasTokenExpired(){var e=parseInt(pxt.storage.getLocal(this.name+u)||"0");return!(!e||e<c.nowSeconds())}logout(){pxt.storage.removeLocal(this.name+d),pxt.storage.removeLocal(this.name+u),pxt.storage.removeLocal(this.name+p),this._token=void 0,this.setUser(void 0),y()}},l.reconstructMeta=function(e){var t=JSON.parse(e[pxt.CONFIG_NAME]),t={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,editor:pxt.BLOCKS_PROJECT_NAME,name:t.name},source:JSON.stringify(e)},e=JSON.parse(e[".cloudheader.json"]||"{}");return e&&(e.editor&&(t.meta.editor=e.editor),e.target&&(t.meta.cloudId=pxt.CLOUD_ID+e.target),e.targetVersion)&&(t.meta.targetVersions={target:e.targetVersion}),t};const g=e("./githubprovider");function b(){var e;return i||(i={},(e=pxt.appTarget.cloud)&&e.githubPackages&&(e=new g.GithubProvider,i[e.name]=e)),pxt.Util.values(i)}function v(e){var t=b().filter(e=>e.name==g.PROVIDER_NAME)[0];return!t&&e&&c.userError(o("GitHub not configured in this editor.")),t}function y(){r.invalidate("sync:status"),r.invalidate("sync:user"),r.invalidate("sync:loggedin"),r.invalidate("sync:provider"),r.invalidate("sync:providericon"),r.invalidate("github:user")}l.githubProvider=v,l.ensureGitHubTokenAsync=async function(){await v(!0).loginAsync(),pxt.github.token||c.userError(o("Please sign in to GitHub to perform this operation."))},l.resetAsync=function(){var e=v(),t=e&&e.hasToken();return a&&a.logout(),a=null,pxt.storage.removeLocal("cloudId"),m(),y(),t&&e.logout(),Promise.resolve()},l.refreshToken=function(){a&&a.loginAsync(void 0,!0)},l.syncAsync=function(){return(!(e=v())||!(t=e)||t.user()?Promise.resolve():t.getUserInfoAsync().then(e=>e?(e.initials||(e.initials=c.initials(e.name)),t.setUser(e),null):Promise.resolve())).then(()=>{});var t,e},l.loginCheck=function(){const e=b();if(e.length){var t=c.parseQueryString(pxt.storage.getLocal(l.OAUTH_HASH)||"");if(t.access_token){const i=pxt.storage.getLocal(l.OAUTH_TYPE),n=e.filter(e=>e.name==i)[0];if(n){pxt.storage.removeLocal(l.OAUTH_HASH);const e=t.state===pxt.storage.getLocal(l.OAUTH_REMEMBER_STATE);n.loginCallback(e,t)}m()}t=c.parseQueryString((location.hash||"#").slice(1).replace(/%23access_token/,"access_token"));if(t.access_token){const r=pxt.storage.getLocal(l.OAUTH_STATE),o=pxt.storage.getLocal(l.OAUTH_TYPE);if(r&&r==t.state){pxt.storage.removeLocal(l.OAUTH_STATE),pxt.storage.removeLocal(l.OAUTH_TYPE);const a=t.state===pxt.storage.getLocal(l.OAUTH_REMEMBER_STATE),c=e.filter(e=>e.name==o)[0];if(c){c.loginCallback(a,t);const e=pxt.storage.getLocal(l.OAUTH_REDIRECT)||"";location.hash=e}}m()}for(const s of e)s.loginCheck()}},r.mountVirtualApi("sync",{getSync:function(e){var t=a;switch(r.stripProtocol(e)){case"user":return t&&t.user();case"loggedin":return!!t;case"status":return"";case"provider":return t&&t.name;case"providericon":return t?t.icon:"user"}return null}}),r.mountVirtualApi("github",{getSync:function(e){var t=v();return"user"===r.stripProtocol(e)?t&&t.user():null}}),r.mountVirtualApi("ping",{getAsync:function(i){var e=r.stripProtocol(i);if(/\.ico$/.test(i)){const i=pxt.BrowserUtils.isEdge()?e:`${e}?v=${Math.random()}&origin=`+encodeURIComponent(window.location.origin),n=document.createElement("img");return new Promise((e,t)=>{n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=i})}return pxt.Util.requestAsync({url:e,method:"GET",allowHttpErrors:!0}).then(e=>200===e.statusCode||403==e.statusCode||400==e.statusCode).catch(e=>!1)},expirationTime:e=>864e5,isOffline:()=>!pxt.Cloud.isOnline()})},{"./core":64,"./data":67,"./githubprovider":84}],16:[function(e,M,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showUnsupportedHardwareMessageAsync=t.handleServiceWorkerMessageAsync=t.disconnectAsync=t.showDisconnectAsync=t.pairAsync=t.maybeReconnectAsync=t.initAsync=t.setExtensionResult=t.hidDeployCoreAsync=t.nativeHostLongpressAsync=t.nativeHostBackAsync=t.isNativeHost=t.nativeHostPostMessageFunction=t.browserDownloadDeployCoreAsync=void 0;const p=e("./core"),n=e("./electron"),o=e("./package"),r=e("./hidbridge"),a=e("./webusb"),i=e("./data"),s=e("./dialogs");var l=pxt.Cloud;const c=e("./dialogs");function d(e){pxt.debug("cmds: "+e)}let u;function h(e,t,i){return pxt.BrowserUtils.browserDownloadBinText(e,t,{contentType:i,onError:e=>p.errorNotification(lf("saving file failed..."))}),Promise.resolve()}function f(e){let t="";var i=pxt.outputName().replace(/[^.]*/,""),n=e.outfiles[pxt.outputName()],i=o.genFileName(i),r=pxt.BrowserUtils.isBrowserDownloadWithinUserContext();return t=r?pxt.BrowserUtils.toDownloadDataUri(pxt.isOutputText()?ts.pxtc.encodeBase64(n):n,pxt.appTarget.compile.hexMimeType):pxt.isOutputText()?(d("saving "+i),pxt.BrowserUtils.browserDownloadBinText(n,i,{contentType:pxt.appTarget.compile.hexMimeType,userContextWindow:e.userContextWindow,onError:e=>p.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})):(d("saving "+i),pxt.BrowserUtils.browserDownloadBase64(n,i,{contentType:"application/x-uf2",userContextWindow:e.userContextWindow,onError:e=>p.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})),e.success?!r&&pxt.BrowserUtils.isBrowserDownloadInSameWindow()||!e.saveOnly&&c.isDontShowDownloadDialogFlagSet()?Promise.resolve().then(()=>{var e;return null==(e=window.URL)?void 0:e.revokeObjectURL(t)}):pxt.commands.showUploadInstructionsAsync(i,t,p.confirmAsync,e.saveOnly).then(()=>{var e;return null==(e=window.URL)?void 0:e.revokeObjectURL(t)}):Promise.resolve()}function m(e,t,i,n){var r=pxt.appTarget.appTheme.boardName||lf("device"),o=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",a=pxt.BrowserUtils.isBrowserDownloadWithinUserContext(),s=!pxt.BrowserUtils.isIE()&&!pxt.BrowserUtils.isEdge(),l=pxt.appTarget.appTheme.usbDocs,c=pxt.BrowserUtils.hasSaveAs(),d=pxt.appTarget.compile.useUF2?".uf2":".hex",u=(!pxt.usb.isEnabled||null!=(u=null==(u=pxt.appTarget)?void 0:u.compile)&&u.webUSB,!a&&!c&&pxt.commands.renderBrowserDownloadInstructions&&pxt.commands.renderBrowserDownloadInstructions(n)),n=a?lf("Click 'Download' to open the {0} app.",pxt.appTarget.appTheme.boardName):c?lf("Click 'Save As' and save the {0} file to the {1} drive to transfer the code into your {2}.",d,o,r):!u&&lf("Move the {0} file to the {1} drive to transfer the code into your {2}.",d,o,r),c=pxt.BrowserUtils.isBrowserDownloadWithinUserContext()?0:1e4;return i({header:a?lf("Download ready..."):lf("Download completed..."),body:n,jsx:u,hasCloseIcon:!0,hideAgree:!0,helpUrl:l,bigHelpButton:!0,className:"downloaddialog",buttons:[s&&{label:a?lf("Download"):lf("Download again"),className:a?"primary":"lightgrey",urlButton:!0,url:t,fileName:e},{label:lf("Done"),className:"primary",onclick:()=>{pxt.tickEvent("downloaddialog.done"),p.hideDialog()}}],timeout:c}).then(()=>{})}function g(){const t=window.webkit;if(t&&t.messageHandlers&&t.messageHandlers.host&&t.messageHandlers.host.postMessage)return e=>t.messageHandlers.host.postMessage(e);const i=window.android;return i&&i.postMessage?e=>i.postMessage(JSON.stringify(e)):void 0}function b(){return!!g()}function v(e){d("native deploy"),p.infoNotification(lf("Flashing device..."));var t=e.outfiles[pxt.outputName()];return g()({name:e.downloadFileBaseName,download:t}),Promise.resolve()}function y(e){d("native save"),p.infoNotification(lf("Saving file..."));var t=e.outfiles[pxt.outputName()];return g()({name:e.downloadFileBaseName,save:t}),Promise.resolve()}function w(t,i){if(pxt.tickEvent("hid.deploy"),d("hid deploy"),!t.success)return d("compilation failed, use browser deploy instead"),f(t);const n="hiddeploy";return D=!0,pxt.Util.promiseTimeout(12e4,pxt.packetio.initAsync(!1).then(e=>p.showLoadingAsync(n,lf("Downloading..."),e.reflashAsync(t).then(()=>e.reconnectAsync()),5e3)).finally(()=>p.hideLoading(n))).catch(e=>{if("repairbootloader"===e.type)return d("pair bootloader"),C().then(()=>w(t));if("timeout"===e.message)pxt.tickEvent("hid.flash.timeout"),d("flash timeout");else{if("devicenotfound"===e.type)return pxt.tickEvent("hid.flash.devicenotfound"),d("device not found"),pxt.commands.saveOnlyAsync(t);if(19==e.code||"devicelocked"===e.type)return pxt.tickEvent("hid.flash.devicelocked"),d("error: device locked"),pxt.commands.saveOnlyAsync(t);pxt.tickEvent("hid.flash.error"),d("hid error "+e.message),pxt.reportException(e),i&&i.reportError(e.message)}return pxt.commands.saveOnlyAsync(t)}).finally(()=>{D=!1})}function k(t,e){return d("winrt deploy"),pxt.Util.promiseTimeout(18e4,w(t,e)).catch(e=>pxt.packetio.disconnectAsync().catch(e=>{pxt.reportException(e)}).then(()=>p.confirmAsync({header:lf("Something went wrong..."),body:lf("Flashing your {0} took too long. Please disconnect your {0} from your computer and try reconnecting it.",pxt.appTarget.appTheme.boardName||lf("device")),disagreeLbl:lf("Ok"),hideAgree:!0})).then(()=>pxt.commands.saveOnlyAsync(t)))}function B(e){return d("local deploy"),p.infoNotification(lf("Uploading...")),pxt.Util.requestAsync({url:"/api/deploy",headers:{Authorization:l.localToken},method:"POST",data:e,allowHttpErrors:!0}).then(e=>{200!==e.statusCode?p.errorNotification(lf("There was a problem, please try again")):0===e.json.boardCount&&p.warningNotification(lf("Please connect your {0} to your computer and try again",pxt.appTarget.appTheme.boardName))})}function j(e){return pxt.winrt.saveOnlyAsync(e).then(e=>{e&&p.infoNotification(lf("file saved!"))}).catch(e=>p.errorNotification(lf("saving file failed...")))}function x(){var e=u;e&&(e.mkPacketIOWrapper&&(d("extension mkPacketIOWrapper"),pxt.packetio.mkPacketIOWrapper=e.mkPacketIOWrapper),e.deployAsync&&(d("extension deploy core async"),pxt.commands.deployCoreAsync=e.deployAsync),e.saveOnlyAsync&&(d("extension save only async"),pxt.commands.saveOnlyAsync=e.saveOnlyAsync),e.saveProjectAsync&&(d("extension save project async"),pxt.commands.saveProjectAsync=e.saveProjectAsync),e.renderBrowserDownloadInstructions&&(d("extension upload renderBrowserDownloadInstructions"),pxt.commands.renderBrowserDownloadInstructions=e.renderBrowserDownloadInstructions),e.renderUsbPairDialog&&(d("extension renderUsbPairDialog"),pxt.commands.renderUsbPairDialog=e.renderUsbPairDialog),e.renderIncompatibleHardwareDialog&&(d("extension renderIncompatibleHardwareDialog"),pxt.commands.renderIncompatibleHardwareDialog=e.renderIncompatibleHardwareDialog),e.showUploadInstructionsAsync&&(d("extension upload instructions async"),pxt.commands.showUploadInstructionsAsync=e.showUploadInstructionsAsync),e.patchCompileResultAsync&&(d("extension build patch"),pxt.commands.patchCompileResultAsync=e.patchCompileResultAsync),e.blocklyPatch&&(d("extension blockly patch"),pxt.blocks.extensionBlocklyPatch=e.blocklyPatch),e.webUsbPairDialogAsync&&(d("extension webusb pair dialog"),pxt.commands.webUsbPairDialogAsync=e.webUsbPairDialogAsync),e.onTutorialCompleted)&&(d("extension tutorial completed"),pxt.commands.onTutorialCompleted=e.onTutorialCompleted)}function E(t=!1,e=!1){return d("[CLIENT]: starting reconnect"),e&&pxt.packetio.isConnected()&&!L?Promise.resolve():I=I||async function(){var e;if(!P)return T?Promise.reject("Already waiting for packet lock"):await async function(){if(void 0===O){var e=new Promise(e=>{N=e,R({type:"serviceworkerclient",action:"packet-io-supported"})});try{await pxt.U.promiseTimeout(1e3,e),O=!0}catch(e){d("[CLIENT]: old version of service worker, ignoring lock"),O=!1}}return O}()&&null!=(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)&&e.controller?new Promise((e,t)=>{T=e,A=t,d("[CLIENT]: requesting lock "+S),R({type:"serviceworkerclient",action:"request-packet-io-lock",lock:S})}).finally(()=>{T=void 0,A=void 0}):void 0}().then(()=>pxt.packetio.initAsync()).then(e=>e?e.reconnectAsync().catch(e=>{if("devicenotfound"==e.type)return t&&C();throw e}):Promise.resolve()).finally(()=>{I=void 0})}function C(){return pxt.tickEvent("cmds.pair"),pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,p.confirmAsync).then(e=>e?E():p.infoNotification("Oops, no device was paired."))}function _(){return d("[CLIENT]: starting disconnect"),L=!0,pxt.packetio.disconnectAsync().then(()=>{d("[CLIENT]: sending confirmed disconnect "+S),P=!1,R({type:"serviceworkerclient",action:"release-packet-io-lock",lock:S}),L=!1})}pxt.commands.renderBrowserDownloadInstructions=s.renderBrowserDownloadInstructions,pxt.commands.renderIncompatibleHardwareDialog=s.renderIncompatibleHardwareDialog,t.browserDownloadDeployCoreAsync=f,t.nativeHostPostMessageFunction=g,t.isNativeHost=b,t.nativeHostBackAsync=function(){d("native back");var e=g();return e&&e({cmd:"backtap"}),Promise.resolve()},t.nativeHostLongpressAsync=function(){d("native longpress");var e=g();return e&&e({cmd:"backpress"}),Promise.resolve()},t.hidDeployCoreAsync=w,t.setExtensionResult=function(e){u=e,x()},t.initAsync=async function e(){d("cmds init"),pxt.onAppTargetChanged=()=>{d("app target changed"),e()},await pxt.usb.checkAvailableAsync(),await pxt.packetio.disconnectAsync(),pxt.packetio.mkPacketIOWrapper=void 0,pxt.commands.renderDisconnectDialog=void 0,pxt.commands.deployCoreAsync=f,pxt.commands.browserDownloadAsync=h,pxt.commands.saveOnlyAsync=f,pxt.commands.webUsbPairDialogAsync=a.webUsbPairDialogAsync,pxt.commands.showUploadInstructionsAsync=m,pxt.packetio.mkPacketIOAsync=void 0,null!=(t=null==(t=pxt.appTarget)?void 0:t.compile)&&t.useUF2&&(d("hf2 wrapper"),pxt.packetio.mkPacketIOWrapper=pxt.HF2.mkHF2PacketIOWrapper),(null!=(t=null==(t=pxt.appTarget)?void 0:t.compile)&&t.isNative||null!=(t=null==(t=pxt.appTarget)?void 0:t.compile)&&t.hasHex)&&!pxt.BrowserUtils.isPxtElectron()&&(pxt.usb.isAvailable()&&null!=(t=null==(t=pxt.appTarget)?void 0:t.compile)&&t.webUSB?(d("enabled webusb"),pxt.usb.setEnabled(!0),pxt.packetio.mkPacketIOAsync=pxt.usb.mkWebUSBHIDPacketIOAsync):(d("enabled hid bridge (webusb disabled)"),pxt.usb.setEnabled(!1),pxt.packetio.mkPacketIOAsync=r.mkHIDBridgePacketIOAsync));var t=/force(Hex)?(Browser)?Download/i.test(window.location.href),i=pxt.usb.isEnabled&&(null==(i=null==(i=pxt.appTarget)?void 0:i.compile)?void 0:i.webUSB);t||null!=(t=null==(t=pxt.appTarget)?void 0:t.serial)&&t.noDeploy?d("deploy: force browser download"):g()?(d("deploy: webkit deploy/save"),pxt.commands.deployCoreAsync=v,pxt.commands.saveOnlyAsync=y):pxt.winrt.isWinRT()?(d("deploy: winrt"),pxt.packetio.mkPacketIOAsync=pxt.winrt.mkWinRTPacketIOAsync,pxt.commands.browserDownloadAsync=pxt.winrt.browserDownloadAsync,pxt.commands.deployCoreAsync=k,pxt.commands.saveOnlyAsync=j):pxt.BrowserUtils.isPxtElectron()?(d("deploy: electron"),pxt.commands.deployCoreAsync=n.driveDeployAsync,pxt.commands.electronDeployAsync=n.driveDeployAsync):i?(d("deploy: webusb"),pxt.commands.deployCoreAsync=w,pxt.commands.renderDisconnectDialog=a.renderUnpairDialog):r.shouldUse()?(d("deploy: hid"),pxt.commands.deployCoreAsync=w):pxt.BrowserUtils.isLocalHost()&&l.localToken?(d("deploy: localhost"),pxt.commands.deployCoreAsync=B):d("deploy: browser only"),x(),pxt.winrt.isWinRT()&&(d("deploy: init winrt"),pxt.winrt.initWinrtHid(()=>pxt.packetio.initAsync(!0).then(e=>null==e?void 0:e.reconnectAsync()),()=>pxt.packetio.disconnectAsync()))},t.maybeReconnectAsync=E,t.pairAsync=C,t.showDisconnectAsync=function(){var e,t,i;return pxt.commands.renderDisconnectDialog?({header:e,jsx:t,helpUrl:i}=pxt.commands.renderDisconnectDialog(),p.dialogAsync({header:e,jsx:t,helpUrl:i,hasCloseIcon:!0})):Promise.resolve()},t.disconnectAsync=_;const S=pxtc.Util.guidGen();let T,A,N,I,O,P=!1,D=!1,L=!1;function R(e){var t;null!=(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)&&t.controller&&navigator.serviceWorker.controller.postMessage(e)}t.handleServiceWorkerMessageAsync=async function(e){"packet-io-lock-disconnect"!==e.action||T||S!==e.lock?"packet-io-lock-granted"===e.action&&e.lock===S&&T?(e.granted?(d("[CLIENT]: received granted lock "+S),T(),P=!0):(d("[CLIENT]: received denied lock "+S),A()),T=void 0,A=void 0):"packet-io-supported"===e.action&&N?(N(),O=!0,N=void 0):"packet-io-status"===e.action&&R({type:"serviceworkerclient",action:"packet-io-status",hasLock:P,lock:S}):(d("[CLIENT]: received disconnect request "+S),D||pxt.packetio.isConnecting()?R({type:"serviceworkerclient",action:"packet-io-lock-disconnect",lock:S,didDisconnect:!1}):await _())},t.showUnsupportedHardwareMessageAsync=function(t){var i;if(!pxt.packetio.isConnected())return!0;const n=pxt.packetio.unsupportedParts(),e=pxtc.computeUsedParts(t);var r=[];for(const t of n)if(-1!==e.indexOf(t)){r.push(t);break}if(r.length){const t=pxt.commands.renderIncompatibleHardwareDialog(r),n=(pxt.tickEvent("unsupportedhardwaredialog.shown"),null==(i=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:i.incompatibleHardwareHelpURL);let e=!0;return p.confirmAsync({header:lf("Incompatible Code"),jsx:t,hasCloseIcon:!0,hideAgree:!0,helpUrl:n,bigHelpButton:!0,className:"downloaddialog",buttons:[{label:lf("Download Anyway"),className:"primary",onclick:()=>{pxt.tickEvent("unsupportedhardwaredialog.downloadagain"),e=!1,p.hideDialog()}}]}).then(()=>(e&&pxt.tickEvent("unsupportedhardwaredialog.cancelled"),!e))}return Promise.resolve(!0)},i.mountVirtualApi("packetio",{getSync:function(e){switch(i.stripProtocol(e)){case"active":return pxt.packetio.isActive();case"connected":return pxt.packetio.isConnected();case"connecting":return pxt.packetio.isConnecting();case"icon":return pxt.packetio.icon()}return!1}})},{"./core":64,"./data":67,"./dialogs":74,"./electron":77,"./hidbridge":88,"./package":108,"./webusb":135}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CodeCardView=void 0;const g=e("react"),b=e("./sui"),n=e("./data"),v=e("./cloud");pxt.Util.repeatMap;class r extends n.Component{constructor(e){super(e),this.state={}}static setupIntersectionObserver(){this.observer||(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{var t;0<e.intersectionRatio&&(this.observer.unobserve(e.target),e=e.target,t=e.getAttribute("data-src"),e.style.backgroundImage=`url(${t})`)})},{rootMargin:"50px 0px",threshold:.01}))}componentDidMount(){var e,t=this.refs.lazyimage;t&&("IntersectionObserver"in window?(r.setupIntersectionObserver(),r.observer.observe(t)):(e=t.getAttribute("data-src"),t.style.backgroundImage=`url(${e})`))}renderCore(){const i=this.props;var e=i.color||"",t=i.url?/^[^:]+:\/\//.test(i.url)?i.url:"/"+i.url.replace(/^\.?\/?/,""):void 0,n=t&&/^\//.test(t)?"#doc:"+t:t,r=i.className,o=i.cardType,a=i.tutorialLength==i.tutorialStep+1,s=i&&i.description&&i.description.split("\n"),l=i.onClick?e=>{e.target&&"A"==e.target.tagName||(pxt.setInteractiveConsent(!0),i.onClick(e))}:void 0,c=i.imageUrl||(i.youTubeId?`https://img.youtube.com/vi/${i.youTubeId}/0.jpg`:void 0),d=i.projectId?this.getData("header:"+i.projectId):null,u=(d||i).name,p=i.projectId?this.getData(v.HEADER_CLOUDSTATE+":"+i.projectId):null,p=null==p?void 0:p.cloudStatus(),d=p?Math.min(d.cloudLastSyncTime,d.modificationTime):i.time,h=p&&("synced"===p.value||"justSynced"===p.value||"localEdits"===p.value),f=i.ariaLabel||i.title||i.shortName||u,m=i.style||"card",e=g.createElement("div",{className:`ui ${m} ${e} ${i.onClick?"link":""} `+(r||""),role:i.role,"aria-selected":"option"===i.role?"true":void 0,"aria-label":f,title:i.title,onClick:l,tabIndex:i.onClick?i.tabIndex||0:null,onKeyDown:i.onClick?b.fireClickOnEnter:null},i.header?g.createElement("div",{key:"header",className:"ui content "+(i.responsive?" tall desktop only":"")},i.header):null,i.label||i.labelIcon||i.blocksXml||i.typeScript||c||"file"==o?g.createElement("div",{className:"ui image"},i.label||i.labelIcon?g.createElement("label",{role:i.onLabelClicked?"button":void 0,onClick:i.onLabelClicked,className:`ui ${i.labelClass||"orange right ribbon"} label`,"aria-label":f+" "+(i.onLabelClicked?"button":"label")},i.labelIcon?g.createElement(b.Icon,{icon:i.labelIcon}):i.label):void 0,i.typeScript?g.createElement("pre",{key:"promots"},i.typeScript):void 0,"file"!=i.cardType&&c?g.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},g.createElement("div",{className:"ui cardimage","data-src":c,ref:"lazyimage","aria-hidden":!0,role:"presentation"})):void 0,"file"!=i.cardType||c?void 0:g.createElement("div",{className:"ui fileimage"}),"file"==i.cardType&&c?g.createElement("div",{className:"ui fileimage","data-src":c,ref:"lazyimage"}):void 0):void 0,i.icon||i.iconContent?g.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},g.createElement("div",{className:`ui button massive fluid ${i.iconColor} `+(i.iconContent?"iconcontent":""),"aria-hidden":!0,role:"presentation"},i.icon?g.createElement(b.Icon,{icon:"icon "+i.icon}):void 0,i.iconContent||void 0)):void 0,i.shortName||u||s?g.createElement("div",{className:"content "+(this.props.tallCard?"tall":"")},i.shortName||u?g.createElement("div",{className:"header"},i.shortName||u,g.createElement("div",{className:"tags"},null==(m=i.tags)?void 0:m.join(" "))):null,s&&s.map((e,t)=>g.createElement("div",{key:"line"+t,className:"description tall "+(i.icon||i.iconContent||i.imageUrl?"":"long")},e.replace(/`/g,"")))):void 0,i.time?g.createElement("div",{className:"meta"},i.tutorialLength?g.createElement("span",{className:`ui tutorial-progress ${a?"green":"orange"} left floated label`},g.createElement("i",{className:(a?"trophy":"circle")+" icon"})," ",lf("{0}/{1}",(i.tutorialStep||0)+1,i.tutorialLength)):void 0,!p&&i.time&&g.createElement("span",{key:"date",className:"date"},pxt.Util.timeSince(i.time)),p&&h&&g.createElement("span",{key:"date",className:"date "+(i.tutorialLength?"small-screen hide":"")},pxt.Util.timeSince(d),p.indicator),p&&!h&&g.createElement("span",{key:"date",className:"date"},p.indicator),p&&g.createElement("i",{className:"ui large right floated icon cloud"})):void 0,i.extracontent||i.learnMoreUrl||i.buyUrl||i.feedbackUrl?g.createElement("div",{className:"ui extra content mobile hide"},i.extracontent,i.buyUrl?g.createElement("a",{className:"learnmore left floated",href:i.buyUrl,"aria-label":lf("Buy"),target:"_blank",rel:"noopener noreferrer"},lf("Buy")):void 0,i.learnMoreUrl?g.createElement("a",{className:"learnmore right floated",href:i.learnMoreUrl,"aria-label":lf("Learn more"),target:"_blank",rel:"noopener noreferrer"},lf("Learn more")):void 0,i.feedbackUrl?g.createElement("a",{className:"learnmore right floated",href:i.feedbackUrl,"aria-label":lf("Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Feedback")):void 0):void 0);return!i.onClick&&t?g.createElement("div",null,g.createElement("a",{href:t,target:"docs",className:"ui widedesktop hide"},e),g.createElement("a",{href:n,className:"ui widedesktop only"},e)):e}}i.CodeCardView=r},{"./cloud":14,"./data":67,"./sui":129,react:320}],18:[function(e,M,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearApiInfoDbAsync=t.getPackagesWithErrors=t.clearCaches=t.newProjectAsync=t.updatePackagesAsync=t.applyUpgradesAsync=t.getBlocksAsync=t.getApisInfoAsync=t.typecheckAsync=t.snippetAsync=t.formatAsync=t.projectSearchClear=t.projectSearchAsync=t.apiSearchAsync=t.refreshLanguageServiceApisInfo=t.workerOpAsync=t.decompilePySnippetstoXmlAsync=t.decompileSnippetstoXmlAsync=t.decompilePythonSnippetAsync=t.pyDecompileAsync=t.pySnippetToBlocksAsync=t.decompileBlocksSnippetAsync=t.decompileAsync=t.syntaxInfoAsync=t.completionsAsync=t.py2tsAsync=t.assembleAsync=t.compileAsync=t.emptyCompileResult=t.emptyProgram=void 0;const f=e("./package"),i=e("./core"),a=e("./workspace");var m=pxt.Util;function o(e,i,t){var n,r=f.mainEditorPkg();r.forEachFile(e=>e.diagnostics=[]);let o,a="";if(0<i.length&&r.files[pxt.MAIN_TS]&&r.files[pxt.MAIN_PY]&&t){const e=r.files[pxt.MAIN_TS].content,i=r.files[pxt.MAIN_PY].content;o=pxtc.BuildSourceMapHelpers(t,e,i).ts.locToLoc}for(let t of i)t.fileName&&(a+=`${t.category==ts.pxtc.DiagnosticCategory.Error?lf("error"):t.category==ts.pxtc.DiagnosticCategory.Warning?lf("warning"):lf("message")}: ${t.fileName}(${t.line+1},${t.column+1}): `,n=r.filterFiles(e=>e.getTextFileName()==t.fileName)[0])&&(n.diagnostics.push(t),o)&&t.fileName===pxt.MAIN_TS&&(n=o(t))&&(n=Object.assign(Object.assign({},t),n),r.files[pxt.MAIN_PY].diagnostics.push(n)),a+=`${ts.pxtc.DiagnosticCategory[t.category].toLowerCase()} TS${t.code}: ${ts.pxtc.flattenDiagnosticMessageText(t.messageText,"\n")}\n`;a&&pxt.log(a),a=a||m.lf("Everything seems fine!\n");var t=r.outputPkg.setFile("output.txt",a),s=i.filter(e=>e.category==ts.pxtc.DiagnosticCategory.Error);t.numDiagnosticsOverride=s.length,l(s),pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacediagnostics",operation:e,output:a,diagnostics:i.map(e=>({code:e.code,category:ts.pxtc.DiagnosticCategory[e.category].toLowerCase(),fileName:e.fileName,start:e.start,length:e.length,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn}))})}let n="";function l(e){if(e&&e.length){const t={};e.filter(e=>e.code).forEach(e=>t[e.code]=(t[e.code]||0)+1);e=JSON.stringify(e);if(e!==n){for(const e of Object.keys(t))pxt.tickEvent("diagnostics",{errorCode:e,count:t[e]});n=e}}else n=""}let r,s,c,d=new Promise(()=>{});function u(t){return e=>e.isUserError?(i.errorNotification(e.message),f.mainEditorPkg().outputPkg.setFile("output.txt",e.message).numDiagnosticsOverride=1,t):Promise.reject(e)}function p(e){return w("assemble",{fileContent:e})}function h(e){return w("compile",{options:e})}function g(t,e,i){var n=f.mainPkg.getTargetOptions();return f.mainPkg.getCompileOptionsAsync(n).then(e=>(e.fileSystem[pxt.MAIN_TS]=t,e.fileSystem[pxt.MAIN_BLOCKS]="",e.snippetMode=i&&i.snippetMode||!1,-1===e.sourceFiles.indexOf(pxt.MAIN_TS)&&e.sourceFiles.push(pxt.MAIN_TS),-1===e.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&e.sourceFiles.push(pxt.MAIN_BLOCKS),e.ast=!0,b(e,pxt.MAIN_TS)))}function b(e,t){return w("decompile",{options:e,fileName:t})}function v(e,t){return w("pydecompile",{options:e,fileName:t})}function y(t){var e=f.mainPkg.getTargetOptions();return f.mainPkg.getCompileOptionsAsync(e).then(e=>(e.sourceTexts=t,e.snippetMode=!1,-1===e.sourceFiles.indexOf(pxt.MAIN_TS)&&e.sourceFiles.push(pxt.MAIN_TS),-1===e.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&e.sourceFiles.push(pxt.MAIN_BLOCKS),e.ast=!0,w("decompileSnippets",{options:e})))}function w(t,e){const i=Date.now();return pxt.debug("worker op: "+t),pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(t,e).then(e=>(pxt.appTarget.compile.switches.time&&(pxt.log(`Worker perf: ${t} ${Date.now()-i}ms`),e.times)&&console.log(e.times),pxt.debug("worker op done: "+t),e))}t.emptyProgram="(function (ectx) {\n'use strict';\nectx.runtime.setupPerfCounters([]);\nectx.setupDebugger(1)\nreturn function (s) {\n    // START\n    ectx.runtime.kill()\n    return ectx.leave(s, s.r0)\n}\n})\n",t.emptyCompileResult=function(){return{success:!0,diagnostics:[],times:{},breakpoints:[],outfiles:{"binary.js":t.emptyProgram.replace("// START",pxt.appTarget.simulator.emptyRunCode||"")}}},t.compileAsync=function(n={}){let e=f.mainPkg.getTargetOptions();return e.isNative=n.native,f.mainEditorPkg().buildAssetsAsync().then(()=>f.mainPkg.getCompileOptionsAsync(e)).then(e=>(n.debug&&(e.breakpoints=!0,e.justMyCode=!n.debugExtensionCode,e.testMode=!0),n.trace&&(e.breakpoints=!0,e.justMyCode=!0,e.trace=!0),e.computeUsedSymbols=!0,n.forceEmit&&(e.forceEmit=!0),/test=1/i.test(window.location.href)&&(e.testMode=!0),e)).then(h).then(t=>{let e=f.mainEditorPkg().outputPkg.files[pxtc.BINARY_ASM];if(e&&!t.outfiles[pxtc.BINARY_ASM]&&(t.outfiles[pxtc.BINARY_ASM]=e.content),n.jsMetaVersion&&t.outfiles[pxtc.BINARY_JS]){const e={simUrl:pxt.webConfig.simUrl.replace(/\/[^\-]*---simulator/,`/v${pxt.appTarget.versions.target}/---simulator`),cdnUrl:pxt.webConfig.cdnUrl,version:n.jsMetaVersion,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target},i=f.mainPkg.readGitJson();i&&(e.repo=pxt.github.parseRepoId(i.repo).fullName),t.outfiles[pxtc.BINARY_JS]=`// meta=${JSON.stringify(e)}
`+t.outfiles[pxtc.BINARY_JS]}return f.mainEditorPkg().outputPkg.setFiles(t.outfiles),o("compile",t.diagnostics),E().then(()=>{if(t.usedSymbols&&s)for(var e of Object.keys(t.usedSymbols))t.usedSymbols[e]=m.lookup(s.byQName,e);return t})}).catch(u(d))},t.assembleAsync=function(e){return p(`.startaddr 536887040
`+e).then(t=>p(`.startaddr ${536887296-4*(t.words.length+1)}
`+e).then(e=>(m.assert(e.words.length==t.words.length),e)))},t.py2tsAsync=function(e=0){let t=f.mainPkg.getTargetOptions();return x().then(()=>f.mainPkg.getCompileOptionsAsync(t)).then(e=>(e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME,w("py2ts",{options:e})))},t.completionsAsync=function(e,t,i,n,r,o){return w("getCompletions",{fileName:e,fileContent:r,position:t,wordStartPos:i,wordEndPos:n,light:o,runtime:pxt.appTarget.runtime})},t.syntaxInfoAsync=function(e,t,i,n){return w("syntaxInfo",{fileName:t,fileContent:n,position:i,infoType:e})},t.decompileAsync=function(t,i,n,r){var e=f.mainPkg.getTargetOptions();return f.mainPkg.getCompileOptionsAsync(e).then(e=>(e.ast=!0,e.testMode=!0,e.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,b(e,t))).then(e=>{if(e.success&&i&&n&&r){const f=pxt.blocks.layout.patchBlocksFromOldWorkspace(i,n,e.outfiles[r]);e.outfiles[r]=f}return f.mainEditorPkg().outputPkg.setFiles(e.outfiles),o("decompile",e.diagnostics),e})},t.decompileBlocksSnippetAsync=g,t.pySnippetToBlocksAsync=function(t,e){let i=f.mainPkg.getTargetOptions();return x().then(()=>f.mainPkg.getCompileOptionsAsync(i)).then(e=>(e.fileSystem[pxt.MAIN_PY]=t,e.fileSystem[pxt.MAIN_BLOCKS]="",-1===e.sourceFiles.indexOf(pxt.MAIN_PY)&&e.sourceFiles.push(pxt.MAIN_PY),-1===e.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&e.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:e}))).then(e=>g(e.outfiles[pxt.MAIN_TS]))},t.pyDecompileAsync=function(t){var e=f.mainPkg.getTargetOptions();return f.mainPkg.getCompileOptionsAsync(e).then(e=>(e.ast=!0,e.testMode=!0,e.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,v(e,t))).then(e=>(f.mainEditorPkg().outputPkg.setFiles(e.outfiles),l(e.diagnostics.filter(e=>e.category==ts.pxtc.DiagnosticCategory.Error)),e))},t.decompilePythonSnippetAsync=function(t){var e=f.mainPkg.getTargetOptions();return f.mainPkg.getCompileOptionsAsync(e).then(e=>(e.fileSystem[pxt.MAIN_TS]=t,e.fileSystem[pxt.MAIN_PY]="",-1===e.sourceFiles.indexOf(pxt.MAIN_TS)&&e.sourceFiles.push(pxt.MAIN_TS),-1===e.sourceFiles.indexOf(pxt.MAIN_PY)&&e.sourceFiles.push(pxt.MAIN_PY),e.ast=!0,v(e,pxt.MAIN_TS))).then(e=>e.outfiles[pxt.MAIN_PY])},t.decompileSnippetstoXmlAsync=y,t.decompilePySnippetstoXmlAsync=function(n){const r=/^\s*namespace\s+[^\s]+\s*{([\S\s]*)}\s*$/im,o=/^\s*export\s(let\s*[\S\s]*)\s*$/im,a=/^\s*export\s(function\s*[\S\s]*)\s*$/im,e=f.mainPkg.getTargetOptions();let s=[];return x().then(()=>f.mainPkg.getCompileOptionsAsync(e)).then(t=>{for(let e=0;e<n.length;e++){var i="snippet_"+e;t.fileSystem[i+".py"]=n[e],t.sourceFiles.push(i+".py"),s.push(i)}return t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:t})}).then(e=>{var t,i=[];for(t of s){var n=e.outfiles[t+".ts"].match(r);n&&n[1]&&(n=n[1].split("\n").map(e=>{var t=e.match(o),t=t?t[1]:e,e=t.match(a);return e?e[1]:t}),i.push(n.join("\n")))}return y(i)})},t.workerOpAsync=w;let k=!1;function x(){return r||C()}function E(){return k||!s?w("apiInfo",{}).then(e=>{if(0!==Object.keys(e).length)return k=!1,ts.pxtc.localizeApisAsync(e,f.mainPkg)}).then(e=>{s=e}):Promise.resolve()}function C(){var e=f.mainEditorPkg().buildAssetsAsync().then(()=>f.mainPkg.getCompileOptionsAsync()).then(e=>(e.testMode=!0,w("setOptions",{options:e}))).then(()=>w("allDiags",{})).then(e=>o("typecheck",e.diagnostics,e.sourceMap)).then(E).catch(u(null));return r=r||e,e}function _(){return x().then(()=>s)}function S(){if(c)return Promise.resolve(c);{const t=f.mainPkg.resolveBannedCategories();return async function(i,t){if(!t)return null;const n="libs/"+pxt.appTarget.corepkg,e=t[n];if(!e)return null;const r=i.getAllFiles(),o=[pxt.MAIN_TS,pxt.TUTORIAL_CODE_START,pxt.TUTORIAL_CODE_STOP,pxt.TILEMAP_CODE,pxt.IMAGES_CODE];if(Object.keys(r).some(e=>-1===o.indexOf(e)&&-1===e.indexOf("/")&&pxt.Util.endsWith(e,".ts")))return null;var a=pxt.appTarget.bundleddirs.map(e=>{var t=pxt.appTarget.bundledpkgs[e.substr(e.lastIndexOf("/")+1)];return t?{dirname:e,files:t,config:JSON.parse(t[pxt.CONFIG_NAME])}:null}).filter(e=>e&&e.config),s=i.pkgAndDeps(),l=[],c=[{dirname:n,info:e}];for(const i of s)if("built"!==i.id&&!i.isTopLevel()){let e=!1;for(const f of a)if(f.config.name===L(i)){c.push({dirname:f.dirname,info:t[f.dirname]}),e=!0;break}e||l.push(i)}if(l.length){let e;try{e=await R.createAsync()}catch(i){return console.log("Unable to open API info cache DB"),null}for(const i of l){const n=await e.getAsync(i);if(!n)return pxt.debug(`Could not find cached API info for ${L(i)}, waiting for full compile`),null;pxt.debug("Fetched cached API info for "+L(i)),c.push({dirname:i.getPkgId(),info:n})}}var d,u={byQName:{}};for(const i of c)if(i){var{info:p,dirname:h}=i;const f=m.cloneApis(p.apis.byQName);for(const i of Object.keys(f))f[i].pkg=h,delete f[i].attributes._translatedLanguageCode,u.byQName[i]=f[i]}u.jres=f.mainPkg.getJRes()||{};for(const i of Object.keys(u.byQName)){let e=u.byQName[i],t=e.attributes.jres;t&&("true"==t&&(t=i),(d=m.lookup(u.jres,t))&&d.icon&&!e.attributes.iconURL&&(e.attributes.iconURL=d.icon),d)&&d.data&&!e.attributes.jresURL&&(e.attributes.jresURL="data:"+d.mimeType+";base64,"+d.data)}return u}(f.mainEditorPkg(),pxt.getBundledApiInfo()).then(e=>e?ts.pxtc.localizeApisAsync(e,f.mainPkg).then(e=>c=pxtc.getBlocksInfo(e,t)):_().then(e=>{var t=f.mainPkg.resolveBannedCategories();return c=pxtc.getBlocksInfo(e,t),async function(t,i){var n;const r=pxt.Package.corePackages().map(e=>e.name),o=t.pkgAndDeps().filter(e=>"built"!==e.id&&!e.isTopLevel()&&-1===r.indexOf(e.getPkgId()));if(o.length){const r=Object.keys(i.byQName);let e;try{e=await R.createAsync()}catch(t){return void pxt.log("Unable to create DB to cache API info")}for(const t of o){const o=t.getPkgId(),a={sha:null,apis:{byQName:{}}};for(const t of r){const r=i.byQName[t];(r.pkg===o||null!=(n=r.pkgs)&&n.find(e=>e===o))&&(a.apis.byQName[t]=function(e){var e=m.clone(e),t=(delete e.pkgs,m.clone(e.attributes));delete t._translatedLanguageCode;let i=!1;return t._untranslatedBlock&&(t.block=t._untranslatedBlock,delete t._untranslatedBlock,i=!0),t._untranslatedJsDoc&&(t.jsDoc=t._untranslatedJsDoc,delete t._untranslatedJsDoc,i=!0),i&&ts.pxtc.updateBlockDef(t),e.attributes=t,e}(r))}await e.setAsync(t,a),pxt.debug("Stored API info for "+L(t))}}}(f.mainEditorPkg(),e)}).then(()=>c))}}function T(){const e=f.mainPkg,t=f.getEditorPkg(e),i=t.header.targetVersion,n=t.files[pxt.MAIN_BLOCKS]?t.files[pxt.MAIN_BLOCKS].content:`<block type="${ts.pxtc.ON_START_TYPE}"></block>`;let r,o={};return pxt.debug("Applying upgrades to blocks"),pxt.BrowserUtils.loadBlocklyAsync().then(()=>S()).then(e=>{r=new Blockly.Workspace;var t=pxt.blocks.importXml(i,n,e,!0),t=Blockly.Xml.textToDom(t),t=(pxt.blocks.domToWorkspaceNoEvents(t,r),pxtblockly.upgradeTilemapsInWorkspace(r,pxt.react.getTilemapProject()),Blockly.Xml.workspaceToDom(r));return o[pxt.MAIN_BLOCKS]=Blockly.Xml.domToText(t),pxt.blocks.compileAsync(r,e)}).then(e=>(o[pxt.MAIN_TS]=e.source,t.buildAssetsAsync())).then(()=>{var e=t.getAllFiles();for(const t of Object.keys(e).filter(e=>!/^main\.(blocks|ts|py)$/.test(e)))o[t]=e[t];return N(o)}).then(()=>({success:!0,editor:pxt.BLOCKS_PROJECT_NAME,patchedFiles:o})).catch(()=>(pxt.debug("Block upgrade failed, falling back to TS"),A()))}function A(){const e=f.mainPkg,t=f.getEditorPkg(e),i=t.header.targetVersion,n={};return pxt.Util.values(t.files).filter(I).forEach(e=>{var t=pxt.patching.patchJavaScript(i,e.content);t!=e.content&&(n[e.name]=t)}),pxt.debug("Applying upgrades to TypeScript"),N(n).then(()=>({success:!0,editor:pxt.JAVASCRIPT_PROJECT_NAME,patchedFiles:n})).catch(e=>({success:!1,errorCodes:e.errorCodes}))}function N(i){const e=f.mainPkg;return f.mainEditorPkg().buildAssetsAsync().then(()=>e.getCompileOptionsAsync()).then(t=>(i&&Object.keys(i).forEach(e=>{i[e]&&(t.fileSystem[e]=i[e])}),h(t))).then(e=>{if(e.success)return Promise.resolve();{const t={};e.diagnostics&&e.diagnostics.forEach(e=>{e="TS"+e.code;t[e]=(t[e]||0)+1});e=new Error("Compile failed on updated package");return e.errorCodes=t,Promise.reject(e)}})}function I(e){return pxt.Util.endsWith(e.getName(),".ts")}function O(){return P(),w("reset",{})}function P(){r=null,s=null,c=null}function D(e){e=JSON.stringify(e.getAllFiles())+pxt.appTarget.versions.pxt+"_"+pxt.appTarget.versions.target;return pxtc.U.sha256(e)}function L(e){var e=e.getKsPkg(),t=e._verspec;return pxt.github.isGithubId(t)?/^([^#]+)/.exec(t)[1]:e.config.name}t.refreshLanguageServiceApisInfo=function(){k=!0},t.apiSearchAsync=function(e){return E().then(()=>(e.localizedApis=s,e.localizedStrings=pxt.Util.getLocalizedStrings(),w("apiSearch",{search:e,blocks:function(){var e=f.mainPkg.resolveBannedCategories();if(e)return{bannedCategories:e}}()})))},t.projectSearchAsync=function(e){return E().then(()=>w("projectSearch",{projectSearch:e}))},t.projectSearchClear=function(){return E().then(()=>w("projectSearchClear",{}))},t.formatAsync=function(e,t){return w("format",{format:{input:e,pos:t}})},t.snippetAsync=function(e,t){let i=Promise.resolve();return(i=t?C().then(()=>{}):i).then(()=>w("snippet",{snippet:{qName:e,python:t},runtime:pxt.appTarget.runtime})).then(e=>e)},t.typecheckAsync=C,t.getApisInfoAsync=_,t.getBlocksAsync=S,t.applyUpgradesAsync=function(){const e=f.mainPkg,r=f.getEditorPkg(e),t=pxt.semver.parse(r.header.targetVersion||"0.0.0"),i=pxt.semver.parse(pxt.appTarget.versions.target);if(0===pxt.semver.cmp(t,i))return pxt.debug("Skipping project upgrade"),Promise.resolve({success:!0});var n=r.header.editor!==pxt.BLOCKS_PROJECT_NAME?A:T;let o=!1;return N().catch(()=>o=!0).then(n).then(e=>{return e.success?(pxt.tickEvent("upgrade.success",{projectEditor:r.header.editor,upgradedEditor:e.editor,preUpgradeVersion:r.header.targetVersion||"unknown",projectNeverCompiled:""+o}),pxt.debug("Upgrade successful!"),t=r,i=e.patchedFiles,n=e.editor,Object.keys(i).forEach(e=>t.setFile(e,i[e])),t.header.targetVersion=pxt.appTarget.versions.target,t.header.editor=n,t.saveFilesAsync().then(()=>e)):(pxt.tickEvent("upgrade.failed",{projectEditor:r.header.editor,preUpgradeVersion:r.header.targetVersion||"unknown",errors:JSON.stringify(e.errorCodes),projectNeverCompiled:""+o}),pxt.debug("Upgrade failed; bailing out and leaving project as-is"),Promise.resolve(e));var t,i,n})},t.updatePackagesAsync=function(t,i){const n=f.mainEditorPkg();let r,o=0;return i&&i.startOperation(),a.getTextAsync(n.header.id).then(e=>a.makeBackupAsync(n.header,e)).then(e=>(r=e,n.header.backupRef=r.id,a.saveAsync(n.header))).then(()=>m.promiseMapAllSeries(t,e=>(i&&i.throwIfCancelled(),n.updateDepAsync(e.getPkgId()).then(()=>{++o,i&&!i.isCancelled()&&i.reportProgress(o,t.length)})))).then(()=>f.loadPkgAsync(n.header.id)).then(()=>O()).then(()=>N()).then(()=>(i&&i.throwIfCancelled(),delete n.header.backupRef,a.saveAsync(n.header))).then(()=>!0).catch(()=>a.restoreFromBackupAsync(n.header).then(()=>!1)).finally(()=>{let e=Promise.resolve();return r&&(r.isDeleted=!0,e=a.forceSaveAsync(r)),e.finally(()=>{i&&i.resolveCancel()})})},t.newProjectAsync=O,t.clearCaches=P,t.getPackagesWithErrors=function(){const t={},e=f.mainEditorPkg();if(e){const i=pxt.Package.corePackages().map(e=>e.name);e.forEachFile(e=>{e.diagnostics&&e.diagnostics.length&&e.epkg&&-1===i.indexOf(e.epkg.getPkgId())&&!e.epkg.isTopLevel()&&e.diagnostics.some(e=>e.category===ts.pxtc.DiagnosticCategory.Error)&&(t[e.epkg.getPkgId()]=e.epkg)})}return pxt.Util.values(t)};class R{constructor(e){this.db=e}static dbName(){return"__pxt_apis_"+(pxt.appTarget.id||"")}static createAsync(){function t(){const e=new pxt.BrowserUtils.IDBWrapper(R.dbName(),2,(e,t)=>{t.result.createObjectStore(R.TABLE,{keyPath:R.KEYPATH})},()=>{pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(R.dbName())});return e.openAsync().then(()=>new R(e))}return t().catch(e=>(console.log("db: failed to open api database, try delete entire store..."),pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(R.dbName()).then(()=>t())))}getAsync(e){const t=L(e),i=D(e);return this.db.getAsync(R.TABLE,t).then(e=>{if(e&&e.hash===i)return e.apis})}setAsync(e,t){pxt.perf.measureStart("compiler db setAsync");e={id:L(e),hash:D(e),apis:t};return this.db.setAsync(R.TABLE,e).then(()=>{pxt.perf.measureEnd("compiler db setAsync")})}clearAsync(){return this.db.deleteAllAsync(R.TABLE).then(()=>console.debug("db: all clean")).catch(e=>{console.error("db: failed to delete all")})}}R.TABLE="files",R.KEYPATH="id",t.clearApiInfoDbAsync=function(){return R.createAsync().then(e=>e.clearAsync()).catch(e=>pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(R.dbName()).then())}},{"./core":64,"./package":108,"./workspace":136}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FilterPanel=i.FilterPanelSubheading=i.FilterTag=void 0;const n=e("react"),r=e("../sui");class o extends n.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return n.createElement("div",{className:"filter-tag"},n.createElement("div",{className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:r.fireClickOnEnter,"aria-checked":this.props.selected},n.createElement("i",{className:"icon square outline "+(this.props.selected?"check":"")})),n.createElement("div",{className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:r.fireClickOnEnter},pxtc.U.rlf(this.props.tag)))}clickHandler(){this.props.onClickHandler(this.props.tag)}}i.FilterTag=o;class a extends n.Component{render(){return n.createElement("div",{className:"filter-subheading-row"},n.createElement("div",{className:"filter-subheading-title"},this.props.subheading+":"),this.props.buttonText&&n.createElement("div",{className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:r.fireClickOnEnter},this.props.buttonText))}}i.FilterPanelSubheading=a;class s extends n.Component{isTagSelected(e){return 0<=this.props.enabledTags.indexOf(e.toLowerCase())}render(){var e=this.props.tagOptions;return n.createElement("div",{className:"filter-panel"},n.createElement("div",{className:"filter-title"},lf("Filter")),n.createElement(a,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:0<this.props.enabledTags.length?{color:"white"}:{}}),n.createElement("div",{className:"filter-tag-list"},e.map(e=>n.createElement(o,{key:e,tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler}))))}}i.FilterPanel=s},{"../sui":129,react:320}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Alert=void 0;const r=e("react"),n=e("react-redux"),o=e("./actions/dispatch");class a extends r.Component{constructor(e){super(e)}render(){var{title:e,text:t,options:i,dispatchHideAlert:n}=this.props;return r.createElement("div",{className:"image-editor-alert-container",role:"region",onClick:n},r.createElement("div",{className:"image-editor-alert",role:"dialog"},r.createElement("div",{className:"title"},r.createElement("span",{className:"ms-Icon ms-Icon--Warning"}),r.createElement("span",null,e),r.createElement("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:n})),r.createElement("div",{className:"text"},t),i&&r.createElement("div",{className:"options"},i.map((e,t)=>r.createElement("div",{key:t,className:"button",role:"button",onClick:e.onClick},e.label)))))}}e={dispatchHideAlert:o.dispatchHideAlert};i.Alert=n.connect(function({editor:e},t){return e?t:{}},e)(a)},{"./actions/dispatch":33,react:320,"react-redux":299}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BottomBar=i.BottomBarImpl=void 0;const g=e("react"),n=e("react-redux"),r=e("./actions/dispatch"),b=e("./Button"),v=e("./util"),o=e("../../assets"),a=e("./keyboardShortcuts");class s extends g.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{var e=e.target.value,t=parseInt(e),{aspectRatioLocked:i,imageDimensions:n}=this.props;!isNaN(t)&&i?this.setState({width:t+"",height:Math.floor(t*(n[1]/n[0]))+""}):this.setState({width:e})},this.handleHeightChange=e=>{var e=e.target.value,t=parseInt(e),{aspectRatioLocked:i,imageDimensions:n}=this.props;!isNaN(t)&&i?this.setState({height:t+"",width:Math.floor(t*(n[0]/n[1]))+""}):this.setState({height:e})},this.handleDimensionalBlur=()=>{var{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:i}=this.props,n=parseInt(this.state.width),r=parseInt(this.state.height),t=t?255:512,n=isNaN(n)?e[0]:Math.min(Math.max(n,1),t),r=isNaN(r)?e[1]:Math.min(Math.max(r,1),t);n===e[0]&&r===e[1]||i([n,r]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;var i=e.target.value.trim(),e=e.target.value;pxt.validateAssetName(i)?o.isNameTaken(i)&&i!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:e,assetNameMessage:t})},this.handleAssetNameBlur=()=>{var{dispatchChangeAssetName:e,assetName:t}=this.props,i=this.state.assetName.trim();i!==t&&pxt.validateAssetName(i)&&!o.isNameTaken(i)&&e(i),this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){var{imageDimensions:e,cursorLocation:t,hasUndo:i,hasRedo:n,dispatchUndoImageEdit:r,dispatchRedoImageEdit:o,aspectRatioLocked:a,onionSkinEnabled:s,dispatchToggleAspectRatioLocked:l,dispatchToggleOnionSkinEnabled:c,resizeDisabled:d,singleFrame:u,onDoneClick:p,assetName:h}=this.props,f=this.state["assetNameMessage"],m=null==this.state.width?e[0]:this.state.width,e=null==this.state.height?e[1]:this.state.height,h=null==this.state.assetName?h||"":this.state.assetName;return g.createElement("div",{className:"image-editor-bottombar"},!d&&g.createElement("div",{className:"image-editor-resize"},g.createElement("input",{className:"image-editor-input",title:lf("Image Width"),value:m,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),g.createElement(b.IconButton,{onClick:l,iconClass:a?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:a?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!a,noTab:!0}),g.createElement("input",{className:"image-editor-input",title:lf("Image Height"),value:e,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})),!u&&g.createElement("div",{className:"image-editor-seperator"}),!u&&g.createElement("div",null,g.createElement(b.IconButton,{onClick:c,iconClass:"ms-Icon ms-Icon--MapLayers",title:s?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!s})),t&&!d&&g.createElement("div",{className:"image-editor-seperator"}),g.createElement("div",{className:"image-editor-coordinate-preview"},t&&t[0]+", "+t[1]),g.createElement("div",{className:"image-editor-change-name"},g.createElement("input",{className:"image-editor-input",title:lf("Asset Name"),value:h,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),f&&g.createElement("div",{className:"ui pointing below red basic label"},f)),g.createElement("div",{className:"image-editor-undo-redo"},g.createElement(b.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:i?r:null,disabled:!i}),g.createElement(b.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:n?o:null,disabled:!n})),g.createElement("div",{className:"image-editor-seperator"}),g.createElement("div",{className:"image-editor-zoom-controls"},g.createElement(b.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),g.createElement(b.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})),g.createElement("div",{role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:p,onKeyDown:v.fireClickOnlyOnEnter},lf("Done")))}setShortcutsEnabled(e){e&&this.shortcutLock?(a.releaseShortcutLock(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=a.obtainShortcutLock())}}i.BottomBarImpl=s;e={dispatchChangeImageDimensions:r.dispatchChangeImageDimensions,dispatchUndoImageEdit:r.dispatchUndoImageEdit,dispatchRedoImageEdit:r.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:r.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:r.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:r.dispatchChangeZoom,dispatchChangeAssetName:r.dispatchChangeAssetName};i.BottomBar=n.connect(function({store:{present:e,past:t,future:i},editor:n},r){var o;return e?{imageDimensions:[(o=(n.isTilemap?e.tilemap:e.frames[e.currentFrame]).bitmap).width,o.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:n.onionSkinEnabled,cursorLocation:n.cursorLocation,resizeDisabled:"tile"===(null==(o=e.asset)?void 0:o.type),assetName:null==(e=null==(o=e.asset)?void 0:o.meta)?void 0:e.displayName,hasUndo:!!t.length,hasRedo:!!i.length,isTilemap:n.isTilemap}:{}},e)(s)},{"../../assets":6,"./Button":22,"./actions/dispatch":33,"./keyboardShortcuts":35,"./util":42,react:320,"react-redux":299}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IconButton=void 0;const a=e("react"),s=e("./util");class n extends a.Component{render(){var{title:e,iconClass:t,onClick:i,toggle:n,disabled:r,noTab:o}=this.props;return a.createElement("div",{role:"button",className:`image-editor-button ${n?"toggle":""} `+(r?"disabled":""),title:e,tabIndex:o||r?-1:0,onClick:i,onKeyDown:s.fireClickOnlyOnEnter},a.createElement("span",{className:t}))}}i.IconButton=n},{"./util":42,react:320}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CursorSizes=void 0;const n=e("react"),r=e("./actions/dispatch"),o=e("react-redux");class a extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){var e=this.props["selected"];return n.createElement("div",{className:"cursor-buttons"},n.createElement("div",{className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},n.createElement("div",{className:"cursor-button small"})),n.createElement("div",{className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},n.createElement("div",{className:"cursor-button medium"})),n.createElement("div",{className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},n.createElement("div",{className:"cursor-button large"})))}clickHandler(t){return this.handlers[t]||(this.handlers[t]=()=>{var e=this.props["dispatchChangeCursorSize"];e(t)}),this.handlers[t]}}e={dispatchChangeCursorSize:r.dispatchChangeCursorSize};i.CursorSizes=o.connect(function({editor:e},t){return e?{selected:e.cursorSize}:{}},e)(a)},{"./actions/dispatch":33,react:320,"react-redux":299}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const r=e("react");class n extends r.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:i}=this.props,t=this.state["open"],n=e[i];return r.createElement("div",{className:"image-editor-dropdown-outer"},r.createElement("button",{className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},(null==n?void 0:n.text)||"",r.createElement("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})),r.createElement("ul",{tabIndex:-1,role:"listbox","aria-activedescendant":null==n?void 0:n.id,className:t&&e.length?"":"hidden"},e.map((e,t)=>r.createElement("li",{key:e.id,role:"option","aria-selected":t===i,className:t===i?"selected":"",onClick:this.clickHandler(t)},e.text))))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Dropdown=n},{react:320}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageCanvas=void 0;const n=e("react"),r=e("react-redux"),c=e("./store/imageReducer"),o=e("./actions/dispatch"),a=e("./util"),d=e("./toolDefinitions"),u=e("../../assets"),s=e("./keyboardShortcuts"),p=e("./ImageEditor"),l=[c.TileDrawingMode.Wall];class h extends n.Component{constructor(){super(...arguments),this.cursor=d.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache=[],this.onKeyDown=t=>{var e;if(s.areShortcutsEnabled()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&null!=(e=null==(e=this.editState)?void 0:e.floating)&&e.image){let e=!1;switch(t.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),e=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),e=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),e=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),e=!0}e&&(this.props.dispatchImageEdit(this.editState.toImageState()),t.preventDefault())}if(!t.repeat){switch(!t.ctrlKey&&!t.metaKey||"c"!==t.key&&"v"!==t.key||t.stopPropagation(),(t.ctrlKey||t.metaKey)&&"a"===t.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),t.preventDefault()),"Escape"==t.key&&null!=(e=null==(e=this.editState)?void 0:e.floating)&&e.image&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),t.preventDefault()),("Backspace"===t.key||"Delete"===t.key)&&null!=(e=null==(e=this.editState)?void 0:e.floating)&&e.image&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),t.preventDefault()),this.lastTool=this.props.tool,t.keyCode){case 18:this.props.dispatchChangeImageTool(c.ImageEditorTool.ColorSelect),t.preventDefault();break;case 32:this.props.dispatchChangeImageTool(c.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t;if(this.props.tool===c.ImageEditorTool.Marquee&&null!=(t=null==(t=this.editState)?void 0:t.floating)&&t.image)if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify(a.createTilemapPatchFromFloatingLayer(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=t=>{if(this.props.isTilemap){const i=t.clipboardData.getData("application/makecode-tilemap");let e;try{e=JSON.parse(i)}catch(t){}return e&&e.map&&e.layers&&e.tiles?(t.preventDefault(),void this.applyTilemapPatch(e)):void 0}let i=t.clipboardData.getData("application/makecode-image");if(!i){const e=t.clipboardData.getData("text/plain"),n=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(e);n&&(i=n[0])}const e=i&&pxt.sprite.imageLiteralToBitmap(i);e&&e.width&&e.height&&(t.preventDefault(),this.props.tool!==c.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(c.ImageEditorTool.Marquee),this.editState.setFloatingLayer(e),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){var e=this.getImageState(),e=!e||e.bitmap.height>e.bitmap.width;return n.createElement("div",{ref:"canvas-bounds",className:"image-editor-canvas "+(e?"portrait":"landscape"),onContextMenu:this.preventContextMenu},n.createElement("div",{className:"paint-container"},!this.props.lightMode&&n.createElement("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),n.createElement("canvas",{ref:"paint-surface",className:"paint-surface"}),l.map((e,t)=>n.createElement("canvas",{ref:"paint-surface-"+e.toString(),className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide"),key:t})),n.createElement("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"})))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=l.map(e=>this.refs["paint-surface-"+e.toString()]),a.bindGestureEvents(this.refs["canvas-bounds"],this);var e=this.refs["canvas-bounds"],e=(e.addEventListener("wheel",e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()}),e.addEventListener("mousemove",e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)}),e.addEventListener("mouseout",e=>{this.edit||this.updateCursorLocation(null)}),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste),this.getImageState());this.editState=d.getEditState(e,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){var e;this.edit&&this.editState||(e=this.getImageState(),this.editState=d.getEditState(e,this.props.isTilemap,this.props.drawingMode)),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta?(0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),this.props.dispatchChangeZoom(null)):(this.redraw(),this.updateBackground())}componentWillUnmount(){this.tileCache=[],document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):null!=(t=null==(e=this.editState)?void 0:e.floating)&&t.image&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY?(this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.edit&&this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}onDragEnd(e){this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY?(this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1)):this.edit&&(this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit())}updateCursorLocation(e){var t,i;return e?this.canvas?(t=this.canvas.getBoundingClientRect(),i=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),e=Math.floor((e.clientY-t.top)/t.height*this.imageHeight),!(this.cursorLocation&&i===this.cursorLocation[0]&&e===this.cursorLocation[1]||(this.cursorLocation=[i,e],this.hasHover&&this.props.dispatchChangeCursorLocation(i<0||e<0||i>=this.imageWidth||e>=this.imageHeight?null:this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(i,e)),0))):!(this.cursorLocation=[0,0]):(this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1)}updateCursor(e,t){const i=this.props["tool"],n=d.tools.find(e=>e.tool===i);n?t?e?this.updateCursorCore(n.downLayerCursor||n.hoverLayerCursor||n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverLayerCursor||n.hoverCursor):e?this.updateCursorCore(n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverCursor):this.updateCursorCore(d.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||d.ToolCursor.Default,this.updateBackground()}startEdit(e){var{tool:t,toolWidth:i,selectedColor:n,backgroundColor:r,drawingMode:o}=this.props,[a,s]=this.cursorLocation;this.inBounds(a,s)&&(a=o==c.TileDrawingMode.Wall?2:e?r:n,this.edit=d.getEdit(t,this.editState,a,i),this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.editState))}updateEdit(e,t){this.edit&&this.edit.inBounds(e,t)&&(this.edit.update(e,t),this.redraw())}commitEdit(){var e=this.props["dispatchImageEdit"],t=this.getImageState();this.edit&&(this.editState=d.getEditState(t,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.edit=void 0,e(this.editState.toImageState()))}redraw(){const{prevFrame:i,onionSkinEnabled:n,selectedColor:e,toolWidth:t,drawingMode:r,tool:o}=this.props,a=this.getImageState(),s=r==c.TileDrawingMode.Wall?2:e;let l=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,l=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach(e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth}),n&&i){const n=d.getEditState(i,this.props.isTilemap,r),e=this.canvas.getContext("2d");e.globalAlpha=.5,this.drawImage(n.image),n.floating&&n.floating.image&&this.drawImage(n.floating.image,n.layerOffsetX,n.layerOffsetY,!0),e.globalAlpha=1}if(this.edit){const i=this.editState.copy();i.setActiveLayer(r),this.edit.doEdit(i),this.drawImage(i.image),this.drawOverlayLayers(i.overlayLayers),this.redrawFloatingLayer(i)}else if(this.drawImage(this.editState.image),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const i=o===c.ImageEditorTool.Erase?0:s;this.drawCursor(this.cursorLocation[0]-(t>>1),this.cursorLocation[1]-(t>>1),t,i)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const i=this.background.getContext("2d"),n=(i.imageSmoothingEnabled=!1,i.fillStyle="#aeaeae",i.fillRect(0,0,this.background.width,this.background.height),i.fillStyle="#dedede",this.imageHeight<<1),e=this.imageWidth<<1;for(let t=0;t<e;t++)for(let e=0;e<n;e++)t+e&1&&i.fillRect(t*this.cellWidth,e*this.cellWidth,this.cellWidth,this.cellWidth)}}l&&this.zoomToCanvas()}drawImage(e,t=0,i=0,n=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,i,n):this.drawBitmap(e,t,i,n)}redrawFloatingLayer(e,t=!1){var i,n,r,o,a,s=this.refs["floating-layer-border"];e.floating&&e.floating.image?(t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY)),t=this.canvas.getBoundingClientRect(),i=Math.max(e.layerOffsetX,0),n=Math.max(e.layerOffsetY,0),r=Math.min(e.layerOffsetX+e.floating.image.width,e.width),o=Math.min(e.layerOffsetY+e.floating.image.height,e.height),a=t.width/e.width,t=t.height/e.height,s.style.display="",(r-i<1||o-n<1)&&(s.style.display="none"),s.style.left=-this.panX+a*i+"px",s.style.top=-this.panY+t*n+"px",s.style.width=a*(r-i)+"px",s.style.height=t*(o-n)+"px",s.style.borderLeft=0<=e.layerOffsetX?"":"none",s.style.borderTop=0<=e.layerOffsetY?"":"none",s.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",s.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none"):s.style.display="none"}drawOverlayLayers(e,i=0,n=0,r=!this.props.lightMode){e&&e.forEach((e,t)=>{this.drawBitmap(e,i,n,r,this.canvasLayers[t])})}drawBitmap(i,n=0,r=0,t=!this.props.lightMode,o=this.canvas){if(!this.colors){this.colors=new Uint8ClampedArray(4*this.props.colors.length);const i=pxt.sprite.colorStringToRGB(p.LIGHT_MODE_TRANSPARENT);this.colors[0]=i[0],this.colors[1]=i[1],this.colors[2]=i[2];for(let e=1;e<this.props.colors.length;e++){const[n,r,t]=pxt.sprite.colorStringToRGB(this.props.colors[e]),o=e<<2;this.colors[o]=n,this.colors[1+o]=r,this.colors[2+o]=t,this.colors[3+o]=255}}this.colors[3]=t?0:255;var t=o.getContext("2d"),a=t.getImageData(0,0,o.width,o.height);for(let t=0;t<i.height;t++)for(let e=0;e<i.width;e++){var s=(n+e<<2)+((r+t)*o.width<<2),l=i.get(e,t)<<2;a.data[s]=this.colors[l],a.data[1+s]=this.colors[1+l],a.data[2+s]=this.colors[2+l],a.data[3+s]=this.colors[3+l]}t.putImageData(a,0,0)}generateTile(e,t){var i;return t.tiles[e]?((i=document.createElement("canvas")).width=t.tileWidth,i.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!this.props.lightMode,i),this.tileCache[e]=i):null}drawTilemap(i,n=0,r=0,o=!this.props.lightMode,e=this.canvas){var{tileset:a}=this.props["tilemapState"],s=e.getContext("2d");let l,c;this.tileCache=[],s.imageSmoothingEnabled=!1,s.fillStyle=p.LIGHT_MODE_TRANSPARENT;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)if((l=i.get(t,e))&&l<a.tiles.length){if(!(c=(c=this.tileCache[l])||this.generateTile(l,a)))continue;s.drawImage(c,(t+n)*this.cellWidth,(e+r)*this.cellWidth)}else o||s.fillRect((t+n)*this.cellWidth,(e+r)*this.cellWidth,this.cellWidth,this.cellWidth)}drawCursor(n,r,o,e){var t=this.props.isTilemap&&this.props.drawingMode===c.TileDrawingMode.Wall,a=(t?this.canvasLayers[0]:this.canvas).getContext("2d");if(a.imageSmoothingEnabled=!1,e)if(this.props.isTilemap&&!t){if(!(e>=this.props.tilemapState.tileset.tiles.length)){let i=this.tileCache[e];if(i=i||this.generateTile(e,this.props.tilemapState.tileset))for(let t=0;t<o;t++)for(let e=0;e<o;e++)a.drawImage(i,(n+t)*this.cellWidth,(r+e)*this.cellWidth)}}else a.fillStyle=this.props.colors[e],a.fillRect(n*this.cellWidth,r*this.cellWidth,o*this.cellWidth,o*this.cellWidth);else this.props.lightMode?(a.fillStyle=p.LIGHT_MODE_TRANSPARENT,a.fillRect(n*this.cellWidth,r*this.cellWidth,o*this.cellWidth,o*this.cellWidth)):a.clearRect(n*this.cellWidth,r*this.cellWidth,o*this.cellWidth,o*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,i){const n=this.refs["canvas-bounds"];if(this.canvas&&n){var r=n.getBoundingClientRect(),{canvasX:o,canvasY:a}=(t=void 0===t?r.left+(r.width>>1):t,i=void 0===i?r.top+(r.height>>1):i,this.clientToCanvas(t,i,r)),s=(this.zoom=Math.max(this.zoom+e,2.5),this.getCanvasUnit(r));if(s){const{canvasX:e,canvasY:n}=this.clientToCanvas(t,i,r);if(isNaN(e)||isNaN(n)||isNaN(o)||isNaN(a))return;this.panX+=(o-e)*s,this.panY+=(a-n)*s}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];var i=this.refs["canvas-bounds"].getBoundingClientRect(),n=this.canvas.getBoundingClientRect();return n.width<i.width&&(e=-((i.width>>1)-(n.width>>1))),n.height<i.height&&(t=-((i.height>>1)-(n.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;var e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){var t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();t=this.getCanvasUnit(e);if(0===t)return this.waitingToZoom?void 0:(this.waitingToZoom=!0,void requestAnimationFrame(()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}));this.waitingToZoom=!1;var i=t*this.imageWidth,n=t*this.imageHeight,t=1<this.imageWidth&&1<this.imageHeight?2*t:t>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,i-t),-(e.width-t)),this.panY=Math.max(Math.min(this.panY,n-t),-(e.height-t)),this.canvas.style.position="fixed",this.canvas.style.width=i+"px",this.canvas.style.height=n+"px",this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach(e=>this.cloneCanvasStyle(this.canvas,e)),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){var i=this.refs["canvas-bounds"].getBoundingClientRect();let n,{canvasX:r,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,i);r=Math.floor(r),o=Math.floor(o),n=(n=this.editState.inFloatingLayer(r,o)?this.editState.floating.image.get(r-this.editState.layerOffsetX,o-this.editState.layerOffsetY):n)||this.editState.image.get(r,o),t?this.props.dispatchChangeBackgroundColor(n):this.props.dispatchChangeSelectedColor(n)}selectAll(){this.props.tool!==c.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(c.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,i){var n=this.getCanvasUnit(i);return{canvasX:(e-i.left+this.panX)/n,canvasY:(t-i.top+this.panY)/n}}getCanvasUnit(e){var t=e.width/e.height,i=this.imageWidth/this.imageHeight,n=Math.pow(this.zoom/10,2);return i<t?n*(e.height/this.imageHeight):n*(e.width/this.imageWidth)}inBounds(e,t){return 0<=e&&e<this.imageWidth&&0<=t&&t<this.imageHeight}isPanning(){return this.props.tool===c.ImageEditorTool.Pan}isColorSelect(){return this.props.tool===c.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case c.ImageEditorTool.Fill:case c.ImageEditorTool.Marquee:case c.ImageEditorTool.Pan:case c.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(t){const{tilemapState:i,dispatchCreateNewTile:n,gallery:r,backgroundColor:o}=this.props,a=i["tileset"],s=pxt.sprite.tilemapLiteralToTilemap(t.map);if(s&&s.width&&s.height){var l=t.tiles.map(e=>pxt.sprite.getBitmapFromJResURL("data:image/x-mkcd-f4;base64,"+e)),t=t.layers.map(e=>pxt.sprite.getBitmapFromJResURL("data:image/x-mkcd-f4;base64,"+e)),c=[];let e=a.tiles.length;for(const t of l){const i=a.tiles.findIndex(e=>t.equals(pxt.sprite.Bitmap.fromData(e.bitmap)));if(0<=i)c.push(i);else{if(r){const i=r.find(e=>t.equals(pxt.sprite.Bitmap.fromData(e.bitmap)));if(i){n(null,a.tiles.length,o,i.qualifiedName),c.push(e),e++;continue}}n(u.createTile(t.data()),a.tiles.length,o),c.push(e),e++}}this.editState.mergeFloatingLayer();var d=new pxt.sprite.Tilemap(s.width,s.height);for(let t=0;t<d.width;t++)for(let e=0;e<d.height;e++)d.set(t,e,c[s.get(t,e)]);this.editState.floating={image:d,overlayLayers:t},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}}e={dispatchImageEdit:o.dispatchImageEdit,dispatchChangeCursorLocation:o.dispatchChangeCursorLocation,dispatchChangeZoom:o.dispatchChangeZoom,dispatchChangeImageTool:o.dispatchChangeImageTool,dispatchChangeSelectedColor:o.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:o.dispatchChangeBackgroundColor,dispatchCreateNewTile:o.dispatchCreateNewTile};i.ImageCanvas=r.connect(function({store:{present:e},editor:t},i){return t.isTilemap?e?{selectedColor:t.selectedColor,tilemapState:e,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:e.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery}:{}:e?{selectedColor:t.selectedColor,colors:e.colors,imageState:e.frames[e.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:e.frames[e.currentFrame-1],isTilemap:t.isTilemap}:{}},e)(h)},{"../../assets":6,"./ImageEditor":26,"./actions/dispatch":33,"./keyboardShortcuts":35,"./store/imageReducer":37,"./toolDefinitions":41,"./util":42,react:320,"react-redux":299}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageEditor=i.LIGHT_MODE_TRANSPARENT=void 0;const s=e("react"),l=e("react-redux"),c=e("./store/imageStore"),d=e("./SideBar"),u=e("./BottomBar"),p=e("./TopBar"),h=e("./ImageCanvas"),f=e("./Alert"),m=e("./Timeline"),r=e("./keyboardShortcuts"),n=e("./actions/dispatch"),a=e("./util"),g=e("../../assets");i.LIGHT_MODE_TRANSPARENT="#dedede";class b extends s.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if(r.setStore(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){var i=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:i})}else{const e=t.store.present.tileset.tileWidth,n=g.createNewImageAsset("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:n})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{var t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore(n.dispatchCloseTileEditor(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){r.addKeyListener(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||r.removeKeyListener(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){var{singleFrame:e,lightMode:t}=this.props,i=this.getStore(),{tileToEdit:n,editingTile:r,alert:o}=this.state,a="Animation"===i.getState().store.present.kind;return s.createElement("div",{className:"image-editor-outer"},s.createElement(l.Provider,{store:i},s.createElement("div",{className:"image-editor "+(r?"editing-tile":"")},s.createElement(p.TopBar,{singleFrame:e}),s.createElement("div",{className:"image-editor-content"},s.createElement(d.SideBar,{lightMode:t}),s.createElement(h.ImageCanvas,{suppressShortcuts:r,lightMode:t}),a&&!e?s.createElement(m.Timeline,null):void 0),s.createElement(u.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick}),o&&o.title&&s.createElement(f.Alert,{title:o.title,text:o.text,options:o.options}))),r&&s.createElement(b,{store:c.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:n,singleFrame:!0,nested:!0}))}openAsset(e,t,i=!1){this.dispatchOnStore(n.dispatchOpenAsset(e,i,t)),e.meta.displayName?this.dispatchOnStore(n.dispatchChangeAssetName(e.meta.displayName)):i&&this.dispatchOnStore(n.dispatchChangeAssetName(""))}openGalleryAsset(e){var t=this.getAsset(),i=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===i.length);break;case"animation":this.dispatchOnStore(n.dispatchSetFrames(e.frames.map(e=>({bitmap:e}))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore(n.dispatchChangeZoom(0))}getCurrentFrame(){var e=this.getStore().getState().store.present,e=e.frames[e.currentFrame];return a.imageStateToBitmap(e)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e,t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null==(e=t.asset)?void 0:e.id,internalID:t.asset?t.asset.internalID:g.getNewInternalID(),type:"image",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getTile(){var e,t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null==(e=t.asset)?void 0:e.id,internalID:t.asset?t.asset.internalID:g.getNewInternalID(),isProjectTile:!0,type:"tile",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getAnimation(){var e,t=this.getStore().getState().store.present,i=t.asset?Object.assign({},t.asset.meta):{};return{id:null==(e=t.asset)?void 0:e.id,internalID:t.asset?t.asset.internalID:g.getNewInternalID(),type:"animation",interval:t.interval,frames:t.frames.map(e=>a.imageStateToBitmap(e).data()),meta:i}}getTilemap(){var e=this.getStore().getState(),t=e.store.present,{floating:i,overlayLayers:n,layerOffsetX:r,layerOffsetY:o}=t.tilemap,n=a.applyBitmapData(n[0],i&&i.overlayLayers&&i.overlayLayers[0],r,o),i=new pxt.sprite.TilemapData(a.imageStateToTilemap(t.tilemap),t.tileset,n),r=(i.deletedTiles=e.editor.deletedTiles,i.editedTiles=e.editor.editedTiles,t.asset?Object.assign({},t.asset.meta):{});return{id:null==(o=t.asset)?void 0:o.id,internalID:t.asset?t.asset.internalID:g.getNewInternalID(),type:"tilemap",data:i,meta:r}}getPersistentData(){var e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore(n.dispatchSetInitialState(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];var i;e.width===t.bitmap.width&&e.height===t.bitmap.height||(i=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)],t.bitmap.width===i[0]&&t.bitmap.height===i[1]||this.dispatchOnStore(n.dispatchChangeImageDimensions(i)),e=(e=e.copy()).resize(i[0],i[1]))}this.dispatchOnStore(n.dispatchImageEdit({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore(n.dispatchDisableResize())}closeNestedEditor(){var e;this.state.editingTile&&null!=(e=this.refs["nested-image-editor"])&&e.onDoneClick()}getStore(){return this.props.store||c.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}i.ImageEditor=b},{"../../assets":6,"./Alert":20,"./BottomBar":21,"./ImageCanvas":25,"./SideBar":28,"./Timeline":29,"./TopBar":32,"./actions/dispatch":33,"./keyboardShortcuts":35,"./store/imageStore":38,"./util":42,react:320,"react-redux":299}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Pivot=void 0;const n=e("react"),r=e("./util");class o extends n.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,i=e[t];return n.createElement("div",{className:"image-editor-pivot-outer"},e.map((e,t)=>n.createElement("div",{role:"tab",key:e.id,className:"image-editor-pivot-option "+(e===i?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:r.fireClickOnlyOnEnter},e.text)))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Pivot=o},{"./util":42,react:320}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SideBar=i.SideBarImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./toolDefinitions"),a=e("./Button"),s=e("./actions/dispatch"),l=e("./sprite/Palette"),c=e("./tilemap/TilePalette"),d=e("./tilemap/Minimap");class u extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:t,isTilemap:e,lightMode:i}=this.props;return n.createElement("div",{className:"image-editor-sidebar "+(e?"tilemap":"")},e&&n.createElement("div",{className:"image-editor-tilemap-minimap"},n.createElement(d.Minimap,{lightMode:i})),n.createElement("div",{className:"image-editor-tool-buttons"},o.tools.filter(e=>!e.hiddenTool).map(e=>n.createElement(a.IconButton,{key:e.tool,iconClass:e.iconClass,toggle:t!=e.tool,title:e.title,onClick:this.clickHandler(e.tool)}))),n.createElement("div",{className:"image-editor-palette"},e?n.createElement(c.TilePalette,null):n.createElement(l.Palette,null)))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}i.SideBarImpl=u;e={dispatchChangeImageTool:s.dispatchChangeImageTool};i.SideBar=r.connect(function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}},e)(u)},{"./Button":22,"./actions/dispatch":33,"./sprite/Palette":36,"./tilemap/Minimap":39,"./tilemap/TilePalette":40,"./toolDefinitions":41,react:320,"react-redux":299}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Timeline=i.TimelineImpl=void 0;const c=e("react"),n=e("react-redux"),r=e("./actions/dispatch"),d=e("./TimelineFrame"),o=e("./util");class a extends c.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{var{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{var{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{var e=this.props["dispatchNewFrame"];this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:n,currentFrame:r,interval:t,previewAnimating:i}=this.props,{isMovingFrame:o,dropPreviewIndex:a}=this.state;let s,l=e.slice();return o&&(s=e[r],l.splice(r,1),l.splice(a,0,null)),c.createElement("div",{className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},c.createElement("div",{className:"image-editor-timeline-preview"},c.createElement(d.TimelineFrame,{frames:i?e:[e[r]],colors:n,interval:t,animating:!0})),c.createElement("div",{className:"image-editor-timeline-frames-outer"},c.createElement("div",{className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},l.map((e,t)=>{var i=!o&&t===r;return e?c.createElement("div",{className:"image-editor-timeline-frame "+(i?"active":""),key:t,role:"button",onClick:this.clickHandler(t)},c.createElement(d.TimelineFrame,{frames:[e],colors:n,showActions:i,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})):c.createElement("div",{className:"image-editor-timeline-frame drop-marker",key:t})}),s&&c.createElement("div",{ref:"floating-frame",className:"image-editor-timeline-frame dragging"},c.createElement(d.TimelineFrame,{frames:[s],colors:n,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})),c.createElement("div",{className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},c.createElement("span",{className:"ms-Icon ms-Icon--Add"})))))}componentDidMount(){let i,n=(this.frameScroller=this.refs["frame-scroller-ref"],!1);o.bindGestureEvents(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:e=>{i=e.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");var t=this.frameScroller.getBoundingClientRect(),e=e.clientY-t.top,t=this.frameScroller.firstElementChild.getBoundingClientRect().height,e=Math.floor(e/t);n=e!==this.props.currentFrame},onDragMove:e=>{if(n){this.scrollOffset-=i-e.clientY,i=e.clientY;try{const i=this.frameScroller.getBoundingClientRect(),n=this.frameScroller.parentElement.getBoundingClientRect();i.height>n.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),n.height-i.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(e)},onDragEnd:()=>{if(i=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:i,currentFrame:e}=this.props;i(e,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}})}clickHandler(i){return this.handlers[i]||(this.handlers[i]=()=>{var{currentFrame:e,dispatchChangeCurrentFrame:t}=this.props;this.dragEnd?this.dragEnd=!1:i!=e&&t(i)}),this.handlers[i]}updateDragDrop(e){var t=this.frameScroller.getBoundingClientRect(),e=e.clientY-t.top,t=this.frameScroller.firstElementChild.getBoundingClientRect().height,t=Math.floor(e/t);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=e+"px",this.setState({dropPreviewIndex:t})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}i.TimelineImpl=a;e={dispatchDuplicateFrame:r.dispatchDuplicateFrame,dispatchDeleteFrame:r.dispatchDeleteFrame,dispatchChangeCurrentFrame:r.dispatchChangeCurrentFrame,dispatchNewFrame:r.dispatchNewFrame,dispatchMoveFrame:r.dispatchMoveFrame};i.Timeline=n.connect(function({store:{present:e},editor:t},i){return e?{frames:e.frames,currentFrame:e.currentFrame,colors:e.colors,interval:e.interval,previewAnimating:t.previewAnimating}:{}},e)(a)},{"./TimelineFrame":30,"./actions/dispatch":33,"./util":42,react:320,"react-redux":299}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimelineFrame=void 0;const o=e("react"),a=e("./Button"),c=pxt.BrowserUtils.isEdge()?25:1;class n extends o.Component{constructor(e){super(e),this.state={index:0}}render(){var{frames:e,animating:t,showActions:i,duplicateFrame:n,deleteFrame:r}=this.props,t=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],e=t.bitmap.height>t.bitmap.width;return o.createElement("div",{className:"timeline-frame-outer "+(e?"portrait":"landscape")},o.createElement("div",{className:"timeline-frame-spacer"}),o.createElement("canvas",{ref:"preview-canvas"}),o.createElement("div",{className:"timeline-frame-spacer"}),i&&o.createElement("div",{className:"timeline-frame-actions"},o.createElement(a.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:n}),o.createElement(a.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:r})))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(this.canvas){const{animating:t,frames:i}=this.props,n=i[t?Math.min(Math.max(0,this.state.index),i.length-1):0];this.canvas.height=n.bitmap.height*c,this.canvas.width=n.bitmap.width*c;var e=pxt.sprite.Bitmap.fromData(n.bitmap);if(this.drawBitmap(e),n.floating&&n.floating.bitmap){const t=pxt.sprite.Bitmap.fromData(n.floating.bitmap);this.drawBitmap(t,n.layerOffsetX,n.layerOffsetY,!0)}}}updateAnimation(){var{animating:e,interval:t,frames:i}=this.props,e=e&&5<t&&1<i.length;e&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>this.setState({index:(this.state.index+1)%this.props.frames.length}),t),this.intervalcurrent=t):!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(i,n=0,r=0,o=!1){var a=this.props["colors"],s=this.canvas.getContext("2d");for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++){var l=i.get(t,e);l?(s.fillStyle=a[l],s.fillRect((t+n)*c,(e+r)*c,c,c)):o||s.clearRect((t+n)*c,(e+r)*c,c,c)}}}i.TimelineFrame=n},{"./Button":22,react:320}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Toggle=void 0;const n=e("react");class r extends n.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){var{initialValue:e,label:t}=this.props;return n.createElement("div",{className:"image-editor-toggle-container"},t&&n.createElement("span",null,t),n.createElement("label",{className:"image-editor-toggle"},n.createElement("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),n.createElement("span",{className:"image-editor-toggle-switch"})))}}i.Toggle=r},{react:320}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TopBar=i.TopBarImpl=void 0;const o=e("react"),n=e("react-redux"),r=e("./actions/dispatch"),a=e("./Button"),s=e("./CursorSizes"),l=e("./Toggle"),c=e("./keyboardShortcuts");class d extends o.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>c.flip(!0),this.flipHorizontal=()=>c.flip(!1),this.rotateClockwise=()=>c.rotate(!0),this.rotateCounterclockwise=()=>c.rotate(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{var e=this.props["dispatchChangeInterval"],t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){var{interval:e,previewAnimating:t,singleFrame:i,isTilemap:n,dispatchChangeOverlayEnabled:r}=this.props,e=null==this.state.interval?e:this.state.interval;return o.createElement("div",{className:"image-editor-topbar"},o.createElement("div",{className:"cursor-group"},o.createElement(s.CursorSizes,null)),o.createElement("div",{className:"image-editor-seperator"}),o.createElement("div",{className:"image-transform-group"},o.createElement(a.IconButton,{key:"flipv",iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical}),o.createElement(a.IconButton,{key:"fliph",iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal}),o.createElement(a.IconButton,{key:"rotatec",iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise}),o.createElement(a.IconButton,{key:"rotatecc",iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise})),o.createElement("div",{className:"spacer"}),!i&&o.createElement("div",{className:"image-editor-seperator"}),!i&&o.createElement("div",{className:"timeline-controls"},o.createElement(a.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),o.createElement("div",{className:"image-editor-interval-label image-editor-label"},o.createElement("span",{className:"ms-Icon ms-Icon--Clock"})),o.createElement("div",{className:"image-editor-interval"},o.createElement("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:e,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur}))),n&&o.createElement(l.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:r}))}}i.TopBarImpl=d;e={dispatchChangeInterval:r.dispatchChangeInterval,dispatchChangePreviewAnimating:r.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:r.dispatchChangeOverlayEnabled};i.TopBar=n.connect(function({store:{present:e},editor:t},i){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}},e)(d)},{"./Button":22,"./CursorSizes":23,"./Toggle":31,"./actions/dispatch":33,"./keyboardShortcuts":35,react:320,"react-redux":299}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchSetFrames=i.dispatchOpenAsset=i.dispatchChangeAssetName=i.dispatchDisableResize=i.dispatchDeleteTile=i.dispatchCloseTileEditor=i.dispatchOpenTileEditor=i.dispatchSetGalleryOpen=i.dispatchCreateNewTile=i.dispatchChangeDrawingMode=i.dispatchChangeTilePalettePage=i.dispatchChangeTilePaletteCategory=i.dispatchSetInitialState=i.dispatchChangeBackgroundColor=i.dispatchSwapBackgroundForeground=i.dispatchHideAlert=i.dispatchShowAlert=i.dispatchChangeZoom=i.dispatchChangeOverlayEnabled=i.dispatchToggleOnionSkinEnabled=i.dispatchChangePreviewAnimating=i.dispatchChangeInterval=i.dispatchMoveFrame=i.dispatchChangeCurrentFrame=i.dispatchDuplicateFrame=i.dispatchDeleteFrame=i.dispatchNewFrame=i.dispatchToggleAspectRatioLocked=i.dispatchRedoImageEdit=i.dispatchUndoImageEdit=i.dispatchImageEdit=i.dispatchChangeCursorLocation=i.dispatchChangeKeyModifiers=i.dispatchChangeImageDimensions=i.dispatchChangeSelectedColor=i.dispatchChangeCursorSize=i.dispatchChangeImageTool=void 0;const r=e("./types");i.dispatchChangeImageTool=e=>({type:r.CHANGE_IMAGE_TOOL,tool:e}),i.dispatchChangeCursorSize=e=>({type:r.CHANGE_CURSOR_SIZE,cursorSize:e}),i.dispatchChangeSelectedColor=e=>({type:r.CHANGE_SELECTED_COLOR,selectedColor:e}),i.dispatchChangeImageDimensions=e=>({type:r.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e}),i.dispatchChangeKeyModifiers=e=>({type:r.CHANGE_KEY_MODIFIERS,keyModifiers:e}),i.dispatchChangeCursorLocation=e=>({type:r.CHANGE_CURSOR_LOCATION,cursorLocation:e}),i.dispatchImageEdit=e=>({type:r.IMAGE_EDIT,newState:e}),i.dispatchUndoImageEdit=()=>({type:r.UNDO_IMAGE_EDIT}),i.dispatchRedoImageEdit=()=>({type:r.REDO_IMAGE_EDIT}),i.dispatchToggleAspectRatioLocked=()=>({type:r.TOGGLE_ASPECT_RATIO}),i.dispatchNewFrame=e=>({type:r.NEW_FRAME,index:e}),i.dispatchDeleteFrame=e=>({type:r.DELETE_FRAME,index:e}),i.dispatchDuplicateFrame=e=>({type:r.DUPLICATE_FRAME,index:e}),i.dispatchChangeCurrentFrame=e=>({type:r.CHANGE_CURRENT_FRAME,index:e}),i.dispatchMoveFrame=(e,t)=>({type:r.MOVE_FRAME,oldIndex:e,newIndex:t}),i.dispatchChangeInterval=e=>({type:r.CHANGE_INTERVAL,newInterval:e}),i.dispatchChangePreviewAnimating=e=>({type:r.CHANGE_PREVIEW_ANIMATING,animating:e}),i.dispatchToggleOnionSkinEnabled=()=>({type:r.TOGGLE_ONION_SKIN_ENABLED}),i.dispatchChangeOverlayEnabled=e=>({type:r.CHANGE_OVERLAY_ENABLED,enabled:e}),i.dispatchChangeZoom=e=>({type:r.CHANGE_CANVAS_ZOOM,zoom:e}),i.dispatchShowAlert=(e,t,i)=>({type:r.SHOW_ALERT,title:e,text:t,options:i}),i.dispatchHideAlert=()=>({type:r.HIDE_ALERT}),i.dispatchSwapBackgroundForeground=()=>({type:r.SWAP_FOREGROUND_BACKGROUND}),i.dispatchChangeBackgroundColor=e=>({type:r.CHANGE_BACKGROUND_COLOR,backgroundColor:e}),i.dispatchSetInitialState=(e,t)=>({type:r.SET_INITIAL_STATE,state:e,past:t}),i.dispatchChangeTilePaletteCategory=e=>({type:r.CHANGE_TILE_PALETTE_CATEGORY,category:e}),i.dispatchChangeTilePalettePage=e=>({type:r.CHANGE_TILE_PALETTE_PAGE,page:e}),i.dispatchChangeDrawingMode=e=>({type:r.CHANGE_DRAWING_MODE,drawingMode:e}),i.dispatchCreateNewTile=(e,t,i,n)=>({type:r.CREATE_NEW_TILE,tile:e,foreground:t,background:i,qualifiedName:n}),i.dispatchSetGalleryOpen=e=>({type:r.SET_GALLERY_OPEN,open:e}),i.dispatchOpenTileEditor=(e,t)=>({type:r.OPEN_TILE_EDITOR,index:e,id:t}),i.dispatchCloseTileEditor=(e,t)=>({type:r.CLOSE_TILE_EDITOR,result:e,index:t}),i.dispatchDeleteTile=(e,t)=>({type:r.DELETE_TILE,id:t,index:e}),i.dispatchDisableResize=()=>({type:r.DISABLE_RESIZE}),i.dispatchChangeAssetName=e=>({type:r.CHANGE_ASSET_NAME,name:e}),i.dispatchOpenAsset=(e,t,i)=>({type:r.OPEN_ASSET,asset:e,keepPast:t,gallery:i}),i.dispatchSetFrames=e=>({type:r.SET_FRAMES,frames:e})},{"./types":34}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OPEN_ASSET=i.CHANGE_ASSET_NAME=i.DISABLE_RESIZE=i.DELETE_TILE=i.CLOSE_TILE_EDITOR=i.OPEN_TILE_EDITOR=i.CREATE_NEW_TILE=i.CHANGE_DRAWING_MODE=i.CHANGE_TILE_PALETTE_CATEGORY=i.CHANGE_TILE_PALETTE_PAGE=i.CHANGE_BACKGROUND_COLOR=i.SWAP_FOREGROUND_BACKGROUND=i.HIDE_ALERT=i.SHOW_ALERT=i.CHANGE_CANVAS_ZOOM=i.CHANGE_OVERLAY_ENABLED=i.TOGGLE_ONION_SKIN_ENABLED=i.CHANGE_PREVIEW_ANIMATING=i.CHANGE_INTERVAL=i.CHANGE_CURRENT_FRAME=i.MOVE_FRAME=i.DUPLICATE_FRAME=i.DELETE_FRAME=i.NEW_FRAME=i.SET_GALLERY_OPEN=i.TOGGLE_ASPECT_RATIO=i.REDO_IMAGE_EDIT=i.UNDO_IMAGE_EDIT=i.IMAGE_EDIT=i.CHANGE_CURSOR_LOCATION=i.CHANGE_KEY_MODIFIERS=i.CHANGE_IMAGE_DIMENSIONS=i.CHANGE_SELECTED_COLOR=i.CHANGE_CURSOR_SIZE=i.CHANGE_IMAGE_TOOL=i.SET_FRAMES=i.SET_INITIAL_STATE=void 0,i.SET_INITIAL_STATE="SET_INITIAL_STATE",i.SET_FRAMES="SET_FRAMES",i.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",i.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",i.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",i.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",i.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",i.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",i.IMAGE_EDIT="IMAGE_EDIT",i.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",i.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",i.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",i.SET_GALLERY_OPEN="SET_GALLERY_OPEN",i.NEW_FRAME="NEW_FRAME",i.DELETE_FRAME="DELETE_FRAME",i.DUPLICATE_FRAME="DUPLICATE_FRAME",i.MOVE_FRAME="MOVE_FRAME",i.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",i.CHANGE_INTERVAL="CHANGE_INTERVAL",i.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",i.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",i.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",i.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",i.SHOW_ALERT="SHOW_ALERT",i.HIDE_ALERT="HIDE_ALERT",i.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",i.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",i.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",i.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",i.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",i.CREATE_NEW_TILE="CREATE_NEW_TILE",i.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",i.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",i.DELETE_TILE="DELETE_TILE",i.DISABLE_RESIZE="DISABLE_RESIZE",i.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",i.OPEN_ASSET="OPEN_ASSET"},{}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.rotate=i.flip=i.setStore=i.areShortcutsEnabled=i.releaseShortcutLock=i.obtainShortcutLock=i.removeKeyListener=i.addKeyListener=void 0;const n=e("./store/imageReducer"),r=e("./actions/dispatch"),o=e("./store/imageStore"),a=e("./toolDefinitions");let s=o.mainStore,l=[];function c(){return!l.length}function d(e){var t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(g(r.dispatchUndoImageEdit()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(g(r.dispatchRedoImageEdit()),e.preventDefault(),e.stopPropagation())}function u(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function p(e){if(c()){switch(e.key){case"e":f(n.ImageEditorTool.Erase);break;case"h":f(n.ImageEditorTool.Pan);break;case"b":case"p":f(n.ImageEditorTool.Paint);break;case"g":f(n.ImageEditorTool.Fill);break;case"m":f(n.ImageEditorTool.Marquee);break;case"u":f(n.ImageEditorTool.Rect);break;case"-":case"_":m(-1);break;case"=":case"+":m(1);break;case"x":g(r.dispatchSwapBackgroundForeground());break;case"H":b(!1);break;case"V":b(!0);break;case"[":v(!1);break;case"]":v(!0)}!s.getState().editor.isTilemap&&/^Digit\d$/.test(e.code)&&0<=(e=+e.code.slice(-1)+(e.shiftKey?9:0))&&e<16&&(e=e,g(r.dispatchChangeSelectedColor(e)))}}function h(){var e,t=s.getState();return t.editor.isTilemap?(e=t.store.present,[a.getEditState(e.tilemap,!0,t.editor.drawingMode),"tilemap"]):(e=t.store.present,[a.getEditState(e.frames[e.currentFrame],!1,t.editor.drawingMode),1<e.frames.length?"animation":"image"])}function f(e){g(r.dispatchChangeImageTool(e))}function m(e){g(r.dispatchChangeZoom(e))}function g(e){s.dispatch(e)}function b(e){var[t,i]=h(),t=a.flipEdit(t,e,"tilemap"===i);g(r.dispatchImageEdit(t.toImageState()))}function v(e){var[t,i]=h(),t=a.rotateEdit(t,e,"tilemap"===i,"animation"===i);g(r.dispatchImageEdit(t.toImageState()))}i.addKeyListener=function(){l=[],document.addEventListener("keydown",p),document.addEventListener("keydown",d,!0),document.addEventListener("keydown",u,!0)},i.removeKeyListener=function(){document.removeEventListener("keydown",p),document.removeEventListener("keydown",d,!0),document.removeEventListener("keydown",u,!0)},i.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},i.releaseShortcutLock=function(e){e=l.indexOf(e);-1!==e&&l.splice(e,1)},i.areShortcutsEnabled=c,i.setStore=function(e){s=e||o.mainStore},i.flip=b,i.rotate=v},{"./actions/dispatch":33,"./store/imageReducer":37,"./store/imageStore":38,"./toolDefinitions":41}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Palette=void 0;const r=e("react"),n=e("react-redux"),o=e("../actions/dispatch");class a extends r.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){var{colors:e,selected:t,backgroundColor:i,dispatchSwapBackgroundForeground:n}=this.props;return r.createElement("div",null,r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:n},r.createElement("defs",null,r.createElement("pattern",{id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},r.createElement("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),r.createElement("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),r.createElement("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"}))),r.createElement("g",null,r.createElement("rect",{fill:i?e[i]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},r.createElement("title",null,s(i,e[i]))),r.createElement("rect",{fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},r.createElement("title",null,s(t,e[t]))))),r.createElement("div",{className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},this.props.colors.map((e,t)=>r.createElement("div",{key:t,className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:s(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}}))))}clickHandler(t){return this.handlers[t]||(this.handlers[t]=e=>{0===e.button?this.props.dispatchChangeSelectedColor(t):(this.props.dispatchChangeBackgroundColor(t),e.preventDefault(),e.stopPropagation())}),this.handlers[t]}}function s(e,t){var i=0===e?lf("transparency"):function(){switch(null==t?void 0:t.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}();return i?lf("Color {0} ({1})",e,i):lf("Color {0}",e)}e={dispatchChangeSelectedColor:o.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:o.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:o.dispatchSwapBackgroundForeground};i.Palette=n.connect(function({store:{present:e},editor:t},i){return e?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:e.colors}:{}},e)(a)},{"../actions/dispatch":33,react:320,"react-redux":299}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setTelemetryFunction=i.TileDrawingMode=i.TileCategory=i.KeyModifiers=i.CursorSize=i.ImageEditorTool=void 0;const d=e("../../../assets"),u=e("../actions/types");var o,s,l;(e=o=i.ImageEditorTool||(i.ImageEditorTool={}))[e.Paint=0]="Paint",e[e.Fill=1]="Fill",e[e.Line=2]="Line",e[e.Erase=3]="Erase",e[e.Circle=4]="Circle",e[e.Rect=5]="Rect",e[e.ColorSelect=6]="ColorSelect",e[e.Marquee=7]="Marquee",e[e.Pan=8]="Pan",(e=i.CursorSize||(i.CursorSize={}))[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five",(e=i.KeyModifiers||(i.KeyModifiers={}))[e.Alt=1]="Alt",e[e.Shift=2]="Shift",(e=s=i.TileCategory||(i.TileCategory={}))[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc",(e=l=i.TileDrawingMode||(i.TileDrawingMode={})).Default="default";const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!(e.Wall="wall"),currentFrame:0,frames:[f(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,isTilemap:!1}},p=(e,t,i)=>{let n;switch(t.type){case u.CHANGE_PREVIEW_ANIMATING:return m("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case u.CHANGE_CANVAS_ZOOM:return(0<t.zoom||t.zoom<0)&&m("zoom-"+(0<t.zoom?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case u.CHANGE_IMAGE_TOOL:return m("change-tool-"+o[t.tool]),Object.assign(Object.assign({},e),{tool:t.tool});case u.CHANGE_CURSOR_SIZE:return m("change-cursor-size-"+t.cursorSize),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case u.CHANGE_SELECTED_COLOR:return m("foreground-color-"+t.selectedColor),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case u.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case u.CHANGE_BACKGROUND_COLOR:return m("background-color-"+t.backgroundColor),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case u.SWAP_FOREGROUND_BACKGROUND:return m("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case u.TOGGLE_ONION_SKIN_ENABLED:return m("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case u.CHANGE_TILE_PALETTE_CATEGORY:return m("change-tile-category-"+s[t.category]),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case u.CHANGE_TILE_PALETTE_PAGE:return m("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case u.CHANGE_DRAWING_MODE:return m("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||l.Default});case u.CHANGE_OVERLAY_ENABLED:return m("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case u.CREATE_NEW_TILE:return n=e.editedTiles,!t.tile||n&&-1!==n.indexOf(t.tile.id)||(n=(n||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.foreground,backgroundColor:t.background});case u.SET_GALLERY_OPEN:return m("set-gallery-open-"+t.open),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case u.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor});case u.OPEN_TILE_EDITOR:var r=t.index?"edit":"new";return m("open-tile-editor-"+r),Object.assign(Object.assign({},e),{editingTile:{type:r,tilesetIndex:t.index}});case u.CLOSE_TILE_EDITOR:return n=e.editedTiles,!t.result||n&&-1!==n.indexOf(t.result.id)||(n=(n||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.index||i.present.tileset.tiles.length,editingTile:void 0});case u.SHOW_ALERT:return m("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case u.HIDE_ALERT:return m("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case u.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},h=(t,i)=>{switch(i.type){case u.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},t),{aspectRatioLocked:!t.aspectRatioLocked});case u.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[l,c]=i.imageDimensions;return Object.assign(Object.assign({},t),{tilemap:Object.assign(Object.assign({},t.tilemap),{bitmap:(o=t.tilemap.bitmap,a=l,s=c,pxt.sprite.Tilemap.fromData(o).resize(a,s).data()),overlayLayers:t.tilemap.overlayLayers&&t.tilemap.overlayLayers.map(e=>{return e=e,t=l,i=c,pxt.sprite.Bitmap.fromData(e).resize(t,i).data();var t,i})})});case u.CREATE_NEW_TILE:o=!i.qualifiedName;let e;return m(o?"new-tile":"used-tile-"+i.qualifiedName),o?(e=i.tile).isProjectTile=!0:e=d.lookupAsset("tile",i.qualifiedName),Object.assign(Object.assign({},t),{tileset:Object.assign(Object.assign({},t.tileset),{tiles:t.tileset.tiles.concat([e])}),nextId:o?t.nextId+1:t.nextId});case u.CLOSE_TILE_EDITOR:return m("close-tile-editor"),i.result?i.index?Object.assign(Object.assign({},t),{tileset:(a=t.tileset,n=i.index,r=i.result,Object.assign(Object.assign({},a),{tiles:a.tiles.map((e,t)=>t===n?r:e)}))}):Object.assign(Object.assign({},t),{tileset:Object.assign(Object.assign({},t.tileset),{tiles:t.tileset.tiles.concat([i.result])}),nextId:t.nextId+1}):t;case u.DELETE_TILE:m("delete-tile");s=t.tileset.tiles.slice();return s.splice(i.index,1),Object.assign(Object.assign({},t),{tilemap:Object.assign(Object.assign({},t.tilemap),{bitmap:function(i,e){var n=e.copy();for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++){var r=n.get(t,e);r===i?n.set(t,e,0):i<r&&n.set(t,e,r-1)}return n}(i.index,pxt.sprite.Tilemap.fromData(t.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},t.tileset),{tiles:s})});case u.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},t),{tilemap:i.newState});default:return t}var n,r,o,a,s};function f(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let n;function m(e){n&&n(e)}function g(e,t){return"tilemap"===e.type?(t=t,{kind:"Tilemap",asset:i=e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:i.data.tilemap.data(),overlayLayers:[i.data.layers]},tileset:function(e,t){for(const i of e.tiles)if(!i.jresData&&!i.isProjectTile)for(const e of t)if(e.qualifiedName===i.id){i.bitmap=e.bitmap;break}return e}(i.data.tileset,t),nextId:i.data.nextId}):{kind:"Animation",asset:t=e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===t.type,currentFrame:0,frames:"animation"===t.type?t.frames.map(e=>({bitmap:e})):[{bitmap:t.bitmap}],interval:"animation"===t.type?t.interval:100};var i}i.setTelemetryFunction=function(e){n=e},i.default=(t=c,i)=>{var n;switch(i.type){case u.OPEN_TILE_EDITOR:case u.CHANGE_PREVIEW_ANIMATING:case u.CHANGE_CANVAS_ZOOM:case u.CHANGE_IMAGE_TOOL:case u.CHANGE_CURSOR_SIZE:case u.CHANGE_SELECTED_COLOR:case u.CHANGE_CURSOR_LOCATION:case u.CHANGE_BACKGROUND_COLOR:case u.SWAP_FOREGROUND_BACKGROUND:case u.TOGGLE_ONION_SKIN_ENABLED:case u.CHANGE_OVERLAY_ENABLED:case u.CHANGE_TILE_PALETTE_PAGE:case u.CHANGE_TILE_PALETTE_CATEGORY:case u.CHANGE_DRAWING_MODE:case u.SET_GALLERY_OPEN:case u.SHOW_ALERT:case u.HIDE_ALERT:case u.DISABLE_RESIZE:return Object.assign(Object.assign({},t),{editor:p(t.editor,i,t.store)});case u.SET_INITIAL_STATE:var r=i.state;return Object.assign(Object.assign({},t),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:r.selectedColor,backgroundColor:r.backgroundColor,tilemapPalette:r.tilemapPalette,tileGalleryOpen:r.tileGalleryOpen,tileGallery:r.tileGallery,isTilemap:r.isTilemap,referencedTiles:t.editor.referencedTiles}),store:Object.assign(Object.assign({},t.store),{past:i.past||t.store.past,future:i.past?[]:t.store.future})});case u.OPEN_ASSET:var r=i.asset,o=i.gallery||(i.keepPast?t.editor.tileGallery:[]);let e=-1;if("tilemap"===r.type){const t=i.asset.data;if(pxt.sprite.isEmptyTilemap(t)){const i=t.tileset.tiles||[],u=null==(n=o.find(e=>-1!==e.tags.indexOf("forest")))?void 0:n.qualifiedName,a=d.lookupAsset("tile",u);a&&!i.find(e=>e.id===u)&&i.push(a),e=i.indexOf(a)}}return Object.assign(Object.assign({},t),{editor:"tilemap"===r.type?{selectedColor:e,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:s.Forest,page:0},drawingMode:l.Default,overlayEnabled:!0,tileGallery:o,tileGalleryOpen:!!o,referencedTiles:r.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tool:(i.keepPast?t:c).editor.tool,cursorSize:(i.keepPast?t:c).editor.cursorSize,editedTiles:i.keepPast?t.editor.editedTiles:void 0,deletedTiles:i.keepPast?t.editor.deletedTiles:void 0}:{isTilemap:!1,selectedColor:(i.keepPast?t:c).editor.selectedColor,backgroundColor:(i.keepPast?t:c).editor.backgroundColor,previewAnimating:(i.keepPast?t:c).editor.previewAnimating,tool:(i.keepPast?t:c).editor.tool,onionSkinEnabled:(i.keepPast?t:c).editor.onionSkinEnabled,cursorSize:(i.keepPast?t:c).editor.cursorSize,resizeDisabled:(i.keepPast?t:c).editor.resizeDisabled},store:Object.assign(Object.assign({},t.store),{past:i.keepPast?t.store.past:[],present:g(i.asset,o),future:[]})});case u.CHANGE_ASSET_NAME:return m("change-asset-name"),Object.assign(Object.assign({},t),{store:{past:[...t.store.past,t.store.present],present:Object.assign(Object.assign({},t.store.present),{asset:Object.assign(Object.assign({},t.store.present.asset),{meta:Object.assign(Object.assign({},t.store.present.asset.meta||{}),{displayName:i.name})})}),future:[]}});case u.UNDO_IMAGE_EDIT:return t.store.past.length?(m("undo"),Object.assign(Object.assign({},t),{store:Object.assign(Object.assign({},t.store),{past:t.store.past.slice(0,t.store.past.length-1),present:t.store.past[t.store.past.length-1],future:[...t.store.future,t.store.present]})})):t;case u.REDO_IMAGE_EDIT:return t.store.future.length?(m("redo"),Object.assign(Object.assign({},t),{store:Object.assign(Object.assign({},t.store),{past:[...t.store.past,t.store.present],present:t.store.future[t.store.future.length-1],future:t.store.future.slice(0,t.store.future.length-1)})})):t;default:return Object.assign(Object.assign({},t),{editor:p(t.editor,i,t.store),store:Object.assign(Object.assign({},t.store),{past:[...t.store.past,t.store.present],present:(t.editor.isTilemap?h:(i,n)=>{switch(n.type){case u.TOGGLE_ASPECT_RATIO:return m("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},i),{aspectRatioLocked:!i.aspectRatioLocked});case u.CHANGE_CURRENT_FRAME:return m("change-frame"),Object.assign(Object.assign({},i),{currentFrame:n.index});case u.CHANGE_INTERVAL:return m("change-interval"),Object.assign(Object.assign({},i),{interval:n.newInterval});case u.CHANGE_IMAGE_DIMENSIONS:m("change-dimensions");const[o,a]=n.imageDimensions;return Object.assign(Object.assign({},i),{frames:i.frames.map((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(o,a).data()}))});case u.IMAGE_EDIT:return m("image-edit"),Object.assign(Object.assign({},i),{frames:i.frames.map((e,t)=>t===i.currentFrame?n.newState:e)});case u.DELETE_FRAME:if(1===i.frames.length)return i;m("delete-frame");var t=i.frames.slice();t.splice(n.index,1);let e=i.currentFrame;return i.currentFrame>=n.index&&0<i.currentFrame&&e--,Object.assign(Object.assign({},i),{currentFrame:e,frames:t});case u.DUPLICATE_FRAME:m("duplicate-frame");t=i.frames.slice();return t.splice(n.index,0,function(e){let t,i,n;return e.floating&&(e.floating.bitmap&&(i=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(n=e.floating.overlayLayers.map(e=>pxt.sprite.Bitmap.fromData(e).copy().data())),t={bitmap:i,overlayLayers:n}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map(e=>pxt.sprite.Bitmap.fromData(e).copy().data()),floating:t})}(i.frames[n.index])),Object.assign(Object.assign({},i),{frames:t,currentFrame:n.index+1});case u.NEW_FRAME:return m("new-frame"),Object.assign(Object.assign({},i),{frames:[...i.frames,f(i.frames[0].bitmap.width,i.frames[0].bitmap.height)],currentFrame:i.frames.length});case u.MOVE_FRAME:if(n.newIndex<0||n.newIndex>=i.frames.length||n.newIndex<0||n.newIndex>=i.frames.length)return i;m("move-frame");var t=i.frames.slice(),r=t.splice(n.oldIndex,1)[0];return t.splice(n.newIndex,0,r),Object.assign(Object.assign({},i),{frames:t,currentFrame:n.oldIndex===i.currentFrame?n.newIndex:i.currentFrame});case u.SET_FRAMES:return m("set-frames"),Object.assign(Object.assign({},i),{frames:n.frames,currentFrame:0});default:return i}})(t.store.present,i),future:[]})})}}},{"../../../assets":6,"../actions/types":34}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mainStore=i.tileEditorStore=void 0;var n=e("redux"),e=e("./imageReducer"),r=n.createStore(e.default);i.default=r,i.tileEditorStore=n.createStore(e.default),i.mainStore=r},{"./imageReducer":37,redux:341}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Minimap=void 0;const n=e("react"),r=e("react-redux"),d=e("../ImageEditor"),u=pxt.BrowserUtils.isEdge()?25:1;class o extends n.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return n.createElement("div",{className:"minimap-outer"},n.createElement("canvas",{ref:"minimap-canvas",className:"paint-surface"}))}redrawCanvas(){var{tilemap:e,lightMode:i}=this.props;let{bitmap:t,floating:n,layerOffsetX:r,layerOffsetY:o}=e;var a=this.canvas.getContext("2d"),s=pxt.sprite.Tilemap.fromData(t),l=n&&n.bitmap?pxt.sprite.Tilemap.fromData(n.bitmap):null;this.canvas.width=s.width*u,this.canvas.height=s.height*u,this.tileColors=[];for(let t=0;t<s.width;t++)for(let e=0;e<s.height;e++){const n=l?l.get(t-r,e-o):null,c=s.get(t,e);n?(a.fillStyle=this.getColor(n),a.fillRect(t*u,e*u,u,u)):c?(a.fillStyle=this.getColor(c),a.fillRect(t*u,e*u,u,u)):i?(a.fillStyle=d.LIGHT_MODE_TRANSPARENT,a.fillRect(t*u,e*u,u,u)):a.clearRect(t*u,e*u,u,u)}}getColor(e){if(!this.tileColors[e]){var{tileset:t,colors:i}=this.props;if(e>=t.tiles.length)return"#ffffff";t=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(t,i)}return this.tileColors[e]}}i.Minimap=r.connect(function({store:{present:e}},t){return e?{tilemap:e.tilemap,tileset:e.tileset,colors:e.colors}:{}},{})(o)},{"../ImageEditor":26,react:320,"react-redux":299}],40:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TilePalette=void 0;const h=e("react"),n=e("react-redux"),f=e("../store/imageReducer"),r=e("../actions/dispatch"),m=e("../TimelineFrame"),g=e("../Dropdown"),b=e("../Pivot"),v=e("../Button"),o=e("../../../assets"),d=pxt.BrowserUtils.isEdge()?25:1,a=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],y=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],w=new pxt.sprite.Bitmap(16,16);class s extends h.Component{constructor(t){super(t),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{var{tileset:e,selected:t,dispatchOpenTileEditor:i}=this.props,e=e.tiles[t];null!=e&&e.isProjectTile&&0!==t&&i(t,e.id)},this.tileDuplicateHandler=()=>{var{tileset:e,selected:t,backgroundColor:i,dispatchCreateNewTile:n}=this.props;e.tiles[t]&&e.tiles[t].isProjectTile&&0!==t&&(t=e.tiles[t],n(o.createTile(t.bitmap,null,null==(n=t.meta)?void 0:n.displayName),e.tiles.length,i))},this.tileDeleteAlertHandler=()=>{var{tileset:e,selected:t,dispatchShowAlert:i,dispatchHideAlert:n,referencedTiles:r}=this.props,e=e.tiles[t];t&&e&&e.isProjectTile&&(r&&-1!==r.indexOf(e.id)?i(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:n}]):i(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:n}]))},this.deleteTile=()=>{var e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,0<e.button)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=f.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(f.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.dispatchChangeDrawingMode(f.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const e=t["gallery"];if(this.refreshGallery(t),e){const t={};for(const i of e){const e=i.tags.find(e=>pxt.Util.startsWith(e,"category-"));e&&(t[e]||(t[e]={id:e,text:pxt.Util.rlf("{id:tilecategory}"+e.substr(9)),tiles:[]}),t[e].tiles.push(i))}this.categories=a.concat(Object.keys(t).map(e=>t[e]))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:i,tileset:n,category:r,page:o,drawingMode:a,galleryOpen:s}=this.props,l=n.tiles[t]?n.tiles[t].bitmap:w.data(),c=n.tiles[i]?n.tiles[i].bitmap:w.data();w.data(),this.updateGalleryTiles();let d=Math.ceil(this.categoryTiles.length/16);s||this.categoryTiles.length%16!=0||d++;var u=!s&&(1===d||o===d-1),p=s||!this.renderedTiles.some(e=>!k(e)&&e.index===t);return h.createElement("div",{className:"tile-palette"},h.createElement("div",{className:"tile-palette-fg-bg"},h.createElement("div",{className:"tile-palette-swatch fg "+(a==f.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},h.createElement(m.TimelineFrame,{frames:[{bitmap:l}],colors:e})),h.createElement("div",{className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},h.createElement(m.TimelineFrame,{frames:[{bitmap:c}],colors:e}),h.createElement(v.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})),h.createElement("div",{className:"tile-palette-swatch wall "+(a==f.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},h.createElement("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})))),h.createElement(b.Pivot,{options:y,selected:s?1:0,onChange:this.pivotHandler}),h.createElement("div",{className:"tile-palette-controls-outer"},s&&h.createElement(g.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter(e=>!!e.tiles.length),selected:r}),!s&&h.createElement("div",{className:"tile-palette-controls"},h.createElement(v.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:p,toggle:!p}),h.createElement(v.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:p,toggle:!p}),h.createElement(v.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:p,toggle:!p}))),h.createElement("div",{className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},h.createElement("div",{className:"tile-canvas"},h.createElement("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),u&&h.createElement("div",{ref:"create-tile-ref"},h.createElement(v.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0}))),h.createElement("div",{className:"tile-canvas-controls"},function(t,i,n){var e=16+5*(t-1),r=[];for(let e=0;e<t;e++)r[e]=e===i;return h.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${e} 10`,className:"tile-palette-pages "+(t<2?"disabled":"")},h.createElement("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:i?()=>n(i-1):void 0}),r.map((e,t)=>h.createElement("circle",{className:"tile-palette-page-dot",key:t,cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>n(t)})),h.createElement("polygon",{className:"tile-palette-page-arrow",points:e-1+`,5 ${e-4},3 ${e-4},7`,onClick:i<t-1?()=>n(i+1):void 0}))}(d,o,this.pageHandler))))}updateGalleryTiles(){var{page:e,category:t,galleryOpen:i}=this.props,i=(this.categoryTiles=i?this.categories[t].tiles:this.getCustomTiles().map(([e,t])=>({index:t,bitmap:e.bitmap})),16*e);this.renderedTiles=this.categoryTiles.slice(i,16+i)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:i,dispatchChangeTilePaletteCategory:n,dispatchChangeTilePalettePage:r}=this.props;if(!(!e||e<0||e>=t.tiles.length)){const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map(([e])=>e);if(e){const t=Math.max(Math.floor(e.findIndex(e=>e.id==o.id)/16),0);i(!1),r(t)}}else{const e=this.categories.find(e=>-1!==e.tiles.findIndex(e=>e.qualifiedName==o.id));if(e&&e.tiles){const t=Math.max(Math.floor(e.tiles.findIndex(e=>e.qualifiedName==o.id)/16),0);i(!0),n(this.categories.indexOf(e)),r(t)}}}}redrawCanvas(){var{tileset:e,page:t,selected:i}=this.props,n=4*t*4,r=e.tileWidth+1,o=(this.canvas.width=(4*r+1)*d,this.canvas.height=(4*r+1)*d,this.canvas.getContext("2d"));for(let t=0;t<4;t++)for(let e=0;e<4;e++){var a=this.categoryTiles[n+4*t+e];a&&(k(a)||a.index!==i||(o.fillStyle="#ff0000",o.fillRect(e*r,t*r,r+1,r+1)),o.fillStyle="#333333",o.fillRect(e*r+1,t*r+1,r-1,r-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(a.bitmap),1+e*r,1+t*r))}this.positionCreateTileButton()}drawBitmap(i,n=0,r=0,o=!0,a=d,e=this.canvas){var s=this.props["colors"],l=e.getContext("2d");l.imageSmoothingEnabled=!1;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++){var c=i.get(t,e);c?(l.fillStyle=s[c],l.fillRect((t+n)*a,(e+r)*a,a,a)):o||l.clearRect((t+n)*a,(e+r)*a,a,a)}}handleCanvasClickCore(i,e,n){const r=this.canvas.getBoundingClientRect(),o=(i-r.left)/(r.width/4)|0,t=(e-r.top)/(r.height/4)|0,a=this.renderedTiles[4*t+o];if(a){let e,t;if(k(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,0<=e)n?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:i,backgroundColor:r,tileset:o}=this.props,f=o.tiles.length||1;this.props.dispatchCreateNewTile(null,n?i:f,n?f:r,t)}this.props.dispatchChangeDrawingMode(f.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:i,tileset:n}=e;i&&a.forEach(t=>{t.tiles=i.filter(e=>-1!==e.tags.indexOf(t.id)&&e.tileWidth===n.tileWidth)})}positionCreateTileButton(){var e,t,i=this.refs["create-tile-ref"];i&&(e=this.categoryTiles.length%4,t=Math.floor(this.categoryTiles.length/4)%4,i.style.position="absolute",i.style.left="calc("+e/4+" * (100% - 0.5rem) + 0.25rem)",i.style.top="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)")}getCustomTiles(){return this.props.tileset.tiles.map((e,t)=>[e,t]).filter(([e])=>e.isProjectTile).sort(([e],[t])=>{var i="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==i?-1:t.id==i?1:e.internalID-t.internalID})}getTileIndex(t){var i=this.props["tileset"];for(let e=0;e<i.tiles.length;e++)if(i.tiles[e].id===t.qualifiedName)return e;return-1}}function k(e){return e.qualifiedName}e={dispatchChangeSelectedColor:r.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:r.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:r.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:r.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:r.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:r.dispatchChangeDrawingMode,dispatchCreateNewTile:r.dispatchCreateNewTile,dispatchSetGalleryOpen:r.dispatchSetGalleryOpen,dispatchOpenTileEditor:r.dispatchOpenTileEditor,dispatchDeleteTile:r.dispatchDeleteTile,dispatchShowAlert:r.dispatchShowAlert,dispatchHideAlert:r.dispatchHideAlert};i.TilePalette=n.connect(function({store:{present:e},editor:t},i){return e?{selected:t.selectedColor,tileset:e.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:e.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}},e)(s)},{"../../../assets":6,"../Button":22,"../Dropdown":24,"../Pivot":27,"../TimelineFrame":30,"../actions/dispatch":33,"../store/imageReducer":37,react:320,"react-redux":299}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.flipEdit=i.rotateEdit=i.MarqueeEdit=i.FillEdit=i.CircleEdit=i.LineEdit=i.OutlineEdit=i.RectangleEdit=i.PaintEdit=i.SelectionEdit=i.Edit=i.EditState=i.getEditState=i.getEdit=i.tools=i.ToolCursor=void 0;const s=e("./store/imageReducer");var n;(n=e=i.ToolCursor||(i.ToolCursor={})).None="none",n.Default="default",n.Pointer="pointer",n.Crosshair="crosshair",n.Grab="grab",n.Grabbing="grabbing",n.EyeDropper="var(--eyedropper)",i.tools=[{tool:s.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:e.Crosshair},{tool:s.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:e.Crosshair,hoverLayerCursor:e.Grab,downLayerCursor:e.Grabbing},{tool:s.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:e.Grab,downCursor:e.Grabbing},{tool:s.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:e.EyeDropper}],i.getEdit=function(e,t,i,n){switch(e){case s.ImageEditorTool.Paint:return new a(t.width,t.height,i,n);case s.ImageEditorTool.Rect:return new l(t.width,t.height,i,n);case s.ImageEditorTool.Fill:return new p(t.width,t.height,i,n);case s.ImageEditorTool.Line:return new c(t.width,t.height,i,n);case s.ImageEditorTool.Marquee:return new h(t.width,t.height,i,n);case s.ImageEditorTool.Circle:return new u(t.width,t.height,i,n);case s.ImageEditorTool.Erase:return new a(t.width,t.height,0,n);default:s.ImageEditorTool.ColorSelect;return}},i.getEditState=function(e,t,i=s.TileDrawingMode.Default){var n=new d((t?pxt.sprite.Tilemap:pxt.sprite.Bitmap).fromData(e.bitmap).copy());let r,o,a;return e.overlayLayers&&(n.overlayLayers=e.overlayLayers.map(e=>pxt.sprite.Bitmap.fromData(e).copy())),n.layerOffsetX=e.layerOffsetX,n.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(o=(t?pxt.sprite.Tilemap:pxt.sprite.Bitmap).fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(a=e.floating.overlayLayers.map(e=>pxt.sprite.Bitmap.fromData(e).copy())),r={image:o,overlayLayers:a}),n.floating=r,n.setActiveLayer(i),n};class d{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){e===s.TileDrawingMode.Wall?this.activeLayerIndex=0:this.activeLayerIndex=-1}copy(){var i=new d;if(i.image=this.image.copy(),i.overlayLayers=this.overlayLayers&&this.overlayLayers.map(e=>e.copy()),this.floating){let e,t;this.floating.image&&(e=this.floating.image.copy()),this.floating.overlayLayers&&(t=this.floating.overlayLayers.map(e=>e.copy())),i.floating={image:e,overlayLayers:t}}return i.layerOffsetX=this.layerOffsetX,i.layerOffsetY=this.layerOffsetY,i}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers)&&(this.floating.overlayLayers.forEach((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)}),this.floating.overlayLayers=void 0)}copyToLayer(n,r,o,a,i=!1){if(0!==o&&0!==a){o<0&&(n+=o,o=-o),a<0&&(r+=a,a=-a);let e,t=this.image.copy(n,r,o,a);if(this.layerOffsetX=t.x0,this.layerOffsetY=t.y0,t.x0=void 0,t.y0=void 0,this.overlayLayers&&(e=this.overlayLayers.map(e=>e.copy(n,r,o,a))),i)for(let i=0;i<o;i++)for(let t=0;t<a;t++)this.image.set(n+i,r+t,0),this.overlayLayers&&this.overlayLayers.forEach(e=>e.set(n+i,r+t,0));this.floating={image:t,overlayLayers:e}}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,0<=e)&&e<this.floating.image.width&&0<=t&&t<this.floating.image.height}setFloatingLayer(e,t){this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!=(e=null==t?void 0:t.layerOffsetX)?e:0,this.layerOffsetY=null!=(e=null==t?void 0:t.layerOffsetY)?e:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map(e=>e.data()):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map(e=>e.data()):void 0}}}i.EditState=d;class r{constructor(e,t,i,n){this.canvasWidth=e,this.canvasHeight=t,this.color=i,this.toolWidth=n}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return 0<=e&&e<this.canvasWidth&&0<=t&&t<this.canvasHeight}start(e,t,i){this.isStarted=!0,this.startCol=e,this.startRow=t}drawCursor(e,t,i){i(e,t)}}class o extends(i.Edit=r){update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}i.SelectionEdit=o;class a extends r{constructor(e,t,i,n){super(e,t,i,n),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(n,r,o,a){var e=o-n,s=a-r,l=(e,t)=>this.mask.set(e,t);if(0==e){const o=0<=s?a:r;for(let e=0<=s?r:a;e<=o;e++)this.drawCore(n,e,l)}else{var c=0<e?1:-1,d=0<s?1:-1,u=Math.abs(s/e);let t=0,i=r;for(let e=n;0<c?e<=o:e>=o;e+=c)for(this.drawCore(e,i,l),t+=u;.5<=t;)(0<d?i<=a:i>=a)&&this.drawCore(e,i,l),i+=d,--t}}doEditCore(i){i.mergeFloatingLayer();for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)this.mask.get(t,e)&&i.activeLayer.set(t,e,this.color)}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(i,n,r){i-=Math.floor(this.toolWidth/2),n-=Math.floor(this.toolWidth/2);for(let t=0;t<this.toolWidth;t++)for(let e=0;e<this.toolWidth;e++){var o=i+t,a=n+e;0<=o&&o<this.canvasWidth&&0<=a&&a<this.canvasHeight&&r(i+t,n+e)}}}i.PaintEdit=a,i.RectangleEdit=class extends o{constructor(){super(...arguments),this.showPreview=!0}doEditCore(i){i.mergeFloatingLayer();var n=this.topLeft(),r=this.bottomRight();for(let t=n.x;t<=r.x;t++)for(let e=n.y;e<=r.y;e++)i.activeLayer.set(t,e,this.color)}};class l extends o{constructor(){super(...arguments),this.showPreview=!0}doEditCore(t){t.mergeFloatingLayer();var i=this.topLeft(),n=(i.x-=this.toolWidth>>1,i.y-=this.toolWidth>>1,this.bottomRight());n.x+=this.toolWidth>>1,n.y+=this.toolWidth>>1;for(let e=0;e<this.toolWidth;e++)this.drawRectangle(t,{x:i.x+e,y:i.y+e},{x:n.x-e,y:n.y-e})}drawRectangle(t,i,n){if(!(i.x>n.x||i.y>n.y)){for(let e=i.x;e<=n.x;e++)t.activeLayer.set(e,i.y,this.color),t.activeLayer.set(e,n.y,this.color);for(let e=i.y;e<=n.y;e++)t.activeLayer.set(i.x,e,this.color),t.activeLayer.set(n.x,e,this.color)}}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(i,n,r){i-=Math.floor(this.toolWidth/2),n-=Math.floor(this.toolWidth/2);for(let t=0;t<this.toolWidth;t++)for(let e=0;e<this.toolWidth;e++){var o=i+t,a=n+e;0<=o&&o<this.canvasWidth&&0<=a&&a<this.canvasHeight&&r(i+t,n+e)}}}i.OutlineEdit=l;class c extends o{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(n,r,o,a,i){var e=o-n,s=a-r,l=(e,t)=>i.activeLayer.set(e,t,this.color);if(0==e){const o=0<=s?a:r;for(let e=0<=s?r:a;e<=o;e++)this.drawCore(n,e,l)}else{var c=0<e?1:-1,d=0<s?1:-1,u=Math.abs(s/e);let t=0,i=r;for(let e=n;0<c?e<=o:e>=o;e+=c)for(this.drawCore(e,i,l),t+=u;.5<=t;)(0<d?i<=a:i>=a)&&this.drawCore(e,i,l),i+=d,--t}}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(i,n,r){i-=Math.floor(this.toolWidth/2),n-=Math.floor(this.toolWidth/2);for(let t=0;t<this.toolWidth;t++)for(let e=0;e<this.toolWidth;e++)r(i+t,n+e)}}i.LineEdit=c;class u extends o{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();var t=this.topLeft(),i=this.bottomRight(),n=i.x-t.x,i=i.y-t.y,t=Math.floor(Math.hypot(n,i)),n=this.startCol,i=this.startRow;this.midpoint(n,i,t,e)}midpoint(e,t,i,n){let r=i-1,o=0,a=1,s=1,l=a-2*i;for(;r>=o;)n.activeLayer.set(e+r,t+o,this.color),n.activeLayer.set(e+r,t-o,this.color),n.activeLayer.set(e+o,t+r,this.color),n.activeLayer.set(e+o,t-r,this.color),n.activeLayer.set(e-o,t+r,this.color),n.activeLayer.set(e-o,t-r,this.color),n.activeLayer.set(e-r,t+o,this.color),n.activeLayer.set(e-r,t-o,this.color),l<=0&&(o++,l+=s,s+=2),0<l&&(r--,l+=(a+=2)-2*i)}}i.CircleEdit=u;class p extends r{constructor(){super(...arguments),this.showPreview=!0}start(e,t,i){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(i){const n=i.activeLayer!==i.image,e=(e,t)=>(n?i.activeLayer.get(e,t)+1<<8:0)+i.image.get(e,t),t=e(this.col,this.row);if(t!==this.color){i.mergeFloatingLayer();const o=new pxt.sprite.Bitmask(i.width,i.height),a=(o.set(this.col,this.row),[{x:this.col,y:this.row}]);for(;a.length;){const n=a.pop();e(n.x,n.y)===t&&(i.activeLayer.set(n.x,n.y,this.color),r(n.x+1,n.y),r(n.x-1,n.y),r(n.x,n.y+1),r(n.x,n.y-1))}function r(e,t){0<=e&&e<o.width&&0<=t&&t<o.height&&!o.get(e,t)&&(o.set(e,t),a.push({x:e,y:t}))}}}}i.FillEdit=p;class h extends o{constructor(){super(...arguments),this.isMove=!1,this.showPreview=!1}start(e,t,i){this.isStarted=!0,this.startCol=e,this.startRow=t,i.floating&&i.floating.image&&i.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=i.layerOffsetX,this.startOffsetY=i.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){var t=this.topLeft(),i=this.bottomRight();this.isDragged?this.isMove?(e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow):(e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,i.x-t.x+1,i.y-t.y+1,!0)):this.isMove||e.mergeFloatingLayer()}}i.MarqueeEdit=h,i.rotateEdit=function(e,r,t,i){const n=!(null==(l=e.floating)||!l.image),o=n?e.floating:e,a=new(t?pxt.sprite.Tilemap:pxt.sprite.Bitmap)(o.image.height,o.image.width),s=o.overlayLayers?o.overlayLayers.map(e=>new pxt.sprite.Bitmap(e.height,e.width)):void 0;for(let n=0;n<o.image.width;n++)for(let i=0;i<o.image.height;i++)c(o.image,a,n,i),s&&s.forEach((e,t)=>c(o.overlayLayers[t],e,n,i));var l=a.width===a.height&&a.width===e.image.width&&e.image.width===e.image.height;if(!i&&!n||l){const e=new d(a);return e.overlayLayers=s,e}if(!n)for(let i=0;i<e.width;i++)for(let t=0;t<e.height;t++)e.image.set(i,t,0),e.overlayLayers&&e.overlayLayers.forEach(e=>null==e?void 0:e.set(i,t,0));return(a.width===e.image.height&&a.height===e.image.width||a.width===e.image.width&&a.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(a.width>>1),e.layerOffsetY=(e.height>>1)-(a.height>>1)),e.floating={image:a,overlayLayers:s},e;function c(e,t,i,n){r?t.set(n,i,e.get(i,e.height-n-1)):t.set(n,i,e.get(e.width-i-1,n))}},i.flipEdit=function(e,r,t){var i;const o=null!=(i=e.floating)&&i.image?e.floating:e,a=new(t?pxt.sprite.Tilemap:pxt.sprite.Bitmap)(o.image.width,o.image.height),s=o.overlayLayers?o.overlayLayers.map(e=>new pxt.sprite.Bitmap(e.width,e.height)):void 0;for(let n=0;n<o.image.width;n++)for(let i=0;i<o.image.height;i++)l(o.image,a,n,i),s&&s.forEach((e,t)=>l(o.overlayLayers[t],e,n,i));if(null!=(i=e.floating)&&i.image)return e.floating={image:a,overlayLayers:s},e;{const e=new d(a);return e.overlayLayers=s,e}function l(e,t,i,n){r?t.set(i,n,e.get(i,e.height-n-1)):t.set(i,n,e.get(e.width-i-1,n))}}},{"./store/imageReducer":37}],42:[function(e,t,i){"use strict";function n(){return"undefined"!=typeof window&&!!window.PointerEvent}function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}var o;function a(e){return e.touches?(e.touches.length?e.touches:e.changedTouches)[0]:e}Object.defineProperty(i,"__esModule",{value:!0}),i.createTilemapPatchFromFloatingLayer=i.applyBitmapData=i.imageStateToTilemap=i.imageStateToBitmap=i.bindGestureEvents=i.GestureState=i.fireClickOnlyOnEnter=i.clientCoord=i.pointerEvents=i.Bitmask=i.MapTools=i.isBitmapSupported=i.isTouchEnabled=i.hasPointerEvents=i.DRAG_RADIUS=void 0,i.DRAG_RADIUS=3,i.hasPointerEvents=n,i.isTouchEnabled=r,i.isBitmapSupported=function(){return!!window.createImageBitmap},(o=i.MapTools||(i.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase",i.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){e+=this.width*t;this.mask[e>>3]|=1<<(7&e)}get(e,t){e+=this.width*t;return this.mask[e>>3]>>(7&e)&1}},i.pointerEvents=n()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},i.clientCoord=a,i.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class s{constructor(e,t,i){this.target=e,this.isRightClick=i,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>i.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(t,i){for(let e=0;e<t.changedTouches.length;e++)if(t.changedTouches[e].identifier===i)return t.changedTouches[e]}function c(e){return 0<e.button}i.GestureState=s,i.bindGestureEvents=function(e,t){(n()?function(e,t){let i;e.addEventListener("pointerup",e=>{i&&(i.end(a(e)),e.preventDefault()),i=void 0}),e.addEventListener("pointerdown",e=>{i&&i.end(),i=new s(t,a(e),c(e)),e.preventDefault()}),e.addEventListener("pointermove",e=>{i&&(i.update(a(e)),e.preventDefault())}),e.addEventListener("pointerleave",e=>{i&&(i.end(a(e)),e.preventDefault()),i=void 0})}:r()?function(e,t){let i,n;e.addEventListener("touchend",e=>{var t;i&&n&&(t=l(e,n))&&(i.end(t),i=void 0,e.preventDefault())}),e.addEventListener("touchstart",e=>{i&&i.end(),n=e.changedTouches[0].identifier,i=new s(t,e.changedTouches[0],c(e))}),e.addEventListener("touchmove",e=>{var t;i&&n&&(t=l(e,n))&&(i.update(t),e.preventDefault())}),e.addEventListener("touchcancel",e=>{var t;i&&n&&(t=l(e,n))&&(i.end(t),i=void 0,e.preventDefault())})}:function(e,t){let i;e.addEventListener("mouseup",e=>{i&&i.end(a(e)),i=void 0}),e.addEventListener("mousedown",e=>{i&&i.end(),i=new s(t,a(e),c(e))}),e.addEventListener("mousemove",e=>{i&&i.update(a(e))}),e.addEventListener("mouseleave",e=>{i&&i.end(a(e)),i=void 0})})(e,t)},i.imageStateToBitmap=function(e){var t,i=pxt.sprite.Bitmap.fromData(e.bitmap);return e.floating&&e.floating.bitmap&&((t=pxt.sprite.Bitmap.fromData(e.floating.bitmap)).x0=e.layerOffsetX||0,t.y0=e.layerOffsetY||0,i.apply(t,!0)),i},i.imageStateToTilemap=function(e){var t,i=pxt.sprite.Tilemap.fromData(e.bitmap);return e.floating&&e.floating.bitmap&&((t=pxt.sprite.Tilemap.fromData(e.floating.bitmap)).x0=e.layerOffsetX||0,t.y0=e.layerOffsetY||0,i.apply(t,!0)),i},i.applyBitmapData=function(e,t,i=0,n=0){var r;return e&&t?(r=pxt.sprite.Bitmap.fromData(e),(t=pxt.sprite.Bitmap.fromData(t)).x0=i,t.y0=n,r.apply(t,!0),r.data()):e},i.createTilemapPatchFromFloatingLayer=function(e,i){if(e.floating){var n=pxt.sprite.Tilemap.fromData(e.floating.image.data()),r=new pxt.sprite.Tilemap(n.width,n.height),e=e.floating.overlayLayers?e.floating.overlayLayers.map(e=>pxt.sprite.base64EncodeBitmap(e.data())):[],o=[];for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++){var a=i.tiles[n.get(t,e)],s=o.indexOf(a);-1===s?(r.set(t,e,o.length),o.push(a)):r.set(t,e,s)}return{map:pxt.sprite.hexEncodeTilemap(r),layers:e,tiles:o.map(e=>pxt.sprite.base64EncodeBitmap(e.bitmap))}}}},{}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageFieldEditor=void 0;const u=e("react"),p=e("../sui"),n=e("./assetEditor/assetCard"),o=e("./assetEditor/store/assetEditorReducer"),h=e("./ImageEditor/ImageEditor"),r=e("./ImageEditor/keyboardShortcuts"),a=e("./ImageEditor/store/imageReducer"),f=e("./FilterPanel");class s extends u.Component{constructor(e){super(e),this.tagClickHandler=e=>{var t=this.state.gallerySelectedTags,e=e.toLowerCase(),i=t.indexOf(e);i<0?t.push(e):t.splice(i,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),l("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),l("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),l("gallery-my-assets"),this.userAssets=o.getAssets(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,i;if(this.ref&&e.id!==(null==(t=this.asset)?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null==(i=this.asset)?void 0:i.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}l("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},a.setTelemetryFunction(l)}get asset(){var e;return null==(e=this.ref)?void 0:e.getAsset()}render(){var e,{currentView:t,headerVisible:i,editingTile:n,hideMyAssets:r,filterOpen:o}=this.state,o="gallery"===this.state.currentView&&o;let a=i;var i=!this.asset||n||"tilemap"!==this.asset.type,r=!r&&!n,s=(this.asset&&!this.galleryAssets&&i&&this.updateGalleryAssets(),["tile","dialog","background"]);let l=[],c=[];switch(t){case"my-assets":c=this.filterAssetsByType(this.userAssets,n?"tile":null==(e=this.asset)?void 0:e.type),l=this.getAvailableTags(c,s);break;case"gallery":c=this.filterAssetsByType(this.galleryAssets,n?"tile":null==(e=this.asset)?void 0:e.type,!0,!0),l=this.getAvailableTags(c,s),c=this.filterAssetsByTag(c)}var d=[{label:lf("Editor"),view:"editor",icon:"paint brush",onClick:this.showEditor},{label:lf("Gallery"),view:"gallery",icon:"picture",onClick:this.showGallery},{label:lf("My Assets"),view:"my-assets",icon:"folder",onClick:this.showMyAssets}];return i||r?i?r||d.splice(2,1):d.splice(1,1):a=!1,u.createElement("div",{className:"image-editor-wrapper"},a&&u.createElement("div",{className:"gallery-editor-header"},u.createElement("div",{className:"image-editor-header-left"}),u.createElement("div",{className:"image-editor-header-center"},u.createElement(g,{options:d,view:t})),u.createElement("div",{className:"image-editor-header-right"},u.createElement("div",{className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:p.fireClickOnEnter},u.createElement("div",{className:"gallery-filter-button-icon"},u.createElement("i",{className:"icon filter"})),u.createElement("div",{className:"gallery-filter-button-label"},lf("Filter"))),!n&&u.createElement("div",{className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},u.createElement("i",{className:"ui icon close"})))),u.createElement("div",{className:"image-editor-gallery-window"},u.createElement("div",{className:"image-editor-gallery-content"},u.createElement(h.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode}),u.createElement(m,{items:c,hidden:"editor"===t,onAssetSelected:this.onAssetSelected})),u.createElement("div",{className:"filter-panel-gutter "+(o?"":"hidden")},u.createElement("div",{className:"filter-panel-container"},u.createElement(f.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:l})))))}componentDidMount(){this.ref=this.refs["image-editor"],l("image-editor-shown")}componentWillUnmount(){l("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,i){switch(this.closeEditor=t,this.options=i,this.lightMode=i.lightMode,e.type){case"image":this.initSingleFrame(e,i);break;case"tile":i.disableResize=!0,this.initSingleFrame(e,i);break;case"animation":this.initAnimation(e,i);break;case"tilemap":this.initTilemap(e,i)}this.editID=e.id;let n=!1;i&&(this.blocksInfo=i.blocksInfo,i.filter&&(this.setState({galleryFilter:i.filter}),n=!0),null!=i.headerVisible&&(this.setState({headerVisible:i.headerVisible}),n=!0),null!=i.hideMyAssets)&&(this.setState({hideMyAssets:i.hideMyAssets}),n=!0),n||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){var e;return this.ref&&this.props.singleFrame?(e=this.ref.getCurrentFrame().data(),pxt.sprite.base64EncodeBitmap(e)):""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options)&&this.options.disableResize&&this.ref.disableResize()}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=o.getAssets(!0,this.asset.type)}getAvailableTags(e,t){let i=[];return this.galleryAssets?(e.forEach(e=>{null!=(e=e.meta.tags)&&e.forEach(e=>{e=(0===(e=e).indexOf("?")&&1<e.length?e.substring(1):e).toLowerCase();t.indexOf(e)<0&&i.indexOf(e)<0&&i.push(e)})}),i):[]}filterAssetsByTag(e){return e=0<this.state.gallerySelectedTags.length&&this.state.filterOpen?e.filter(e=>{return!(null==(e=e.meta.tags)||!e.find(e=>0<=this.state.gallerySelectedTags.indexOf(e)))}):e}filterAssetsByType(e,i,t=!1,n){var r;if(void 0===(i=void 0===i?null==(r=this.asset)?void 0:r.type:i))return e;if(this.asset&&!t&&(e=e.map(e=>e.type!==this.asset.type||e.id!==this.asset.id?e:o.assetToGalleryItem(this.getValue())),this.state.editingTile)){const i=this.ref.getAsset();e=e.map(t=>{var e;return 0<=(null==(e=i.data.editedTiles)?void 0:e.indexOf(t.id))?o.assetToGalleryItem(i.data.tileset.tiles.find(e=>e.id===t.id)):t})}if(n){e.forEach(e=>{!e.meta.tags&&this.options&&(e.meta.tags=(null==(e=null==(e=this.blocksInfo.apis.byQName[e.id])?void 0:e.attributes.tags)?void 0:e.split(" "))||[])});const i=this.state.galleryFilter.split(" ").filter(e=>!!e).map(e=>e.toLowerCase()),t=i.filter(e=>0!==e.indexOf("!")),n=i.filter(e=>0===e.indexOf("!")&&1<e.length).map(e=>e.substring(1));e=e.filter(e=>function(e,t){const n=e.meta.tags||[];return t.every(t=>{const i="?"+t;return n.some(e=>e===t||e===i)})}(e,t)&&function(e,t){const i=e.meta.tags||[];return t.every(t=>!i.some(e=>e===t))}(e,n))}if(t)switch(i){case"animation":return e.filter(e=>"animation"===e.type||"tile"===e.type||"image"===e.type);case"image":return e.filter(e=>"tile"===e.type||"image"===e.type);case"tile":return e.filter(e=>"tile"===e.type);case"tilemap":return e.filter(e=>"tilemap"===e.type)}else switch(i){case"animation":return e.filter(e=>"animation"===e.type);case"image":return e.filter(e=>"image"===e.type);case"tile":return e.filter(e=>"tile"===e.type);case"tilemap":return e.filter(e=>"tilemap"===e.type)}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let i;t&&(this.blocksInfo=t.blocksInfo,i=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map(e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16}))),this.ref.openAsset(e,i)}loadJres(e){if(e)try{this.ref.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){}}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?(r.releaseShortcutLock(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=r.obtainShortcutLock())}}i.ImageFieldEditor=s;class m extends u.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){var{items:e,hidden:t}=this.props;return u.createElement("div",{className:"image-editor-gallery "+(e&&!t?"visible":"")},!t&&e&&e.map((e,t)=>u.createElement(n.AssetCardView,{key:t,asset:e,selected:!1,onClick:this.clickHandler})))}}class g extends u.Component{render(){const{options:e,view:t}=this.props,i=2<e.length,n=e.findIndex(e=>e.view===t),r=e[0],o=i?e[1]:void 0,a=i?e[2]:e[1];var s=i?["left","center","right"][n]:["left","right"][n]+" no-gallery";return u.createElement("div",{className:`gallery-editor-toggle ${s} `+(pxt.BrowserUtils.isEdge()?"edge":"")},u.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-left",onClick:r.onClick,role:"button"},r.icon&&u.createElement("i",{className:"ui icon "+r.icon}),u.createElement("span",null,r.label)),o&&u.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-center",onClick:o.onClick,role:"button"},o.icon&&u.createElement("i",{className:"ui icon "+o.icon}),u.createElement("span",null,o.label)),u.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-right",onClick:a.onClick,role:"button"},a.icon&&u.createElement("i",{className:"ui icon "+a.icon}),u.createElement("span",null,a.label)),u.createElement("div",{className:"gallery-editor-toggle-handle"}))}}function l(e){pxt.tickEvent("image.editor",{action:e})}},{"../sui":129,"./FilterPanel":19,"./ImageEditor/ImageEditor":26,"./ImageEditor/keyboardShortcuts":35,"./ImageEditor/store/imageReducer":37,"./assetEditor/assetCard":47,"./assetEditor/store/assetEditorReducer":55,react:320}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TilemapFieldEditor=void 0;const n=e("react"),r=e("./ImageEditor/ImageEditor"),o=e("./ImageEditor/store/imageReducer");class a extends n.Component{constructor(e){super(e),this.onDoneClick=()=>{this.closeEditor&&this.closeEditor()},this.state={galleryVisible:!1},o.setTelemetryFunction(s)}render(){return n.createElement("div",{className:"image-editor-wrapper"},n.createElement("div",{className:"image-editor-gallery-content"},n.createElement(r.ImageEditor,{ref:"image-editor",singleFrame:!0,onDoneClicked:this.onDoneClick})))}componentDidMount(){this.ref=this.refs["image-editor"],s("image-editor-shown")}componentWillUnmount(){s("image-editor-hidden")}init(e,t,i){this.closeEditor=t,this.lightMode=i.lightMode,this.initTilemap(e,i)}getValue(){return this.ref?this.ref.getTilemap():null}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&this.ref.restorePersistentData(e)}onResize(){this.ref&&this.ref.onResize()}shouldPreventHide(){var e;return!(null==(e=this.ref)||!e.state.editingTile||(this.ref.closeNestedEditor(),0))}initTilemap(e,t){let i;t&&(this.blocksInfo=t.blocksInfo,i=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map(e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16}))),this.ref.openAsset(e,i)}}function s(e){pxt.tickEvent("image.editor",{action:e})}i.TilemapFieldEditor=a},{"./ImageEditor/ImageEditor":26,"./ImageEditor/store/imageReducer":37,react:320}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchUpdateGalleryAssets=i.dispatchUpdateUserAssets=i.dispatchChangeGalleryView=i.dispatchChangeSelectedAsset=void 0;const n=e("./types");i.dispatchChangeSelectedAsset=(e,t)=>({type:n.CHANGE_SELECTED_ASSET,assetType:e,assetId:t}),i.dispatchChangeGalleryView=(e,t,i)=>({type:n.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:i}),i.dispatchUpdateUserAssets=()=>({type:n.UPDATE_USER_ASSETS}),i.dispatchUpdateGalleryAssets=()=>({type:n.UPDATE_GALLERY_ASSETS})},{"./types":46}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UPDATE_GALLERY_ASSETS=i.UPDATE_USER_ASSETS=i.CHANGE_GALLERY_VIEW=i.CHANGE_SELECTED_ASSET=void 0,i.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",i.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",i.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",i.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],47:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCard=i.AssetCardView=void 0;const o=e("react"),n=e("react-redux"),a=e("./store/assetEditorReducer"),r=e("./actions/dispatch"),s=e("./assetPreview");class l extends o.Component{constructor(){super(...arguments),this.clickHandler=()=>{var{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){var{asset:e,selected:t}=this.props;return o.createElement(c,{asset:e,selected:t,onClick:this.clickHandler})}}class c extends o.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";default:return null}}render(){var{asset:e,selected:t}=this.props,i=a.isGalleryAsset(e),n=this.getDisplayIconForAsset(e.type),r=n||!(null!=(r=e.meta)&&r.displayName);return o.createElement("div",{className:"asset-editor-card "+(t?"selected":""),onClick:this.clickHandler,role:"listitem"},o.createElement(s.AssetPreview,{asset:e}),r&&o.createElement("div",{className:"asset-editor-card-label"},n&&o.createElement("div",{className:"asset-editor-card-icon"},o.createElement("i",{className:"icon "+n})),!(null!=(t=e.meta)&&t.displayName)&&!i&&o.createElement("div",{className:"asset-editor-card-icon warning"},o.createElement("i",{className:"icon exclamation triangle"}))))}}i.AssetCardView=c;e={dispatchChangeSelectedAsset:r.dispatchChangeSelectedAsset};i.AssetCard=n.connect(function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}},e)(l)},{"./actions/dispatch":45,"./assetPreview":51,"./store/assetEditorReducer":55,react:320,"react-redux":299}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCardList=void 0;const n=e("react"),r=e("./assetCard");class o extends n.Component{constructor(){super(...arguments),this.hasUpdatedCards=!1,this.handleContainerRef=e=>{e&&(this.container=e,this.updateEmptyCards())},this.updateEmptyCards=pxtc.Util.throttle(()=>{if(this.container){const s=this.container.firstElementChild;if(s){this.emptyCards||(this.emptyCards=[]);const l=s.getBoundingClientRect(),c=this.container.getBoundingClientRect();if(l.width&&l.height&&c.width&&c.height){let e=l.width;if(s.nextElementSibling){const c=s.nextElementSibling.getBoundingClientRect();e=Math.max(e,c.left-l.left)}this.hasUpdatedCards=!0;var o=Math.floor(c.width/e),a=Math.floor(this.container.parentElement.getBoundingClientRect().height/e);let t,i,n=this.container.firstElementChild,r=0;for(;n;)n.classList.contains("empty-card")?t=t||n:(r++,t&&this.container.insertBefore(n,t)),n=n.nextElementSibling;if((i=o*a>r?o*a-r:o-r%o)!==this.emptyCards.length)if(this.emptyCards.length>i)for(;this.emptyCards.length>i;)this.emptyCards.pop().remove();else for(let e=this.emptyCards.length;e<i;e++){const s=document.createElement("div");s.setAttribute("class","asset-editor-card empty-card"),this.container.appendChild(s),this.emptyCards.push(s)}}}}},100)}componentDidUpdate(){this.updateEmptyCards()}componentDidMount(){window.addEventListener("resize",this.updateEmptyCards);let e=()=>{this.hasUpdatedCards||(this.updateEmptyCards(),this.hasUpdatedCards)||requestAnimationFrame(e)};requestAnimationFrame(e)}componentWillUnmount(){window.removeEventListener("resize",this.updateEmptyCards)}render(){var e=this.props["assets"];return n.createElement("div",{ref:this.handleContainerRef},this.props.children,e.map(e=>n.createElement(r.AssetCard,{asset:e,key:e.id})))}}i.AssetCardList=o},{"./assetCard":47,react:320}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetGallery=void 0;const a=e("react"),s=e("../../package"),l=e("../../sui"),n=e("react-redux"),r=e("./actions/dispatch"),c=e("./assetCardList"),d=e("./assetTopbar");class o extends a.Component{constructor(e){super(e),this.showCreateModal=()=>{this.setState({showCreateModal:!0})},this.hideCreateModal=()=>{this.setState({showCreateModal:!1})},this.getCreateAssetHandler=r=>()=>{pxt.tickEvent("assets.create",{type:r.toString()});const n=pxt.react.getTilemapProject(),e=this.getEmptyAsset(r);this.hideCreateModal(),this.props.showAssetFieldView(e,e=>{n.pushUndo();var t,i=null==(t=e.meta)?void 0:t.displayName;switch(r){case"image":n.createNewProjectImage(e.bitmap,i);break;case"tile":n.createNewTile(e.bitmap,null,i);break;case"tilemap":n.createNewTilemapFromData(e.data,i);break;case"animation":n.createNewAnimationFromData(e.frames,e.interval,i)}s.mainEditorPkg().buildAssetsAsync().then(()=>this.props.dispatchUpdateUserAssets())})},this.state={showCreateModal:!1},this.assetCreateOptions=[{label:lf("Image"),icon:"picture",handler:this.getCreateAssetHandler("image")},{label:lf("Tile"),icon:"clone",handler:this.getCreateAssetHandler("tile")},{label:lf("Tilemap"),icon:"map",handler:this.getCreateAssetHandler("tilemap")},{label:lf("Animation"),icon:"video",handler:this.getCreateAssetHandler("animation")}]}getEmptyAsset(e){var t=pxt.react.getTilemapProject(),i={type:e,id:"",internalID:0,meta:{displayName:pxt.getDefaultAssetDisplayName(e)}};switch(e){case"image":case"tile":i.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":i.data=t.blankTilemap(16,16,16);case"animation":const e=i;e.frames=[new pxt.sprite.Bitmap(16,16).data()],e.interval=200}return i}render(){var{view:e,galleryAssets:t,userAssets:i,disableCreateButton:n}=this.props,r=this.state["showCreateModal"],o=(null==(o=s.mainPkg)?void 0:o.config)&&s.mainPkg.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME;return a.createElement("div",{className:"asset-editor-gallery"},a.createElement(d.AssetTopbar,null),a.createElement("div",{className:"asset-editor-card-list "+(0!==e?"hidden":"")},a.createElement(c.AssetCardList,{assets:(i=i,o?i:i.filter(e=>!!e.meta.displayName))},a.createElement("div",{className:"create-new "+(n?"disabled":""),role:"button",onClick:n?void 0:this.showCreateModal},a.createElement("i",{className:"icon huge add circle"}),a.createElement("span",null,lf("New Asset"))))),a.createElement("div",{className:"asset-editor-card-list "+(1!==e?"hidden":"")},a.createElement(c.AssetCardList,{assets:t})),a.createElement(l.Modal,{className:"asset-editor-create-dialog",isOpen:r,onClose:this.hideCreateModal,closeIcon:!0,dimmer:!0,header:lf("Create New Asset")},a.createElement("div",null,lf("Choose your asset type from the options below:")),a.createElement("div",{className:"asset-editor-create-options"},this.assetCreateOptions.map((e,t)=>a.createElement("div",{className:"asset-editor-create-button",onClick:e.handler,role:"button",key:t},a.createElement("i",{className:"icon "+e.icon}),a.createElement("span",null,e.label))))))}}e={dispatchUpdateUserAssets:r.dispatchUpdateUserAssets};i.AssetGallery=n.connect(function(e,t){return e?Object.assign(Object.assign({},t),{view:e.view,userAssets:e.assets,galleryAssets:e.galleryAssets}):{}},e)(o)},{"../../package":108,"../../sui":129,"./actions/dispatch":45,"./assetCardList":48,"./assetTopbar":53,react:320,"react-redux":299}],50:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetGalleryTab=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch");class a extends n.Component{constructor(){super(...arguments),this.handleClick=()=>{pxt.tickEvent("assets.gallerytab",{view:this.props.view.toString()}),this.props.dispatchChangeGalleryView(this.props.view)}}render(){var{title:e,selected:t}=this.props;return n.createElement("div",{className:"asset-editor-gallery-tab "+(t?"selected":""),onClick:this.handleClick,role:"navigation"},e)}}e={dispatchChangeGalleryView:o.dispatchChangeGalleryView};i.AssetGalleryTab=r.connect(function(e,t){return e?{selected:e.view==t.view}:{}},e)(a)},{"./actions/dispatch":45,react:320,"react-redux":299}],51:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetPreview=void 0;const n=e("react");class r extends n.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&1<(null==(e=t.framePreviewURIs)?void 0:e.length)&&(this.currentFrame=0,this.animationIntervalRef=setInterval(()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length},Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e=this.props["asset"],t="animation"===e.type&&1<(null==(t=e.framePreviewURIs)?void 0:t.length),i=e.meta.displayName||(e.meta.temporaryInfo?lf("Temporary Asset"):e.id);return n.createElement("div",{className:"asset-editor-preview",title:i},n.createElement("img",{src:e.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:t?this.onMouseEnter:void 0,onMouseLeave:t?this.onMouseLeave:void 0,ref:t?this.handleRef:void 0,loading:"lazy"}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}i.AssetPreview=r},{react:320}],52:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetSidebar=void 0;const d=e("react"),r=e("../../package"),n=e("../../simulator"),u=e("../../sui"),o=e("react-redux"),a=e("./store/assetEditorReducer"),s=e("./actions/dispatch"),p=e("./assetPreview"),l=e("../../app");class c extends d.Component{constructor(e){super(e),this.editAssetHandler=()=>{this.props.showAssetFieldView(this.props.asset,this.editAssetDoneHandler)},this.editAssetDoneHandler=e=>{pxt.tickEvent("assets.edit",{type:e.type.toString()});var t,i=pxt.react.getTilemapProject();i.pushUndo(),null!=(t=this.props.asset.meta)&&t.displayName||!e.meta.temporaryInfo||(l.getBlocksEditor().updateTemporaryAsset(e),r.mainEditorPkg().lookupFile("this/"+pxt.MAIN_BLOCKS).setContentAsync(l.getBlocksEditor().getCurrentSource())),e.meta.displayName&&i.updateAsset(e),this.props.dispatchChangeGalleryView(0),this.updateAssets().then(()=>n.setDirty())},this.duplicateAssetHandler=()=>{const e=this.props["isGalleryAsset"];pxt.tickEvent("assets.duplicate",{type:this.props.asset.type.toString(),gallery:e.toString()});var t=this.props.asset,i=(null==(i=t.meta)?void 0:i.displayName)||h(t,e)||pxt.getDefaultAssetDisplayName(t.type),n=pxt.react.getTilemapProject();n.pushUndo();const{type:r,id:o}=n.duplicateAsset(t,i);this.updateAssets().then(()=>{e&&this.props.dispatchChangeGalleryView(0,r,o)})},this.copyAssetHandler=()=>{var e=this.props["asset"];switch(pxt.tickEvent("assets.clipboard",{type:e.type.toString(),gallery:this.props.isGalleryAsset.toString()}),e.type){case"image":case"tile":try{var t=pxt.sprite.bitmapToImageLiteral(pxt.sprite.getBitmapFromJResURL(e.jresData),"typescript");this.copyTextAreaRef.value=t,this.copyTextAreaRef.focus(),this.copyTextAreaRef.select(),document.execCommand("copy")}catch(e){}}},this.copyTextAreaRefHandler=e=>{this.copyTextAreaRef=e},this.showDeleteModal=()=>{this.setState({showDeleteModal:!0})},this.hideDeleteModal=()=>{this.setState({showDeleteModal:!1})},this.deleteAssetHandler=()=>{pxt.tickEvent("assets.delete",{type:this.props.asset.type.toString()}),this.setState({showDeleteModal:!1});var e=pxt.react.getTilemapProject();e.pushUndo(),e.removeAsset(this.props.asset),this.props.dispatchChangeSelectedAsset(),this.updateAssets()},this.state={showDeleteModal:!1,canEdit:!0,canCopy:!0,canDelete:!0}}UNSAFE_componentWillReceiveProps(e){var t,i,n;e.asset&&this.props.asset!=e.asset&&({asset:e,isGalleryAsset:t}=e,n=pxt.react.getTilemapProject(),i="tilemap"!=(null==e?void 0:e.type)&&"animation"!=(null==e?void 0:e.type),n=(t=!t)&&!n.isAssetUsed(e,r.mainEditorPkg().files),this.setState({canEdit:t,canCopy:i,canDelete:n}))}getAssetDetails(){var e=this.props.asset,t=[];if(e)switch(t.push({name:lf("Type"),value:function(e){switch(e){case"image":return lf("Image");case"tile":return lf("Tile");case"animation":return lf("Animation");case"tilemap":return lf("Tilemap")}}(e.type)}),e.type){case"image":case"tile":t.push({name:lf("Size"),value:e.bitmap.width+" x "+e.bitmap.height});break;case"tilemap":t.push({name:lf("Size"),value:e.data.tilemap.width+" x "+e.data.tilemap.height});break;case"animation":t.push({name:lf("Size"),value:e.frames[0].width+" x "+e.frames[0].height})}return t}updateAssets(){return r.mainEditorPkg().buildAssetsAsync().then(()=>this.props.dispatchUpdateUserAssets())}render(){var{asset:e,isGalleryAsset:t}=this.props,{showDeleteModal:i,canEdit:n,canCopy:r,canDelete:o}=this.state,a=this.getAssetDetails(),s=(null==(s=null==e?void 0:e.meta)?void 0:s.displayName)||t,l=h(e,t),c=[{label:lf("Delete"),onclick:this.deleteAssetHandler,icon:"trash",className:"red"}];return d.createElement("div",{className:"asset-editor-sidebar"},d.createElement("div",{className:"asset-editor-sidebar-info"},d.createElement("div",null,lf("Asset Preview")),d.createElement("div",{className:"asset-editor-sidebar-preview"},e&&d.createElement(p.AssetPreview,{asset:e})),s||!e?d.createElement("div",{className:"asset-editor-sidebar-name"},l):d.createElement("div",{className:"asset-editor-sidebar-temp"},d.createElement("i",{className:"icon exclamation triangle"}),d.createElement("span",null,lf("No asset name"))),a.map(e=>d.createElement("div",{key:e.name,className:"asset-editor-sidebar-detail"},e.name+": "+e.value))),e&&d.createElement("div",{className:"asset-editor-sidebar-controls"},n&&d.createElement(u.MenuItem,{name:lf("Edit"),className:"asset-editor-button",icon:"edit",onClick:this.editAssetHandler}),d.createElement(u.MenuItem,{name:lf("Duplicate"),className:"asset-editor-button",icon:"copy",onClick:this.duplicateAssetHandler}),r&&d.createElement(u.MenuItem,{name:lf("Copy"),className:"asset-editor-button",icon:"paste",onClick:this.copyAssetHandler}),o&&d.createElement(u.MenuItem,{name:lf("Delete Asset"),className:"delete-asset",dataTooltip:o?void 0:t?lf("Can't delete gallery item"):lf("Asset is used in your project"),onClick:o?this.showDeleteModal:void 0})),d.createElement("textarea",{className:"asset-editor-sidebar-copy",ref:this.copyTextAreaRefHandler}),d.createElement(u.Modal,{className:"asset-editor-delete-dialog",isOpen:i,onClose:this.hideDeleteModal,closeIcon:!0,dimmer:!0,header:lf("Delete Asset"),buttons:c},d.createElement("div",null,lf("Are you sure you want to delete {0}? Deleted assets cannot be recovered.",l))))}}function h(e,t){var i;return e?null!=(i=null==e?void 0:e.meta)&&i.displayName?e.meta.displayName:t?e.id.split(".").pop():null:lf("No asset selected")}e={dispatchChangeGalleryView:s.dispatchChangeGalleryView,dispatchChangeSelectedAsset:s.dispatchChangeSelectedAsset,dispatchUpdateUserAssets:s.dispatchUpdateUserAssets};i.AssetSidebar=o.connect(function(e,t){return e?{asset:e.selectedAsset,isGalleryAsset:a.isGalleryAsset(e.selectedAsset)}:{}},e)(c)},{"../../app":3,"../../package":108,"../../simulator":121,"../../sui":129,"./actions/dispatch":45,"./assetPreview":51,"./store/assetEditorReducer":55,react:320,"react-redux":299}],53:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetTopbar=void 0;const n=e("react"),r=e("./assetGalleryTab");class o extends n.Component{render(){return n.createElement("div",{className:"asset-editor-topbar"},n.createElement(r.AssetGalleryTab,{title:lf("My Assets"),view:0}),n.createElement(r.AssetGalleryTab,{title:lf("Gallery"),view:1}))}}i.AssetTopbar=o},{"./assetGalleryTab":50,react:320}],54:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetEditor=void 0;const n=e("react"),r=e("../../package"),o=e("../../compiler"),a=e("../../blocklyFieldView"),s=e("react-redux"),l=e("./store/assetEditorStore"),c=e("./actions/dispatch"),d=e("../../srceditor"),u=e("./assetSidebar"),p=e("./assetGallery");class h extends d.Editor{constructor(){super(...arguments),this.showAssetFieldView=(t,i)=>{let n;switch(t.type){case"image":case"tile":n=pxt.react.getFieldEditorView("image-editor",t,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"tilemap":const i=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(i,t),n=pxt.react.getFieldEditorView("tilemap-editor",t,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"animation":n=pxt.react.getFieldEditorView("animation-editor",t,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo})}this.parent.isTutorial()&&a.setContainerClass("asset-editor-tutorial"),n.onHide(()=>{this.parent.isTutorial()&&this.unbindTutorialEvents();var e=n.getResult();"tilemap"==t.type&&pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),e),Promise.resolve(i(e)).then(()=>{var e;null!=(e=t.meta)&&e.displayName||this.parent.saveBlocksToTypeScriptAsync().then(e=>{e&&r.mainEditorPkg().setContentAsync(pxt.MAIN_TS,e)})}),a.setContainerClass(null)}),this.parent.isTutorial()&&this.bindTutorialEvents(),n.show()}}getId(){return"assetEditor"}acceptsFile(e){return e.name===pxt.ASSETS_FILE}loadFileAsync(e,t){return super.loadFileAsync(e,t).then(()=>o.getBlocksAsync()).then(e=>{pxt.blocks.initializeAndInject(e),this.blocksInfo=e,this.updateGalleryAssets()}).then(()=>l.default.dispatch(c.dispatchUpdateUserAssets())).then(()=>{this.parent.forceUpdate(),this.parent.isTutorial()&&this.parent.onTutorialLoaded()})}unloadFileAsync(){return a.dismissIfVisible(),r.mainEditorPkg().buildAssetsAsync()}undo(){pxt.react.getTilemapProject().undo(),l.default.dispatch(c.dispatchUpdateUserAssets())}redo(){pxt.react.getTilemapProject().redo(),l.default.dispatch(c.dispatchUpdateUserAssets())}resize(e){var t=this.getAssetEditorDiv();if(t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect(),i=document.getElementById("editortools");a.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height+(i?i.getBoundingClientRect().height:0),horizontalPadding:0,verticalPadding:0})}else a.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}display(){return n.createElement(s.Provider,{store:l.default},n.createElement("div",{className:"asset-editor-outer"},n.createElement(u.AssetSidebar,{showAssetFieldView:this.showAssetFieldView}),n.createElement(p.AssetGallery,{showAssetFieldView:this.showAssetFieldView,disableCreateButton:this.parent.isTutorial()})))}getAssetEditorDiv(){return document.getElementById("assetEditor")}getTutorialCardDiv(){return document.getElementById("tutorialcard")}getTutorialMenuDiv(){var e;return null==(e=document.getElementsByClassName("tutorial-menuitem"))?void 0:e[0]}handleTutorialClick(e){e.stopPropagation(),e.preventDefault()}bindTutorialEvents(){var e=this.getTutorialCardDiv(),e=(null!=e&&e.addEventListener("mousedown",this.handleTutorialClick),this.getTutorialMenuDiv());null!=e&&e.addEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.addClass(document.getElementById("maineditor"),"image-editor-open")}unbindTutorialEvents(){var e=this.getTutorialCardDiv(),e=(null!=e&&e.removeEventListener("mousedown",this.handleTutorialClick),this.getTutorialMenuDiv());null!=e&&e.removeEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.removeClass(document.getElementById("maineditor"),"image-editor-open")}updateGalleryAssets(){l.default.dispatch(c.dispatchUpdateGalleryAssets())}}i.AssetEditor=h},{"../../blocklyFieldView":9,"../../compiler":18,"../../package":108,"../../srceditor":128,"./actions/dispatch":45,"./assetGallery":49,"./assetSidebar":52,"./store/assetEditorStore":56,react:320,"react-redux":299}],55:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isGalleryAsset=i.assetToGalleryItem=i.getAssets=i.GalleryView=void 0;const o=e("../actions/types"),a=e("../../../package"),s=e("../../../app");(e=i.GalleryView||(i.GalleryView={}))[e.User=0]="User",e[e.Gallery=1]="Gallery";const l={view:0,assets:[],galleryAssets:[]};function p(e,t){return e.internalID-t.internalID}function c(e,t,i){if(t&&i)return e.assets.find(e=>e.type==t&&e.id==i)||e.galleryAssets.find(e=>e.type==t&&e.id==i)}function d(e=!1,t="image",i=[]){const n=pxt.react.getTilemapProject(),r=new pxt.ImageConverter,o=e=>h(e,r),a=(e?n.getGalleryAssets:n.getAssets).bind(n),s=a("image").map(o).sort(p),l=a("tile").map(o).filter(e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi)).sort(p),c=a("tilemap").map(o).sort(p),d=a("animation").map(o).sort(p);for(const e of i)switch(e.type){case"image":s.push(o(e));break;case"tile":l.push(o(e));break;case"animation":d.push(o(e));break;case"tilemap":c.push(o(e))}let u=[];switch(t){case"image":u=s.concat(l).concat(d).concat(c);break;case"tile":u=l.concat(s).concat(d).concat(c);break;case"animation":u=d.concat(s).concat(l).concat(c);break;case"tilemap":u=c.concat(l).concat(s).concat(d)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:u.length}),u}function h(e,t=new pxt.ImageConverter){switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":var i=e.data.tilemap;return e.previewURI=pxtblockly.tilemapToImageURI(e.data,Math.max(i.width,i.height),!1),e;case"animation":return(null==(i=e.frames)?void 0:i.length)<=0?null:(e.framePreviewURIs=e.frames.map(e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e))),e.previewURI=e.framePreviewURIs[0],e)}}i.getAssets=d,i.assetToGalleryItem=h,i.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")},i.default=(i=l,n)=>{switch(n.type){case o.CHANGE_SELECTED_ASSET:return Object.assign(Object.assign({},i),{selectedAsset:c(i,n.assetType,n.assetId)});case o.CHANGE_GALLERY_VIEW:var r=n.assetId?c(i,n.assetType,n.assetId):i.selectedAsset;return Object.assign(Object.assign({},i),{view:n.view,selectedAsset:r});case o.UPDATE_USER_ASSETS:let e=d(),t=new pxt.ImageConverter;return(null==(r=null==(r=a.mainPkg)?void 0:r.config)?void 0:r.preferredEditor)===pxt.BLOCKS_PROJECT_NAME&&(e=e.concat(s.getBlocksEditor().getTemporaryAssets().map(e=>h(e,t)))),Object.assign(Object.assign({},i),{selectedAsset:i.selectedAsset?e.find(e=>e.id==i.selectedAsset.id):void 0,assets:e});case o.UPDATE_GALLERY_ASSETS:return Object.assign(Object.assign({},i),{galleryAssets:d(!0)});default:return i}}},{"../../../app":3,"../../../package":108,"../actions/types":46}],56:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("redux"),e=e("./assetEditorReducer"),n=n.createStore(e.default);i.default=n},{"./assetEditorReducer":55,redux:341}],57:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TabContent=void 0;const n=e("react");i.TabContent=function(e){return n.createElement("div",null,e.children)}},{react:320}],58:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TabPane=void 0;const d=e("react"),u=e("../../sui");i.TabPane=function(e){const{id:t,children:i,className:n,style:r,activeTabName:o}=e,a=(Array.isArray(i)?i:[i]).filter(e=>!!e);if(!a||0==a.length)return d.createElement("div",null);const[s,l]=d.useState(o),c=e=>{var{name:e,onSelected:t}=e;t&&t(),l(e)};return d.useEffect(()=>{a.some(e=>e.props.name===s)||c(a[0].props)},[i]),d.useEffect(()=>{var e=a.find(e=>e.props.name===o)||a[0];c(e.props)},[o]),d.createElement("div",{id:t,className:"tab-container "+(n||""),style:r},1<a.length&&d.createElement("div",{className:"tab-navigation"},a.map(e=>{var{name:t,icon:i,title:n,ariaLabel:r,showBadge:o}=e.props;return d.createElement("div",{key:t,className:`tab-icon ${t} `+(t==s?"active":""),"aria-label":r,tabIndex:0,onClick:()=>c(e.props),onKeyDown:u.fireClickOnEnter},o&&d.createElement("div",{className:"tab-badge"}),d.createElement("i",{className:i}),d.createElement("span",null,n))})),a.map((e,t)=>{var i=e.props["name"];return d.createElement("div",{key:"tab-content-"+t,className:`tab-content ${i} `+(i!==s?"hidden":"")},e)}))}},{"../../sui":129,react:320}],59:[function(e,t,i){"use strict";var c=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SearchInput=void 0;const d=e("react");class n extends d.Component{constructor(e){super(e),this.updateInputValue=e=>{var t=this.props["searchOnChange"],e=e.target.value;this.setState({inputValue:e}),t&&this.handleSearch(e)},this.state={inputValue:(null==e?void 0:e.defaultValue)||""},this.handleSearchKeyUpdate=this.handleSearchKeyUpdate.bind(this),this.handleClick=this.handleClick.bind(this)}handleSearchKeyUpdate(e){13==e.keyCode&&this.handleSearch(this.state.inputValue)}handleSearch(e){var t=this.props["searchHandler"];t(e)}handleClick(){this.handleSearch(this.state.inputValue)}render(){var e=this.props,{ariaMessage:t,disabled:i,loading:n,placeholder:r,autoFocus:o,className:a,inputClassName:s}=e,e=c(e,["ariaMessage","disabled","loading","placeholder","autoFocus","className","inputClassName","searchOnChange","searchHandler"]),l=this.state["inputValue"];return d.createElement("div",Object.assign({className:"ui search "+(a||"")},e),d.createElement("div",{className:"ui icon input "+(s||"")},d.createElement("div",{"aria-live":"polite",className:"accessible-hidden",id:"searchInputBoxLabel"},t),d.createElement("input",{role:"search",autoFocus:o,ref:"searchInput","aria-labelledby":"searchInputBoxLabel",className:"prompt",type:"text",placeholder:r,onChange:this.updateInputValue,value:l,onKeyUp:this.handleSearchKeyUpdate,disabled:i,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),d.createElement("i",{role:"button",onClick:this.handleClick,title:lf("Search"),style:{cursor:"pointer"},className:`search link icon ${i?"disabled":""} `+(n?"loading":"")})))}}i.SearchInput=n},{react:320}],60:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialContainer=void 0;const R=e("react"),M=e("../../marked"),B=e("../../sui"),j=e("../../immersivereader"),F=e("./TutorialStepCounter"),U=e("./TutorialHint");i.TutorialContainer=function(t){const{parent:e,tutorialId:i,name:n,steps:r,hideIteration:o,tutorialOptions:a,onTutorialStepChange:s,onTutorialComplete:l,setParentHeight:c}=t,[d,u]=R.useState(t.currentStep||0),[p,h]=R.useState(!1),[f,m]=R.useState(!1),[g,b]=R.useState("vertical"),v=R.useRef(void 0),y=0!==d,w=d!==r.length-1,k=!w&&!pxt.appTarget.appTheme.lockedEditor&&!o,x=pxt.appTarget.appTheme.immersiveReader,E=(R.useEffect(()=>{const e=new ResizeObserver(()=>{var e;pxt.BrowserUtils.isTabletSize()?b("horizontal"):b("vertical"),m((null==(e=null==v?void 0:v.current)?void 0:e.scrollHeight)>(null==(e=null==v?void 0:v.current)?void 0:e.offsetHeight))});return e.observe(document.body),()=>e.disconnect()},[document.body]),R.useEffect(()=>{var e;if("horizontal"==g){let t=0;(null!=(e=null==v?void 0:v.current)&&e.children?pxt.Util.toArray(null==(e=null==v?void 0:v.current)?void 0:e.children):[]).forEach(e=>t+=null==e?void 0:e.scrollHeight),t&&c(Math.min(Math.max(t+2,80),194))}else c()}),R.useEffect(()=>{u(t.currentStep)},[t.currentStep]),R.useEffect(()=>{var e=null==v?void 0:v.current;e.scrollTo(0,0),m(e.scrollHeight>e.offsetHeight),s(d),w&&h(!1)},[d]),r[d]);if(!r[d])return R.createElement("div",null);const C=E.showDialog,_=C?Math.min(d+1,r.length-1):d,S=r[_].title,T=r[_].headerContentMd,A=r[_].hintContentMd,N=()=>{var e=Math.min(d+1,t.steps.length-1);pxt.tickEvent("tutorial.next",{tutorial:i,step:e,isModal:C?1:0},{interactiveConsent:!0}),u(e)},I=()=>{var e=Math.max(d-1,0);pxt.tickEvent("tutorial.previous",{tutorial:i,step:e,isModal:C?1:0},{interactiveConsent:!0}),u(e)},O=w?N:()=>h(!0);var P=[{label:lf("Ok"),onclick:O,icon:"arrow circle right",className:"green"}],D=(y&&P.unshift({label:lf("Back"),onclick:I,icon:"arrow circle left",disabled:!y,labelPosition:"left"}),x&&P.push({className:"immersive-reader-button",onclick:()=>{j.launchImmersiveReader(E.contentMd,a)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")}),R.createElement(B.Button,{icon:"arrow circle left",disabled:!y,text:lf("Back"),onClick:I})),L=k?R.createElement(B.Button,{icon:"check circle",text:lf("Done"),onClick:l}):R.createElement(B.Button,{icon:"arrow circle right",disabled:!w,text:lf("Next"),onClick:N});return R.createElement("div",{className:"tutorial-container"},R.createElement("div",{className:"tutorial-top-bar"},R.createElement(F.TutorialStepCounter,{tutorialId:i,currentStep:_,totalSteps:r.length,title:n,setTutorialStep:u}),x&&R.createElement(j.ImmersiveReaderButton,{content:T,tutorialOptions:a})),"horizontal"===g&&D,R.createElement("div",{className:"tutorial-content",ref:v,onScroll:()=>{var e=null==v?void 0:v.current;m(e&&1<e.scrollHeight-e.scrollTop-e.clientHeight)}},S&&R.createElement("div",{className:"tutorial-title"},S),R.createElement(M.MarkedContent,{className:"no-select",tabIndex:0,markdown:T,parent:e})),R.createElement("div",{className:"tutorial-controls"},"vertical"===g&&D,R.createElement(U.TutorialHint,{tutorialId:i,currentStep:_,markdown:A,parent:e,showLabel:"horizontal"===g}),"vertical"===g&&L),"horizontal"===g&&L,f&&R.createElement("div",{className:"tutorial-scroll-gradient"}),C&&!p&&R.createElement(B.Modal,{isOpen:C,closeIcon:!1,header:E.title||n,buttons:P,className:"hintdialog",onClose:O,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},R.createElement(M.MarkedContent,{markdown:E.contentMd,parent:e})))}},{"../../immersivereader":93,"../../marked":97,"../../sui":129,"./TutorialHint":61,"./TutorialStepCounter":62,react:320}],61:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialHint=void 0;const c=e("react"),d=e("../../sui"),u=e("../../marked");i.TutorialHint=function(e){const{parent:t,markdown:i,showLabel:n,tutorialId:r,currentStep:o}=e,[a,s]=c.useState(!1),l=e=>{document.removeEventListener("click",l),s(!1)};return c.createElement("div",{className:"tutorial-hint-container"},c.createElement(d.Button,{icon:"lightbulb",text:n?lf("Hint"):void 0,className:"tutorial-hint",disabled:!i,onClick:i?()=>{a?document.removeEventListener("click",l):(pxt.tickEvent("tutorial.showhint",{tutorial:r,step:o}),document.addEventListener("click",l)),s(!a)}:void 0}),a&&c.createElement("div",{className:"tutorialhint no-select",onClick:e=>{e.preventDefault(),e.stopPropagation(),null!=(e=e.nativeEvent)&&e.stopImmediatePropagation()}},c.createElement(u.MarkedContent,{markdown:i,unboxSnippets:!0,parent:t})),a&&c.createElement("div",{className:"tutorial-hint-mask",onClick:l}))}},{"../../marked":97,"../../sui":129,react:320}],62:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialStepCounter=void 0;const n=e("react");i.TutorialStepCounter=function(o){const{tutorialId:a,currentStep:e,totalSteps:t,title:i}=o;return n.createElement("div",{className:"tutorial-step-counter"},n.createElement("div",{className:"tutorial-step-label"},n.createElement("span",{className:"tutorial-step-title"},i||lf("Step")),n.createElement("span",{className:"tutorial-step-number"},e+1+"/"+t)),n.createElement("div",{className:"tutorial-step-bar",onClick:e=>{var{totalSteps:t,setTutorialStep:i}=o,n=e.target,r=n.getBoundingClientRect(),e=Math.floor((e.clientX-r.left)/n.clientWidth*t);pxt.tickEvent("tutorial.step",{tutorial:a,step:e},{interactiveConsent:!0}),i(e)}},n.createElement("div",{className:"tutorial-step-bar-fill",style:{width:(e+1)/t*100+"%"}})))}},{react:320}],63:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SandboxFooter=i.SideDocs=i.EditorSelector=i.SettingsMenu=i.DocsMenu=void 0;const v=e("react"),r=e("./data"),y=e("./sui"),o=e("./core"),w=e("./auth"),f=e("./package"),a=e("./dialogs");function s(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.startActivity({activity:"tutorial",path:t})}function l(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.setSideDoc(t)}function k(t,e,i=""){return e.map(e=>e.tutorial?v.createElement(d,{key:"docsmenututorial"+e.path,role:"menuitem",ariaLabel:pxt.Util.rlf(e.name),text:pxt.Util.rlf(e.name),className:"ui "+i,parent:t,path:e.path,onItemClick:s}):/^\//.test(e.path)?v.createElement(d,{key:"docsmenu"+e.path,role:"menuitem",ariaLabel:pxt.Util.rlf(e.name),text:pxt.Util.rlf(e.name),className:"ui "+i,parent:t,path:e.path,onItemClick:l}):v.createElement("a",{key:"docsmenulink"+e.path,role:"menuitem","aria-label":e.name,title:e.name,className:"ui item link "+i,href:e.path,target:"docs"},pxt.Util.rlf(e.name)))}class c extends r.PureComponent{renderCore(){var e,t=this.props.parent,i=pxt.appTarget.appTheme;return v.createElement(y.DropdownMenu,{role:"menuitem",icon:"help circle large",className:"item mobile hide help-dropdown-menuitem",textClass:"landscape only",title:lf("Help")},k(t,i.docMenu),(i=this.props.editor,t=t,e="/"+i.toLowerCase(),v.createElement(d,{key:"docsmenu"+e,role:"menuitem",ariaLabel:pxt.Util.rlf(i),text:pxt.Util.rlf(i),className:"ui ",parent:t,path:e,onItemClick:l})))}}i.DocsMenu=c;class d extends y.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){var{onItemClick:e,parent:t,path:i}=this.props;e(t,i)}renderCore(){var e=this.props,{}=e,e=n(e,["onClick","onItemClick","parent","path"]);return v.createElement(y.Item,Object.assign({},e,{onClick:this.handleClick}))}}class u extends r.Component{constructor(e){super(e),this.state={},this.openSettings=this.openSettings.bind(this),this.showPackageDialog=this.showPackageDialog.bind(this),this.showBoardDialog=this.showBoardDialog.bind(this),this.removeProject=this.removeProject.bind(this),this.saveProject=this.saveProject.bind(this),this.toggleCollapse=this.toggleCollapse.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleAccessibleBlocks=this.toggleAccessibleBlocks.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showShareDialog=this.showShareDialog.bind(this),this.showExitAndSaveDialog=this.showExitAndSaveDialog.bind(this),this.pair=this.pair.bind(this),this.pairBluetooth=this.pairBluetooth.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.print=this.print.bind(this)}showExitAndSaveDialog(){pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}showShareDialog(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()}openSettings(){pxt.tickEvent("menu.settings",void 0,{interactiveConsent:!0}),this.props.parent.openSettings()}showPackageDialog(){pxt.tickEvent("menu.addpackage",void 0,{interactiveConsent:!0}),this.props.parent.showPackageDialog()}showBoardDialog(){pxt.tickEvent("menu.changeboard",void 0,{interactiveConsent:!0}),pxt.hasHwVariants()?this.props.parent.showChooseHwDialog():this.props.parent.showBoardDialogAsync(void 0,!0)}saveProject(){pxt.tickEvent("menu.saveproject",void 0,{interactiveConsent:!0}),this.props.parent.saveAndCompile()}removeProject(){pxt.tickEvent("menu.removeproject",void 0,{interactiveConsent:!0}),this.props.parent.removeProject()}toggleCollapse(){pxt.tickEvent("menu.toggleSim",void 0,{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}showReportAbuse(){pxt.tickEvent("menu.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showLanguagePicker(){pxt.tickEvent("menu.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("menu.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("menu.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("menu.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("menu.reset",void 0,{interactiveConsent:!0}),pxt.tickEvent("reset"),this.props.parent.showResetDialog()}pair(){pxt.tickEvent("menu.pair"),this.props.parent.pairAsync()}pairBluetooth(){pxt.tickEvent("menu.pair.bluetooth"),o.showLoading("webblepair",lf("Pairing Bluetooth device...")),pxt.webBluetooth.pairAsync().then(()=>o.hideLoading("webblepair"))}showAboutDialog(){pxt.tickEvent("menu.about"),this.props.parent.showAboutDialog()}print(){pxt.tickEvent("menu.print"),this.props.parent.printCode()}UNSAFE_componentWillReceiveProps(e){var t={};void 0!==e.greenScreen&&(t.greenScreen=e.greenScreen),void 0!==e.accessibleBlocks&&(t.accessibleBlocks=e.accessibleBlocks),void 0!==e.showShare&&(t.showShare=e.showShare),0<Object.keys(t).length&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.greenScreen!=t.greenScreen||this.state.accessibleBlocks!=t.accessibleBlocks||this.state.showShare!=t.showShare}renderCore(){var e=this.getData(w.HIGHCONTRAST),{greenScreen:t,accessibleBlocks:i}=this.state,n=pxt.appTarget.appTheme,r=pxt.appTarget.cloud&&!!pxt.appTarget.cloud.packages,o=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,a=pxt.shell.isReadOnly(),s=pxt.shell.isControllerMode(),l=n.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),c=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),d=!n.lockedEditor&&!s&&w.hasIdentity(),u=this.props.showShare&&(null==(u=pxt.appTarget.cloud)?void 0:u.sharing)&&!s,l=!(a||s||!n.saveInMenu||l||c),c=!a&&!s&&!!n.simCollapseInMenu,p=n.greenScreen||/greenscreen=1/i.test(window.location.href),h=n.print&&!pxt.BrowserUtils.isIE(),f=n.showProjectSettings,m=n.docMenu&&n.docMenu.filter(e=>!e.tutorial),g=(null==(g=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:g.deviceIcon)||"usb",a=!a&&!s&&this.getData("github:user"),b=pxt.usb.isEnabled,a=n.selectLanguage||n.highContrast||p||a;return v.createElement(y.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},d&&v.createElement(y.Item,{className:"mobile only inherit",role:"menuitem",icon:"home",text:lf("Home"),ariaLabel:lf("Home screen"),onClick:this.showExitAndSaveDialog}),u&&v.createElement(y.Item,{className:"mobile only inherit",role:"menuitem",icon:"share alternate",text:lf("Share"),ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),(d||u)&&v.createElement("div",{className:"ui divider mobile only inherit"}),f?v.createElement(y.Item,{role:"menuitem",icon:"options",text:lf("Project Settings"),onClick:this.openSettings}):void 0,r?v.createElement(y.Item,{role:"menuitem",icon:"disk outline",text:lf("Extensions"),onClick:this.showPackageDialog}):void 0,b?v.createElement(y.Item,{role:"menuitem",icon:g,text:lf("Connect device"),onClick:this.pair}):void 0,pxt.webBluetooth.isAvailable()?v.createElement(y.Item,{role:"menuitem",icon:"bluetooth",text:lf("Pair Bluetooth"),onClick:this.pairBluetooth}):void 0,h?v.createElement(y.Item,{role:"menuitem",icon:"print",text:lf("Print..."),onClick:this.print}):void 0,l?v.createElement(y.Item,{role:"menuitem",icon:"save",text:lf("Save Project"),onClick:this.saveProject}):void 0,s?void 0:v.createElement(y.Item,{role:"menuitem",icon:"trash",text:lf("Delete Project"),onClick:this.removeProject}),c?v.createElement(y.Item,{role:"menuitem",icon:"toggle right",text:lf("Toggle the simulator"),onClick:this.toggleCollapse}):void 0,v.createElement("div",{className:"ui divider"}),n.selectLanguage?v.createElement(y.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,n.highContrast?v.createElement(y.Item,{role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,n.accessibleBlocks?v.createElement(y.Item,{role:"menuitem",text:i?lf("Accessible Blocks Off"):lf("Accessible Blocks On"),onClick:this.toggleAccessibleBlocks}):void 0,p?v.createElement(y.Item,{role:"menuitem",text:t?lf("Green Screen Off"):lf("Green Screen On"),onClick:this.toggleGreenScreen}):void 0,m&&k(this.props.parent,m,"setting-docs-item mobile only inherit"),a&&v.createElement("div",{className:"ui divider"}),o?v.createElement(y.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,s?void 0:v.createElement(y.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),v.createElement(y.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),n.feedbackUrl?v.createElement("a",{className:"ui item",href:n.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0)}}i.SettingsMenu=u;class p extends r.Component{constructor(e){super(e)}renderCore(){var e=this.props.isActive();return v.createElement(y.Item,{className:`base-menuitem ${this.props.className} `+(e?"selected":""),role:"option",textClass:"landscape only",text:this.props.text,icon:this.props.icon,active:e,onClick:this.props.onClick,title:this.props.title})}}class m extends r.Component{constructor(e){super(e),this.onClick=()=>{pxt.BrowserUtils.isWinRT()?a.showWinAppDeprecateAsync():(pxt.tickEvent("menu.javascript",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript())},this.isActive=()=>this.props.parent.isJavaScriptActive()}renderCore(){return v.createElement(p,{className:"javascript-menuitem",icon:"xicon js",text:"JavaScript",title:lf("Convert code to JavaScript"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class g extends r.Component{constructor(e){super(e),this.onClick=()=>{pxt.BrowserUtils.isWinRT()?a.showWinAppDeprecateAsync():(pxt.tickEvent("menu.python",void 0,{interactiveConsent:!0}),this.props.parent.openPython())},this.isActive=()=>this.props.parent.isPythonActive()}renderCore(){return v.createElement(p,{className:"python-menuitem",icon:"xicon python",text:"Python",title:lf("Convert code to Python"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class b extends r.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.blocks",void 0,{interactiveConsent:!0}),this.props.parent.openBlocks()},this.isActive=()=>this.props.parent.isBlocksActive()}renderCore(){return v.createElement(p,{className:"blocks-menuitem",icon:"xicon blocks",text:lf("Blocks"),title:lf("Convert code to Blocks"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class x extends r.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.simView",void 0,{interactiveConsent:!0}),this.props.parent.openSimView()},this.isActive=()=>this.props.parent.isEmbedSimActive()}renderCore(){var e=this.isActive(),t=this.props.parent.state.simState==pxt.editor.SimState.Running,i=t?lf("Stop the simulator"):lf("Start the simulator");return v.createElement(p,{className:"sim-menuitem",icon:e&&t?"stop":"play",text:lf("Simulator"),title:e?i:lf("Show Simulator"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class E extends r.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.assets",void 0,{interactiveConsent:!0}),this.props.parent.openAssets()},this.isActive=()=>this.props.parent.isAssetsActive()}renderCore(){return v.createElement(p,{className:"assets-menuitem",icon:"picture",text:lf("Assets"),title:lf("View project assets"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class h extends r.Component{constructor(e){super(e)}renderCore(){var{python:e,sandbox:t,headless:i,languageRestriction:n,parent:r}=this.props,o=e&&(r.isJavaScriptActive()||r.isPythonActive()),a="javascript-only"===n,s="python-only"===n,l="blocks-only"===n,c="no-javascript"===n,d="no-python"===n,n="no-blocks"===n,u=r.isPythonActive()||pxt.shell.isPyLangPref(),e=e&&!a&&!l&&!d,d=!(s||a||n||!f.mainEditorPkg().files[pxt.MAIN_BLOCKS]),n=!c&&!s&&!l,c=t&&!i,l=e&&n&&d,i=pxt.appTarget.appTheme.assetEditor&&!t;let p,h;return l?p=u?v.createElement(g,{parent:r}):v.createElement(m,{parent:r}):e&&n?(p=v.createElement(m,{parent:r}),h=v.createElement(g,{parent:r})):e?p=v.createElement(g,{parent:r}):n&&(p=v.createElement(m,{parent:r})),v.createElement("div",{id:"editortoggle",className:"ui grid padded "+(s||a?"one-language":""),role:"listbox","aria-orientation":"horizontal"},c&&v.createElement(x,{parent:r}),d&&v.createElement(b,{parent:r}),p,h,l&&v.createElement(y.DropdownMenu,{id:"editordropdown",role:"menuitem",icon:"chevron down",rightIcon:!0,title:lf("Select code editor language"),className:"item button attached right "+(o?"active":"")},v.createElement(m,{parent:r}),v.createElement(g,{parent:r})),i&&v.createElement(E,{parent:r}),v.createElement("div",{className:"ui item toggle "+(o?"dropdown-attached":"")}))}}i.EditorSelector=h;class C extends r.Component{constructor(e){super(e),this.openingSideDoc=!1,this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.popOut=this.popOut.bind(this)}rootDocsUrl(){return(pxt.webConfig.docsUrl||"/--docs")+"#"}static notify(e){var t=document.getElementById("sidedocsframe");t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")}setPath(e,t){this.openingSideDoc=!0;let i=this.rootDocsUrl();var t=t?"blocks":"js",n=pxt.BrowserUtils.isPxtElectron()?"?pxtElectron=true":"",n=(i=n&&i.endsWith("#")?i.substr(0,i.length-1)+n+"#":i)+`doc:${e}:${t}:`+pxt.Util.localeInfo();this.setUrl(n)}setMarkdown(e){e=`${this.rootDocsUrl()}md:${encodeURIComponent(e)}:blocks:`+pxt.Util.localeInfo();this.props.parent.setState({sideDocsLoadUrl:e})}setUrl(e){this.props.parent.setState({sideDocsLoadUrl:e,sideDocsCollapsed:!1})}expand(){this.props.parent.setState({sideDocsCollapsed:!1})}collapse(){this.props.parent.setState({sideDocsCollapsed:!0})}isCollapsed(){return!!this.state.sideDocsCollapsed}popOut(){C.notify({type:"popout"})}toggleVisibility(){var e=this.props.parent.state;this.props.parent.setState({sideDocsCollapsed:!e.sideDocsCollapsed}),document.getElementById("sidedocstoggle").focus()}componentDidUpdate(){this.props.parent.editor.resize();var e=document.getElementById("sidedocstoggle");this.openingSideDoc&&e&&(e.focus(),this.openingSideDoc=!1)}UNSAFE_componentWillReceiveProps(e){var t={};null!=e.sideDocsCollapsed&&(t.sideDocsCollapsed=e.sideDocsCollapsed),null!=e.docsUrl&&(t.docsUrl=e.docsUrl),0<Object.keys(t).length&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.sideDocsCollapsed!=t.sideDocsCollapsed||this.state.docsUrl!=t.docsUrl}renderCore(){var{sideDocsCollapsed:e,docsUrl:t}=this.state,i=pxt.Util.isUserLanguageRtl(),i=(e||i)&&!(e&&i),n=!!pxt.appTarget.appTheme.lockedEditor;return t?(t=e?this.rootDocsUrl():t,v.createElement("div",null,v.createElement("button",{id:"sidedocstoggle",role:"button","aria-label":e?lf("Expand the side documentation"):lf("Collapse the side documentation"),className:"ui icon button large",onClick:this.toggleVisibility},v.createElement(y.Icon,{icon:"icon inverted chevron "+(i?"left":"right")})),v.createElement("div",{id:"sidedocs"},v.createElement("div",{id:"sidedocsframe-wrapper"},v.createElement("iframe",{id:"sidedocsframe",src:t,title:lf("Documentation"),"aria-atomic":"true","aria-live":"assertive",sandbox:"allow-scripts allow-same-origin allow-forms "+(n?"":"allow-popups")})),!n&&v.createElement("div",{className:"ui app hide",id:"sidedocsbar"},v.createElement("a",{className:"ui icon link",role:"button",tabIndex:0,"data-content":lf("Open documentation in new tab"),"aria-label":lf("Open documentation in new tab"),onClick:this.popOut,onKeyDown:y.fireClickOnEnter},v.createElement(y.Icon,{icon:"external"})))))):null}}i.SideDocs=C;class _ extends r.PureComponent{constructor(e){super(e),this.state={},this.compile=this.compile.bind(this)}compile(){pxt.tickEvent("sandboxfooter.compile",void 0,{interactiveConsent:!0}),this.props.parent.compile()}renderCore(){var e=pxt.appTarget.appTheme,t=lf("Download your code to the {0}",e.boardName);return v.createElement("div",{className:"ui horizontal small divided link list sandboxfooter"},e.organizationUrl&&e.organization?v.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},e.organization):void 0,v.createElement("a",{target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")),v.createElement("a",{target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")),v.createElement("span",{className:"item"},v.createElement("a",{role:"button",className:"ui thin portrait only",title:t,onClick:this.compile},v.createElement(y.Icon,{icon:"icon "+(pxt.appTarget.appTheme.downloadIcon||"download")}),pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download"))))}}i.SandboxFooter=_},{"./auth":8,"./core":64,"./data":67,"./dialogs":74,"./package":108,"./sui":129,react:320}],64:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.apiAsync=i.handleNetworkError=i.findChild=i.navigateInWindow=i.keyCodeFromEvent=i.resetFocus=i.setLanguage=i.setHighContrast=i.toggleHighContrast=i.getHighContrastOnce=i.SPACE_KEY=i.ENTER_KEY=i.ESC_KEY=i.TAB_KEY=i.promptAsync=i.confirmDelete=i.confirmAsync=i.forceUpdate=i.hideDialog=i.dialogAsync=i.infoNotification=i.warningNotification=i.errorNotification=i.cancelAsyncLoading=i.showLoadingAsync=i.showLoading=i.killLoadingQueue=i.hideLoading=i.isLoading=void 0;const n=e("react"),r=e("react-dom"),o=e("./data"),a=e("./coretsx"),s=e("./auth");var l=pxt.Cloud;let c,d=!1,u=[],p={};function h(e){var t;pxt.debug("hideloading: "+e),pxt.perf.recordMilestone("loading done #"+e),null!=p[e]?(-1<(t=u.indexOf(e))&&u.splice(t,1),delete p[e]):pxt.debug("Loading not in queue, disregard: "+e),0<u.length?m():d&&c&&c.hide()}function f(e,t){var i;pxt.debug("showloading: "+e),p[e]||(pxt.perf.recordMilestone("loading started #"+e),d||(i=document.getElementById("content").appendChild(document.createElement("div")),c=r.render(n.createElement(a.LoadingDimmer,{}),i),d=!0),c.show(lf("Please wait")),u.push(e),p[e]=t,m())}function m(){var e;u.length&&(e=u[u.length-1],e=p[e],c.show(e))}i.isLoading=function(){return c&&c.isVisible()},i.hideLoading=h,i.killLoadingQueue=function(){u=[],p={},d&&c&&c.hide()},i.showLoading=f;let g={};function b(e){clearTimeout(g[e]),h(e)}function v(e,t){a.pushNotificationMessage({kind:e,text:t,hc:x()})}function y(e){pxt.log("warning: "+e),v("warn",e)}function w(e){return e.buttons||(e.buttons=[]),e.type||(e.type="dialog"),e.hasCloseIcon&&(e.hideCancel=!0),e.hideCancel||(e.buttons||(e.buttons=[]),e.buttons.push({label:e.disagreeLbl||lf("Cancel"),className:e.disagreeClass||"cancel",icon:e.disagreeIcon||"cancel"})),e.helpUrl&&(e.bigHelpButton?e.buttons.unshift({className:"dialog-help-large help",urlButton:!0,label:lf("Help"),title:lf("Help"),url:e.helpUrl}):e.buttons.unshift({className:"circular help",title:lf("Help"),icon:"help",url:e.helpUrl})),a.renderConfirmDialogAsync(e)}function k(e){e.type="confirm",e.buttons||(e.buttons=[]);let t=0;return e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{t=1}}),e.deleteLbl&&e.buttons.push({label:e.deleteLbl,className:"delete red",icon:"trash",onclick:()=>{t=2}}),w(e).then(()=>t)}function x(){return o.getData(s.HIGHCONTRAST)||!1}async function E(e){await s.setHighContrastPrefAsync(e)}i.showLoadingAsync=function(e,t,i,n=700){return clearTimeout(g[e]),g[e]=setTimeout(function(){f(e,t)},n),i.finally(()=>{b(e)})},i.cancelAsyncLoading=b,i.errorNotification=function(e){pxt.tickEvent("notification.error",{message:e}),v("err",e)},i.warningNotification=y,i.infoNotification=function(e){pxt.debug(e),v("info",e)},i.dialogAsync=w,i.hideDialog=function(){a.hideDialog()},i.forceUpdate=function(){a.forceUpdate()},i.confirmAsync=k,i.confirmDelete=function(e,t,i){k({header:i?lf("Would you like to delete {0} projects?",e):lf("Would you like to delete '{0}'?",e),body:lf("It will be deleted for good. No undo."),agreeLbl:lf("Delete"),agreeClass:"red",agreeIcon:"trash"}).then(e=>{e&&t()})},i.promptAsync=function(e){e.type="prompt",e.buttons||(e.buttons=[]);let t=e.initialValue||"",i=!1;return e.onInputChanged=e=>{t=e},e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{i=!0}}),w(e).then(()=>i?t:null)},i.TAB_KEY=9,i.ESC_KEY=27,i.ENTER_KEY=13,i.SPACE_KEY=32,i.getHighContrastOnce=x,i.toggleHighContrast=function(){E(!x())},i.setHighContrast=E,i.setLanguage=async function(e){pxt.BrowserUtils.setCookieLang(e),await s.setLangaugePrefAsync(e)},i.resetFocus=function(){var e=document.getElementById("content");e.tabIndex=0,e.focus(),e.blur(),e.tabIndex=-1},i.keyCodeFromEvent=function(e){return"number"==typeof e.which?e.which:e.keyCode},i.navigateInWindow=function(e){window.location.href=e},i.findChild=function(e,t){e=r.findDOMNode(e);return t?pxt.Util.toArray(e.querySelectorAll(t)):[e]},i.handleNetworkError=function(e,t){var i=parseInt(e.statusCode);if(e.isOffline||0===i)y(lf("Network request failed; you appear to be offline"));else if(!isNaN(i)&&200!==i){if(t&&-1!==t.indexOf(i))return e;y(lf("Network request failed"))}throw e},i.apiAsync=function(t,e){return(e?l.privatePostAsync(t,e):l.privateGetAsync(t)).then(e=>(console.log("*"),console.log("*******",t,"---\x3e"),console.log("*"),console.log(e),console.log("*"),e),e=>{console.log(e.message)})}},{"./auth":8,"./coretsx":65,"./data":67,react:320,"react-dom":276}],65:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.pushNotificationMessage=i.NotificationMessages=i.LoadingDimmer=i.hideDialog=i.renderConfirmDialogAsync=i.forceUpdate=i.dialogIsShowing=i.CoreDialog=void 0;const c=e("react"),n=e("react-dom"),d=e("./sui"),r=e("./core");class o extends c.Component{constructor(e){super(e),this.state={inputValue:e.initialValue,inputError:void 0,confirmationGranted:!e.confirmationText&&!e.confirmationCheckbox&&void 0},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleConfirmationTextChange=this.handleConfirmationTextChange.bind(this),this.handleConfirmationCheckboxChange=this.handleConfirmationCheckboxChange.bind(this)}hide(){this.close()}close(e){this.setState({visible:!1}),this.resolve(e)}componentDidMount(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}modalDidOpen(t){const e=this.props,i=this.refs.promptInput;if(i){i.setSelectionRange(0,9999);const t=this;i.onkeydown=e=>{r.keyCodeFromEvent(e)===r.ENTER_KEY&&t.okButton&&i.value&&(t.okButton.onclick(),e.preventDefault())}}e.onLoaded&&e.onLoaded(t)}handleInputChange(e){var t=this.props;let i;t.onInputChanged&&t.onInputChanged(e.target.value),t.onInputValidation&&(i=t.onInputValidation(e.target.value)),this.setState({inputValue:e.target.value,inputError:i})}handleConfirmationTextChange(e){this.setState({confirmationText:e,confirmationGranted:this.state.confirmationText===this.props.confirmationText})}handleConfirmationCheckboxChange(e){this.setState({confirmationGranted:e})}render(){var e,t=this.props,{inputValue:i,inputError:n}=this.state,r=void 0===t.size?"small":t.size,o=t.hasCloseIcon||!t.hideCancel,a=t.buttons?t.buttons.filter(e=>!!e):[],s=(a.forEach(e=>{const t=e.onclick;e.onclick=()=>{this.close(t?t():0)},e.className||(e.className="approve positive"),e.approveButton&&(this.okButton=e)}),"prompt"==t.type&&this.okButton&&(this.okButton.disabled=!i||!!n),d.cx(["coredialog",t.className])),l=pxt.BrowserUtils.isMobile();return null!=(e=t.buttons)&&e.forEach(e=>{var t;e.approveButton&&void 0!==this.state.confirmationGranted&&(t=" disabled",this.state.confirmationGranted?e.className=e.className.replace(t,""):e.className+=0<=e.className.indexOf(t)?"":t)}),c.createElement(d.Modal,{isOpen:!0,ref:"modal",className:s,onClose:this.hide,size:r,defaultOpen:!0,buttons:a,dimmer:!0,closeIcon:t.hasCloseIcon,header:t.header,headerIcon:t.headerIcon,closeOnDimmerClick:o,closeOnDocumentClick:o,closeOnEscape:o,modalDidOpen:this.modalDidOpen},"prompt"==t.type&&c.createElement("div",{className:"ui"},c.createElement("div",{className:"ui fluid icon input"},c.createElement("input",{autoFocus:!0,className:"ui input "+(n?"error":""),type:"text",ref:"promptInput",onChange:this.handleInputChange,value:i,placeholder:t.placeholder,"aria-label":t.placeholder})),!!n&&c.createElement("div",{className:"ui error message"},n)),t.jsx,!!t.jsxd&&t.jsxd(),!!t.body&&c.createElement("p",null,t.body),!!t.copyable&&c.createElement(d.Input,{copy:!0,readOnly:!0,value:t.copyable,selectOnClick:!0,autoComplete:!1}),!!t.confirmationText&&c.createElement(c.Fragment,null,c.createElement("p",null,"Type '",t.confirmationText,"' to confirm:"),c.createElement(d.Input,{ref:"confirmationInput",id:"confirmationInput",ariaLabel:lf("Type your name to confirm"),autoComplete:!1,value:this.state.confirmationText||"",onChange:this.handleConfirmationTextChange,selectOnMount:!l,autoFocus:!l})),!!t.confirmationCheckbox&&c.createElement(d.PlainCheckbox,{label:t.confirmationCheckbox,isChecked:this.state.confirmationGranted,onChange:this.handleConfirmationCheckboxChange}))}}let a;i.CoreDialog=o,i.dialogIsShowing=function(){return!!a},i.forceUpdate=function(){a&&a.forceUpdate()},i.renderConfirmDialogAsync=function(i){return pxt.Util.delay(10).then(()=>{const e=document.body.appendChild(document.createElement("div")),t=n.render(c.createElement(o,i),e);return(a=t).promise.finally(()=>{n.unmountComponentAtNode(e),setTimeout(()=>{e.parentElement.removeChild(e),t===a&&(a=void 0)})})})},i.hideDialog=function(){a&&(a.hide(),a=void 0)};class s extends c.Component{constructor(e){super(e),this.state={visible:!0}}hide(){this.setState({visible:!1,content:void 0})}show(e){this.setState({visible:!0,content:e})}isVisible(){return this.state.visible}render(){var{visible:e,content:t}=this.state;return e?c.createElement(d.Dimmer,{isOpen:!0,active:e,closable:!1},c.createElement(d.Loader,{className:"large main msg no-select","aria-live":"assertive"},t)):c.createElement("div",null)}}i.LoadingDimmer=s;class l extends c.Component{constructor(e){super(e),this.state={notifications:{}}}push(t){const i=this.state.notifications,e=ts.pxtc.Util.guidGen(),n=(Object.keys(i).filter(e=>i[e].kind==t.kind).forEach(e=>this.remove(e)),i[e]=t,this);setTimeout(()=>{n.remove(e)},3e3),this.setState({notifications:i})}remove(e){var t=this.state.notifications;t[e]&&(delete t[e],this.setState({notifications:t}))}render(){const o=this.state["notifications"];return c.createElement("div",{id:"msg","aria-live":"polite"},Object.keys(o).map(t=>{{var i=t,{kind:t,text:n,hc:r}=o[t];let e="ignored info message";switch(t){case"err":e="red inverted segment";break;case"warn":e="orange inverted segment";break;case"info":e="teal inverted segment";break;case"compile":e="ignored info message"}return c.createElement("div",{key:""+i,id:t+"msg",className:`ui ${r} `+e},n)}}))}}i.NotificationMessages=l;let u,p=!1;i.pushNotificationMessage=function(e){var t;p?u&&u.push(e):(p=!0,t=document.body.appendChild(document.createElement("div")),(u=n.render(c.createElement(l,e),t)).push(e))}},{"./core":64,"./sui":129,react:320,"react-dom":276}],66:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CreateFunctionDialog=void 0;const r=e("react"),n=e("./data"),o=e("./sui");class a extends n.Component{constructor(e){super(e),this.state={visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this)}hide(){pxt.BrowserUtils.removeClass(Blockly.WidgetDiv.DIV,"functioneditor");var{functionEditorWorkspace:e,mainWorkspace:t}=this.state;e.clear(),e.dispose(),t.refreshToolboxSelection(),this.setState({visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null})}show(e,t,i){pxt.tickEvent("createfunction.show",null,{interactiveConsent:!1}),this.setState({visible:!0,functionCallback:t,initialMutation:e,mainWorkspace:i})}modalDidOpen(e){var t=document.getElementById("functionEditorWorkspace"),{functionEditorWorkspace:i,initialMutation:n}=this.state;t&&(pxt.BrowserUtils.addClass(Blockly.WidgetDiv.DIV,"functioneditor"),(i=Blockly.inject(t,{trashcan:!1,move:{scrollbars:!0},renderer:"pxt"})).showContextMenu_=()=>{},i.clear(),(t=i.newBlock("function_declaration")).domToMutation(n),t.initSvg(),t.render(!1),i.centerOnBlock(t.id),i.addChangeListener(()=>{var e=this.state["functionBeingEdited"];e&&e.updateFunctionSignature()}),this.setState({functionEditorWorkspace:i,functionBeingEdited:t}),Blockly.svgResize(i))}cancel(){pxt.tickEvent("createfunction.cancel",void 0,{interactiveConsent:!0}),this.hide()}confirm(){Blockly.hideChaff();var{functionBeingEdited:e,mainWorkspace:t,functionCallback:i}=this.state,e=e.mutationToDom();Blockly.Functions.validateFunctionExternal(e,t)&&(i(e),this.hide())}addArgumentFactory(e){return()=>this.addArgument(e)}addArgument(e){var t=this.state["functionBeingEdited"];switch(e){case"boolean":t.addBooleanExternal();break;case"string":t.addStringExternal();break;case"number":t.addNumberExternal();break;case"Array":t.addArrayExternal();break;default:t.addCustomExternal(e)}}renderCore(){var e=this.state["visible"],t=[{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}],i=this.getArgumentTypes().slice(),n=this.props.parent.createModalClasses("createfunction");return r.createElement(o.Modal,{isOpen:e,className:n,size:"large",closeOnEscape:!1,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:t,header:lf("Edit Function"),modalDidOpen:this.modalDidOpen,onClose:this.hide},r.createElement("div",null,r.createElement("span",{className:"ui text mobile only paramlabel"},lf("Add a parameter")),r.createElement("div",{className:"horizontal list"},r.createElement("span",{className:"ui text mobile hide paramlabel"},lf("Add a parameter")),i.map(e=>r.createElement(o.Button,{key:e.typeName,role:"button",className:"icon",icon:e.icon,textClass:"mobile hide",text:e.label||e.typeName,ariaLabel:lf("Add {0} parameter",e.label||e.typeName),onClick:this.addArgumentFactory(e.typeName)}))),r.createElement("div",{id:"functionEditorWorkspace"})))}getArgumentTypes(){if(!a.cachedFunctionTypes){const t=[{label:lf("Text"),typeName:"string",icon:pxt.blocks.defaultIconForArgType("string")},{label:lf("Boolean"),typeName:"boolean",icon:pxt.blocks.defaultIconForArgType("boolean")},{label:lf("Number"),typeName:"number",icon:pxt.blocks.defaultIconForArgType("number")},{label:lf("Array"),typeName:"Array",icon:pxt.blocks.defaultIconForArgType("Array")}];pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes&&Array.isArray(pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes)&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes.forEach(e=>{t.push(Object.assign(Object.assign({},e),{label:e.label&&pxt.Util.rlf("{id:type}"+e.label),defaultName:e.defaultName&&pxt.Util.rlf("{id:var}"+e.defaultName)}))}),t.forEach(e=>{e.icon||(e.icon=pxt.blocks.defaultIconForArgType())}),a.cachedFunctionTypes=t}return a.cachedFunctionTypes}}(i.CreateFunctionDialog=a).cachedFunctionTypes=null},{"./data":67,"./sui":129,react:320}],67:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PureComponent=i.Component=i.invalidateHeader=i.getDataWithStatus=i.getData=i.getAsync=i.invalidate=i.stripProtocol=i.mountVirtualApi=i.getCached=i.loadCache=i.clearCache=i.unsubscribe=i.subscribe=i.FetchStatus=void 0;const n=e("react"),r=e("./core");var o,a=pxt.Cloud,s=pxt.Util;(e=o=i.FetchStatus||(i.FetchStatus={}))[e.Pending=0]="Pending",e[e.Complete=1]="Complete",e[e.Error=2]="Error",e[e.Offline=3]="Offline";const l={};let c,d={};function u(e,t){var t=v(t),i=t.components;i.indexOf(e)<0&&(i.push(e),e.subscriptions.push(t))}function p(i){var e=i.subscriptions;0!=e.length&&(i.subscriptions=[],e.forEach(e=>{var t=e.components.indexOf(i);0<=t&&e.components.splice(t,1)}))}function h(e){return e.api.expirationTime?null==e.data||Date.now()-e.lastRefresh>e.api.expirationTime(e.path):!e.lastRefresh}function f(e){return!(!e.data||e.data instanceof Error)&&/^cloud:(me\/settings|ptr-pkg-)/.test(e.path)}function m(){JSON.parse(pxt.storage.getLocal("apiCache2")||"[]").forEach(e=>{v(e.path).data=e.data})}function g(){var e=s.values(d).filter(e=>f(e)).map(e=>({path:e.path,data:e.data}));pxt.storage.setLocal("apiCache2",JSON.stringify(e))}function b(n,r){var e;n.queued||n.api.isOffline&&n.api.isOffline()||(n.queued=!0,e=t=>{n.data=t,n.lastRefresh=pxt.Util.now(),n.queued=!1;{var i=r;f(t=n)&&g();let e=t.callbackOnce;0<e.length&&(t.callbackOnce=[],s.nextTick(()=>e.forEach(e=>e()))),0<t.components.length&&t.components.forEach(e=>s.nextTick(()=>e.onDataChanged(i)))}},n.api.isSync?e(n.api.getSync(n.path)):n.api.getAsync(n.path).then(e))}function v(e){return d.hasOwnProperty(e)||(d[e]={path:e,data:null,lastRefresh:0,queued:!1,callbackOnce:[],components:[],api:((i=/^([\w\-]+):/.exec(t=e))&&l[i[1]]||s.oops("bad data protocol: "+t),l[i[1]])}),d[e];var t,i}function y(e,t){return u(e,t),E(t)}function w(e,t){s.assert(!l[e]),s.assert(!!t.getSync||!!t.getAsync),s.assert(!!t.getSync!=!!t.getAsync),t.isSync=!!t.getSync,l[e]=t}function k(e){var t=/^([\w\-]+):(.*)/.exec(e);return t?t[2]:(s.oops("protocol missing in: "+e),e)}function x(n){const r=n.replace(/:\*$/,":");s.values(d).forEach(e=>{var t,i;t=e,i=r,(t.path.slice(0,i.length)==i||(t.path.endsWith(":*")?([t]=t.path.split(":"),[i]=i.split(":"),t==i):void 0))&&((e.lastRefresh=0)<e.components.length&&b(v(e.path),n),e.api.onInvalidated)&&e.api.onInvalidated(n)})}function E(e){var t,i=v(e);return i.api.isSync?{data:i.api.getSync(i.path),status:o.Complete}:(t={data:i.data,status:o.Complete},(h(i)||i.data instanceof Error)&&(t.status=i.data instanceof Error?o.Error:o.Pending,i.api.isOffline&&i.api.isOffline()?t.status=o.Offline:b(i,e)),t)}i.subscribe=u,i.unsubscribe=p,i.clearCache=function(){d={},g()},i.loadCache=m,i.getCached=y,i.mountVirtualApi=w,i.stripProtocol=k,i.invalidate=x,i.getAsync=function(i){let n=v(i);return n.api.isSync?Promise.resolve(n.api.getSync(n.path)):a.isOnline()&&h(n)?new Promise((e,t)=>{n.callbackOnce.push(()=>{e(n.data)}),b(n,i)}):Promise.resolve(n.data)},i.getData=function(e){return E(e).data},i.getDataWithStatus=E,w("cloud",{getAsync:e=>a.privateGetAsync(k(e)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),w("cloud-search",{getAsync:e=>a.privateGetAsync(k(e)).catch(e=>(r.handleNetworkError(e,[404]),{statusCode:404,headers:{},json:{}})),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),w("gallery",{getAsync:e=>pxt.gallery.loadGalleryAsync(k(decodeURIComponent(e))).catch(e=>Promise.resolve(e)),expirationTime:e=>36e5}),w("gh-search",{getAsync:t=>pxt.targetConfigAsync().then(e=>pxt.github.searchAsync(k(t),e?e.packages:void 0)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),w("gh-pkgcfg",{getAsync:e=>pxt.github.pkgConfigAsync(k(e)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),w("gh-commits",{getAsync:e=>{var[e,t]=k(e).split("#",2);return pxt.github.getCommitsAsync(e,t).catch(e=>(r.handleNetworkError(e),[]))},expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),w("target-config",{getAsync:e=>{c=c||pxt.targetConfigAsync().then(e=>(e&&(pxt.storage.setLocal("targetconfig",JSON.stringify(e)),x("target-config"),x("gh-search"),x("gh-pkgcfg")),e)).catch(r.handleNetworkError);var t=JSON.parse(pxt.storage.getLocal("targetconfig")||"null");return t?Promise.resolve(t):c},expirationTime:e=>864e5,isOffline:()=>!a.isOnline()}),i.invalidateHeader=function(e,t){t&&x(e+":"+t.id)};class C extends n.Component{constructor(e){super(e),this.subscriptions=[],this.renderCoreOk=!1,this.state={}}getData(e){return this.getDataWithStatus(e).data}getDataWithStatus(e){return this.renderCoreOk||s.oops("Override renderCore() not render()"),y(this,e)}onDataChanged(){this.forceUpdate()}componentWillUnmount(){p(this)}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return p(this),this.renderCoreOk=!0,this.renderCore()}setStateAsync(i){return new Promise((e,t)=>{this.setState(i,()=>{e()})})}}i.Component=C;class _ extends n.PureComponent{constructor(e){super(e),this.renderCoreOk=!1,this.state={}}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return this.renderCoreOk=!0,this.renderCore()}}i.PureComponent=_,m()},{"./core":64,react:320}],68:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Table=i.destroyAsync=i.getDbAsync=void 0;const n=e("pouchdb").plugin(e("pouchdb-adapter-memory"));let r;function o(){return r=r||Promise.resolve().then(()=>{var e=new n("pxt-"+pxt.storage.storageId(),{revs_limit:2});return pxt.log("PouchDB adapter: "+e.adapter),e})}i.getDbAsync=o,i.destroyAsync=function(){return r?r.then(e=>{e.destroy(),r=void 0}):Promise.resolve()};class a{constructor(e){this.name=e}getAsync(t){return o().then(e=>e.get(this.name+"--"+t)).then(e=>(e.id=t,e))}getAllAsync(){return o().then(e=>e.allDocs({include_docs:!0,startkey:this.name+"--",endkey:this.name+"--￿"})).then(e=>e.rows.map(e=>e.doc))}deleteAsync(t){return o().then(e=>e.remove(t))}forceSetAsync(t){return this.getAsync(t.id).then(e=>(t._rev=e._rev,this.setAsync(t)),e=>this.setAsync(t))}setAsync(t){return this.setAsyncNoRetry(t).then(e=>(pxt.BrowserUtils.scheduleStorageCleanup(),e)).catch(e=>{if(409!=e.status)return pxt.reportException(e),pxt.log("table: set failed, cleaning translation db"),pxt.BrowserUtils.clearTranslationDbAsync().then(()=>pxt.BrowserUtils.clearTutorialInfoDbAsync()).then(()=>this.setAsyncNoRetry(t)).catch(e=>{throw pxt.log("table: we are out of space..."),e});pxt.debug("table: set conflict (409)")})}setAsyncNoRetry(t){return t.id&&!t._id&&(t._id=this.name+"--"+t.id),o().then(e=>e.put(t)).then(e=>e.rev)}}i.Table=a,pxt.github.db=new class{constructor(){this.mem=new pxt.github.MemoryGithubDb,this.table=new a("github")}loadConfigAsync(t,i){if("master"==i)return this.mem.loadConfigAsync(t,i);const n=`config-${t}-`+i;return this.table.getAsync(n).then(e=>(pxt.debug("github offline cache hit "+n),e.config),e=>(pxt.debug("github offline cache miss "+n),this.mem.loadConfigAsync(t,i).then(t=>this.table.forceSetAsync({id:n,config:t}).then(()=>t,e=>t))))}loadPackageAsync(t,i){if("master"==(i=i||"master"))return this.mem.loadPackageAsync(t,i);const n=`pkg-${t}-`+i;return this.table.getAsync(n).then(e=>(pxt.debug("github offline cache hit "+n),e.package),e=>(pxt.debug("github offline cache miss "+n),this.mem.loadPackageAsync(t,i).then(t=>this.table.forceSetAsync({id:n,package:t}).then(()=>t,e=>t))))}}},{pouchdb:263,"pouchdb-adapter-memory":249}],69:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerCallStack=void 0;const r=e("react"),o=e("./debuggerTable");class n extends r.Component{constructor(e){super(e),this.handleRowClick=(e,t)=>{var i,n;this.props.openLocation&&([t,i]=t.props.refID.split("_").map(e=>parseInt(e)),n=this.props.stackframes[i])&&n.breakpointId===t&&this.props.openLocation(n.breakpointId,i)}}render(){return r.createElement(o.DebuggerTable,{header:lf("Call Stack")},this.props.stackframes.map((e,t)=>{if(!e.breakpointId)return null;var i=e.breakpointId+"_"+t;let n=e.funcInfo.fileName;return 0===n.indexOf("pxt_modules/")&&(n=n.slice(12)),r.createElement(o.DebuggerTableRow,{key:i,refID:i,onClick:this.handleRowClick,leftText:e.funcInfo.functionName,rightText:n+":"+e.funcInfo.line,icon:t===this.props.activeFrame?"arrow right":void 0,rowClass:"callstack-row"})}))}}i.DebuggerCallStack=n},{"./debuggerTable":70,react:320}],70:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerTableRow=i.DebuggerTable=void 0;const n=e("react");class r extends n.Component{render(){return n.createElement("div",{className:"ui varExplorer"},n.createElement("div",{className:"ui variableTableHeader"},this.props.header),this.props.placeholderText&&n.createElement("div",{className:"ui variableTablePlaceholder"},this.props.placeholderText),n.createElement("div",{className:"ui segment debugvariables collapsing basic striped table"},this.props.children))}}i.DebuggerTable=r;class o extends n.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onClick&&this.props.onClick(e,this)},this.valueClickHandler=e=>{this.props.onValueClick&&this.props.onValueClick(e,this)}}render(){return n.createElement("div",{role:"listitem",className:"item "+(this.props.rowClass||""),onClick:this.props.onClick?this.clickHandler:void 0,"aria-describedby":this.props.describedBy},n.createElement("div",{className:"variableAndValue"},n.createElement("div",{className:"variable varname "+(this.props.leftClass||""),title:this.props.leftTitle,style:this.props.depth?{marginLeft:.75*this.props.depth+"em"}:void 0},n.createElement("i",{className:"ui icon small "+(this.props.icon||"invisible")}),n.createElement("span",null,this.props.leftText)),n.createElement("div",{className:"variable detail",role:"button",style:{padding:.2},title:this.props.rightTitle,onClick:this.valueClickHandler},n.createElement("span",{className:"varval "+(this.props.rightClass||"")},this.props.rightText))))}}i.DebuggerTableRow=o},{react:320}],71:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerToolbar=void 0;const p=e("react"),n=e("react-dom"),h=e("./sui"),r=e("./data"),f=e("./simulator");class o extends r.Component{constructor(e){super(e),this.state={},this.restartSimulator=this.restartSimulator.bind(this),this.dbgPauseResume=this.dbgPauseResume.bind(this),this.dbgStepOver=this.dbgStepOver.bind(this),this.dbgStepInto=this.dbgStepInto.bind(this),this.dbgStepOut=this.dbgStepOut.bind(this),this.exitDebugging=this.exitDebugging.bind(this),this.toggleTrace=this.toggleTrace.bind(this)}restartSimulator(){pxt.tickEvent("debugger.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}exitDebugging(){pxt.tickEvent("debugger.exit",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}dbgPauseResume(){pxt.tickEvent("debugger.pauseresume",void 0,{interactiveConsent:!0}),this.props.parent.dbgPauseResume()}dbgStepOver(){pxt.tickEvent("debugger.stepover",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepOver()}dbgStepInto(){pxt.tickEvent("debugger.stepinto",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepInto()}dbgStepOut(){pxt.tickEvent("debugger.stepout",void 0,{interactiveConsent:!0}),f.dbgStepOut()}toggleTrace(){pxt.tickEvent("simulator.trace",void 0,{interactiveConsent:!0}),this.props.parent.toggleTrace()}getMenuDom(){var e=n.findDOMNode(this);return e&&e.firstElementChild}renderCore(){var e,t,i,n,r,o,a,s,l,c=this.props.parent.state,d=c.simState,u=d==pxt.editor.SimState.Running,d=d==pxt.editor.SimState.Starting,c=c.debugging;return c&&(e=f.driver&&f.driver.state==pxsim.SimulatorState.Running,(t=!this.props.parent.isBlocksActive())||this.props.parent.isBlocksActive()||pxt.appTarget.appTheme.debugExtensionCode)?(i=(d=e||d)?"disabled":"",n=lf("Restart debugging"),u=u?lf("Pause execution"):lf("Continue execution"),r=lf("Step into"),o=lf("Step over"),a=lf("Step out"),l=(s=this.props.parent.state.tracing)?lf("Disable Slow-Mo"):lf("Slow-Mo"),c?t?p.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},c?p.createElement("div",{className:"ui compact borderless menu icon"},p.createElement(h.Item,{key:"dbgpauseresume",className:`dbg-btn dbg-pause-resume ${i} `+(e?"pause":"play"),icon:e?"pause blue":"play green",title:u,onClick:this.dbgPauseResume}),p.createElement(h.Item,{key:"dbgstepover",className:"dbg-btn dbg-step-over "+i,icon:"xicon stepover "+(e?"disabled":"blue"),title:o,onClick:this.dbgStepOver}),p.createElement(h.Item,{key:"dbgstepinto",className:"dbg-btn dbg-step-into "+i,icon:"xicon stepinto "+(e?"disabled":""),title:r,onClick:this.dbgStepInto}),p.createElement(h.Item,{key:"dbgstepout",className:"dbg-btn dbg-step-out "+i,icon:"xicon stepout "+(e?"disabled":""),title:a,onClick:this.dbgStepOut}),p.createElement(h.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart right",icon:"refresh green",title:n,onClick:this.restartSimulator}),p.createElement(h.Item,{key:"dbgslowmo",className:"dbg-btn dbg-trace "+(s?"tracing":""),icon:"xicon turtle",title:l,onClick:this.toggleTrace})):void 0):p.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},p.createElement("div",{className:"ui compact borderless menu icon"},p.createElement(h.Item,{key:"dbgstep",className:"dbg-btn dbg-step separator-after "+i,icon:"arrow right "+(d?"disabled":"blue"),title:r,onClick:this.dbgStepInto,text:"Step"}),p.createElement(h.Item,{key:"dbgpauseresume",className:"dbg-btn dbg-pause-resume "+(e?"pause":"play"),icon:e?"pause blue":"play green",title:u,onClick:this.dbgPauseResume}),p.createElement(h.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart",icon:"refresh green",title:n,onClick:this.restartSimulator}),p.createElement(h.Item,{key:"dbgslowmo",className:"dbg-btn dbg-trace "+(s?"tracing":""),icon:"xicon turtle",title:l,onClick:this.toggleTrace}))):p.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")})):p.createElement("div",null)}}i.DebuggerToolbar=o},{"./data":67,"./simulator":121,"./sui":129,react:320,"react-dom":276}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerToolbox=void 0;const n=e("react"),r=e("./debuggerCallStack"),o=e("./debuggerVariables"),a=e("./debuggerToolbar");class s extends n.Component{constructor(e){super(e),this.state={sequence:0,currentFrame:0}}setBreakpoint(e,t){this.setState({lastBreakpoint:e,currentFrame:0,sequence:this.state.sequence+1,varFilters:t||this.state.varFilters})}render(){return n.createElement("div",null,n.createElement(a.DebuggerToolbar,{parent:this.props.parent}),n.createElement(o.DebuggerVariables,{apis:this.props.apis,breakpoint:this.state.lastBreakpoint,filters:this.state.varFilters,activeFrame:this.state.currentFrame,sequence:this.state.sequence}),this.props.showCallStack&&n.createElement(r.DebuggerCallStack,{openLocation:this.props.openLocation,activeFrame:this.state.currentFrame,stackframes:this.state.lastBreakpoint?this.state.lastBreakpoint.stackframes:[]}))}}i.DebuggerToolbox=s},{"./debuggerCallStack":69,"./debuggerToolbar":71,"./debuggerVariables":73,react:320}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerVariables=void 0;const c=e("react"),n=e("./data"),o=e("./simulator"),d=e("./debuggerTable");class r extends n.Component{constructor(e){super(e),this.handleComponentClick=(e,t)=>{this.state.frozen||(t=this.getVariableById(t.props.refID))&&(this.toggle(t),null!==this.state.preview)&&this.setState({preview:null})},this.handleValueClick=(e,t)=>{this.state.frozen||(t=t.props.refID,e=e.target.getBoundingClientRect(),this.setState({preview:{id:t,top:e.top,left:e.left}}))},this.handlePreviewRef=e=>{if(e){const n=this.state.preview;e.focus(),e.addEventListener("blur",()=>{var e;(null==(e=this.state.preview)?void 0:e.id)===n.id&&this.setState({preview:null})});var t=window.getSelection(),i=(t.removeAllRanges(),document.createRange());i.selectNodeContents(e),t.addRange(i)}},this.state={globalFrame:{title:lf("Globals"),variables:[]},stackFrames:[],nextID:0,preview:null}}clear(){this.setState({globalFrame:{title:this.state.globalFrame.title,variables:[]},stackFrames:[],preview:null})}update(e=!1){this.setState({frozen:e,preview:e?null:this.state.preview})}componentDidUpdate(e){this.props.breakpoint?this.props.sequence!=this.state.renderedSequence&&this.updateVariables(this.props.breakpoint,this.props.filters):this.state.frozen||this.update(!0)}renderCore(){var{globalFrame:e,stackFrames:t,frozen:i,preview:n}=this.state,{activeFrame:r,breakpoint:o}=this.props,a=lf("Variables");let s,l=e.variables;t&&t.length&&void 0!==r&&(l=t[r].variables.concat(l)),i?s=lf("Code is running..."):l.length||null!=o&&o.exceptionMessage||(s=lf("No variables to show"));e=s?[]:this.renderVars(l),null!=o&&o.exceptionMessage&&!i&&e.unshift(c.createElement(d.DebuggerTableRow,{leftText:lf("Exception:"),leftClass:"exception",key:"exception-message",rightText:h(o.exceptionMessage),rightTitle:o.exceptionMessage})),t=this.getVariableById(null==n?void 0:n.id),r=t&&lf("Current value for '{0}'",t.name);return c.createElement("div",null,c.createElement(d.DebuggerTable,{header:a,placeholderText:s},e),n&&c.createElement("div",{id:"debugger-preview",role:"tooltip",className:"debugger-preview",ref:this.handlePreviewRef,tabIndex:0,"aria-label":r,style:{top:n.top+"px",left:n.left+"px"}},p(t.value)))}renderVars(e,n=0,r=[]){var t;const o=null==(t=this.state.preview)?void 0:t.id;return e.forEach(i=>{var e=p(i.value),t=function(){var e=i.value;if(null==e)return"undefined";var t=typeof e;switch(t){case"string":case"number":case"boolean":return t;case"object":return e.type||e.preview||e.text||"object";default:return"unknown"}}();r.push(c.createElement(d.DebuggerTableRow,{key:i.id,describedBy:i.id===o?"debugger-preview":void 0,refID:i.id,icon:i.value&&i.value.hasFields?i.children?"down triangle":"right triangle":void 0,leftText:i.name+":",leftTitle:i.name,leftClass:void 0!==i.prevValue?"changed":void 0,rightText:h(e),rightTitle:function(e){switch(e){case"string":case"number":case"boolean":case"array":return 1;default:return}}(t)?e:void 0,rightClass:t,onClick:this.handleComponentClick,onValueClick:this.handleValueClick,depth:n})),i.children&&this.renderVars(i.children,n+1,r)}),r}updateVariables(n,i){var{globals:n,environmentGlobals:r,stackframes:o}=n;if(n||r){let t=0;n=u(this.state.globalFrame,n);let e;if(i&&(n.variables=n.variables.filter(e=>-1!==i.indexOf(e.name))),r&&(n.variables=n.variables.concat(l(r))),s(n.variables),o){const n=this.state.stackFrames;(e=o.map((e,t)=>{var i=e.breakpointId+"_"+t;for(const t of n)if(t.key===i)return u(t,e.locals,a(e.arguments));return u({key:i,title:e.funcInfo.functionName,variables:[]},e.locals,a(e.arguments))})).forEach(e=>s(e.variables))}function a(e){return e?null!=e.thisParam?[{name:"this",value:e.thisParam},...e.params]:e.params:[]}function s(e){e.forEach(e=>{e.id=t++,e.children&&s(e.children)})}this.setState({globalFrame:n,stackFrames:e||[],nextID:t,renderedSequence:this.props.sequence,frozen:!1})}else this.update(!0)}getVariableById(e){if(null!==e)for(const t of this.getFullVariableList())if(t.id===e)return t;return null}getFullVariableList(){let t=[];return i(this.state.globalFrame.variables),this.state.stackFrames&&this.state.stackFrames.forEach(e=>i(e.variables)),t;function i(e){e.forEach(e=>{t.push(e),e.children&&i(e.children)})}}toggle(r){if(r.children)delete r.children,this.setState({globalFrame:this.state.globalFrame});else if(r.value&&r.value.id){let i=this.props.apis,t=new RegExp("^((.+.)?"+r.value.type+")."),e=Object.keys(i).filter(e=>t.test(e)),n=[];e.forEach(e=>{var t=i[e];!e.endsWith("@set")&&t&&t.attributes.callInDebugger&&n.push(e)}),o.driver.variablesAsync(r.value.id,n).then(i=>{if(i&&i.variables){let t=this.state.nextID;r.children=Object.keys(i.variables).map(e=>({name:e,value:i.variables[e],id:t++})),this.setState({globalFrame:this.state.globalFrame,nextID:t})}})}}}function l(t){return Object.keys(t).map(e=>({name:e.replace(/___\d+$/,""),value:t[e]}))}function u(e,t,i){let n=l(t);return i&&(n=i.concat(n)),Object.assign(Object.assign({},e),{variables:(r=e.variables,n.map(e=>{var t=function(t,i){for(let e=0;e<t.length;e++)if(t[e].name===i.name)return t[e]}(r,e);return t&&t.value&&!t.value.id&&t.value!==e.value?Object.assign(Object.assign({},e),{prevValue:t.value}):e}))});var r}function p(e){let t="";switch(typeof e){case"undefined":t="undefined";break;case"number":case"boolean":t=e+"";break;case"string":t=JSON.stringify(e);break;case"object":if(null==e)t="null";else if(e.text)t=e.text;else{if(e.id&&e.preview)return e.preview;t=void 0!==e.id?"(object)":"(unknown)"}}return t}function h(e){let t=17,i=!1;return 0==e.indexOf('"')&&(t-=2,i=!0,e=e.substring(1,e.length-1)),e.length>t&&(e=e.substring(0,t)+"..."),e=i?'"'+e+'"':e}i.DebuggerVariables=r},{"./data":67,"./debuggerTable":70,"./simulator":121,react:320}],74:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isDontShowDownloadDialogFlagSet=i.clearDontShowDownloadDialogFlag=i.renderIncompatibleHardwareDialog=i.renderBrowserDownloadInstructions=i.promptTranslateBlock=i.showResetDialogAsync=i.showWinAppDeprecateAsync=i.showReportAbuseAsync=i.showImportFileDialogAsync=i.showImportGithubDialogAsync=i.showCreateGithubRepoDialogAsync=i.showGithubTokenError=i.showImportUrlDialogAsync=i.showPRDialogAsync=i.showPackageErrorDialogAsync=i.showAboutDialogAsync=void 0;const l=e("react"),c=e("./sui"),d=e("./core"),u=e("./coretsx"),n=e("./cloudsync");var o=pxt.Cloud,a=pxt.Util;let s=!1;function p(e,t,i){return l.createElement("p",null,lf("{0} version:",e),"  ",l.createElement("a",{href:encodeURI(i),title:""+lf("{0} version: {1}",e,t),"aria-label":""+lf("{0} version{1}",e,t),target:"_blank",rel:"noopener noreferrer"},t))}i.showAboutDialogAsync=function(e){var t;pxt.appTarget.compileService;const i=pxt.appTarget.appTheme.githubUrl,n=pxt.appTarget.appTheme,r=pxt.appTarget.versions,o=[],a=(n.experiments&&o.push({label:lf("Experiments"),className:"secondary",onclick:()=>{d.hideDialog(),pxt.tickEvent("about.experiments",void 0,{interactiveConsent:!0}),e.showExperimentsDialog()}}),((null==(t=pxt.appTarget.multiVariants)?void 0:t.map(e=>{var t=pxt.U.clone(pxt.appTarget.compileService),i=pxt.appTarget.variants[e];return null!=i&&i.compileService&&pxt.U.jsonCopyFrom(t,i.compileService),{variantName:e,compileService:t}}))||[{variantName:"",compileService:pxt.appTarget.compileService}]).filter(e=>e.compileService&&e.compileService.githubCorePackage&&e.compileService.gittag&&e.compileService.serviceId));pxt.targetConfigAsync().then(e=>{var t=pxt.BrowserUtils.isPxtElectron(),e=null==(e=null==e?void 0:e.electronManifest)?void 0:e.latest;return d.confirmAsync({header:lf("About"),hasCloseIcon:!0,agreeLbl:lf("Ok"),agreeClass:"positive",buttons:o,jsx:l.createElement("div",null,t?pxt.Cloud.isOnline()&&e?pxt.semver.strcmp(pxt.appTarget.versions.target,e)<0?l.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/offline-app"},lf("An update {0} for {1} is available",e,pxt.appTarget.title)):l.createElement("p",null,lf("{0} is up to date",pxt.appTarget.title)):l.createElement("p",null,lf("Please connect to internet to check for updates")):void 0,i&&r&&p(pxt.appTarget.name,r.target,i+"/releases/tag/v"+r.target),r&&p("Microsoft MakeCode",r.pxt,"https://github.com/Microsoft/pxt/releases/tag/v"+r.pxt),null!=a&&a.length?a.map(e=>l.createElement("div",{key:e.variantName},function(e){let t,i,n;return n="object"==typeof e.codalTarget&&"string"==typeof e.codalTarget.url?(t=e.codalTarget.branch?pxt.BrowserUtils.joinURLs(e.codalTarget.url,"releases/tag",e.codalTarget.branch):e.codalTarget.url,i=e.codalTarget.branch||"master",e.codalTarget.name||e.serviceId):(t=`https://github.com/${e.githubCorePackage}/releases/tag/`+e.gittag,i=e.gittag,e.serviceId),p(lf("{0} runtime",n),i,t)}((e.variantName,e.compileService)))):void 0,l.createElement("p",null,l.createElement("br",null)),l.createElement("p",null,n.termsOfUseUrl?l.createElement("a",{target:"_blank",className:"item",href:n.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0,"    ",n.privacyUrl?l.createElement("a",{target:"_blank",className:"item",href:n.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0),n.copyrightText?l.createElement("p",null," ",n.copyrightText," "):void 0)})})},i.showPackageErrorDialogAsync=function(e,t,i){let n=!1;const r=new a.CancellationToken;return pxt.tickEvent("update.extensionErrorsShown"),d.dialogAsync({header:lf("Extension Errors"),hasCloseIcon:!0,jsx:l.createElement("div",{className:"wizard-wrapper"},l.createElement(h,{openLegacyEditor:i,affectedPackages:e,updatePackages:t,onProjectOpen:()=>n=!0,token:r}))}).then(()=>n?Promise.resolve():(d.showLoading("package-update-cancel",lf("Stopping update...")),r.cancelAsync())).then(()=>(d.hideLoading("package-update-cancel"),n))};class h extends l.Component{constructor(e){super(e),this.state={updating:!1,showProgressBar:!1,updateComplete:!1,packagesUpdated:0},this.startUpdate=this.startUpdate.bind(this),this.openProject=this.openProject.bind(this),this.openLegacyEditor=this.openLegacyEditor.bind(this)}startUpdate(){if(!this.state.updating){pxt.tickEvent("update.startExtensionUpdate");const t=Date.now();this.setState({updating:!0}),setTimeout(()=>{this.props.token.isCancelled()||this.state.updating&&1<this.props.affectedPackages.length&&this.setState({showProgressBar:!0})},3e3);var e=this.props.affectedPackages;this.props.token.onProgress(e=>{this.setState({packagesUpdated:e})}),this.props.updatePackages(e,this.props.token).then(e=>{this.props.token.isCancelled()||(pxt.tickEvent("update.endExtensionUpdate",{success:""+e,duration:Date.now()-t}),e?(this.setState({updating:!1,updateComplete:!0}),setTimeout(()=>{this.props.token.isCancelled()||this.openProject(!0)},1500)):this.setState({updateError:!0,updating:!1}))})}}openProject(e=!1){e||pxt.tickEvent("update.ignoredExtensionErrors"),this.props.onProjectOpen(),u.hideDialog()}openLegacyEditor(){this.props.onProjectOpen(),this.props.openLegacyEditor()}buildActionList(){var e=[];return this.state.updateError||e.push({text:lf("Try to fix"),title:lf("Update all extensions in the project to their latest versions"),callback:this.startUpdate}),e.push({text:lf("Ignore errors and open"),title:lf("Ignore errors and open"),callback:this.openProject}),this.props.openLegacyEditor&&e.push({text:lf("Go to the old editor"),title:lf("Open this project in the editor where it was created"),callback:this.openLegacyEditor}),e}render(){const e=this.props["affectedPackages"],{updating:t,updateComplete:i,packagesUpdated:n,updateError:r,showProgressBar:o}=this.state;if(t){const t=n===e.length?lf("Finishing up..."):lf("Updating extension {0} of {1}...",n+1,e.length);return l.createElement("div",null,o?l.createElement(f,{percentage:n/e.length*100,label:t}):l.createElement("div",{className:"ui centered inline inverted text loader"},t))}var a;return i?l.createElement("div",null,l.createElement("h2",{className:"ui center aligned icon header"},l.createElement("i",{className:"green check circle outline icon"}),lf("Update complete"))):(a=r?lf("Looks like updating didn't fix the issue. How would you like to proceed?"):lf("Looks like there are some errors in the extensions added to this project. How would you like to proceed?"),l.createElement("div",null,l.createElement("p",null,a),l.createElement(m,{actions:this.buildActionList()})))}}class f extends l.Component{render(){var{percentage:e,label:t,cornerRadius:i}=this.props,i=null==i?3:Math.max(i,0),e=Math.max(Math.min(e,100),2);return l.createElement("div",null,l.createElement("div",{className:"progress-bar-container"},l.createElement("svg",{className:"progress-bar",width:"100%",height:"100%"},l.createElement("rect",{className:"progress-bar-bg",width:"100%",height:"100%",rx:i,ry:i}),l.createElement("rect",{className:"progress-bar-content",width:e.toString()+"%",height:"100%",rx:i,ry:i}))),t?l.createElement("p",{className:"progress-bar-label"},t):void 0)}}class m extends c.StatelessUIElement{render(){return l.createElement("div",{className:"ui relaxed list",role:"menu"},this.props.actions.map(({text:e,title:t,callback:i},n)=>l.createElement("div",{className:"item wizard-action","aria-label":t,title:t,onClick:i,role:"menuitem",key:n},l.createElement("span",{className:"left floated"},l.createElement("i",{className:"medium arrow right icon"})),l.createElement(c.Link,null,e))))}}function g(e){return 401==e.statusCode?(d.errorNotification(lf("GitHub didn't accept token")),!0):404==e.statusCode&&(d.errorNotification(lf("Token has neither '{0}' nor '{1}' scope","repo","public_repo")),!0)}i.showPRDialogAsync=function t(i,n){return d.confirmAsync({header:lf("Commit conflict in {0}",i),agreeLbl:lf("Resolve conflict"),disagreeLbl:lf("I'm done!"),body:lf("The latest online version of {0} contains edits conflicting with yours. We have created a pull request (PR) that you can use to resolve the conflicts. Once you're done, sync to get all merged changes. In the meantime we have taken you to the latest online version of {0}.",i)}).then(e=>e?(pxt.tickEvent("app.commit.pr"),window.open(n,"_blank"),t(i,n)):Promise.resolve())},i.showImportUrlDialogAsync=function(){let i;var e=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";return d.confirmAsync({header:lf("Open project URL"),hasCloseIcon:!0,onLoaded:t=>{(i=t.querySelector("input")).onkeydown=e=>{if("Enter"===e.key){const e=t.querySelector(".button.approve");null!=e&&e.click()}}},jsx:l.createElement("div",{className:"ui form"},l.createElement("div",{className:"ui icon violet message"},l.createElement("i",{className:"user icon","aria-hidden":!0}),l.createElement("div",{className:"content"},l.createElement("h3",{className:"header"},lf("User-provided content")),l.createElement("p",null,lf("The content below is provided by a user, and is not endorsed by Microsoft."),l.createElement("br",null),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")))),l.createElement("div",{className:"ui field"},l.createElement("label",{id:"selectUrlToOpenLabel"},lf("Copy the URL of the project.")),l.createElement("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:lf("{0} or {1}...",e,"https://github.com/..."),className:"ui blue fluid"})))}).then(t=>{if(t){pxt.tickEvent("app.open.url");const t=i.value;let e=pxt.github.normalizeRepoId(t);return(e=e||pxt.Cloud.parseScriptId(t))?Promise.resolve(e):Promise.reject(new Error(lf("Sorry, the project url looks invalid.")))}return Promise.resolve(void 0)})},i.showGithubTokenError=g,i.showCreateGithubRepoDialogAsync=function(e){pxt.tickEvent("github.create.dialog");let t=(e=e&&(e=e.toLocaleLowerCase().replace(/\s+/g,"-")).replace(/[^\w\-]/g,""))||"",i="",n=!0;function r(){return t=="pxt-"+lf("Untitled").toLocaleLowerCase()||"pxt-untitled"==t?lf("Please pick a different name."):/^[\w\-]{1,64}$/.test(t)?void 0:lf("Repository names must be less than 64 characters and cannot include spaces or special characters.")}function o(e){e=e.trim(),t!=e&&(t=e,u.forceUpdate())}function a(e){i!=e&&(i=e,u.forceUpdate())}function s(e){e=0==e.currentTarget.selectedIndex;n!=e&&(n=e,u.forceUpdate())}return d.confirmAsync({hasCloseIcon:!0,header:lf("Create GitHub repository"),jsxd:()=>{var e=r();return l.createElement("div",{className:"ui form"},l.createElement("p",null,lf("Host your code on GitHub and work together with friends."),c.helpIconLink("/github",lf("Learn more about GitHub"))),l.createElement("div",{className:"ui field"},l.createElement(c.Input,{type:"url",autoFocus:!0,value:t,onChange:o,label:lf("Repository name"),id:"githubRepoNameInput",placeholder:"pxt-my-gadget...",class:"fluid",error:e})),l.createElement("div",{className:"ui field"},l.createElement(c.Input,{type:"text",value:i,onChange:a,label:lf("Repository description"),id:"githubRepoDescriptionInput",placeholder:lf("MakeCode extension for my gadget"),class:"fluid"})),l.createElement("div",{className:"ui field"},l.createElement("select",{className:"ui dropdown",onChange:s,"aria-label":lf("Repository visibility setting")},l.createElement("option",{"aria-selected":n,value:"true"},lf("Public repository, anyone can look at your code.")),l.createElement("option",{"aria-selected":!n,value:"false"},lf("Private repository, your code is only visible to you.")))))}}).then(e=>{if(e){if(!r())return i=i||lf("A MakeCode project"),d.showLoading("creategithub",lf("creating {0} repository...",t)),pxt.github.createRepoAsync(t,i.trim(),!n).finally(()=>d.hideLoading("creategithub")).then(e=>(pxt.tickEvent("github.create.ok"),pxt.github.normalizeRepoId("https://github.com/"+e.fullName)),e=>(g(e)||(422==e.statusCode?d.errorNotification(lf("Repository '{0}' already exists.",t)):d.errorNotification(e.message),pxt.tickEvent("github.create.error",{statusCode:e.statusCode})),""));d.errorNotification(lf("Invalid repository name.")),pxt.tickEvent("github.create.invalidname")}else pxt.tickEvent("github.create.cancel");return""})},i.showImportGithubDialogAsync=function(){let t="",i=()=>{t="NEW",d.hideDialog()};return d.showLoading("githublist",lf("searching GitHub repositories...")),n.githubProvider(!0).routedLoginAsync("import").then(e=>e&&e.accessToken&&pxt.github.listUserReposAsync()).finally(()=>d.hideLoading("githublist")).then(e=>{return e?(e=e.map(e=>({name:e.fullName,description:e.description,updatedAt:e.updatedAt,onClick:()=>{t=pxt.github.normalizeRepoId("https://github.com/"+e.fullName),d.hideDialog()}})),d.confirmAsync({header:lf("Clone or create your own GitHub repo"),hideAgree:!0,hasCloseIcon:!0,jsx:l.createElement("div",{className:"ui form"},l.createElement("div",{className:"ui relaxed divided list"},l.createElement("div",{key:"create new",className:"item"},l.createElement("i",{className:"large plus circle middle aligned icon"}),l.createElement("div",{className:"content"},l.createElement("a",{onClick:i,role:"button",className:"header",tabIndex:0,onKeyDown:c.fireClickOnEnter,title:lf("Create new GitHub repository")},l.createElement("b",null,lf("Create new..."))),l.createElement("div",{className:"description"},lf("Create a new GitHub repo in your account.")))),e.map(e=>l.createElement("div",{key:e.name,className:"item"},l.createElement("i",{className:"large github middle aligned icon"}),l.createElement("div",{className:"content"},l.createElement("a",{onClick:e.onClick,role:"button",className:"header",tabIndex:0,onKeyDown:c.fireClickOnEnter},e.name),l.createElement("div",{className:"description"},pxt.Util.timeSince(e.updatedAt),". ",e.description))))),l.createElement("div",{className:"ui icon green message"},l.createElement("i",{className:"info circle icon"}),l.createElement("div",{className:"content"},l.createElement("h3",{className:"header"},lf("Not finding what you're looking for?")),l.createElement("p",null,lf("Use the 'Import URL' option in the previous dialog to import repo by exact URL.")))))})):Promise.resolve(-1)}).then(()=>t)},i.showImportFileDialogAsync=function(e){let t,i=[pxt.appTarget.compile.saveAsPNG?".png":".mkcd"];return pxt.appTarget.compile.hasHex&&i.push(".hex"),pxt.appTarget.compile.useUF2&&i.push(".uf2"),d.confirmAsync({header:lf("Open {0} file",i.join(lf(" or "))),hasCloseIcon:!0,onLoaded:e=>{t=e.querySelectorAll("input")[0]},jsx:l.createElement("div",{className:"ui form"},l.createElement("div",{className:"ui field"},l.createElement("label",{id:"selectFileToOpenLabel"},lf("Select a {0} file to open.",i.join(lf(" or ")))),l.createElement("input",{type:"file",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectFileToOpenLabel",className:"ui blue fluid"})),l.createElement("div",{className:"ui secondary segment"},lf("You can import files by dragging and dropping them anywhere in the editor!")))}).then(e=>{if(e)return t.files[0]})},i.showReportAbuseAsync=function(n){if(pxt.github.parseRepoId(n))pxt.tickEvent("reportabuse.github"),d.confirmAsync({header:lf("Is this content inappropriate?"),hasCloseIcon:!0,agreeLbl:lf("Report"),disagreeLbl:lf("Cancel"),jsx:l.createElement("div",{className:"ui form"},l.createElement("div",{className:"ui field"},l.createElement("p",null,lf("This content was written by an independent user and may be inappropriate or abusive. Help us block or filter that content by reporting it to Github."))),l.createElement("div",{className:"ui field"},l.createElement("label",{id:"githubContentUrlLabel"},lf("Content URL")),l.createElement(c.Input,{type:"url","aria-labelledby":"githubContentUrlLabel",readOnly:!0,lines:1,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,value:n})))}).then(e=>{e&&window.open("https://github.com/contact/report-content","_blank")});else{let t,i;const r=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";d.confirmAsync({header:lf("Report Abuse"),hasCloseIcon:!0,onLoaded:e=>{t=e.querySelectorAll("input")[0],i=e.querySelectorAll("textarea")[0],n&&(t.value=r+n)},agreeLbl:lf("Submit"),jsx:l.createElement("div",{className:"ui form"},l.createElement("div",{className:"ui field"},l.createElement("label",{id:"abuseUrlLabel"},lf("What is the URL of the offensive project?")),l.createElement("input",{type:"url","aria-labelledby":"abuseUrlLabel",tabIndex:0,autoFocus:!0,placeholder:"Enter project URL here..."})),l.createElement("div",{className:"ui field"},l.createElement("label",{id:"abuseDescriptionLabel"},lf("Why do you find it offensive?")),l.createElement("textarea",{"aria-labelledby":"abuseDescriptionLabel"})))}).then(e=>{if(e){pxt.tickEvent("app.reportabuse.send");const e=pxt.Cloud.parseScriptId(t.value);e?(d.infoNotification(lf("Sending abuse report...")),o.privatePostAsync(e+"/abusereports",{text:i.value}).then(e=>{d.infoNotification(lf("Report sent. Thank you!"))}).catch(e=>{404==e.statusCode?d.warningNotification(lf("Oops, we could not find this script.")):d.handleNetworkError(e)})):d.errorNotification(lf("Sorry, the project url looks invalid."))}})}},i.showWinAppDeprecateAsync=function(){return pxt.tickEvent("winApp.dialog",void 0),d.confirmAsync({header:lf("You can't get there from here!"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/windows-app",jsx:l.createElement("div",null,l.createElement("img",{className:"ui medium centered image",src:pxt.appTarget.appTheme.winAppDeprImage,alt:lf("An image of a shrugging board")}),l.createElement("div",null,lf("This app is being deprecated. Text editing is only available on the MakeCode website "),`(https://${pxt.appTarget.name}).`))})},i.showResetDialogAsync=function(){return d.confirmAsync({header:lf("Reset"),body:lf("You are about to clear all projects. Are you sure? This operation cannot be undone."),agreeLbl:lf("Reset"),agreeClass:"red",agreeIcon:"sign out",disagreeLbl:lf("Cancel")})},i.promptTranslateBlock=function(e,t){d.confirmAsync({header:lf("Translate this block"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/translate",jsx:l.createElement("div",null,l.createElement("div",null,lf("Update the block translation below."),lf("Do not translate variable names (%name, $name)."),lf("Once validated in Crowdin, translations may take 24h to be active.")),t.map(e=>l.createElement("div",{key:"ictr"+e,className:"ui basic segment"},e)))})},i.renderBrowserDownloadInstructions=function(e){var t=pxt.appTarget.appTheme.boardName||lf("device"),i=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",n=null!=(n=pxt.appTarget.compile)&&n.useUF2?".uf2":".hex",r=pxt.usb.isEnabled&&(null==(r=null==(r=pxt.appTarget)?void 0:r.compile)?void 0:r.webUSB),o=null==(o=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:o.dragFileImage,a=o?"two":"one";return l.createElement("div",{className:"ui grid stackable upload"},l.createElement("div",{className:"column sixteen wide instructions"},l.createElement("div",{className:"ui grid"},l.createElement("div",{className:"row"},l.createElement("div",{className:"column"},l.createElement("div",{className:`ui ${a} column grid padded`},l.createElement("div",{className:"column"},l.createElement("div",{className:"ui"},l.createElement("div",{className:"content"},l.createElement("div",{className:"description"},lf("Your code is being downloaded as a {1} file. You can drag this file to your {0} using your computer's file explorer.",t,n)),r&&l.createElement("div",{className:"download-callout"},l.createElement("label",{className:"ui purple ribbon large label"},lf("New!")),l.createElement("div",{className:"ui two column grid"},l.createElement("div",{className:"icon-align three wide column"},l.createElement("div",null),l.createElement("i",{className:"icon big usb"}),l.createElement("div",null)),l.createElement("div",{className:"thirteen wide column"},lf("Download your code faster by pairing with web usb!"),l.createElement("br",null),l.createElement("strong",null,l.createElement("a",{onClick:()=>{d.hideDialog(),pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,d.confirmAsync)}},lf("Pair now"))))))))),o&&l.createElement("div",{className:"column"},l.createElement("div",{className:"ui"},l.createElement("div",{className:"image"},l.createElement("img",{alt:lf("Comic moving {1} file to {0}",i,n),className:"ui medium rounded image",src:o})))))))),l.createElement("div",null,!e&&l.createElement(c.Checkbox,{inputLabel:lf("Don't show this again"),onChange:e=>{pxt.tickEvent("downloaddialog.dontshowagain",{checked:""+e}),s=e}}))))},i.renderIncompatibleHardwareDialog=function(){var e=pxt.appTarget.appTheme.boardName||lf("device"),t=lf("Oops! Looks like your project has code that won't run on the hardware you have connected. Would you like to download anyway?"),i=lf("Learn more about what's supported by your hardware…"),n=null==(n=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:n.incompatibleHardwareHelpURL,r=null==(r=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:r.incompatibleHardwareImage,o=r?"two":"one";return l.createElement("div",{className:`ui ${o} column grid padded download-dialog`},l.createElement("div",{className:"column"},l.createElement("div",{className:"ui"},l.createElement("div",{className:"content"},l.createElement("div",{className:"description"},t,l.createElement("br",null),n&&l.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n},i))))),r&&l.createElement("div",{className:"column"},l.createElement("div",{className:"ui"},l.createElement("div",{className:"image download-dialog-image"},l.createElement("img",{alt:lf("Image of {0}",e),className:"ui medium rounded image",src:r})))))},i.clearDontShowDownloadDialogFlag=function(){s=!1},i.isDontShowDownloadDialogFlagSet=function(){return s}},{"./cloudsync":15,"./core":64,"./coretsx":65,"./sui":129,react:320}],75:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setupDragAndDrop=void 0,i.setupDragAndDrop=function(e,i,n,r){e.addEventListener("paste",function(e){var t;e.clipboardData&&(0<(t=pxt.Util.toArray(e.clipboardData.files).filter(i)).length?(e.stopPropagation(),e.preventDefault(),n(t)):e.clipboardData.items&&0<e.clipboardData.items.length&&(t=e.clipboardData.items[0].getAsFile())&&(e.stopPropagation(),e.preventDefault(),n([t])))}),e.addEventListener("dragover",function(e){let t=e.dataTransfer.types,i=!1;for(let e=0;e<t.length;++e)"Files"!=t[e]&&"text/uri-list"!=t[e]||(i=!0);return!i||(e.preventDefault&&e.preventDefault(),!(e.dataTransfer.dropEffect="copy"))},!1),e.addEventListener("drop",function(e){let t=pxt.Util.toArray(e.dataTransfer.files);if(0<t.length)e.stopPropagation(),e.preventDefault(),n(t);else if(-1<e.dataTransfer.types.indexOf("text/uri-list")){const t=e.dataTransfer.getData("text/uri-list");t&&(e.stopPropagation(),e.preventDefault(),r(t))}return!1},!1),e.addEventListener("dragend",function(e){return!1},!1)}},{}],76:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SmallEditorToolbar=i.ZoomSlider=i.EditorToolbar=void 0;const D=e("react"),r=e("./data"),g=e("./sui"),L=e("./githubbutton"),o=e("./cmds"),R=e("./identity");class a extends r.Component{constructor(e){super(e),this.onHwItemClick=()=>{pxt.hasHwVariants()?this.props.parent.showChooseHwDialog(!0):this.props.parent.showBoardDialogAsync(void 0,!0)},this.onDownloadButtonClick=()=>{pxt.tickEvent("editortools.downloadbutton",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.compile()},this.onHwDownloadClick=()=>{pxt.tickEvent("editortools.download",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),pxt.tickEvent("editortools.downloadasfile",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile(!0)},this.onPairClick=()=>{pxt.tickEvent("editortools.pair",void 0,{interactiveConsent:!0}),this.props.parent.pairAsync()},this.onDisconnectClick=()=>{o.showDisconnectAsync()},this.onHelpClick=()=>{var e;pxt.tickEvent("editortools.downloadhelp"),window.open(null==(e=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:e.downloadMenuHelpURL)},this.saveProjectName=this.saveProjectName.bind(this),this.compile=this.compile.bind(this),this.saveFile=this.saveFile.bind(this),this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleDebugging=this.toggleDebugging.bind(this),this.toggleCollapsed=this.toggleCollapsed.bind(this),this.cloudButtonClick=this.cloudButtonClick.bind(this)}saveProjectName(e,t){pxt.tickEvent("editortools.projectrename",{view:t},{interactiveConsent:!0}),this.props.parent.updateHeaderName(e)}compile(e){this.setState({compileState:"compiling"}),pxt.tickEvent("editortools.download",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile()}saveFile(e){pxt.tickEvent("editortools.save",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.saveAndCompile()}undo(e){pxt.tickEvent("editortools.undo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.undo()}redo(e){pxt.tickEvent("editortools.redo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.redo()}zoomIn(e){pxt.tickEvent("editortools.zoomIn",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate()}zoomOut(e){pxt.tickEvent("editortools.zoomOut",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate()}startStopSimulator(e){pxt.tickEvent("editortools.startStopSimulator",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}toggleDebugging(e){pxt.tickEvent("editortools.debug",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleCollapsed(){pxt.tickEvent("editortools.portraitToggleCollapse",{collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}cloudButtonClick(e){pxt.tickEvent("editortools.cloud",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0})}componentDidUpdate(){var e;this.props.parent.state.compiling?null!=(e=this.state)&&e.compileState||this.setState({compileState:"compiling"}):"compiling"===(null==(e=this.state)?void 0:e.compileState)&&(this.props.parent.state.cancelledDownload?this.setState({compileState:null}):(this.setState({compileState:"success"}),this.compileTimeout&&clearTimeout(this.compileTimeout),this.compileTimeout=setTimeout(()=>{var e;"success"===(null==(e=this.state)?void 0:e.compileState)&&this.setState({compileState:null})},2e3)))}componentWillUnmount(){this.compileTimeout&&clearTimeout(this.compileTimeout)}getCollapsedState(){return""+this.props.parent.state.collapseEditorTools}getHeadlessState(){return pxt.appTarget.simulator.headless?"true":"false"}getSaveInput(e,t,i,n){let r="";this.props.parent.state.isSaving?r="loading disabled":this.props.parent.state.compiling&&(r="disabled");var o=[];return o.push(D.createElement("label",{htmlFor:t,className:"accessible-hidden phone hide",key:"label"},lf("Type a name for your project"))),o.push(D.createElement(l,{id:t,view:this.getViewString(0),key:"input",type:"text","aria-labelledby":t,placeholder:lf("Pick a name..."),value:i||"",onChangeValue:this.saveProjectName,disabled:n,readOnly:n})),e&&o.push(D.createElement(M,{icon:"save",className:"right attached editortools-btn save-editortools-btn "+r,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:this.getViewString(0),key:"save0"})),o}getZoomControl(e){return[D.createElement(M,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.getViewString(e),key:"minus"}),D.createElement(M,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.getViewString(e),key:"plus"})]}getUndoRedo(e){var t=this.props.parent.editor.hasUndo(),i=this.props.parent.editor.hasRedo();return[D.createElement(M,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(t?"":"disabled"),title:lf("Undo"),ariaLabel:lf("{0}, {1}",lf("Undo"),t?"":lf("Disabled")),onButtonClick:this.undo,view:this.getViewString(e),key:"undo"}),D.createElement(M,{icon:"xicon redo",className:"editortools-btn redo-editortools-btn "+(i?"":"disabled"),title:lf("Redo"),ariaLabel:lf("{0}, {1}",lf("Redo"),i?"":lf("Disabled")),onButtonClick:this.redo,view:this.getViewString(e),key:"redo"})]}getViewString(e){return e.toString().toLowerCase()}getCompileButton(e){var t=pxt.appTarget.appTheme,{compiling:i,isSaving:n}=this.props.parent.state,r=this.state["compileState"],o=lf("Download your code to the {0}",t.boardName),a="success"===r?t.useUploadMessage?lf("Uploaded!"):lf("Downloaded!"):t.useUploadMessage?lf("Upload"):lf("Download"),s=pxt.appTarget.simulator&&!!pxt.appTarget.simulator.dynamicBoardDefinition,l=pxt.usb.isEnabled&&(null==(l=null==(l=pxt.appTarget)?void 0:l.compile)?void 0:l.webUSB),c=!!this.getData("packetio:connected"),d=!!this.getData("packetio:connecting"),u=this.getData("packetio:icon"),p=c&&(null==(p=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:p.deviceSuccessIcon)||"xicon file-download-check",r=!!d&&"ping "+u||"success"===r&&p||!!c&&u||t.downloadIcon||"xicon file-download";let h="left attached ",f="",m=!1;switch(n?h+="disabled ":i&&(h+="loading disabled "),c?h+="connected ":d&&(h+="connecting "),e){case 2:h+="download-button-full ",m=!0;break;case 1:h+="download-button-full  ",f="",m=!0;break;default:h+="large fluid ",f="large"}p=[],p.push(D.createElement(M,{key:"downloadbutton",icon:r,className:"primary download-button "+h,text:2!=e?a:void 0,title:o,onButtonClick:this.onDownloadButtonClick,view:"computer"})),u=pxt.hwName||pxt.appTarget.appTheme.boardNickname||lf("device"),t=pxt.hwName||c&&lf("Connected to {0}",u)||d&&lf("Connecting...")||(s?lf("Click to select hardware"):l?lf("Click for one-click downloads."):void 0),n=2==e?lf("Hardware"):lf("Choose hardware"),i=2==e?pxt.hwName||lf("Download"):lf("Download as file"),a=null==(r=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:r.downloadMenuHelpURL,u=(null==(o=pxt.appTarget.appTheme.downloadDialogTheme)?void 0:o.deviceIcon)||"usb";return p.push(D.createElement(g.DropdownMenu,{key:"downloadmenu",role:"menuitem",icon:"ellipsis horizontal "+f,title:lf("Download options"),className:f+" right attached editortools-btn hw-button button",dataTooltip:t,displayAbove:!0,displayRight:m},l&&!c&&D.createElement(g.Item,{role:"menuitem",icon:u,text:lf("Connect device"),tabIndex:-1,onClick:this.onPairClick}),l&&(d||c)&&D.createElement(g.Item,{role:"menuitem",icon:u,text:lf("Disconnect"),tabIndex:-1,onClick:this.onDisconnectClick}),s&&D.createElement(g.Item,{role:"menuitem",icon:"microchip",text:n,tabIndex:-1,onClick:this.onHwItemClick}),D.createElement(g.Item,{role:"menuitem",icon:"xicon file-download",text:i,tabIndex:-1,onClick:this.onHwDownloadClick}),a&&D.createElement(g.Item,{role:"menuitem",icon:"help circle",text:lf("Help"),tabIndex:-1,onClick:this.onHelpClick}))),p}renderCore(){var e;const{tutorialOptions:t,projectName:i,compiling:n,isSaving:r,simState:o,debugging:a,editorState:s}=this.props.parent.state,l=null!=(e=this.getData("header:"+this.props.parent.state.header.id))?e:this.props.parent.state.header,c=pxt.appTarget.appTheme,d=pxt.shell.isControllerMode(),u=pxt.shell.isReadOnly(),p=!!t&&t.tutorial,h=pxt.appTarget.simulator.headless,f=s&&!1===s.hasCategories,m=c.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),g=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),b=!(!l||!pxt.github.parseRepoId(l.githubId)),v=!(u||d||c.saveInMenu||p||a||m||g||b),y=!(p||u||d||c.hideProjectRename||a),w=pxt.appTarget.compile,k=w.hasHex||w.saveAsPNG||w.useUF2,x=lf("Download your code to the {0}",c.boardName),E=!!n,C=o==pxt.editor.SimState.Running,_=o==pxt.editor.SimState.Starting,S=!u&&!a&&!f,T=!f,A=!!pxt.appTarget.cloud&&!!pxt.appTarget.cloud.githubPackages&&c.githubEditor&&!pxt.winrt.isWinRT()&&!pxt.BrowserUtils.isPxtElectron()&&!u&&!d&&!a&&!p,N=pxt.appTarget.appTheme.downloadIcon||"download",I=(()=>{switch(o){case pxt.editor.SimState.Stopped:return lf("Start");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting");default:return lf("Stop")}})();let O="",P="";return r?(O="disabled",P="loading disabled"):E&&(O="loading disabled",P="disabled"),D.createElement("div",{id:"editortools",className:"ui",role:"region","aria-label":lf("Editor toolbar")},D.createElement("div",{id:"downloadArea",role:"menu",className:"ui column items"},h&&D.createElement("div",{className:"ui item"},D.createElement("div",{className:"ui icon large buttons"},k&&D.createElement(M,{icon:N,className:"primary large download-button mobile tablet hide "+O,title:x,onButtonClick:this.compile,view:"computer"}))),!h&&D.createElement("div",{className:"ui item portrait hide"},k&&this.getCompileButton(0)),!h&&D.createElement("div",{className:"ui portrait only"},k&&this.getCompileButton(2))),(y||A||R.CloudSaveStatus.wouldRender(l.id))&&D.createElement("div",{id:"projectNameArea",role:"menu",className:"ui column items"},D.createElement("div",{className:`ui right ${v?"labeled":""} input projectname-input projectname-computer`},y&&this.getSaveInput(v,"fileNameInput2",i,!1),A&&D.createElement(L.GithubButton,{parent:this.props.parent,key:"githubbtn0"}),D.createElement(R.CloudSaveStatus,{headerId:l.id}))),D.createElement("div",{id:"editorToolbarArea",role:"menu",className:"ui column items"},S&&D.createElement("div",{className:"ui icon buttons"},this.getUndoRedo(0)),T&&D.createElement("div",{className:"ui icon buttons mobile hide"},this.getZoomControl(0)),c.bigRunButton&&D.createElement("div",{className:"big-play-button-wrapper"},D.createElement(M,{className:"big-play-button play-button "+(C?"stop":"play"),key:"runmenubtn",disabled:_,icon:C?"stop":"play",title:I,onButtonClick:this.startStopSimulator,view:"computer"}))))}}i.EditorToolbar=a;class s extends r.Component{constructor(e){super(e),this.zoomMin=this.props.zoomMin||0,this.zoomMax=this.props.zoomMax||5,this.state={zoomValue:Math.floor((this.zoomMax+1-this.zoomMin)/2)+this.zoomMin},this.handleWheelZoom=this.handleWheelZoom.bind(this),this.zoomUpdate=this.zoomUpdate.bind(this),this.zoomOut=this.zoomOut.bind(this),this.zoomIn=this.zoomIn.bind(this)}componentDidMount(){window.addEventListener("wheel",this.handleWheelZoom)}componentWillUnmount(){window.removeEventListener("wheel",this.handleWheelZoom)}handleWheelZoom(e){e.ctrlKey&&(e.deltaY<0?this.increaseZoomState():this.decreaseZoomState())}decreaseZoomState(){this.state.zoomValue>this.zoomMin&&this.setState({zoomValue:this.state.zoomValue-1})}increaseZoomState(){this.state.zoomValue<this.zoomMax&&this.setState({zoomValue:this.state.zoomValue+1})}zoomOut(){this.state.zoomValue>this.zoomMin&&(this.decreaseZoomState(),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate())}zoomIn(){this.state.zoomValue<this.zoomMax&&(this.increaseZoomState(),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate())}zoomUpdate(e){var t=parseInt(e.target.value);if(this.state.zoomValue<t)for(let e=0;e<t-this.state.zoomValue;e++)this.props.parent.editor.zoomIn();else if(t<this.state.zoomValue)for(let e=0;e<this.state.zoomValue-t;e++)this.props.parent.editor.zoomOut();this.setState({zoomValue:t}),this.props.parent.forceUpdate()}renderCore(){return D.createElement("div",{className:"zoom"},D.createElement(M,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn borderless",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.props.view,key:"minus"}),D.createElement("div",{id:"zoomSlider"},D.createElement("input",{className:"zoomSliderBar",type:"range",min:this.zoomMin,max:this.zoomMax,step:"1",value:this.state.zoomValue.toString(),onChange:this.zoomUpdate,"aria-valuemax":this.zoomMax,"aria-valuemin":this.zoomMin,"aria-valuenow":this.state.zoomValue})),D.createElement(M,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn borderless",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.props.view,key:"plus"}))}}i.ZoomSlider=s,i.SmallEditorToolbar=class extends a{constructor(e){super(e)}renderCore(){return D.createElement("div",{id:"headerToolbar",className:"smallEditorToolbar"},D.createElement(s,{parent:this.props.parent,view:super.getViewString(0),zoomMin:0,zoomMax:5}),D.createElement("div",{className:"ui icon undo-redo-buttons"},super.getUndoRedo(0)))}};class M extends g.StatelessUIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){var{onButtonClick:e,view:t}=this.props;e(t)}renderCore(){var e=this.props,t=e["role"],e=n(e,["onClick","onButtonClick","role"]);return D.createElement(g.Button,Object.assign({role:t||"menuitem"},e,{onClick:this.handleClick}))}}class l extends D.Component{constructor(e){super(e),this.onChange=e=>{this.setState({editValue:e.target.value});var{onChangeValue:t,view:i}=this.props;t(e.target.value,i)},this.onBlur=e=>{var t,i;this.state.editValue&&({onChangeValue:t,view:i}=this.props,t(e.target.value,i),this.setState({editValue:void 0}))},this.onKeyDown=e=>{"Enter"!==e.key||e.metaKey||e.shiftKey||(e.target.blur(),e.stopPropagation())},this.state={editValue:void 0}}render(){var e=this.props,{}=e,e=n(e,["onChange","onChangeValue","view"]),t=this.state["editValue"];return D.createElement("input",Object.assign({onChange:this.onChange,onBlur:this.onBlur,onKeyDown:this.onKeyDown,className:"mobile hide ui",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},e,{value:void 0!==t?t:this.props.value}))}}},{"./cmds":16,"./data":67,"./githubbutton":83,"./identity":91,"./sui":129,react:320}],77:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.openDevTools=i.driveDeployAsync=i.initElectron=void 0;const n=e("./cmds"),r=e("./core"),o=window.pxtElectron;i.initElectron=function(t){if(pxt.BrowserUtils.isPxtElectron()){o.onTelemetry(e=>{pxt.tickEvent(e.event,e.data)}),o.onUpdateInstalled(()=>{r.infoNotification(lf("An update will take effect after the app restarts"))}),o.onDriveDeployResult(e=>{if(a)if(e)pxt.tickEvent("electron.drivedeploy.success"),a.resolve();else{pxt.tickEvent("electron.drivedeploy.failure");const e=new Error("electron drive deploy failed");a.reject(e)}else pxt.tickEvent("electron.drivedeploy.unknowndeployoperation")});const i=new Promise(e=>{o.onCriticalUpdateFailed(()=>{pxt.tickEvent("electron.criticalupdate.failed"),e()})});o.onUpdateStatus(e=>{switch(pxt.debug("Electron app update status: "+e),pxt.tickEvent("electron.updatestatus."+e),"updating-critical"!==e&&"banned-without-update"!==e||t.stopSimulator(),e){case"update-available":case"ok":return;case"updating-critical":r.confirmAsync({header:lf("Critical update required"),body:lf("A critical update is installing. Please do not quit the app. It will automatically restart when the update has completed."),hideAgree:!0,disagreeLbl:lf("Ok"),disagreeClass:"green",size:"large"}).then(()=>{r.showLoading("pxt-electron-update",lf("Installing update..."))}),i.then(()=>{r.hideLoading("pxt-electron-update"),r.hideDialog(),r.confirmAsync({header:lf("Critical update failed"),body:lf("There was an error installing the critical update. Please ensure you are connected to the Internet and try again later."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then(e=>{o.sendQuit()})});break;case"banned-without-update":r.confirmAsync({header:lf("Critical update required"),body:lf("We have disabled this app for security reasons. Please ensure you are connected to the Internet and try again later. An update will be automatically installed as soon as it is available."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then(e=>{o.sendQuit()});default:return}}),o.sendUpdateStatusCheck()}};let a=null;i.driveDeployAsync=function(t){return pxt.BrowserUtils.isPxtElectron()?(a||(a=pxt.Util.defer(),o.sendDriveDeploy(t)),a.promise.catch(e=>(pxt.tickEvent("electron.drivedeploy.browserdownloadinstead"),n.browserDownloadDeployCoreAsync(t))).finally(()=>{a=null})):n.browserDownloadDeployCoreAsync(t)},i.openDevTools=function(){o&&o.sendOpenDevTools()}},{"./cmds":16,"./core":64}],78:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ErrorList=void 0;const a=e("react"),s=e("./sui");class n extends a.Component{constructor(e){super(e),this.state={isCollapsed:!0,errors:[],exception:null,blockErrors:[]},this.onCollapseClick=this.onCollapseClick.bind(this),this.onErrorsChanged=this.onErrorsChanged.bind(this),this.onBlockErrorsChanged=this.onBlockErrorsChanged.bind(this),this.onExceptionDetected=this.onExceptionDetected.bind(this),this.onErrorMessageClick=this.onErrorMessageClick.bind(this),this.onDisplayStateChange=this.onDisplayStateChange.bind(this),this.getCompilerErrors=this.getCompilerErrors.bind(this),this.generateStackTraces=this.generateStackTraces.bind(this),this.listBlockErrors=this.listBlockErrors.bind(this),e.isInBlocksEditor?e.listenToBlockErrorChanges("errorList",this.onBlockErrorsChanged):(e.listenToErrorChanges("errorList",this.onErrorsChanged),e.listenToExceptionChanges("errorList",this.onExceptionDetected))}render(){var{isCollapsed:e,errors:t,exception:i,blockErrors:n}=this.state,r=!(null==t||!t.length)||!!i||!(null==n||!n.length),o=(lf("Collapse Error List"),e?void 0:this.props.isInBlocksEditor?this.listBlockErrors(n):i?this.generateStackTraces(i):this.getCompilerErrors(t)),n=this.props.isInBlocksEditor?n.length:i?1:t.length;return a.createElement("div",{className:`errorList ${e?"errorListSummary":""} `+(this.props.isInBlocksEditor?"errorListBlocks":""),hidden:!r},a.createElement("div",{className:"errorListHeader",role:"button","aria-label":lf("{0} error list",e?lf("Expand"):lf("Collapse")),onClick:this.onCollapseClick,onKeyDown:s.fireClickOnEnter,tabIndex:0},a.createElement("h4",null,lf("Problems")),a.createElement("div",{className:"ui red circular label countBubble"},n),a.createElement("div",{className:"toggleButton"},a.createElement(s.Icon,{icon:"chevron "+(e?"up":"down")}))),!e&&a.createElement("div",{className:"errorListInner"},i&&a.createElement("div",{className:"debuggerSuggestion",role:"button",onClick:this.props.startDebugger,onKeyDown:s.fireClickOnEnter,tabIndex:0},lf("Debug this project"),a.createElement(s.Icon,{className:"debug-icon",icon:"icon bug"})),o))}onDisplayStateChange(){var{errors:e,exception:t,isCollapsed:i}=this.state,e=!(null!=e&&e.length||t);this.props.onSizeChange&&this.props.onSizeChange(e?void 0:i?pxt.editor.ErrorListState.HeaderOnly:pxt.editor.ErrorListState.Expanded)}onCollapseClick(){pxt.tickEvent("errorlist.collapse",null,{interactiveConsent:!0}),this.setState({isCollapsed:!this.state.isCollapsed},this.onDisplayStateChange)}onErrorMessageClick(e,t){pxt.tickEvent("errorlist.goto",{errorIndex:t},{interactiveConsent:!0}),this.props.goToError(e)}onErrorsChanged(e){this.setState({errors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onBlockErrorsChanged(e){this.setState({blockErrors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onExceptionDetected(e,t){this.setState({isCollapsed:!1,exception:e,callLocations:t})}getCompilerErrors(e){e=function(e){var t=new Map;let i=0;for(const n of e){const e=l(n);t.has(e)?t.get(e).count++:t.set(e,{index:i++,count:1,error:n})}const n=[];return t.forEach(e=>n.push(e)),n.sort((e,t)=>e.index-t.index)}(e);return a.createElement("div",{className:"ui selection list"},e.map((e,t)=>{return a.createElement(r,{key:`${(i=e.error).messageText}-${i.fileName}-${i.line}-`+i.column,index:t,error:e,revealError:this.onErrorMessageClick});var i}))}generateStackTraces(e){return a.createElement("div",null,a.createElement("div",{className:"exceptionMessage"},pxt.Util.rlf(e.exceptionMessage)),a.createElement("div",{className:"ui selection list"},(e.stackframes||[]).map((e,t)=>{var i=this.state.callLocations[e.callLocationId];return i?a.createElement(r,{key:t,index:t,stackframe:e,location:i,revealError:this.onErrorMessageClick}):null})))}listBlockErrors(e){return a.createElement("div",{className:"ui selection list"},(e||[]).map((e,t)=>a.createElement(r,{index:t,key:t+"-"+e,blockError:e})))}}i.ErrorList=n;class r extends a.Component{constructor(e){super(e),this.onErrorListItemClick=this.onErrorListItemClick.bind(this)}render(){const{error:e,stackframe:t,location:i,blockError:n}=this.props,r=n?lf("{0}",n.message):t?lf("at {0} (line {1})",t.funcInfo.functionName,i.line+1):l(e.error),o=t||n?1:e.count;return a.createElement("div",{className:"item "+(t?"stackframe":""),role:"button",onClick:n?void 0:this.onErrorListItemClick,onKeyDown:s.fireClickOnEnter,"aria-label":lf("Go to {0}: {1}",t?"":"error",r),tabIndex:0},r," ",o<=1?null:a.createElement("div",{className:"ui gray circular label countBubble"},o))}onErrorListItemClick(){var e=this.props.stackframe?this.props.location:this.props.error.error;this.props.revealError(e,this.props.index)}}function l(e){return lf("Line {0}: {1}",e.endLine?e.endLine+1:e.line+1,e.messageText)}},{"./sui":129,react:320}],79:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.resolveExtensionUrl=i.ExtensionManager=void 0;const l=e("./package");function o(e,t){var i=l.mainEditorPkg();t.resp=i.getAllFiles()}i.ExtensionManager=class{constructor(e){this.host=e,this.nameToExtId={},this.extIdToName={},this.streams={},this.messages={}}clear(){}streamingExtensions(){return Object.keys(this.streams)}messagesExtensions(){return Object.keys(this.messages)}handleExtensionMessage(e){this.handleRequestAsync(e).catch(e=>{})}sendEvent(e,t){this.host.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:t})}getExtId(e){return this.nameToExtId[e]||(this.nameToExtId[e]=ts.pxtc.Util.guidGen(),this.extIdToName[this.nameToExtId[e]]=e),this.nameToExtId[e]}sendResponse(e){this.host.send(this.extIdToName[e.extId],e)}handleRequestAsync(e){var t;const i={type:"pxtpkgext",id:e.id,extId:e.extId,success:!0};switch(e.action){case"extinit":i.target=pxt.appTarget,this.sendResponse(i);break;case"extdatastream":return null!=(t=null==e?void 0:e.body)&&t.messages?this.operation(e.extId,i,(e,t)=>this.handleMessageStreamRequest(e,t)):this.operation(e.extId,i,(e,t)=>this.handleDataStreamRequest(e,t));case"extusercode":return this.operation(e.extId,i,o);case"extreadcode":t=this.extIdToName[e.extId],n=i,r=l.mainEditorPkg(),t=ts.pxtc.escapeIdentifier(t),r=r.getAllFiles(),n.resp={json:r[t+".json"],code:r[t+".ts"],jres:r[t+".jres"],asm:r[t+".asm"]},this.sendResponse(i);break;case"extwritecode":var n=()=>function(t,i){var e;const n=l.mainEditorPkg(),r=ts.pxtc.escapeIdentifier(t);function o(e,t){return void 0!==e&&(!n.files[r+t]||n.files[r+t].content!=e)}let a,s=!1;if(o(i.json,".json")&&(s=!0,n.setFile(r+".json",i.json)),o(i.code,".ts")&&(s=!0,n.setFile(r+".ts",i.code)),o(i.jres,".jres")&&(s=!0,n.setFile(r+".jres",i.jres)),o(i.asm,".asm")&&(s=!0,n.setFile(r+".asm",i.asm)),i.dependencies){const t=pxt.Util.jsonTryParse(null==(e=n.files[pxt.CONFIG_NAME])?void 0:e.content);null!=t&&t.dependencies&&(a=Object.keys(i.dependencies).filter(e=>!t.dependencies[e]),s=s||!(null==a||!a.length))}return s?n.updateConfigAsync(t=>{void 0!==i.json&&t.files.indexOf(r+".json")<0&&t.files.push(r+".json"),void 0!==i.code&&t.files.indexOf(r+".ts")<0&&t.files.push(r+".ts"),void 0!==i.jres&&t.files.indexOf(r+".jres")<0&&t.files.push(r+".jres"),void 0!==i.asm&&t.files.indexOf(r+".asm")<0&&t.files.push(r+".asm"),null!=a&&a.forEach(e=>t.dependencies[e]=i.dependencies[e])}).then(()=>n.saveFilesAsync()):Promise.resolve()}(this.extIdToName[e.extId],e.body).then(()=>this.sendResponse(i)),r=function(e){var t;let i;if(null!=e&&e.dependencies){const n=l.mainEditorPkg(),r=pxt.Util.jsonTryParse(null==(t=null==n?void 0:n.files[pxt.CONFIG_NAME])?void 0:t.content);null!=r&&r.dependencies&&(i=Object.keys(e.dependencies).filter(e=>!r.dependencies[e]))}return i}(e.body);null!=r&&r.length?this.operation(e.extId,i,n):n()}return Promise.resolve()}operation(e,t,i){return Promise.resolve().then(()=>{i(this.extIdToName[e],t),this.sendResponse(t)}).catch(e=>{t.success=!1,t.error=e,this.sendResponse(t)})}handleDataStreamRequest(e,t){this.streams[e]=!0}handleMessageStreamRequest(e,t){this.messages[e]=!0}},i.resolveExtensionUrl=async function(e){var{config:e,installedVersion:t}=e,i=e["extension"],n=await pxt.packagesConfigAsync(),t=pxt.github.parseRepoId(t),t=pxt.github.repoStatus(t,n);let r="",o=!1;var a=pxt.BrowserUtils.isLocalHost()&&/debugextensions=1/i.test(window.location.href),s=!a&&pxt.BrowserUtils.isLocalHost()&&/localeditorextensions=1/i.test(window.location.href)&&i.localUrl;return a?r="http://localhost:3232/extension.html":s?r=i.localUrl:i.url&&t===pxt.github.GitRepoStatus.Approved&&-1<(null==(a=null==n?void 0:n.approvedEditorExtensionUrls)?void 0:a.indexOf(i.url))&&(pxt.log(`extension url ${i.url} trusted`),r=i.url,o=!0),pxt.log(`extension ${e.name}: resolved `+r),{url:r,name:e.name,trusted:o}}},{"./package":108}],80:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Extensions=void 0;const n=e("react"),r=e("./data"),o=e("./core"),a=e("./sui"),s=e("./extensionManager");class l extends r.Component{constructor(e){super(e),this.handleExtensionWrapperRef=e=>{this.extensionWrapper=e},this.state={visible:!1},this.manager=new s.ExtensionManager(this),window.addEventListener("message",this.processMessage.bind(this),!1),this.hide=this.hide.bind(this),this.updateDimensions=this.updateDimensions.bind(this)}unload(){var e=l.getCustomContent();e&&pxsim.U.removeChildren(e),this.manager.clear()}processSerialMessage(e){var t=this.manager.streamingExtensions();if(null!=t&&t.length){const i=e.data||"",n=e.id||"?",r={target:pxt.appTarget.id,type:"pxtpkgext",event:"extconsole",body:{source:n,sim:e.sim,data:i}};t.forEach(e=>this.send(e,r))}}processMessagePacketMessage(e){var t=this.manager.messagesExtensions();if(null!=t&&t.length){const i=e.data,n=e.channel,r=e.source,o={target:pxt.appTarget.id,type:"pxtpkgext",event:"extmessagepacket",body:{source:r,channel:n,data:i}};t.forEach(e=>this.send(e,o))}}processMessage(e){e=e.data;"serial"===(null==e?void 0:e.type)?this.processSerialMessage(e):"messagepacket"===(null==e?void 0:e.type)&&this.processMessagePacketMessage(e)}hide(){this.setState({visible:!1}),l.getFrame(this.state.extension,!0).style.display="none",o.showLoading("reloadproject",lf("loading...")),this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"exthidden"}),this.props.parent.reloadHeaderAsync().then(()=>o.hideLoading("reloadproject"))}showExtensionAsync(t,i){return pxt.targetConfigAsync().then(e=>{var e=null==e?void 0:e.packages;-1<(null==(e=null==e?void 0:e.approvedEditorExtensionUrls)?void 0:e.indexOf(i))||pxt.U.userError("Trying to load an unapproved extension"),this.setState({visible:!0,extension:t,url:i},()=>{this.send(t,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extshown"})})})}initializeFrame(){var e=l.getFrame(this.state.extension,!0);e.style.display="block",e.src||(e.src=this.state.url+"#"+this.manager.getExtId(this.state.extension),e.onload=()=>{this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extloaded"})})}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.extension!=t.extension}updateDimensions(){var e,t;this.extensionWrapper&&(e=this.extensionWrapper.getAttribute("data-frame"))&&(e=l.getFrame(e,!1),t=document.getElementsByClassName("extensiondialog")[0])&&e&&(t.getBoundingClientRect(),e.width=window.innerWidth+"px",e.height=window.innerHeight-60+"px",e.style.top="60px",e.style.left="0px")}componentDidMount(){window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){setTimeout(()=>{this.updateDimensions()},0)}UNSAFE_componentWillUpdate(e,t){t.extension&&t.visible&&l.getFrame(t.extension,!0)}handleExtensionRequest(e){this.manager.handleExtensionMessage(e)}send(e,t){var i=l.getFrame(e,!1);i?i.contentWindow.postMessage(t,"*"):console.warn("Attempting to post message to unloaded extesnion "+e)}static getCustomContent(){return document.getElementById("custom-content")}static getFrame(e,t){let i=this.getCustomContent().getElementsByClassName("extension-frame-"+e)[0];return i=!i&&t?this.createFrame(e):i}static createFrame(e){var t=this.getCustomContent(),i=document.createElement("iframe");return i.className="extension-frame extension-frame-"+e,i.allowFullscreen=!0,i.setAttribute("sandbox","allow-same-origin allow-scripts"),i.frameBorder="0",i.style.display="none",t.appendChild(i),i}static hideAllFrames(){var e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach(e=>{e.style.zIndex="10"})}static showAllFrames(){var e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach(e=>{e.style.zIndex=""})}renderCore(){var{visible:e,extension:t}=this.state;return l.showAllFrames(),e&&this.initializeFrame(),n.createElement(a.Modal,{isOpen:e,className:"extensiondialog",size:"fullscreen",closeIcon:!0,onClose:this.hide,dimmer:!0,modalDidOpen:this.updateDimensions,shouldFocusAfterRender:!1,onPositionChanged:this.updateDimensions,closeOnDimmerClick:!0},n.createElement("div",{id:"extensionWrapper","data-frame":t,ref:this.handleExtensionWrapperRef}))}}i.Extensions=l},{"./core":64,"./data":67,"./extensionManager":79,"./sui":129,react:320}],81:[function(e,t,i){"use strict";var a=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.FileList=void 0;const w=e("react"),n=e("./data"),k=e("./sui"),u=e("./package"),p=e("./core"),h="custom.ts",f=`
enum MyEnum {
    //% block="one"
    One,
    //% block="two"
    Two
}

/**
 * ${lf("Custom blocks")}
 */
//% weight=100 color=#0fbc11 icon=""
namespace custom {
    /**
     * TODO: ${lf("describe your function here")}
     * @param n ${lf("describe parameter here")}, eg: 5
     * @param s ${lf("describe parameter here")}, eg: "Hello"
     * @param e ${lf("describe parameter here")}
     */
    //% block
    export function foo(n: number, s: string, e: MyEnum): void {
        // Add code here
    }

    /**
     * TODO: ${lf("describe your function here")}
     * @param value ${lf("describe value here")}, eg: 5
     */
    //% block
    export function fib(value: number): number {
        return value <= 1 ? value : fib(value -1) + fib(value - 2);
    }
}
`,m=e=>`
/**
* ${lf("Use this file to define custom functions and blocks.")}
* ${lf("Read more at {0}",e+"blocks/custom")}
*/
`;class r extends n.Component{constructor(e){super(e),this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.handleCustomBlocksClick=this.handleCustomBlocksClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.setFile=this.setFile.bind(this),this.removeFile=this.removeFile.bind(this),this.addLocalizedFile=this.addLocalizedFile.bind(this),this.removePkg=this.removePkg.bind(this),this.updatePkg=this.updatePkg.bind(this),this.togglePkg=this.togglePkg.bind(this),this.navigateToError=this.navigateToError.bind(this)}UNSAFE_componentWillReceiveProps(e){const i=e.parent.state.currFile;if(this.state.currentFile!=i){let t;u.allEditorPkgs().forEach(e=>{this.packageContainsFile(e,i)&&(t=e.getPkgId())}),this.setState({expandedPkg:t,currentFile:i})}}removePkg(t){p.confirmAsync({header:lf("Remove {0} extension",t.getPkgId()),body:lf("You are about to remove an extension from your project. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then(e=>{e&&u.mainEditorPkg().removeDepAsync(t.getPkgId()).then(()=>this.props.parent.reloadHeaderAsync())})}setFile(e){this.props.parent.setSideFile(e)}removeFile(e){this.props.parent.removeFile(e)}addLocalizedFile(e,t){return this.props.parent.updateFileAsync(t,e.content,!0)}updatePkg(e){p.showLoading("update",lf("Updating...")),u.mainEditorPkg().updateDepAsync(e.getPkgId()).then(()=>this.props.parent.reloadHeaderAsync()).finally(()=>p.hideLoading("update"))}navigateToError(e){e=e&&e.diagnostics&&e.diagnostics[0];e&&this.props.parent.navigateToError(e)}filesOf(t){const e=t.isTopLevel(),i=t.getLanguageRestrictions();let n=t.sortedFiles();e&&(n=n.filter(e=>{switch(i){case"javascript-only":return!/\.(blocks|py)$/.test(e.name);case"python-only":return!/\.(blocks|ts)$/.test(e.name);default:return!0}}));const r={};return n.forEach(e=>{var t=e.name.lastIndexOf("/"),t=t<0?"":e.name.slice(0,t);(r[t]||(r[t]=[])).push(e)}),Object.keys(r).map(e=>w.createElement(o,{key:"folder-"+e,folder:e},this.folderFilesOf(t,e,r[e]))).reduce((e,t)=>e.concat(t),[])}folderFilesOf(p,h,f){const m=this.state["currentFile"],g=this.props.parent.state.header,b=p.isTopLevel(),v=pxt.shell.isReadOnly(),y=b&&!v;return f.map(e=>{const t=this.getData("open-meta:"+e.getName()),i=!!g&&!!g.githubId,n=b&&i&&/\.md$/.test(e.name)&&!/^_locales\//.test(e.name),r=e.name.replace(/\.[a-z]+$/,""),o=!v&&n&&`#tutorial:${g.id}:`+r,a=i&&pxt.github.parseRepoId(g.githubId),s=n&&a&&pxt.appTarget.appTheme.embedUrl&&`${window.location.origin}${window.location.pathname||""}#tutorial:github:${a.fullName}/`+r,l=`_locales/${pxt.Util.userLanguage()}/`+e.name,c=!v&&n&&pxt.Util.userLanguage()!==(pxt.appTarget.appTheme.defaultLocale||"en")&&!f.some(e=>e.name==l),d=y&&e.name!=pxt.CONFIG_NAME&&(i||e.name!=pxt.MAIN_TS)&&!e.isReadonly(),u=h.length?h.length+1:0;return w.createElement(x,{key:"file-"+e.getName(),file:e,meta:t,onItemClick:this.setFile,onItemRemove:this.removeFile,onErrorClick:this.navigateToError,onItemLocalize:this.addLocalizedFile,isActive:m==e,hasDelete:d,previewUrl:o,shareUrl:s,addLocalizedFile:c&&l,className:(m==e?"active ":"")+(p.isTopLevel()?"":"nested ")+(h?"folderitem ":"")+"item"},e.name.slice(u),"",t.isGitModified?" ↑":"",t.isReadonly?w.createElement(k.Icon,{icon:"lock"}):null)})}packageOf(e){var t=this.state.expandedPkg,i=e.getPkgId(),n=!pxt.shell.isReadOnly()&&i!=pxt.appTarget.id&&"built"!=i&&"assets"!=i&&i!=pxt.appTarget.corepkg&&e.getKsPkg().config&&!e.getKsPkg().config.core&&e.getKsPkg().level<=1,r=n&&"github"==(null==(r=e.getKsPkg())?void 0:r.verProtocol()),o=this.getData("open-pkg-meta:"+e.getPkgId());let a=r?e.getKsPkg().verArgument().split("#")[1]:void 0;return a&&20<a.length&&(a=a.substring(0,7)),[w.createElement(s,{key:"hd-"+i,pkg:e,isActive:t==i,onItemClick:this.togglePkg,hasDelete:n,onItemRemove:this.removePkg,version:a,hasRefresh:r,onItemRefresh:this.updatePkg},o.numErrors?w.createElement("span",{className:"ui label red"},o.numErrors):null,i,t==i?w.createElement("div",{role:"group",className:"menu"},this.filesOf(e)):void 0)]}packageContainsFile(e,t){return 0<e.sortedFiles().filter(e=>e==t).length}togglePkg(e){this.setState({expandedPkg:this.state.expandedPkg==e.getPkgId()?void 0:e.getPkgId()})}filesWithHeader(e){return e.isTopLevel()?this.filesOf(e):this.packageOf(e)}toggleVisibility(){this.props.parent.setState({showFiles:!this.props.parent.state.showFiles})}handleCustomBlocksClick(e){this.addCustomBlocksFile(),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}addProjectFile(){const e=u.mainEditorPkg(),d=/^[\w][\/\w\-\.]*$/;p.promptAsync({header:lf("Add new file?"),hasCloseIcon:!0,onInputValidation:e=>e?(e=e.trim(),d.test(e)?void 0:lf("Don't use spaces or special characters.")):lf("filename is empty."),body:lf("Please provide a name for your new file."),initialValue:e.files[h]?void 0:h}).then(e=>{if(!e)return Promise.resolve();var t=(e=e.replace(/\s+/g,"")).lastIndexOf(".");let i,n=e;-1!=t&&(n=e.slice(0,t),i=e.slice(t+1).toLowerCase());var t=u.mainPkg&&u.mainPkg.config,r=t&&t.languageRestriction;let o="ts",a="//",s=pxt.U.lf("Add your code here");if("python-only"===r&&(o="py",a="#"),i)switch(i){case"js":case"ts":break;case"py":"javascript-only"!==r&&(o="py",a="#");break;case"md":o="md",a="#",s=n;break;case"json":o="json",a=void 0;break;case"jres":o="jres",a=void 0;break;default:n=e}if(!n)return Promise.resolve();if(!d.test(n))return p.warningNotification(lf("Invalid file name")),Promise.resolve();const l=n+"."+o;if(u.mainEditorPkg().sortedFiles().some(e=>e.name==l))return p.warningNotification(lf("File already exists")),Promise.resolve();let c="";return l==h?c=m(pxt.appTarget.appTheme.homeUrl)+f:a&&(c=`${a} ${s}\n`),this.props.parent.updateFileAsync(l,c,!0)})}addCustomBlocksFile(){this.props.parent.state.header.githubId||pxt.appTarget.appTheme.addNewTypeScriptFile?this.addProjectFile():p.confirmAsync({header:lf("Add custom blocks?"),body:lf("A new JavaScript file, custom.ts, will be added to your project. You can define custom functions and blocks in that file.")}).then(e=>{if(e)return this.props.parent.updateFileAsync(h,m(pxt.appTarget.appTheme.homeUrl)+f,!0)})}renderCore(){var e=!!this.props.parent.state.showFiles,t=pxt.appTarget.appTheme,i=u.mainEditorPkg(),n=e&&!pxt.shell.isReadOnly()&&(!i.files[h]||pxt.appTarget.appTheme.addNewTypeScriptFile),i=this.getData("open-pkg-meta:"+i.getPkgId());return w.createElement("div",{role:"tree",className:`ui tiny vertical ${t.invertedMenu?"inverted":""} menu filemenu landscape only hidefullscreen`},w.createElement("div",{role:"treeitem","aria-selected":e,"aria-expanded":e,"aria-label":lf("File explorer toolbar"),key:"projectheader",className:"link item",onClick:this.toggleVisibility,tabIndex:0,onKeyDown:k.fireClickOnEnter},lf("Explorer"),w.createElement(k.Icon,{icon:`chevron ${e?"up":"down"} icon`}),n?w.createElement(k.Button,{className:"primary label",icon:"plus",title:lf("Add custom blocks?"),onClick:this.handleCustomBlocksClick,onKeyDown:this.handleButtonKeydown}):void 0,i.numErrors?w.createElement("span",{className:"ui label red"},i.numErrors):null),e?pxt.Util.concat(u.allEditorPkgs().map(e=>this.filesWithHeader(e))):void 0)}}i.FileList=r;class o extends k.StatelessUIElement{constructor(e){super(e)}renderCore(){var{folder:e,children:t}=this.props;return e?w.createElement(w.Fragment,null,w.createElement("div",{className:"folder item",role:"treeitem","aria-selected":!1,"aria-label":lf("Files in folder {0}",e)},w.createElement("i",{className:"folder open outline icon"}),e),t):t}}class x extends k.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.handlePreview=this.handlePreview.bind(this),this.handleShare=this.handleShare.bind(this),this.handleAddLocale=this.handleAddLocale.bind(this)}handleClick(e){this.props.onErrorClick&&this.props.meta&&this.props.meta.numErrors&&this.props.meta.diagnostics&&this.props.meta.diagnostics[0]?this.props.onErrorClick(this.props.meta):this.props.onItemClick(this.props.file),e.stopPropagation()}handleRemove(e){pxt.tickEvent("explorer.file.remove"),e.preventDefault(),e.stopPropagation(),this.props.onItemRemove(this.props.file)}handlePreview(e){pxt.tickEvent("explorer.file.preview"),e.preventDefault(),e.stopPropagation(),window.open(this.props.previewUrl,"_blank")}handleShare(e){pxt.tickEvent("explorer.file.share"),e.preventDefault(),e.stopPropagation(),p.dialogAsync({header:lf("Share this tutorial"),body:lf("The URL will start the MakeCode editor in your tutorial."),copyable:this.props.shareUrl,hasCloseIcon:!0})}handleAddLocale(e){pxt.tickEvent("explorer.file.addlocale");var{addLocalizedFile:t,onItemLocalize:i}=this.props;i&&t&&i(this.props.file,t),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}renderCore(){var{isActive:e,hasDelete:t,file:i,meta:n,previewUrl:r,shareUrl:o,addLocalizedFile:a,className:s}=this.props;return w.createElement("a",{onClick:this.handleClick,tabIndex:0,role:"treeitem","aria-selected":e,"aria-label":e?lf("{0}, it is the current opened file in the JavaScript editor",i.name):i.name,onKeyDown:k.fireClickOnEnter,className:s},this.props.children,t&&w.createElement(k.Button,{className:"primary label",icon:"trash",title:lf("Delete file {0}",i.name),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}),n&&n.numErrors?w.createElement("span",{className:"ui label red button",role:"button",title:lf("Go to error")},n.numErrors):void 0,o&&w.createElement(k.Button,{className:"button primary label",icon:"share alternate",title:lf("Share"),onClick:this.handleShare,onKeyDown:k.fireClickOnEnter}),r&&w.createElement(k.Button,{className:"button primary label",icon:"flask",title:lf("Preview"),onClick:this.handlePreview,onKeyDown:k.fireClickOnEnter}),!!a&&w.createElement(k.Button,{className:"primary label",icon:"xicon globe",title:lf("Add localized file"),onClick:this.handleAddLocale,onKeyDown:this.handleButtonKeydown}))}}class s extends k.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this)}handleClick(){this.props.onItemClick(this.props.pkg)}handleRefresh(e){e.stopPropagation(),this.props.onItemRefresh(this.props.pkg)}handleRemove(e){e.stopPropagation(),this.props.onItemRemove(this.props.pkg)}handleButtonKeydown(e){e.stopPropagation()}renderCore(){var e=this.props,{version:t,isActive:i,hasRefresh:n,hasDelete:r,pkg:o}=e,e=a(e,["onItemClick","onItemRemove","onItemRefresh","version","isActive","hasRefresh","hasDelete","pkg"]);return w.createElement("div",Object.assign({className:"header link item",role:"treeitem","aria-selected":i,"aria-expanded":i,"aria-label":lf("{0}, {1}",o.getPkgId(),i?lf("expanded"):lf("collapsed")),onClick:this.handleClick,tabIndex:0,onKeyDown:k.fireClickOnEnter},e),w.createElement(k.Icon,{icon:`chevron ${i?"up":"down"} icon`}),n?w.createElement(k.Button,{className:"primary label",icon:"refresh",title:lf("Refresh extension {0}",o.getPkgId()),onClick:this.handleRefresh,onKeyDown:this.handleButtonKeydown,text:t||""}):void 0,r?w.createElement(k.Button,{className:"primary label",icon:"trash",title:lf("Delete extension {0}",o.getPkgId()),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):void 0,this.props.children)}}},{"./core":64,"./data":67,"./package":108,"./sui":129,react:320}],82:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=i.setApiAsync=void 0;const n=e("./core");var s=pxt.Util,r=pxt.Cloud;let l=(e,t)=>s.requestAsync({url:"/api/"+e,headers:{Authorization:r.localToken},method:t?"POST":"GET",data:t||void 0}).then(e=>e.json).catch(n.handleNetworkError);function o(e,t,i){var n={files:[],config:null,header:e,path:e.path,isDeleted:e.isDeleted};if(i){t=t||{};for(var r of Object.keys(i))i[r]!==t[r]&&n.files.push({name:r,mtime:null,content:i[r],prevContent:t[r]});for(var o of Object.keys(t))void 0===i[o]&&n.files.push({name:o,mtime:null,content:null,prevContent:t[o]})}let a=s.flatClone(i||{});return l("pkg/"+e.path,n).then(e=>a)}i.setApiAsync=function(e){l=e},i.provider={getAsync:function(n){return l("pkg/"+n.path).then(e=>{var t,i={header:n,text:{},version:null};for(t of e.files)i.text[t.name]=t.content,n.modificationTime=Math.max(n.modificationTime,t.mtime/1e3|0);return n.recentUse=Math.max(n.recentUse,n.modificationTime),i.version=s.flatClone(i.text),i})},setAsync:o,listAsync:async function(){var e,t,i=await l("list");for(e of i.pkgs)e.header?e.header.path=e.path:((t=e.files.map(e=>e.mtime)).sort((e,t)=>t-e),t=Math.round(t[0]/1e3)||s.nowSeconds(),e.header=pxt.workspace.freshHeader(e.config.name,t),e.config.preferredEditor&&(e.header.editor=e.config.preferredEditor),e.header.path=e.path,await o(e.header,null));return i.pkgs.map(e=>e.header)},resetAsync:function(){return pxt.BrowserUtils.isPxtElectron()?l("resetworkspace",{}).then(()=>{}):Promise.resolve()},deleteAsync:function(e,t){return e.isDeleted=!0,o(e,t,{})},saveScreenshotAsync:function(e,t,i){return l("screenshot/"+e.path,{screenshot:t,icon:i})},saveAssetAsync:function(e,t,i){return l("pkgasset/"+e,{encoding:"base64",name:t,data:btoa(ts.pxtc.Util.uint8ArrayToString(i))}).then(e=>{})},listAssetsAsync:function(e){return l("pkgasset/"+e).then(e=>e.files)}}},{"./core":64}],83:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GithubButton=void 0;const s=e("react"),l=e("./sui"),n=e("./package"),c=e("./workspace");class r extends l.UIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.createRepository=this.createRepository.bind(this)}handleButtonKeydown(e){e.stopPropagation()}createRepository(e){pxt.tickEvent("github.button.create",void 0,{interactiveConsent:!0}),this.props.parent.createGitHubRepositoryAsync()}handleClick(e){e.stopPropagation();var e=this.props.parent.state["header"];e&&(e=e["githubId"],e)&&(pxt.tickEvent("github.button.nav"),e=n.mainEditorPkg().lookupFile("this/"+pxt.github.GIT_JSON))&&this.props.parent.setSideFile(e)}renderCore(){var e=this.props.parent.state.header;if(!e)return s.createElement("div",null);var t=e["githubId"],t=pxt.github.parseRepoId(t),i="ui icon button editortools-btn editortools-github-btn";if(!t)return s.createElement(l.Button,{key:"githubcreatebtn",className:i+" "+(this.props.className||""),icon:"github",title:lf("create GitHub repository"),ariaLabel:lf("create GitHub repository"),onClick:this.createRepository});var n=this.getData("pkg-git-status:"+e.id),e=n&&this.getData("pkg-git-pull-status:"+e.id),r=e==c.PullStatus.BranchNotFound,e=e==c.PullStatus.GotChanges,n=n&&!!n.modified,o=t.project&&t.tag?""+t.project+("master"==t.tag?"":"#"+t.tag):t.fullName;let a=t.tag&&"master"!=t.tag?"#"+t.tag:"";20<a.length&&(a=a.slice(0,18)+"..");t=r?lf("{0}: there is an issue with your GitHub connection.",o):e?lf("{0}: remote changes are ready to be pulled.",o):n?lf("{0}: review, commit & push local changes to GitHub.",o):lf("{0}: local changes are synchronized with GitHub.",o);return s.createElement("div",{key:"githubeditorbtn",role:"button",className:i+`
            `+(this.props.className||""),title:t,onClick:this.handleClick,onKeyDown:l.fireClickOnEnter,tabIndex:0},s.createElement("i",{className:"github icon"}),s.createElement("span",{className:"ui mobile hide"},a),s.createElement("i",{className:`ui long ${r?"exclamation circle":e?"arrow alternate down":n?"arrow alternate up":"check"} icon mobile hide`}))}}i.GithubButton=r},{"./package":108,"./sui":129,"./workspace":136,react:320}],84:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GithubProvider=i.PROVIDER_NAME=void 0;const a=e("react"),s=e("./sui"),l=e("./core"),n=e("./cloudsync"),r=e("./dialogs"),o=e("./workspace");i.PROVIDER_NAME="github";class c extends n.ProviderBase{constructor(){super(i.PROVIDER_NAME,lf("GitHub"),"icon github","https://api.github.com"),pxt.github.handleGithubNetworkError=(e,t)=>401==t.statusCode&&pxt.github.token?(pxt.log("github: invalid token"),this.clearToken(),"GET"==e.method):(403==t.statusCode?pxt.log("github: unauthorized access"):404==t.statusCode&&(t.needsWritePermission=!0),!1)}clearToken(){pxt.github.token=void 0,super.logout()}logout(){pxt.github.token=void 0,super.logout(),window.location.href="https://github.com/logout"}hasToken(){return this.loginCheck(),!!this.token()}loginCheck(){super.loginCheck();var e=this.token();pxt.github.token=e}loginAsync(e,t){return this.routedLoginAsync(void 0)}routedLoginAsync(e){this.loginCheck();let t=Promise.resolve();return(t=this.token()?t:t.then(()=>this.showLoginAsync(e))).then(()=>({accessToken:this.token()}))}showLoginAsync(t){pxt.tickEvent("github.login.dialog");let i,n=!(pxt.appTarget&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name]),r=!1;const e=e=>{r=e,l.forceUpdate()};return l.confirmAsync({header:lf("Sign in with GitHub"),hasCloseIcon:!0,helpUrl:"/github",agreeLbl:lf("Sign in"),onLoaded:e=>{i=e},jsxd:()=>a.createElement("div",{className:"ui form"},a.createElement("p",null,lf("You need to sign in with GitHub to use this feature.")),a.createElement("p",null,lf("You can host your code on GitHub and collaborate with friends on projects.")),a.createElement("div",null,a.createElement(s.PlainCheckbox,{label:lf("Remember me"),onChange:e})),!n&&a.createElement("p",{className:"ui small"},lf("Looking to use a Developer token instead?"),a.createElement(s.Link,{className:"link",text:lf("Use Developer token"),onClick:o,href:"#"})),n&&a.createElement("ol",null,a.createElement("li",null,lf("Navigate to: "),a.createElement("a",{href:"https://github.com/settings/tokens/new",target:"_blank",rel:"noopener noreferrer"},lf("GitHub token generation page"))),a.createElement("li",null,lf("Put something like 'MakeCode {0}' in description",pxt.appTarget.name)),a.createElement("li",null,lf("Select either '{0}' or '{1}' scope, depending which repos you want to edit from here","repo","public_repo")),a.createElement("li",null,lf("Click generate token, copy it, and paste it below."))),n&&a.createElement("div",{className:"ui field"},a.createElement("label",{id:"selectUrlToOpenLabel"},lf("Paste GitHub token here:")),a.createElement("input",{id:"githubTokenInput",type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:"ghp_ABC...",className:"ui blue fluid"})))}).then(e=>{if(e){if(n){const t=i.querySelector("#githubTokenInput"),n=null==(e=null==t?void 0:t.value)?void 0:e.trim();return this.saveAndValidateTokenAsync(n,r)}return this.oauthRedirectAsync(r,t)}return pxt.tickEvent("github.login.cancel"),Promise.resolve()});function o(){n=!0,l.forceUpdate()}}authorizeAppAsync(e,t){return this.oauthRedirectAsync(e,t||window.location.hash,!0)}oauthRedirectAsync(e,t,i){l.showLoading("ghlogin",lf("Signing you into GitHub...")),t=(t||"").replace(/^#/,"");e=n.setOauth(this.name,e,t?"#github:"+t:void 0),t=window.location.href.replace(/#.*/,""),e=pxt.Cloud.getServiceUrl()+"/oauth/login?state="+e+(i?"&prompt=consent":"")+"&response_type=token&client_id=gh-token&redirect_uri="+encodeURIComponent(t);return window.location.href=e,pxt.Util.delay(1e3)}getUserInfoAsync(){return this.token()?pxt.github.authenticatedUserAsync().then(e=>{if(e)return{id:e.login,userName:e.login,name:e.name,photo:e.avatar_url,profile:"https://github.com/"+e.login};pxt.log("unknown github user")}):Promise.resolve(void 0)}setNewToken(e,t){super.setNewToken(e,t),pxt.github.token=e}saveAndValidateTokenAsync(t,i){return l.showLoading("githubtokensave",lf("validating GitHub token...")),Promise.resolve().then(()=>(pxt.github.token=t,pxt.github.createRepoAsync(void 0,"").then(e=>{pxt.reportError("github","Succeeded creating undefined repo!"),l.infoNotification(lf("Something went wrong with validation; token stored")),this.setNewToken(t,i),pxt.tickEvent("github.token.wrong")},e=>{pxt.github.token="",r.showGithubTokenError(e)||(422==e.statusCode?l.infoNotification(lf("Token validated and stored")):l.infoNotification(lf("Token stored but not validated")),this.setNewToken(t,i),pxt.tickEvent("github.token.ok"))}).then(()=>n.syncAsync()))).finally(()=>l.hideLoading("githubtokensave"))}async createRepositoryAsync(e,t){if(pxt.tickEvent("github.filelist.create.start"),await this.routedLoginAsync("create-repository:"+t.id),!this.token())return pxt.tickEvent("github.filelist.create.notoken"),!1;e=await r.showCreateGithubRepoDialogAsync(e);if(!e)return!1;pxt.tickEvent("github.filelist.create.export");var i=pxt.github.parseRepoId(e);l.showLoading("creategithub",lf("preparing {0} repository...",i.project||i.fullName));try{return await o.exportToGithubAsync(t,e),!0}finally{l.hideLoading("creategithub")}}}i.GithubProvider=c},{"./cloudsync":15,"./core":64,"./dialogs":74,"./sui":129,"./workspace":136,react:320}],85:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const y=e("react"),g=e("./package"),d=e("./core"),n=e("./srceditor"),w=e("./sui"),b=e("./workspace"),r=e("./dialogs"),u=e("./coretsx"),o=e("./data"),a=e("./marked"),s=e("./compiler"),l=e("./cloudsync"),c=e("./tutorial"),p=e("./package");class h extends o.Component{constructor(e){super(e),this.diffCache={},this.goBack=this.goBack.bind(this),this.handlePullClick=this.handlePullClick.bind(this),this.handleBranchClick=this.handleBranchClick.bind(this),this.handleGithubError=this.handleGithubError.bind(this),this.handlePullRequest=this.handlePullRequest.bind(this)}clearCacheDiff(e,t){t?delete this.diffCache[e+t.name]:this.diffCache={}}cachedDiff(e,t){let i=this.diffCache[e+t.name];return i&&i.file.file===t.file||(i={file:t},this.diffCache[e+t.name]=i),i}fastForwardMergeAsync(e,t,i){return i=i||t.title||lf("Merge pull request"),d.showLoading("github.merge",lf("merging pull request...")),pxt.github.mergeAsync(e.fullName,t.base,e.tag,`${i} (#${t.number})`).then(()=>this.switchProjectToBranchAsync(t.base)).then(()=>this.pullAsync()).then(()=>{d.hideLoading("github.merge"),d.infoNotification("Pull request merged successfully!")}).then(()=>this.handleGithubError).finally(()=>d.hideLoading("github.merge")).then(()=>{})}async revertAllFilesAsync(){var e;pxt.tickEvent("github.revertall",{start:1},{interactiveConsent:!0}),await d.confirmAsync({header:lf("Would you like to revert all local changes?"),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"})&&(pxt.tickEvent("github.revertall",{ok:1}),this.setState({needsCommitMessage:!1}),e=this.props.parent.state["header"],await b.revertAllAsync(e),await this.props.parent.reloadHeaderAsync())}async revertFileAsync(t,i,n,r){if(pxt.tickEvent("github.revert",{start:1},{interactiveConsent:!0}),await d.confirmAsync({header:lf("Would you like to revert changes to {0}?",t.name),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"})){pxt.tickEvent("github.revert",{ok:1}),this.setState({needsCommitMessage:!1});let e=!1;var o=g.mainEditorPkg();if(null==t.gitFile){e=!0,await o.removeFileAsync(t.name);for(const t of r)await o.removeFileAsync(t.name)}else if(t.name==pxt.CONFIG_NAME){e=!0;const r=this.getGitJson(),g=this.parsedRepoId();for(var a of i){const i=pxt.github.lookupFile(g,r.commit,a);o.setFile(a,i&&i.blobContent||"// Cannot restore.")}for(var s of n)delete o.files[s];await t.file.setContentAsync(t.gitFile)}else{await t.file.setContentAsync(t.gitFile),o.files;for(const t of r)null==t.baseGitContent?(e=!0,await o.removeFileAsync(t.name)):await t.setContentAsync(t.baseGitContent)}e?await this.props.parent.reloadHeaderAsync():this.forceUpdate()}}async saveGitJsonAsync(e){await g.mainEditorPkg().files[pxt.github.GIT_JSON].setContentAsync(JSON.stringify(e,null,4))}async switchProjectToBranchAsync(e){var t=this.props.parent.state["header"],i=this.getGitJson(),n=this.parsedRepoId();t.githubId=n.fullName+"#"+e,i.repo=t.githubId,await this.saveGitJsonAsync(i),g.invalidatePullRequestStatus(t)}async newBranchAsync(){await l.ensureGitHubTokenAsync();const e=this.parsedRepoId(),t=await pxt.github.getNewBranchNameAsync(e.slug,"patch-"),i=await d.promptAsync({header:lf("New branch name"),body:lf("Name cannot have spaces or special characters. Examples: {0}","my_feature, add-colors, fix_something"),agreeLbl:lf("Create"),initialValue:t,hasCloseIcon:!0,onInputValidation:e=>{if(/[^\w\-]/.test(e))return lf("Don't use spaces or special characters.")}});if(i){this.showLoading("github.branch",!0,lf("creating branch..."));try{const t=this.getGitJson();await pxt.github.createNewBranchAsync(e.slug,i,t.commit.sha),await this.switchProjectToBranchAsync(i),this.forceUpdate()}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}async switchBranchAsync(e){await this.setStateAsync({needsCommitMessage:!1});var t=this.parsedRepoId().tag;try{await this.switchProjectToBranchAsync(e),await this.pullAsync()}finally{this.state.needsCommitMessage&&await this.switchProjectToBranchAsync(t)}}async showSwitchBranchDialogAsync(){const e=this.parsedRepoId(),t=await pxt.github.listRefsExtAsync(e.slug,"heads"),i=Object.keys(t.refs).map(e=>({name:e,description:t.refs[e],onClick:async()=>{d.hideDialog(),await this.switchBranchAsync(e)}}));"master"==e.tag&&i.unshift({name:lf("Create new branch"),description:lf("Based on {0}",e.tag),onClick:()=>(d.hideDialog(),this.newBranchAsync())}),await d.confirmAsync({header:lf("Switch to a different branch"),hasCloseIcon:!0,hideAgree:!0,jsx:y.createElement("div",{className:"ui form"},y.createElement("div",{className:"ui relaxed divided list",role:"menu"},i.map(e=>y.createElement("div",{key:e.name,className:"item link"},y.createElement("i",{className:"large github middle aligned icon"}),y.createElement("div",{className:"content"},y.createElement("a",{onClick:e.onClick,role:"menuitem",className:"header",tabIndex:0,onKeyDown:w.fireClickOnEnter},e.name),y.createElement("div",{className:"description"},e.description))))))})}handleBranchClick(e){pxt.tickEvent("github.branch"),e.stopPropagation(),this.showSwitchBranchDialogAsync()}goBack(){pxt.tickEvent("github.backButton",void 0,{interactiveConsent:!0}),this.props.parent.openPreviousEditor()}handlePullClick(e){pxt.tickEvent("github.pull"),this.pullAsync()}async forkAsync(e){const t=this.parsedRepoId(),i=l.githubProvider().user();let n,r=!1;e&&i&&t.owner!==i.userName&&await pxt.github.isOrgAsync(t.owner)&&(n=y.createElement("div",{className:"ui small"},lf("If you already have write permissions to this repository, you may have to authorize the MakeCode App in the {0} organization.",t.owner),y.createElement(w.PlainCheckbox,{label:lf("Remember me"),onChange:e=>{r=e,d.forceUpdate()}}),y.createElement(w.Link,{className:"ui link",text:lf("Authorize MakeCode"),onClick:()=>{pxt.tickEvent("github.authorize"),l.githubProvider().authorizeAppAsync(r)},onKeyDown:w.fireClickOnEnter})));var o=e&&y.createElement("div",{className:"ui message warning"},lf("Oops, we could not write to {0}.",t.slug),n),a=y.createElement("p",null,lf("Forking creates a copy of {0} under your account. You can submit your changes back via a pull request.",t.slug));if(await d.confirmAsync({header:lf("Do you want to fork {0}?",t.slug),hasCloseIcon:!0,helpUrl:"/github/fork",jsx:y.createElement("div",null,o,a),agreeLbl:"Fork",agreeIcon:"copy outline"})){this.showLoading("github.fork",!0,lf("forking repository (this may take a minute or two)..."));try{const e=this.getGitJson(),i=await pxt.github.forkRepoAsync(t.slug,e.commit.sha),y=this.props.parent.state["header"];y.githubId=i,e.repo=y.githubId,await this.saveGitJsonAsync(e)}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}handleGithubError(e){var t=parseInt(e.statusCode);e.isOffline||0===t?d.warningNotification(lf("Please connect to internet and try again.")):e.needsWritePermission?(d.hideDialog(),this.forkAsync(!0)):e.isMergeConflictMarkerError?(pxt.tickEvent("github.commitwithconflicts"),d.warningNotification(lf("Please merge all conflicts before commiting changes."))):401==t?(l.githubProvider().clearToken(),this.forceUpdate(),d.warningNotification(lf("Please sign in to GitHub again."))):404==t?d.warningNotification(lf("GitHub resource not found; please check that it still exists.")):403==t?d.warningNotification(lf("GitHub rate limit exceeded, please wait and try again.")):(pxt.reportException(e),d.warningNotification(lf("Oops, something went wrong. Please try again.")))}async bumpAsync(){try{b.prepareConfigForGithub(g.mainPkg.readFile(pxt.CONFIG_NAME),!0)}catch(t){return void d.warningNotification(t.message)}let t=g.mainPkg.config.version;try{const e=this.parsedRepoId(),i=await pxt.github.listRefsAsync(e.slug,"tags");t=pxt.semver.sortLatestTags(i)[0]}catch(t){console.log(t)}const e=pxt.semver.parse(t,"0.0.0"),i=pxt.semver.parse(pxt.semver.stringify(e)),n=(i.major++,i.minor=0,i.patch=0,pxt.semver.parse(pxt.semver.stringify(e))),r=(n.minor++,n.patch=0,pxt.semver.parse(pxt.semver.stringify(e)));r.patch++;let o="patch";function a(e){o=e.currentTarget.name,u.forceUpdate()}let s=!1;function l(e){s=!s,u.forceUpdate()}if(await d.confirmAsync({header:lf("Pick a release version"),agreeLbl:lf("Create release"),disagreeLbl:lf("Cancel"),jsxd:()=>y.createElement("div",null,y.createElement("div",{className:"grouped fields"},y.createElement("label",null,lf("Choose a release version that describes the changes you made to the code."),w.helpIconLink("/github/release#versioning",lf("Learn about version numbers."))),y.createElement("div",{className:"field"},y.createElement("div",{className:"ui radio checkbox"},y.createElement("input",{type:"radio",name:"patch",checked:"patch"==o,"aria-checked":"patch"==o,onChange:a}),y.createElement("label",null,lf("{0}: patch (bug fixes or other non-user visible changes)",pxt.semver.stringify(r))))),y.createElement("div",{className:"field"},y.createElement("div",{className:"ui radio checkbox"},y.createElement("input",{type:"radio",name:"minor",checked:"minor"==o,"aria-checked":"minor"==o,onChange:a}),y.createElement("label",null,lf("{0}: minor change (added function or optional parameters)",pxt.semver.stringify(n))))),y.createElement("div",{className:"field"},y.createElement("div",{className:"ui radio checkbox"},y.createElement("input",{type:"radio",name:"major",checked:"major"==o,"aria-checked":"major"==o,onChange:a}),y.createElement("label",null,lf("{0}: major change (renamed functions, deleted parameters or functions)",pxt.semver.stringify(i)))))),y.createElement("div",{className:"grouped fields"},y.createElement("label",null,lf("Advanced")),y.createElement("div",{className:"field checkbox"},y.createElement("input",{type:"checkbox",name:"cachetutorial",checked:s,"aria-checked":s,onChange:l}),y.createElement("label",null,lf("Optimize for tutorials by caching information about the markdown.")))))})){let e=r;"major"==o?e=i:"minor"==o&&(e=n);var c=pxt.semver.stringify(e);this.showLoading("github.release.new",!0,lf("creating release..."));try{const t=this.props.parent.state["header"];s&&await this.cacheTutorialInfo(t),await b.bumpAsync(t,c),g.mainPkg.config.version=c,await this.maybeReloadAsync(),this.hideLoading(),d.infoNotification(lf("GitHub release created."))}catch(t){this.handleGithubError(t)}finally{this.hideLoading()}}}async cacheTutorialInfo(e){const t=/\.md$/,i=this.parsedRepoId();let n=await b.getTextAsync(e.id),r=Object.keys(n).filter(e=>e.match(t));var o,a={};for(o of r){const r=pxt.tutorial.parseTutorial(n[o]),s=pxt.BrowserUtils.getTutorialCodeHash(r.code),l=await c.getUsedBlocksAsync(r.code,o,r.language,!0);if(l){const n=o.replace(t,"");a["https://github.com/"+i.fullName+("README"==n?"":"/"+n)]={snippetBlocks:l.snippetBlocks,usedBlocks:l.usedBlocks,hash:s}}}n[pxt.TUTORIAL_INFO_FILE]=JSON.stringify(a);let s=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]);return s.files.indexOf(pxt.TUTORIAL_INFO_FILE)<0&&(s.files.push(pxt.TUTORIAL_INFO_FILE),n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(s)),await b.saveAsync(e,n),this.commitAsync()}async showLoading(e,t,i){t&&await l.ensureGitHubTokenAsync(),pxt.tickEvent(e),await this.setStateAsync({loadingMessage:i}),d.showLoading("githubjson",i)}hideLoading(){this.state.loadingMessage&&(d.hideLoading("githubjson"),this.setState({loadingMessage:void 0}))}pkgConfigKey(e){e=JSON.parse(e);return delete e.version,JSON.stringify(e)}async maybeReloadAsync(){var e=this.props.parent.state["header"],t=await b.getTextAsync(e.id),t=(g.mainEditorPkg().setFiles(t),this.pkgConfigKey(t[pxt.CONFIG_NAME]));p.invalidatePullStatus(e),t!=this.state.previousCfgKey&&(await this.setStateAsync({previousCfgKey:t}),await this.props.parent.reloadHeaderAsync())}async pullAsync(){this.showLoading("github.pull",!1,lf("pulling changes from GitHub..."));var e=this.props.parent.state["header"];try{switch(await b.pullAsync(this.props.parent.state.header)){case b.PullStatus.NoSourceControl:case b.PullStatus.UpToDate:break;case b.PullStatus.NeedsCommit:this.setState({needsCommitMessage:!0});break;case b.PullStatus.GotChanges:await this.maybeReloadAsync()}}catch(e){this.handleGithubError(e)}finally{p.invalidatePullStatus(e),this.hideLoading()}}getGitJson(){return g.mainPkg.readGitJson()}parsedRepoId(){var e=this.props.parent.state.header;return pxt.github.parseRepoId(e.githubId)}async commitCoreAsync(){var e,t=this.props["parent"],t=t.state["header"],i=t.githubId;await b.pullAsync(t),await b.hasMergeConflictMarkersAsync(t)?(await this.maybeReloadAsync(),d.warningNotification(lf("Merge conflicts found. Resolve them before commiting."))):((e=await b.commitAsync(t,{message:this.state.description,blocksScreenshotAsync:()=>{var e;return this.props.parent.blocksScreenshotAsync(1,null==(e=pxt.appTarget.appTheme)?void 0:e.embedBlocksInSnapshot)},blocksDiffScreenshotAsync:()=>{var e=g.mainEditorPkg().sortedFiles().find(e=>e.name==pxt.MAIN_BLOCKS),e=pxt.blocks.diffXml(e.baseGitContent,e.content);return e&&e.ws?pxt.blocks.layout.toPngAsync(e.ws,1):Promise.resolve(void 0)}}))?(e=await b.prAsync(t,e,this.state.description||lf("Commit conflict")),await r.showPRDialogAsync(i,e),await b.pullAsync(t)):(g.invalidatePagesStatus(t),g.invalidatePullRequestStatus(t),await this.maybeReloadAsync()),this.setState({description:""}))}async commitAsync(){let t=!0;this.setState({needsCommitMessage:!1}),this.showLoading("github.commit",!0,lf("commit and push changes to GitHub..."));try{await this.commitCoreAsync(),await this.maybeReloadAsync()}catch(e){t=!1,pxt.tickEvent("github.commit.fail"),this.handleGithubError(e)}finally{t&&pxt.tickEvent("github.commit.success"),this.hideLoading()}}setVisible(e){var t;e!==this.state.isVisible&&(t=this.props.parent.state["header"],e?(o.invalidateHeader("pkg-git-pr",t),this.setState({previousCfgKey:this.pkgConfigKey(g.mainEditorPkg().files[pxt.CONFIG_NAME].content)})):(this.clearCacheDiff(),this.setState({needsCommitMessage:!1})))}async handlePullRequest(){const e=this.parsedRepoId();if(await d.confirmAsync({header:lf("Create pull request"),jsx:y.createElement("p",null,lf("Pull requests let you tell others about changes you've pushed to a branch in a repository on GitHub.")),helpUrl:"/github/pull-request",hasCloseIcon:!0})){var t=e.tag;this.showLoading("github.createpr",!0,lf("creating pull request..."));try{const e=this.parsedRepoId(),i=`
### ${lf("How to use this pull request")}

- [ ] ${lf("assign a reviewer (you can be your own reviewer)")}
- [ ] ${lf("reviewer approves or requests changes")}
- [ ] ${lf("apply requested changes if any")}
- [ ] ${lf("merge once approved")}
`,y=await pxt.github.createPRFromBranchAsync(e.slug,"master",e.tag,t,i);o.invalidateHeader("pkg-git-pr",this.props.parent.state.header),d.infoNotification(lf("Pull request created successfully!",y))}catch(e){422==e.statusCode?d.warningNotification(lf("Please commit changes before creating a pull request.")):this.handleGithubError(e)}finally{this.hideLoading()}}}computeDiffFiles(){const r=g.mainEditorPkg().sortedFiles();return r.map(e=>{const t=e.publishedContent();if(e.baseGitContent!=t){var i={file:e,name:e.name,gitFile:e.baseGitContent,editorFile:t};if(/\.blocks$/.test(e.name)){const t=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),n=r.find(e=>e.name==t);n&&(i.tsGitFile=n.baseGitContent,i.tsEditorFile=n.publishedContent())}return i}}).filter(e=>!!e)}renderCore(){var e,t,i,n,r,o,a,s,l,c,d,u,p,h,f,m=this.getGitJson();return m?(u=this.props.parent.state["header"],e=g.mainPkg.getPreferredEditor()==pxt.BLOCKS_PROJECT_NAME,i=0<(t=this.computeDiffFiles()).length,r=(n=this.getData("pkg-git-pull-status:"+u.id))==b.PullStatus.BranchNotFound||n==b.PullStatus.NoSourceControl,o=n==b.PullStatus.GotChanges,s="master"==(a=this.parsedRepoId()).tag,l=this.getData("github:user"),c=`https://github.com/${a.slug}/`+(s&&!a.fileName?"":pxt.github.join("tree",a.tag||"master",a.fileName)),d=!pxt.github.token,p=(h=null!==(u=this.getData("pkg-git-pr:"+u.id))&&(m.isFork||!s))&&u&&0<u.number,h=h&&u&&u.number<=0,f=l&&l.id===a.owner,y.createElement("div",{id:"githubArea"},y.createElement("div",{className:"ui serialHeader"},y.createElement("div",{className:"leftHeaderWrapper"},y.createElement("div",{className:"leftHeader"},y.createElement(w.Button,{title:lf("Go back"),icon:"arrow left",text:lf("Go back"),textClass:"landscape only",tabIndex:0,onClick:this.goBack,onKeyDown:w.fireClickOnEnter}))),y.createElement("div",{className:"rightHeader"},y.createElement(w.Button,{icon:r?"exclamation circle":o?"long arrow alternate down":"check",className:!0==o?"positive":"",text:lf("Pull changes"),title:lf("Pull changes from GitHub to get your code up-to-date."),onClick:this.handlePullClick,onKeyDown:w.fireClickOnEnter}),!e&&f&&y.createElement(w.Link,{className:"ui item button desktop only",icon:"user plus",href:`https://github.com/${a.slug}/settings/collaboration`,target:"_blank",title:lf("Invite others to contributes to this GitHub repository.")}),y.createElement(w.Link,{className:"ui button",icon:"external alternate",href:c,title:lf("Open repository in GitHub."),target:"_blank",onKeyDown:w.fireClickOnEnter}))),y.createElement(k,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),y.createElement("div",{className:"ui form"},p&&y.createElement(w.Link,{href:u.url,role:"button",className:"ui tiny basic button create-pr",target:"_blank",text:lf("Pull request (#{0})",u.number),icon:"external alternate"}),h&&y.createElement(w.Button,{className:"tiny basic create-pr",text:lf("Create pull request"),onClick:this.handlePullRequest}),y.createElement("h3",{className:"header"},y.createElement("i",{className:"large github icon"}),y.createElement("span",{className:"repo-name"},a.fullName),y.createElement("span",{onClick:this.handleBranchClick,onKeyDown:w.fireClickOnEnter,tabIndex:0,role:"button",className:"repo-branch"},"#"+a.tag,y.createElement("i",{className:"dropdown icon"}))),i&&y.createElement(x,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),p&&!i&&y.createElement(E,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),t&&y.createElement(v,{parent:this,diffFiles:t,cacheKey:m.commit.sha,allowRevert:!0,showWhitespaceDiff:!0,blocksMode:e,showConflicts:!0}),y.createElement(S,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),s&&y.createElement(C,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),!e&&y.createElement(_,{parent:this,needsToken:d,githubId:a,master:s,gs:m,isBlocks:e,needsCommit:i,user:l,pullStatus:n,pullRequest:u}),y.createElement("div",null)))):y.createElement("div",null)}}class v extends w.StatelessUIElement{constructor(e){super(e),this.revertAllFiles=this.revertAllFiles.bind(this)}lineDiff(e,t){var i=pxt.diff.compute(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!i)return{a:y.createElement("div",{className:"inline-diff"},y.createElement("code",null,e)),b:y.createElement("div",{className:"inline-diff"},y.createElement("code",null,t))};var n=[],r=[];for(let t=0;t<i.length;){let e=t;for(var o=i[t][0];i[e]&&i[e][0]==o;)e++;var a=i.slice(t,e).map(e=>e.slice(2)).join("");" "==o?(n.push(y.createElement("code",{key:t,className:"ch-common"},a)),r.push(y.createElement("code",{key:t,className:"ch-common"},a))):"-"==o?n.push(y.createElement("code",{key:t,className:"ch-removed"},a)):"+"==o?r.push(y.createElement("code",{key:t,className:"ch-added"},a)):pxt.Util.oops(),t=e}return{a:y.createElement("div",{className:"inline-diff"},n),b:y.createElement("div",{className:"inline-diff"},r)}}showDiff(t){const{cacheKey:i,blocksMode:n,showConflicts:r,showWhitespaceDiff:o}=this.props,a=this.props.parent.cachedDiff(i,t);if(a.diff&&a.file.gitFile==t.gitFile&&a.file.editorFile==t.editorFile)return a.diff;const s=/\.blocks$/.test(t.name),l=()=>{a.whitespace||(a.whitespace=!0,a.diff=e(),this.forceUpdate())},e=()=>{var e=s?this.createBlocksDiffJSX(t):this.createTextDiffJSX(t,!a.whitespace);return y.createElement("div",{key:"difffile"+i+t.name,className:"ui segments filediff"},y.createElement("div",{className:"ui segment diffheader"},(!n||t.name!=pxt.MAIN_BLOCKS)&&y.createElement("span",null,t.name),!!a.revert&&y.createElement(w.Button,{className:"small",icon:"undo",text:lf("Revert"),ariaLabel:lf("Revert file"),title:lf("Revert file"),textClass:"landscape only",onClick:a.revert}),e.legendJSX,r&&!!e.conflicts&&y.createElement("p",null,lf("Merge conflicts found. Resolve them before commiting.")),!!a.revert&&!!c.length&&y.createElement("p",null,lf("Reverting this file will also restore: {0}",c.join(", "))),!!a.revert&&!!d.length&&y.createElement("p",null,lf("Reverting this file will also remove: {0}",d.join(", "))),!!a.revert&&!!u.length&&!n&&y.createElement("p",null,lf("Reverting this file will also revert: {0}",u.map(e=>e.name).join(", ")))),e.diffJSX?y.createElement("div",{className:"ui segment diff"},e.diffJSX):y.createElement("div",{className:"ui segment"},y.createElement("p",null,lf("Whitespace changes only."),o&&y.createElement(w.Link,{className:"link",text:lf("Show"),onClick:l}))))};let c=[],d=[];if(t.name==pxt.CONFIG_NAME){const i=pxt.Package.parseAndValidConfig(t.gitFile),n=pxt.Package.parseAndValidConfig(t.editorFile);if(i&&n){const t=pxt.allPkgFiles(i),y=pxt.allPkgFiles(n);c=t.filter(e=>-1==y.indexOf(e)),d=y.filter(e=>-1==t.indexOf(e))}}const u=[];if(a.file=t,this.props.allowRevert){const i=g.mainEditorPkg().files,y=n&&i[t.file.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];y&&y!=t.file&&u.push(y);for(const i of g.mainEditorPkg().getGeneratedFiles(t.file))u.push(i);a.revert=()=>this.props.parent.revertFileAsync(t,c,d,u)}return a.diff=e(),a.diff}createBlocksDiffJSX(e){var t=e.gitFile||"",i=e.editorFile;let n;return{diffJSX:n=i?(t=e.tsEditorFile&&pxt.blocks.needsDecompiledDiff(t,i)?`
\`\`\`diffblocks
${e.tsGitFile||""}
---------------------
${e.tsEditorFile}
\`\`\`
`:`
\`\`\`diffblocksxml
${t}
---------------------
${i}
\`\`\`
`,y.createElement(a.MarkedContent,{key:"diffblocksxxml"+e.name,parent:this.props.parent.props.parent,markdown:t})):y.createElement("div",{className:"ui basic segment"},lf("Your blocks were updated. Go back to the editor to view the changes.")),legendJSX:y.createElement("p",{className:"legend"},y.createElement("span",null,y.createElement("span",{className:"added icon"}),lf("added, changed or moved")),y.createElement("span",null,y.createElement("span",{className:"deleted icon"}),lf("deleted")),y.createElement("span",null,y.createElement("span",{className:"notchanged icon"}),lf("not changed")),w.helpIconLink("/github/diff#blocks",lf("Learn about reading differences in blocks code."))),conflicts:0}}createTextDiffJSX(l,e){const c=this.props["showConflicts"],t=l.gitFile||"",i=l.editorFile||"",d={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},u=pxt.diff.compute(t,i,{ignoreWhitespace:!!e});if(!u)return pxt.tickEvent("github.diff.toobig"),{diffJSX:y.createElement("div",null,lf("Too many differences to render diff.")),conflicts:0};let p=0,h="",f=0,m=0,g="",b=null;const v=[];return u.forEach((e,t)=>{const i=/^@@ -(\d+),\d+ \+(\d+),\d+/.exec(e);i?(f=parseInt(i[1])-1,m=parseInt(i[2])-1):("+"!=e[0]&&f++,"-"!=e[0]&&m++);var n=u[t+1]?u[t+1][0]:"",r=u[t+2]?u[t+2][0]:"",o=e.slice(2);let a=y.createElement("code",null,o);if(b)a=b,b=null;else if(!("-"!=e[0]||" "!=g&&"@"!=g||"+"!=n||" "!=r&&"@"!=r&&""!=r)){const l=this.lineDiff(e.slice(2),u[t+1].slice(2));a=l.a,b=l.b}let s=g=e[0];if("+"==g&&/^<<<<<<<[^<]/.test(o)){p++,h="local",s="@",v.push(y.createElement("tr",{key:"conflictheader"+f+m,className:"conflict ui small header"},y.createElement("td",{colSpan:4,className:"ui small header"},lf("Merge conflict")))),v.push(y.createElement("tr",{key:"conflictdescr"+f+m,className:"conflict ui description"},y.createElement("td",{colSpan:4,className:"ui small description"},lf("Changes from GitHub are conflicting with local changes."),w.helpIconLink("/github/merge-conflict",lf("Learn about merge conflicts and resolution.")))));const e=Math.min(f,m),t=()=>this.handleMergeConflictResolution(l,e,!0,!1),i=()=>this.handleMergeConflictResolution(l,e,!1,!0),d=()=>this.handleMergeConflictResolution(l,e,!0,!0);c&&v.push(y.createElement("tr",{key:"merge"+f+m,className:"conflict ui mergebtn"},y.createElement("td",{colSpan:4,className:"ui"},y.createElement(w.Button,{className:"compact",text:lf("Keep local"),title:lf("Ignore the changes from GitHub."),onClick:t}),y.createElement(w.Button,{className:"compact",text:lf("Keep remote"),title:lf("Override local changes with changes from GitHub."),onClick:i}),y.createElement(w.Button,{className:"compact",text:lf("Keep both"),title:lf("Keep both local and remote changes."),onClick:d}))))}else"+"==g&&/^>>>>>>>[^>]/.test(o)?(h="footer",s="@"):"+"==g&&/^=======$/.test(o)&&(s="@",h="remote");n="@"==s,r=`${h?"conflict":""} ${h} `+d[s];v.push(y.createElement("tr",{key:f+m,className:r},y.createElement("td",{className:"line-a","data-content":f}),y.createElement("td",{className:"line-b","data-content":m}),n?y.createElement("td",{colSpan:2,className:"change"},y.createElement("code",null,e)):y.createElement("td",{className:"marker","data-content":s}),n?void 0:y.createElement("td",{className:"change"},a))),"footer"==h&&(h="")}),{diffJSX:v.length?y.createElement("table",{className:"diffview"},y.createElement("tbody",null,v)):void 0,legendJSX:void 0,conflicts:p}}handleMergeConflictResolution(e,t,i,n){pxt.tickEvent("github.conflict.resolve",{local:i?1:0,remote:n?1:0},{interactiveConsent:!0});t=pxt.diff.resolveMergeConflictMarker(e.file.content,t,i,n);e.file.setContentAsync(t).then(()=>this.props.parent.clearCacheDiff(this.props.cacheKey,e)).then(()=>this.props.parent.forceUpdate())}revertAllFiles(){this.props.parent.revertAllFilesAsync()}renderCore(){var{diffFiles:e,blocksMode:t,allowRevert:i}=this.props,n=pxt.appTarget.appTheme,n=n.invertedMenu&&n.invertedMonaco,t=t&&!pxt.options.debug?e.filter(e=>/\.blocks$/.test(e.name)):e;return e.length?y.createElement("div",{className:"ui section"},y.createElement("div",{className:`ui ${n?"inverted ":""} diffheader segment`},lf("There are local changes."),i&&y.createElement(w.Button,{className:"small",icon:"undo",text:lf("Revert all"),ariaLabel:lf("Revert all changes"),title:lf("Revert all changes"),textClass:"landscape only",onClick:this.revertAllFiles})),t.map(e=>this.showDiff(e))):y.createElement("div",{className:`ui ${n?"inverted ":""}segment`},lf("No local changes found."))}}class k extends w.StatelessUIElement{constructor(e){super(e),this.handleSwitchMasterBranch=this.handleSwitchMasterBranch.bind(this)}handleSwitchMasterBranch(e){pxt.tickEvent("github.branch.switch"),e.stopPropagation(),this.props.parent.switchBranchAsync("master")}renderCore(){var e=this.props.parent.state["needsCommitMessage"],{pullStatus:t,pullRequest:i,githubId:n}=this.props,r="CLOSED"==(null==i?void 0:i.state),i="MERGED"==(null==i?void 0:i.state);return r||i?y.createElement("div",{className:"ui icon negative message"},y.createElement("i",{className:"exclamation circle icon"}),y.createElement("div",{className:"content"},r&&lf("This Pull Request is closed!"),i&&lf("This pull request has been merged."),y.createElement("span",{role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:w.fireClickOnEnter},lf("Switch to master branch")))):t==b.PullStatus.NoSourceControl?y.createElement("div",{className:"ui icon warning message"},y.createElement("i",{className:"exclamation circle icon"}),y.createElement("div",{className:"content"},lf("This repository was not found. It might have been deleted or you may not have rights to access it."),y.createElement(w.Link,{href:"https://github.com/"+n.slug,text:lf("Go to GitHub")}))):t==b.PullStatus.BranchNotFound?y.createElement("div",{className:"ui icon warning message"},y.createElement("i",{className:"exclamation circle icon"}),y.createElement("div",{className:"content"},lf("This branch was not found, please pull again or switch to a different branch."),y.createElement("span",{role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:w.fireClickOnEnter},lf("Switch to master branch")))):e?y.createElement("div",{className:"ui warning message"},y.createElement("div",{className:"content"},lf("You need to commit your changes before you can pull from GitHub."))):y.createElement("div",null)}}class x extends w.StatelessUIElement{constructor(e){super(e),this.handleDescriptionChange=this.handleDescriptionChange.bind(this),this.handleCommitClick=this.handleCommitClick.bind(this)}handleDescriptionChange(e){this.props.parent.setState({description:e})}async handleCommitClick(e){pxt.tickEvent("github.commit"),e.stopPropagation(),await l.githubProvider().loginAsync(),pxt.github.token&&await this.props.parent.commitAsync()}renderCore(){var e=this.props.parent.state["description"],e=e&&70<e.length?lf("Your description is getting long..."):void 0;return y.createElement("div",null,y.createElement("div",{className:"ui field"},y.createElement(w.Input,{type:"text",placeholder:lf("Describe your changes."),value:this.props.parent.state.description,onChange:this.handleDescriptionChange,error:e})),y.createElement("div",{className:"ui field"},y.createElement(w.Button,{className:"green",text:lf("Commit and push changes"),icon:"long arrow alternate up",onClick:this.handleCommitClick,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Save your changes in GitHub."),w.helpIconLink("/github/commit",lf("Learn about commiting and pushing code into GitHub.")))))}}class E extends w.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPullRequestStatus=pxtc.Util.debounce(()=>{var e=this.props.parent.props.parent.state.header;e&&(g.invalidatePullRequestStatus(e),this.pullRequestStatus())},1e4,!1),this.handleMergeClick=this.handleMergeClick.bind(this)}pullRequestStatus(){var e=this.props.parent.props.parent.state.header,e=this.props.parent.getData("pkg-git-pr:"+e.id);return"UNKNOWN"===(null==e?void 0:e.mergeable)&&"OPEN"===(null==e?void 0:e.state)&&this.scheduleRefreshPullRequestStatus(),e}handleMergeClick(e){pxt.tickEvent("github.pr.merge",null,{interactiveConsent:!0}),e.stopPropagation();const t=this.props["githubId"],i=this.props.parent.props.parent.state.header,n=this.props.parent.getData("pkg-git-pr:"+i.id);d.promptAsync({header:lf("Squash and merge?"),jsx:y.createElement("p",null,lf("Your changes will merged as a single commit into the base branch and you will switch back to the base branch.")),agreeLbl:lf("Confirm merge"),helpUrl:"/github/pull-request",hasCloseIcon:!0,placeholder:lf("Describe your changes")}).then(e=>null===e?Promise.resolve():this.props.parent.fastForwardMergeAsync(t,n,e))}renderCore(){var{gs:e,githubId:t}=this.props,i=this.pullRequestStatus(),e=!!e.mergeSha,n="MERGEABLE"===i.mergeable,r="OPEN"===i.state,o=r&&"UNKNOWN"===i.mergeable,a=e?"sync":n?"check":o?"circle outline":"exclamation triangle",s=e?"orange":n?"green":o?"orange":"grey",e=e?lf("A merge is in progress. Please resolve conflicts or cancel it"):n?lf("This branch has no conflicts with the base branch"):o?lf("Checking if your branch can be merged"):lf("This branch has conflicts that must be resolved");return r?y.createElement("div",{className:`ui ${s} segment`},y.createElement("div",{className:"ui field"},y.createElement("div",{className:"ui"},y.createElement("i",{className:`icon ${s} inverted circular `+a}),e)),!n&&!o&&y.createElement("div",{className:"ui field"},y.createElement(w.Link,{className:"button",text:lf("Resolve conflicts"),href:`https://github.com/${t.slug}/pull/${i.number}/conflicts`,target:"_blank"}),y.createElement("span",{className:"inline-help"},lf("Resolve merge conflicts in GitHub."),w.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub.")))),n&&y.createElement("div",{className:"ui field"},y.createElement(w.Button,{className:s,text:lf("Squash and merge"),onClick:this.handleMergeClick,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Merge your changes as a single commit into the base branch."),w.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))))):y.createElement("div",null)}}class C extends w.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPageStatus=pxtc.Util.debounce(()=>{var e=this.props.parent.props.parent.state.header;e&&(g.invalidatePagesStatus(e),this.pagesStatus())},1e4,!1),this.handleBumpClick=this.handleBumpClick.bind(this)}handleBumpClick(e){pxt.tickEvent("github.releasezone.bump",void 0,{interactiveConsent:!0}),e.stopPropagation();const{needsCommit:t,master:i}=this.props,n=this.props.parent.props.parent.state.header;t?d.confirmAsync({header:lf("Commit your changes..."),body:lf("You need to commit your local changes to create a release."),agreeLbl:lf("Ok"),hideAgree:!0}):i?l.githubProvider().loginAsync().then(()=>pxt.github.token&&this.props.parent.bumpAsync()).finally(()=>g.invalidatePagesStatus(n)):d.confirmAsync({header:lf("Checkout the master branch..."),body:lf("You need to checkout the master branch to create a release."),agreeLbl:lf("Ok"),hideAgree:!0})}pagesStatus(){var e=this.props.parent.props.parent.state.header,e=this.props.parent.getData("pkg-git-pages:"+e.id);return e&&"building"==e.status&&this.scheduleRefreshPageStatus(),e}renderCore(){var e,t,i,n,{gs:r,needsCommit:o}=this.props,r=r.commit&&r.commit.tag,a=!!pxt.appTarget.appTheme.githubCompiledJs;return o?y.createElement("div",null):(t=(e=this.pagesStatus())&&!!e.html_url,i=e&&"building"==e.status,n=!!pxt.appTarget.appTheme.invertedGitHub,y.createElement("div",{className:`ui transparent ${n?"inverted":""} segment`},y.createElement("div",{className:"ui header"},lf("Release zone")),!o&&!r&&y.createElement("div",{className:"ui field"},y.createElement(w.Button,{className:"basic",text:lf("Create release"),inverted:n,onClick:this.handleBumpClick,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Snapshot and publish your code."),w.helpIconLink("/github/release",lf("Learn more about extension releases.")))),!o&&r&&y.createElement("div",{className:"ui field"},y.createElement("p",{className:"inline-help"},lf("Current release: {0}",r),w.helpIconLink("/github/release",lf("Learn about releases.")))),t&&y.createElement("div",{className:"ui field"},y.createElement(w.Link,{className:"basic button",href:e.html_url,inverted:n,loading:i,text:lf("Open Pages"),target:"_blank"}),y.createElement("span",{className:"inline-help"},i?lf("Pages building, it may take a few minutes."):a?lf("Commit & create release to update Pages."):lf("Commit to update Pages."),w.helpIconLink("/github/pages",lf("Learn about GitHub Pages."))))))}}class _ extends w.StatelessUIElement{constructor(e){super(e),this.handleForkClick=this.handleForkClick.bind(this),this.handleSaveClick=this.handleSaveClick.bind(this)}handleForkClick(e){pxt.tickEvent("github.extensionzone.fork",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.forkAsync(!1)}handleSaveClick(e){pxt.tickEvent("github.extensionzone.save",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.props.parent.saveAndCompile()}renderCore(){var{needsToken:e,githubId:t,gs:i,user:n}=this.props,r=this.props.parent.props.parent.state.header,e=!e&&i.commit&&!i.commit.tree.tree.some(e=>/^LICENSE/.test(e.path.toUpperCase())||/^COPYING/.test(e.path.toUpperCase())),i=r&&window.location.href.replace(/#.*$/,"")+"#testproject:"+r.id,r=n&&n.id!=t.owner,n=!!pxt.appTarget.appTheme.invertedGitHub;return y.createElement("div",{className:`ui transparent ${n?"inverted":""} segment`},y.createElement("div",{className:"ui header"},lf("Extension zone")),y.createElement("div",{className:"ui field"},y.createElement(w.Link,{className:"basic button",href:i,inverted:n,text:lf("Test Extension"),target:pxt.appTarget.id+"testproject"}),y.createElement("span",{className:"inline-help"},lf("Open a test project that uses this extension."),w.helpIconLink("/github/test-extension",lf("Learn about testing extensions.")))),r&&y.createElement("div",{className:"ui field"},y.createElement(w.Button,{className:"basic",text:lf("Fork repository"),onClick:this.handleForkClick,inverted:n,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Fork your own copy of {0} to your account.",t.slug),w.helpIconLink("/github/fork",lf("Learn more about forking repositories.")))),e&&y.createElement("div",{className:"ui field"},y.createElement(w.Link,{className:"basic button",href:`https://github.com/${t.slug}/community/license/new?branch=${t.tag}&template=mit`,inverted:n,text:lf("Add license"),target:"_blank"}),y.createElement("span",{className:"inline-help"},lf("Your project doesn't seem to have a license."),w.helpIconLink("/github/license",lf("Learn more about licenses.")))),y.createElement("div",{className:"ui field"},y.createElement(w.Button,{className:"basic",text:lf("Save for offline"),onClick:this.handleSaveClick,inverted:n,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Export this extension to a file that can be imported without Internet."),w.helpIconLink("/github/offline",lf("Learn more about offline support for extensions.")))))}}class f extends w.UIElement{constructor(e){super(e),this.handleRestore=this.handleRestore.bind(this)}loadDiffFilesAsync(){var{githubId:e,commit:t}=this.props;this.setState({loading:!0}),pxt.github.getCommitAsync(e.slug,t.sha).then(e=>this.computeDiffAsync(e)).then(e=>this.setState({diffFiles:e})).finally(()=>this.setState({loading:!1}))}computeDiffAsync(i){const n=this.props["githubId"],a=g.mainEditorPkg().sortedFiles(),s={};return Promise.all(a.map(e=>{const t=e.name;return pxt.github.lookupFile(n,i,t)?pxt.github.downloadTextAsync(n.fullName,i.sha,t).then(e=>{s[t]=e}):Promise.resolve()})).then(()=>a.map(e=>{const t=e.name,i=s[t],n=/\.blocks$/.test(t),r=e.publishedContent();if(i!==r){var o={file:e,name:e.name,gitFile:i,editorFile:r};if(n&&pxt.blocks.needsDecompiledDiff(i,r)){const t=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),i=a.find(e=>e.name==t),n=s[t];i&&n&&(o.tsEditorFile=i.publishedContent(),o.tsGitFile=n)}return o}})).then(e=>e.filter(e=>!!e))}handleRestore(e){e.stopPropagation(),pxt.tickEvent("github.restore",void 0,{interactiveConsent:!0});const t=this.props["commit"];return d.confirmAsync({header:lf("Would you like to restore this commit?"),body:lf("You will restore your project to the point in time when this commit was made. Don't worry, you can undo this action by restoring to the previous commit."),agreeLbl:lf("Restore"),agreeClass:"green"}).then(e=>{e&&(d.showLoading("github.restore",lf("restoring commit...")),b.restoreCommitAsync(this.props.parent.props.parent.state.header,t).then(()=>(o.invalidate("gh-commits:*"),this.props.parent.props.parent.reloadHeaderAsync())).finally(()=>d.hideLoading("github.restore")))}),!1}renderCore(){var{parent:e,commit:t,expanded:i,onClick:n}=this.props,{diffFiles:r,loading:o}=this.state,a=new Date(Date.parse(t.author.date));return!i||r||o||this.loadDiffFilesAsync(),y.createElement("div",{className:"ui item link",role:"button",onClick:n,onKeyDown:w.fireClickOnEnter},y.createElement("div",{className:"content"},i&&y.createElement(w.Button,{loading:o,className:"right floated",text:lf("Restore"),onClick:this.handleRestore,onKeyDown:w.fireClickOnEnter}),y.createElement("div",{className:"meta"},y.createElement("span",null,a.toLocaleTimeString())),y.createElement("div",{className:"description"},t.message),i&&r&&y.createElement("div",{className:"ui inverted segment"},lf("Comparing selected commit with local files")),i&&r&&y.createElement(v,{parent:e,blocksMode:!1,diffFiles:r,cacheKey:t.sha})))}}class S extends w.UIElement{constructor(e){super(e),this.handleLoadClick=this.handleLoadClick.bind(this)}handleLoadClick(){pxt.tickEvent("github.history.load",void 0,{interactiveConsent:!0});var e=this.state["expanded"];this.setState({expanded:!e,selectedCommit:void 0,selectedDay:void 0})}renderCore(){const{githubId:e,gs:t,parent:i}=this.props,{selectedCommit:n,expanded:r,selectedDay:o}=this.state,a=!!pxt.appTarget.appTheme.invertedGitHub,s=r&&this.getData(`gh-commits:${e.slug}#`+t.commit.sha),l=r&&!s,c={};return s&&s.forEach(e=>{var t=new Date(Date.parse(e.author.date)).toLocaleDateString();let i=c[t];(i=i||(c[t]=[])).push(e)}),y.createElement("div",{className:`ui transparent ${a?"inverted":""} segment`},y.createElement("div",{className:"ui header"},lf("History")),(l||!r)&&y.createElement("div",{className:"ui field"},y.createElement(w.Button,{loading:l,className:"basic",text:lf("View commits"),onClick:this.handleLoadClick,inverted:a,onKeyDown:w.fireClickOnEnter}),y.createElement("span",{className:"inline-help"},lf("Restore your project to a previous commit."),w.helpIconLink("/github/history",lf("Learn more about history of commits.")))),s&&y.createElement("div",{className:"ui items"},Object.keys(c).map(t=>y.createElement("div",{role:"button",className:"ui link item",key:"commitday"+t,onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectday"),this.setState({selectedDay:o===t?void 0:t,selectedCommit:void 0})},onKeyDown:w.fireClickOnEnter},y.createElement("div",{className:"content"},y.createElement("div",{className:"ui header"},t,y.createElement("div",{className:"ui label button"},y.createElement("i",{className:"long arrow alternate up icon"})," ",c[t].length)),t===o&&y.createElement("div",{className:"ui divided items"},c[t].map(t=>y.createElement(f,{key:"commit"+t.sha,onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectcommit",void 0,{interactiveConsent:!0});e=this.state.selectedCommit;this.setState({selectedCommit:t==e?void 0:t})},commit:t,parent:i,githubId:e,expanded:n===t}))))))))}}class m extends n.Editor{constructor(e){super(e),this.parent=e,this.handleViewRef=e=>{this.view=e,this.view&&this.view.setVisible(this.isVisible)},this.handleViewRef=this.handleViewRef.bind(this)}getId(){return"githubEditor"}getCurrentSource(){return g.mainEditorPkg().files[pxt.github.GIT_JSON].content}hasHistory(){return!0}hasEditorToolbar(){return!1}setVisible(e){this.isVisible=e,this.view&&this.view.setVisible(e)}setHighContrast(e){}acceptsFile(e){return e.name===pxt.github.GIT_JSON}loadFileAsync(e,t){return super.loadFileAsync(e,t).then(()=>s.getBlocksAsync()).then(()=>this.parent.forceUpdate())}display(){var e;return this.isVisible&&(e=this.parent.state.header)&&e.githubId?y.createElement(h,{ref:this.handleViewRef,parent:this.parent}):void 0}}i.Editor=m},{"./cloudsync":15,"./compiler":18,"./core":64,"./coretsx":65,"./data":67,"./dialogs":74,"./marked":97,"./package":108,"./srceditor":128,"./sui":129,"./tutorial":132,"./workspace":136,react:320}],86:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebCam=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class a extends r.Component{constructor(e){super(e),this.handleVideoRef=e=>{this.video=e},this.state={hasPrompt:!0},this.handleDeviceClick=this.handleDeviceClick.bind(this),this.handleClose=this.handleClose.bind(this)}handleDeviceClick(e){this.setState({hasPrompt:!1}),pxt.debug("greenscreen: start"),this.deviceId=e,this.deviceId&&navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}},audio:!1}).then(e=>{pxt.debug("greenscreen: stream acquired");try{this.stream=e,this.video.srcObject=this.stream,this.video.play();var t=this.stream.getVideoTracks()[0];if(t){const e="environment"!==t.getSettings().facingMode;this.setState({userFacing:e})}}catch(e){pxt.debug("greenscreen: play failed"),console.error(e),this.stop()}},e=>{pxt.debug("greenscreen: get camera failed"),console.error(e),this.stop()})}handleClose(){this.deviceId||this.props.close()}componentDidMount(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(()=>navigator.mediaDevices.enumerateDevices()).then(e=>{this.setState({devices:e.filter(e=>"videoinput"==e.kind)})},e=>{pxt.debug("greenscreen: enumerate devices failed"),console.error(e)})}componentWillUnmount(){this.stop()}stop(){if(this.deviceId=void 0,this.stream){try{var e=this.stream.getTracks();e&&e.forEach(e=>e.stop())}catch(e){}this.stream=void 0}if(this.video)try{this.video.srcObject=void 0}catch(e){}}render(){var{hasPrompt:e,devices:t,userFacing:i}=this.state;return n.createElement("div",{className:"videoContainer"},n.createElement("video",{className:i?"flipx":"",autoPlay:!0,playsInline:!0,ref:this.handleVideoRef}),e?n.createElement(o.Modal,{isOpen:e,onClose:this.handleClose,closeIcon:!0,dimmer:!0,header:lf("Choose a camera")},n.createElement("div",{className:"ui cards "+(t?"":"loading")},n.createElement(s,{key:"devicegreenscreen",icon:"green tint",onClick:this.handleDeviceClick,deviceId:"",header:lf("Green background")}),t&&t.map((e,t)=>n.createElement(s,{key:"device"+t,icon:"video camera",onClick:this.handleDeviceClick,deviceId:e.deviceId,header:e.label||lf("camera {0}",t)})))):void 0)}}i.WebCam=a;class s extends r.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){var{deviceId:e,onClick:t}=this.props;t(e)}renderCore(){var{header:e,icon:t}=this.props;return n.createElement("div",{role:"button",className:"ui card link",tabIndex:0,onClick:this.handleClick,onKeyDown:o.fireClickOnEnter},n.createElement("div",{className:"imageicon"},n.createElement(o.Icon,{icon:t+" massive"})),n.createElement("div",{className:"content"},n.createElement("span",{className:"header"},e)))}}},{"./data":67,"./sui":129,react:320}],87:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HeaderBar=void 0;const p=e("react"),n=e("./data"),h=e("./sui"),f=e("./auth"),m=e("./cmds"),g=e("./container"),b=e("./identity"),c=e("./package"),r=e("./projects"),d=e("./tutorial");class o extends n.Component{constructor(e){super(e),this.goHome=()=>{pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),"home"!==this.getView()&&this.props.parent.showExitAndSaveDialog()},this.showShareDialog=()=>{pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},this.launchFullEditor=()=>{pxt.tickEvent("sandbox.openfulleditor",void 0,{interactiveConsent:!0}),this.props.parent.launchFullEditor()},this.exitTutorial=()=>{var e=this.props.parent.state.tutorialOptions;pxt.tickEvent("menu.exitTutorial",{tutorial:null==e?void 0:e.tutorial},{interactiveConsent:!0}),this.props.parent.exitTutorial()},this.showReportAbuse=()=>{pxt.tickEvent("tutorial.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},this.toggleDebug=()=>{pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},this.brandIconClick=()=>{pxt.tickEvent("projects.brand",void 0,{interactiveConsent:!0}),this.goHome()},this.backButtonTouchStart=e=>{this.longpressTimer=setTimeout(()=>m.nativeHostLongpressAsync(),750),this.touchStartTime=(new Date).getTime()},this.backButtonTouchEnd=e=>{e.preventDefault(),this.touchStartTime&&(new Date).getTime()-this.touchStartTime<750&&m.nativeHostBackAsync(),this.touchStartTime=null,clearTimeout(this.longpressTimer)},this.getView=()=>{var{home:e,debugging:t,tutorialOptions:i}=this.props.parent.state;return e?"home":pxt.shell.isSandboxMode()?"sandbox":t?"debugging":!pxt.BrowserUtils.useOldTutorialLayout()&&null!=i&&i.tutorial?"tutorial-tab":null!=i&&i.tutorial?"tutorial":"editor"},this.getSettingsMenu=e=>{var{greenScreen:t,accessibleBlocks:i,header:n}=this.props.parent.state;switch(e){case"home":return p.createElement(r.ProjectSettingsMenu,{parent:this.props.parent});case"tutorial-tab":case"editor":return p.createElement(g.SettingsMenu,{parent:this.props.parent,greenScreen:t,accessibleBlocks:i,showShare:!!n});default:return p.createElement("div",null)}}}getOrganizationLogo(e,t,i){return p.createElement("div",{className:"ui item logo organization"},e.organizationWideLogo||e.organizationLogo?p.createElement("img",{className:"ui logo "+("home"!==i?"mobile hide":""),src:e.organizationWideLogo||e.organizationLogo,alt:lf("{0} Logo",e.organization)}):p.createElement("span",{className:"name"},e.organization),e.organizationLogo&&"home"!==i&&p.createElement("img",{className:"ui image mobile only",src:e.organizationLogo,alt:lf("{0} Logo",e.organization)}))}getTargetLogo(e,t,i){return p.createElement("div",{"aria-label":lf("{0} Logo",e.boardName),role:"menuitem",className:"ui item logo brand "+("sandbox"!==i&&"home"!==i?"mobile hide":""),onClick:this.brandIconClick},e.useTextLogo?[p.createElement("span",{className:"name",key:"org-name"},e.organizationText),p.createElement("span",{className:"name-short",key:"org-name-short"},e.organizationShortText||e.organizationText)]:e.logo||e.portraitLogo?p.createElement("img",{className:`ui ${e.logoWide?"small":""} logo`,src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):p.createElement("span",{className:"name"},e.boardName))}getCenterLabel(e,t,i){var n,r,o,a=!!c.mainEditorPkg().files[pxt.ASSETS_FILE],s=null==(r=null==(n=c.mainPkg)?void 0:n.config)?void 0:r.languageRestriction,l=!a&&("javascript-only"===s||"python-only"===s)||e.blocksOnly;switch(t){case"tutorial":const n=null!=i&&i.tutorialActivityInfo?i.tutorialActivityInfo[i.tutorialStepInfo[i.tutorialStep].activity].name:null,r=null==(o=null==i?void 0:i.metadata)?void 0:o.hideIteration;if(n)return p.createElement("div",{className:"ui item"},n);if(r)break;return p.createElement(d.TutorialMenu,{parent:this.props.parent});case"tutorial-tab":return p.createElement("div",null);case"debugging":return p.createElement(h.MenuItem,{className:"centered",icon:"large bug",name:"Debug Mode"});case"sandbox":case"editor":if(!l)return p.createElement("div",{className:"ui item link editor-menuitem"},p.createElement(g.EditorSelector,{parent:this.props.parent,sandbox:"sandbox"===t,python:e.python,languageRestriction:s,headless:null==(o=pxt.appTarget.simulator)?void 0:o.headless}));switch(s){case"python-only":return p.createElement(h.MenuItem,{className:"centered",icon:"xicon python",name:"Python"});case"javascript-only":return p.createElement(h.MenuItem,{className:"centered",icon:"xicon js",name:"JavaScript"})}}return p.createElement("div",null)}getExitButtons(e,t,i){var n;switch(t){case"debugging":return p.createElement(h.ButtonMenuItem,{className:"exit-debugmode-btn",role:"menuitem",icon:"external",text:lf("Exit Debug Mode"),textClass:"landscape only",onClick:this.toggleDebug});case"sandbox":if(e.hideEmbedEdit)break;return p.createElement(h.Item,{role:"menuitem",icon:"external",textClass:"mobile hide",text:lf("Edit"),onClick:this.launchFullEditor});case"tutorial":case"tutorial-tab":var r=[];if(null!=i&&i.tutorialReportId){const e=lf("Unapproved Content");r.push(p.createElement(h.Item,{key:"tutorial-report",role:"menuitem",icon:"exclamation triangle",className:"report-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.showReportAbuse}))}if(!e.lockedEditor&&(null==(n=null==i?void 0:i.metadata)||!n.hideIteration)&&("tutorial-tab"!==t||null!=(n=pxt.appTarget.simulator)&&n.headless)){const e=lf("Exit tutorial");r.push(p.createElement(h.Item,{key:"tutorial-exit",role:"menuitem",icon:"sign out large",className:"exit-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.exitTutorial}))}if(r.length)return r}return p.createElement("div",null)}renderCore(){var e=pxt.appTarget.appTheme,t=this.getData(f.HIGHCONTRAST),i=this.getView(),{home:n,header:r,tutorialOptions:o}=this.props.parent.state,a=pxt.shell.isControllerMode(),s=m.isNativeHost(),l=f.hasIdentity(),c=this.props.parent.isPythonActive()?"Python":this.props.parent.isJavaScriptActive()?"JavaScript":"Blocks",d=!("editor"!==i&&"tutorial-tab"!==i||e.lockedEditor||a),r="editor"===i&&r&&(null==(r=pxt.appTarget.cloud)?void 0:r.sharing)&&!a,a="editor"===i&&(null==(a=e.docMenu)?void 0:a.length),u="tutorial"==i&&22*o.tutorialStepInfo.length>window.innerWidth/3;return p.createElement("div",{id:"mainmenu",className:`ui borderless fixed menu ${e.invertedMenu?"inverted":""} `+(u?"thin":""),role:"menubar"},p.createElement("div",{className:"left menu"},s&&p.createElement(h.Item,{className:"icon nativeback",role:"menuitem",icon:"chevron left large",ariaLabel:lf("Back to application"),onClick:m.nativeHostBackAsync,onMouseDown:this.backButtonTouchStart,onMouseUp:this.backButtonTouchEnd,onMouseLeave:this.backButtonTouchEnd}),this.getOrganizationLogo(e,t,i),"tutorial"===i?p.createElement(h.Item,{className:"tutorialname",tabIndex:-1,textClass:"landscape only",text:o.tutorialName}):this.getTargetLogo(e,t,i)),!n&&p.createElement("div",{className:"center menu"},this.getCenterLabel(e,i,o)),p.createElement("div",{className:"right menu"},this.getExitButtons(e,i,o),d&&p.createElement(h.Item,{className:"icon openproject "+(l?"mobPile hide":""),role:"menuitem",icon:"home large",ariaLabel:lf("Home screen"),onClick:this.goHome}),r&&p.createElement(h.Item,{className:"icon shareproject mobile hide",role:"menuitem",ariaLabel:lf("Share Project"),icon:"share alternate large",onClick:this.showShareDialog}),a&&p.createElement(g.DocsMenu,{parent:this.props.parent,editor:c}),this.getSettingsMenu(i),l&&("home"===i||"editor"===i||"tutorial-tab"===i)&&p.createElement(b.UserMenu,{parent:this.props.parent})))}}i.HeaderBar=o},{"./auth":8,"./cmds":16,"./container":63,"./data":67,"./identity":91,"./package":108,"./projects":109,"./sui":129,"./tutorial":132,react:320}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mkHIDBridgePacketIOAsync=i.shouldUse=i.HIDError=void 0;var n=pxt.Cloud,r=pxt.Util;let o;class a extends Error{constructor(e){super(e),this.message=e}}i.HIDError=a;let s={};function l(e){var t=r.lookup(s,e.result.path);t?t.onOOB(e):console.error("Dropping data for "+e.result.path)}i.shouldUse=function(){var e=pxt.appTarget.serial;return e&&e.useHF2&&(pxt.BrowserUtils.isLocalHost()&&!!n.localToken||pxt.winrt.isWinRT())},i.mkHIDBridgePacketIOAsync=function(){o||pxt.BrowserUtils.isLocalHost()&&n.localToken&&(pxt.debug("initializing hid pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${n.localToken}/hid`,l));let e=!1,t=(pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(e=!0),new c(e));return t.initAsync().then(()=>t)};class c{constructor(e=!1){this.rawMode=e,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onEvent=e=>{},this.onError=e=>{},this.onSerial=(e,t)=>{},this.connecting=!1,e&&(this.onEvent=e=>this.onData(e))}disposeAsync(){return Promise.resolve()}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.connected}onOOB(e){"serial"==e.op?this.onSerial(r.fromHex(e.result.data),e.result.isError):"event"==e.op&&this.onEvent(r.fromHex(e.result.data))}talksAsync(e){return o.opAsync("talk",{path:this.dev.path,cmds:e.map(e=>({cmd:e.cmd,data:e.data?r.toHex(e.data):""}))}).then(e=>e.map(e=>r.fromHex(e.data)))}error(e){throw this.connected=!1,new a(r.lf("USB/HID error on device {0} ({1})",this.dev.product,e))}reconnectAsync(){return this.initAsync()}disconnectAsync(){return this.connected=!1,o.opAsync("disconnect",{path:this.dev.path}).finally(()=>{this.onConnectionChanged&&this.onConnectionChanged()})}sendPacketAsync(e){if(this.rawMode)return o.opAsync("send",{path:this.dev.path,data:r.toHex(e),raw:!0});throw new Error("should use talksAsync()!")}sendSerialAsync(e,t){return o.opAsync("sendserial",{path:this.dev.path,data:r.toHex(e),isError:t})}initAsync(){return this.connected=!1,this.connecting=!0,o.opAsync("list",{}).then(e=>{let t=e.devices,i=t.filter(e=>16896==(65280&e.release))[0];if(!(i=pxt.appTarget.serial&&pxt.appTarget.serial.rawHID?t[0]:i))throw new Error("No device connected");this.dev&&delete s[this.dev.path],this.dev=i,s[this.dev.path]=this}).then(()=>o.opAsync("init",{path:this.dev.path,raw:this.rawMode})).then(()=>{this.connected=!0}).finally(()=>{this.connecting=!1,this.onConnectionChanged&&this.onConnectionChanged()})}}},{}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HintManager=i.HintTooltip=void 0;const n=e("react"),r=e("./data");class o extends r.Component{constructor(e){super(e)}UNSAFE_componentWillReceiveProps(e){e.pokeUser!=this.state.show&&this.setState({show:e.pokeUser})}renderCore(){return n.createElement("div",{className:"tooltip "+(this.state.show?"show":""),role:"tooltip",onClick:this.props.onClick},this.props.text)}}i.HintTooltip=o,i.HintManager=class{constructor(){this.defaultDuration=1e4,this.defaultDisplayCount=3,this.hints={},this.seenHints={}}viewedHint(e){this.seenHints[e]=!0}clearViewedHints(){this.seenHints={}}addHint(e,t,i){this.hints[e]=pxt.Util.debounce(()=>{t(),this.stopPokeUserActivity()},i||this.defaultDuration)}pokeUserActivity(e,t,i){(null==i||i<this.defaultDisplayCount)&&!this.seenHints[t]&&(this.stopPokeUserActivity(),this.timer=this.hints[e]())}stopPokeUserActivity(){clearTimeout(this.timer),this.timer=null}}},{"./data":67,react:320}],90:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=void 0;const n=e("./browserworkspace"),a="texts",s="headers";let r;async function l(){return r?await r:r=async function(){var e=new pxt.BrowserUtils.IDBWrapper("__pxt_idb_workspace",1,(e,t)=>{t=t.result;t.createObjectStore(a,{keyPath:"id"}),t.createObjectStore(s,{keyPath:"id"})},async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()});try{await e.openAsync()}catch(e){return pxt.reportException(e),Promise.reject(e)}return e}()}async function o(t,i,n){var r=await l();try{await o(r,t,i,n)}catch(e){if(409==e.status)pxt.debug("idb: set conflict (409)");else{pxt.reportException(e),pxt.log("idb: set failed, cleaning cache dbs"),await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync();try{await o(r,t,i,n)}catch(t){throw pxt.reportException(t,{ws:"idb"}),pxt.log("idb: we are out of space..."),t}}}async function o(e,t,i,n){i={id:t.id,files:n,_rev:i};n&&await e.setAsync(a,i),await e.setAsync(s,t)}}i.provider={getAsync:async function(e){var t=await(await l()).getAsync(a,e.id);return{header:e,text:t.files,version:t._rev}},setAsync:o,deleteAsync:async function(e,t){var i=await l();await i.deleteAsync(a,e.id),await i.deleteAsync(s,e.id)},listAsync:async function(){return await(!(await(await l()).getAllAsync(s)).length&&(e=await n.provider.listAsync(),!await Promise.all(e.map(e=>(async e=>{var t=await n.provider.getAsync(e);delete t._id,delete t._rev,await o(e,void 0,t.text)})(e))))),(await l()).getAllAsync(s);var e},resetAsync:async function(){var e=await l();await e.deleteAllAsync(a),await e.deleteAllAsync(s)}}},{"./browserworkspace":12}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CloudSaveStatus=i.UserMenu=i.LoginDialog=void 0;const a=e("react"),s=e("./sui"),n=e("./core"),r=e("./auth"),o=e("./data"),l=e("./cloudsync"),c=e("./cloud");class d extends r.Component{constructor(e){super(e),this.handleRememberMeChanged=e=>{this.setState({rememberMe:e})},this.hide=()=>{this.setState({visible:!1})},this.state={visible:!1,rememberMe:!1,continuationHash:""}}async show(e){this.setState({visible:!0,continuationHash:e})}async signInAsync(e){pxt.tickEvent("identity.loginClick",{provider:e.name,rememberMe:this.state.rememberMe.toString()}),await r.loginAsync(e.id,this.state.rememberMe,{hash:this.state.continuationHash})}renderCore(){const e=this.state["visible"],t=pxt.auth.identityProvider("microsoft"),i=[];i.push({label:lf("Sign in"),onclick:async()=>this.signInAsync(t),icon:"checkmark",approveButton:!0,className:"positive"});var n=[];return n.push(a.createElement(s.PlainCheckbox,{label:lf("Remember me"),onChange:this.handleRememberMeChanged})),a.createElement(s.Modal,{isOpen:e,className:"signindialog",size:"tiny",onClose:this.hide,dimmer:!0,buttons:i,actions:n,closeIcon:!0,header:lf("Sign into {0}",pxt.appTarget.appTheme.organizationText),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},a.createElement("p",null,lf("Sign in with your Microsoft Account. We'll save your projects to the cloud, where they're accessible from anywhere.")),a.createElement("p",null,lf("Don't have a Microsoft Account? Start signing in to create one!")),a.createElement(s.Link,{className:"ui",text:lf("Learn more"),icon:"external alternate",ariaLabel:lf("Learn more"),href:"/identity/sign-in",target:"_blank",onKeyDown:s.fireClickOnEnter}))}}i.LoginDialog=d;class u extends r.Component{constructor(e){super(e),this.handleDropdownClicked=()=>{var e=this.isLoggedIn(),t=this.getData("github:user");return!(!e&&!t&&(this.props.parent.showLoginDialog(this.props.continuationHash),1))},this.handleLoginClicked=()=>{this.props.parent.showLoginDialog(this.props.continuationHash)},this.handleLogoutClicked=async()=>{await r.logoutAsync()},this.handleProfileClicked=()=>{this.props.parent.showProfileDialog()},this.handleUnlinkGitHubClicked=()=>{pxt.tickEvent("menu.github.signout");var e=l.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),n.infoNotification(lf("Signed out from GitHub...")))},this.state={}}renderCore(){var e=this.isLoggedIn(),t=this.getUserProfile(),i=lf("User Menu"),n=a.createElement("div",{className:"signin-button"},a.createElement("div",{className:"ui text widedesktop only"},lf("Sign In")),s.genericContent({icon:"xicon cloud-user large"})),r=a.createElement("div",{className:"avatar"},a.createElement("img",{src:null==(r=null==(r=null==t?void 0:t.idp)?void 0:r.picture)?void 0:r.dataUrl,alt:lf("User Menu")})),o=a.createElement("div",{className:"avatar"},a.createElement("span",null,pxt.auth.userInitials(t))),t=null!=(t=null==(t=null==t?void 0:t.idp)?void 0:t.picture)&&t.dataUrl?r:o,r=this.getData("github:user"),o=!e&&r;return a.createElement(s.DropdownMenu,{role:"menuitem",title:i,className:"item icon user-dropdown-menuitem "+(e?"logged-in-dropdown":"sign-in-dropdown"),titleContent:e?t:n,tabIndex:e?0:-1,onClick:this.handleDropdownClicked},e?a.createElement(s.Item,{role:"menuitem",text:lf("My Profile"),onClick:this.handleProfileClicked}):void 0,e?a.createElement("div",{className:"ui divider"}):void 0,o?a.createElement(s.Item,{role:"menuitem",title:lf("Unlink {0} from GitHub",r.name),onClick:this.handleUnlinkGitHubClicked},a.createElement("div",{className:"icon avatar",role:"presentation"},a.createElement("img",{className:"circular image",src:r.photo,alt:lf("User picture")})),a.createElement("span",null,lf("Unlink GitHub"))):void 0,o?a.createElement("div",{className:"ui divider"}):void 0,e?void 0:a.createElement(s.Item,{role:"menuitem",text:lf("Sign in"),onClick:this.handleLoginClicked}),e?a.createElement(s.Item,{role:"menuitem",text:lf("Sign out"),onClick:this.handleLogoutClicked}):void 0)}}i.UserMenu=u;class p extends o.Component{static wouldRender(e){e=c.getCloudTempMetadata(e).cloudStatus();return!!e&&"none"!==e.value&&r.hasIdentity()}renderCore(){var e,t,i;return this.props.headerId&&(e=this.getData(c.HEADER_CLOUDSTATE+":"+this.props.headerId).cloudStatus())&&"none"!==e.value&&r.hasIdentity()?(i=(t="localEdits"===e.value)||"syncing"===e.value,a.createElement("div",{className:"cloudstatusarea"},!i&&a.createElement(s.Item,{className:"ui tiny cloudicon xicon "+e.icon,title:e.tooltip,tabIndex:-1}),i&&a.createElement(s.Item,{className:"ui tiny inline loader active cloudprogress"+(t?" indeterminate":""),title:e.tooltip,tabIndex:-1}),"none"!==e.value&&"synced"!==e.value&&a.createElement("span",{className:"ui mobile hide no-select cloudtext",role:"note"},e.shortStatus))):null}}i.CloudSaveStatus=p},{"./auth":8,"./cloud":14,"./cloudsync":15,"./core":64,"./data":67,"./sui":129,react:320}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=void 0;const n=e("./memoryworkspace");let r;i.provider={getAsync:function(e){return n.provider.getAsync(e)},setAsync:function(t,e,i){return n.provider.setAsync(t,e,i).then(()=>{var e=i||n.projects[t.id]&&n.projects[t.id].text;return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesave",project:{header:t,text:e},response:!1})}).then(()=>{})},listAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesync",response:!0}).then(e=>((e.projects||[]).forEach(n.merge),r=e.editor,pxt.tickEvent("pxt.controller",{controllerId:e.controllerId}),n.provider.listAsync()))},resetAsync:function(){return n.provider.resetAsync().then(()=>pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacereset",response:!0})).then(()=>{})},loadedAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceloaded",response:!0}).then(()=>{})},getSyncState:function(){return r},fireEvent:function(e){pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceevent",response:!1,event:e})}}},{"./memoryworkspace":98}],93:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImmersiveReaderButton=i.launchImmersiveReader=void 0;const n=e("react"),a=e("./data"),s=e("./core"),r=e("./sui"),l=e("./auth"),c=e("@microsoft/immersive-reader-sdk");var d=pxt.Cloud;function o(e,t){pxt.tickEvent("immersiveReader.launch",{tutorial:t.tutorial,tutorialStep:t.tutorialStep});const i=a.getData(l.READER)||"",n=a.getData(l.LANGUAGE)||"",r={chunks:[{content:function(e){let t=e;return[function(e){return e.replace(/@boardname@/g,pxt.appTarget.appTheme.boardName||"device")},function(e){return e.replace(/(!\w*\[[^\]]*\]\w*\([^)]*\))/gu,"")},function(e){return e.replace(/\w*\[([^\]]*)\]\w*\([^)]*\)/gu,(e,t,i,n)=>lf("{0}",t))},function(e){return e.replace(/`?`\|\|[\w|\s]+:(.+?)\|\|``?/gu,(e,t,i,n)=>lf('"{0}"',t))},function(e){return e.replace(/``\|([^|]+)\|``/gu,(e,t,i,n)=>lf("{0}",t))},function(e){return e.replace(pxt.tutorial.getMetadataRegex(),"")},function(e){return e.replace(/\*\*([^*^\s]+)\*\*|__([^\s^_]+)__/gu,(e,t,i,n,r)=>'"'+lf("{0}",t||i)+'"').replace(/\*\*([^*]+)\*\*|__([^_]+)__/gu,(e,t,i,n,r)=>t?lf("{0}",t):lf("{0}",i))},function(e){return e.replace(/\*([^*]+)\*|_([^_]+)_/gu,(e,t,i,n,r)=>lf("{0}",t||i))},function(e){return e.replace(/[\r\n]{2,}/gmu,"<br />\n")},function(e){return e.replace(/^\* \* \*$|^- - -$|^<hr\/>$|---/gmu,"<br />")},function(e){return e.replace(/^>>/gu,"")},function(e){let t;try{t=new RegExp("\\p{Extended_Pictographic}","ug")}catch(e){}const r=[];return t?e.replace(t,(e,t,i,n)=>"🔲"==e?"•":r.indexOf(e)<0?"":e):e},function(e){return e.replace(/[Ⓐ🅐]/gu,lf("{0}","A")).replace(/[Ⓑ🅑]/gu,lf("{0}","B"))},function(e){return e.replace(/<(true|false|down|up|high|low|on|off|yes|no|win|lose)>/giu,(e,t,i,n)=>"`"+lf("{0}",t)+"`")}].forEach(e=>{t=e(t)}),t}(e),mimeType:"text/html"}]},o={uiLang:n,onExit:()=>{pxt.tickEvent("immersiveReader.close",{tutorial:t.tutorial,tutorialStep:t.tutorialStep})},onPreferencesChanged:e=>{l.setImmersiveReaderPrefAsync(e)},preferences:i};e=pxt.storage.getLocal("immReader"),(!(e=pxt.Util.jsonTryParse(e))||Date.now()/1e3>e.expiration?pxt.Cloud.privateGetAsync("immreader").then(e=>(pxt.storage.setLocal("immReader",JSON.stringify(e)),e),e=>(pxt.storage.removeLocal("immReader"),pxt.reportException(e),pxt.tickEvent("immersiveReader.error",{error:e.statusCode,message:e.message}),e.isOffline?Promise.reject(new Error("offline")):Promise.reject(new Error("token")))):(pxt.tickEvent("immersiveReader.cachedToken"),Promise.resolve(e))).then(e=>{return t=e,pxt.Cloud.privateGetAsync("ping").then(()=>t);var t}).then(e=>{if(d.isOnline()){const i=pxt.Util.now();return c.launchAsync(e.token,e.subdomain,r,o).then(e=>{var t=pxt.Util.now()-i;pxt.tickEvent("immersiveReader.launch.finished",{elapsed:t})})}return Promise.reject(new Error("offline"))}).catch(e=>{e.isOffline||"offline"===e.message?s.warningNotification(lf("Immersive Reader cannot be used offline")):(s.warningNotification(lf("Immersive Reader could not be launched")),"string"==typeof e?pxt.tickEvent("immersiveReader.error",{message:e}):pxt.tickEvent("immersiveReader.error",{message:e.message,statusCode:e.statusCode})),pxt.reportException(e),c.close()})}i.launchImmersiveReader=o;class u extends a.Component{constructor(){super(...arguments),this.buttonClickHandler=()=>{o(this.props.content,this.props.tutorialOptions)}}render(){return n.createElement("div",{className:"immersive-reader-button ui item",onClick:this.buttonClickHandler,"aria-label":lf("Launch Immersive Reader"),role:"button",onKeyDown:r.fireClickOnEnter,tabIndex:0,title:lf("Launch Immersive Reader")})}}i.ImmersiveReaderButton=u},{"./auth":8,"./core":64,"./data":67,"./sui":129,"@microsoft/immersive-reader-sdk":145,react:320}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Keymap=void 0;const n=e("react"),r=e("./data");class o extends r.Component{constructor(e){super(e),this.hideKeymap=()=>{this.props.parent.showKeymap(!1)},this.setData();e=pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.boardName.toLowerCase();this.keymap=e&&o._data[e],this.state={above:!0}}renderCore(){return n.createElement("div",{className:"keymap "+(this.state.above?"above":""),ref:"keymap"},n.createElement("i",{className:"icon large close remove circle",role:"presentation",onClick:this.hideKeymap}),this.keymap&&this.keymap.map((i,e)=>n.createElement("div",{key:e},n.createElement("span",{className:"keymap-title"},i.title),Object.keys(i.map).map((e,t)=>n.createElement("div",{key:t,className:"keymap-row"},i.map[e].map((e,t)=>n.createElement("div",{className:"keymap-key",key:t},e)),n.createElement("span",{className:"keymap-name"},e))))))}setData(){o._data||(o._data={arcade:[{title:lf("player 1"),map:{[lf("up")]:["↑","W"],[lf("down")]:["↓","S"],[lf("left")]:["←","A"],[lf("right")]:["→","D"],a:["Z",lf("{id:keyboard symbol}space")],b:["X",lf("{id:keyboard symbol}enter")]}},{title:lf("player 2"),map:{[lf("up")]:["I"],[lf("down")]:["K"],[lf("left")]:["J"],[lf("right")]:["L"],[lf("a")]:["U"],[lf("b")]:["O"]}}]})}}i.Keymap=o},{"./data":67,react:320}],95:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.LanguagePicker=i.setInitialLang=i.initialLang=void 0;const o=e("react"),n=e("./codecard"),a=e("./sui"),r=e("./data"),s=e("./core"),l=["en"];i.setInitialLang=function(e){i.initialLang=pxt.Util.normalizeLanguageCode(e)[0]};class c extends r.Component{constructor(e){super(e),this.state={visible:!1},this.hide=this.hide.bind(this),this.changeLanguage=this.changeLanguage.bind(this),this.translateEditor=this.translateEditor.bind(this)}languageList(){return pxt.appTarget.appTheme.selectLanguage&&pxt.appTarget.appTheme.availableLocales&&pxt.appTarget.appTheme.availableLocales.length?pxt.appTarget.appTheme.availableLocales:l}translateEditor(){pxt.tickEvent("translate.editor.incontext",void 0,{interactiveConsent:!0}),s.confirmAsync({header:lf("Translate the editor"),jsx:o.createElement("div",null,o.createElement("p",null,lf("This editor uses crowd-sourced translation! If you wish to help with translation, make sure to register as a translator.")),o.createElement("p",null,lf("'Translate' will reload the editor with in-context translations. Close the editor when done."))),helpUrl:"/translate",buttons:[{label:lf("Register"),icon:"xicon globe",className:lf("secondary"),title:lf("Register as a translator before starting the translation."),url:"https://crowdin.com/project/"+pxt.appTarget.appTheme.crowdinProject}],agreeLbl:lf("Translate"),hasCloseIcon:!0}).then(e=>{if(e){pxt.tickEvent("translate.editor.incontext.translate");const e=window.location.href.indexOf("?")<0?"?":"&";window.location.href=window.location.pathname+(window.location.search||"")+e+"translate=1"+(window.location.hash||"")}})}changeLanguage(e){pxt.Util.allLanguages[e]&&(e!==i.initialLang?(pxt.tickEvent("menu.lang.changelang",{lang:e}),s.setLanguage(e).then(()=>pxt.winrt.releaseAllDevicesAsync()).then(()=>{this.props.parent.reloadEditor()})):(pxt.tickEvent("menu.lang.samelang",{lang:e}),this.hide()))}hide(){this.setState({visible:!1})}show(){this.setState({visible:!0})}renderCore(){var e,t,i,n,r;return this.state.visible?(e=pxt.appTarget.appTheme,i=4<(t=this.languageList()).length?"large":"small",n=!pxt.BrowserUtils.isIE()&&!pxt.shell.isReadOnly()&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.appTheme.crowdinProject,r=this.props.parent.createModalClasses(),o.createElement(a.Modal,{isOpen:this.state.visible,className:r,size:i,onClose:this.hide,dimmer:!0,header:lf("Select Language"),closeIcon:!0,allowResetFocus:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},o.createElement("div",{id:"langmodal"},o.createElement("div",{id:"availablelocales",className:"ui cards centered",role:"list","aria-label":lf("List of available languages")},t.map(e=>{var t=pxt.Util.allLanguages[e];return o.createElement(d,{key:e,langId:e,name:t.localizedName,ariaLabel:t.englishName,description:t.englishName,onClick:this.changeLanguage})})),e.crowdinProject?o.createElement("div",{className:"ui",id:"langmodalfooter"},o.createElement(a.Link,{"aria-label":lf("How do I add a new language?"),href:"/translate",text:lf("How do I add a new language?"),target:"_blank"}),n&&o.createElement(a.Button,{"aria-label":lf("Translate the editor"),onClick:this.translateEditor,text:lf("Translate the editor")})):void 0))):o.createElement("div",null)}}i.LanguagePicker=c;class d extends a.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.langId)}renderCore(){var{name:e,ariaLabel:t,description:i}=this.props;return o.createElement(n.CodeCardView,{className:"card-selected langoption",name:e,ariaLabel:t,role:"listitem",description:i,onClick:this.handleClick})}}},{"./codecard":17,"./core":64,"./data":67,"./sui":129,react:320}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.makeAsync=void 0;const n=e("react"),d=e("./package"),r=e("./core"),o=e("./compiler"),a="instructions";i.makeAsync=function(){return r.dialogAsync({header:lf("Make"),size:"large",hasCloseIcon:!0,jsx:n.createElement("div",{className:"ui container"},n.createElement("div",{id:"makecontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},n.createElement("iframe",{id:"makeiframe",frameBorder:"0",sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}}))),onLoaded:e=>{var c,t;c=e.querySelectorAll("#makeiframe")[0],t=c,new Promise((i,e)=>{window.addEventListener("message",function e(t){t=t.data;"ready"==t.type&&t.frameid==a&&(window.removeEventListener("message",e),i())}),t.src=pxt.webConfig.partsUrl+"#"+a}).then(()=>o.compileAsync({native:!0})).then(e=>{var t,i=d.mainEditorPkg().header.name||lf("Untitled"),n=pxt.appTarget.simulator.boardDefinition,r=ts.pxtc.computeUsedParts(e).sort(),o=d.mainPkg.computePartDefinitions(r),a=e.usedArguments,s={},l={};for(t of e.configData||[])s[t.key+""]=t.value,l[t.name]=t.key;return c.contentWindow.postMessage({type:"instructions",options:{name:i,boardDef:n,parts:r,partDefinitions:o,fnArgs:a,configData:{cfg:s,cfgKey:l},print:!0}},"*"),c})}}).then(e=>{})}},{"./compiler":18,"./core":64,"./package":108,react:320}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MarkedContent=void 0;const n=e("react"),r=e("./data"),a=e("marked"),c=e("./compiler");class d extends r.Component{constructor(){super(...arguments),this.semanticIconNames=["flipped","horizontally","vertically","rotated","counterclockwise","access","accessible","accusoft","add","address","adjust","adn","adversal","affiliatetheme","aid","alarm","ald","algolia","alien","align","all","alphabet","als","alt","alternate","alternative","amazon","ambulance","american","amex","amilia","amount","anchor","and","android","angellist","angle","angrycreative","angular","announcement","app","apper","apple","archive","area","arrow","arrows","ascending","asexual","asl","assistive","asterisk","asymmetrik","at","attach","attention","audible","audio","autoprefixer","avianex","aviato","awesome","aws","backward","badge","bag","balance","ball","ban","band","bandcamp","bar","barcode","bars","baseball","basket","basketball","bath","bathtub","battery","bed","beer","beginner","behance","bell","bicycle","bill","bimobject","binary","binoculars","birthday","bishop","bitbucket","bitcoin","bity","black","blackberry","blind","block","blogger","bluetooth","board","bold","bolt","bomb","book","bookmark","bowling","box","boxes","braille","branch","briefcase","broken","browser","brush","btc","bug","building","bullhorn","bullseye","bureau","buromobelexperte","bus","buysellads","cake","calculator","calendar","call","camera","camp","cancel","cap","captioning","car","card","caret","cart","cc","center","centercode","certificate","chain","chart","chat","check","checked","checkered","checkmark","chess","chevron","child","chrome","circle","clipboard","clock","clone","close","closed","cloud","cloudscale","cloudsmith","cloudversify","club","cny","cocktail","code","codepen","codiepie","coffee","cog","cogs","columns","combinator","comment","commenting","comments","commons","compass","compose","compress","computer","configure","connectdevelop","contao","content","control","conversation","copy","copyright","cord","cpanel","creative","credit","crop","crosshairs","css3","cube","cubes","currency","cursor","cut","cuttlefish","dashboard","dashcube","database","deaf","deafness","delete","delicious","deploydog","descending","description","deskpro","desktop","detective","deviantart","devices","diamond","digg","digital","diners","discord","discourse","discover","discussions","disk","dna","dochub","docker","doctor","dollar","dolly","dont","dot","double","down","download","draft2digital","dribbble","dribble","drive","drivers","dropbox","dropdown","dropper","drupal","dyalog","earlybirds","edge","edit","eercast","eject","elementor","ellipsis","ember","emergency","empire","empty","end","envelope","envira","erase","eraser","erlang","ethereum","etsy","eur","euro","excel","exchange","exclamation","expand","expeditedssl","explorer","express","external","extinguisher","eye","eyedropper","facebook","factory","fast","favorite","fax","feed","female","fi","fighter","file","film","filter","find","fire","firefox","first","firstdraft","five","flag","flask","flatbed","flickr","flipboard","fly","folder","font","fonticons","food","football","fork","forms","fort","forumbee","forward","four","foursquare","framework","free","freebsd","from","frown","full","futbol","gallery","game","gavel","gay","gbp","gem","gender","genderless","get","gg","ghost","gift","git","github","gitkraken","gitlab","gitter","gittip","glass","glide","globe","gofore","golf","goodreads","google","grab","graduation","graph","gratipay","grav","grid","gripfire","group","grunt","gulp","hacker","half","hand","handicap","handshake","hard","hash","hashtag","hat","hdd","header","heading","headphones","hearing","heart","heartbeat","height","help","helper","heterosexual","hide","high","hips","hire","history","hockey","home","homosexual","hooli","horizontal","hospital","hotel","hotjar","hourglass","houzz","html5","hubspot","hundred","hunt","id","idea","ils","image","images","imdb","in","in-cart","inbox","indent","industry","info","inr","instagram","intergender","international","internet","interpreting","intersex","ios","ioxhost","isle","italic","itunes","japan","jcb","jenkins","jet","joget","joomla","jpy","js","jsfiddle","justify","key","keyboard","keycdn","kickstarter","king","knight","korvue","krw","lab","language","laptop","laravel","large","lastfm","law","layout","leaf","leanpub","left","legal","lemon","lesbian","less","level","license","life","lightbulb","lightning","like","line","linechat","linkedin","linkify","linode","linux","lira","list","listening","lizard","location","lock","log","logout","long","low","lyft","magento","magic","magnet","magnify","mail","male","man","map","marker","mars","martini","mastercard","maxcdn","maximize","md","meanpath","medapps","medium","medkit","medrt","meetup","meh","mercury","messenger","microchip","microphone","microsoft","military","minimize","minus","mix","mixcloud","mizuni","mobile","modx","monero","money","monster","moon","motorcycle","mouse","move","ms","mule","music","mute","napster","neuter","new","news","newspaper","nintendo","node","non","notch","notched","note","npm","ns8","numbered","numeric","nutritionix","object","ocean","odnoklassniki","of","off","official","ol","on","one","open","opencart","openid","opera","optin","optinmonster","options","order","ordered","osi","other","out","outdent","outline","overflow","page4","pagelines","paint","palfed","pallet","paper","paperclip","paragraph","paste","patreon","pause","paw","pawn","pay","payment","paypal","pdf","peace","pen","pencil","percent","periscope","phabricator","phoenix","phone","photo","php","picture","pie","piece","pied","pills","pin","pinterest","piper","pixels","plane","play","playstation","play","plug","plus","pocket","podcast","point","pointer","pointing","pound","power","powerpoint","pp","print","privacy","product","protect","puck","pushed","puzzle","python","qq","qrcode","quarter","quarters","queen","question","quidditch","quinscape","quora","quote","radio","rain","random","ravelry","react","rebel","record","rectangle","recycle","reddit","redo","redriver","refresh","registered","remove","rendact","renren","repeat","reply","replyd","resize","resolving","restore","retro","retweet","right","ring","rmb","road","rock","rocket","rocketchat","rockrms","rook","rouble","rss","rub","ruble","rupee","s15","safari","sass","save","scale","schlix","scissors","scribd","search","searchengin","secret","selected","sellcast","sellsy","send","server","servicestack","setting","settings","share","shekel","sheqel","shield","ship","shipping","shirtsinbulk","shop","shopping","shower","shuffle","shutdown","shuttle","sidebar","sign","sign-in","sign-out","signal","signing","signs","signup","simple","simplybuilt","sistrix","sitemap","skyatlas","skype","slack","slash","sliders","slideshare","smile","snapchat","snowflake","soccer","sort","sound","soundcloud","space","speakap","spinner","spock","spoon","spotify","spy","square","stack","star","start","staylinked","steam","step","stethoscope","sticker","sticky","stop","stopwatch","store","strava","street","strikethrough","stripe","stroke","student","studiovinari","stumbleupon","subscript","subway","suitcase","sun","superpowers","superscript","supple","switch","symbol","sync","syringe","systems","table","tablet","tachometer","tack","tag","tags","talk","target","tasks","taxi","telegram","telephone","teletype","television","tencent","tennis","terminal","text","th","theme","themeisle","thermometer","thin","three","thumb","thumbs","thumbtack","ticket","tie","time","times","tint","tm","to","toggle","trademark","train","transgender","translate","trash","travel","treatment","tree","trello","triangle","tripadvisor","trophy","truck","try","tumblr","tv","twitch","twitter","two","uber","uikit","ul","umbrella","underline","undo","ungroup","unhide","uniregistry","universal","university","unlink","unlinkify","unlock","unmute","unordered","untappd","up","upload","usb","usd","user","users","ussunnah","utensil","utensils","vaadin","vcard","venus","vertical","viacoin","viadeo","viber","victory","video","view","vimeo","vine","visa","vision","vk","vnv","volleyball","volume","vuejs","wait","wallet","warehouse","warning","wechat","weibo","weight","weixin","whatsapp","wheelchair","whmcs","wi-fi","width","wifi","wikipedia","window","windows","winner","wizard","woman","won","word","wordpress","world","wpbeginner","wpexplorer","wpforms","wrench","write","xbox","xing","yahoo","yandex","yc","ycombinator","yelp","yen","yoast","youtube","zero","zip","zoom","zoom-in","zoom-out"],this.customIconNames=["blocks","js","python","toolbox","book-reader","photo-video","gamepad"]}static clearBlockSnippetCache(){this.blockSnippetCache={}}getBuiltinMacros(){var e={},t=pxt.appTarget.appTheme;return t.boardName&&(e.boardname=pxt.Util.htmlEscape(t.boardName)),t.boardNickname&&(e.boardnickname=pxt.Util.htmlEscape(t.boardNickname)),t.driveDisplayName&&(e.drivename=pxt.Util.htmlEscape(t.driveDisplayName)),t.homeUrl&&(e.homeurl=pxt.Util.htmlEscape(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?`<img aria-hidden="true" role="presentation" class="ui mini image" src="${t.docsLogo}" />`:"",e}startRenderLangSnippet(e){var t=this.props["unboxSnippets"],e=e.parentElement,i=e.parentElement,n=document.createElement("div");return n.className=`ui ${t?"":"segment raised "}loading codewidget`,i.insertBefore(n,e),i.removeChild(e),n}finishRenderLangSnippet(e,t){var i;"string"==typeof t&&((i=document.createElement("code")).className="hljs",i.textContent=t,pxt.tutorial.highlight(i),t=i),e.appendChild(t),pxsim.U.removeClass(e,"loading")}cachedRenderLangSnippetAsync(e,t){const i=e.textContent,n=this.startRenderLangSnippet(e);return d.blockSnippetCache[i]?void this.finishRenderLangSnippet(n,d.blockSnippetCache[i]):t(i).then(e=>{d.blockSnippetCache[i]=e,this.finishRenderLangSnippet(n,d.blockSnippetCache[i])}).catch(e=>{pxt.reportException(e),this.finishRenderLangSnippet(n,lf("Something changed."))})}renderSnippets(e){const{parent:a,unboxSnippets:s,onDidRender:t,blocksDiffOptions:r,textDiffOptions:i}=this.props;let l=[];function o(t){const i=t.svg;if(i){if("SVG"==i.tagName){const t=i.getAttribute("viewBox").split(" ").map(parseFloat),n=t[2];let e=t[3];(480<n||128<e)&&(e=.8*e|0),i.setAttribute("height",e+"px")}return i}{const i=document.createElement("div");return i.className="ui basic segment",i.textContent=t.message||lf("No changes."),i}}function n(e,t){const i=e.textContent,r=document.createElement("div"),n=(pxsim.U.clear(e),e.appendChild(r),r.className=`ui ${s?"":"segment raised "} loading`,{type:"pxteditor",action:"renderblocks",ts:i,snippetMode:t}),o=JSON.stringify(n);if(d.blockSnippetCache[o]){const e=d.blockSnippetCache[o],a=Blockly.utils.xml.textToDomDocument(pxt.blocks.layout.serializeSvgString(e));r.appendChild(a.documentElement),pxsim.U.removeClass(r,"loading")}else l.push(a.renderBlocksAsync(n).then(t=>{var i=t.svg;if(i){const t=i.getAttribute("viewBox").split(" ").map(parseFloat),n=t[2];let e=t[3];(480<n||128<e)&&(e=.8*e|0),i.setAttribute("height",e+"px"),pxt.BrowserUtils.isIE()||(d.blockSnippetCache[o]=Blockly.Xml.domToText(i)),r.appendChild(i)}else{const t=document.createElement("span");t.textContent=lf("Oops, something went wrong trying to render this block snippet."),r.appendChild(t)}pxsim.U.removeClass(r,"loading")}))}pxt.Util.toArray(e.querySelectorAll("img")).forEach(i=>{l.push(new Promise((e,t)=>{i.addEventListener("load",()=>e(),!1),i.addEventListener("error",()=>e(),!1)}))}),pxt.Util.toArray(e.querySelectorAll("code.lang-typescript,code.lang-python")).forEach(e=>{var t=e.textContent,e=this.startRenderLangSnippet(e);this.finishRenderLangSnippet(e,t)}),pxt.Util.toArray(e.querySelectorAll("code.lang-spy")).forEach(e=>{l.push(this.cachedRenderLangSnippetAsync(e,e=>a.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then(e=>e.python)))}),pxt.Util.toArray(e.querySelectorAll("code.lang-diffspy")).forEach(e=>{l.push(this.cachedRenderLangSnippetAsync(e,e=>{var{fileA:e,fileB:t}=pxt.diff.split(e);return pxt.Util.promiseMapAllSeries([e,t],e=>a.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then(e=>e.python)).then(e=>pxt.diff.render(e[0],e[1],i||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0}))}))}),pxt.Util.toArray(e.querySelectorAll("code.lang-diff,code.lang-diffpython")).forEach(e=>{l.push(this.cachedRenderLangSnippetAsync(e,e=>{var{fileA:e,fileB:t}=pxt.diff.split(e),e=pxt.diff.render(e,t,i||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});return Promise.resolve(e)}))}),pxt.Util.toArray(e.querySelectorAll("code.lang-blocks")).forEach(e=>n(e,!1)),pxt.Util.toArray(e.querySelectorAll("code.lang-block")).forEach(e=>n(e,!0)),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocksxml")).forEach(e=>{const t=e.textContent,{fileA:i,fileB:n}=pxt.diff.split(t);l.push(this.cachedRenderLangSnippetAsync(e,e=>pxt.BrowserUtils.loadBlocklyAsync().then(()=>o(pxt.blocks.diffXml(i,n,r)))))}),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocks")).forEach(e=>{const t=e.textContent,{fileA:i,fileB:n}=pxt.diff.split(t);l.push(this.cachedRenderLangSnippetAsync(e,e=>pxt.BrowserUtils.loadBlocklyAsync().then(()=>c.getBlocksAsync()).then(t=>pxt.Util.promiseMapAllSeries([i,n],e=>c.decompileBlocksSnippetAsync(e,t))).then(e=>pxt.blocks.decompiledDiffAsync(i,e[0],n,e[1],r||{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0})).then(e=>o(e))))}),(l=l.filter(e=>!!e)).length&&t&&Promise.all(l).then(()=>{pxt.log("markdowcontent: forcing update after async rendering"),t()})}renderInlineBlocks(e){pxt.Util.toArray(e.querySelectorAll(":not(pre) > code")).forEach(e=>{const t=e.innerText,i=/^(\|+)([^\|]+)\|+$/.exec(t);if(i){const t=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(i[2]),n=t[2]?t[2].trim().toLowerCase():"",r=t[3].trim(),o=1==i[1].length?`docs inlinebutton ui button ${pxt.Util.htmlEscape(r.toLowerCase())}-button`:"docs inlineblock "+pxt.Util.htmlEscape(n),a=document.createElement("span");pxsim.U.clear(e),e.appendChild(a),a.className=o,a.textContent=pxt.U.rlf(r)}})}renderBullets(e){const s=/^:([^:]+):/i;pxt.Util.toArray(e.querySelectorAll("li")).forEach(e=>{var t=e.innerHTML.match(s);if(null!=t&&t[1]){const s=document.createElement("p");pxt.Util.toArray(e.childNodes).forEach(e=>s.appendChild(e)),e.appendChild(s)}}),pxt.Util.toArray(e.querySelectorAll("li > p")).forEach(i=>{var n=i.innerText.match(s);if(null!=n&&n[1]){var r=pxt.Util.toArray(i.childNodes).find(e=>"#text"===e.nodeName),r=(null!=r&&r.nodeValue&&(r.nodeValue=r.nodeValue.replace(s,"")),i.parentElement),o=(r.className+=" formatted-bullet-li",r.parentElement),o=(o.classList.contains("formatted-bullet-ul")||(o.className+=" formatted-bullet-ul"),document.createElement("div")),a=(o.className="formatted-bullet",document.createElement("i"));let e=n[1].split(" "),t=e.filter(e=>0<=this.semanticIconNames.indexOf(e));t.length?a.className="ui icon "+t.join(" "):(t=e.filter(e=>0<=this.customIconNames.indexOf(e)),a.className="ui xicon "+t.join(" ")),o.appendChild(a),r.insertBefore(o,i)}})}renderOthers(e){pxt.Util.toArray(e.querySelectorAll(".lang-package,.lang-config,.lang-apis")).forEach(e=>{e.parentNode.removeChild(e)})}renderMarkdown(e){const t=this.refs["marked-content"],i=this.getBuiltinMacros();if(e){pxt.perf.measureStart("renderMarkdown"),e=e.replace(/@([a-z]+)@/gi,(e,t)=>i[t]||"unknown macro");let r=new a.Renderer;pxt.docs.setupRenderer(r);const o=r.link;r.link=function(e,t,i){var n=/^[\/#]/.test(e)?"":"_blank";return o.call(r,e,t,i).replace(/^<a /,`<a ${n?`target="${n}"`:""} rel="nofollow noopener" `)},a.setOptions({renderer:r,sanitize:!0,sanitizer:pxt.docs.requireDOMSanitizer()}),e=e.replace(/<\s*script[^>]*>.*<\/\s*script\s*>/g,"");var n=document.createElement("div");n.innerHTML=a(e),this.renderInlineBlocks(n),this.renderSnippets(n),this.renderBullets(n),this.renderOthers(n),t.innerHTML="",t.append(...n.childNodes),pxt.perf.measureEnd("renderMarkdown")}}componentDidMount(){var e=this.props["markdown"];this.renderMarkdown(e)}UNSAFE_componentWillReceiveProps(e){var t=e["markdown"];this.props.markdown!=e.markdown&&this.renderMarkdown(t)}renderCore(){var{className:e,tabIndex:t}=this.props;return n.createElement("div",{ref:"marked-content",className:e||"",tabIndex:t})}}(i.MarkedContent=d).blockSnippetCache={}},{"./compiler":18,"./data":67,marked:230,react:320}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.provider=n.merge=n.projects=void 0;var i=pxt.Util;n.projects={},n.merge=function(e){e.header||(e.header=pxt.workspace.freshHeader(lf("Untitled"),i.nowSeconds()),e.text&&e.text[pxt.MAIN_BLOCKS]&&(e.header.editor=pxt.BLOCKS_PROJECT_NAME)),n.projects[e.header.id]=e},n.provider={getAsync:function(e){var t=n.projects[e.id];return Promise.resolve({header:e,text:t?t.text:{},version:null})},setAsync:function(e,t,i){return i&&(n.projects[e.id]={header:e,text:i}),Promise.resolve()},deleteAsync:function(e,t){return delete n.projects[e.id],Promise.resolve()},listAsync:function(){return Promise.resolve(i.values(n.projects).map(e=>e.header))},resetAsync:function(){return n.projects={},Promise.resolve()}}},{}],99:[function(e,t,i){"use strict";function s(a,s){var e;if(!a)return s;if(!s)return a;const l=JSON.parse(a),c=JSON.parse(s),d={},u={},p={},h={},f={},m=c["*"].mimeType;for(const a of Object.keys(c))if("*"!==a){const s=c[a];let e,t=m,i=!(p[a]=!0);"string"==typeof s?e=s:(e=s.data,t=s.mimeType,i=!!s.tilemapTile,s.displayName&&(u[s.displayName]=!0)),t!==pxt.TILEMAP_MIME_TYPE&&(d[t+i+e]=a)}for(const a of Object.keys(l))if("*"!==a){const s=l[a];let e,i,n=m,r=!1,o=!1;"string"==typeof s?(e=s,o=!0):(e=s.data,i=s.displayName,n=s.mimeType,r=!!s.tilemapTile);var g=n+r+e;if(d[g])r&&(h[pxt.sprite.TILE_NAMESPACE+"."+a]=pxt.sprite.TILE_NAMESPACE+"."+d[g]);else{if(!i)switch(n){case pxt.IMAGE_MIME_TYPE:i=r?pxt.sprite.TILE_NAMESPACE+"."+pxt.sprite.TILE_PREFIX:pxt.sprite.IMAGES_NAMESPACE+"."+pxt.sprite.IMAGE_PREFIX;break;case pxt.TILEMAP_MIME_TYPE:i="tilemap";break;case pxt.ANIMATION_MIME_TYPE:i=pxt.sprite.ANIMATION_NAMESPACE+"."+pxt.sprite.ANIMATION_PREFIX}if(i&&u[i]){let e=0;for(;u[i+e];)e++;u[i+=e]=!0}let t=a;if(p[t]){let e=0;for(;p[t+e];)e++;p[t+=e]=!0,r&&(h[pxt.sprite.TILE_NAMESPACE+"."+a]=pxt.sprite.TILE_NAMESPACE+"."+t)}n!==pxt.TILEMAP_MIME_TYPE&&(d[g]=a);g=Object.assign(Object.assign({},o?{}:l[a]),{data:e,displayName:i,mimeType:n});g.id&&(g.id=t),n===pxt.TILEMAP_MIME_TYPE?f[t]=g:c[t]=g}}for(const a of Object.keys(f)){const s=f[a];s.tileset=null==(e=s.tileset)?void 0:e.map(e=>h[e]||e),c[a]=s}return JSON.stringify(c)}Object.defineProperty(i,"__esModule",{value:!0}),i.mergeProjectCode=void 0,i.mergeProjectCode=function(e,t,i){var n,r=t[pxt.CONFIG_NAME],r=pxt.U.jsonTryParse(r),o=i?s(t[pxt.TILEMAP_JRES],e[pxt.TILEMAP_JRES]):s(e[pxt.TILEMAP_JRES],t[pxt.TILEMAP_JRES]),a=i?s(t[pxt.IMAGES_JRES],e[pxt.IMAGES_JRES]):s(function(e,t){if(!e)return t;let i=pxt.U.jsonTryParse(t)||{},n=(i["*"]||(i["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:pxt.sprite.IMAGES_NAMESPACE}),0);return function(){const i=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*(img`[\s\da-f.#tngrpoyw]+`)\s*<\/field>/gim,(e,t)=>{t=null==(t=pxt.sprite.imageLiteralToBitmap(t))?void 0:t.data();return t&&i.push(t),e}),i}().forEach(e=>{for(var t=pxt.Util.guidGen();i[pxt.sprite.IMAGES_NAMESPACE+"."+pxt.sprite.IMAGE_PREFIX+n];)n++;i[t]={data:pxt.sprite.base64EncodeBitmap(e),mimeType:pxt.IMAGE_MIME_TYPE,displayName:pxt.sprite.IMAGES_NAMESPACE+"."+pxt.sprite.IMAGE_PREFIX+n},n++}),n=0,function(){const n=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*\[((?:img`[\s\da-f.#tngrpoyw]+`,?)+)\]\s*<\/field>(?:.*<shadow type=\"timePicker\"><field name=\"ms\">(\d+)<\/field><\/shadow>)?/gim,(e,t,i)=>{t=t.split(",").map(e=>{return null==(e=pxt.sprite.imageLiteralToBitmap(e))?void 0:e.data()});return n.push({frames:t.filter(e=>!!e),interval:i||500}),e}),n}().forEach(e=>{for(var t=pxt.Util.guidGen();i[pxt.sprite.ANIMATION_NAMESPACE+"."+pxt.sprite.ANIMATION_NAMESPACE+n];)n++;i[t]={data:pxt.sprite.encodeAnimationString(e.frames,e.interval),mimeType:pxt.ANIMATION_MIME_TYPE,displayName:pxt.sprite.ANIMATION_NAMESPACE+"."+pxt.sprite.ANIMATION_PREFIX+n},n++}),JSON.stringify(i)}(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]),t[pxt.IMAGES_JRES]);return o&&(null==(n=null==r?void 0:r.files)?void 0:n.indexOf(pxt.TILEMAP_JRES))<0&&r.files.push(pxt.TILEMAP_JRES),a&&(null==(n=null==r?void 0:r.files)?void 0:n.indexOf(pxt.IMAGES_JRES))<0&&r.files.push(pxt.IMAGES_JRES),Object.assign(Object.assign({},t),{[pxt.MAIN_TS]:(i?e:t)[pxt.MAIN_TS],[pxt.MAIN_PY]:(i?e:t)[pxt.MAIN_PY],[pxt.MAIN_BLOCKS]:(i?e:t)[pxt.MAIN_BLOCKS],[pxt.TILEMAP_JRES]:o,[pxt.IMAGES_JRES]:a,[pxt.CONFIG_NAME]:JSON.stringify(r)})}},{}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.rangeToSelection=i.Editor=void 0;const r=e("react"),n=e("react-dom"),c=e("./package"),l=e("./core"),o=e("./toolboxeditor"),d=e("./compiler"),s=e("./monacoSnippets"),a=e("./monacopyhelper"),u=e("./simulator"),p=e("./toolbox"),h=e("./blocklyFieldView"),f=e("./monacoFieldEditorHost"),m=e("./data");var g=pxt.Util;const b=e("./monacoDebugger"),v=e("./debuggerToolbox"),y=e("./monacoEditAmendments"),w=e("./monacoFlyout"),k=e("./errorList"),x=e("./auth");class E{constructor(e,t){this.editor=e,this.python=t,this.triggerCharacters=["(","."],this.kindMap={}}tsKindToMonacoKind(e){switch(e){case 1:return monaco.languages.CompletionItemKind.Method;case 2:return monaco.languages.CompletionItemKind.Property;case 3:return monaco.languages.CompletionItemKind.Function;case 4:return monaco.languages.CompletionItemKind.Variable;case 5:return monaco.languages.CompletionItemKind.Module;case 6:return monaco.languages.CompletionItemKind.Class;case 7:return monaco.languages.CompletionItemKind.Enum;case 8:return monaco.languages.CompletionItemKind.Class;case 9:return monaco.languages.CompletionItemKind.Interface;default:return monaco.languages.CompletionItemKind.Text}}provideCompletionItems(u,p,e,t){var i=u.getOffsetAt(p),n=u.getValue(),r=this.editor.currFile.name,o=u.getWordUntilPosition(p),a=u.getOffsetAt({lineNumber:p.lineNumber,column:o.startColumn}),o=u.getOffsetAt({lineNumber:p.lineNumber,column:o.endColumn});return d.completionsAsync(r,i,a,o,n,pxt.options.light).then(c=>{function d(e){if(e)for(var t of c.namespace){if(!e.startsWith(t+"."))break;e=e.substr((t+".").length)}return e}let e=c.entries||[];return{suggestions:(e=e.filter(e=>"_"!=e.name.charAt(0))).map((e,t)=>{var i=this.python?e.pySnippetWithMarkers:e.snippetWithMarkers,n=!!i,r=this.python?e.pySnippet:e.snippet;let o=n?i:r;o=d(o);var i=d(this.python?e.pyQName:e.qName),a=this.python?e.pyName:e.name,s=o&&0<=o.indexOf("\n");if(this.python&&o&&s&&pxt.blocks.hasHandler(e))o=y.amendmentToInsertSnippet(y.createLineReplacementPyAmendment(o));else if(o=o||i,c.isMemberCompletion&&o){const u=o.lastIndexOf(a);-1!==u&&(o=o.substr(u))}var s=c.isMemberCompletion?a:i,a=pxt.Util.rlf(e.attributes.jsDoc),i=pxt.Util.rlf(e.attributes.block),l=u.getWordAtPosition(p),l={startLineNumber:p.lineNumber,startColumn:l?l.startColumn:p.column,endColumn:p.column,endLineNumber:p.lineNumber},i=(s+`,${a},`+i).replace(/\s/g,","),e=this.tsKindToMonacoKind(e.kind);return{label:s,range:l,kind:e,documentation:a,detail:`(${monaco.languages.CompletionItemKind[e].toLowerCase()}) `+(r||""),sortText:("000"+t).slice(-4)+" "+o,filterText:i,insertText:o||void 0,insertTextRules:n?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0}})}})}}class C{constructor(e,t){this.editor=e,this.python=t,this.signatureHelpTriggerCharacters=["(",","],this.isPython=!1,this.isPython=t}provideSignatureHelp(e,t,i,n){var t=e.getOffsetAt(t),e=e.getValue(),r=this.editor.currFile.name;return d.syntaxInfoAsync("signature",r,t,e).then(e=>{var t,i,n=e.symbols?e.symbols[0]:null;return n&&n.parameters?(t=pxt.Util.rlf(n.attributes.jsDoc),i=n.parameters.map(e=>({label:e.name+": "+(this.isPython?e.pyTypeString:e.type),documentation:pxt.Util.rlf(e.description)})),{value:{signatures:[{label:`${this.isPython&&n.pyName?n.pyName:n.name}(${i.map(e=>e.label).join(", ")})`,documentation:t,parameters:i}],activeSignature:0,activeParameter:e.auxResult},dispose:()=>{}}):null})}}class _{constructor(e,t){this.editor=e,this.python=t}provideHover(n,e,t){var i,r;return this.editor.hasInsertionSnippet()?null:(e=n.getOffsetAt(e),i=n.getValue(),r=this.editor.currFile.name,d.syntaxInfoAsync("symbol",r,e,i).then(e=>{let t,i=e.symbols?e.symbols[0]:null;if(i){const n=pxt.Util.rlf(i.attributes.jsDoc);t=[e.auxResult[0],n]}else e.auxResult&&(t=[e.auxResult.displayString,e.auxResult.documentation]);return t?{contents:t.map(S),range:monaco.Range.fromPositions(n.getPositionAt(e.beginPos),n.getPositionAt(e.endPos))}:null}))}}function S(e){return{value:e}}const T={comments:{lineComment:"#",blockComment:['"""','"""']},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:'r"',close:'"',notIn:["string","comment"]},{open:'R"',close:'"',notIn:["string","comment"]},{open:'u"',close:'"',notIn:["string","comment"]},{open:'U"',close:'"',notIn:["string","comment"]},{open:'f"',close:'"',notIn:["string","comment"]},{open:'F"',close:'"',notIn:["string","comment"]},{open:'b"',close:'"',notIn:["string","comment"]},{open:'B"',close:'"',notIn:["string","comment"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"r'",close:"'",notIn:["string","comment"]},{open:"R'",close:"'",notIn:["string","comment"]},{open:"u'",close:"'",notIn:["string","comment"]},{open:"U'",close:"'",notIn:["string","comment"]},{open:"f'",close:"'",notIn:["string","comment"]},{open:"F'",close:"'",notIn:["string","comment"]},{open:"b'",close:"'",notIn:["string","comment"]},{open:"B'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string"]}],onEnterRules:[{beforeText:/^\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async).*?:\s*$/,action:{indentAction:1}}]};class A{constructor(e,t){this.editor=e,this.python=t,this.isPython=!1,this.isPython=t}provideDocumentRangeFormattingEdits(t,i,n,r){return Promise.resolve().then(e=>this.isPython?a.provideDocumentRangeFormattingEdits(t,i,n,r):null)}}const N={cpp:"cpp",h:"cpp",json:"json",md:"markdown",py:"python",ts:"typescript",js:"javascript",svg:"xml",blocks:"xml",asm:"asm"};class I extends o.ToolboxEditor{constructor(e){super(e),this.fileType="text",this.giveFocusOnLoading=!0,this.foldFieldEditorRanges=!0,this.hasFieldEditors=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),this.highlightDecorations=[],this.errorChangesListeners={},this.exceptionChangesListeners={},this.userPreferencesSubscriber={subscriptions:[],onDataChanged:()=>{this.onUserPreferencesChanged()}},this.handleFlyoutWheel=e=>e.stopPropagation(),this.handleFlyoutScroll=e=>e.stopPropagation(),this.insertSnippet=(n,r,o=!1)=>{var a=this.editor.getPosition(),s=this.editor.getModel();if(n=n||a){let e,t=n.clone();"NewLineAfter"==(e=o?"Inline":1===n.column?"NewLineBefore":"NewLineAfter")&&(t=t.with(t.lineNumber,s.getLineMaxColumn(n.lineNumber)));var a=s.getLineContent(n.lineNumber),l=("Inline"!=e&&a&&("NewLineAfter"==e?r="\n"+r:r+="\n"),e=>{let t=e.match(/^\s*/)[0]||"";return t=t.replace("\t"," ".repeat(4)),Math.floor(t.length/4)}),a=l(a);let i;if("NewLineAfter"==e){const r=Math.min(n.lineNumber+1,s.getLineCount()),o=l(s.getLineContent(r));i=Math.max(a,o)}else i="NewLineBefore"==e?a:0;const c=" ".repeat(4*i);if(c){let e=r.split("\n");r=(e=e.map(e=>e&&c+e)).join("\n")}this.editor.pushUndoStop(),this.editor.executeEdits("",[{range:new monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column),text:r||"",forceMoveMarkers:!0}]),this.beforeCompile(),this.editor.pushUndoStop(),this.editor.focus()}},this.dragCurrentPos={x:0,y:0},this.onDragBlockThrottled=g.throttle(()=>{var{x:e,y:t}=this.dragCurrentPos,e=this.editor.getTargetAtClientPoint(e,t);e&&e.position&&this.editor.getPosition()!=e.position&&this.editor.setPosition(e.position),this.editor.focus()},200),this.onPointerMove=e=>{this.insertionSnippet&&(this.dragCurrentPos={x:pxt.BrowserUtils.getClientX(e),y:pxt.BrowserUtils.getClientY(e)},this.onDragBlockThrottled(e))},this.onPointerUp=r=>{let o=this.insertionSnippet;if(this.setInsertionSnippet(void 0),o){let i=pxtc.U.startsWith(o,"inline:1&"),n=(i&&(o=o.substring("inline:1&".length)),Promise.resolve(o));if(pxtc.U.startsWith(o,"qName:")){let e="python"==this.fileType,t=o.substring("qName:".length);n=(e?this.parent.saveFileAsync():Promise.resolve()).then(()=>d.snippetAsync(t,e))}n.then(e=>{var t=this.editor.getTargetAtClientPoint(pxt.BrowserUtils.getClientX(r),pxt.BrowserUtils.getClientY(r)).position;pxt.tickEvent("monaco.toolbox.insertsnippet"),this.insertSnippet(t,e,i)})}},this.moveFocusToToolbox=()=>{this.toolbox&&this.toolbox.focus()},this.revealBreakpointLocation=(e,t)=>{var i;this.breakpoints&&(i=this.breakpoints.getLocationOfBreakpoint(e))&&(this.highlightedBreakpoint=e,this.currFile.getTextFileName()!==i.fileName?(c.mainEditorPkg(),L(i.fileName)&&this.parent.setFile(L(i.fileName))):this.highilightStatementCore(i,!0),this.debuggerToolbox)&&this.debuggerToolbox.setState({currentFrame:t})},this.setInsertionSnippet=e=>{this.insertionSnippet=e},this.hasInsertionSnippet=()=>!!this.insertionSnippet,this.uniqueBlockId=0,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebugToolboxRef=e=>{e&&(this.debuggerToolbox=e,this.isDebugging())&&this.updateToolbox()},this.handleFlyoutRef=e=>{e&&(this.flyout=e)},this.setErrorListState=this.setErrorListState.bind(this),this.listenToErrorChanges=this.listenToErrorChanges.bind(this),this.listenToExceptionChanges=this.listenToExceptionChanges.bind(this),this.goToError=this.goToError.bind(this),this.startDebugger=this.startDebugger.bind(this),this.onUserPreferencesChanged=this.onUserPreferencesChanged.bind(this),m.subscribe(this.userPreferencesSubscriber,x.HIGHCONTRAST)}onUserPreferencesChanged(){var e=m.getData(x.HIGHCONTRAST);this.loadMonacoPromise&&this.defineEditorTheme(e,!0)}hasBlocks(){var e;return!this.currFile||(e=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME))&&null!=c.mainEditorPkg().files[e]}openBlocks(){this.openBlocksAsync()}async openBlocksAsync(){pxt.tickEvent("typescript.showBlocks");let e=Promise.resolve();if(!pxt.BrowserUtils.isWinRT()){if(!this.currFile){const e=c.mainEditorPkg();if(!e||!e.files[pxt.MAIN_TS])return;await this.loadFileAsync(e.files[pxt.MAIN_TS])}var t=e.then(()=>{const e="python"==this.fileType,o=e?"python":"typescript",a=(pxt.tickEvent(o+".convertBlocks"),c.mainEditorPkg());if(this.hasBlocks()||a||a.files[pxt.MAIN_BLOCKS]){this.feWidget&&(this.feWidget.close(),this.activeRangeID=null);let n=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME);e?this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME):this.currFile.name;if(!this.hasBlocks()){if(!a||!a.files[pxt.MAIN_BLOCKS])return void(a&&this.parent.setFile(a.files[pxt.MAIN_TS]));this.currFile=a.files[pxt.MAIN_TS],n=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),pxt.MAIN_TS}const s=(e,t=!1)=>(l.cancelAsyncLoading("switchtoblocks"),this.forceDiagnosticsUpdate(),this.showBlockConversionFailedDialog(e,t));let i,r;return this.parent.saveFileAsync().then(()=>this.parent.saveFileAsync()).then(()=>this.parent.loadBlocklyAsync()).then(()=>this.saveToTypeScriptAsync()).then(()=>d.getBlocksAsync()).then(e=>{r=e,pxt.blocks.initializeAndInject(r);const i=pxt.blocks.loadWorkspaceXml(a.files[n].content);return i?pxt.blocks.compileAsync(i,r).then(e=>{e=e.source;return d.formatAsync(e,0).then(t=>d.formatAsync(this.editor.getValue(),0).then(e=>t.formatted==e.formatted?(pxt.debug(o+" not changed, skipping decompile"),pxt.tickEvent(o+".noChanges"),this.parent.setFile(a.files[n]),[i,!1]):[i,!0]))}):[i,!0]}).then(e=>{if(!e)return Promise.resolve();const t=e[0];return e[1]?d.compileAsync().then(e=>e.success?this.transpileToBlocksInternalAsync(this.currFile,r,t).then(e=>{if(e.success)return i=e.outText,g.assert(!!i),a.setContentAsync(n,i).then(()=>this.parent.setFile(a.files[n]));{e=e.failedResponse;this.currFile.diagnostics=e.diagnostics;let t=!1;return e.diagnostics.forEach(e=>t=t||9266===e.code),s(n,t)}}):s(n,!1)):Promise.resolve()}).catch(e=>{pxt.reportException(e),l.errorNotification(lf("Oops, something went wrong trying to convert your code."))})}pxt.debug("cancelling convertion to blocks, but main.blocks is missing")});return l.showLoadingAsync("switchtoblocks",lf("switching to blocks..."),t),e}}showBlockConversionFailedDialog(e,t){const i="python"==this.fileType,n=i?"python":"typescript";let r,o,a=c.mainEditorPkg().files[e];return t&&pxt.tickEvent(n+".programTooLarge"),o=i?(r=t?lf("Your program is too large to convert into blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your Python code back to blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."),lf("Stay in Python")):(r=t?lf("Your program is too large to convert into blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your JavaScript code back to blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."),lf("Stay in JavaScript")),l.confirmAsync({header:t?lf("Program too large"):lf("Oops, there is a problem converting your code."),body:r,agreeLbl:lf("Discard and go to Blocks"),agreeClass:"cancel",agreeIcon:"cancel",disagreeLbl:o,disagreeClass:"positive",disagreeIcon:"checkmark",hideCancel:!a}).then(e=>{e?(pxt.tickEvent(n+".discardText",void 0,{interactiveConsent:!0}),this.parent.saveBlocksToTypeScriptAsync().then(e=>{this.overrideFile(e),this.parent.setFile(a)})):pxt.tickEvent(n+".keepText",void 0,{interactiveConsent:!0})})}transpileToBlocksInternalAsync(e,t,i){const n=c.mainEditorPkg(),r=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),o=e.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),a="py"===e.getExtension()?"py":"ts",s=e.content,l=n.getCachedTranspile(a,s,"blocks");return null!=l?Promise.resolve({success:!0,outText:l}):d.decompileAsync(r,t,i,o).then(e=>{var t;return e.success?(t=e.outfiles[o],n.cacheTranspile(a,s,"blocks",t),{success:!0,outText:t}):{success:!1,failedResponse:e}})}decompileAsync(e){return d.decompileAsync(e)}setVisible(e){super.setVisible(e),e||this.onErrorChanges([])}display(){var e=pxt.appTarget.appTheme.errorList,t=pxt.BrowserUtils.isAndroid(),i=pxt.BrowserUtils.isWinRT(),n=i?this.getWinAppErrorMsg():[];return r.createElement("div",{id:"monacoEditorArea",className:"monacoEditorArea "+(t?"android":""),style:{direction:"ltr"}},this.isVisible&&r.createElement("div",{className:"monacoToolboxDiv "+(!this.toolbox||this.toolbox.state.visible||this.isDebugging()?"":"invisible")},r.createElement(p.Toolbox,{ref:this.handleToolboxRef,editorname:"monaco",parent:this}),r.createElement("div",{id:"monacoDebuggerToolbox"})),i?r.createElement("div",{id:"winAppError"},r.createElement("img",{className:"ui medium centered image",alt:lf("An image of a shrugging board"),src:pxt.appTarget.appTheme.winAppDeprImage}),r.createElement("div",{className:"ui centered",id:"winAppErrorMsg"},n)):r.createElement("div",{id:"monacoEditorRightArea",className:"monacoEditorRightArea"},r.createElement("div",{id:"monacoEditorInner"},r.createElement(w.MonacoFlyout,{ref:this.handleFlyoutRef,fileType:this.fileType,blockIdMap:this.blockIdMap,moveFocusToParent:this.moveFocusToToolbox,insertSnippet:this.insertSnippet,setInsertionSnippet:this.setInsertionSnippet,parent:this.parent})),e&&r.createElement(k.ErrorList,{isInBlocksEditor:!1,onSizeChange:this.setErrorListState,listenToErrorChanges:this.listenToErrorChanges,listenToExceptionChanges:this.listenToExceptionChanges,goToError:this.goToError,startDebugger:this.startDebugger})))}getWinAppErrorMsg(){var e=lf("Oops! Text editing is only available on the website at {0}. Go {1} for more information.","https://"+pxt.appTarget.name,"{1}").split(/\{\d\}/);return[e[0],r.createElement("a",{href:"/windows-app",target:"_blank",rel:"noopener noreferrer"},lf("here")),e[1]]}listenToExceptionChanges(e,t){this.exceptionChangesListeners[e]=t}onExceptionDetected(e){for(var t of pxt.U.values(this.exceptionChangesListeners))t(e,this.callLocations)}listenToErrorChanges(e,t){this.errorChangesListeners[e]=t}goToError(e){let t,i;i=e.endLine&&e.endColumn?(t=e.endLine+1,e.endColumn+1):(t=e.line+1,e.column+e.length+1),this.editor.revealLineInCenter(t),this.editor.setPosition({column:i,lineNumber:t}),this.editor.focus()}startDebugger(){pxt.tickEvent("errorList.startDebugger",null,{interactiveConsent:!0}),this.parent.toggleDebugging()}onErrorChanges(e){for(var t of pxt.U.values(this.errorChangesListeners))t(e)}showPackageDialog(){pxt.tickEvent("monaco.addpackage",void 0,{interactiveConsent:!0}),this.hideFlyout(),this.parent.showPackageDialog()}defineEditorTheme(r,e){const t=pxt.appTarget.appTheme.invertedMonaco;let o=[];if(!r&&e){const r={},e=(this.getNamespaces().forEach(e=>{var i=this.getNamespaceAttrs(e),n=s.isBuiltin(e)?s.getBuiltinCategory(e).blocks.concat(this.nsMap[e]||[]):this.nsMap[e];if(i.color&&n){let t=a(i.color);n.forEach(e=>{o.push({token:"identifier.ts "+e.name,foreground:t})}),o.push({token:"identifier.ts "+e,foreground:t}),r[e]=i.color}}),o.push({token:"identifier.ts if",foreground:"5B80A5"}),o.push({token:"identifier.ts else",foreground:"5B80A5"}),o.push({token:"identifier.ts while",foreground:"5BA55B"}),o.push({token:"identifier.ts for",foreground:"5BA55B"}),pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock);if(e){const t=e.callName||"pauseUntil",i=e.color||r[e.category];i&&o.push({token:"identifier.ts "+t,foreground:a(i)})}}const i=pxt.appTarget.appTheme.monacoColors||{};function a(e){return e=pxt.toolbox.convertColor(e),(t?pxt.toolbox.fadeColor(e,.6,!0):e).replace("#","")}monaco.editor.defineTheme("pxtTheme",{base:r?"hc-black":t?"vs-dark":"vs",inherit:!0,rules:o,colors:r?{}:i}),monaco.editor.setTheme("pxtTheme")}saveToTypeScriptAsync(){return"python"==this.fileType?this.convertPythonToTypeScriptAsync(this.isDebugging()||this.parent.state.tracing):Promise.resolve(void 0)}convertPythonToTypeScriptAsync(e=!1){if(!this.currFile)return Promise.resolve(void 0);const n=this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);return d.py2tsAsync(e).then(e=>{var t,i;if(e.sourceMap&&(i=c.mainEditorPkg(),t=e.outfiles[n],i=null==(i=i.files[this.currFile.getFileNameWithExtension("py")])?void 0:i.content,this.pythonSourceMap=t&&i?pxtc.BuildSourceMapHelpers(e.sourceMap,t,i):null),!e.diagnostics||!e.diagnostics.length)return e.outfiles[n]||""})}setHighContrast(e){}beforeCompile(){}isIncomplete(){return!!(this.editor&&this.editor._view&&this.editor._view.contentWidgets._widgets["editor.widget.suggestWidget"].isVisible)||!(!this.editor||this.currFile.name!==pxt.CONFIG_NAME||g.jsonTryParse(this.getCurrentSource()))}resize(e){var t=document.getElementById("monacoEditorArea");if(t){var i=t.getElementsByClassName("monacoToolboxDiv")[0];if(t&&this.editor){const e=i&&i.offsetWidth||0,n=this.parent.isJavaScriptActive()?this.parent.updateEditorLogo(e,this.getEditorColor()):0;if(this.editor.layout({width:t.offsetWidth-e,height:t.offsetHeight-n}),t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect();h.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height})}else h.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight});i&&(i.style.height="100%")}}}setErrorListState(e){this.parent.state.errorListState!=e&&(this.resize(),this.parent.setState({errorListState:e}))}prepare(){this.isReady=!0}loadMonacoAsync(){return this.loadMonacoPromise||(this.loadMonacoPromise=this.createLoadMonacoPromise()),this.loadMonacoPromise}createLoadMonacoPromise(){this.extraLibs=Object.create(null),document.getElementById("monacoEditorArea");var e=document.getElementById("monacoEditorInner");return pxt.vs.initMonacoAsync(e).then(t=>{if(this.editor=t,"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints&&!this.mobileKeyboardWidget&&(this.mobileKeyboardWidget=new P(this.editor)),this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.editor.addAction({id:"save",label:lf("Save"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.2,run:()=>Promise.resolve(this.parent.typecheckNow())}),this.editor.addAction({id:"runSimulator",label:lf("Run Simulator"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.21,run:()=>Promise.resolve(this.parent.runSimulator())}),pxt.appTarget.compile&&pxt.appTarget.compile.hasHex&&this.editor.addAction({id:"compileHex",label:lf("Download"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.22,run:()=>Promise.resolve(this.parent.compile())}),this.editor.addAction({id:"zoomIn",label:lf("Zoom In"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_ADD,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_EQUAL],run:()=>Promise.resolve(this.zoomIn())}),this.editor.addAction({id:"zoomOut",label:lf("Zoom Out"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_SUBTRACT,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_MINUS],run:()=>Promise.resolve(this.zoomOut())}),pxt.appTarget.appTheme.hasReferenceDocs){let t=this.editor.createContextKey("editorHasReference",!1);this.editor.addAction({id:"reference",label:lf("Help"),keybindingContext:"!editorReadonly && editorHasReference",precondition:"!editorReadonly && editorHasReference",contextMenuGroupId:"navigation",contextMenuOrder:.1,run:()=>Promise.resolve(this.loadReference())}),this.editor.onDidChangeCursorPosition(e=>{e=this.editor.getModel().getWordUntilPosition(e.position);e&&""!=e.word?t.set(!0):t.reset()})}this.editor.addAction({id:"jumptoolbox",label:lf("Jump to Toolbox"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KEY_T],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",run:()=>Promise.resolve(this.moveFocusToToolbox())}),this.editor.onDidLayoutChange(e=>{var t=this.getEditorFontSize(),t=(this.parent.settings.editorFontSize!=t&&(this.parent.settings.editorFontSize=t,this.forceDiagnosticsUpdate()),document.getElementById("monacoToolboxDiv"));t&&(t.style.height=this.editor.getLayoutInfo().height+"px")});var e=document.getElementById("monacoEditorInner");pxt.BrowserUtils.hasPointerEvents()?(e.onpointermove=this.onPointerMove,e.onpointerup=this.onPointerUp):(e.onmousemove=this.onPointerMove,e.onmouseup=this.onPointerUp,pxt.BrowserUtils.isTouchEnabled()&&(e.ontouchend=this.onPointerUp)),this.editor.onDidFocusEditorText(()=>{this.hideFlyout()}),monaco.languages.registerCompletionItemProvider("python",new E(this,!0)),monaco.languages.registerSignatureHelpProvider("python",new C(this,!0)),monaco.languages.registerHoverProvider("python",new _(this,!0)),monaco.languages.registerDocumentRangeFormattingEditProvider("python",new A(this,!0)),monaco.languages.setLanguageConfiguration("python",T),this.editorViewZones=[],this.setupFieldEditors(),this.editor.onMouseDown(e=>{e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&this.handleGutterClick(e)}),t.onDidChangeModelContent(e=>{this.fieldEditors&&this.fieldEditors.clearRanges(t)})})}undo(){this.editor&&this.editor.trigger("keyboard","undo",null)}redo(){this.editor&&this.editor.trigger("keyboard","redo",null)}zoomIn(){var e;!this.editor||40<=this.parent.settings.editorFontSize||(e=this.getEditorFontSize(),this.parent.settings.editorFontSize=e+1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate())}zoomOut(){var e;!this.editor||this.parent.settings.editorFontSize<=10||(e=this.getEditorFontSize(),this.parent.settings.editorFontSize=e-1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate())}loadReference(){g.assert(null!=this.editor);var e=this.editor.getModel(),t=e.getOffsetAt(this.editor.getPosition()),e=e.getValue(),i=this.currFile.name;d.syntaxInfoAsync("symbol",i,t,e).then(e=>{if(null!=e&&e.symbols)for(const t of e.symbols)if(t.attributes.help)return void this.parent.setSideDoc("/reference/"+t.attributes.help.replace(/^\//,""));l.warningNotification(g.lf("Help resource not found"))})}setupFieldEditors(){this.hasFieldEditors&&!pxt.shell.isReadOnly()&&(this.fieldEditors||(this.fieldEditors=new f.FieldEditorManager(this.editor),monaco.languages.registerFoldingRangeProvider("typescript",this.fieldEditors),monaco.languages.registerFoldingRangeProvider("python",this.fieldEditors)),this.editor.onDidChangeCursorPosition(e=>{this.fieldEditors&&this.fieldEditors.setCursorLine(e.position.lineNumber)}),pxt.appTarget.appTheme.monacoFieldEditors.forEach(e=>{var t=pxt.editor.getMonacoFieldEditor(e);t?this.fieldEditors.addFieldEditor(t):pxt.debug("Skipping unknown monaco field editor '"+e+"'")}))}closeFlyout(){this.editor&&this.hideFlyout()}hideFlyout(){this.flyout&&this.flyout.setState({groups:void 0}),this.toolbox&&this.toolbox.clearSelection(),this.parent.setState({hideEditorFloats:!1})}updateToolbox(){pxt.appTarget.appTheme.monacoToolbox&&!pxt.shell.isReadOnly()&&this.editor&&(this.editor.layout(),this.toolbox&&(this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}),this.shouldShowToolbox()?this.toolbox.show():this.toolbox.hide()),this.updateDebuggerToolbox())}updateDebuggerToolbox(){var e,t=document.getElementById("monacoDebuggerToolbox");t&&this.blockInfo&&((e=this.isDebugging())&&this.flyout&&this.flyout.setState({groups:void 0}),e=e?r.createElement(v.DebuggerToolbox,{ref:this.handleDebugToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName,openLocation:this.revealBreakpointLocation,showCallStack:!0}):null,n.render(e,t))}getId(){return"monacoEditor"}getViewState(){return this.editor?this.editor.getPosition():{}}getCurrentSource(){return this.editor?this.editor.getValue():this.currSource}acceptsFile(e){return!0}setValue(e){this.editor.setValue(e)}overrideFile(e){g.assert(null!=this.editor),this.editor.setValue(e)}shouldShowToolbox(){var e=!this.currFile||this.currFile.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();return pxt.appTarget.appTheme.monacoToolbox&&!e&&("typescript"==this.fileType||"python"==this.fileType)}loadFileAsync(i,r){let o="text";if(this.currSource=i.content,pxt.BrowserUtils.isWinRT())return this.currFile=i,Promise.resolve();let e=document.createElement("div"),t=(e.className="ui inverted loading dimmer active",document.getElementById("monacoEditorRightArea")),n=document.getElementById("monacoEditorInner");return t.insertBefore(e,n),this.pythonSourceMap=null,this.loadMonacoAsync().then(()=>{if(!this.editor)return Promise.resolve();this.foldFieldEditorRanges=!0,this.updateFieldEditors();var e=i.getExtension(),e=(N.hasOwnProperty(e)&&(o=N[e]),this.fileType=o,i.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging());this.editor.updateOptions({readOnly:e});let t="pkg:"+i.getName(),n=monaco.editor.getModels().filter(e=>e.uri.toString()==t)[0];if((n=n||monaco.editor.createModel(c.mainPkg.readFile(i.getName()),o,monaco.Uri.parse(t)))&&this.editor.setModel(n),this.defineEditorTheme(r),this.currFile=i,this.shouldShowToolbox()?this.beginLoadToolbox(i,r):this.toolbox&&this.toolbox.hide(),this.setValue(i.content),this.setDiagnostics(i,this.snapshotState()),this.breakpoints){this.breakpoints.loadBreakpointsForFile(i,this.editor);const r=this.breakpoints.getLocationOfBreakpoint(this.highlightedBreakpoint);r&&r.fileName===i.getTextFileName()&&this.highilightStatementCore(r,!0)}return"markdown"==this.fileType&&this.parent.setSideMarkdown(i.content),this.currFile.setForceChangeCallback((e,t)=>{e!=t&&(pxt.debug(`File changed (from ${e}, to ${t}). Reloading editor`),this.loadFileAsync(this.currFile))}),i.isReadonly()||n.onDidChangeContent(e=>{this.clearHighlightedStatements();let i=this.editorViewZones||[];this.editor.changeViewZones(function(t){i.forEach(e=>{t.removeZone(e)})}),this.editorViewZones=[];const t=/[\u{201c}\u{201d}\u{2018}\u{2019}]/u;if(e.changes.some(e=>t.test(e.text))){const i=e.changes.filter(e=>t.test(e.text)).map(e=>{var t=n.getPositionAt(e.rangeOffset),i=n.getPositionAt(e.rangeOffset+e.text.length);return{range:new monaco.Range(t.lineNumber,t.column,i.lineNumber,i.column),text:e.text.replace(/\u{201c}|\u{201d}/gu,'"').replace(/\u{2018}|\u{2019}/gu,"'")}});this.editor.executeEdits("pxt",i)}this.updateDiagnostics(),this.changeCallback(),this.updateFieldEditors()}),this.resize(),this.hideFlyout(),this.extensions=c.allEditorPkgs().map(e=>e.getKsPkg()).filter(e=>!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion)),this.giveFocusOnLoading&&this.editor.focus(),"python"===this.fileType&&(this.editAmendmentsListener=y.listenForEditAmendments(this.editor)),this.foldFieldEditorRangesAsync()}).finally(()=>{t.removeChild(e),this.parent.isTutorial()&&this.parent.onTutorialLoaded()})}unloadFileAsync(){return this.toolbox&&this.toolbox.clearSearch(),this.currFile&&this.currFile.getName()=="this/"+pxt.CONFIG_NAME?this.parent.reloadHeaderAsync():(this.editAmendmentsListener&&(this.editAmendmentsListener.dispose(),this.editAmendmentsListener=void 0),Promise.resolve())}beginLoadToolbox(t,i){this.toolbox&&this.toolbox.showLoading(),d.getBlocksAsync().then(e=>{this.blockInfo=e,this.nsMap=this.partitionBlocks(),this.updateToolbox(),pxt.vs.syncModels(c.mainPkg,this.extraLibs,t.getName(),t.isReadonly()),this.defineEditorTheme(i,!0)}),this.blockIdMap=s.blockIdMap()}snapshotState(){return this.editor&&this.editor.getModel()?this.editor.getModel().getLinesContent():null}setViewState(e){this.editor&&e&&0!==Object.keys(e).length&&(this.editor.setPosition(e),this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(e.lineNumber)}))}setBreakpointsMap(e,t){this.callLocations=t,this.isDebugging()?(this.breakpoints||(this.breakpoints=new b.BreakpointCollection(e,this.pythonSourceMap),this.breakpoints.loadBreakpointsForFile(this.currFile,this.editor)),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),this.feWidget&&this.feWidget.close(),this.editor&&this.editor.updateOptions({readOnly:!0})):(this.editor&&this.editor.updateOptions({readOnly:pxt.shell.isReadOnly()||this.currFile&&this.currFile.isReadonly()}),this.breakpoints&&(this.breakpoints.dispose(),this.breakpoints=void 0),this.updateFieldEditors())}setDiagnostics(e,t){this.editor&&this.currFile===e&&(this.diagSnapshot=t,this.forceDiagnosticsUpdate())}updateDiagnostics(){this.needsDiagUpdate()&&this.forceDiagnosticsUpdate()}getBreakpoints(){return this.breakpoints?this.breakpoints.getActiveBreakpoints():[]}getEditorFontSize(){return this.editor.getOptions().get(monaco.editor.EditorOption.fontInfo).fontSize}sendBreakpoints(){this.breakpoints&&u.driver.setBreakpoints(this.getBreakpoints())}needsDiagUpdate(){if(this.annotationLines){var e,t=this.editor.getModel().getLinesContent();for(e of this.annotationLines)if(this.diagSnapshot[e]!==t[e])return!0}return!1}forceDiagnosticsUpdate(){if("typescript"==this.fileType||"python"==this.fileType){let e=this.currFile,n=[];if(e&&e.diagnostics){var r=monaco.editor.getModel(monaco.Uri.parse("pkg:"+e.getName()));for(let i of e.diagnostics){const t=e=>{n.push({severity:monaco.MarkerSeverity.Error,message:e,startLineNumber:i.line+1,startColumn:i.column+1,endLineNumber:null==i.endLine?o.lineNumber:i.endLine+1,endColumn:null==i.endColumn?o.column:i.endColumn})},o=r.getPositionAt(i.start+i.length);if("string"==typeof i.messageText)t(i.messageText);else{let e=i.messageText;for(;null!=e.next;)t(e.messageText),e=e.next}}monaco.editor.setModelMarkers(r,"typescript",n),this.onErrorChanges(e.diagnostics)}}}showFieldEditor(e,t,i,n){this.feWidget&&this.feWidget.close(),this.feWidget=new f.ModalEditorHost(t,e,this.editor.getModel());const r=()=>{n&&(u.setDirty(),"typescript"==this.fileType)&&c.mainEditorPkg().invalidateCachedTranspile("ts",this.getCurrentSource(),"blocks")};this.feWidget.showAsync(this.fileType,this.editor).then(e=>{this.activeRangeID=null,e?this.editModelAsync(e.range,e.replacement).then(e=>this.indentRangeAsync(e)).then(()=>this.foldFieldEditorRangesAsync()).then(r):r()})}updateFieldEditors(){this.fieldEditors&&this.fieldEditors.setFieldEditorsEnabled(this.hasFieldEditors&&this.editor&&!pxt.shell.isReadOnly()&&!this.isDebugging())}foldFieldEditorRangesAsync(){return this.foldFieldEditorRanges?this.editor.getAction("editor.foldAllBlockComments").run():Promise.resolve()}highlightStatement(e,t){var i;if(!e)return this.clearHighlightedStatements(),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null),!1;if(!this.editor)return!1;if(t&&null!=(i=this.breakpoints)&&i.getLoadedBreakpoint(t.breakpointId)?e=this.breakpoints.getLoadedBreakpoint(t.breakpointId):"py"===this.currFile.getExtension()&&this.pythonSourceMap&&(e=this.pythonSourceMap.ts.locToLoc(e)),this.currFile.getTextFileName()!==e.fileName&&this.isDebugging()&&L(e.fileName))this.parent.setFile(L(e.fileName));else if(!this.highilightStatementCore(e,!!t))return!1;return this.highlightedBreakpoint=t?t.breakpointId:void 0,t&&this.isDebugging()&&this.debuggerToolbox&&(this.debuggerToolbox.setBreakpoint(t),this.resize()),!0}highilightStatementCore(e,t=!1){var i=this.editor.getModel().getPositionAt(e.start),e=this.editor.getModel().getPositionAt(e.start+e.length);return!(!i||!e||(this.highlightDecorations=this.editor.deltaDecorations(this.highlightDecorations,[{range:new monaco.Range(i.lineNumber,i.column,e.lineNumber,e.column),options:{inlineClassName:"highlight-statement"}}]),t&&this.editor.revealPositionInCenter(i),0))}clearHighlightedStatements(){this.editor&&this.highlightDecorations&&this.editor.deltaDecorations(this.highlightDecorations,[])}partitionBlocks(){const n={},r=(this.topBlocks=[],s.allBuiltinBlocksByName()),i=this;function o(e,t){i.subcategoryMap[e]||(i.subcategoryMap[e]={}),i.subcategoryMap[e][t]=!0}if(this.blockInfo.blocks.forEach(e=>{var t,i=(e.attributes.blockNamespace||e.namespace).split(".")[0];r[e.qName]||"TD_ID"==e.attributes.shim||(n[i]||(n[i]=[]),n[i].push(e),t=e.attributes.subcategory,e.attributes.advanced?o(i,lf("more")):t&&o(i,t),e.attributes.topblock&&this.topBlocks.push(e))}),s.getPauseUntil()){const r=pxt.appTarget.runtime.pauseUntilBlock.category;n[r]&&n[r].push(s.getPauseUntil())}return n}clearCaches(){super.clearCaches(),s.clearBuiltinBlockCache()}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}getBuiltinCategory(e){return s.getBuiltinCategory(e)}isBuiltIn(e){return s.isBuiltin(e)}getNamespaceAttrs(e){var t=s.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){var e=Object.keys(this.nsMap).filter(e=>!s.isBuiltin(e)&&!!this.getNamespaceAttrs(e));function t(e){return s.getBuiltinCategory(e).removed}var i=pxt.appTarget.runtime||{};return i.loopsBlocks&&!t("loops")&&e.push("loops"),i.logicBlocks&&!t("logic")&&e.push("logic"),i.variablesBlocks&&!t("variables")&&e.push("variables"),i.mathBlocks&&!t("Math")&&e.push("Math"),i.functionBlocks&&!t("functions")&&e.push("functions"),i.listsBlocks&&!t("arrays")&&e.push("arrays"),i.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}moveFocusToFlyout(){var e;this.flyout&&(e=document.querySelector(".monacoBlock"))&&(e.focus(),e.click())}getBlocksForCategory(e,t){return s.isBuiltin(e)?this.getBuiltinBlocks(e,t):this.filterBlocks(t,this.nsMap[e])}filterBlocks(t,e){return e.filter(e=>!e.attributes.blockHidden&&!(e.attributes.deprecated&&!this.parent.isTutorial())&&0!=e.name.indexOf("_")&&(!t&&!e.attributes.subcategory&&!e.attributes.advanced||t&&(e.attributes.advanced&&t==lf("more")||e.attributes.subcategory&&t==e.attributes.subcategory)))}getBuiltinBlocks(e,t){let i=s.getBuiltinCategory(e),n=i.blocks||[];return!i.custom&&this.nsMap[e]&&(n=n.concat(this.nsMap[e].filter(e=>!(e.attributes.blockHidden||e.attributes.deprecated&&!this.parent.isTutorial())))),this.filterBlocks(t,n)}showFlyout(s){if(this.editor){let{nameid:e,name:t,subns:i,color:n,icon:r,blocks:o}=s,a=[];if(this.flyout){if("search"==e)try{0==(o=this.getSearchBlocks()).length&&(t=lf("No search results...")),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:o})}catch(s){pxt.reportException(s),o=[],t=lf("No search results...")}else"topblocks"==e?0==(o=this.getTopBlocks()).length?t=lf("No basic results..."):(n=pxt.toolbox.getNamespaceColor("topblocks"),r=pxt.toolbox.getNamespaceIcon("topblocks"),t=lf("{id:category}Basic"),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:o})):a=this.getBlockGroups(s);this.flyout.setState({name:t||g.capitalize(i||e),selectedBlock:void 0,hide:!1,ns:e,color:n,icon:r,groups:a})}}}showFlyoutHeadingLabel(e,t,i,n,r){}showFlyoutGroupLabel(e,t,i,n){}showFlyoutBlocks(e,t,i){}handleGutterClick(e){const t=e.target.position.lineNumber;if(this.isDebugging())this.breakpoints&&(this.breakpoints.toggleBreakpointAt(t),this.sendBreakpoints());else if(this.fieldEditors){const e=this.editor.getModel();if(e.getDecorationsInRange(new monaco.Range(t,e.getLineMinColumn(t),t,e.getLineMaxColumn(t))).length){const e=this.fieldEditors.getInfoForLine(t);if(e)if(this.feWidget&&null!=this.activeRangeID&&e.id===this.activeRangeID)this.feWidget.close(),this.activeRangeID=null;else{this.activeRangeID=e.id;const t=this.fieldEditors.getFieldEditorById(e.owner);t&&this.showFieldEditor(e.range,new t.proto,t.heightInPixels||500,t.alwaysBuildOnClose)}}}}getSearchBlocks(){let i=[];const e=this.toolbox.getSearchBlocks(),n=this;function r(e){var t=n.blockInfo.apis.byQName[e];return(t?t.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(e)||"255"}return e.forEach(e=>{if(e.name){var t=this.blockInfo.apis.byQName[e.name];if(t){if(0!=t.name.indexOf("_")){const e=(t.attributes.blockNamespace||t.namespace).split(".")[0];t.attributes.color=t.attributes.color||r(e),i.push(t)}}else pxt.log("couldn't find non builtin search by qName: "+e.name)}else if(e.attributes.blockId==pxtc.PAUSE_UNTIL_TYPE){const e=s.getPauseUntil();e&&(t=e.attributes.blockNamespace,e.attributes.color=r(t),i.push(e))}else{t=s.allBuiltinBlocks()[e.attributes.blockId];t?(t[0].attributes.blockNamespace=t[1],i.push(t[0])):pxt.log("couldn't find buildin search qName for block: "+e.attributes.blockId)}}),i}indentRangeAsync(e){const t=this.editor.getModel(),i=t.getLineFirstNonWhitespaceColumn(e.startLineNumber)-1,n=D(t.getOptions().indentSize+i),r=t.getValueInRange(e).split(/\n/),o=r.map((e,t)=>0===t?e.trim():t===r.length-1?D(i)+e.trim():n+e.trim()).join(t.getEOL());return this.editModelAsync(e,o)}editModelAsync(o,a){return new Promise(t=>{const e=this.editor.getModel(),i=a.split("\n"),n=new monaco.Range(o.startLineNumber,o.startColumn,o.startLineNumber+i.length-1,i[i.length-1].length);let r=this.editor.onDidChangeModelContent(e=>{r&&(r.dispose(),r=void 0),this.editor.setSelection(n),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),t(n)});e.pushEditOperations(this.editor.getSelections(),[{range:e.validateRange(o),text:a,forceMoveMarkers:!0}],e=>[O(e[0].range)])})}isDebugging(){return this.parent.state.debugging}getEditorColor(){return pxt.appTarget.appTheme.monacoColors&&pxt.appTarget.appTheme.monacoColors["editor.background"]?pxt.appTarget.appTheme.monacoColors["editor.background"]:pxt.appTarget.appTheme.invertedMonaco?"#1e1e1e":"#ffffff"}}function O(e){return new monaco.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}i.Editor=I,i.rangeToSelection=O;class P{constructor(e){this.touchHandler=()=>{this.editor.focus()},this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._domNode.addEventListener("touchstart",this.touchHandler),this._domNode.addEventListener("focus",this.touchHandler),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),this._domNode.removeEventListener("touchstart",this.touchHandler),this._domNode.removeEventListener("focus",this.touchHandler)}getId(){return P.ID}getDomNode(){return this._domNode}getPosition(){return{preference:monaco.editor.OverlayWidgetPositionPreference.TOP_RIGHT_CORNER}}}function D(t){let i="";for(let e=0;e<t;e++)i+=" ";return i}function L(e){var t=c.mainEditorPkg();return t.files[e]||t.lookupFile(e)||void 0}P.ID="editor.contrib.ShowKeyboardWidget_pxt"},{"./auth":8,"./blocklyFieldView":9,"./compiler":18,"./core":64,"./data":67,"./debuggerToolbox":72,"./errorList":78,"./monacoDebugger":101,"./monacoEditAmendments":102,"./monacoFieldEditorHost":103,"./monacoFlyout":104,"./monacoSnippets":105,"./monacopyhelper":106,"./package":108,"./simulator":121,"./toolbox":130,"./toolboxeditor":131,react:320,"react-dom":276}],101:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BreakpointCollection=i.MonacoBreakpoint=void 0;class o{constructor(e,t){this.source=e,this.editor=t,this.active=!1;var e=this.editor.getModel(),t=e.getPositionAt(this.source.start),i=e.getPositionAt(this.source.start+this.source.length);i.lineNumber===t.lineNumber?this.range=new monaco.Range(t.lineNumber,t.column,i.lineNumber,i.column):this.range=new monaco.Range(t.lineNumber,t.column,t.lineNumber,e.getLineMaxColumn(t.lineNumber)),this.updateDecoration()}simulatorID(){return this.source.id}isActive(){return this.active}setActive(e){this.active!==e&&(this.active=e,this.updateDecoration())}toggle(){this.setActive(!this.active)}distanceFromLine(e){return Math.abs(this.range.startLineNumber-e)}dispose(){this.decoration&&(this.editor.deltaDecorations([this.decoration],[]),this.decoration=void 0)}updateDecoration(){var e=this.active?"monaco-breakpoint active":"monaco-breakpoint",t=this.active?pxt.U.lf("Remove breakpoint"):pxt.U.lf("Add breakpoint"),e=this.editor.deltaDecorations(this.decoration?[this.decoration]:[],[{range:this.range,options:{glyphMarginClassName:e,glyphMarginHoverMessage:{value:t}}}]);this.decoration=e[0]}}i.MonacoBreakpoint=o,i.BreakpointCollection=class{constructor(e,t){this.fileToBreakpoint={},this.activeBreakpoints=[],this.sourcemap=t;for(const t of e)this.fileToBreakpoint[t.fileName]||(this.fileToBreakpoint[t.fileName]=[]),this.fileToBreakpoint[t.fileName].push(t)}loadBreakpointsForFile(i,n){if(this.loadedBreakpoints&&this.loadedBreakpoints.forEach(e=>e.dispose()),i){var r="py"===i.getExtension();let e=i.getTextFileName(),t=(r&&(e=i.getFileNameWithExtension("ts")),this.fileToBreakpoint[e]);if(r){if(!this.sourcemap)return;t=null==t?void 0:t.map(e=>{var t=this.sourcemap.ts.locToLoc(e);return Object.assign(Object.assign({},e),t)})}t&&(this.loadedBreakpoints=t.map(e=>{var t=new o(e,n);return-1!=this.activeBreakpoints.indexOf(e.id)&&t.setActive(!0),t}))}}toggleBreakpointAt(e){const t=this.getBreakpointForLine(e);t&&(t.toggle(),t.isActive()?this.activeBreakpoints.push(t.source.id):this.activeBreakpoints=this.activeBreakpoints.filter(e=>e!=t.source.id))}refreshDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach(e=>e.updateDecoration())}clearDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach(e=>e.dispose())}getActiveBreakpoints(){return this.activeBreakpoints}dispose(){this.loadedBreakpoints&&(this.loadedBreakpoints.forEach(e=>e.dispose()),this.loadedBreakpoints=void 0),this.activeBreakpoints=void 0,this.fileToBreakpoint=void 0}getLocationOfBreakpoint(e){const t=this.getLoadedBreakpoint(e);if(t)return t;for(const t of Object.keys(this.fileToBreakpoint)){var i=this.fileToBreakpoint[t];for(const t of i)if(t.id===e)return t}}getLoadedBreakpoint(e){if(this.loadedBreakpoints)for(const t of this.loadedBreakpoints)if(t.source.id===e)return t.source;return null}getBreakpointForLine(i){if(this.loadedBreakpoints&&this.loadedBreakpoints.length){let e,t;for(const r of this.loadedBreakpoints){var n=r.distanceFromLine(i);(void 0===t||n<t)&&(e=r,t=n)}return t<5?e:void 0}}}},{}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.listenForEditAmendments=i.amendmentToInsertSnippet=i.createLineReplacementPyAmendment=void 0;const s=e("./monaco"),l=e("./monacopyhelper"),n="#AMENDMENT:";i.createLineReplacementPyAmendment=function(e,t="pass"){return{behavior:"replaceLine",insertText:e||"",selectText:t}},i.amendmentToInsertSnippet=function(e){return"#AMENDMENT:"+JSON.stringify(e)},i.listenForEditAmendments=function(t){return t.onDidChangeModelContent(i=>{var e=function(){if(1!=i.changes.length)return null;var e=i.changes[0];if(!(0<=e.text.indexOf(n)))return null;var t=e.text.split(n);if(2!=t.length)return null;t[0];t=t[1],t=pxt.U.jsonTryParse(t);return t?Object.assign({range:e.range},t):null}();if(e){var r=e,o=t;const a=o.getModel();setTimeout(()=>{let i=r.range;"replaceLine"===r.behavior?i=Object.assign(Object.assign({},i),{endColumn:99999,startColumn:1}):r.behavior;var e=l.fixIndentationInRange(a,a.validateRange(i),r.insertText)[0];r.range=e.range,r.insertText=e.text;let n=null;r.selectText&&2<=(e=r.insertText.split(r.selectText)).length&&(t=(e=e[0].split("\n"))[e.length-1],e=i.startLineNumber+e.length-1,t=t.length+1,n=new monaco.Range(e,t,e,t+r.selectText.length));var e=Object.assign(Object.assign({},r.range),{endColumn:99999}),t=[{range:a.validateRange(e),text:"",forceMoveMarkers:!1}];a.applyEdits(t),setTimeout(()=>{const t=o.onDidChangeModelContent(e=>{t.dispose(),n&&o.setSelection(n)});var e=[{range:a.validateRange(i),text:r.insertText,forceMoveMarkers:!0}];a.pushEditOperations(o.getSelections(),e,e=>[s.rangeToSelection(e[0].range)])},0)},0)}})}},{"./monaco":100,"./monacopyhelper":106}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.computeRanges=i.RangesCollector=i.FieldEditorManager=i.ModalEditorHost=i.ViewZoneEditorHost=void 0;const n=e("./compiler"),r=e("./package");i.ViewZoneEditorHost=class{constructor(e,t,i){this.fe=e,this.range=t,this.model=i,this.heightInPx=520,this.suppressMouseDown=!1,this.afterLineNumber=t.endLineNumber;e=document.createElement("div"),e.setAttribute("class","pxt-view-zone"),i=document.createElement("div");i.setAttribute("class","monaco-field-editor-frame"),e.appendChild(i),this.domNode=e,this.wrapper=i}getId(){return"pxt-monaco-field-editor"}contentDiv(){return this.content||(this.content=document.createElement("div"),this.wrapper.appendChild(this.content)),this.content}showAsync(e,t){return this.fileType=e,this.editor=t,n.getBlocksAsync().then(e=>(this.blocks=e,this.showViewZoneAsync())).then(()=>(this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(this.afterLineNumber)}),this.fe.showEditorAsync(this.fileType,this.range,this))).finally(()=>{this.close()})}onComputedHeight(e){this.contentDiv().style.height=e+"px"}onDomNodeTop(e){this._deferredShow&&(this._deferredShow(),this._deferredShow=void 0)}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showViewZoneAsync(){return this._deferredShow?Promise.resolve():new Promise(e=>{this._deferredShow=e,this.editor.changeViewZones(e=>{this.id=e.addZone(this)})})}resizeViewZoneAsync(){return this.id?new Promise(e=>{this.editor.changeViewZones(e=>{e.layoutZone(this.id)})}):Promise.resolve()}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}close(){this.fe.onClosed(),this.fe.dispose(),this.editor.changeViewZones(e=>{e.removeZone(this.id)})}},i.ModalEditorHost=class{constructor(e,t,i){this.fe=e,this.range=t,this.model=i}contentDiv(){return null}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showAsync(t,e){return n.getBlocksAsync().then(e=>(this.blocks=e,this.fe.showEditorAsync(t,this.range,this)))}close(){this.fe.onClosed(),this.fe.dispose()}},i.FieldEditorManager=class{constructor(e){this.editor=e,this.fieldEditors=[],this.decorations={},this.liveRanges=[],this.fieldEditorsEnabled=!0,this.rangeID=0}setFieldEditorsEnabled(e){(this.fieldEditorsEnabled=e)||this.clearRanges(this.editor)}setCursorLine(e){var t;this.fieldEditorsEnabled&&e!=this.currentCursorLine&&((t=this.getInfoForLine(this.currentCursorLine))&&this.reapplyDecorations(t.owner),(t=this.getInfoForLine(e))&&this.reapplyDecorations(t.owner,e),this.currentCursorLine=e)}addFieldEditor(e){for(const t of this.fieldEditors)if(t.id===e.id)return;this.fieldEditors.push(e)}getDecorations(e){return this.decorations[e]||[]}allDecorations(){const t=[];return Object.keys(this.decorations).forEach(e=>t.push(...this.getDecorations(e))),t}setDecorations(e,t){this.decorations[e]=t}clearRanges(t){t&&Object.keys(this.decorations).forEach(e=>{t.deltaDecorations(this.decorations[e],[])}),this.decorations={},this.liveRanges=[],this.rangeID=0}trackRange(e,t,i){return!this.getInfoForLine(t)&&(this.liveRanges.push({line:t,owner:e,range:i,id:this.rangeID++}),!0)}getFieldEditorById(e){for(const t of this.fieldEditors)if(t.id===e)return t}getInfoForLine(e){for(const t of this.liveRanges)if(t.line===e)return t}allRanges(){return this.liveRanges}allFieldEditors(){return this.fieldEditors}provideFoldingRanges(e,t,i){this.updateFieldEditorRanges(e);var n=this.liveRanges.map(e=>({start:e.range.startLineNumber,end:e.range.endLineNumber-1,kind:monaco.languages.FoldingRangeKind.Comment}));let r=o(e,!1);return n.forEach(t=>{r=r.filter(e=>e.start!=t.start)}),n.concat(r)}reapplyDecorations(t,i=-1){var n=this.fieldEditors.find(e=>e.id===t);if(n){var e=this.decorations[t],r=this.liveRanges.filter(e=>e.owner===t),o=this.editor.getModel(),a=[];for(const t of r){let e=n.glyphCssClass;t.line===i&&(e+=" pxt-monaco-glyph-highlight"),a.push({range:new monaco.Range(t.line,o.getLineMinColumn(t.line),t.line,o.getLineMaxColumn(t.line)),options:{glyphMarginClassName:e}})}this.setDecorations(n.id,this.editor.deltaDecorations(e,a))}}updateFieldEditorRanges(r){this.clearRanges(this.editor),this.fieldEditorsEnabled&&this.allFieldEditors().sort((e,t)=>(t.weight||0)-(e.weight||0)).forEach(i=>{const e=i.matcher,t=r.findMatches(e.searchString,!0,e.isRegex,e.matchCase,e.matchWholeWord?this.editor.getOptions().get(monaco.editor.EditorOption.wordSeparators):null,!1),n=[];t.forEach(e=>{var t=e.range.startLineNumber;this.getInfoForLine(t)||(n.push({range:new monaco.Range(t,r.getLineMinColumn(t),t,r.getLineMaxColumn(t)),options:{glyphMarginClassName:i.glyphCssClass}}),this.trackRange(i.id,t,e.range))}),this.setDecorations(i.id,this.editor.deltaDecorations([],n))})}};class p{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,i){var n=this._length;this._startIndexes[n]=e,this._endIndexes[n]=t,this._length++,i<1e3&&(this._indentOccurrences[i]=(this._indentOccurrences[i]||0)+1)}toIndentRanges(r){if(this._length<=this._foldingRangesLimit){var i=new Uint32Array(this._length),n=new Uint32Array(this._length);for(let e=this._length-1,t=0;0<=e;e--,t++)i[t]=this._startIndexes[e],n[t]=this._endIndexes[e];return d(i,n)}{let i=0,n=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){var t=this._indentOccurrences[e];if(t){if(t+i>this._foldingRangesLimit){n=e;break}i+=t}}var o=r.getOptions().tabSize,a=new Uint32Array(this._foldingRangesLimit),s=new Uint32Array(this._foldingRangesLimit);for(let e=this._length-1,t=0;0<=e;e--){var l=this._startIndexes[e],c=h(r.getLineContent(l),o);(c<n||c===n&&i++<this._foldingRangesLimit)&&(a[t]=l,s[t]=this._endIndexes[e],t++)}return d(a,s)}}}function d(t,i){var n=[];for(let e=0;e<t.length;e++)n.push({start:t[e],end:i[e],kind:monaco.languages.FoldingRangeKind.Region});return n}function o(o,a,e,t=5e3){var s=o.getOptions().tabSize;let l,c=new p(t);e&&(l=new RegExp(`(${e.start.source})|(?:${e.end.source})`));var d=[],t=o.getLineCount()+1;d.push({indent:-1,endAbove:t,line:t});for(let r=o.getLineCount();0<r;r--){let e,t=o.getLineContent(r),i=h(t,s),n=d[d.length-1];if(-1!==i){if(l&&(e=t.match(l))){if(!e[1]){d.push({indent:-2,endAbove:r,line:r});continue}{let e=d.length-1;for(;0<e&&-2!==d[e].indent;)e--;if(0<e){d.length=e+1,n=d[e],c.insertFirst(r,n.line,i),n.line=r,n.indent=i,n.endAbove=r;continue}}}if(n.indent>i){for(;d.pop(),(n=d[d.length-1]).indent>i;);var u=n.endAbove-1;1<=u-r&&c.insertFirst(r,u,i)}n.indent===i?n.endAbove=r:d.push({indent:i,endAbove:r,line:r})}else a&&(n.endAbove=r)}return c.toIndentRanges(o)}function h(e,t){let i=0,n=0,r=e.length;for(;n<r;){var o=e.charCodeAt(n);if(32===o)i++;else{if(9!==o)break;i=i-i%t+t}n++}return n===r?-1:i}i.RangesCollector=p,i.computeRanges=o},{"./compiler":18,"./package":108}],104:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MonacoFlyout=void 0;const k=e("react"),s=e("./compiler"),l=e("./core"),c=e("./workspace"),n=e("./data"),r=e("./auth");class o extends n.Component{constructor(e){super(e),this.dragging=!1,this.getBlockClickHandler=e=>()=>{pxt.tickEvent("monaco.toolbox.itemclick",void 0,{interactiveConsent:!0}),this.setState({selectedBlock:e!=this.state.selectedBlock?e:void 0})},this.getBlockMouseOver=e=>()=>{pxt.tickEvent("monaco.toolbox.itemmouseover"),this.setState({hoverBlock:e!=this.state.hoverBlock?e:void 0})},this.getBlockMouseOut=e=>()=>{e==this.state.hoverBlock&&this.setState({hoverBlock:void 0})},this.getBlockDragStartHandler=(t,i,n)=>e=>{this.dragInfo={x:pxt.BrowserUtils.getClientX(e),y:pxt.BrowserUtils.getClientY(e),block:t,snippet:i,color:n}},this.isHorizontalDrag=e=>{var t=Math.abs(this.dragInfo.x-pxt.BrowserUtils.getClientX(e)),e=Math.abs(this.dragInfo.y-pxt.BrowserUtils.getClientY(e));return 5<t&&5<e&&e<t},this.blockDragHandler=t=>{let i=document.getElementById("monacoDraggingBlock");if(this.dragInfo&&(i||this.isHorizontalDrag(t))){pxt.tickEvent("monaco.toolbox.itemdrag",void 0,{interactiveConsent:!0}),t.preventDefault(),t.stopPropagation();var n=this.dragInfo.block,r=n.parameters;if(this.dragging=!0,!i){const t=document.getElementById("root");t.style.overflow="hidden",(i=document.createElement("div")).id="monacoDraggingBlock",i.textContent=n.snippetOnly?n.snippet:""+(this.getQName(n)||this.getSnippetName(n))+(r?`(${r.map(e=>e.name).join(", ")})`:""),i.style.backgroundColor=this.dragInfo.color,t.appendChild(i),c.fireEvent({type:"create",editor:"ts",blockId:n.attributes.blockId});let e="";"void"!=n.retType&&(e="inline:1&"),this.props.setInsertionSnippet(this.dragInfo.snippet||e+"qName:"+n.qName)}i.style.top=pxt.BrowserUtils.getClientY(t)+"px",i.style.left=pxt.BrowserUtils.getClientX(t)+"px",this.setState({hide:!0})}},this.blockDragEndHandler=e=>{this.dragInfo=void 0,this.dragging=!1,this.props.setInsertionSnippet(void 0);var t=document.getElementById("monacoDraggingBlock");t&&t.remove(),document.getElementById("root").style.overflow=""},this.getKeyDownHandler=(r,o,a)=>e=>{var t,i=pxt.Util.isUserLanguageRtl(),n=l.keyCodeFromEvent(e),e=e.target;40==n?(t=e.nextElementSibling,e&&t&&(t.click(),t.focus())):38==n?(t=e.previousElementSibling,e&&t&&(t.click(),t.focus())):37==n&&!i||38==n&&i?this.props.moveFocusToParent():27==n?(this.setState({groups:void 0}),this.props.moveFocusToParent()):13==n&&r&&(o?Promise.resolve(o):s.snippetAsync(r.qName,a)).then(e=>{this.props.insertSnippet(null,e,"void"!=r.retType),c.fireEvent({type:"create",editor:"ts",blockId:r.attributes.blockId})})},this.getHelpButtonClickHandler=e=>()=>{pxt.debug(e+" help icon clicked."),c.fireEvent({type:"ui",editor:"ts",action:"groupHelpClicked",data:{group:e}})},this.wheelHandler=e=>{e.stopPropagation()},this.scrollHandler=e=>{this.positionDragHandle()},this.getFlyoutStyle=()=>{var e;return{display:null==(e=this.state)||!e.groups||null!=(e=this.state)&&e.hide?"none":"block"}},this.getIconStyle=e=>({color:e}),this.getSelectedStyle=()=>({touchAction:pxt.BrowserUtils.hasPointerEvents()?"pan-y":void 0}),this.getBlockStyle=e=>({backgroundColor:e,border:this.getData(r.HIGHCONTRAST)?"2px solid "+e:"none",fontSize:this.props.parent.settings.editorFontSize+"px",lineHeight:this.props.parent.settings.editorFontSize+16+"px"}),this.state={}}componentDidMount(){pxt.BrowserUtils.hasPointerEvents()?(document.addEventListener("pointermove",this.blockDragHandler),document.addEventListener("pointerup",this.blockDragEndHandler)):(document.addEventListener("mousemove",this.blockDragHandler),document.addEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.addEventListener("touchmove",this.blockDragHandler),document.addEventListener("touchend",this.blockDragEndHandler)))}componentWillUnmount(){pxt.BrowserUtils.hasPointerEvents()?(document.removeEventListener("pointermove",this.blockDragHandler),document.removeEventListener("pointerup",this.blockDragEndHandler)):(document.removeEventListener("mousemove",this.blockDragHandler),document.removeEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.removeEventListener("touchmove",this.blockDragHandler),document.removeEventListener("touchend",this.blockDragEndHandler)))}componentDidUpdate(){this.positionDragHandle()}getQName(e){return"python"==this.props.fileType&&e.pyQName?e.pyQName:e.qName}getSnippetName(e){return("python"==this.props.fileType?e.pySnippetName||e.pyName:void 0)||e.snippetName||e.name}getBlockDescription(e,t){let r=[],o=pxt.blocks.compileInfo(e),i=e.attributes._def&&e.attributes._def.parts,a=e.qName||e.name;const s="python"==this.props.fileType;return i?(t&&i.filter(e=>"param"==e.kind).length>t.length&&t.unshift(null),i.forEach((i,n)=>{switch(i.kind){case"label":r.push(k.createElement("span",{key:a+n},i.text));break;case"break":r.push(k.createElement("span",{key:a+n}," "));break;case"param":let e=null==o?void 0:o.definitionNameToParam[i.name],t=(null==e?void 0:e.defaultValue)||i.varName||(null==e?void 0:e.actualName)||i.name;s&&null!=e&&e.defaultValue&&(t=pxtc.tsSnippetToPySnippet(t)),r.push(k.createElement("span",{className:"argName",key:a+n},t))}})):r.push(k.createElement("span",{key:a},this.getSnippetName(e)||e.name)),t&&t.find(e=>(null==e?void 0:e.type)&&0<=e.type.indexOf("=>"))&&(r.unshift(k.createElement("span",{key:"prefix"},lf("run code "))),null!=o)&&o.handlerArgs&&(r.push(k.createElement("span",{key:"handler_break"}," ")),o.handlerArgs.forEach(e=>{e.inBlockDef||r.push(k.createElement("span",{className:"argName",key:"handler_"+e.name},e.name))})),r}positionDragHandle(){var e,t,i=document.querySelector(".monacoBlock.hover .blockHandle"),i=(i&&(e=i.parentElement,t=document.getElementById("monacoFlyoutWrapper"),i.style.height=e.clientHeight+"px",i.style.left=e.clientWidth+"px",i.style.top=e.offsetTop-t.scrollTop+"px"),document.querySelector(".monacoBlock.expand .blockHandle"));i&&(e=i.parentElement,t=document.getElementById("monacoFlyoutWrapper"),i.style.height=e.clientHeight+8+"px",i.style.left=e.clientWidth+4-1+"px",i.style.top=e.offsetTop-t.scrollTop+"px")}getMonacoBlock(t,i,n){if(void 0!==t.snippet){const b=this.state["ns"],v=this.props.parent.state.editorState?this.props.parent.state.editorState.filters:void 0,y=v?v.namespaces&&null!=v.namespaces[b]?v.namespaces[b]:v.defaultState:void 0,w=this.props.blockIdMap&&this.props.blockIdMap[t.attributes.blockId];let e=v?v.defaultState:pxt.editor.FilterState.Visible;var r,o,a,s,l,c,d,u,p,h,f,m,g;if(v&&v.fns&&void 0!==v.fns[t.name]?e=v.fns[t.name]:v&&v.blocks&&t.attributes.blockId&&(void 0!==v.blocks[t.attributes.blockId]||null!=w&&w.some(e=>v.blocks[e]))?e=v.blocks[t.attributes.blockId]:void 0!==y&&(e=y),e!=pxt.editor.FilterState.Hidden)return r=e==pxt.editor.FilterState.Disabled,a=(o="python"==this.props.fileType)?t.pySnippet:t.snippet,s=t.parameters,n=t.attributes.color||n,l=this.getBlockDescription(t,s?s.slice():null),c=t.attributes.help,u=(d=this.getQName(t)||this.getSnippetName(t))==this.state.selectedBlock,p=d==this.state.hoverBlock,h=pxt.BrowserUtils.hasPointerEvents(),f=pxt.BrowserUtils.isTouchEnabled(),m=this.getBlockDragStartHandler(t,a,n),g=t.attributes.jsDoc.replace(/``/g,'"').split("* @param",1)[0],k.createElement("div",{className:`monacoBlock ${r?"monacoDisabledBlock":""} ${u?"expand":""} `+(p?"hover":""),style:this.getSelectedStyle(),title:t.attributes.jsDoc,key:`block_${d}_`+i,tabIndex:0,role:"listitem",onClick:this.getBlockClickHandler(d),onMouseOver:this.getBlockMouseOver(d),onMouseOut:this.getBlockMouseOut(d),onKeyDown:this.getKeyDownHandler(t,a,o),onPointerDown:h?m:void 0,onMouseDown:h?void 0:m,onTouchStart:!h&&f?m:void 0},k.createElement("div",{className:"blockHandle",style:this.getSelectedStyle()},k.createElement("i",{className:"icon bars"})),k.createElement("div",{className:"monacoDraggableBlock",style:this.getBlockStyle(n)},k.createElement("span",{className:"blockName"},l)),k.createElement("div",{className:"detail"},k.createElement("div",{className:"description"},g),k.createElement("div",{className:"signature"},k.createElement("span",null,a||`${d}(${s?s.map(e=>""+e.name).join(", "):""})`),c&&k.createElement("a",{className:"blockHelp",href:"/reference/"+c,target:"_blank",rel:"noopener noreferrer",role:"button"},k.createElement("i",{className:"question circle outline icon","aria-label":lf("Open documentation")}))),s&&k.createElement("div",{className:"params"},s.map((e,t)=>k.createElement("div",{key:t},k.createElement("div",{className:"separator"}),k.createElement("span",{className:"paramName"},e.name),e.description&&k.createElement("span",{className:"paramDescription"},e.description.replace(/``/g,'"')))))))}}renderCore(){const{name:e,ns:t,color:i,icon:n,groups:r}=this.state,o=pxt.toolbox.convertColor(i||t&&pxt.toolbox.getNamespaceColor(t)||"255"),a=("blocklyTreeIcon"+(n?(t||n).toLowerCase():"Default")).replace(/\s/g,"");return k.createElement("div",{id:"monacoFlyoutWidget",className:"monacoFlyout",style:this.getFlyoutStyle()},k.createElement("div",{id:"monacoFlyoutWrapper",onScroll:this.scrollHandler,onWheel:this.wheelHandler,role:"list"},k.createElement("div",{className:"monacoFlyoutLabel monacoFlyoutHeading"},k.createElement("span",{className:"monacoFlyoutHeadingIcon blocklyTreeIcon "+a,role:"presentation",style:this.getIconStyle(o)},n&&1===n.length?n:""),k.createElement("div",{className:"monacoFlyoutLabelText"},pxtc.U.rlf("{id:category}"+e))),r&&r.map((e,t)=>{let i=[];if(e.name!=pxt.DEFAULT_GROUP_NAME&&1<r.length&&i.push(k.createElement("div",{className:"monacoFlyoutLabel blocklyFlyoutGroup",key:"label_"+t,tabIndex:0,onKeyDown:this.getKeyDownHandler(),role:"separator"},e.icon&&k.createElement("span",{className:"monacoFlyoutHeadingIcon blocklyTreeIcon "+a,role:"presentation"},e.icon),k.createElement("div",{className:"monacoFlyoutLabelText"},pxtc.U.rlf("{id:group}"+e.name)),e.hasHelp&&pxt.editor.HELP_IMAGE_URI&&k.createElement("span",null,k.createElement("img",{src:pxt.editor.HELP_IMAGE_URI,onClick:this.getHelpButtonClickHandler(e.name),alt:lf("Click for help")})),k.createElement("hr",{className:"monacoFlyoutLabelLine"}))),e.blocks){t=e.blocks.map((e,t)=>e.attributes.blockBuiltin?void pxt.log("ignoring built in block: "+e.attributes.blockId):this.getMonacoBlock(e,t,o)).filter(e=>void 0!==e);if(!(t&&0<t.length))return null;i=i.concat(t)}return i})))}}i.MonacoFlyout=o},{"./auth":8,"./compiler":18,"./core":64,"./data":67,"./workspace":136,react:320}],105:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getToolboxDefinition=i.overrideToolbox=i.overrideCategory=i.clearBuiltinBlockCache=i.allBuiltinBlocksByName=i.allBuiltinBlocks=i.isBuiltin=i.getBuiltinCategory=i.blockIdMap=i.getPauseUntil=void 0;let n,r,o,a,s=null;function l(){return s||((s={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"loops_while",snippetName:"while",snippet:"while (true) {\n\n}",pySnippet:"while True:\n    pass",attributes:{blockId:"device_while",weight:48,jsDoc:lf("Repeat code while condition is true")}},{name:"loops_for",snippetName:"for",snippet:"for (let i = 0; i < 5; i++) {\n\n}",pySnippet:"for i in range(4):\n    pass",attributes:{blockId:"pxt_controls_for",weight:47,jsDoc:lf("Repeat code a number of times in a loop")}}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},s.logic={name:lf("{id:category}Logic"),nameid:"logic",blocks:[{name:"logic_if",snippetName:"if",snippet:"if (true) {\n\n}",pySnippet:"if True:\n    pass",attributes:{blockId:"controls_if",weight:49,jsDoc:lf("Runs code if the condition is true")}},{name:"logic_if_else",snippetName:"if else",snippet:"if (true) {\n\n} else {\n\n}",pySnippet:"if True:\n    pass\nelse:\n    pass",attributes:{blockId:"controls_if",weight:48,jsDoc:lf("Runs code if the condition is true; else run other code")}},{name:"logic_and",snippetName:"and",snippet:"true && true",pySnippet:"True and True",attributes:{blockId:"logic_compare",weight:47,jsDoc:lf("Runs code if both specified conditions are true")}},{name:"logic_or",snippetName:"or",snippet:"true || false",pySnippet:"True or False",attributes:{blockId:"logic_compare",weight:46,jsDoc:lf("Runs code if either of two specified conditions is true")}}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},s.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:[{name:"var_let",snippetName:"let",snippet:"let item: number",pySnippet:"item = 0",pySnippetName:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_set",jsDoc:lf("Declares a variable named 'item'")}},{name:"var_equals",snippetName:"equals",snippet:"item = 0",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_get",jsDoc:lf("Assigns a value to a variable")}},{name:"var_change",snippetName:"change",snippet:"item += 1",pySnippet:"item += 1",snippetOnly:!0,attributes:{blockId:"variables_change",jsDoc:lf("Changes the value of item by 1")}}],attributes:{callingConvention:0,weight:50.07,icon:"variables",paramDefl:{}}},s.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"Math.plus",snippetName:"plus",snippet:"1 + 1",pySnippet:"1 + 1",snippetOnly:!0,attributes:{weight:90,blockId:"math_arithmetic",jsDoc:lf("Adds two numbers together")},retType:"number"},{name:"Math.minus",snippetName:"minus",snippet:"1 - 1",pySnippet:"1 - 1",snippetOnly:!0,attributes:{weight:89,blockId:"math_arithmetic",jsDoc:lf("Subtracts the value of one number from another")},retType:"number"},{name:"Math.multiply",snippetName:"multiply",snippet:"1 * 1",pySnippet:"1 * 1",snippetOnly:!0,attributes:{weight:88,blockId:"math_arithmetic",jsDoc:lf("Multiplies two numbers together")},retType:"number"},{name:"Math.divide",snippetName:"divide",snippet:"1 / 1",pySnippet:"1 / 1",snippetOnly:!0,attributes:{weight:87,blockId:"math_arithmetic",jsDoc:lf("Returns the quotient of one number divided by another")},retType:"number"},{name:"Math.remainder",snippetName:"remainder",snippet:"1 % 2",pySnippet:"1 % 2",snippetOnly:!0,attributes:{weight:80,blockId:"math_modulo",jsDoc:lf("Returns the remainder of one number divided by another")},retType:"number"},{name:"Math.max",snippetName:"max",snippet:"Math.max(1, 2)",pySnippet:"max(1, 2)",attributes:{weight:75,blockId:"math_op2",jsDoc:lf("Returns the largest of two numbers")},retType:"number"},{name:"Math.min",snippetName:"min",snippet:"Math.min(1, 2)",pySnippet:"min(1, 2)",attributes:{weight:74,blockId:"math_op2",jsDoc:lf("Returns the smallest of two numbers")},retType:"number"},{name:"Math.abs",snippetName:"abs",snippet:"Math.abs(-1)",pySnippet:"abs(-1)",attributes:{weight:70,blockId:"math_op3",jsDoc:lf("Returns the absolute value of a number")},retType:"number"},{name:"randint",snippetName:"randint",snippet:"randint(0, 10)",pySnippetName:"randint",pySnippet:"randint(0, 10)",attributes:{weight:65,blockId:"device_random",jsDoc:lf("Returns a random number between min and max")},retType:"number"}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},s.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[{name:"functionDef",snippetName:"function doSomething",snippet:"function doSomething() {\n\n}",pySnippetName:"def do_something",pySnippet:"def do_something():\n    pass",attributes:{blockId:"procedures_defnoreturn",jsDoc:lf("Define a function")}},{name:"functionCall",snippetName:"doSomething",snippet:"doSomething()",pySnippetName:"do_something",pySnippet:"do_something()",attributes:{blockId:"procedures_callnoreturn",jsDoc:lf("Call a function")}}],attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},s.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",custom:!0,blocks:[{name:"array_create",snippetName:"create",snippet:`let ${lf("{id:snippets}list")} = [1, 2, 3];`,pySnippet:lf("{id:snippets}list")+" = [1, 2, 3]",snippetOnly:!0,attributes:{weight:100,blockId:"lists_create_with",jsDoc:lf("Creates a new Array")},retType:"array"},{name:"array_length",snippetName:"length",snippet:lf("{id:snippets}list")+".length",pySnippetName:"len",pySnippet:`len(${lf("{id:snippets}list")})`,snippetOnly:!0,attributes:{weight:99,blockId:"lists_length",jsDoc:lf("Returns the number of values in an Array")},retType:"number"},{name:"array_get",snippetName:"get",snippet:lf("{id:snippets}list")+"[0]",pySnippet:lf("{id:snippets}list")+"[0]",snippetOnly:!0,attributes:{weight:98,blockId:"lists_index_get",jsDoc:lf("Returns the value in the Array at the given index")}},{name:"array_set",snippetName:"set",snippet:lf("{id:snippets}list")+"[0] = 1",pySnippet:lf("{id:snippets}list")+"[0] = 1",snippetOnly:!0,attributes:{weight:97,blockId:"lists_index_set",jsDoc:lf("Overwrites the value in an Array at the given index")}},{name:"array_push",snippetName:"push",snippet:lf("{id:snippets}list")+".push(1)",pySnippetName:"append",pySnippet:lf("{id:snippets}list")+".append(1)",attributes:{weight:96,blockId:"array_push",jsDoc:lf("Adds a value to the end of an Array")}},{name:"arary_pop",snippetName:"pop",snippet:lf("{id:snippets}list")+".pop()",pySnippetName:"pop",pySnippet:lf("{id:snippets}list")+".pop()",attributes:{weight:95,blockId:"array_pop",jsDoc:lf("Removes and returns the value at the end of an Array")},retType:"object"},{name:"array_insertAt",snippetName:"insertAt",snippet:lf("{id:snippets}list")+".insertAt(0, 0)",pySnippetName:"insert",pySnippet:lf("{id:snippets}list")+".insert(0, 0)",attributes:{weight:50,blockId:"array_insertAt",jsDoc:lf("Inserts a value into the Array at the given index"),advanced:!0}},{name:"array_removeAt",snippetName:"removeAt",snippet:lf("{id:snippets}list")+".removeAt(0)",attributes:{weight:49,blockId:"array_removeat",jsDoc:lf("Removes a value from the Array at the given index and returns it"),advanced:!0},retType:"object"},{name:"array_shift",snippetName:"shift",snippet:lf("{id:snippets}list")+".shift()",attributes:{weight:48,blockId:"array_shift",jsDoc:lf("Removes and returns the value at the front of an Array"),advanced:!0}},{name:"array_unshift",snippetName:"unshift",snippet:lf("{id:snippets}list")+".unshift(0)",pySnippetName:"append",pySnippet:lf("{id:snippets}list")+".append(0)",attributes:{weight:47,blockId:"array_unshift",jsDoc:lf("Inserts a value at the beginning of an Array"),advanced:!0}},{name:"array_indexOf",snippetName:"indexOf",snippet:"[0, 1, 2].indexOf(1)",pySnippetName:"index",pySnippet:"[0, 1, 2].index(1)",attributes:{weight:46,jsDoc:lf("Returns the first index in the Array that contains the given value or -1 if it does not exist in the Array"),advanced:!0},retType:"number"},{name:"array_reverse",snippetName:"reverse",snippet:lf("{id:snippets}list")+".reverse()",pySnippet:lf("{id:snippets}list")+".reverse()",attributes:{weight:45,jsDoc:lf("Reverses the contents of an Array"),advanced:!0}}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},s.text={name:lf("{id:category}Text"),nameid:"text",custom:!0,blocks:[{name:"text_length",snippetName:"length",snippet:'"".length',pySnippetName:"len",pySnippet:'len("")',snippetOnly:!0,attributes:{blockId:"text_length",jsDoc:lf("Returns the number of characters in a string")},retType:"number"},{name:"text_concat",snippetName:"concat",snippet:'"" + 5',pySnippet:'"" + 5',snippetOnly:!0,attributes:{blockId:"text_join",jsDoc:lf("Combines a string with a number, boolean, string, or other object into one string")},retType:"string"},{name:"text_compare",snippetName:"compare",snippet:'"".compare("")',attributes:{blockId:"string_compare",jsDoc:lf("Compares one string against another alphabetically and returns a number")},retType:"number"},{name:"text_parseInt",snippetName:"parseInt",snippet:'parseInt("5")',pySnippetName:"int",pySnippet:'int("5")',attributes:{blockId:"string_parseint",jsDoc:lf("Converts a number written as text into a number")},retType:"number"},{name:"text_substr",snippetName:"substr",snippet:'"".substr(0, 0)',pySnippet:'""[0:1]',attributes:{blockId:"string_substr",jsDoc:lf("Returns the part of a string starting at a given index with the given length")},retType:"string"},{name:"text_charAt",snippetName:"charAt",snippet:'"".charAt(0)',pySnippetName:"str[0]",pySnippet:'""[0]',attributes:{blockId:"string_get",jsDoc:lf("Returns the character at the given index")},retType:"string"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},s.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),s}function c(){if(!n){var t=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(t){var i=t.callName||"pauseUntil";let e=i+"(() => true)";t.namespace&&(e=t.namespace+"."+e),n={name:"pause_until",snippetName:i,snippet:e,attributes:{blockNamespace:t.category||"loops",weight:null==t.weight?0:t.weight,jsDoc:lf("Pause execution of code until the given boolean expression is true"),advanced:!1}}}}return n}function d(e){return l()[e]}function u(){o||(o={},a={},[l().loops,l().logic,l().Math,l().text,l().arrays,l().variables,l().functions].forEach(t=>{t.blocks.forEach(e=>{e.type||e.snippet&&(e.attributes.blockId&&!o[e.attributes.blockId]&&(o[e.attributes.blockId]=[e,t.nameid]),a[e.name]||(a[e.name]=[e,t.nameid]))})}))}function p(e,t){e=d(e);if(t&&e&&(0===Object.keys(t).length&&(e.removed=!0),t.name&&(e.name=t.name),t.icon&&(e.attributes.icon=t.icon),void 0!==t.weight&&(e.attributes.weight=t.weight),void 0!==t.advanced&&(e.attributes.advanced=t.advanced),null!=t.groups&&(e.groups=t.groups),t.blocks)){let n=100;e.blocks=t.blocks.map((e,t)=>{return e.weight?n=e.weight:n--,e=e,i=n,{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,attributes:{blockId:e.blockId,weight:i||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml};var i})}}function h(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map(e=>({name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId})):[]}}i.getPauseUntil=c,i.blockIdMap=function(){if(!r){r={pxt_controls_for:["controls_repeat_ext"]};const t=pxt.appTarget.blockIdMap;t&&Object.keys(t).forEach(e=>r[e]=t[e])}return r},i.getBuiltinCategory=d,i.isBuiltin=function(e){return!!l()[e]},i.allBuiltinBlocks=function(){u();var e=c();return e&&(o[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),o},i.allBuiltinBlocksByName=function(){u();var e=c();return e&&(a[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),a},i.clearBuiltinBlockCache=function(){o=void 0,a=void 0},i.overrideCategory=p,i.overrideToolbox=function(e){p("loops",e.loops),p("logic",e.logic),p("variables",e.variables),p("Math",e.maths),p("text",e.text),p("arrays",e.arrays),p("functions",e.functions)},i.getToolboxDefinition=function(){return{loops:h(l().loops),logic:h(l().logic),variables:h(l().variables),maths:h(l().Math),text:h(l().text),arrays:h(l().arrays),functions:h(l().functions)}}},{}],106:[function(e,t,i){"use strict";function m(e){return e&&e.match(/^ */)[0].length||0}function g(e,t){return new Array(e+1).join(" ")+t.trim()}function b(e,t,i){return e.slice(t.getOffsetAt({lineNumber:i,column:0}),t.getOffsetAt({lineNumber:i+1,column:0}))}function r(e,t,i){var n=e.getValue(),r=e.getOffsetAt({lineNumber:t.startLineNumber,column:0}),o=e.getOffsetAt({lineNumber:t.startLineNumber,column:t.startColumn}),a=e.getOffsetAt({lineNumber:t.endLineNumber,column:t.endColumn}),s=(i?n.slice(r,o)+i:n.slice(r,a)).split("\n"),i=r!==o&&!!n.substring(r,o).trim(),l=s.map((e,t)=>e?t:-1).filter(e=>0<=e);let c=t.startLineNumber-1,d=b(n,e,c);for(;!d&&0<c;)d=b(n,e,--c);let u=m(d);":"==(a=(a=d).trim())[a.length-1]&&(u+=4),s[0]=i?s[0]:g(u,s[0]);for(let e=1;e<l.length;e++){var p=l[e],h=s[p],f=m(h);s[p]=g(u+f,h)}return[{text:s.join("\n"),range:t.setStartPosition(t.startLineNumber,0)}]}Object.defineProperty(i,"__esModule",{value:!0}),i.fixIndentationInRange=i.provideDocumentRangeFormattingEdits=void 0,i.provideDocumentRangeFormattingEdits=function(e,t,i,n){return r(e,t)},i.fixIndentationInRange=r},{}],107:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NotificationBanner=i.GenericBanner=void 0;const l=e("react"),n=e("./data"),c=e("./sui");class d extends n.Component{constructor(e){super(e),this.delayTime=this.props.delayTime||0,this.doneSleeping=this.sleepDone(),this.bannerType=this.props.bannerType||"default",this.handleClick=this.handleClick.bind(this)}componentDidMount(){this.doneSleeping&&(this.timer=setTimeout(()=>this.show(),this.delayTime))}componentWillUnmount(){clearTimeout(this.timer)}sleepDone(){var e;return!this.props.sleepTime||(e=parseInt(pxt.storage.getLocal("lastBannerClosedTime")||"0"),pxt.Util.nowSeconds()-e>this.props.sleepTime)}show(){pxt.tickEvent(`notificationBanner.${this.props.id}.show`),this.props.displayTime&&(this.timer=setTimeout(()=>this.hide("automatic"),this.delayTime+this.props.displayTime)),this.props.parent.setBannerVisible(!0),this.render()}hide(e){pxt.tickEvent(`notificationBanner.${this.props.id}.`+e+"Close"),pxt.storage.setLocal("lastBannerClosedTime",pxt.Util.nowSeconds().toString()),this.props.parent.setBannerVisible(!1),this.render()}handleClick(){this.hide("manual"),clearTimeout(this.timer)}renderCore(){return this.props.parent.state.bannerVisible&&this.doneSleeping?l.createElement("div",{id:"notificationBanner",className:`ui attached ${this.bannerType} message`},l.createElement("div",{className:"bannerLeft"},l.createElement("div",{className:"content"},this.props.children)),l.createElement("div",{className:"bannerRight"},l.createElement(c.Icon,{icon:"close",tabIndex:0,onClick:this.handleClick}))):l.createElement("div",null)}}i.GenericBanner=d;class r extends n.Component{constructor(e){super(e),this.state={},this.clearExperiments=this.clearExperiments.bind(this)}clearExperiments(){pxt.tickEvent("banner.experiments",void 0,{interactiveConsent:!0}),pxt.editor.experiments.clear(),this.props.parent.reloadEditor()}handleBannerClick(){pxt.tickEvent("winApp.banner",void 0),window.open("/windows-app","_blank")}renderCore(){const e=pxt.appTarget.appTheme,t=pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),i="localhost"===location.hostname,n="/"!==location.pathname&&-1===(e.appPathNames||[]).indexOf(location.pathname),r=!i&&t&&n,o=pxt.editor.experiments.someEnabled()&&!/experiments=1/.test(window.location.href),a=pxt.appTarget.appTheme.showWinAppDeprBanner&&pxt.BrowserUtils.isWinRT(),s=lf("This app is being deprecated. Please use the website instead.");if(a)return l.createElement(d,{id:"winAppBanner",parent:this.props.parent,bannerType:"negative"},l.createElement(c.Icon,{icon:"warning circle"}),l.createElement("div",{className:"header"},s),l.createElement(c.Link,{className:"link",ariaLabel:lf("More info"),onClick:this.handleBannerClick},lf("More info")));if(o){const e=2e4;return l.createElement(d,{id:"experimentsbanner",parent:this.props.parent,bannerType:"negative",displayTime:2e4},l.createElement(c.Icon,{icon:"information circle"}),l.createElement("div",{className:"header"},lf("Experiments enabled.")),l.createElement(c.Link,{className:"link",ariaLabel:lf("Clear"),onClick:this.clearExperiments},lf("Clear")))}if(r){const e=pxt.appTarget.appTheme.homeUrl+location.search+location.hash;return l.createElement(d,{id:"experimental",parent:this.props.parent,bannerType:"negative"},l.createElement(c.Icon,{icon:"warning circle"}),l.createElement("div",{className:"header"},lf("You are viewing an experimental version of the editor")),l.createElement(c.Link,{className:"link",ariaLabel:lf("Go back to live editor"),href:e},lf("Take me back")))}return l.createElement("div",null)}}i.NotificationBanner=r},{"./data":67,"./sui":129,react:320}],108:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getExtensionOfFileName=o.invalidatePagesStatus=o.invalidatePullRequestStatus=o.invalidatePullStatus=o.loadPkgAsync=o.notifySyncDone=o.allEditorPkgs=o.genFileName=o.mainEditorPkg=o.getEditorPkg=o.mainPkg=o.EditorPackage=o.File=o.setupAppTarget=void 0;const r=e("./workspace"),a=e("./data"),s=e("./core"),i=e("./db"),l=e("./compiler");var d=pxt.Util;let n=new i.Table("hostcache"),c={ts:10,blocks:20,jres:25,json:30,md:40};o.setupAppTarget=function(e){pxt.setAppTarget(e)};class u{constructor(e,t,i){this.epkg=e,this.name=t,this.content=i,this.inSyncWithEditor=!0}isReadonly(){return!this.epkg.header||this.isAutoGenerated()}getName(){return this.epkg.getPkgId()+"/"+this.name}getTextFileName(){return this.epkg.isTopLevel()?this.name:"pxt_modules/"+this.epkg.getPkgId()+"/"+this.name}getFileNameWithExtension(e){var t=this.getTextFileName();return t.substring(0,t.length-this.getExtension().length)+e}getExtension(){return b(this.name)}getVirtualFileName(e){var t=this.name.replace(/.*\./,""),i=t?this.name.slice(0,-t.length-1):this.name;if(/^blocks|py|ts$/.test(t))switch(e){case pxt.BLOCKS_PROJECT_NAME:return i+".blocks";case pxt.JAVASCRIPT_PROJECT_NAME:return i+".ts";case pxt.PYTHON_PROJECT_NAME:return i+".py";default:return void pxt.U.oops()}}weight(){return/^main\./.test(this.name)?5:/^_locales\//.test(this.name)?500:c.hasOwnProperty(this.getExtension())?c[this.getExtension()]:60}markDirty(){this.inSyncWithEditor=!1,this.updateStatus()}updateStatus(){a.invalidate("open-meta:"+this.getName())}setBaseGitContent(e){e!=this.baseGitContent&&(this.baseGitContent=e,this.updateStatus())}setContentAsync(t,i){if(d.assert(void 0!==t),this.inSyncWithEditor=!0,t==this.content)return this.updateStatus(),Promise.resolve();{let e=this.content;return this.content=t,this.updateStatus(),this.epkg.saveFileAsync(this.name).then(()=>{this.content==t&&this.updateStatus(),i&&this.forceChangeCallback&&this.forceChangeCallback(e,t),this.name==pxt.github.GIT_JSON&&this.epkg.updateGitJsonCache()})}}setForceChangeCallback(e){this.forceChangeCallback=e}publishedContent(){let e=this.content;return e=this.name==pxt.CONFIG_NAME?r.prepareConfigForGithub(e):e}isAutoGenerated(){return"this"===this.epkg.getPkgId()&&(this.name===pxt.TILEMAP_CODE||this.name===pxt.TILEMAP_JRES||this.name===pxt.IMAGES_CODE||this.name===pxt.IMAGES_JRES||this.name===pxt.TUTORIAL_INFO_FILE||this.name==pxt.ASSETS_FILE)}}o.File=u;class p{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={},this.onupdate=()=>{},this.saveScheduled=!1,this.savingNow=0,this.simStateSaveScheduled=!1,this.transpileCache=[],e&&"workspace"==e.verProtocol()&&(this.header=r.getHeader(e.verArgument()))}getSimState(){if(!this.simState){this.files[pxt.SIMSTATE_JSON]||this.setFile(pxt.SIMSTATE_JSON,"{}");var e=this.files[pxt.SIMSTATE_JSON];try{this.simState=JSON.parse(e.content)}catch(e){this.simState={}}}return this.simState}setSimState(e,t){var i=this.getSimState();i[e]!=t&&(null==t?delete i[e]:i[e]=t,this.simStateSaveScheduled||(this.simStateSaveScheduled=!0,setTimeout(()=>{var e;this.simStateSaveScheduled=!1,this.simState&&(e=this.files[pxt.SIMSTATE_JSON])&&e.setContentAsync(JSON.stringify(this.simState))},2e3)))}getTopHeader(){return this.topPkg.header}getLanguageRestrictions(){var e=this.topPkg.ksPkg,e=e&&e.config;return e&&e.languageRestriction}getGeneratedFiles(t){if(-1<t.name.indexOf(".g.")){const i=t.name.substring(0,t.name.indexOf(".g.")+".g.".length);return d.values(this.files).filter(e=>e!==t&&pxt.U.startsWith(e.name,i))}return[]}afterMainLoadAsync(){return this.assetsPkg?this.assetsPkg.loadAssetsAsync():Promise.resolve()}saveAssetAsync(e,t){return r.saveAssetAsync(this.header.id,e,t).then(()=>this.assetsPkg.loadAssetsAsync())}loadAssetsAsync(){return"assets"!=this.id?Promise.resolve():r.listAssetsAsync(this.topPkg.header.id).then(e=>{var t,i,n=d.flatClone(this.files);for(t of e){var r,o=t.name;d.lookup(this.files,o)?delete n[o]:(r=new u(this,o,`File size: ${t.size}; URL: `+t.url),this.files[o]=r)}for(i of Object.keys(n))delete this.files[i];let a="";for(let t of this.sortedFiles()){var s=e.filter(e=>e.name==t.name)[0];a+=`    export const ${t.name.replace(/\..*/,"").replace(/[^a-zA-Z0-9_]/g,"_")} = "${s.url}";
`}var l=this.topPkg.lookupFile("assets.ts");if(l||a){a=`namespace assets {
${a}}
`;var c=this.topPkg.ksPkg.config;if(c.files.indexOf("assets.ts")<0&&(c.files.push("assets.ts"),this.topPkg.ksPkg.saveConfig()),l)return l.setContentAsync(a);this.topPkg.setFile("assets.ts",a)}return Promise.resolve()})}makeTopLevel(){(this.topPkg=this).outputPkg=new p(null,this),this.outputPkg.id="built",pxt.appTarget.runtime&&pxt.appTarget.runtime.assetExtensions&&(this.assetsPkg=new p(null,this),this.assetsPkg.id="assets")}updateConfigAsync(e){var t=this.files[pxt.CONFIG_NAME];if(t)try{var i=JSON.parse(t.content);return e(i),t.setContentAsync(pxt.Package.stringifyConfig(i)).then(()=>this.ksPkg.loadConfig())}catch(e){}return null}updateDepAsync(e){e=this.ksPkg.resolveDep(e);if(!e||"github"!=e.verProtocol())return Promise.resolve();let i=pxt.github.parseRepoId(e.verArgument());return i?pxt.targetConfigAsync().then(e=>pxt.github.latestVersionAsync(i.slug,e.packages)).then(e=>{var t=d.values(this.ksPkg.dependencies()).map(e=>pxt.github.parseRepoId(e)).filter(e=>(null==e?void 0:e.slug)===i.slug);return Promise.all(t.map(t=>(t.tag=e,pxt.github.pkgConfigAsync(t.fullName,t.tag).catch(s.handleNetworkError).then(e=>({ghid:t,cfg:e})))))}).then(e=>this.updateConfigAsync(i=>e.forEach(({ghid:e,cfg:t})=>i.dependencies[t.name]=pxt.github.stringifyRepo(e)))).then(()=>this.saveFilesAsync()):Promise.resolve()}removeDepAsync(t){return this.updateConfigAsync(e=>delete e.dependencies[t]).then(()=>this.saveFilesAsync())}setDependencyAsync(t,i){return this.updateConfigAsync(e=>e.dependencies[t]=i).then(()=>this.saveFilesAsync())}getKsPkg(){return this.ksPkg}getPkgId(){return(this.ksPkg||this).id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFile(e,t,i){t=new u(this,e,t);return i&&(t.virtual=!0),this.files[e]=t,a.invalidate("open-meta:"),t}removeFileAsync(t){return delete this.files[t],a.invalidate("open-meta:"),this.updateConfigAsync(e=>{e.files=e.files.filter(e=>e!=t),e.testFiles&&(e.testFiles=e.testFiles.filter(e=>e!=t))})}setContentAsync(t,e){let i=this.files[t],n=Promise.resolve();return i||(i=new u(this,t,""),this.files[t]=i,n=n.then(()=>this.updateConfigAsync(e=>e.files.indexOf(t)<0?e.files.push(t):0))),n.then(()=>i.setContentAsync(e))}updateGitJsonCache(){var e=this.files[pxt.github.GIT_JSON];if(e){const i=JSON.parse(e.content),n=pxt.github.parseRepoId(i.repo);i.commit&&Object.keys(this.files).forEach(e=>{var t=pxt.github.lookupFile(n,i.commit,e);t&&null!=t.blobContent&&this.files[e].setBaseGitContent(t.blobContent)})}}setFiles(e){this.files=d.mapMap(e,(e,t)=>new u(this,e,t)),a.invalidate("open-meta:"),this.updateGitJsonCache()}getAllFiles(){var e=d.mapMap(this.files,(e,t)=>t.content);return delete e[pxt.SERIAL_EDITOR_FILE],e}saveFileAsync(e){var t;return this.header?(t=null==(t=this.files[e])?void 0:t.content,e===pxt.CONFIG_NAME?this.saveFilesAsync():r.partialSaveAsync(this.header.id,e,t)):Promise.resolve()}saveFilesAsync(){if(!this.header)return Promise.resolve();var e=this.files[pxt.CONFIG_NAME];if(e)try{var t=JSON.parse(e.content);this.header.name=t.name}catch(e){}return r.saveAsync(this.header,this.getAllFiles())}sortedFiles(){let e=d.values(this.files);return(e=pxt.options.debug?e:e.filter(e=>e.name!=pxt.github.GIT_JSON&&e.name!=pxt.SIMSTATE_JSON&&e.name!=pxt.SERIAL_EDITOR_FILE)).sort((e,t)=>e.weight()-t.weight()||d.strcmp(e.name,t.name)),e}forEachFile(t){this.pkgAndDeps().forEach(e=>{d.values(e.files).forEach(t)})}getMainFile(){return this.sortedFiles()[0]}pkgAndDeps(){if(this.topPkg!=this)return this.topPkg.pkgAndDeps();var e,t=this.ksPkg.deps,i=[];for(e of Object.keys(t))/---/.test(e)||t[e].cppOnly||i.push(f(t[e]));return this.assetsPkg&&i.push(this.assetsPkg),i.push(this.outputPkg),i}filterFiles(t){return d.concat(this.pkgAndDeps().map(e=>d.values(e.files).filter(t)))}lookupFile(t){return 0===t.indexOf("pxt_modules/")&&(t=t.slice(12)),this.filterFiles(e=>e.getName()==t)[0]}buildAssetsAsync(){var e;return null!=(e=this.tilemapProject)&&e.needsRebuild?(this.tilemapProject.needsRebuild=!1,this.buildTilemapsAsync().then(()=>this.buildImagesAsync())):Promise.resolve()}buildTilemapsAsync(){var e=this.lookupFile("this/"+pxt.TILEMAP_CODE),t=this.lookupFile("this/"+pxt.TILEMAP_JRES),i=this.tilemapProject.getProjectTilesetJRes();if(!e&&1===Object.keys(i).length)return Promise.resolve();const n=pxt.emitTilemapsFromJRes(i),r=JSON.stringify(i,null,4);return(null==e?void 0:e.content)===n&&(null==t?void 0:t.content)===r?Promise.resolve():this.setContentAsync(pxt.TILEMAP_JRES,r).then(()=>this.setContentAsync(pxt.TILEMAP_CODE,n)).then(()=>{o.mainPkg.updateJRes(),l.refreshLanguageServiceApisInfo()})}buildImagesAsync(){var e=this.lookupFile("this/"+pxt.IMAGES_CODE),t=this.lookupFile("this/"+pxt.IMAGES_JRES),i=this.tilemapProject.getProjectAssetsJRes();if(!e&&1===Object.keys(i).length)return Promise.resolve();const n=pxt.emitProjectImages(i),r=JSON.stringify(i,null,4);return(null==e?void 0:e.content)===n&&(null==t?void 0:t.content)===r?Promise.resolve():this.setContentAsync(pxt.IMAGES_JRES,r).then(()=>this.setContentAsync(pxt.IMAGES_CODE,n)).then(()=>{o.mainPkg.updateJRes(),l.refreshLanguageServiceApisInfo()})}cacheTranspile(e,t,i,n){this.transpileCache.push({fromLanguage:e,fromText:t,toLanguage:i,toText:n}),10<this.transpileCache.length&&this.transpileCache.shift()}getCachedTranspile(e,t,i){for(const n of this.transpileCache){if(n.toLanguage===e&&n.fromLanguage===i&&n.toText===t)return n.fromText;if(n.fromLanguage===e&&n.toLanguage===i&&n.fromText===t)return n.toText}return null}invalidateCachedTranspile(t,i,n){for(let e=0;e<this.transpileCache.length;e++){var r=this.transpileCache[e],o=r.toLanguage===t&&r.fromLanguage===n&&r.toText===i,r=r.fromLanguage===t&&r.toLanguage===n&&r.fromText===i;if(o||r)return void this.transpileCache.splice(e,1)}}addDependencyAsync(n,r,o){return this.topPkg!==this?this.topPkg.addDependencyAsync(n,r):this.ksPkg.findConflictsAsync(n,r).then(t=>{let e=n.core?[]:t.filter(e=>this.ksPkg.isPackageInUse(e.pkg0.id)),i=Promise.resolve(!0);if(e.length)i=i.then(()=>s.confirmAsync({header:lf("Cannot add {0} extension",n.name),hideCancel:!0,agreeLbl:lf("Ok"),body:lf("Remove all the blocks from the {0} extension and try again.",e[0].pkg0.id)})).then(()=>!1);else if(t.length){const r=1===t.length?lf("Extension {0} is incompatible with {1}. Remove {0} and add {1}?",t[0].pkg0.id,n.name):lf("Extensions {0} and {1} are incompatible with {2}. Remove them and add {2}?",t.slice(0,-1).map(e=>e.pkg0.id).join(", "),t.slice(-1)[0].pkg0.id,n.name);i=i.then(()=>o?Promise.resolve(1):s.confirmAsync({header:lf("Some extensions will be removed"),agreeLbl:lf("Remove extension(s) and add {0}",n.name),agreeClass:"pink",body:r})).then(e=>0!==e?Promise.all(t.map(e=>this.removeDepAsync(e.pkg0.id))).then(()=>!0):Promise.resolve(!1))}return i.then(e=>e?this.setDependencyAsync(n.name,r).then(()=>!0):Promise.resolve(!1))})}}o.EditorPackage=p;const h=new class{readFile(e,t){e=f(e).files[t];return e?e.content:null}writeFile(e,t,i,n){if(t!=pxt.CONFIG_NAME&&!n)throw d.oops("trying to write "+e+" / "+t);f(e).files[t].setContentAsync(i,n)}getHexInfoAsync(e){return pxt.hexloader.getHexInfoAsync(this,e).catch(s.handleNetworkError)}cacheStoreAsync(t,e){return n.forceSetAsync({id:t,val:e}).then(()=>{},e=>{pxt.tickEvent("cache.store.failed",{error:e.name}),pxt.log(`cache store failed for ${t}: `+e.name)})}cacheGetAsync(e){return n.getAsync(e).then(e=>e.val,e=>null)}downloadPackageAsync(i){let e=i.verProtocol(),n=f(i),t=t=>r.getTextAsync(t).then(e=>n.isTopLevel()||e?e?n.isTopLevel()&&n.header?r.recomputeHeaderFlagsAsync(n.header,e).then(()=>n.setFiles(e)):(n.setFiles(e),Promise.resolve()):Promise.reject(new Error(`Cannot find text for package '${t}' in the workspace.`)):(i.configureAsInvalidPackage(`cannot find '${t}' in the workspace.`),Promise.resolve()));if("pub"==e)return r.getPublishedScriptAsync(i.verArgument()).then(e=>n.setFiles(e));if("github"==e)return r.getPublishedScriptAsync(i.version()).then(e=>n.setFiles(e));if("workspace"==e)return t(i.verArgument());if("file"==e){let e=i.verArgument();return t(e="."==e[0]?(i.parent.verArgument()+"/"+e).replace(/\/+/g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\.\//g,"/"):e)}if("embed"==e)return n.setFiles(pxt.getEmbeddedScript(i.verArgument())),Promise.resolve();if("pkg"!=e)return"invalid"==e?(pxt.log("skipping invalid pkg "+i.id),Promise.resolve()):Promise.reject(`Cannot download ${i.version()}; unknown protocol`);{const e=o.mainPkg.readFile(i.verArgument().replace(/^\.\//,"")),r=ts.pxtc.Util.jsonTryParse(e);return r?n.setFiles(r):pxt.log("failed to resolve "+i.version()),Promise.resolve()}}};function f(e){var t=e._editorPkg;if(t)return t;let i=null;e!=o.mainPkg&&(i=f(o.mainPkg));t=new p(e,i);return e==o.mainPkg&&t.makeTopLevel(),e._editorPkg=t}function m(){return f(o.mainPkg)}function g(){return f(o.mainPkg).pkgAndDeps()}function b(e){e=/\.([^\.]+)$/.exec(e);return e?e[1]:""}o.mainPkg=new pxt.MainPackage(h),o.getEditorPkg=f,o.mainEditorPkg=m,o.genFileName=function(e){let t=m().header.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+=«»°{}\[\]¾½¼³²¦¬¤¢£~­¯¸`±\x00-\x1F]/g,"");if(t=t.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");t=t.replace(e,"")}return t=t||"Untitled",`${pxt.appTarget.nickname||pxt.appTarget.id}-`+t+e},o.allEditorPkgs=g,o.notifySyncDone=function(t){0<d.values(o.mainPkg.deps).filter(e=>"workspace"==e.verProtocol()&&t.hasOwnProperty(e.verArgument())).length&&f(o.mainPkg).onupdate()},o.loadPkgAsync=function(e,t){return o.mainPkg=new pxt.MainPackage(h),o.mainPkg._verspec="workspace:"+e,h.downloadPackageAsync(o.mainPkg).catch(s.handleNetworkError).then(()=>ts.pxtc.Util.jsonTryParse(h.readFile(o.mainPkg,pxt.CONFIG_NAME))).then(e=>e?o.mainPkg.installAllAsync(t).then(()=>m().afterMainLoadAsync()):(o.mainPkg.configureAsInvalidPackage(lf("invalid pxt.json file")),m().afterMainLoadAsync()))},a.mountVirtualApi("open-meta",{getSync:e=>{e=a.stripProtocol(e);var t=m(),e=t.lookupFile(e);return e?(t=!(!t.header||!t.header.githubId||e.epkg!=t),null==(t={isReadonly:e.isReadonly(),numErrors:e.numDiagnosticsOverride,isGitModified:t&&e.baseGitContent!=e.publishedContent()}).numErrors&&(t.numErrors=e.diagnostics?e.diagnostics.length:0,t.diagnostics=e.diagnostics),t):{}}}),a.mountVirtualApi("open-pkg-meta",{getSync:t=>{t=a.stripProtocol(t);var e=g().filter(e=>e.getPkgId()==t)[0];if(!e||"built"==e.getPkgId())return{};var i=e.sortedFiles();let n=i.reduce((e,t)=>e+(t.numDiagnosticsOverride||(t.diagnostics?t.diagnostics.length:0)||0),0);e=e.getKsPkg();e&&e.invalid()&&n++;const r={numErrors:n};return n&&(r.diagnostics=[],i.filter(e=>!!e.diagnostics).forEach(e=>r.diagnostics.concat(e.diagnostics))),r}}),a.mountVirtualApi("pkg-git-status",{getSync:t=>{t=a.stripProtocol(t);var e=g().find(e=>e.header&&e.header.id==t),i={};if(e&&(i.id="this"==e.getPkgId()&&e.header&&e.header.githubId,i.id)){const t=e.sortedFiles();i.modified=!!t.find(e=>e.baseGitContent!=e.publishedContent())}return i}}),o.invalidatePullStatus=function(e){a.invalidateHeader("pkg-git-pull-status",e)},a.mountVirtualApi("pkg-git-pull-status",{getAsync:t=>{t=a.stripProtocol(t);var e=g().find(e=>e.header&&e.header.id==t);return"this"==e.getPkgId()&&e.header&&e.header.githubId?r.pullAsync(e.header,!0).catch(e=>r.PullStatus.NoSourceControl):Promise.resolve(r.PullStatus.NoSourceControl)},expirationTime:e=>36e5}),o.invalidatePullRequestStatus=function(e){a.invalidateHeader("pkg-git-pr",e)},a.mountVirtualApi("pkg-git-pr",{getAsync:t=>{const i={number:-1};t=a.stripProtocol(t);var e=g().find(e=>e.header&&e.header.id==t),n=e.header,e="this"==e.getPkgId()&&n&&n.githubId;return e&&(n=pxt.github.parseRepoId(e))&&n.tag&&"master"!=n.tag?pxt.github.findPRNumberforBranchAsync(n.fullName,n.tag).catch(e=>i):Promise.resolve(i)},expirationTime:e=>36e5}),o.invalidatePagesStatus=function(e){a.invalidateHeader("pkg-git-pages",e)},a.mountVirtualApi("pkg-git-pages",{getAsync:t=>{t=a.stripProtocol(t);var e=g().find(e=>e.header&&e.header.id==t),i=e.header,e="this"==e.getPkgId()&&i&&i.githubId;return e&&(i=pxt.github.parseRepoId(e))?pxt.github.getPagesStatusAsync(i.fullName).catch(e=>{}):Promise.resolve(void 0)},expirationTime:e=>36e5}),a.mountVirtualApi("pkg-status",{getSync:t=>{t=a.stripProtocol(t);var e=g().find(e=>e.header&&e.header.id==t);return e&&e.savingNow?"saving":""}}),o.getExtensionOfFileName=b},{"./compiler":18,"./core":64,"./data":67,"./db":68,"./workspace":136}],109:[function(e,t,i){"use strict";var s=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ChooseHwDialog=i.NewProjectDialog=i.ExitAndSaveDialog=i.ImportDialog=i.ProjectsDetail=i.ProjectsCodeCard=i.ProjectsCarousel=i.ProjectSettingsMenu=i.Projects=void 0;const v=e("react"),n=e("react-dom"),r=e("./data"),y=e("./sui"),c=e("./core"),o=e("./cloudsync"),w=e("./auth"),l=e("./codecard"),d=e("./carousel"),a=e("./dialogs");class u extends w.Component{constructor(e){super(e),this.state={visible:!1},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.chgHeader=this.chgHeader.bind(this),this.chgGallery=this.chgGallery.bind(this),this.importProject=this.importProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.setSelected=this.setSelected.bind(this)}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.selectedCategory!=t.selectedCategory||this.state.selectedIndex!=t.selectedIndex}setSelected(e,t){null==t||this.state.selectedCategory==e&&this.state.selectedIndex==t?this.setState({selectedCategory:void 0,selectedIndex:void 0}):this.setState({selectedCategory:e,selectedIndex:t})}componentDidUpdate(e,t){this.state.selectedCategory!==t.selectedCategory&&this.ensureSelectedItemVisible()}ensureSelectedItemVisible(){var e=this.refs.activeCarousel;e&&(e=e.getCarouselDOM(),this.scrollElementIntoViewIfNeeded(e))}scrollElementIntoViewIfNeeded(e){var t=n.findDOMNode(this.refs.homeContainer),e=e.getBoundingClientRect().top;t.parentElement.scrollTop=t.parentElement.scrollTop+e-30}showLanguagePicker(){pxt.tickEvent("projects.langpicker"),this.props.parent.showLanguagePicker()}showAboutDialog(){a.showAboutDialogAsync(this.props.parent)}chgHeader(e){pxt.tickEvent("projects.header"),c.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).catch(e=>(c.warningNotification(lf("Sorry, we could not load this project.")),pxt.reportException(e),this.props.parent.openHome(),Promise.reject(e))).finally(()=>{c.hideLoading("changeheader")})}chgGallery(e,t){C(this.props.parent,0,e,t)}importProject(){pxt.tickEvent("projects.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showScriptManager(){pxt.tickEvent("projects.showall.header",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}renderCore(){const{selectedCategory:n,selectedIndex:r}=this.state,e=pxt.appTarget.appTheme,t=e["scriptManager"],i=this.getData("target-config:"),o=pxt.Util.userLanguage();let a={};i&&i.localizedGalleries&&i.localizedGalleries[o]&&pxt.Util.jsonCopyFrom(a,i.localizedGalleries[o]),i&&i.galleries&&pxt.Util.jsonCopyFrom(a,i.galleries);var s=y.cx(["ui segment bottom attached tab active tabsegment"]);return v.createElement("div",{ref:"homeContainer",className:s,role:"main"},v.createElement(h,{parent:this.props.parent}),v.createElement("h1",{className:"accessible-hidden"},lf("MakeCode Home")),v.createElement("div",{key:"mystuff_gallerysegment",className:"ui segment gallerysegment mystuff-segment",role:"region","aria-label":lf("My Projects")},v.createElement("div",{className:"ui heading"},v.createElement("div",{className:"column",style:{zIndex:1},role:t&&"button",onClick:t&&this.showScriptManager,onKeyDown:t&&y.fireClickOnEnter},t?v.createElement("h2",{className:"ui header myproject-header"},lf("My Projects"),v.createElement("span",{className:"view-all-button",tabIndex:0,title:lf("View all projects"),role:"button"},lf("View All"))):v.createElement("h2",{className:"ui header"},lf("My Projects"))),v.createElement("div",{className:"column right aligned",style:{zIndex:1}},pxt.appTarget.compile||pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?v.createElement(y.Button,{key:"import",icon:"upload",className:"import-dialog-btn",textClass:"landscape only",text:lf("Import"),title:lf("Import a project"),onClick:this.importProject}):void 0)),v.createElement("div",{className:"content"},v.createElement(f,{key:"mystuff_carousel",parent:this.props.parent,name:"recent",onClick:this.chgHeader}))),Object.keys(a).filter(e=>{var t,e=a[e];return"string"==typeof e||!((t=e.experimentName)&&!pxt.appTarget.appTheme[t]||(t=e.locales)&&t.indexOf(pxt.Util.userLanguage())<0||(t=e.testUrl||!!e.youTube&&"https://www.youtube.com/favicon.ico")&&!0!==this.getData("ping:"+t.replace("@random@",Math.random().toString())))}).map(e=>{var t=a[e],i="string"==typeof t?t:t.url,t="string"==typeof t?void 0:t.shuffle;return v.createElement("div",{key:e+"_gallerysegment",className:"ui segment gallerysegment",role:"region","aria-label":pxt.Util.rlf(e)},v.createElement("h2",{className:"ui header heading"},pxt.Util.rlf(e)," "),v.createElement("div",{className:"content"},v.createElement(f,{ref:n==e?"activeCarousel":"",key:e+"_carousel",parent:this.props.parent,name:e,path:i,onClick:this.chgGallery,setSelected:this.setSelected,shuffle:t,selectedIndex:n==e?r:void 0})))}),e.organizationUrl||e.organizationUrl||e.privacyUrl||e.copyrightText?v.createElement("div",{className:"ui horizontal small divided link list homefooter",role:"contentinfo"},e.organizationUrl&&e.organization?v.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},e.organization):void 0,e.selectLanguage?v.createElement(y.Link,{className:"item",icon:"xicon globe",text:lf("Language"),onClick:this.showLanguagePicker,onKeyDown:y.fireClickOnEnter,role:"button"}):void 0,e.termsOfUseUrl?v.createElement("a",{target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0,e.privacyUrl?v.createElement("a",{target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0,pxt.appTarget.versions?v.createElement(y.Link,{className:"item",text:"v"+pxt.appTarget.versions.target,onClick:this.showAboutDialog,onKeyDown:y.fireClickOnEnter,role:"button"}):void 0,e.copyrightText?v.createElement("div",{className:"ui item copyright"},e.copyrightText):void 0):void 0)}}i.Projects=u;class p extends r.Component{constructor(e){super(e),this.state={},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.signOutGithub=this.signOutGithub.bind(this)}showLanguagePicker(){pxt.tickEvent("home.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("home.togglecontrast",void 0,{interactiveConsent:!0}),c.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("home.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("home.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("home.reset",void 0,{interactiveConsent:!0}),this.props.parent.showResetDialog()}showReportAbuse(){pxt.tickEvent("home.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showAboutDialog(){pxt.tickEvent("home.about"),this.props.parent.showAboutDialog()}signOutGithub(){pxt.tickEvent("home.github.signout");var e=o.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),c.infoNotification(lf("Signed out from GitHub")))}renderCore(){var e=this.getData(w.HIGHCONTRAST),t=pxt.appTarget.appTheme,i=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,n=t.selectLanguage||t.highContrast;return v.createElement(y.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},t.selectLanguage&&v.createElement(y.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}),t.highContrast&&v.createElement(y.Item,{role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}),n&&v.createElement("div",{className:"ui divider"}),i?v.createElement(y.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,v.createElement(y.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),v.createElement(y.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),t.feedbackUrl?v.createElement("a",{className:"ui item",href:t.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0)}}i.ProjectSettingsMenu=p;class h extends r.Component{constructor(e){super(e),this.carouselTimeout=void 0,this.handleRefreshCard=e=>{var t;if(pxt.debug("next hero carousel"),null!=(t=this.prevGalleries)&&t.length){const t=this.state.cardIndex,i=e?this.prevGalleries.length-1:1;this.setState({cardIndex:(t+i)%this.prevGalleries.length})}this.scheduleRefresh()},this.handleSetCardIndex=e=>{this.clearRefresh(),this.setState({cardIndex:e,paused:!0})},this.onPointerDown=e=>{this.dragStartX=e.clientX},this.onTouchstart=e=>{var t;null!=(t=e.touches)&&t.length&&(this.dragStartX=e.touches[0].clientX)},this.onPointerUp=e=>{this.handleRelease(e.clientX,e)},this.onTouchEnd=e=>{var t;this.handleRelease(null==(t=null==(t=e.changedTouches)?void 0:t[0])?void 0:t.clientX,e)},this.onKeyDown=e=>{switch(c.keyCodeFromEvent(e)){case 37:this.handleRefreshCard(!0),e.stopPropagation();break;case 39:this.handleRefreshCard(),e.stopPropagation()}},this.handleCardClick=()=>{var e=void 0!==this.state.cardIndex&&this.prevGalleries[this.state.cardIndex];e&&(pxt.tickEvent("hero.card.click",{gallery:pxt.appTarget.appTheme.homeScreenHeroGallery,card:e.name,cardIndex:this.state.cardIndex}),C(this.props.parent,0,e))},this.scheduleRefresh=()=>{var e=this.state["paused"];e||(this.clearRefresh(),this.carouselTimeout=setTimeout(this.handleRefreshCard,9e3))},this.state={cardIndex:0}}handleRelease(e,t){void 0!==this.dragStartX&&void 0!==e&&(e=this.dragStartX-e,this.dragStartX=void 0,30<Math.abs(e))&&(t.stopPropagation(),t.preventDefault(),this.handleRefreshCard(e<0))}clearRefresh(){this.carouselTimeout&&(clearTimeout(this.carouselTimeout),this.carouselTimeout=void 0)}componentDidMount(){this.scheduleRefresh()}componentWillUnmount(){this.clearRefresh()}fetchGallery(){var e=pxt.appTarget.appTheme,t=e.homeScreenHeroGallery;let i,n;"string"==typeof e.homeScreenHero?n=e.homeScreenHero:e.homeScreenHero&&(i=e.homeScreenHero);e=e.homeScreenHero&&Object.assign(Object.assign({},null!=i?i:{}),{imageUrl:n||(null==i?void 0:i.imageUrl),description:(null==i?void 0:i.description)&&pxt.U.rlf(i.description),name:(null==i?void 0:i.name)&&pxt.U.rlf(i.name),buttonLabel:(null==i?void 0:i.buttonLabel)&&pxt.U.rlf(i.buttonLabel)});return this.prevGalleries||(this.prevGalleries=[],e&&this.prevGalleries.push(e)),!t||!(t=this.getData("gallery:"+encodeURIComponent(t)))||t instanceof Error||(this.prevGalleries=pxt.Util.concat(t.map(e=>e.cards)).slice(0,5),e&&this.prevGalleries.unshift(e),this.prevGalleries.forEach(e=>{var t=encodeURI(e.largeImageUrl||e.imageUrl);if(!h.fetchedImages[t]){const e=new Image;e.src=t,h.fetchedImages[t]=e}}),this.scheduleRefresh()),this.prevGalleries}renderCore(){const e=pxt.appTarget.appTheme,i=this.state["cardIndex"],t=!!e.homeScreenHeroGallery,n=this.fetchGallery(),r=n[i];if(!r)return null;const o=e=>()=>this.handleSetCardIndex(e),a=r.url,s=r.description||r.name,l=`url(${encodeURI(r.largeImageUrl||r.imageUrl)})`,c=r.buttonLabel||b(r.cardType,r.youTubeId,r.youTubePlaylistId),d=!!a||!!r.youTubeId||!!r.youTubePlaylistId;return v.createElement("div",{className:"ui segment getting-started-segment hero",style:{backgroundImage:l},onKeyDown:this.onKeyDown,onPointerDown:this.onPointerDown,onTouchStart:this.onTouchstart,onPointerUp:this.onPointerUp,onTouchEnd:this.onTouchEnd},(!!s||d||t)&&v.createElement("div",{className:"gradient-overlay"}),v.createElement("div",{className:"hero-banner-contents"},!!s&&v.createElement("div",{className:"description"},v.createElement("p",null,s)),d&&v.createElement("div",{className:"action"},E({url:a,youTubeId:r.youTubeId,youTubePlaylistId:r.youTubePlaylistId,scr:r},"large blue button",c,r.cardType,this.handleCardClick)),t&&v.createElement("div",{key:"cards",className:"dots"},n.map((e,t)=>v.createElement("button",{key:"dot"+t,className:"ui button empty circular label  clear "+(t===i&&"active"),onClick:o(t),"aria-label":lf("View {0} hero image",e.title||e.name),title:lf("View {0} hero image",e.title||e.name)})))))}}h.fetchedImages={};class f extends r.Component{constructor(e){super(e),this.prevGalleries=[],this.hasFetchErrors=!1,this.state={},this.closeDetail=this.closeDetail.bind(this),this.closeDetailOnEscape=this.closeDetailOnEscape.bind(this),this.reload=this.reload.bind(this),this.newProject=this.newProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.handleCardClick=this.handleCardClick.bind(this)}componentDidMount(){this.props.parent.state.header&&this.latestProject&&this.latestProject.element&&this.latestProject.element.focus()}fetchGallery(e){let i=this.getData("gallery:"+encodeURIComponent(e));if(i)if(i instanceof Error)this.hasFetchErrors=!0;else if(this.prevGalleries=pxt.Util.concat(i.map(e=>e.cards)),this.props.shuffle){const e=this.prevGalleries.pop(),i=(new Date).toDateString();this.prevGalleries.sort((e,t)=>ts.pxtc.Util.codalHash16(e.name+i)-ts.pxtc.Util.codalHash16(t.name+i)),e&&this.prevGalleries.push(e)}return this.prevGalleries||[]}fetchLocalData(){return this.getData("headers:")||[]}newProject(){pxt.tickEvent("projects.new",void 0,{interactiveConsent:!0}),pxt.appTarget.appTheme.nameProjectFirst||pxt.appTarget.appTheme.chooseLanguageRestrictionOnNewProject?this.props.parent.askForProjectCreationOptionsAsync().then(e=>{var{name:e,languageRestriction:t}=e;this.props.parent.newProject({name:e,languageRestriction:t})}):this.props.parent.newProject({})}showScriptManager(){pxt.tickEvent("projects.showscriptmanager",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}closeDetail(){var e=this.props["name"];pxt.tickEvent("projects.detail.close"),this.props.setSelected(e,void 0)}getCarouselDOM(){return n.findDOMNode(this.refs.carousel)}getDetailDOM(){return n.findDOMNode(this.refs.detailView)}closeDetailOnEscape(e){c.keyCodeFromEvent(e)==c.ESC_KEY&&(this.closeDetail(),document.removeEventListener("keydown",this.closeDetailOnEscape),e.preventDefault())}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&document.addEventListener("keydown",this.closeDetailOnEscape)}reload(){this.setState({})}handleCardClick(e,t,i){var n=this.props["name"];!this.props.setSelected||t&&t.directOpen?this.props.onClick(t):(pxt.tickEvent("projects.detail.open",{name:null==t?void 0:t.name,url:null==t?void 0:t.url,cardType:null==t?void 0:t.cardType,editor:null==t?void 0:t.editor},{interactiveConsent:!0}),this.props.setSelected(n,i))}renderCore(){const{path:i,selectedIndex:e}=this.props,t=pxt.appTarget.appTheme;if(i){this.hasFetchErrors=!1;const n=this.fetchGallery(i);if(this.hasFetchErrors)return v.createElement("div",{className:"ui carouselouter"},v.createElement("div",{role:"button",className:"carouselcontainer",tabIndex:0,onClick:this.reload},v.createElement("p",{className:"ui grey inverted segment"},lf("Oops, please connect to the Internet and try again."))));{const t=n[e],r=n.some(e=>e.tags&&0!=e.tags.length);return v.createElement("div",null,v.createElement(d.Carousel,{ref:"carousel",tickId:i,bleedPercent:20,selectedIndex:e},n.map((e,t)=>v.createElement(m,{className:"example",key:i+(e.youTubeId||e.name||e.url),name:e.name,url:e.url,imageUrl:e.imageUrl,youTubeId:e.youTubeId,youTubePlaylistId:e.youTubePlaylistId,buttonLabel:e.buttonLabel,label:e.label,labelClass:e.labelClass,tags:e.tags,scr:e,index:t,onCardClick:this.handleCardClick,cardType:e.cardType,tallCard:r,tutorialStep:e.tutorialStep,tutorialLength:e.tutorialLength}))),t&&v.createElement("div",{ref:"detailView",className:"detailview"},v.createElement(y.CloseButton,{onClick:this.closeDetail}),v.createElement(g,{parent:this.props.parent,name:t.name,key:"detail"+t.name,description:t.description,url:t.url,imageUrl:t.imageUrl,largeImageUrl:t.largeImageUrl,videoUrl:t.videoUrl,youTubeId:t.youTubeId,youTubePlaylistId:t.youTubePlaylistId,buttonLabel:t.buttonLabel,scr:t,onClick:this.props.onClick,cardType:t.cardType,tags:t.tags,otherActions:t.otherActions})))}}{const n=this.fetchLocalData(),i=pxt.appTarget.appTheme&&!pxt.appTarget.appTheme.hideNewProjectButton,e=t.scriptManager&&n.length>f.NUM_PROJECTS_HOMESCREEN,o=w.hasIdentity()&&!w.loggedIn()&&pxt.storage.getLocal(w.HAS_USED_CLOUD),a=n.filter(e=>{return!(null!=(e=null==(e=e.tutorial)?void 0:e.metadata)&&e.hideIteration)}).slice(0,f.NUM_PROJECTS_HOMESCREEN);return v.createElement(d.Carousel,{tickId:"myprojects",bleedPercent:20},i&&v.createElement("div",{role:"button",className:"ui card link buttoncard newprojectcard",title:lf("Creates a new empty project"),onClick:this.newProject,onKeyDown:y.fireClickOnEnter},v.createElement("div",{className:"content"},v.createElement(y.Icon,{icon:"huge add circle"}),v.createElement("span",{className:"header"},lf("New Project")))),o&&v.createElement("div",{role:"button",className:"ui card link buttoncard cloudprojectscard",title:lf("Sign in to see cloud projects"),onClick:e=>this.props.parent.showLoginDialog(),onKeyDown:y.fireClickOnEnter},v.createElement("div",{className:"content"},v.createElement(y.Icon,{icon:"huge xicon cloud-profile"}),v.createElement("span",{className:"header"},lf("Cloud Projects")))),a.map((e,t)=>{var i=e.tutorial?e.tutorial.tutorialStep:e.tutorialCompleted?e.tutorialCompleted.steps-1:void 0,n=e.tutorial?e.tutorial.tutorialStepInfo.length:e.tutorialCompleted?e.tutorialCompleted.steps:void 0,r=pxt.github.parseRepoId(e.githubId);return v.createElement(m,{key:"local"+e.id+e.recentUse,cardType:"file",name:r&&pxt.github.join(r.project,r.fileName)||e.name,time:e.modificationTime,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,onCardClick:this.handleCardClick,tutorialStep:i,tutorialLength:n,projectId:e.id})}),e&&v.createElement("div",{role:"button",className:"ui card link buttoncard scriptmanagercard",title:lf("See all projects"),onClick:this.showScriptManager,onKeyDown:y.fireClickOnEnter},v.createElement("div",{className:"content"},v.createElement(y.Icon,{icon:"huge right angle"}),v.createElement("span",{className:"header"},lf("See all projects")))))}}}(i.ProjectsCarousel=f).NUM_PROJECTS_HOMESCREEN=8;class m extends y.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleLabelClick=this.handleLabelClick.bind(this)}handleClick(e){this.props.onCardClick(e,this.props.scr,this.props.index,this.props.id)}handleLabelClick(e){this.props.onLabelClick(e,this.props.scr,this.props.index,this.props.id)}renderCore(){let e=this.props,{scr:t,onLabelClick:i,cardType:n,imageUrl:r,className:o}=e,a=s(e,["scr","onCardClick","onLabelClick","onClick","cardType","imageUrl","className"]);return o=o||"",t&&"file"==n&&(t.githubId?o="file github "+o:t.extensionUnderTest?o="file test "+o:t.board?(o="file board "+o,r=pxt.bundledSvg(t.board)):o=t.editor?"file "+t.editor:"file "+o),v.createElement(l.CodeCardView,Object.assign({role:"button",className:o,imageUrl:r,cardType:n},a,{onClick:this.handleClick,onLabelClicked:i?this.handleLabelClick:void 0}))}}i.ProjectsCodeCard=m;class g extends r.Component{constructor(e){super(e),this.state={},this.handleDetailClick=this.handleDetailClick.bind(this),this.handleOpenForumUrlInEditor=this.handleOpenForumUrlInEditor.bind(this),this.linkRef=v.createRef()}isLink(e){return k(this.props,e)}getUrl(){return x(this.props)}getClickLabel(e){var{youTubeId:t,youTubePlaylistId:i}=this.props;return b(e,t,i)}getActionEditor(e,t){switch(e){case"tutorial":case"example":return t&&t.editor?t.editor:"blocks";case"codeExample":return t&&t.editor?t.editor:"js";case"sharedExample":return null==t?void 0:t.editor;default:return null}}getActionIcon(e,t,i){var{youTubeId:n,youTubePlaylistId:r}=this.props;let o="file text";switch(t){case"tutorial":case"example":o=i?"xicon "+i:"xicon blocks";break;case"codeExample":o="xicon "+(i||"js");break;case"sharedExample":o=i?"xicon "+i:"pencil";break;case"forumUrl":o="comments";break;case"forumExample":o="pencil";break;default:(n||r)&&(o="youtube")}return this.isLink(t)&&"forumExample"!=t?v.createElement(y.Link,{role:"presentation",className:"link button attached",icon:o,href:this.getUrl(),target:"_blank",tabIndex:-1}):v.createElement(y.Item,{role:"presentation",className:"button attached",icon:o,onClick:e,tabIndex:-1})}getActionTitle(e){switch(e){case"py":return"Python";case"js":return"JavaScript";case"blocks":return lf("Blocks");default:return null}}getActionCard(e,t,i,n,r,o){var r=this.getActionEditor(t,r),a=this.getActionTitle(r);return v.createElement("div",{className:"card-action ui items "+(r||""),key:o},this.getActionIcon(i,t,r),a&&v.createElement("div",{className:"card-action-title"},a),E(this.props,"button attached approve large",e,t,i,n,a,this.linkRef))}handleDetailClick(){var{scr:e,onClick:t}=this.props;pxt.tickEvent("projects.actions.details",{name:e.name,url:e.url,cardType:e.cardType,editor:e.editor},{interactiveConsent:!0}),t(e)}handleActionClick(e){const{scr:t,onClick:i}=this.props;return pxt.tickEvent("projects.actions.click",{name:t.name,url:t.url,cardType:t.cardType,editor:t.editor},{interactiveConsent:!0}),()=>i(t,e)}handleOpenForumUrlInEditor(){pxt.tickEvent("projects.actions.forum",void 0,{interactiveConsent:!0});var e=this.props["url"];pxt.discourse.extractSharedIdFromPostUrl(e).then(e=>{e?window.location.hash="pub:"+e:c.warningNotification(lf("Oops, we could not find the program in the forum."))}).catch(c.handleNetworkError)}isYouTubeOnline(){var{youTubeId:e,youTubePlaylistId:t}=this.props;return(e||t)&&this.getData("ping:https://www.youtube.com/favicon.ico")}componentDidMount(){this.linkRef&&this.linkRef.current&&this.linkRef.current.focus()}renderCore(){const{name:e,description:t,largeImageUrl:i,videoUrl:n,youTubeId:r,youTubePlaylistId:o,buttonLabel:a,cardType:s,tags:l,otherActions:c}=this.props,d=this.getData(w.HIGHCONTRAST),u=pxt.appTarget.appTheme.tagColors||{},p=t&&t.split("\n"),h=!d&&(i||r&&`https://img.youtube.com/vi/${r}/0.jpg`),f=!d&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS()&&n,m=!pxt.appTarget.appTheme.hideHomeDetailsVideo,g=pxt.youtube.watchUrl(r,o);let b;return b=a?ts.pxtc.Util.rlf(a):this.getClickLabel(s),v.createElement("div",{className:"ui grid stackable padded"},m&&(f||h)&&v.createElement("div",{className:"imagewrapper"},f?v.createElement("video",{className:"video",src:f,autoPlay:!0,controls:!1,loop:!0,playsInline:!0}):v.createElement("div",{className:"image",style:{backgroundImage:`url("${h}")`}})),v.createElement("div",{className:"column six wide"},v.createElement("div",{className:"segment"},v.createElement("div",{className:"header"}," ",e," "),l&&v.createElement("div",{className:"ui labels"},l.map(e=>v.createElement("div",{className:`ui ${u[e]||""} label`},pxt.Util.rlf(e)))),p&&p.map((e,t)=>v.createElement("p",{key:"line"+t,className:"detail"},e)),!!s&&g&&this.isYouTubeOnline()&&v.createElement(y.Link,{href:g,target:"_blank",icon:"play",text:lf("Play Video Lesson"),className:"yt-button button attached approve large inverted",title:lf("Open YouTube video in new window")}))),v.createElement("div",{className:"actions column ten wide"},v.createElement("div",{className:"segment"},this.getActionCard(b,s,this.handleDetailClick,!0),c&&c.map((e,t)=>{var i=this.handleActionClick(e),n=e.cardType?this.getClickLabel(e.cardType):b;return this.getActionCard(n,e.cardType||s,i,!1,e,"action"+t)}),"forumUrl"===s&&(!c||0==c.length)&&!pxt.BrowserUtils.isPxtElectron()&&this.getActionCard(lf("Open in Editor"),"forumExample",this.handleOpenForumUrlInEditor))))}}function b(e,t,i){return"tutorial"==e?lf("Start Tutorial"):"codeExample"==e||"example"==e?lf("Open Example"):"forumUrl"==e?lf("Open in Forum"):"sharedExample"==e?lf("Open in Editor"):"template"==e?lf("New Project"):t?lf("Watch Video"):i?lf("Watch Playlist"):lf("Show Instructions")}function k(e,t){var{cardType:i,url:e,youTubeId:n,youTubePlaylistId:r}=e;return function(){switch(t||i){case"file":case"example":case"codeExample":case"sharedExample":case"tutorial":case"side":case"template":case"package":case"hw":return!1;default:return!0}}()&&(n||r||e)}function x(e){var{url:e,youTubeId:t,youTubePlaylistId:i}=e;return!t&&!i||e?/^https:\/\//i.test(e)||/^\//i.test(e)?e:"":pxt.youtube.watchUrl(t,i)}function E(e,t,i,n,r,o,a,s){n=k(e,n)&&"forumExample"!=n,a=n?lf("Open link in new window"):lf("Open in {0}",a||lf("Editor"));return n?v.createElement(y.Link,{href:x(e),refCallback:o?s:void 0,target:"_blank",text:i,className:t,title:a,ariaLabel:a,autoFocus:o}):v.createElement(y.Button,{text:i,className:t,onClick:r,onKeyDown:y.fireClickOnEnter,autoFocus:o,title:a,ariaLabel:a})}function C(o,e,t,i){let n=i&&i.editor||"blocks";"js"==n&&(n="ts");var r=(i||t).url,i=(null==i?void 0:i.cardType)||t.cardType,a=n+"prj";switch(pxt.tickEvent(e+".gallery",{name:t.name,cardType:i,editor:n}),i){case"template":const e=pxt.Util.clone(pxt.appTarget.blocksprj);e.config.dependencies={},l(t.name,r,!0,pxt.BLOCKS_PROJECT_NAME,e);break;case"example":l(t.name,r,!0,a);break;case"codeExample":l(t.name,r,!1,a);break;case"side":o.newEmptyProject(t.name,r);break;case"tutorial":o.startActivity({activity:"tutorial",path:r,title:t.name,editor:a});break;case"sharedExample":console.log("shared example");var s=pxt.github.normalizeRepoId(r)||pxt.Cloud.parseScriptId(r);s?window.location.hash="pub:"+s:c.errorNotification(lf("Sorry, the project url looks invalid."));break;case"link":window.open(/^https:\/\//i.test(r)||/^\//i.test(r)?r:"","_blank");break;default:const n=/^\/#tutorial:([a-z0A-Z0-9\-\/]+)$/.exec(r);n?o.startActivity({activity:"tutorial",path:n[1]}):t.youTubeId&&!r||/^https:\/\//i.test(r)||(r?/^\//i.test(r)||c.errorNotification(lf("Sorry, the project url looks invalid.")):o.newEmptyProject(t.name.toLowerCase()))}function l(e,t,i,n,r){o.startActivity({activity:"example",path:t,title:e,editor:n,importOptions:{path:t,name:e,loadBlocks:i,prj:r}})}}i.ProjectsDetail=g;class _ extends r.Component{constructor(e){super(e),this.state={visible:!1},this.close=this.close.bind(this),this.importHex=this.importHex.bind(this),this.importUrl=this.importUrl.bind(this),this.cloneGithub=this.cloneGithub.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(){this.setState({visible:!0})}importHex(){pxt.tickEvent("projects.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog()}importUrl(){pxt.tickEvent("projects.importurl",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportUrlDialog()}async cloneGithub(){pxt.tickEvent("github.projects.clone",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportGithubDialog()}renderCore(){var e=this.state["visible"],t=pxt.appTarget.appTheme,i=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),n=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),r=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,o=this.props.parent.createModalClasses("importdialog"),t=t.githubEditor&&!pxt.winrt.isWinRT()&&!pxt.BrowserUtils.isPxtElectron()&&(null==(t=null==(t=null==(t=pxt.appTarget)?void 0:t.cloud)?void 0:t.cloudProviders)?void 0:t.github),i=pxt.appTarget.compile&&!i&&!n,n=i?1:0,n=1===(n=n+(r?1:0)+(t?1:0))?"one":2==n?"two":"three";return v.createElement(y.Modal,{isOpen:e,className:o,size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Import"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},v.createElement("div",{className:`ui ${n} cards`},i&&v.createElement(l.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importHex}),r&&v.createElement(l.CodeCardView,{ariaLabel:lf("Open a shared project URL or GitHub repo"),role:"button",key:"importurl",icon:"cloud download",iconColor:"secondary",name:lf("Import URL..."),description:lf("Open a shared project URL or GitHub repo"),onClick:this.importUrl}),t&&v.createElement(l.CodeCardView,{ariaLabel:lf("Clone or create your own GitHub repository"),role:"button",key:"importgithub",icon:"github",iconColor:"secondary",name:lf("Your GitHub Repo..."),description:lf("Clone or create your own GitHub repository"),onClick:this.cloneGithub})))}}i.ImportDialog=_;class S extends r.Component{constructor(e){super(e),this.state={visible:!1,emoji:""},this.hide=this.hide.bind(this),this.handleChange=this.handleChange.bind(this),this.save=this.save.bind(this),this.skip=this.skip.bind(this)}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("exitandsave.show",void 0,{interactiveConsent:!1}),this.setState({projectName:this.props.parent.state.projectName,visible:!0})}handleChange(e){this.setState({projectName:e,emoji:A(e)})}skip(){pxt.tickEvent("exitandsave.skip",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.openHome()}save(){const e=this.state["projectName"];this.hide();let t=Promise.resolve();e&&this.props.parent.state.projectName!=e&&(pxt.tickEvent("exitandsave.projectrename",{length:e&&e.length},{interactiveConsent:!0}),t=t.then(()=>this.props.parent.updateHeaderNameAsync(e))),t.then(()=>{this.props.parent.openHome()})}renderCore(){var{visible:e,projectName:t}=this.state,i=pxt.BrowserUtils.isMobile(),n=[{label:lf("Save"),onclick:this.save,icon:"check",className:"approve positive"},{label:lf("Skip"),onclick:this.skip}],r=this.props.parent.createModalClasses("exitandsave"),o=lf("Give your project a name.");return v.createElement(y.Modal,{isOpen:e,className:r,size:"tiny",onClose:this.hide,dimmer:!0,buttons:n,closeIcon:!0,header:lf("Project has no name {0}",this.state.emoji),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},v.createElement("div",null,v.createElement("p",null,o),v.createElement("div",{className:"ui form"},v.createElement(y.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:o,autoComplete:!1,value:t||"",onChange:this.handleChange,onEnter:this.save,selectOnMount:!i,autoFocus:!i}))))}}i.ExitAndSaveDialog=S;class T extends r.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.show=()=>{pxt.tickEvent("newprojectdialog.show",void 0,{interactiveConsent:!1}),this.setState({name:"",emoji:"",visible:!0,languageRestriction:""})},this.handleTextChange=e=>{this.setState({name:e,emoji:A(e)})},this.handleLanguageChange=e=>{this.setState({languageRestriction:e})},this.save=()=>{var{name:e,languageRestriction:t}=this.state;this.hide(),this.createProjectCb&&this.createProjectCb({name:e,languageRestriction:t}),pxt.tickEvent("newprojectdialog.projectcreate",{language:t},{interactiveConsent:!0}),this.createProjectCb=null},this.onExpandedMenuHide=()=>{pxt.tickEvent("newprojectdialog.codeoptions.hide"),this.setState({languageRestriction:""})},this.onExpandedMenuShow=()=>{pxt.tickEvent("newprojectdialog.codeoptions.show")},this.state={visible:!1,emoji:"",languageRestriction:""}}promptUserAsync(){return this.show(),new Promise(e=>{this.createProjectCb=e})}renderCore(){var{visible:e,name:t,emoji:i}=this.state,{python:n,chooseLanguageRestrictionOnNewProject:r}=pxt.appTarget.appTheme,o=[{label:lf("Create"),onclick:this.save,icon:"check",className:"approve positive"}],a=pxt.BrowserUtils.isMobile(),n=[{value:"",display:n?lf("Blocks, {0}, and {1}","JavaScript","Python"):lf("Blocks and {0}","JavaScript")},n&&{value:"python-only",display:lf("{0} Only","Python")},{value:"javascript-only",display:lf("{0} Only","JavaScript")}],s=this.props.parent.createModalClasses("newproject"),l=lf("Give your project a name.");return v.createElement(y.Modal,{isOpen:e,className:s,size:"tiny",onClose:this.hide,dimmer:!0,buttons:o,closeIcon:!0,header:lf("Create a Project {0}",i),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},v.createElement("div",null,v.createElement("p",null,l),v.createElement("div",{className:"ui form"},v.createElement(y.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:l,autoComplete:!1,value:t||"",onChange:this.handleTextChange,onEnter:this.save,selectOnMount:!a,autoFocus:!a}))),r&&v.createElement("div",null,v.createElement("br",null),v.createElement(y.ExpandableMenu,{title:lf("Code options"),onShow:this.onExpandedMenuShow,onHide:this.onExpandedMenuHide},v.createElement(y.Select,{options:n,onChange:this.handleLanguageChange,"aria-label":lf("Select Language")}))))}}function A(e){const t=lf("Untitled");let i="";if(e&&-1===t.indexOf(e)){const t=["😌","😄","😃","😍"];i=t[Math.min(e.length,t.length)-1];var n=e.length>>1;if(n>t.length)for(let e=0;e<Math.min(2,n-t.length);++e)i+=t[t.length-1]}return i}i.NewProjectDialog=T;class N extends r.Component{constructor(e){super(e),this.prevGalleries=[],this.state={visible:!1,skipDownload:!1},this.close=this.close.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(e){this.setState({visible:!0,skipDownload:!!e})}fetchGallery(){var e=this.getData("gallery:"+encodeURIComponent("/hardware"));return!e||e instanceof Error||(this.prevGalleries=pxt.Util.concat(e.map(e=>e.cards)).filter(e=>!!e.variant)),this.prevGalleries||[]}setHwVariant(e,t){pxt.tickEvent("projects.choosehwvariant",{hwid:e.name,card:(t||e).name},{interactiveConsent:!0}),this.hide(),pxt.setHwVariant(e.name,t?t.name:e.description||e.name);let i=this.props.parent;i.reloadHeaderAsync().then(()=>!this.state.skipDownload&&i.compile())}renderCore(){const t=this.state["visible"];if(!t)return v.createElement("div",null);const e=pxt.getHwVariants();for(const t of e){t.card||(t.card={name:t.description});const e=t;t.card.onClick=()=>this.setHwVariant(e,null)}let i=this.fetchGallery();for(const t of i){const i=e.find(e=>e.name==t.variant),n=t;i?t.onClick=()=>this.setHwVariant(i,n):pxt.reportError("hw","invalid variant")}return i=i.filter(e=>!!e.onClick),v.createElement(y.Modal,{isOpen:t,className:"hardwaredialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Choose your hardware"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},v.createElement("div",{className:"group"},v.createElement("div",{className:"ui cards centered",role:"listbox"},i.map(e=>v.createElement(l.CodeCardView,{key:"card"+e.name,name:e.name,ariaLabel:e.name,description:e.description,imageUrl:e.imageUrl,learnMoreUrl:e.url,onClick:e.onClick})),e.map(e=>v.createElement(l.CodeCardView,{key:"variant"+e.name,name:e.card.name,ariaLabel:e.card.name,description:e.card.description,imageUrl:e.card.imageUrl,learnMoreUrl:e.card.learnMoreUrl,onClick:e.card.onClick})))),v.createElement("p",null,v.createElement("br",null),v.createElement("br",null),lf("No hardware? Or want to add some?")," ",v.createElement("a",{className:"small",href:"/hardware",target:"_blank",rel:"noopener noreferrer","aria-label":lf("Learn more about hardware")},lf("Learn more!"))))}}i.ChooseHwDialog=N},{"./auth":8,"./carousel":13,"./cloudsync":15,"./codecard":17,"./core":64,"./data":67,"./dialogs":74,"./sui":129,react:320,"react-dom":276}],110:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("react"),r=e("./package"),o=e("./srceditor"),a=e("./sui"),s=e("./core"),l=e("./data");var c=pxt.Util;class d extends o.Editor{constructor(e){super(e),this.parent=e,this.config={},this.changeMade=!1,this.handleNameInputRef=e=>{this.nameInput=e},this.saveOnClick=e=>{this.save()},this.editSettingsText=this.editSettingsText.bind(this),this.save=this.save.bind(this),this.setFileName=this.setFileName.bind(this),this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this),this.goBack=this.goBack.bind(this)}goBack(){pxt.tickEvent("pxtjson.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}prepare(){this.isReady=!0}getId(){return"pxtJsonEditor"}hasEditorToolbar(){return!1}save(e){const t=this.config;this.isSaving=!0,t.name?r.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME).setContentAsync(pxt.Package.stringifyConfig(t)).then(()=>{r.mainPkg.config.name=t.name,this.parent.setState({projectName:t.name}),this.parent.forceUpdate(),c.nextTick(this.changeCallback),this.isSaving=!1,this.changeMade=!0,e||this.parent.openPreviousEditor(),s.resetFocus()}):(s.errorNotification(lf("Please choose a project name. It can't be blank.")),this.isSaving=!1)}setFileName(e){this.config.name=e,this.parent.forceUpdate()}optionaldepConfig(){let t={};return r.mainPkg.sortedDeps().filter(e=>e.config&&e.config.yotta&&e.config.yotta.optionalConfig).forEach(e=>c.jsonMergeFrom(t,e.config.yotta.optionalConfig)),t}isUserConfigActive(e){let t=this.optionaldepConfig();this.config.yotta&&this.config.yotta.config&&c.jsonMergeFrom(t,this.config.yotta.config),t=c.jsonFlatten(t);const i=c.jsonFlatten(e.config);return!Object.keys(i).some(e=>null===i[e]?!!t[e]:t[e]!==i[e])}applyUserConfig(e){c.jsonFlatten(this.optionaldepConfig());const t=c.jsonFlatten(this.config.yotta?this.config.yotta.config:{}),i=c.jsonFlatten(e.config);this.isUserConfigActive(e)?Object.keys(i).forEach(e=>{delete t[e]}):Object.keys(i).forEach(e=>t[e]=i[e]),Object.keys(t).length?(this.config.yotta||(this.config.yotta={}),this.config.yotta.config=c.jsonUnFlatten(t)):this.config.yotta&&(delete this.config.yotta.config,Object.keys(this.config.yotta).length||delete this.config.yotta),this.save(!0)}display(){if(this.isVisible){var e=this.config;let t=[];return r.allEditorPkgs().map(e=>e.getKsPkg()).filter(e=>!!e&&e.isLoaded&&!!e.config&&!!e.config.yotta&&!!e.config.yotta.userConfigs).forEach(e=>t=t.concat(e.config.yotta.userConfigs)),n.createElement("div",{className:"ui content"},n.createElement("div",{className:"ui small header"},n.createElement("div",{className:"content"},n.createElement(a.Button,{autoFocus:!0,title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:a.fireClickOnEnter},n.createElement(a.Icon,{icon:"arrow left"}),n.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),n.createElement("div",{className:"ui segment form text"},n.createElement(a.Input,{ref:this.handleNameInputRef,id:"fileNameInput",label:lf("Name"),ariaLabel:lf("Type a name for your project"),value:e.name||"",onChange:this.setFileName,autoComplete:!1}),t.map(e=>n.createElement(u,{key:"userconfig-"+e.description,uc:e,isUserConfigActive:this.isUserConfigActive,applyUserConfig:this.applyUserConfig})),n.createElement(a.Field,null,n.createElement(a.Button,{text:lf("Save"),className:"green "+(this.isSaving?"disabled":""),onClick:this.saveOnClick}),n.createElement(a.Button,{text:lf("Edit Settings As text"),onClick:this.editSettingsText}))))}}isIncomplete(){return!this.changeMade}editSettingsText(){this.changeMade=!1,this.parent.editText()}getCurrentSource(){return pxt.Package.stringifyConfig(this.config)}acceptsFile(e){if(e.name!=pxt.CONFIG_NAME)return!1;if(e.isReadonly())return!1;try{return JSON.parse(e.content),!0}catch(e){return!1}}loadFileAsync(e){return this.config=JSON.parse(e.content),this.nameInput&&this.nameInput.clearValue(),this.setDiagnostics(e,this.snapshotState()),this.changeMade=!1,Promise.resolve()}unloadFileAsync(){var e;return!this.changeMade||null!=(e=this.parent.state)&&e.home?Promise.resolve():this.parent.reloadHeaderAsync()}}i.Editor=d;class u extends l.Component{constructor(e){super(e),this.state={},this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this)}isUserConfigActive(){var{isUserConfigActive:e,uc:t}=this.props;return e(t)}applyUserConfig(){var{applyUserConfig:e,uc:t}=this.props;e(t)}renderCore(){var e=this.props["uc"],t=this.isUserConfigActive();return n.createElement(a.Checkbox,{key:"userconfig-"+e.description,inputLabel:pxt.Util.rlf(e.description),checked:t,onChange:this.applyUserConfig})}}},{"./core":64,"./data":67,"./package":108,"./srceditor":128,"./sui":129,react:320}],111:[function(e,t,i){"use strict";let n;Object.defineProperty(i,"__esModule",{value:!0}),i.renderAsync=void 0,i.renderAsync=function(i){return(n=n||pxt.BrowserUtils.loadScriptAsync("qrcode/qrcode.min.js").then(()=>"undefined"!=typeof qrcode).catch(e=>!1)).then(t=>{if(t){t=qrcode(0,"L");let e=/^(https.*\/)([0-9-]+)$/.exec(i);return e?(t.addData(e[1].toUpperCase(),"Alphanumeric"),t.addData(e[2].replace(/-/g,""),"Numeric")):(e=/^(https.*\/)(_[a-zA-Z0-9]+)$/.exec(i))?(t.addData(e[1].toUpperCase(),"Alphanumeric"),t.addData(e[2],"Byte")):t.addData(i,"Byte"),t.make(),t.createDataURL(5,5)}}).catch(e=>{pxt.reportException(e)})}},{}],112:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.loadGifEncoderAsync=i.GifEncoder=i.encodeBlobAsync=i.saveAsync=void 0;const n=e("./workspace"),r=e("./data");function o(e,t){let i=0,n=0,r=0,o=0;t.height>t.width?(i=0,o=(r=t.width)/e.width*e.height,n=(t.height-o)/2):(n=0,r=(o=t.height)/e.height*e.width,i=(t.width-r)/2),e.getContext("2d").drawImage(t,i,n,r,o,0,0,e.width,e.height)}function a(){return pxt.BrowserUtils.loadImageAsync(pxt.appTarget.appTheme.logo).then(e=>{var t=document.createElement("canvas"),i=(t.width=160,t.height=120,t.getContext("2d")),n=pxt.appTarget.appTheme.accentColor;return n&&(i.fillStyle=n,i.fillRect(0,0,t.width,t.height)),o(t,e),t}).catch(()=>{return(e=document.createElement("canvas")).width=160,e.height=120,(t=e.getContext("2d")).fillStyle="#33b",t.fillRect(0,0,160,120),t.font="30px monospace",t.fillStyle="#fff",t.fillText(":(",60,70),Promise.resolve(e);var e,t})}i.saveAsync=function(t,i){return pxt.BrowserUtils.loadImageAsync(i).then(e=>{e=function(e){let t=null;var i;return e&&0<e.width&&0<e.height&&((i=document.createElement("canvas")).width=305,i.height=200,o(i,e),t=i.toDataURL("image/jpeg",85)),t}(e);return n.saveScreenshotAsync(t,i,e).then(()=>{r.invalidateHeader("header",t)})})},i.encodeBlobAsync=function(s,e,t){return(e?pxt.BrowserUtils.loadCanvasAsync(e):a()).catch(()=>a()).then(e=>{var t=e,i=s,e=t.width,n=t.height,r=document.createElement("canvas"),o=(r.width=e+16+16,r.height=n+16+16+32,r.getContext("2d")),a=(o.imageSmoothingEnabled=!1,o.fillStyle="white",o.fillRect(0,0,r.width,r.height),o.drawImage(t,16,16),pxt.appTarget.thumbnailName||pxt.appTarget.name);if(a){const t=12;o.fillStyle="black",o.font="10px monospace",o.fillText(a,16,12,e-16)}if(i){const t=32+n+4;o.fillStyle="black",o.font="13px monospace",o.fillText(i,16,t,e-16)}{const t=32+n+4+16,i=(o.fillStyle="#444",o.font="10px monospace",pxt.appTarget.appTheme.homeUrl.replace(/^https:\/\//,"").replace(/\/$/,""));o.fillText(i,16,t,e)}return r}).then(e=>pxt.Util.encodeBlobAsync(e,t).toDataURL("image/png"))};class s{constructor(e){this.options=e,this.scale=1,this.cancellationToken=new pxt.Util.CancellationToken,this.options.maxFrames||(this.options.maxFrames=64),e.scale&&(this.scale=e.scale)}start(){pxt.debug("gif: start encoder"),this.gif=new GIF(this.options),this.time=-1,this.cancellationToken=new pxt.Util.CancellationToken,this.cancellationToken.startOperation(),this.renderPromise=void 0}cancel(){if(pxt.debug("gif: cancel"),!this.cancellationToken.isCancelled()){if(this.cancellationToken.cancel(),this.gif&&this.gif.running)try{this.gif.abort()}catch(e){}this.clean()}}clean(){this.gif&&this.gif.freeWorkers&&(this.gif.freeWorkers.forEach(e=>e.terminate()),this.gif.freeWorkers=[]),this.gif=void 0,this.time=-1}addFrame(e,t){var i;return!this.cancellationToken.isCancelled()&&!this.renderPromise&&(i=pxt.Util.now(),this.time<0&&(this.time=i),void 0===t&&(t=i-this.time),1!=this.scale&&(e=pxt.BrowserUtils.scaleImageData(e,this.scale)),pxt.debug(`gif: frame ${t}ms`),this.gif.addFrame(e,{delay:t}),this.time=i,this.gif.frames.length>this.options.maxFrames)}renderAsync(){if(this.cancellationToken.isCancelled())return Promise.resolve(void 0);const i=()=>this.renderGifAsync().then(e=>{var t;return this.cancellationToken.throwIfCancelled(),this.options.maxLength&&e.length>this.options.maxLength?(t=Math.floor(this.gif.frames.length*this.options.maxLength/e.length)-1,pxt.log(`gif: size too large (${e.length/1e3|0}kb) reducing frames to `+t),t<=0?void pxt.log("gif: simulator image too large, cannot have a single frame"):(this.gif.frames=this.gif.frames.slice(0,t),i())):(pxt.log(`gif: rendered ${this.gif.frames.length} frames to ${e.length/1e3|0}kb`),e)});return pxt.debug(`gif: render ${this.gif.frames.length} frames`),this.renderPromise||(this.renderPromise=i().finally(()=>this.clean()).catch(e=>{pxt.debug("rendering failed"),pxt.debug(e)})),this.renderPromise}renderGifAsync(){return this.cancellationToken.throwIfCancelled(),new Promise((t,e)=>{this.gif.on("finished",e=>{this.gif.running=!1,t(e)}),this.gif.on("abort",()=>{pxt.debug("gif: abort"),t(void 0)}),this.gif.render()}).then(e=>ts.pxtc.Util.blobReadAsDataURL(e))}}i.GifEncoder=s,i.loadGifEncoderAsync=function(){if(!pxt.webConfig.gifworkerjs)return Promise.resolve(void 0);const e={workers:1,dither:!1,workerScript:pxt.webConfig.gifworkerjs,quality:pxt.appTarget.appTheme.simGifQuality||16,transparent:pxt.appTarget.appTheme.simGifTransparent,maxFrames:pxt.appTarget.appTheme.simGifMaxFrames||64,maxLength:pxt.appTarget.appTheme.simScreenshotMaxUriLength||3e5,scale:2};return pxt.BrowserUtils.loadScriptAsync("gifjs/gif.js").then(()=>new s(e))}},{"./data":67,"./workspace":136}],113:[function(e,t,i){"use strict";var r=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptManagerDialog=void 0;const f=e("react"),o=e("./data"),m=e("./sui"),a=e("./core"),s=e("./workspace"),n=e("./compiler"),g=e("./components/searchInput"),b=e("./projects");class l extends o.Component{constructor(e){super(e),this.handleKeyDown=e=>{var t=a.keyCodeFromEvent(e);(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey)&&65===t&&this.handleSelectAll(e)},this.handleAreaClick=()=>{this.setState({selected:{}})},this.handleSelectAll=e=>{let i=this.state["selected"];var t=this.getSortedHeaders();0<t.length&&t.length==Object.keys(i).length?i={}:t.forEach((e,t)=>{i[this.getId(e)]=1}),this.setState({selected:i}),e.stopPropagation(),e.preventDefault()},this.toggleSortName=e=>{var{sortedBy:t,sortedAsc:i}=this.state;this.setState({sortedBy:"name",sortedAsc:!("name"==t&&!e&&i)})},this.toggleSortTime=e=>{var{sortedAsc:t,sortedBy:i}=this.state;this.setState({sortedBy:"time",sortedAsc:"time"==i&&!e&&!t})},this.handleSortName=e=>{e.stopPropagation(),this.toggleSortName(!0)},this.handleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!0)},this.handleToggleSortName=e=>{e.stopPropagation(),this.toggleSortName(!1)},this.handleToggleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!1)},this.handleSwitchSortDirection=e=>{e.stopPropagation();e=this.state.sortedAsc;this.setState({sortedAsc:!e})},this.state={visible:!1,selected:{},markedNew:{},view:"grid",sortedBy:"time",sortedAsc:!1},this.close=this.close.bind(this),this.handleCardClick=this.handleCardClick.bind(this),this.handleDelete=this.handleDelete.bind(this),this.handleOpen=this.handleOpen.bind(this),this.handleOpenNewTab=this.handleOpenNewTab.bind(this),this.handleOpenNewLinkedTab=this.handleOpenNewLinkedTab.bind(this),this.handleDuplicate=this.handleDuplicate.bind(this),this.handleSwitchView=this.handleSwitchView.bind(this),this.handleSearch=this.handleSearch.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}hide(){this.setState({visible:!1,searchFor:void 0})}close(){this.setState({visible:!1,searchFor:void 0}),this.props.onClose&&this.props.onClose()}show(){this.setState({visible:!0}),n.projectSearchClear()}fetchLocalData(){return this.getData("headers:"+(this.state.searchFor||""))}handleCardClick(t,e,i,n,r){var o=t.shiftKey,r=r&&!o||(pxt.BrowserUtils.isMac()?t.metaKey:t.ctrlKey);let{selected:a,multiSelect:s,multiSelectStart:l}=this.state;if(!o||!r){if(r)a[n]?delete a[n]:a[n]=1,a[n]&&(l=i);else if(o){const t=this.getSortedHeaders();a={};for(let e=Math.min(i,l);e<=Math.max(i,l);e++)a[this.getId(t[e])]=1;s=!0}else s&&(a={},s=!1);o||r||(1==Object.keys(a).length&&a[n]?delete a[n]:((a={})[n]=1,l=i)),this.setState({selected:a,multiSelect:s,multiSelectStart:l}),t.stopPropagation(),t.preventDefault()}}handleCheckboxClick(e,t,i,n){this.handleCardClick(e,t,i,n,!0),e.preventDefault(),e.stopPropagation()}handleDelete(){let n=this.state["selected"];const e=this.getSortedHeaders(),t=Object.keys(n).length;a.confirmDelete(1==t?e.find(e=>Object.keys(n)[0].includes(e.id)).name:t.toString(),()=>{const i=[];return e.forEach((e,t)=>{n[this.getId(e)]&&(e.isDeleted=!0,i.push(s.forceSaveAsync(e,{})))}),this.setState({selected:{}}),Promise.all(i).then(()=>{o.clearCache()})},1<t)}handleOpen(){pxt.tickEvent("scriptmanager.open",void 0,{interactiveConsent:!0});var e=this.getSelectedHeader();a.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).then(()=>{a.hideLoading("changeheader")})}handleOpenNewTab(){pxt.tickEvent("scriptmanager.newtab",void 0,{interactiveConsent:!0});var e=this.getSelectedHeader();this.props.parent.openNewTab(e,!1)}handleOpenNewLinkedTab(){pxt.tickEvent("scriptmanager.newlinkedtab",void 0,{interactiveConsent:!0});var e=this.getSelectedHeader();this.props.parent.openNewTab(e,!0)}handleDuplicate(){pxt.tickEvent("scriptmanager.dup",void 0,{interactiveConsent:!0});const i=this.getSelectedHeader(),e={header:lf("Choose a new name for your project"),agreeLbl:lf("Duplicate"),agreeClass:"green approve positive",agreeIcon:"clone",initialValue:s.createDuplicateName(i),placeholder:lf("Enter your project name here"),size:"tiny"};return a.promptAsync(e).then(e=>{if(null===e)return!1;let t;return s.duplicateAsync(i,e).then(e=>(t=this.getId(e),s.saveAsync(e))).then(()=>(o.invalidate("headers:"+this.state.searchFor),this.setState({selected:{},markedNew:{[t]:1},sortedBy:"time",sortedAsc:!1}),setTimeout(()=>{this.setState({markedNew:{}})},5e3),!0))})}handleSwitchView(){var e="grid"==this.state.view?"list":"grid";this.setState({view:e})}handleSearch(e){this.setState({searchFor:e,selected:{}})}getSelectedHeader(){var e=this.state["selected"];if(1!==Object.keys(e).length)return null;const t=Object.keys(e)[0];return this.fetchLocalData().find(e=>t.includes(e.id))}getSortedHeaders(){var{sortedBy:e,sortedAsc:t}=this.state;return(this.fetchLocalData()||[]).filter(e=>{return!(null!=(e=null==(e=e.tutorial)?void 0:e.metadata)&&e.hideIteration)}).sort(this.getSortingFunction(e,t))}getSortingFunction(i,n){return(e,t)=>"time"===i?n?e.modificationTime-t.modificationTime:t.modificationTime-e.modificationTime:n?e.name.localeCompare(t.name):t.name.localeCompare(e.name)}getId(e){return"local"+e.id+e.recentUse}renderCore(){const{visible:e,selected:l,markedNew:c,view:t,searchFor:i,sortedBy:n,sortedAsc:r}=this.state;if(!e)return f.createElement("div",null);const d="dark"==pxt.appTarget.appTheme.baseTheme;let o=this.getSortedHeaders()||[];o=o.filter(e=>!e.isDeleted);var a=!!i||0<o.length,s=0<o.length&&o.length==Object.keys(l).length,u=pxt.appTarget.appTheme.openProjectNewTab&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&!pxt.BrowserUtils.isIOS(),p=u&&pxt.appTarget.appTheme.openProjectNewDependentTab&&!/nestededitorsim=1/.test(window.location.href);let h;if(a){if((h=[]).push(f.createElement(g.SearchInput,{key:"search",ariaMessage:lf("{0} result matching '{1}'",o.length,i),placeholder:lf("Search..."),className:"mobile hide",searchHandler:this.handleSearch,disabled:!1,style:{flexGrow:1},searchOnChange:!0})),0<Object.keys(l).length){if(1==Object.keys(l).length){const e=f.createElement(m.Button,{key:"edit",icon:"edit outline",className:"icon",text:lf("Open"),textClass:"landscape only",title:lf("Open Project"),onClick:this.handleOpen});u?h.push(f.createElement("div",{className:"ui buttons"},e,f.createElement(m.DropdownMenu,{className:"floating button",icon:"dropdown"},f.createElement(m.Item,{key:"editnewtab",icon:"external alternate",className:"icon",text:lf("New Tab"),title:lf("Open Project in a new tab"),onClick:this.handleOpenNewTab}),p&&f.createElement(m.Item,{key:"editnewlinkedtab",icon:"external alternate",className:"icon",text:lf("New Connected Tab"),title:lf("Open Project in a new tab with a connected simulator"),onClick:this.handleOpenNewLinkedTab})))):h.push(e),h.push(f.createElement(m.Button,{key:"clone",icon:"clone outline",className:"icon",text:lf("Duplicate"),textClass:"landscape only",title:lf("Duplicate Project"),onClick:this.handleDuplicate}))}h.push(f.createElement(m.Button,{key:"delete",icon:"trash",className:"icon red",text:lf("Delete"),textClass:"landscape only",title:lf("Delete Project"),onClick:this.handleDelete})),h.push(f.createElement("div",{key:"divider",className:"divider"}))}h.push(f.createElement(m.Button,{key:"view",icon:"grid"==t?"th list":"grid layout",className:"icon",title:""+("grid"==t?lf("List view"):lf("Grid view")),onClick:this.handleSwitchView}))}return f.createElement(m.Modal,{isOpen:e,className:"scriptmanager",size:"fullscreen",onClose:this.close,dimmer:!0,header:lf("My Projects"),closeIcon:!0,headerActions:h,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},a?void 0:f.createElement("div",{className:"empty-content"},f.createElement("h2",{className:"ui center aligned header "+(d?"inverted":"")},f.createElement("div",{className:"content"},lf("It's empty in here"),f.createElement("div",{className:"sub header"},lf("Go back to create a new project"))))),a&&"grid"==t?f.createElement("div",{role:"button",className:"ui container fluid",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},f.createElement("div",{className:"sort-by"},f.createElement("div",{role:"menu",className:"ui compact buttons"},f.createElement(m.DropdownMenu,{role:"menuitem",text:"time"==n?lf("Last Modified"):lf("Name"),title:lf("Sort by dropdown"),className:"inline button "+(d?"inverted":""),displayLeft:!0},f.createElement(m.Item,{role:"menuitem",icon:"name"==n?"check":void 0,className:`${"name"!=n?"no-icon":""} `+(d?"inverted":""),text:lf("Name"),tabIndex:-1,onClick:this.handleSortName}),f.createElement(m.Item,{role:"menuitem",icon:"time"==n?"check":void 0,className:`${"time"!=n?"no-icon":""} `+(d?"inverted":""),text:lf("Last Modified"),tabIndex:-1,onClick:this.handleSortTime})),f.createElement(m.Button,{role:"menuitem",icon:"arrow "+(r?"up":"down"),className:d?"inverted":"",onClick:this.handleSwitchSortDirection,title:lf("Switch sort order to {0}",r?lf("descending"):lf("ascending"))}))),f.createElement("div",{className:"ui cards"},o.sort(this.getSortingFunction(n,r)).map((e,t)=>{var i=this.getId(e),n=!!c[i],r=!!l[i],o=n&&!r;let a=`circle outline ${r?"check":""} ${r?"green":"grey"} `+(d?"inverted":"");o&&(a=void 0);var s=o?"orange right ribbon label":"right corner label large selected-label",o=o?lf("New"):void 0;return f.createElement(b.ProjectsCodeCard,{key:i,id:i,cardType:"file",className:"file "+(n?"warning":r?"positive":""),name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,labelIcon:a,labelClass:s,label:o,onCardClick:this.handleCardClick,onLabelClick:this.handleCheckboxClick,projectId:e.id})}))):void 0,a&&"list"==t?f.createElement("div",{role:"table",className:"ui container",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},f.createElement("table",{className:"ui definition unstackable table "+(d?"inverted":"")},f.createElement("thead",{className:"full-width"},f.createElement("tr",null,f.createElement("th",{onClick:this.handleSelectAll,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:s?lf("De-select all projects"):lf("Select all projects"),style:{cursor:"pointer"}},f.createElement(m.Icon,{icon:"circle outline large "+(s?"check":"")})),f.createElement("th",{onClick:this.handleToggleSortName,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:lf("Sort by Name {0}",r?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Name")," ","name"==n?f.createElement(m.Icon,{icon:"arrow "+(r?"up":"down")}):void 0),f.createElement("th",{onClick:this.handleToggleSortTime,tabIndex:0,onKeyDown:m.fireClickOnEnter,title:lf("Sort by Last Modified {0}",r?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Last Modified")," ","time"==n?f.createElement(m.Icon,{icon:"arrow "+(r?"up":"down")}):void 0))),f.createElement("tbody",null,o.sort(this.getSortingFunction(n,r)).map((e,t)=>{var i=this.getId(e),n=!!c[i],r=!!l[i],n=n&&!r;return f.createElement(v,{key:i,id:i,selected:r,onRowClicked:this.handleCardClick,index:t,scr:e,markedNew:n},f.createElement("td",null,e.name),f.createElement("td",null,pxt.Util.timeSince(e.recentUse)))})))):void 0)}}i.ScriptManagerDialog=l;class v extends m.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}handleClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index)}handleCheckboxClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id,!0),e.preventDefault(),e.stopPropagation()}renderCore(){var e=this.props,{selected:t,markedNew:i,children:n}=e,e=r(e,["scr","onRowClicked","onClick","selected","markedNew","children"]);return f.createElement("tr",Object.assign({tabIndex:0},e,{onKeyDown:m.fireClickOnEnter,onClick:this.handleClick,style:{cursor:"pointer"},className:i?"warning":t?"positive":""}),f.createElement("td",{className:"collapsing",onClick:this.handleCheckboxClick},f.createElement(m.Icon,{icon:"circle outline large "+(t?"check green":i?"black":"")})),n)}}},{"./compiler":18,"./components/searchInput":59,"./core":64,"./data":67,"./projects":109,"./sui":129,"./workspace":136,react:320}],114:[function(e,t,i){"use strict";var x,n=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptSearch=i.ScriptSearchMode=void 0;const E=e("react"),r=e("react-dom"),C=e("./data"),_=e("./sui"),o=e("./package"),a=e("./core"),S=e("./codecard"),s=e("./electron"),l=e("./workspace"),T=e("./components/searchInput");(e=x=i.ScriptSearchMode||(i.ScriptSearchMode={}))[e.Extensions=0]="Extensions",e[e.Boards=1]="Boards",e[e.Experiments=2]="Experiments";class c extends C.Component{constructor(e){super(e),this.state={searchFor:"",visible:!1,mode:x.Extensions,closeIcon:!0},this.hide=this.hide.bind(this),this.handleSearch=this.handleSearch.bind(this),this.addUrl=this.addUrl.bind(this),this.addBundle=this.addBundle.bind(this),this.installGh=this.installGh.bind(this),this.addLocal=this.addLocal.bind(this),this.toggleExperiment=this.toggleExperiment.bind(this),this.importExtensionFile=this.importExtensionFile.bind(this),this.backOnHide=this.backOnHide.bind(this)}hide(e,t){this.setState({visible:!1}),!0===t&&this.props.parent.openPreviousEditor(),this.state.mode==x.Experiments&&this.state.experimentsState!==pxt.editor.experiments.state()&&this.props.parent.reloadEditor()}afterHide(){var e=this.state.resolve;e&&(this.setState({resolve:void 0}),e())}showExtensions(e){this.setState({visible:!0,defaultSearch:e||"",searchFor:e||"",mode:x.Extensions,closeIcon:!0,features:void 0,resolve:void 0})}showBoardsAsync(i,n){return new Promise((e,t)=>{this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:x.Boards,closeIcon:!!n,features:i,resolve:e})})}showExperiments(){this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:x.Experiments,closeIcon:!0,experimentsState:pxt.editor.experiments.state(),features:void 0,resolve:void 0})}fetchUrlData(){var e,t={data:[],status:C.FetchStatus.Complete};return this.state.searchFor&&this.state.mode==x.Extensions&&(e=pxt.Cloud.parseScriptId(this.state.searchFor))?((!(e=this.getDataWithStatus("cloud-search:"+e)).data||e.data&&404===e.data.statusCode)&&(e.data=[]),Array.isArray(e.data)||(e.data=[e.data]),e):t}fetchGhData(){const e={data:[],status:C.FetchStatus.Complete};if(this.state.mode!=x.Extensions)return e;const t=pxt.appTarget.cloud||{};if(!t.packages)return e;let i=t.githubPackages?this.state.searchFor:void 0;if(!i){const e=this.getDataWithStatus("target-config:"),t=e.data;e.status===C.FetchStatus.Complete&&t&&t.packages&&t.packages.preferredRepos&&(i=t.packages.preferredRepos.join("|"))}var n;return i?((n=this.getDataWithStatus("gh-search:"+i)).data&&404!==n.data.statusCode||(n.data=[]),n):e}fetchLocalRepositories(){if(this.state.mode!=x.Extensions)return[];let t=this.state.searchFor;const i=this.props.parent.state["header"];let e=l.getHeaders();return/localdependencies=1/i.test(window.location.href)||(e=e.filter(e=>!!e.githubId)),i&&(e=e.filter(e=>e.id!=i.id)),t&&(t=t.toLocaleLowerCase(),e=e.filter(e=>-1<e.name.toLocaleLowerCase().indexOf(t))),e}fetchBundled(){if(this.state.mode!=x.Boards&&this.state.mode!=x.Extensions)return[];const t=this.state.searchFor,i=pxt.appTarget.bundledpkgs,n=this.state.mode==x.Boards,e=this.state.features;return Object.keys(i).filter(e=>!/prj$/.test(e)).map(e=>JSON.parse(i[e]["pxt.json"])).filter(e=>!e.hidden).filter(e=>!(!t&&e.searchOnly)).filter(e=>!t||-1<e.name.toLowerCase().indexOf(t.toLowerCase())).filter(e=>n||!o.mainPkg.deps[e.name]||o.mainPkg.deps[e.name].cppOnly).filter(e=>!/---/.test(e.name)).filter(e=>n==!!e.core).filter(t=>!e||e.every(e=>t.features&&-1<t.features.indexOf(e)))}fetchExperiments(){return this.state.mode!=x.Experiments?[]:pxt.editor.experiments.all()}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.mode!=t.mode}componentDidUpdate(){var e=r.findDOMNode(this.refs.searchInput);e&&e.focus()}handleSearch(e){var t=/^\/@(.*)$/.exec(e);let i=t&&t[1];if(i)if("devtools"===i&&pxt.BrowserUtils.isPxtElectron())s.openDevTools(),this.hide(),this.afterHide();else{let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),i=i.replace(/^\//,""),pxt.winrt.releaseAllDevicesAsync().then(()=>{window.location.href=e+i})}else this.setState({searchFor:e})}addUrl(e){return this.hide(null,this.backOnHide()),o.mainEditorPkg().setDependencyAsync(e.name,"pub:"+e.id).then(()=>this.props.parent.reloadHeaderAsync()).finally(()=>this.afterHide())}addBundle(e){pxt.tickEvent("packages.bundled",{name:e.name}),this.hide(null,this.backOnHide()),this.addDepIfNoConflict(e,"*").finally(()=>this.afterHide())}addLocal(t){pxt.tickEvent("packages.local"),this.hide(null,this.backOnHide()),l.getTextAsync(t.id).then(e=>{e=JSON.parse(e[pxt.CONFIG_NAME]);return this.addDepIfNoConflict(e,"workspace:"+t.id)}).finally(()=>this.afterHide())}async installGh(e){let t;pxt.tickEvent("packages.github",{name:e.fullName}),this.hide(null,this.backOnHide());try{a.showLoading("downloadingpackage",lf("downloading extension...")),t=await pxt.github.downloadLatestPackageAsync(e)}catch(e){a.handleNetworkError(e)}finally{a.hideLoading("downloadingpackage")}return this.addDepIfNoConflict(t.config,t.version)}async addDepIfNoConflict(e,t){try{this.hide(null,this.backOnHide()),a.showLoading("installingextension",lf("installing extension...")),await o.mainEditorPkg().addDependencyAsync(e,t,this.state.mode==x.Boards)&&this.props.parent.reloadHeaderAsync()}finally{a.hideLoading("installingextension"),this.afterHide()}}toggleExperiment(e){pxt.editor.experiments.toggle(e),pxt.tickEvent("experiments.toggle",{experiment:e.id,enabled:pxt.editor.experiments.isEnabled(e)?1:0},{interactiveConsent:!0}),this.forceUpdate()}importExtensionFile(){pxt.tickEvent("extensions.import",void 0,{interactiveConsent:!0}),this.hide(null,this.backOnHide()),this.props.parent.showImportFileDialog({extension:!0})}backOnHide(){return this.props.parent.isPxtJsonEditor()}renderCore(){var{mode:e,closeIcon:t,visible:i,searchFor:n,experimentsState:r,defaultSearch:o}=this.state;if(!i)return E.createElement("div",null);var a=this.fetchBundled(),s=this.fetchGhData(),l=this.fetchUrlData(),c=this.fetchLocalRepositories(),d=this.fetchExperiments(),u=n&&(s.status===C.FetchStatus.Pending||l.status===C.FetchStatus.Pending),p=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),h=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),p=e==x.Extensions&&pxt.appTarget.appTheme.importExtensionFiles&&!p&&!h&&!n,h=window.location.href.replace(/\/(#|$|\?)/,"/beta$1"),f=e==x.Experiments&&h!=window.location.href;a.sort((e,t)=>{var i,n;return e.core!=t.core?e.core?-1:1:(i=pxt.isPkgBeta(e))!=pxt.isPkgBeta(t)?i?1:-1:(i=void 0===e.weight?50:e.weight)!=(n=void 0===t.weight?50:t.weight)?-i+n:pxt.Util.strcmp(e.name,t.name)});const m=e==x.Boards?lf("Boards"):e==x.Experiments?lf("Experiments"):lf("Extensions"),g=e==x.Boards?lf("Change development board"):e==x.Experiments?lf("Turn on and off experimental features"):lf("Add an extension to the project"),b=e==x.Boards?"/boards":e==x.Experiments?"/experiments":"/extensions",v=e==x.Experiments&&r!=pxt.editor.experiments.state(),y=this.props.parent.createModalClasses("searchdialog"),w=e=>e.name.replace(/^pxt-/,""),k=lf("Search or enter project URL...");return E.createElement(_.Modal,{isOpen:i,dimmer:!0,className:y,size:"fullscreen",onClose:this.hide,closeIcon:t,header:m,helpUrl:b,closeOnDimmerClick:!0,closeOnEscape:!0,description:g},E.createElement("div",{className:"ui"},e==x.Experiments?E.createElement("div",{className:"ui message info"},E.createElement("div",{className:"header"},lf("WARNING: EXPERIMENTAL FEATURES AHEAD!")),lf("Try out these features and tell us what you think!")):void 0,e==x.Extensions?E.createElement(T.SearchInput,{key:"search",defaultValue:o,ariaMessage:lf("{0} result matching '{1}'",a.length+s.data.length+l.data.length,n),placeholder:k,"aria-label":k,searchHandler:this.handleSearch,inputClassName:"fluid",autoFocus:!0,disabled:u}):void 0,u?E.createElement("div",{className:"ui medium active centered inline loader"}):E.createElement("div",{className:"ui cards centered","aria-label":lf("Extension search results")},l.data.map(e=>E.createElement(A,{key:"url"+e.id,name:e.name,description:e.description,url:"/"+e.id,scr:e,onCardClick:this.addUrl,role:"button"})),c.map(e=>E.createElement(A,{key:"local"+e.id,name:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),url:"https://github.com/"+e.githubId,imageUrl:e.icon,scr:e,onCardClick:this.addLocal,label:lf("Local"),title:lf("Local GitHub extension"),labelClass:"blue right ribbon",role:"button"})),a.map(e=>E.createElement(A,{key:"bundled"+e.name,name:e.name,description:e.description,imageUrl:e.icon,scr:e,onCardClick:this.addBundle,label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button"})),s.data.filter(e=>e.status==pxt.github.GitRepoStatus.Approved).map(e=>E.createElement(A,{name:w(e),description:e.description,key:"gha"+e.fullName,scr:e,onCardClick:this.installGh,url:"github:"+e.fullName,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button",learnMoreUrl:"/pkg/"+e.fullName})),s.data.filter(e=>e.status!=pxt.github.GitRepoStatus.Approved).map(e=>E.createElement(A,{name:w(e),description:e.description||"",extracontent:lf("User-provided extension, not endorsed by Microsoft."),key:"ghd"+e.fullName,scr:e,onCardClick:this.installGh,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,url:"github:"+e.fullName,role:"button",learnMoreUrl:"/pkg/"+e.fullName})),d.map(e=>E.createElement(A,{name:e.name,scr:e,imageUrl:`/static/experiments/${e.id.toLowerCase()}.png`,description:e.description,key:"exp"+e.id,role:"button",label:pxt.editor.experiments.isEnabled(e)?lf("Enabled"):lf("Disabled"),labelClass:pxt.editor.experiments.isEnabled(e)?"green right ribbon":"grey right ribbon",onCardClick:this.toggleExperiment,feedbackUrl:e.feedbackUrl})),p&&E.createElement(S.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload ui cardimage",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importExtensionFile}),f&&E.createElement(S.CodeCardView,{ariaLabel:lf("Open the next version of the editor"),role:"button",key:"beta",icon:"lab ui cardimage",iconColor:"secondary",name:lf("Beta Editor"),label:lf("Beta"),labelClass:"red right ribbon",description:lf("Open the next version of the editor"),url:h})),n&&!u&&a.length+s.data.length+l.data.length===0?E.createElement("div",{className:"ui items"},E.createElement("div",{className:"ui item"},lf("We couldn't find any extensions matching '{0}'",n))):void 0),v?E.createElement("div",{className:"ui warning message"},E.createElement("div",{className:"header"},lf("Experiments changed")),lf("The editor will reload when leaving this page.")):void 0)}}i.ScriptSearch=c;class A extends _.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){var{scr:e,onCardClick:t}=this.props;t(e)}renderCore(){var e=this.props,{}=e,e=n(e,["onCardClick","onClick","scr"]);return E.createElement(S.CodeCardView,Object.assign({},e,{onClick:this.handleClick}))}}},{"./codecard":17,"./components/searchInput":59,"./core":64,"./data":67,"./electron":77,"./package":108,"./sui":129,"./workspace":136,react:320,"react-dom":276}],115:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ResourceImporter=i.StartPauseButton=i.Editor=void 0;const n=e("react"),o=e("smoothie"),r=e("./core"),a=e("./srceditor"),s=e("./sui"),l=e("./data");var c=pxt.Util;class d extends a.Editor{constructor(e){super(e),this.parent=e,this.savedMessageQueue=[],this.maxSavedMessages=1e3,this.charts=[],this.chartIdx=0,this.sourceMap={},this.serialInputDataBuffer="",this.maxSerialInputDataLength=255,this.isSim=!0,this.maxConsoleEntries=500,this.active=!0,this.rawDataBuffer="",this.maxBufferLength=1e4,this.csvHeaders=[],this.highContrast=!1,this.handleStartPauseRef=e=>{this.startPauseButton=e},this.handleChartRootRef=e=>{this.chartRoot=e},this.handleConsoleRootRef=e=>{this.consoleRoot=e},window.addEventListener("message",this.processEvent.bind(this),!1);e=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme;this.lineColors=e&&e.lineColors||["#e00","#00e","#0e0"],this.hcLineColors=["#000"],this.currentLineColors=this.lineColors,this.goBack=this.goBack.bind(this),this.toggleRecording=this.toggleRecording.bind(this),this.downloadRaw=this.downloadRaw.bind(this),this.downloadCSV=this.downloadCSV.bind(this)}getId(){return"serialEditor"}hasHistory(){return!1}hasEditorToolbar(){return!1}setVisible(e){var t=r.getHighContrastOnce();t!==this.highContrast&&this.setHighContrast(t),this.isVisible=e,this.isVisible?(this.processQueuedMessages(),this.startRecording()):(this.pauseRecording(),this.clear())}setHighContrast(e){e!==this.highContrast&&(this.highContrast=e,this.currentLineColors=e?this.hcLineColors:this.lineColors,this.clear())}acceptsFile(e){return e.name===pxt.SERIAL_EDITOR_FILE}setSim(e){this.isSim!=e&&(this.isSim=e,this.clear())}simStateChanged(){this.charts.forEach(e=>e.setRealtimeData(this.wantRealtimeData()))}wantRealtimeData(){return!this.isSim||this.parent.isSimulatorRunning()}saveMessageForLater(e){this.savedMessageQueue.push(e),this.savedMessageQueue.length>this.maxSavedMessages&&this.savedMessageQueue.shift()}processQueuedMessages(){this.savedMessageQueue.forEach(e=>this.processMessage(e)),this.savedMessageQueue=[]}processEvent(e){let t=e.data;"serial"===t.type?this.processEventCore(t):"bulkserial"===t.type&&t.data.forEach(e=>{this.processEventCore({type:"serial",data:e.data,receivedTime:e.time,sim:t.sim,id:t.id})})}processEventCore(e){e.receivedTime=e.receivedTime||c.now(),this.active?this.processMessage(e):this.saveMessageForLater(e)}mapSource(e){var t;return this.sourceMap[e]||(t=Object.keys(this.sourceMap).length+1,this.sourceMap[e]=lf("source")+t.toString()),this.sourceMap[e]}processMessage(e){if(!!e.sim==this.isSim){var t=e.data||"",i=e.id||"?",n=e.receivedTime||c.now(),r=(this.appendRawData(t),this.mapSource(i));for(const e of this.chunkDataIntoLines(t))this.processMessageLine(e,r,n)}}processMessageLine(e,i,n){if(/^\s*\{[^}]+\}\s*$/.test(e))try{const i=JSON.parse(e),r=parseInt(i.t),o=this.mapSource(i.s),a=i.n||"",s=parseFloat(i.v);isNaN(r)||isNaN(s)||this.appendGraphEntry(o,a,s,n)}catch(e){}else if(/^\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)(\s*,\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?))+\s*,?\s*$/.test(e))e.split(/\s*,\s*/).map(e=>parseFloat(e)).filter(e=>!isNaN(e)).forEach((e,t)=>{t="data."+(this.csvHeaders[t]||t);this.appendGraphEntry(i,t,e,n)});else if(/^\s*[\s\w]+(\s*,\s*[\w\s]+)+\s*,?\s*$/.test(e))this.csvHeaders=e.split(/\s*,\s*/).map(e=>e.trim());else{var t=/^\s*(([^:]+):)?\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)/i.exec(e);if(t){const e=t[2]||"",l=parseFloat(t[3]);isNaN(l)||this.appendGraphEntry(i,e,l,n)}}this.appendConsoleEntry(e)}appendRawData(e){this.rawDataBuffer+=e,this.rawDataBuffer.length>this.maxBufferLength&&this.rawDataBuffer.slice(this.rawDataBuffer.length/4)}appendGraphEntry(t,i,e,n){let r=this.charts.find(e=>e.shouldContain(t,i));r||((r=new p(t,i,this.chartIdx,this.currentLineColors)).setRealtimeData(this.wantRealtimeData()),this.chartIdx++,this.charts.push(r),this.chartRoot.appendChild(r.getElement()),pxt.BrowserUtils.removeClass(this.chartRoot,"nochart"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"nochart"),1==this.charts.length&&this.parent.forceUpdate()),r.addPoint(i,e,n)}chunkDataIntoLines(t){var i=[];for(let e=0;e<t.length;++e){var n=t[e];this.serialInputDataBuffer+=n,"\n"!==n&&this.serialInputDataBuffer.length<this.maxSerialInputDataLength||("\n"===n&&(this.serialInputDataBuffer=this.serialInputDataBuffer.replace(/\s+$/,""),!this.serialInputDataBuffer.length)||i.push(this.serialInputDataBuffer),this.serialInputDataBuffer="")}return i}appendConsoleEntry(e){var t,i,n;for(e.length>=this.maxSerialInputDataLength?((t=document.createElement("span")).appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)):(t=this.consoleRoot.lastChild,i=document.createElement("div"),t&&t.lastChild.textContent==e?2==t.childNodes.length?(n=parseInt(t.firstChild.textContent),t.firstChild.textContent=(n+1).toString()):((n=document.createElement("a")).className="ui horizontal label",n.textContent="2",t.insertBefore(n,t.lastChild)):(i.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(i))),this.consoleRoot.scrollTop=this.consoleRoot.scrollHeight;this.consoleRoot.childElementCount>this.maxConsoleEntries;)this.consoleRoot.removeChild(this.consoleRoot.firstChild);this.consoleRoot&&0<this.consoleRoot.childElementCount&&(this.chartRoot&&pxt.BrowserUtils.removeClass(this.chartRoot,"noconsole"),this.consoleRoot)&&pxt.BrowserUtils.removeClass(this.consoleRoot,"noconsole")}pauseRecording(){this.active=!1,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach(e=>e.stop())}startRecording(){this.active=!0,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach(e=>e.start())}toggleRecording(){pxt.tickEvent("serial.toggleRecording",void 0,{interactiveConsent:!0}),this.active?this.pauseRecording():this.startRecording()}clearNode(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}clear(){this.chartRoot&&(this.clearNode(this.chartRoot),pxt.BrowserUtils.addClass(this.chartRoot,"noconsole"),pxt.BrowserUtils.addClass(this.chartRoot,"nochart")),this.consoleRoot&&(this.clearNode(this.consoleRoot),pxt.BrowserUtils.addClass(this.consoleRoot,"noconsole"),pxt.BrowserUtils.addClass(this.consoleRoot,"nochart")),this.charts=[],this.serialInputDataBuffer="",this.rawDataBuffer="",this.savedMessageQueue=[],this.sourceMap={},this.csvHeaders=[]}isCSV(i,n){if(n.length<2)return!1;for(let e=0;e<n.length;++e)if(n[e].length!=i)return!1;for(let t=0;t<i;++t){var r=n[0][t][0];for(let e=1;e<n.length;++e)if(n[e][t][0]!=r)return!1}return!0}downloadCSV(){const o=lf("{id:csvseparator}\t");let a=[];var e,t;this.charts.length&&this.charts.some(e=>0<Object.keys(e.datas).length)?(this.charts.forEach(t=>{const i=[];Object.keys(t.datas).forEach(e=>i.push({name:e,line:t.datas[e]}));var e=i.map(e=>e.line),n=0<e.length?e.map(e=>e.length).reduce((e,t)=>Math.max(e,t)):0;if(this.isCSV(n,e)){var r=`time (${t.source})`+o+i.map(e=>e.name).join(o)+o;a[0]=a[0]?a[0]+o+r:r;for(let t=0;t<n;++t){const i=(e[0][t][0]-e[0][0][0])/1e3+o+e.map(e=>e[t][1]).join(o)+o;a[t+1]=a[t+1]?a[t+1]+o+i:i}}else{r=i.map(e=>`time (${t.source})`+o+e.name).join(o);a[0]=a[0]?a[0]+o+r:r;for(let t=0;t<n;++t){const i=e.map(e=>t<e.length?""+(e[t][0]-e[0][0])/1e3+o+e[t][1]:o).join(o);a[t+1]=a[t+1]?a[t+1]+o+i:i}}}),a.unshift("sep="+o),e=a.join("\r\n"),r.infoNotification(lf("Exporting data....")),t=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,""),pxt.commands.browserDownloadAsync(c.toUTF8(e),pxt.appTarget.id+"-"+lf("{id:csvfilename}data")+"-"+t+".csv","text/csv")):r.confirmAsync({header:lf("No data to export"),hideAgree:!0,disagreeLbl:lf("Ok"),body:lf("You must generate some serial data before you can export it.")})}downloadRaw(){r.infoNotification(lf("Exporting text...."));var e=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,"");let t=this.rawDataBuffer;pxt.BrowserUtils.isWindows()&&(t=t.replace(/[^\r]\n/g,"\r\n")),pxt.commands.browserDownloadAsync(c.toUTF8(t),pxt.appTarget.id+"-"+lf("{id:csvfilename}console")+"-"+e+".txt","text/plain")}goBack(){pxt.tickEvent("serial.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}display(){var e;return n.createElement("div",{id:"serialArea"},n.createElement("div",{id:"serialHeader",className:"ui serialHeader"},n.createElement("div",{className:"leftHeaderWrapper"},n.createElement("div",{className:"leftHeader"},n.createElement(s.Button,{title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:s.fireClickOnEnter},n.createElement(s.Icon,{icon:"arrow left"}),n.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),n.createElement("div",{className:"rightHeader"},n.createElement(s.Button,{title:lf("Copy text"),className:"ui icon button editorExport",ariaLabel:lf("Copy text"),onClick:this.downloadRaw},n.createElement(s.Icon,{icon:"copy"})),n.createElement(s.Button,{title:lf("Export data"),className:"ui icon blue button editorExport",ariaLabel:lf("Export data"),onClick:this.downloadCSV},n.createElement(s.Icon,{icon:"download"})),n.createElement(u,{ref:this.handleStartPauseRef,active:this.active,toggle:this.toggleRecording}),n.createElement("span",{className:"ui small header"},this.isSim?lf("Simulator"):lf("Device")))),0==(null==(e=this.charts)?void 0:e.length)&&n.createElement("div",{id:"serialPlaceholder",className:"ui segment"},n.createElement("div",{className:"ui bottom left attached no-select label seriallabel"},lf("Values will be logged when the {0} sends data",this.isSim?lf("simulator"):lf("device")))),n.createElement("div",{id:"serialCharts",ref:this.handleChartRootRef}),n.createElement("div",{id:"serialConsole",ref:this.handleConsoleRootRef}))}domUpdate(){}}i.Editor=d;class u extends l.PureComponent{constructor(e){super(e),this.state={active:this.props.active}}renderCore(){var e=this.props["toggle"],t=this.state["active"];return n.createElement(s.Button,{title:t?lf("Pause recording"):lf("Start recording"),className:`ui left floated icon button ${t?"green":"red circular"} toggleRecord`,onClick:e},n.createElement(s.Icon,{icon:t?"pause icon":"circle icon"}))}}i.StartPauseButton=u;class p{constructor(e,t,i,n){this.rootElement=document.createElement("div"),this.lines={},this.datas={};var r=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme,r={interpolation:"bezier",labels:{disabled:!1,fillStyle:"black",fontSize:14},responsive:!0,millisPerPixel:20,grid:{verticalSections:0,borderVisible:!1,millisPerLine:5e3,fillStyle:r&&r.gridFillStyle||"transparent",strokeStyle:r&&r.gridStrokeStyle||"#fff"},tooltip:!0,tooltipFormatter:(e,t)=>this.tooltip(e,t)};this.lineColors=n,this.chartIdx=i,this.chart=new o.SmoothieChart(r),this.rootElement.className="ui segment",this.source=e,this.variable=t.replace(/\..*$/,""),this.rootElement.appendChild(this.makeLabel()),this.rootElement.appendChild(this.makeCanvas())}tooltip(e,t){return t.map(e=>{var t=e.series.timeSeries.__name;return`<span>${t?t+": ":""}${e.value}</span>`}).join("<br/>")}getLine(e){let t=this.lines[e];var i;return t||(i=this.lineColors[this.chartIdx++%this.lineColors.length],this.lines[e]=t=new o.TimeSeries,t.__name=c.htmlEscape(e.substring(this.variable.length+1)),this.chart.addTimeSeries(t,{strokeStyle:i,lineWidth:3}),this.datas[e]=[]),t}makeLabel(){return this.label=document.createElement("div"),this.label.className="ui orange bottom left attached no-select label seriallabel",this.label.innerText=this.variable||"...",this.label}makeCanvas(){var e=document.createElement("canvas");return this.chart.streamTo(e),this.canvas=e}getCanvas(){return this.canvas}getElement(){return this.rootElement}shouldContain(e,t){return this.source==e&&this.variable==t.replace(/\..*$/,"")}addPoint(e,t,i){if(this.getLine(e).append(i,t),1==Object.keys(this.lines).length){const e=pxsim.Math_.roundWithPrecision(t,2).toString();this.label.innerText=this.variable?this.variable+": "+e:e}else this.label.innerText=this.variable||"";e=this.datas[e];e.push([i,t]),4e3<e.length&&e.splice(0,e.length/4)}start(){this.chart.start()}stop(){this.chart.stop()}setRealtimeData(e){this.chart.options.nonRealtimeData=!e}}i.ResourceImporter=class{canImport(e){return"text/plain"==e.type}importAsync(e,n){return ts.pxtc.Util.fileReadAsTextAsync(n).then(t=>{if(t){t=t.split(/\n/g).map(e=>{var t=/^\s*(\d+)>/.exec(e);return{type:"serial",data:(e=t?e.substr(t[0].length):e)+"\n",id:n.name,receivedTime:t?parseFloat(t[1]):void 0}});if(t.length){const i=c.now(),e=t.filter(e=>!!e.receivedTime);if(e.length){const t=e[e.length-1].receivedTime||0;e.forEach(e=>e.receivedTime+=i-t)}t.forEach(e=>window.postMessage(e,"*"))}}else r.errorNotification(lf("Ooops, could not read file"))})}}},{"./core":64,"./data":67,"./srceditor":128,"./sui":129,react:320,smoothie:362}],116:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SerialIndicator=void 0;const n=e("react"),r=e("./sui"),o=e("./data");class a extends o.Component{constructor(e){super(e),this.state={active:!1}}componentDidMount(){window.addEventListener("message",this.setActive.bind(this))}componentWillUnmount(){window.addEventListener("message",this.setActive.bind(this))}setActive(e){e=e.data;if(!this.state.active&&("serial"===e.type||"bulkserial"===e.type)&&!!e.sim===this.props.isSim){this.setState({active:!0});const e=this.props.parent;this.props.isSim?e.setState({simSerialActive:!0}):e.setState({deviceSerialActive:!0})}}active(){return!!this.state.active}clear(){this.setState({active:!1})}renderCore(){return this.active()?n.createElement("div",{role:"button",title:lf("Open console"),className:"ui label circular",tabIndex:0,onClick:this.props.onClick,onKeyDown:r.fireClickOnEnter},n.createElement("div",{className:"detail"},n.createElement("img",{alt:lf("Animated bar chart"),className:"barcharticon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/Bars_black.gif")})),n.createElement("span",null,lf("Show console")),n.createElement("div",{className:"detail"},this.props.isSim?lf("Simulator"):lf("Device"))):n.createElement("div",null)}}i.SerialIndicator=a},{"./data":67,"./sui":129,react:320}],117:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ShareEditor=i.ShareRecordingState=i.ShareMode=void 0;const G=e("react"),n=e("./data"),V=e("./sui"),r=e("./simulator"),o=e("./screenshot"),W=e("./qr");var $,K;(e=$=i.ShareMode||(i.ShareMode={}))[e.Code=0]="Code",e[e.Url=1]="Url",e[e.Editor=2]="Editor",e[e.Simulator=3]="Simulator",(e=K=i.ShareRecordingState||(i.ShareRecordingState={}))[e.None=0]="None",e[e.ScreenshotSnap=1]="ScreenshotSnap",e[e.GifLoading=2]="GifLoading",e[e.GifRecording=3]="GifRecording",e[e.GifRendering=4]="GifRendering";class a extends n.Component{constructor(e){super(e),this.screenshotAsync=()=>this.props.parent.requestScreenshotAsync().then(e=>{var t={recordingState:K.None,recordError:void 0};e?t.screenshotUri=e:t.recordError=lf("Oops, screenshot failed. Please try again."),this.setState(t)}),this.handleKeyDown=e=>{var t=this.state["visible"],i=pxt.appTarget.appTheme,e=e.key.toLocaleLowerCase();!t||document.activeElement&&"INPUT"===document.activeElement.tagName||(i.simScreenshotKey&&e===i.simScreenshotKey.toLocaleLowerCase()?this.handleScreenshotClick():i.simGifKey&&e===i.simGifKey.toLocaleLowerCase()&&this.handleRecordClick())},this.state={pubId:void 0,visible:!1,screenshotUri:void 0,recordingState:K.None,recordError:void 0,title:void 0},this.hide=this.hide.bind(this),this.setAdvancedMode=this.setAdvancedMode.bind(this),this.handleProjectNameChange=this.handleProjectNameChange.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.handleRecordClick=this.handleRecordClick.bind(this),this.handleScreenshotClick=this.handleScreenshotClick.bind(this),this.handleScreenshotMessage=this.handleScreenshotMessage.bind(this),this.handleCreateGitHubRepository=this.handleCreateGitHubRepository.bind(this),this.handleQrCodeClick=this.handleQrCodeClick.bind(this)}hide(){var e;this.state.qrCodeExpanded?(pxt.tickEvent("share.qrtoggle"),e=this.state["qrCodeExpanded"],this.setState({qrCodeExpanded:!e})):(this._gifEncoder&&(this._gifEncoder.cancel(),this._gifEncoder=void 0),this.loanedSimulator&&(r.driver.unloanSimulator(),this.loanedSimulator=void 0,this.props.parent.popScreenshotHandler(),r.driver.stopRecording()),this.setState({visible:!1,screenshotUri:void 0,projectName:void 0,projectNameChanged:!1,recordingState:K.None,recordError:void 0,qrCodeUri:void 0,title:void 0}))}show(e){var t,i=this.props.parent.state["header"];i&&((t=pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails&&(pxt.appTarget.appTheme.simScreenshot||pxt.appTarget.appTheme.simGif))&&(this.loanedSimulator=r.driver.loanSimulator(),this.props.parent.pushScreenshotHandler(this.handleScreenshotMessage)),this.setState({thumbnails:t,visible:!0,mode:$.Code,pubId:void 0,sharingError:void 0,screenshotUri:void 0,qrCodeUri:void 0,qrCodeExpanded:!1,title:e,projectName:i.name},t?()=>this.props.parent.startSimulator():void 0))}handleScreenshotMessage(e){var t=this.state["visible"];e&&t&&("start"!==e.event?"stop"!=e.event?this.state.recordingState==K.GifRecording?this._gifEncoder.addFrame(e.data,e.delay)&&this.gifRender():this.state.recordingState==K.ScreenshotSnap||this.state.recordingState===K.None?this.setState({screenshotUri:pxt.BrowserUtils.imageDataToPNG(e.data),recordingState:K.None,recordError:void 0}):r.driver.stopRecording():this.state.recordingState===K.GifRecording&&this.gifRender():this.state.recordingState===K.None&&this.gifRecord())}UNSAFE_componentWillReceiveProps(e){var t={};this.state.projectNameChanged||e.parent.state.projectName==this.state.projectName||(t.projectName=e.parent.state.projectName),e.loading!=this.state.loading&&(t.loading=e.loading),0<Object.keys(t).length&&this.setState(t)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.mode!=t.mode||this.state.pubId!=t.pubId||this.state.sharingError!==t.sharingError||this.state.projectName!=t.projectName||this.state.projectNameChanged!=t.projectNameChanged||this.state.loading!=t.loading||this.state.recordingState!=t.recordingState||this.state.screenshotUri!=t.screenshotUri||this.state.qrCodeUri!=t.qrCodeUri||this.state.qrCodeExpanded!=t.qrCodeExpanded||this.state.title!=t.title}setAdvancedMode(e){this.setState({mode:e})}handleProjectNameChange(e){this.setState({projectName:e,projectNameChanged:!0})}restartSimulator(){pxt.tickEvent("share.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}handleQrCodeClick(e){pxt.tickEvent("share.qrtoggle"),e.stopPropagation();e=this.state.qrCodeExpanded;this.setState({qrCodeExpanded:!e})}handleScreenshotClick(){pxt.tickEvent("share.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==K.None&&this.setState({recordingState:K.ScreenshotSnap,recordError:void 0},()=>this.screenshotAsync())}handleRecordClick(){switch(this.state.recordingState){case K.None:this.gifRecord();break;case K.GifRecording:this.gifRender()}}loadEncoderAsync(){return this._gifEncoder?Promise.resolve(this._gifEncoder):o.loadGifEncoderAsync().then(e=>this._gifEncoder=e)}gifRecord(){pxt.tickEvent("share.gifrecord",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==K.None&&this.setState({recordingState:K.GifLoading,screenshotUri:void 0},()=>this.loadEncoderAsync().then(e=>{if(e){e.start();const t=pxt.appTarget.appTheme.simGifWidth||160;this.setState({recordingState:K.GifRecording},()=>r.driver.startRecording(t))}else this.setState({recordingState:K.None,recordError:lf("Oops, gif encoder could not load. Please try again.")})}).catch(e=>{pxt.reportException(e),this.setState({recordingState:K.None,recordError:lf("Oops, gif recording failed. Please try again.")}),this._gifEncoder&&this._gifEncoder.cancel()}))}gifRender(){pxt.debug("render gif"),r.driver.stopRecording(),this._gifEncoder&&this.setState({recordingState:K.GifRendering,recordError:void 0},()=>{this.props.parent.stopSimulator(),this._gifEncoder.renderAsync().then(e=>{pxt.log(`gif: ${e?e.length:0} chars`);var t=pxt.appTarget.appTheme.simScreenshotMaxUriLength;let i;e&&(t&&e.length>t?(pxt.tickEvent("gif.toobig",{size:e.length}),e=void 0,i=lf("Gif is too big, try recording a shorter time.")):pxt.tickEvent("gif.ok",{size:e.length})),this.setState({recordingState:K.None,screenshotUri:e,recordError:i}),pxt.Util.delay(1e3).then(()=>this.props.parent.startSimulator())})})}handleCreateGitHubRepository(){pxt.tickEvent("share.github.create",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.createGitHubRepositoryAsync()}renderCore(){const{visible:e,projectName:t,loading:i,recordingState:n,screenshotUri:r,thumbnails:o,recordError:a,pubId:s,qrCodeUri:l,qrCodeExpanded:c,title:d,sharingError:u}=this.state,p=pxt.appTarget.appTheme,h=this.props.parent.state.header,f=!!p.hideShareEmbed||c,m=p.socialOptions,g=!!m&&!pxt.BrowserUtils.isUwpEdge()&&!c,b=!!s;let v=this.state.mode,y="",w="",k=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/",x=(/\/$/.test(k)||(k+="/"),pxt.appTarget.appTheme.embedUrl);/\/$/.test(x)||(x+="/");var E=pxt.webConfig.verprefix||"";if(h&&b){y=""+k+s;var C=""+x+E+"#pub:"+s;switch(v){case $.Code:w=pxt.docs.codeEmbedUrl(""+x+E,s);break;case $.Editor:w=pxt.docs.embedUrl(""+x+E,"pub",s);break;case $.Simulator:let e="81.97%",t=E+"---run";pxt.webConfig.runUrl&&(t=pxt.webConfig.isStatic?pxt.webConfig.runUrl:pxt.webConfig.runUrl.replace(pxt.webConfig.relprefix,"/---")),pxt.appTarget.simulator&&(e=(100/pxt.appTarget.simulator.aspectRatio).toPrecision(4)+"%");const G=x+t.replace(/^\//,"");w=pxt.docs.runUrl(G,e,s);break;case $.Url:w=C}}var M=[{mode:$.Code,label:lf("Code")},{mode:$.Editor,label:lf("Editor")},{mode:$.Simulator,label:lf("Simulator")}],_=b?void 0:lf("Publish project"),S=i&&!this.state.sharingError,T=[],A=(_&&T.push({label:_,onclick:()=>{pxt.tickEvent("menu.embed.publish",void 0,{interactiveConsent:!0}),this.setState({sharingError:void 0,loading:!0});let e=Promise.resolve();t&&this.props.parent.state.projectName!=t&&(e=this.props.parent.updateHeaderNameAsync(t)),(e=p.simScreenshot&&!r?e.then(this.screenshotAsync):e).then(()=>this.props.parent.anonymousPublishAsync(this.state.screenshotUri)).then(t=>{this.setState({pubId:t,qrCodeUri:void 0,qrCodeExpanded:!1}),pxt.appTarget.appTheme.qrCode&&W.renderAsync(""+k+t).then(e=>{this.state.pubId==t&&this.setState({qrCodeUri:e})}),this.forceUpdate()}).catch(e=>{pxt.tickEvent("menu.embed.error",{code:e.statusCode}),this.setState({pubId:void 0,sharingError:e,qrCodeUri:void 0,qrCodeExpanded:!1})}),this.forceUpdate()},icon:"share alternate",loading:S,className:"primary",disabled:n!=K.None}),!!pxt.options.light),N=lf("You need to publish your project to share it or embed it in other web pages.")+" "+lf("You acknowledge having consent to publish this project."),I=S||n!=K.None,O=this.loanedSimulator&&p.simScreenshotKey?lf("Take Screenshot (shortcut: {0})",p.simScreenshotKey):lf("Take Screenshot"),B=p.simScreenshot,A=!A&&!!p.simGif,P=n==K.GifRecording,D=n==K.GifRendering,j=P?"stop":"circle",F=P?p.simGifKey?lf("Stop recording (shortcut: {0})",p.simGifKey):lf("Stop recording"):D?lf("Cancel rendering"):p.simGifKey?lf("Start recording (shortcut: {0})",p.simGifKey):lf("Start recording"),U=P?"glow":"",H=n==K.GifLoading||D,P=a||(P?lf("Recording in progress..."):D?lf("Rendering gif..."):void 0),D=a?"warning":"",L=u&&413===u.statusCode&&(null==(L=null==(L=null==(L=pxt.appTarget)?void 0:L.cloud)?void 0:L.cloudProviders)?void 0:L.github),q=u&&!L,R=!!l&&c,z=this.props.parent.createModalClasses("sharedialog");return G.createElement(V.Modal,{isOpen:e,className:z,size:o?"":"small",onClose:this.hide,dimmer:!0,header:d||lf("Share Project"),closeIcon:!0,buttons:T,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},G.createElement("div",{className:"ui form"},_&&!this.loanedSimulator?G.createElement("div",{className:"ui field"},G.createElement("div",null,G.createElement(V.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:t||"",onChange:this.handleProjectNameChange}))):void 0,_&&this.loanedSimulator?G.createElement("div",{className:"ui fields"},G.createElement("div",{id:"shareLoanedSimulator",className:"simulator ui six wide field landscape only "+U}),G.createElement("div",{className:"ui ten wide field"},G.createElement(V.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:t||"",onChange:this.handleProjectNameChange}),G.createElement("label",null),G.createElement("div",{className:"ui buttons landscape only"},G.createElement(V.Button,{icon:"refresh",title:lf("Restart"),ariaLabel:lf("Restart"),onClick:this.restartSimulator,disabled:I}),B?G.createElement(V.Button,{icon:"camera",title:O,ariaLabel:O,onClick:this.handleScreenshotClick,disabled:I}):void 0,A?G.createElement(V.Button,{icon:j,title:F,loading:H,onClick:this.handleRecordClick,disabled:S}):void 0),r||P?G.createElement("div",{className:`ui ${D} segment landscape only`},r&&!P?G.createElement("img",{className:"ui small centered image",src:r,alt:lf("Recorded gif")}):G.createElement("p",{className:"no-select"},P)):void 0,G.createElement("p",{className:"ui tiny message info"},N))):void 0,_&&!this.loanedSimulator?G.createElement("p",{className:"ui tiny message info"},N):void 0,L&&G.createElement("p",{className:"ui orange inverted segment"},lf("Oops! Your project is too big. You can create a GitHub repository to share it."),G.createElement(V.Button,{className:"inverted basic",text:lf("Create"),icon:"github",onClick:this.handleCreateGitHubRepository})),q&&G.createElement("p",{className:"ui red inverted segment"},lf("Oops! There was an error. Please ensure you are connected to the Internet and try again.")),y&&b?G.createElement("div",null,!R&&G.createElement("p",null,lf("Your project is ready! Use the address below to share your projects.")),!R&&G.createElement(V.Input,{id:"projectUri",class:"mini",readOnly:!0,lines:1,value:y,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,"aria-describedby":"projectUriLabel",autoComplete:!1}),!R&&G.createElement("label",{htmlFor:"projectUri",id:"projectUriLabel",className:"accessible-hidden"},lf("This is the read-only internet address of your project.")),!!l&&G.createElement("img",{className:`ui ${R?"huge":"small"} image ${c?"centered":"floated right"} button pixelart`,alt:lf("QR Code of the saved program"),src:l,onClick:this.handleQrCodeClick,title:lf("Click to expand or collapse."),tabIndex:0,"aria-label":lf("QR Code of the saved program"),onKeyDown:V.fireClickOnEnter}),g?G.createElement("div",{className:"social-icons"},G.createElement(J,{url:y,ariaLabel:"Facebook",type:"facebook",heading:lf("Share on Facebook")}),G.createElement(J,{url:y,ariaLabel:"Twitter",type:"twitter",heading:lf("Share on Twitter")}),m.discourse?G.createElement(J,{url:y,icon:"comments",ariaLabel:lf("Post to Forum"),type:"discourse",heading:lf("Share on Forum")}):void 0):void 0):void 0,b&&!f&&G.createElement("div",null,G.createElement("div",{className:"ui divider"}),G.createElement(V.ExpandableMenu,{title:lf("Embed")},G.createElement(V.Menu,{pointing:!0,secondary:!0},M.map(e=>G.createElement(Y,Object.assign({key:"tab"+e.label,onClick:this.setAdvancedMode,currentMode:v},e)))),G.createElement(V.Field,null,G.createElement(V.Input,{id:"embedCode",class:"mini",readOnly:!0,lines:4,value:w,copy:b,disabled:!b,selectOnClick:!0,autoComplete:!1}),G.createElement("label",{htmlFor:"embedCode",id:"embedCodeLabel",className:"accessible-hidden"},lf("This is the read-only code for the selected tab.")))))))}componentDidUpdate(){var e=document.getElementById("shareLoanedSimulator");e&&this.loanedSimulator&&!this.loanedSimulator.parentNode&&e.appendChild(this.loanedSimulator)}}i.ShareEditor=a;class J extends n.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(e){var{type:t,url:i,heading:n}=this.props,r=pxt.appTarget.appTheme.socialOptions;pxt.tickEvent("share."+t,void 0,{interactiveConsent:!0});let o="";switch(t){case"facebook":o="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(i);break;case"twitter":{let e=lf("Check out what I made!");r.twitterHandle&&r.orgTwitterHandle?e=lf("Check out what I made with @{0} and @{1}!",r.twitterHandle,r.orgTwitterHandle):r.twitterHandle?e=lf("Check out what I made with @{0}!",r.twitterHandle):r.orgTwitterHandle&&(e=lf("Check out what I made with @{0}!",r.orgTwitterHandle)),o=`https://twitter.com/intent/tweet?url=${encodeURIComponent(i)}&text=`+encodeURIComponent(e)+(r.hashtags?"&hashtags="+encodeURIComponent(r.hashtags):"")+(r.related?"&related="+encodeURIComponent(r.related):"");break}case"discourse":o=`${r.discourse||"https://forum.makecode.com/"}new-topic?title=`+encodeURIComponent(i),r.discourseCategory&&(o+="&category="+encodeURIComponent(r.discourseCategory))}pxt.BrowserUtils.popupWindow(o,n,600,600),e.preventDefault()}renderCore(){var{type:e,label:t,ariaLabel:i,icon:n}=this.props;return G.createElement("a",{role:"button",className:`ui button large ${t?"labeled":""} icon `+e,tabIndex:0,"aria-label":i,onClick:this.handleClick,onKeyDown:V.fireClickOnEnter},G.createElement(V.Icon,{icon:n||e}),t)}}class Y extends V.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.mode)}renderCore(){var{label:e,mode:t,currentMode:i}=this.props;return G.createElement(V.MenuItem,{id:"tab"+t,active:i==t,tabIndex:0,name:e,onClick:this.handleClick})}}},{"./data":67,"./qr":111,"./screenshot":112,"./simulator":121,"./sui":129,react:320}],118:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SidebarTutorialCard=i.SidebarTutorialHint=void 0;const s=e("react"),l=e("./sui"),c=e("./marked"),n=e("./tutorial");class o extends n.TutorialHint{constructor(e){super(e)}renderCore(){var{tutorialName:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions,n=t[i],r=n.hintContentMd,o=n.showDialog,n=n.contentMd,a=this.props.parent.createModalClasses("hintdialog"),i=i<t.length-1?this.next:this.closeHint,t=[{label:lf("Start"),onclick:i,className:"green"}];return s.createElement("div",{id:"callout",className:"callout-container"},s.createElement(l.Button,{className:"callout-hint ui circular label blue hintbutton",icon:"lightbulb outline",tabIndex:-1,onKeyDown:l.fireClickOnEnter}),o?s.createElement(l.Modal,{isOpen:!0,className:a,closeIcon:!1,header:e,buttons:t,onClose:i,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},s.createElement(c.MarkedContent,{markdown:n,parent:this.props.parent})):s.createElement("div",{className:"callout-wrapper"},s.createElement("div",{className:"callout-hint-header"},"Hint:"),s.createElement("div",{className:"callout-hint-text"},s.createElement(c.MarkedContent,{markdown:r,unboxSnippets:!0,parent:this.props.parent}))))}}i.SidebarTutorialHint=o;class r extends n.TutorialCard{constructor(e){super(e)}renderCore(){var{tutorialName:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions,n=t[i],t=!!t[i].hintContentMd||t[i].showDialog,i=n.headerContentMd,n=n.showDialog;let r="";return t&&(r+=lf("Press Space or Enter to show a hint."),lf("Click to show a hint!")),s.createElement("div",{id:"sidebar"},s.createElement("div",{className:"tutorialTitle"},s.createElement("p",null,e)),s.createElement("div",{ref:"tutorialmessage",className:"tutorialMessage",role:"alert","aria-label":r,tabIndex:t?0:-1,onKeyDown:t?l.fireClickOnEnter:void 0},s.createElement("div",{className:"content"},!n&&s.createElement(c.MarkedContent,{className:"no-select",markdown:i,parent:this.props.parent,onDidRender:this.onMarkdownDidRender}))),t&&s.createElement(o,{parent:this.props.parent}))}}i.SidebarTutorialCard=r},{"./marked":97,"./sui":129,"./tutorial":132,react:320}],119:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Sidepanel=void 0;const y=e("react"),n=e("./data"),w=e("./sui"),k=e("./filelist"),x=e("./keymap"),E=e("./serialindicator"),C=e("./simtoolbar"),r=e("./simulator"),_=e("./components/core/TabContent"),S=e("./components/core/TabPane"),T=e("./components/tutorial/TutorialContainer"),A="tab-tutorial",N="tab-simulator";class o extends n.Component{constructor(e){super(e),this.showSimulatorTab=()=>{this.props.showMiniSim(!1),this.setState({activeTab:N,height:void 0}),r.driver.focus()},this.showTutorialTab=()=>{this.props.showMiniSim(!0),this.setState({activeTab:A})},this.handleSimSerialClick=()=>{this.props.openSerial(!0)},this.handleDeviceSerialClick=()=>{this.props.openSerial(!1)},this.handleSimOverlayClick=()=>{var{tutorialOptions:e,handleFullscreenButtonClick:t}=this.props;!e||pxt.BrowserUtils.useOldTutorialLayout()?t():this.showSimulatorTab()},this.handleSimPanelRef=t=>{(this.simPanelRef=t)&&"undefined"!=typeof ResizeObserver&&new ResizeObserver(()=>{var e;t.scrollHeight>t.clientHeight?null!=(e=this.simPanelRef)&&e.classList.remove("invisibleScrollbar"):null!=(e=this.simPanelRef)&&e.classList.add("invisibleScrollbar")}).observe(t)},this.setComponentHeight=e=>{e!=this.state.height&&this.setState({height:e})},this.tutorialExitButton=()=>y.createElement("div",{className:"tutorial-exit","aria-label":lf("Exit tutorial"),tabIndex:0,onClick:()=>this.props.parent.exitTutorial(),onKeyDown:w.fireClickOnEnter},lf("Exit Tutorial"))}UNSAFE_componentWillReceiveProps(e){var t;!this.props.tutorialOptions&&e.tutorialOptions||this.props.inHome&&!e.inHome&&e.tutorialOptions||null!=(t=this.props.tutorialOptions)&&t.tutorial&&null!=(t=e.tutorialOptions)&&t.tutorial&&this.props.tutorialOptions.tutorial!==e.tutorialOptions.tutorial?this.showTutorialTab():(!this.props.inHome&&e.inHome||this.props.tutorialOptions&&!e.tutorialOptions)&&this.showSimulatorTab()}componentDidUpdate(e,t){(this.state.height||t.height)&&this.state.height!=t.height&&this.props.setEditorOffset()}renderCore(){var{parent:e,inHome:t,showKeymap:i,showSerialButtons:n,showFileList:r,showFullscreenButton:o,collapseEditorTools:a,simSerialActive:s,deviceSerialActive:l,tutorialOptions:c,handleHardwareDebugClick:d,onTutorialStepChange:u,onTutorialComplete:p}=this.props,{activeTab:h,height:f}=this.state,m=(null==c?void 0:c.tutorial)&&!pxt.BrowserUtils.useOldTutorialLayout(),g=pxt.appTarget.appTheme.lockedEditor,b=!(null!=(b=pxt.appTarget.simulator)&&b.headless),v=b?"6.5rem":"3rem";return y.createElement("div",{id:"simulator",className:"simulator"},y.createElement(S.TabPane,{id:"editorSidebar",activeTabName:h,style:f?{height:`calc(${f}px + ${v})`}:void 0},b&&y.createElement(_.TabContent,{name:N,icon:"xicon gamepad",onSelected:this.showSimulatorTab,ariaLabel:lf("Open the simulator tab")},m&&!g&&this.tutorialExitButton(),y.createElement("div",{className:"ui items simPanel",ref:this.handleSimPanelRef},y.createElement("div",{id:"boardview",className:"ui vertical editorFloat",role:"region","aria-label":lf("Simulator"),tabIndex:t?-1:0}),y.createElement(C.SimulatorToolbar,{parent:e,collapsed:a,simSerialActive:s,devSerialActive:l,showSimulatorSidebar:this.showSimulatorTab}),i&&y.createElement(x.Keymap,{parent:e}),y.createElement("div",{className:"ui item portrait hide hidefullscreen"},pxt.options.debug&&y.createElement(w.Button,{key:"hwdebugbtn",className:"teal",icon:"xicon chip",text:"Dev Debug",onClick:d})),n&&y.createElement("div",{id:"serialPreview",className:"ui editorFloat portrait hide hidefullscreen"},y.createElement(E.SerialIndicator,{ref:"simIndicator",isSim:!0,onClick:this.handleSimSerialClick,parent:e}),y.createElement(E.SerialIndicator,{ref:"devIndicator",isSim:!1,onClick:this.handleDeviceSerialClick,parent:e})),r&&y.createElement(k.FileList,{parent:e}),o&&y.createElement("div",{id:"miniSimOverlay",role:"button",title:lf("Open in fullscreen"),onClick:this.handleSimOverlayClick}))),c&&y.createElement(_.TabContent,{name:A,icon:"icon tasks",showBadge:h!==A,onSelected:this.showTutorialTab,ariaLabel:lf("Open the tutorial tab")},y.createElement(T.TutorialContainer,{parent:e,tutorialId:c.tutorial,name:c.tutorialName,steps:c.tutorialStepInfo,currentStep:c.tutorialStep,tutorialOptions:c,hideIteration:null==(f=c.metadata)?void 0:f.hideIteration,onTutorialStepChange:u,onTutorialComplete:p,setParentHeight:this.setComponentHeight}))))}}i.Sidepanel=o},{"./components/core/TabContent":57,"./components/core/TabPane":58,"./components/tutorial/TutorialContainer":60,"./data":67,"./filelist":81,"./keymap":94,"./serialindicator":116,"./simtoolbar":120,"./simulator":121,"./sui":129,react:320}],120:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PlayButton=i.SimulatorToolbar=void 0;const B=e("react"),n=e("./data"),j=e("./sui");class r extends n.Component{constructor(e){super(e),this.state={},pxt.BrowserUtils.isIOS()&&this.props.parent.setMute(!0),this.toggleMute=this.toggleMute.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.openInstructions=this.openInstructions.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.openDeviceSimulator=this.openDeviceSimulator.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.takeScreenshot=this.takeScreenshot.bind(this),this.toggleDebug=this.toggleDebug.bind(this)}openInstructions(){pxt.tickEvent("simulator.make",void 0,{interactiveConsent:!0}),this.props.parent.openInstructions()}startStopSimulator(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}restartSimulator(){pxt.tickEvent("simulator.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}toggleDebug(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleMute(){pxt.tickEvent("simulator.mute",{view:"computer",muteTo:""+!this.props.parent.state.mute},{interactiveConsent:!0}),this.props.parent.toggleMute()}toggleSimulatorFullscreen(){pxt.tickEvent("simulator.fullscreen",{view:"computer",fullScreenTo:""+!this.props.parent.state.fullscreen},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen()}toggleSimulatorCollapse(){pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}openDeviceSerial(){pxt.tickEvent("simulator.fullscreen.serial.simulator",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openDeviceSerial()}openDeviceSimulator(){pxt.tickEvent("simulator.fullscreen.serial.device",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openSimSerial()}takeScreenshot(){pxt.tickEvent("simulator.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.downloadScreenshotAsync()}renderCore(){var e,t,i,n,r,o,a,s,l,c,d,u,p,h,f,m,g,b,v,y,w,k,x,E,C,_,S,T,A,N,I,{collapsed:O,devSerialActive:P,parent:D,simSerialActive:L,showSimulatorSidebar:M}=this.props,R=D.state;return!R.currFile||R.home?B.createElement("div",null):(e=pxt.appTarget.appTheme,t=pxt.appTarget.simulator,n=!(i=pxt.shell.isSandboxMode())&&R.showParts&&e.instructions,r=(v=R.simState)==pxt.editor.SimState.Running,b=v==pxt.editor.SimState.Starting,v=v==pxt.editor.SimState.Pending,o=R.fullscreen,a=R.mute,s=(c=!!R.tutorialOptions&&!!R.tutorialOptions.tutorial)&&!pxt.BrowserUtils.useOldTutorialLayout(),g=D.isBlocksActive()||D.isJavaScriptActive()||D.isPythonActive(),l=!t.hideRestart,c=e.debugger&&!c&&!pxt.BrowserUtils.isIE(),d=R.debugging,u=!t.hideFullscreen&&!i,p=e.hasAudio,h=t.headless,f=!!e.simScreenshot,m=R.screenshoting?"loading":"",g=!b&&!v&&g,b=!d&&!b&&!v,v=!e.bigRunButton,y=lf("Open assembly instructions"),w=lf("Restart the simulator"),k=lf("Toggle debug mode"),x=lf("View simulator keyboard shortcuts"),E=lf("Show simulator in sidebar"),C=o?lf("Exit fullscreen mode"):lf("Launch in fullscreen"),_=a?lf("Unmute audio"):lf("Mute audio"),S=e.simScreenshotKey?lf("Take Screenshot (shortcut {0})",e.simScreenshotKey):lf("Take Screenshot"),T=O?lf("Show the simulator"):lf("Hide the simulator"),A=lf("Open simulator console"),N=lf("Open device console"),I=o&&(L||P),B.createElement("aside",{className:"ui item grid centered simtoolbar"+(i?"":" portrait "),role:"complementary","aria-label":lf("Simulator toolbar")},B.createElement("div",{className:"ui icon tiny buttons",style:{padding:"0"}},s&&B.createElement(j.Button,{key:"simsidebarbtn",className:"sidebar-button tablet only",icon:"external flipped",title:E,onClick:M}),n&&B.createElement(j.Button,{disabled:d,icon:"configure",className:"secondary",title:y,onClick:this.openInstructions}),!e.bigRunButton&&B.createElement(F,{parent:D,simState:R.simState,debugging:R.debugging}),u&&B.createElement(j.Button,{key:"fullscreenbtn",className:"fullscreen-button tablet only hidefullscreen",icon:"xicon fullscreen",title:C,onClick:this.toggleSimulatorFullscreen}),l&&B.createElement(j.Button,{disabled:!b,key:"restartbtn",className:"restart-button",icon:"refresh",title:w,onClick:this.restartSimulator}),c&&B.createElement(j.Button,{disabled:!g,key:"debugbtn",className:"debug-button "+(d?"orange":""),icon:"icon bug",title:k,onClick:this.toggleDebug}),v&&B.createElement(j.Button,{className:"expand-button portrait only editortools-btn hidefullscreen",icon:O?"play":"stop",title:T,onClick:this.toggleSimulatorCollapse})),!h&&B.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},p&&B.createElement(j.Button,{key:"mutebtn",className:"mute-button "+(a?"red":""),icon:a?"volume off":"volume up",title:_,onClick:this.toggleMute}),t.keymap&&B.createElement(j.Button,{key:"keymap",className:"keymap-button",icon:"keyboard",title:x,onClick:D.toggleKeymap})),I&&B.createElement("div",{className:"ui item tiny buttons full-screen-console"},L&&B.createElement(j.Button,{icon:"list",className:"purple",title:A,onClick:this.openDeviceSimulator}),P&&B.createElement(j.Button,{icon:"usb",className:"purple",title:N,onClick:this.openDeviceSerial})),!h&&B.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},f&&B.createElement(j.Button,{disabled:!r,key:"screenshotbtn",className:"screenshot-button "+m,icon:"icon camera left",title:S,onClick:this.takeScreenshot}),u&&B.createElement(j.Button,{key:"fullscreenbtn",className:"fullscreen-button",icon:"xicon "+(o?"fullscreencollapse":"fullscreen"),title:C,onClick:this.toggleSimulatorFullscreen}))))}}i.SimulatorToolbar=r;class F extends j.StatelessUIElement{constructor(e){super(e),this.startStopSimulator=()=>{pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}}renderCore(){const e=this.props.simState,t=e==pxt.editor.SimState.Running,i=e==pxt.editor.SimState.Starting,n=e==pxt.editor.SimState.Pending,r=!this.props.debugging&&!i&&!n,o=(()=>{switch(e){case pxt.editor.SimState.Stopped:return lf("Start the simulator");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting the simulator");case pxt.editor.SimState.Running:return lf("Stop the simulator")}})();return B.createElement(j.Button,{disabled:!r,key:"runbtn",className:`play-button ${this.props.className||""} `+(t?"stop":"play"),icon:t?"stop":"play green",title:o,onClick:this.startStopSimulator})}}i.PlayButton=F},{"./data":67,"./sui":129,react:320}],121:[function(e,t,g){"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.dbgStepOut=g.dbgStepInto=g.dbgStepOver=g.dbgPauseResume=g.proxy=g.setTraceInterval=g.unhide=g.hide=g.suspend=g.stop=g.mute=g.run=g.setPending=g.setDirty=g.setState=g.init=g.setTranslations=g.simTranslations=g.driver=g.SLOW_TRACE_INTERVAL=g.FAST_TRACE_INTERVAL=void 0;const r=e("./core"),o=e("./coretsx");var a=pxt.U;let s,b,l=(g.FAST_TRACE_INTERVAL=100,g.SLOW_TRACE_INTERVAL=500,{});function v(e,t){pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"simevent",subtype:e,exception:t})}g.setTranslations=function(e){g.simTranslations!==e&&(g.simTranslations=e,n())};g.init=function(t,n){if(t){pxsim.U.clear(t);var i=document.createElement("div"),i=(i.id="simulators",i.className="simulator",t.appendChild(i),document.createElement("div")),t=(i.id="debugger",i.className="ui item landscape only",t.appendChild(i),/nestededitorsim=1/i.test(window.location.href));let e=null;if(window.parent!==window){const t=new URLSearchParams(window.location.search).get("parentOrigin");if(t)try{e=new URL(t).origin}catch(n){console.error("Invalid parent origin: "+t)}}i={restart:()=>n.restartSimulator(),revealElement:e=>{if(!pxt.options.light&&!g.driver.isLoanedSimulator(e)){var t=pxt.appTarget.appTheme.simAnimationEnter||"fly right in";e.style.animationDuration="500ms";const i=t+" visible transition animating";pxsim.U.addClass(e,i),pxt.Util.delay(500).then(()=>{pxsim.U.removeClass(e,i),e.style.animationDuration="",pxt.BrowserUtils.isEdge()&&o.dialogIsShowing()&&(document.body.style.display="none",requestAnimationFrame(()=>{document.body.style.display="block"}))})}},removeElement:(e,t)=>{var i;pxt.appTarget.simulator.headless?(pxsim.U.addClass(e,"simHeadless"),t&&t()):pxt.options.light?(t&&t(),pxsim.U.remove(e)):(i=pxt.appTarget.appTheme.simAnimationExit||"fly right out",e.style.animationDuration="500ms",pxsim.U.addClass(e,i+" visible transition animating"),pxt.Util.delay(500).then(()=>{pxsim.U.removeClass(e,"animating"),e.style.animationDuration="",t&&t(),pxsim.U.remove(e)}))},unhideElement:e=>{pxsim.U.removeClass(e,"simHeadless")},onDebuggerBreakpoint:function(i){let n=!1;if(s){let e=0,t=i.breakpointId;for(;!n;){if(t){const g=b.breakpoints[t];n=s.highlightStatement(g,i)}if(!n){e++;const n=i.stackframes?i.stackframes[e]:void 0;if(!n)break;t=n.breakpointId}}}i.exceptionMessage||!s||n?(!n&&i.exceptionMessage&&(pxt.debug("runtime error: "+i.exceptionMessage),pxt.debug(i.exceptionStack),s)&&s.orphanException(i),v("stopped",i.exceptionMessage)):g.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},onTraceMessage:function(e){var t=b.breakpoints[e.breakpointId];s&&s.highlightStatement(t,e)},onDebuggerWarning:function(e){for(var t of e.breakpointIds){t=b.breakpoints[t];if(t&&!a.startsWith("pxt_modules/",t.fileName)){s&&s.highlightStatement(t);break}}},onDebuggerResume:function(){v("resumed"),s&&s.highlightStatement(null)},onStateChanged:function(e){e===pxsim.SimulatorState.Stopped?v("stopped"):e===pxsim.SimulatorState.Running&&this.onDebuggerResume(),n.onStateChanged(e)},onSimulatorReady:function(){pxt.perf.recordMilestone("simulator ready"),pxt.perf.perfReportLogged||pxt.perf.report()},onSimulatorCommand:t=>{switch(t.command){case"setstate":n.setState(t.stateKey,t.stateValue);break;case"restart":n.restartSimulator();break;case"reload":c(!0),n.restartSimulator();break;case"modal":if(c(),!(pxt.shell.isSandboxMode()||t.displayOnceId&&l[t.displayOnceId])){const n={header:t.header,body:t.body,size:"large",copyable:t.copyable,disagreeLbl:lf("Close"),modalContext:t.modalContext},e=pxt.appTarget.simulator.trustedUrls,i=t.linkButtonHref&&e&&-1!==e.indexOf(t.linkButtonHref);i?n.agreeLbl=t.linkButtonLabel:n.hideAgree=!0,l[t.displayOnceId]=!0,r.confirmAsync(n).then(e=>{i&&1==e&&window.open(t.linkButtonHref,"_blank")})}}},onTopLevelCodeEnd:()=>{v("toplevelfinished")},stoppedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.stoppedClass,invalidatedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.invalidatedClass,nestedEditorSim:t,parentOrigin:e,messageSimulators:null==(t=null==(i=pxt.appTarget)?void 0:i.simulator)?void 0:t.messageSimulators};g.driver=new pxsim.SimulatorDriver(document.getElementById("simulators"),i),s=n}};let i;function n(){g.driver&&g.driver.setDirty()}function c(e,t){g.driver&&(g.driver.stopSound(),g.driver.stop(e,t))}g.setState=function(e,t){s&&s.editor!=e&&(s.editor=e,s.highlightStatement(null)),i=t},g.setDirty=n,g.setPending=function(){g.driver&&g.driver.setPending()},g.run=function(e,t,i,n,r){var o=pxt.appTarget.simulator.boardDefinition,{js:a,fnArgs:s,parts:l,usedBuiltinParts:c}=pxtc.buildSimJsInfo(i),{mute:i,highContrast:n,light:d,clickTrigger:u,storedState:p,autoRun:h}=(b=i,n),f=pxt.BrowserUtils.isIpcRenderer()||void 0,m=e.dependencies(),o={boardDefinition:o,mute:i,parts:l,builtinParts:c,debug:t,trace:r,fnArgs:s,highContrast:n,light:d,aspectRatio:l.length?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio,partDefinitions:e.computePartDefinitions(l),cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:g.simTranslations,refCountingDebug:pxt.options.debug,version:e.version(),clickTrigger:u,breakOnStart:t,storedState:p,autoRun:h,ipc:f,dependencies:m};v("started"),g.driver.run(a,o)},g.mute=function(e){g.driver&&g.driver.mute(e)},g.stop=c,g.suspend=function(){g.driver&&g.driver.suspend()},g.hide=function(e){g.driver&&g.driver.hide(e)},g.unhide=function(){g.driver&&g.driver.unhide()},g.setTraceInterval=function(e){g.driver&&g.driver.setTraceInterval(e)},g.proxy=function(e){g.driver&&g.driver.postMessage(e)},g.dbgPauseResume=function(){g.driver.state==pxsim.SimulatorState.Paused?g.driver.resume(pxsim.SimulatorDebuggerCommand.Resume):g.driver.state==pxsim.SimulatorState.Running&&g.driver.resume(pxsim.SimulatorDebuggerCommand.Pause)},g.dbgStepOver=function(){g.driver.state==pxsim.SimulatorState.Paused&&g.driver.resume(pxsim.SimulatorDebuggerCommand.StepOver)},g.dbgStepInto=function(){g.driver.state==pxsim.SimulatorState.Paused&&g.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},g.dbgStepOut=function(){g.driver.state==pxsim.SimulatorState.Paused&&g.driver.resume(pxsim.SimulatorDebuggerCommand.StepOut)}},{"./core":64,"./coretsx":65}],122:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isSnippetInputAnswerTypeDropdown=i.isSnippetInputAnswerTypeYesNo=i.isSnippetInputAnswerTypeNumber=i.isSnippetInputAnswerTypeOther=i.isSnippetInputAnswerSingular=i.initializeSnippetExtensions=i.SnippetBuilder=void 0;const l=e("react"),n=e("./data"),c=e("./sui"),d=e("./marked"),o=e("./compiler"),s=e("react-dom"),r=e("./package"),a=e("./core"),u=e("./snippetBuilderInputHandler");class p extends n.Component{constructor(e){super(e),this.generateOutputMarkdown=pxt.Util.debounce(()=>{var{config:e,tsOutput:t}=this.state,e=`\`\`\`${e.outputType}
`;e+=this.replaceTokens(this.highlightEditedBlocks(t)),this.setState({mdOutput:e+="\n```"})},300,!1),this.onChange=r=>i=>{let n=this.getCurrentQuestion();this.setState(e=>{var t=Object.assign(Object.assign({},e.answers),{[r]:i});return{answers:t,tsOutput:this.updateOutput(n,t,e.tsOutput)}},this.generateOutputMarkdown)},this.state={visible:!1,answers:{},history:[0],defaults:{},config:e.config,tsOutput:[e.config.initialOutput]},this.cleanup=this.cleanup.bind(this),this.hide=this.hide.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this),this.backPage=this.backPage.bind(this),this.nextPage=this.nextPage.bind(this),this.handleModalKeyDown=this.handleModalKeyDown.bind(this)}buildDefaults(){const t=this.state["config"],i={};for(const e of t.questions){const t=e["inputs"];for(const o of t)if(h(o)){const{defaultAnswer:t,answerToken:a}=o;i[a]=t}else{const{defaultAnswers:t,answerTokens:s}=o;for(let e=0;e<s.length;e++){var n=s[e],r=t[e];i[n]=r}}}this.setState({answers:i,defaults:i},this.generateOutputMarkdown)}toggleActionButton(){var e=this.isLastQuestion()?{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}:{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"};this.state.actions[1]!==e&&this.setState({actions:[this.state.actions[0],e]})}initializeActionButtons(){var e=[{label:lf("Back"),onclick:this.backPage,icon:"arrow left",className:"arrow left",labelPosition:"left"},{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"}];this.setState({actions:e})}componentDidMount(){this.buildDefaults()}replaceTokens(e){var t,{answers:i,defaults:n}=this.state;let r=e.join("\n");const o=Object.keys(n);for(t of o){const o=i[t]||n[t];r=r.split("$"+t).join(o)}return r}highlightEditedBlocks(e){const n=this.getCurrentQuestion().inputs.reduce((e,t)=>h(t)?pxt.Util.concat([e,[t.answerToken]]):pxt.Util.concat([e,t.answerTokens]),[]);return e.reduce((e,t)=>{for(const i of n)if(-1!==t.indexOf(i))return pxt.Util.concat([e,["// @highlight",t]]);return pxt.Util.concat([e,[t]])},[])}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("snippet.builder.show",null,{interactiveConsent:!0}),this.initializeActionButtons(),this.setState({visible:!0})}cleanup(){this.setState({answers:{},history:[0],tsOutput:[this.props.config.initialOutput]}),Blockly.hideChaff()}cancel(){var e=this.state.config["name"];pxt.tickEvent("snippet.builder.cancel",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.hide(),this.cleanup()}injectBlocksToWorkspace(){const t=this.state["tsOutput"],n=this.props["mainWorkspace"],r=this.state.config["outputBehavior"];o.getBlocksAsync().then(e=>o.decompileBlocksSnippetAsync(this.replaceTokens(t),e)).then(e=>{e=Blockly.Xml.textToDom(e.outfiles[pxt.MAIN_BLOCKS]),e=pxt.blocks.findRootBlocks(e);let i=n.getTopBlocks(!0);"replace"===r&&(i.forEach(e=>{e.dispose(!1)}),i=[]);var e=e.map(t=>{var e=i.filter(e=>t.getAttribute("type")===e.type);return e.length?{newB:t,exB:e[0]}:{newB:t,exB:null}}),t=e.filter(e=>!!e.exB),e=e.filter(e=>!e.exB);t.forEach(function(e){var{newB:e,exB:t}=e,e=pxt.blocks.findRootBlock(e),e=Blockly.Xml.domToBlock(e,n);t.getInput("HANDLER").connection.connect(e.previousConnection)}),e.forEach(function(e){e=e.newB;Blockly.Xml.domToBlock(e,n)}),i.length<=1&&pxt.blocks.layout.flow(n,{useViewWidth:!0})}).catch(e=>{throw a.errorNotification(e),new Error("Failed to decompile snippet output")})}confirm(){var e=this.state.config["name"];pxt.tickEvent("snippet.builder.back.page",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.injectBlocksToWorkspace(),Blockly.hideChaff(),this.hide()}getCurrentPage(){var e=this.state["history"];return e[e.length-1]}getCurrentQuestion(){var e=this.state["config"];return e.questions[this.getCurrentPage()]}getNextQuestionNumber(){const{answers:e,defaults:t}=this.state,i=this.getCurrentQuestion();if(i.goto){var n=i.goto["parameters"];if(n)for(const i of n){var{answer:r,token:o}=i;if(r&&o&&(r===e[o]||!e[o]&&r===t[o]))return i.question}return i.goto.question}return null}getNextQuestion(){var e=this.state["config"],t=this.getNextQuestionNumber();return t?e.questions[t]:null}isLastQuestion(){return!this.getCurrentQuestion().goto}nextPage(){const{config:e,history:t}=this.state,i=this.getCurrentQuestion().goto;if(this.isLastQuestion())this.confirm();else if(i){const i=this.getNextQuestion();var n=this.updateOutput(i,this.state.answers,this.state.tsOutput),r=this.getNextQuestionNumber();this.setState({history:[...t,r],tsOutput:n},this.toggleActionButton),pxt.tickEvent("snippet.builder.next.page",{snippet:e.name,page:r},{interactiveConsent:!0}),this.generateOutputMarkdown()}}backPage(){const{history:e,config:t}=this.state;1<e.length&&this.setState({history:e.slice(0,e.length-1)},()=>{this.toggleActionButton(),pxt.tickEvent("snippet.builder.back.page",{snippet:t.name,page:this.getCurrentPage()},{interactiveConsent:!0}),this.generateOutputMarkdown()})}handleModalKeyDown(e){13!==e.keyCode&&39!==e.keyCode||this.nextPage(),37===e.keyCode&&this.backPage()}updateOutput(i,n,e){let r=!1;if(i.outputConditionalOnAnswer){let t=i.outputConditionalOnAnswer;i.inputs.map(e=>h(e)?[e.answerToken]:e.answerTokens).reduce((e,t)=>[...e,...t],[]).every(e=>n[e]!=t)&&(r=!0)}let t=!!i.output,o=t&&-1!==e.indexOf(i.output),a=e;return r||o||!t?r&&o&&(a=e.filter(e=>e!==i.output)):a=pxt.Util.concat([e,[i.output]]),a}renderCore(){const{visible:e,answers:i,config:t,mdOutput:n,actions:r}=this.state,o=this.props["parent"],a=this.getCurrentQuestion();var s=0===this.getCurrentPage();return l.createElement(c.Modal,{isOpen:e,className:"snippet-builder full-screen-no-bg "+(s?"no-back-btn":""),overlayClassName:"snippet-builder-modal-overlay",closeOnEscape:!0,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:r,header:t.name,onClose:this.cancel,onKeyDown:this.handleModalKeyDown},l.createElement("div",{className:"snippet-builder-inner"},a&&l.createElement("div",{className:"snippet-question"},l.createElement("div",{className:"ui segment raised"},l.createElement("h3",null,pxt.Util.rlf(a.title)),l.createElement("div",{className:"ui equal width grid"},a.inputs.map((e,t)=>l.createElement("span",{className:"column",key:"span-"+t},l.createElement(u.InputHandler,{onChange:h(e)?this.onChange(e.answerToken):this.onChange,input:e,value:h(e)?i[e.answerToken]:i[e.answerTokens[0]],onEnter:this.nextPage,key:h(e)?e.answerToken:e.answerTokens[0]})))),a.errorMessage&&l.createElement("p",{className:"snippet-error"},a.errorMessage)),a.hint&&l.createElement("div",{className:"snippet hint ui segment"},pxt.Util.rlf(a.hint).split("\n").reduce((e,t)=>[...e,e.length?l.createElement("br",null):"",t],[]))),l.createElement("div",{className:"snippet output-section"},n&&l.createElement(d.MarkedContent,{className:"snippet-markdown-content",markdown:n,parent:o}))))}}function h(e){return void 0!==e.answerToken}i.SnippetBuilder=p,i.initializeSnippetExtensions=function(t,e,o,a){!function(){let e=pxt.Util.concat(r.allEditorPkgs().map(e=>e.sortedFiles())),t=e.filter(e=>"pxtsnippets.json"===e.name).map(e=>pxt.Util.jsonTryParse(e.content));const i=e.filter(e=>e.name.endsWith(".snippetts"));return t=t.map(e=>e.map(e=>{if(e.initialOutput.startsWith("file:")){let t=e.initialOutput.slice("file:".length,e.initialOutput.length);if(1!=i.filter(e=>e.name===t).length)return pxt.reportError("snippetbuilder","invalid external .ts file path: "+t),null}return e}).filter(e=>!!e)),pxt.Util.concat(t)}().filter(e=>e.namespace==t).forEach(r=>{e.push({name:`SNIPPET${name}_BUTTON`,type:"button",attributes:{blockId:`SNIPPET${name}_BUTTON`,label:r.label?pxt.Util.rlf(r.label):pxt.Util.lf("Editor"),weight:101,group:r.group&&r.group},callback:()=>{var e,t,i,n;e=r,t=o,i=a,n=document.createElement("div"),n=document.body.appendChild(n),i={parent:i,mainWorkspace:t,config:e},s.render(l.createElement(p,i),n).show()}})})},i.isSnippetInputAnswerSingular=h,i.isSnippetInputAnswerTypeOther=function(e){return"number"!==e.type},i.isSnippetInputAnswerTypeNumber=function(e){return void 0!==e.max},i.isSnippetInputAnswerTypeYesNo=function(e){return"yesno"===e.type},i.isSnippetInputAnswerTypeDropdown=function(e){return void 0!==e.options}},{"./compiler":18,"./core":64,"./data":67,"./marked":97,"./package":108,"./snippetBuilderInputHandler":123,"./sui":129,react:320,"react-dom":276}],123:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=void 0;const n=e("react"),r=e("./data"),o=e("./components/ImageEditor/ImageEditor"),a=e("./sui"),s=e("./snippetBuilderPositionPicker"),l=e("./snippetBuilder");class c extends r.Component{constructor(e){super(e),this.textOnChange=e=>this.props.onChange(e),this.variableNameOnChange=e=>this.props.onChange(ts.pxtc.escapeIdentifier(e)),this.state={isFocused:!1}}renderInput(){const{value:e,input:t,onChange:i}=this.props;switch(t.type){case"dropdown":return n.createElement(d,{input:t,value:e,onChange:i});case"yesno":return n.createElement(p,{input:t,onChange:i});case"spriteEditor":if(l.isSnippetInputAnswerTypeOther(t)){const t=pxt.sprite.imageLiteralToBitmap(e);return n.createElement(o.ImageEditor,{singleFrame:!0,asset:{internalID:0,type:"image",id:"",jresData:"",meta:{},bitmap:t.data()},onChange:i})}case"number":return n.createElement(u,{input:t,value:e,onChange:i,autoFocus:!0});case"positionPicker":if(!l.isSnippetInputAnswerSingular(t))return n.createElement(s.PositionPicker,{defaultX:parseInt(t.defaultAnswers[0]),defaultY:parseInt(t.defaultAnswers[1]),input:t,onChange:i});default:if(l.isSnippetInputAnswerTypeOther(t))return n.createElement(a.Input,{label:t.label&&t.label,value:e||"",onChange:"variableName"==t.type?this.variableNameOnChange:this.textOnChange,autoFocus:!0,selectOnMount:!0})}return null}renderCore(){return this.renderInput()}}i.InputHandler=c;class d extends r.Component{constructor(e){super(e),this.onChange=t=>()=>{var e=this.props["onChange"];e(t)},this.onChange=this.onChange.bind(this)}renderCore(){const{value:e,input:t}=this.props;return l.isSnippetInputAnswerTypeDropdown(t)?n.createElement(a.DropdownMenu,{className:"inline button",role:"menuitem",text:e.length?pxt.Util.rlf(t.options[e]):pxt.Util.rlf(t.options[Object.keys(t.options)[0]]),icon:"dropdown"},Object.keys(t.options).map(e=>n.createElement(a.Item,{role:"menuitem",value:e,key:t.options[e],text:pxt.Util.rlf(t.options[e]),onClick:this.onChange(e)}))):null}}class u extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){var t=this.props["onChange"];t(e.target.value)}renderCore(){var{input:e,value:t,autoFocus:i}=this.props;return l.isSnippetInputAnswerTypeNumber(e)?n.createElement("div",{className:"slider-outer"},n.createElement("span",null,e.label&&e.label),n.createElement("div",null,n.createElement("input",{type:"range",autoFocus:i,className:"slider blocklyMockSlider",role:"slider",max:e.max,min:e.min,value:t,onChange:this.onChange,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":+t,style:{marginLeft:0}}),n.createElement(a.Input,{value:t,onChange:this.props.onChange,class:"snippet slider-input"}))):null}}class p extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const t=this.props["onChange"];return()=>t(e)}renderCore(){var e=this.props["input"];return l.isSnippetInputAnswerTypeYesNo(e)?n.createElement("div",null,n.createElement(a.Button,{text:"Yes",title:"Yes",onClick:this.onChange("true")}),n.createElement(a.Button,{text:"No",title:"No",onClick:this.onChange("false")})):null}}},{"./components/ImageEditor/ImageEditor":26,"./data":67,"./snippetBuilder":122,"./snippetBuilderPositionPicker":124,"./sui":129,react:320}],124:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PositionPicker=void 0;const o=e("react"),n=e("./data"),a=e("./snippetBuilder"),s=e("./sui"),l=e("./snippetBuilderSimulatorDisplay");class r extends n.Component{constructor(e){super(e),this.onChange=r=>e=>{const{input:t,onChange:i}=this.props;var n;a.isSnippetInputAnswerSingular(t)||(n=this.state,e=parseInt(e),isNaN(e))||e<0||this.setState({x:r?this.unScalePointX(e):n.x,y:r?n.y:this.unScalePointY(e)},()=>{var e=this.getScaledPoints();r&&i(t.answerTokens[0])(e.x.toString()),r||i(t.answerTokens[1])(e.y.toString()),this.setState({dotVisible:!0})})},this.state={x:this.unScalePointX(this.props.defaultX||80),y:this.unScalePointY(this.props.defaultY||60),dotVisible:!1},this.setDot=this.setDot.bind(this),this.onChange=this.onChange.bind(this),this.setScale=this.setScale.bind(this)}componentWillUnmount(){window.removeEventListener("resize",this.setScale)}componentDidMount(){this.setScale(),window.addEventListener("resize",this.setScale)}setScale(){var e=window.innerHeight,t=window.innerWidth;let i=t<e?t/2100:e/1003;i<.71?i=.71:1.01<i&&(i=1.01),this.setState({scale:i})}getScale(e,t){var i=this.state["scale"];return t*i/e}getXScale(){return this.getScale(160,309)}getYScale(){return this.getScale(120,227)}scalePoint(e,t){return isNaN(e)?0:Math.round(e/t)}scalePointX(e){return this.scalePoint(e,this.getXScale())}scalePointY(e){return this.scalePoint(e,this.getYScale())}unScalePoint(e,t){return isNaN(e)?0:Math.round(e*t)}unScalePointX(e){return this.unScalePoint(e,this.getXScale())}unScalePointY(e){return this.unScalePoint(e,this.getYScale())}getScaledPoints(){var{x:e,y:t}=this.state;return{x:this.scalePointX(e),y:this.scalePointY(t)}}scalePixel(e){var t=this.state["scale"];return e*t+"px"}setDot(e){const{input:t,onChange:i}=this.props,n=e.nativeEvent.offsetX,r=e.nativeEvent.offsetY;this.setState({dotVisible:!0,x:Math.round(n),y:Math.round(r)},()=>{var e;a.isSnippetInputAnswerSingular(t)||(e=this.getScaledPoints(),i(t.answerTokens[0])(e.x.toString()),i(t.answerTokens[1])(e.y.toString()))})}renderCore(){var{dotVisible:e,x:t,y:i,scale:n}=this.state,r=this.getScaledPoints();return o.createElement("div",null,o.createElement("div",{className:"ui grid"},o.createElement("div",{className:"column"},o.createElement(s.Input,{class:"position-picker preview-input",value:r.x.toString(),onChange:this.onChange(!0)})),o.createElement("div",{className:"column"},o.createElement(s.Input,{class:"position-picker preview-input",value:r.y.toString(),onChange:this.onChange(!1)}))),o.createElement(l.SimulatorDisplay,{scale:n},o.createElement("div",{ref:"positionPickerContainer",className:"position-picker container",onClick:this.setDot,style:{left:this.scalePixel(28),top:this.scalePixel(28),width:this.scalePixel(309),height:this.scalePixel(227),margin:"8px",maxWidth:this.scalePixel(309),maxHeight:this.scalePixel(227)},role:"grid"},e&&o.createElement("div",{className:"position-picker dot",style:{top:i+"px",left:t+"px"}}))))}}i.PositionPicker=r},{"./data":67,"./snippetBuilder":122,"./snippetBuilderSimulatorDisplay":125,"./sui":129,react:320}],125:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimulatorDisplay=void 0;const a=e("react"),n=e("./data");class r extends n.Component{scalePixel(e,t){var i=this.props["scale"];return""+e*i+(!t&&"px")}renderCore(){var{children:e,scale:t}=this.props,i=a.createElement("svg",{height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:"0px",top:this.scalePixel(297.85)},visibility:"visible"},a.createElement("g",{transform:"translate(18.80933368822642 18.80933368822642) scale(3.7618667376452843)"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23.813 24.362",width:"23.813",height:"24.362"},a.createElement("path",{fill:"#f290c1",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.32c3.171 0 3.348-.03 3.969-.65.618-.618.649-.804.649-3.855 0-2.426-.092-3.298-.378-3.584-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172z"}),a.createElement("path",{fill:"#f291bd",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.241c3.027-.001 3.29-.042 3.97-.627.719-.619.727-.66.727-3.855 0-2.446-.092-3.321-.378-3.607-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172zm1.799.534c.188-.002.635.288.992.645.626.626.649.781.649 4.234 0 2.368-.096 3.583-.283 3.583-.19 0-.263-1.135-.222-3.438.058-3.3.035-3.46-.552-3.969-.336-.292-.504-.532-.372-.534.131-.002.06-.12-.159-.26-.283-.184-.298-.258-.053-.261zm-4.488.525c.12 0 .22.178.22.397 0 .45-.019.466-.264.22-.247-.246-.22-.617.044-.617zm-.561 6.398c.044-.018.099.08.19.283.114.254.138.641.054.86-.169.44-.962.549-.962.132 0-.146.11-.265.246-.265s.293-.268.35-.595c.046-.261.078-.396.122-.415zM22.4 8.997c.24 0 .883.755.883 1.039 0 .387-.45.357-.704-.048-.25-.399-.356-.992-.18-.992zM.936 9.63c.027-.006.051 0 .071.02.082.081 0 .295-.18.474-.261.26-.292.23-.148-.148.074-.196.176-.327.257-.346zm21.876 2.83c.038-.01.107.097.234.315.151.26.234.595.185.745-.142.424-.477-.054-.468-.666.003-.254.01-.383.049-.394zm-22.071.88a.16.16 0 0 1 .053.02c.145.09.264.336.264.546 0 .21-.119.381-.264.381-.146 0-.265-.245-.265-.545 0-.262.091-.426.212-.403zm3.214 1.5c1.97-.026 4.558.11 4.762.355.137.166.27 1.781.296 3.59.03 2.222-.05 3.319-.25 3.385-.208.07-.296-.931-.296-3.363v-3.462H5.012c-2.294 0-3.4-.09-3.288-.271.089-.144 1.049-.218 2.231-.234zm5.258 7.66c.128.001.393.127.725.378.387.292.416.387.116.386-.218 0-.55-.176-.738-.388-.22-.25-.23-.375-.103-.375z"}),a.createElement("path",{fill:"#a3809c",d:"M12.012 0C7.81 0 7.938-.139 7.938 4.407v3.531H4.453c-4.58 0-4.453-.113-4.452 3.943 0 2.844.045 3.122.625 3.796.622.723.65.728 3.97.728h3.342v3.609c0 3.126.062 3.655.463 3.96.318.241 1.374.354 3.38.36 4.184.012 4.094.108 4.094-4.372v-3.557h3.271c3.182 0 3.29-.02 3.969-.698.675-.675.697-.798.69-3.77-.006-2.135-.116-3.214-.36-3.536-.302-.398-.821-.463-3.696-.463h-3.345V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416C15.875.199 15.22 0 12.012 0zm-.106.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.154-.112 1.996-.265 1.996-.15 0-.265-.75-.265-1.718 0-1.386-.111-1.846-.576-2.381-.56-.644-.678-.664-3.97-.664h-3.391V5.677c0-3.171-.029-3.348-.65-3.969-.547-.547-.902-.65-2.26-.65-1.359 0-1.714.103-2.261.65-.62.62-.65.798-.65 3.97v3.318h-3.32c-3.17 0-3.347.03-3.968.65-.568.568-.65.886-.65 2.532 0 1.28.122 2.005.379 2.261.29.29 1.21.378 3.969.378h3.59v3.394c0 3.205.034 3.425.612 3.968.45.422.944.576 1.852.576.682 0 1.24.119 1.24.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.579-.578-.65-.874-.65-2.711.001-1.787.084-2.16.627-2.79.62-.723.65-.728 3.968-.728h3.343V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zM9.782 11.668c.154.024.358.267.56.723.182.412.668.898 1.08 1.08.412.183.749.441.749.575 0 .133-.281.242-.625.242-.807 0-2.02-1.214-2.02-2.02 0-.426.102-.623.256-.6z"}),a.createElement("path",{fill:"#a8769a",d:"M12.06 0C7.84 0 7.939-.105 7.939 4.425v3.513H4.5c-4.598 0-4.5-.086-4.5 3.991 0 2.976.023 3.104.697 3.778.678.678.787.698 3.969.698h3.27v3.485c0 2.87.078 3.57.439 3.968.374.413.865.484 3.356.484 2.633 0 2.978-.057 3.53-.576.58-.543.613-.763.613-3.968v-3.394l3.241-.008c4.438-.011 4.697-.266 4.697-4.618 0-3.822-.02-3.84-4.234-3.84h-3.175V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.97-.657-1.172-3.814-1.172zm-.154.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381l-.034 1.653c-.018.91-.04 2.424-.047 3.366-.011 1.42-.117 1.817-.616 2.316-.33.33-.786.602-1.01.602-.225 0-.41.119-.41.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zm0 2.116c-.617 0-.793.117-.793.529 0 .291-.12.53-.265.53-.145 0-.265.237-.265.528 0 .291-.119.53-.264.53-.146 0-.265.238-.265.529 0 .29-.119.529-.264.529-.146 0-.28.208-.3.463-.019.254-.127.046-.24-.463l-.206-.926.042.926.042.926 2.646.147c1.455.081 2.735.17 2.844.199.251.064.26-1.072.013-1.714-.167-.433-.202-.419-.331.13-.128.541-.232.448-.877-.794-.402-.774-.73-1.557-.727-1.738.002-.192-.329-.331-.79-.331zm9.525 6.35c-.013.013.067.12.231.33.346.441.563.582.563.364 0-.055-.208-.264-.463-.463-.21-.165-.317-.245-.33-.231zm-14.874.021c-.772-.016-.951.065-.831.377.111.29-.285.596-1.455 1.125-1.343.607-1.608.834-1.609 1.387-.001.56.264.78 1.722 1.432 1.728.772 1.875 1.067.643 1.288-.364.065.35.115 1.588.11 1.237-.005 1.802-.055 1.257-.112l-.993-.104v-2.608c0-1.838.098-2.647.331-2.741.182-.073-.112-.143-.653-.154zm5.365.464c-.676.022-1.35.282-1.77.772-.651.756-.817 1.389-.364 1.389.144 0 .41-.238.592-.53.426-.68 1.271-.673 2.152.02.85.668.931 1.812.168 2.362-.29.21-.529.474-.529.587 0 .383.718.21 1.42-.342.93-.732.996-2.67.121-3.602-.434-.462-1.113-.678-1.79-.656zm5.23.044c-.229 0-.313 4.58-.089 4.804.071.071 1.017-.296 2.1-.816 1.73-.83 1.973-1.034 1.987-1.673.01-.4-.1-.728-.244-.728-.143 0-.997-.357-1.898-.793-.901-.437-1.737-.794-1.856-.794zm-15.98 3.386c-.034.018-.058.178-.062.45-.005.437.05.648.122.469.073-.18.077-.537.01-.794-.025-.097-.05-.136-.07-.125zm1.704 1.673a2.998 2.998 0 0 0-.558.046c-.329.063-.122.117.46.12.582.003.852-.049.599-.115a2.182 2.182 0 0 0-.501-.05zm10.134 2.282c-.297.002-.625.008-.97.02-1.538.051-2.515.193-2.515.364 0 .154.387 1.092.86 2.084.721 1.513.967 1.804 1.521 1.81.568.004.793-.279 1.588-2.005.51-1.105.956-2.083.993-2.174.028-.067-.585-.104-1.477-.099zm-3.946 4.427a.043.043 0 0 0-.03.012c-.062.063.037.296.221.517.472.57.6.501.216-.114-.155-.249-.325-.419-.407-.415z"}),a.createElement("path",{fill:"#2f99a1",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381v3.318c0 3.172-.029 3.349-.65 3.97-.356.356-.833.649-1.058.649-.224 0-.409.119-.409.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),a.createElement("path",{fill:"#96266c",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.583.582.65.87.65 2.79s-.067 2.207-.65 2.79c-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.588.588-.854.647-2.843.633-1.965-.015-2.258-.083-2.79-.652-.553-.59-.596-.878-.596-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),a.createElement("path",{fill:"#5b3b6a",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.797-.649-3.968-.649h-3.32v-3.61c0-3.126-.062-3.655-.463-3.96-.317-.24-1.364-.353-3.319-.36zm-.112.52c1.973 0 2.277.067 2.79.613.528.562.575.887.575 3.969v3.356h3.394c3.205 0 3.425.034 3.968.612.495.527.575.919.575 2.79 0 1.96-.064 2.243-.649 2.828-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.585.585-.865.649-2.863.649-1.974 0-2.278-.067-2.79-.613-.529-.562-.576-.886-.576-3.968v-3.357H5.074c-3.205 0-3.426-.034-3.969-.612-.498-.53-.576-.917-.576-2.863 0-2.072.053-2.296.664-2.827.605-.527.951-.577 3.969-.577h3.305V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.864-.65zm-.046 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.009.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.057-2.38.127s.444 1.027.987 2.125c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),a.createElement("path",{d:"M9.763 0c-.295.002-.765.24-1.176.65-.357.357-.65.714-.65.794 0 .323.437.111.794-.385.21-.291.594-.53.853-.53.258 0 .47-.118.47-.264 0-.182-.114-.265-.29-.265zm4.286 0c-.177 0-.29.083-.29.265 0 .146.187.265.415.265 1.002 0 1.172.63 1.172 4.346 0 2.218.101 3.591.265 3.591.163 0 .264-1.37.264-3.584 0-3.452-.023-3.607-.649-4.233-.41-.41-.882-.648-1.177-.65zM4.883 7.938c-3.452 0-3.608.024-4.233.65C.293 8.945 0 9.42 0 9.646c0 .225.12.409.265.409.145 0 .264-.188.264-.416 0-1.002.632-1.172 4.347-1.172 2.218 0 3.59-.101 3.59-.264 0-.164-1.37-.265-3.583-.265zm18.04.612a.168.168 0 0 0-.115.054c-.102.11-.037.253.145.318s.33.347.33.626.12.507.265.507c.146 0 .265-.188.265-.416 0-.459-.579-1.112-.89-1.089zM.265 13.76c-.485 0-.273.81.385 1.467.62.62.797.65 3.968.65h3.32v3.58c0 3.35.038 3.623.595 4.218.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.626-.626.65-.781.65-4.234v-3.584h3.391c3.291 0 3.41-.02 3.969-.663.603-.693.766-1.453.312-1.453-.145 0-.265.187-.265.416 0 1.001-.63 1.171-4.346 1.171h-3.591v3.591c0 3.716-.17 4.347-1.172 4.347-.228 0-.416.119-.416.264 0 .152-.793.265-1.852.265-1.058 0-1.852-.113-1.852-.265 0-.145-.186-.264-.415-.264-1.002 0-1.172-.631-1.172-4.347v-3.59h-3.59c-3.716 0-4.348-.17-4.348-1.172 0-.229-.119-.416-.264-.416z"})),a.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"0",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),a.createElement("rect",{className:"controller-button-overlay",x:"15.875333333333332",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),a.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"15.875333333333332",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),a.createElement("rect",{className:"controller-button-overlay",x:"0",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}))),n=a.createElement("svg",{height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(240.8),top:this.scalePixel(297.85)},visibility:"visible"},a.createElement("g",{transform:"translate(17.15858198888469 17.15858198888469) scale(3.4317163977769383)"},a.createElement("g",{transform:"translate(13.533000000000001 2.2554999999999996)"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},a.createElement("path",{fill:"#ff8135",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),a.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.146 7.611 1.146 7.611c.792-4.598 3.68-6.217 8.39-6.006 0 0-4.269-1.965-7.082 1.014z"}),a.createElement("path",{fill:"#af4282",d:"M8.745 9.825h1.423l-1.72-6.914H7.027L2.542 9.825h1.412c.444-.507.61-1.53 1.45-1.304H8.42l.326 1.304zm-.602-2.519H5.574c.621-.807 1.397-2.523 1.92-2.76l.649 2.76z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),a.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})),a.createElement("g",{transform:"translate(0 13.533000000000001)"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},a.createElement("path",{fill:"#ff91c4",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),a.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.051 7.563 1.051 7.563c.793-4.597 3.823-6.169 8.533-5.958 0 0-4.317-1.965-7.13 1.014z"}),a.createElement("path",{fill:"#af4282",d:"M5.337 7.226c.909.088 1.876-.201 2.736.21.288.113.37.493.32.773-.143.515-.716.742-1.197.817-.607-.047-1.91.169-2.181-.227-.058-.371.217-.697.222-1.073l.1-.5zM5.88 4.49c.81.122 1.664-.209 2.444.123.263.119.537.35.451.67-.591 1.227-2.213.797-3.21.797l.315-1.59zm2.233-1.186h-3.28L3.45 10.22c1.523-.054 3.064.132 4.572-.152 1.117-.305 1.976-1.536 1.666-2.692-.146-.282-.515-.448-.562-.79.088-.354.606-.278.717-.652.452-.693.41-1.769-.288-2.287-.42-.274-.95-.333-1.442-.342z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),a.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})))),r=a.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(105.25),top:this.scalePixel(284)}},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},a.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806-.072.806.073 0 .17 1.912.36 5.969.36s6.334 0 6.334-.169c0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z",fill:"#f290c1"}),a.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806.008.806.153 0 .17 1.418-.021 5.376-.021 3.85 0 6.693.297 6.795.132.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z",fill:"#f291bd"}),a.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 1.076.04 1.076.185 0 .17 1.807.09 5.765.09 3.85 0 6.034.154 6.136-.011.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-3.218.34-4.26z",fill:"#a3809c"}),a.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .386.232.542.241.535.03.73.005 1.13-.049.4-.055 3.114.04 6.344-.023l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.714-3.018.251-4.05zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0 .39.053.054-.311-.337-.364-1.171-1.011-1.289-1.011zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z",fill:"#a8769a"}),a.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.703.965-2.624.965-1.153 0-2.28.064-2.28.217 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z",fill:"#2f99a1"}),a.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.016.103.855-.735c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635c-.845-.904-.755-2.749.118-3.62z",fill:"#5b3b6a"}),a.createElement("path",{d:"M16.673 1.587c-.12-.084-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65-13.228-.19-.698-.46c-.356-.357-.506-.943-.506-1.17 0-.224-.262-.297-.407-.297-.533 0-.005 1.371.833 2.25l.622.359 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.034-1.037-.153-1.12z"}),a.createElement("text",{style:{lineHeight:"1.25"},x:"2.765",y:"2.203",fontWeight:"400",fontSize:"5.333",fontFamily:"sans-serif",letterSpacing:"0",wordSpacing:"0"}),a.createElement("g",{"aria-label":"reset",style:{lineHeight:1.25},fontWeight:"400",fontSize:"4.667",fontFamily:"Arial Rounded MT Bold",letterSpacing:"0",wordSpacing:"0",fill:"#5b3b6a"},a.createElement("path",{d:"M3.417 3.587v.52c0 .125-.03.22-.088.284a.298.298 0 0 1-.226.093.285.285 0 0 1-.221-.095c-.058-.064-.087-.158-.087-.283V2.374c0-.28.101-.419.303-.419.104 0 .178.033.224.098a.54.54 0 0 1 .075.29c.074-.128.15-.225.228-.29a.478.478 0 0 1 .314-.098c.13 0 .258.033.38.098.124.065.185.152.185.26a.249.249 0 0 1-.08.19.242.242 0 0 1-.168.072.815.815 0 0 1-.166-.041.74.74 0 0 0-.23-.043.335.335 0 0 0-.224.073c-.058.047-.055.165-.087.26-.032.093-.101.158-.113.289-.013.129-.019.287-.019.474zM6.464 3.372H5.247c.002.142.03.266.084.374.057.108.13.19.221.244a.59.59 0 0 0 .306.082c.074 0 .094-.04.155-.057.062-.018.138-.093.196-.13.058-.037.11-.046.16-.088.048-.043.143-.053.22-.126a.204.204 0 0 1 .137-.041c.064 0 .115.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.798.798 0 0 1-.2.216c-.089.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.758-.05-.98-.278-.221-.228-.285-.6-.285-.99 0-.185.028-.355.082-.511.055-.158.135-.293.24-.406.105-.112.234-.198.387-.257.153-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.086.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zM5.247 3.02l1.049-.016c-.016-.212.006-.355-.094-.46a.51.51 0 0 0-.392-.16.5.5 0 0 0-.383.162c-.099.107-.159.265-.18.474zM9.506 3.671a.768.768 0 0 1-.125.442.776.776 0 0 1-.372.278c-.162.062-.36.093-.595.093-.223 0-.414-.034-.574-.102a.841.841 0 0 1-.353-.255.521.521 0 0 1-.114-.31.25.25 0 0 1 .257-.248c.066 0 .116.015.151.047a.524.524 0 0 1 .1.135c.064.11.076.146.165.2.266-.033.433.05.587.05.124 0 .067.053.146-.002.08-.056.12-.12.12-.191 0-.11-.041-.19-.125-.24a1.515 1.515 0 0 0-.407-.143 3.538 3.538 0 0 1-.524-.166.873.873 0 0 1-.322-.233.53.53 0 0 1-.12-.353c0-.125.037-.242.111-.353a.76.76 0 0 1 .328-.265c.146-.066.322-.1.527-.1.16 0 .305.017.433.05.129.034.236.079.32.135a.645.645 0 0 1 .197.187.361.361 0 0 1 .068.2.23.23 0 0 1-.073.176c-.047.045-.114.068-.203.068a.254.254 0 0 1-.164-.055 1.116 1.116 0 0 1-.152-.164.562.562 0 0 0-.167-.146.524.524 0 0 0-.26-.054.503.503 0 0 0-.28.073c-.074.047-.111.106-.111.177 0 .066.027.12.082.162.054.041.192.06.284.087.093.027.157.076.32.116.192.047.35.103.471.169a.767.767 0 0 1 .278.232c.064.088.096.19.096.303zM11.773 3.372l-1.121.064c.001.141-.066.202-.011.31.056.108.13.19.22.244a.59.59 0 0 0 .306.082.764.764 0 0 0 .203-.025.71.71 0 0 0 .18-.082c.058-.038.11-.078.16-.12l.189-.174a.204.204 0 0 1 .136-.041c.064 0 .116.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.797.797 0 0 1-.2.216c-.088.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.71-.113-.932-.341-.221-.228-.332-.537-.332-.928 0-.184.027-.354.082-.51.054-.158.134-.293.239-.406.105-.112.234-.198.387-.257.154-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.087.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zm-1.217-.353h1.128c-.015-.212-.073-.371-.173-.476-.099-.106-.182-.064-.344-.064-.155 0-.267.006-.367.114-.099.106-.222.217-.244.426zM12.842 2.01h.068v-.374c0-.1.003-.178.007-.235a.362.362 0 0 1 .046-.148.272.272 0 0 1 .104-.102.307.307 0 0 1 .367.048c.043.04.07.088.08.145.012.057-.006.36.002.464l.016.202h.228c.088 0 .155.021.2.064.048.04.071.094.071.16 0 .083-.033.141-.1.175-.065.033-.208-.048-.283.05l-.108.143c-.082.381 0 .762 0 1.144 0 .097-.005.03.001.082a.245.245 0 0 0 .055.128c.03.032.08.048.146.048a.82.82 0 0 0 .148-.019.729.729 0 0 1 .146-.02c.05 0 .095.02.134.061.041.04.062.09.062.149 0 .1-.055.177-.164.23-.11.053-.267.08-.472.08-.194 0-.342-.033-.442-.099a.46.46 0 0 1-.198-.27c-.03-.116-.101-.27-.093-.463.015-.398-.12-.343.047-1.194h-.082c-.09 0-.158-.022-.205-.064a.209.209 0 0 1-.07-.162c0-.065.024-.118.072-.16a.326.326 0 0 1 .217-.063z"}))),a.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})),o=a.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(192.75),top:this.scalePixel(284)}},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},a.createElement("path",{fill:"#f290c1",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.293.265 6.35.265 4.057 0 6.35-.096 6.35-.265 0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z"}),a.createElement("path",{fill:"#f291bd",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z"}),a.createElement("path",{fill:"#a3809c",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-2.193.34-3.236z"}),a.createElement("path",{fill:"#a8769a",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .46.108.542.241.082.133.476.196.876.142.4-.055 3.368-.151 6.598-.214l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.793-2.239.172-3.272zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0-.07-.297-.407-.661-.337-.364-.71-.661-.828-.661zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z"}),a.createElement("path",{fill:"#2f99a1",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.989.917-2.91.917-1.153 0-1.994.112-1.994.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z"}),a.createElement("path",{fill:"#5b3b6a",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635C.284 3.72.31 2.05 1.183 1.179z"}),a.createElement("path",{d:"M16.673 1.587c-.146 0-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65H1.833l-.65-.65C.827 4.285.534 3.81.534 3.584c0-.225-.119-.409-.264-.409-.533 0-.243.831.595 1.709l.86.9 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.119-1.2-.264-1.2z"}),a.createElement("path",{fill:"#5b3b6a",d:"M3.773 1.723c-.1.007-.2.056-.304.175-.243.263-.34-.344-.645-.087-.219.159-.07.434-.108.658v1.597h.56c.051-.533-.12-1.11.123-1.61.36-.45 1.038.15.82.609.04.378-.212 1.192.456 1.001h.105c.056-.535-.13-1.11.133-1.612.335-.39.855.064.83.478.034.347-.282.99.169 1.135.545.15.278-.472.348-.78-.008-.428.044-.943-.287-1.27-.348-.327-.983-.361-1.302.025-.313.015-.599-.34-.898-.319zm4.12.001c-.599.022-1.183.496-1.174 1.125-.051.62.434 1.27 1.082 1.27.367.008.959.003 1.073-.427-.266-.54-.722.142-1.15-.112-.45-.06-.384-.634.083-.451.419.035.842-.01 1.263.007.127-.605-.26-1.348-.923-1.392a1.13 1.13 0 0 0-.255-.02zm1.927.028c-.04-.012-.09-.002-.154.047-.34.104-.115.567-.174.837v1.431h.555c.06-.543-.157-1.163.19-1.642.384-.399 1.11.097.933.6.106.316-.215.898.167 1.042h.393c-.056-.651.16-1.385-.237-1.963-.328-.396-1.002-.468-1.362-.076-.147.001-.19-.238-.311-.276zm2.315.054c.05.645-.141 1.359.213 1.944.299.387.96.513 1.314.132.25-.084.356.443.641.157.17-.234.03-.55.07-.826V1.806h-.555c-.06.543.156 1.163-.19 1.642-.385.398-1.11-.097-.933-.601-.106-.318.256-1.05-.27-1.041h-.29zm-4.228.424c.268-.015.542.11.618.389-.382.126-.79.025-1.183.054h-.028c.06-.275.324-.429.593-.443z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),a.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"}));return a.createElement("div",{className:"simulator-display",id:"wrap",style:{transform:`scale(${t})`,transformOrigin:"0 0",width:this.scalePixel(368),height:this.scalePixel(432.938)}},a.createElement("div",{className:"debug-stats",id:"debug-stats"}),a.createElement("div",{className:"screen-back",id:"screen-back"}),a.createElement("div",{id:"screen"},a.createElement("div",{id:"paint-surface-container",style:{top:this.scalePixel(12),left:this.scalePixel(12)}},a.createElement("canvas",{id:"paint-surface",width:"160",height:"120",className:"borders",style:{transform:`scale(${t})`,transformOrigin:"0 0",height:229,width:312,left:this.scalePixel(28),top:this.scalePixel(20),clipPath:"polygon(0px 5.33333px, 5.33333px 0px, 338.667px/1.2) 0px, 344px 5.33333px, 344px 256.667px, 338.667px 262px, 5.33333px 262px, 0px 256.667px)"}})),a.createElement("div",{id:"controls",className:"no-focus"},i,n,r,o),e),a.createElement("div",{id:"instructions"}))}}i.SimulatorDisplay=r},{"./data":67,react:320}],126:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.tryInit=void 0;var n=pxt.Cloud,r=pxt.Util;let o,a={};function s(e){var t=r.lookup(a,e.result.socket);t?t.onOOB(e):console.error("Dropping data for "+e.result.socket)}i.tryInit=function(){pxt.BrowserUtils.isLocalHost()&&n.localToken&&(pxt.mkTCPSocket=(e,t)=>new l(e,t))};class l{constructor(e,t){this.host=e,this.port=t,this.onData=e=>{},this.onError=e=>{}}onOOB(e){var t;"data"==e.op?(t=r.stringToUint8Array(atob(e.result.data)),this.onData(t)):"close"==e.op&&(this.sockId=null,delete a[e.result.socket])}error(e){e=new Error(r.lf("TCP error on socket {0}:{1} ({2})",this.host,this.port,e));throw this.onError(e),e}disconnectAsync(){return this.sockId?o.opAsync("close",{socket:this.sockId}).then(()=>{this.sockId=null}):Promise.resolve()}sendPacketAsync(e){return this.sockId||r.userError("Not connected"),o.opAsync("send",{socket:this.sockId,data:r.toHex(e),encoding:"hex"})}sendSerialAsync(e,t){return Promise.reject(new Error("No serial on socket"))}connectAsync(){return o||(pxt.BrowserUtils.isLocalHost()&&n.localToken||r.userError(lf("TCP sockets not available here")),pxt.debug("initializing tcp pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${n.localToken}/tcp`,s)),this.sockId?Promise.resolve():o.opAsync("open",{host:this.host,port:this.port}).then(e=>{e.socket||this.error(e.errorMessage),this.sockId=e.socket,a[this.sockId]=this})}}},{}],127:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initTutorial=i.click=i.tutorialNext=i.tutorialStep=void 0;const n=e("./audio"),r={};function o(e){const t=(pxt.appTarget.appTheme.sounds||{})[e];return pxt.options.light||!t?Promise.resolve(void 0):(e=r[t])?Promise.resolve(e):(e=pxt.webConfig.commitCdnUrl+"sounds/"+t,pxt.Util.requestAsync({url:e,headers:{Accept:"audio/"+t.slice(-3)},responseArrayBuffer:!0}).then(e=>n.loadAsync(e.buffer)).then(e=>r[t]=e))}function a(e){pxt.options.light||o(e).then(e=>e?n.play(e,.2):void 0)}i.tutorialStep=function(){a("tutorialStep")},i.tutorialNext=function(){a("tutorialNext")},i.click=function(){a("click")},i.initTutorial=function(){pxt.options.light||Promise.all([o("tutorialStep"),o("tutorialNext"),o("click")])}},{"./audio":7}],128:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("./core"),r=e("react");i.Editor=class{constructor(e){this.parent=e,this.isVisible=!1,this.changeCallback=()=>{},this.isReady=!1}setVisible(e){this.isVisible=e}simStateChanged(){}acceptsFile(e){return!1}getViewState(){return{}}getCurrentSource(){return this.currSource}getStyle(e){var t={display:this.isVisible?"block":"none"};return Object.assign(t,e)}getId(){return"editor"}displayOuter(e){return r.createElement("div",{className:"full-abs",key:this.getId(),id:this.getId(),style:this.getStyle(e)},this.display())}display(){return null}beforeCompile(){}prepare(){this.isReady=!0}resize(e){}snapshotState(){return null}unloadFileAsync(){return Promise.resolve()}isIncomplete(){return!1}hasHistory(){return!0}hasUndo(){return!0}hasRedo(){return!0}undo(){}redo(){}zoomIn(){}zoomOut(){}setScale(e){}closeFlyout(){}clearCaches(){}loadFileAsync(e,t){return this.currSource=e.content,this.setDiagnostics(e,this.snapshotState()),Promise.resolve()}domUpdate(){}setDiagnostics(e,t){}setViewState(e){}saveToTypeScriptAsync(e=0){return Promise.resolve(void 0)}highlightStatement(e,t){return!1}clearHighlightedStatements(){}setHighContrast(e){}hasEditorToolbar(){return!0}filterToolbox(e){}insertBreakpoint(){}updateBreakpoints(){}getBreakpoints(){return[]}updateToolbox(){}onExceptionDetected(e){n.warningNotification(lf("Program Error: {0}",null==e?void 0:e.exceptionMessage))}validateTutorialCode(e){}}},{"./core":64,react:320}],129:[function(e,t,T){"use strict";var A=this&&this.__rest||function(e,t){var i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i};Object.defineProperty(T,"__esModule",{value:!0}),T.PlainCheckbox=T.ProgressCircle=T.Tooltip=T.Loader=T.Dimmer=T.Modal=T.Menu=T.MenuItem=T.Icon=T.Checkbox=T.Input=T.Field=T.helpIconLink=T.Link=T.CloseButton=T.Button=T.ButtonMenuItem=T.Item=T.Select=T.ExpandableMenu=T.DropdownMenu=T.StatelessUIElement=T.UIElement=T.fireClickOnEnter=T.genericContent=T.cx=T.appElement=void 0;const N=e("react"),i=e("react-dom"),I=e("react-modal"),r=e("react-tooltip"),n=e("./data"),a=e("./core"),O=e("./auth");function P(e){return e.filter(e=>!!e&&""!=e.trim()).join(" ")}function o(e,t,i=!1){return`${e} ${i?"":t.icon&&t.text?"icon icon-and-text":t.icon?"icon":""} ${t.inverted?"inverted":""} `+(t.className||"")}function p(e){let t=[e.icon?N.createElement(T.Icon,{key:"iconkey",icon:e.icon+(e.text?" icon-and-text ":"")+(e.iconClass?" "+e.iconClass:"")}):null,e.text?N.createElement("span",{key:"textkey",className:"ui text"+(e.textClass?" "+e.textClass:"")},e.text):null];return t=e.icon&&e.rightIcon?t.reverse():t}function D(e){var t=a.keyCodeFromEvent(e);t!==a.ENTER_KEY&&t!==a.SPACE_KEY||(e.preventDefault(),e.currentTarget.click())}T.appElement=document.getElementById("content"),T.cx=P,T.genericContent=p,T.fireClickOnEnter=D;class s extends n.Component{}T.UIElement=s;class l extends n.PureComponent{}T.StatelessUIElement=l,T.DropdownMenu=class extends s{constructor(){super(...arguments),this.navigateToNextElement=(e,t,i)=>{var n=this.refs.dropdown,r=a.keyCodeFromEvent(e),o=e.currentTarget;40===r?(e.preventDefault(),e.stopPropagation(),i&&this.focus(i)):38===r?(e.preventDefault(),e.stopPropagation(),t?this.focus(t):(n.focus(),this.setState({open:!1}))):r!==a.SPACE_KEY&&r!==a.ENTER_KEY||(e.preventDefault(),e.stopPropagation(),o.click())},this.closeOnEscape=e=>{a.keyCodeFromEvent(e)===a.ESC_KEY&&(e.preventDefault(),this.refs.dropdown.focus(),this.isMouseDown=!0,this.hide())},this.handleClick=e=>{this.props.onClick&&!this.props.onClick()||this.toggle(),e.stopPropagation()},this.handleClose=()=>{this.isMouseDown=!1;var e=document.activeElement===this.refs.dropdown;this.setState({focus:e})},this.handleMouseDown=e=>{this.isMouseDown=!0,document.addEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleDocumentMouseUp=e=>{this.isMouseDown=!1,document.removeEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleFocus=e=>{var t=this.state["focus"];t||this.setState({focus:!0})},this.handleBlur=e=>{this.isMouseDown||setTimeout(()=>{var e=this.isChildFocused();this.setState({focus:e})},1)},this.captureMouseEvent=e=>{e.stopPropagation()},this.handleKeyDown=e=>{var t=a.keyCodeFromEvent(e);40===t?(e.preventDefault(),this.focusFirst=!0,this.show()):t!==a.SPACE_KEY&&t!==a.ENTER_KEY||(e.preventDefault(),this.toggle())}}show(){this.setState({open:!0,focus:!0})}hide(){this.setState({open:!1})}toggle(){this.state.open?this.hide():this.show()}focus(e){this.setActive(e),e.focus()}blur(e){this.isActive(e)&&pxt.BrowserUtils.removeClass(e,"active")}setActive(e){this.isActive(e)||pxt.BrowserUtils.addClass(e,"active")}isActive(e){return e&&pxt.BrowserUtils.containsClass(e,"active")}getChildren(){var t=this.refs.menu,i=[];for(let e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];pxt.BrowserUtils.containsClass(n,"divider")||pxt.BrowserUtils.containsClass(n,"mobile")&&!pxt.BrowserUtils.isMobile()||i.push(n)}return i}isChildFocused(){return this.refs.menu.contains(document.activeElement)}componentDidMount(){var t=this.getChildren();for(let e=0;e<t.length;e++){const i=0<e?t[e-1]:void 0,n=t[e],r=e<t.length?t[e+1]:void 0;n.addEventListener("keydown",e=>{this.navigateToNextElement(e,i,r)}),n.addEventListener("focus",e=>{this.setActive(n)}),n.addEventListener("blur",e=>{this.blur(n)}),e==t.length-1&&n.addEventListener("keydown",e=>{var t=a.keyCodeFromEvent(e);e.shiftKey||t!==a.TAB_KEY||this.hide()})}}componentDidUpdate(e,t){var i=this.getChildren();for(let e=0;e<i.length;e++)i[e].tabIndex=this.state.open?0:-1;if(t.open!=this.state.open&&this.state.open){const e=this.refs.dropdown,t=this.refs.menu;e.offsetLeft+t.offsetWidth>window.innerWidth&&pxt.BrowserUtils.addClass(t,"left")}!t.focus&&this.state.focus||!t.focus||this.state.focus||this.isMouseDown||this.hide(),!t.open&&this.state.open?document.addEventListener("keydown",this.closeOnEscape):t.open&&!this.state.open&&(document.removeEventListener("keydown",this.closeOnEscape),this.handleClose()),this.focusFirst&&0<i.length&&(this.focus(i[0]),this.focusFirst=!1)}renderCore(){var{disabled:e,title:t,role:i,icon:n,className:r,titleContent:o,children:a,displayAbove:s,displayLeft:l,displayRight:c,dataTooltip:d}=this.props,u=this.state["open"],i={role:i||"combobox","aria-disabled":e,"aria-haspopup":!!e,"aria-expanded":u},e={role:"menu","aria-label":lf("Dropdown menu {0}",t),"aria-hidden":!!u},n=P(["ui",u?"active visible":"","dropdown",n?"icon":"",r||"",s?"menuAbove":"",c?"menuRight":"",l?"menuLeft":""]),r=P(["menu",u?"visible transition":""]);return N.createElement("div",Object.assign({role:"listbox",ref:"dropdown",title:t},i,{id:this.props.id,className:n,"data-tooltip":d,onMouseDown:this.handleMouseDown,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0}),o||p(this.props),N.createElement("div",Object.assign({ref:"menu"},e,{className:r,role:"menu",onMouseDown:this.captureMouseEvent,onClick:this.captureMouseEvent}),a))}},T.ExpandableMenu=class extends s{constructor(){super(...arguments),this.hide=()=>{this.setState({expanded:!1});var e=this.props["onHide"];e&&e()},this.show=()=>{this.setState({expanded:!0});var e=this.props["onShow"];e&&e()},this.toggleExpanded=()=>{var e=this.state["expanded"];e?this.hide():this.show()}}render(){var{title:e,children:t}=this.props,i=this.state["expanded"];return N.createElement("div",{className:"expandable-menu"},N.createElement(M,{className:"no-select menu-header",icon:"no-select chevron "+(i?"down":"right"),text:e,ariaExpanded:i,onClick:this.toggleExpanded,role:"button"}),i&&N.createElement("div",{className:"expanded-items"},t))}},T.Select=class extends s{constructor(e){super(e),this.handleOnChange=e=>{var t=this.props["onChange"];this.setState({selected:e.target.value}),t&&t(e.target.value)};e=e.options;this.state={selected:e[0]&&e[0].value+""}}render(){const{options:e,label:t,"aria-label":i}=this.props,n=this.state["selected"];return N.createElement("div",null,t&&t+" ",N.createElement("select",{value:n,className:"ui dropdown",onChange:this.handleOnChange,"aria-label":i},e.map(e=>e&&N.createElement("option",{"aria-selected":n===e.value,value:e.value,key:e.value},e.display||e.value))))}};class c extends n.Component{renderCore(){var{text:e,title:t,ariaLabel:i,ariaHidden:n}=this.props;return N.createElement("div",{className:o("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,"aria-label":i||t||e,"aria-selected":this.props.active,"aria-hidden":n,title:t||e,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onTouchStart:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onTouchEnd:this.props.onMouseUp,onMouseLeave:this.props.onMouseLeave,onKeyDown:this.props.onKeyDown||D},p(this.props),this.props.children)}}T.Item=c,T.ButtonMenuItem=class extends s{renderCore(){return N.createElement("div",{className:o("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,title:this.props.title||this.props.text,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||D},N.createElement("div",{className:o("ui button",this.props)},p(this.props),this.props.children))}};class L extends l{renderCore(){var{color:e,size:t,disabled:i,loading:n}=this.props,e=P([e,t,i||n?"disabled":"",n?"loading":"",o("ui button",this.props)]),t=N.createElement("button",{className:e,id:this.props.id,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,autoFocus:this.props.autoFocus},p(this.props),this.props.children);return this.props.tooltipId&&!pxt.BrowserUtils.isIOS()?N.createElement(b,{id:this.props.tooltipId,content:this.props.tooltip||this.props.title,place:this.props.tooltipPlace,delayShow:this.props.tooltipDelayShow},t):t}}T.Button=L;class R extends l{renderCore(){var e=this.props["onClick"];return N.createElement("div",{role:"button",className:"closeIcon",tabIndex:0,onClick:e,onKeyDown:D,"aria-label":lf("Close")},N.createElement(T.Icon,{icon:"close remove circle"}))}}T.CloseButton=R;class M extends l{renderCore(){return N.createElement("a",{className:o("ui",this.props)+(this.props.loading?" loading":"")+(this.props.disabled?" disabled":""),id:this.props.id,href:this.props.href,target:this.props.target,rel:this.props.rel||(this.props.target?"noopener noreferrer":""),download:this.props.download,ref:this.props.refCallback,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||D},p(this.props),this.props.children)}}T.Link=M,T.helpIconLink=function(e,t){return N.createElement(M,{className:"help-link",href:e,icon:"help circle",target:"_blank",role:"link",title:t})};class f extends n.Component{renderCore(){return N.createElement("div",{className:"field"},this.props.label?N.createElement("label",{htmlFor:this.props.ariaLabel?void 0:this.props.htmlFor},this.props.label):null,this.props.ariaLabel&&this.props.htmlFor?N.createElement("label",{htmlFor:this.props.htmlFor,className:"accessible-hidden"},this.props.ariaLabel):"",this.props.children)}}T.Field=f;class d extends n.Component{constructor(e){super(e),this.state={value:e.value},this.copy=this.copy.bind(this),this.handleClick=this.handleClick.bind(this),this.handleChange=this.handleChange.bind(this),this.handleEnterPressed=this.handleEnterPressed.bind(this)}componentDidMount(){var{selectOnMount:e,autoFocus:t}=this.props;e&&t&&this.refs.inputField.select()}UNSAFE_componentWillReceiveProps(e){this.setState({value:e.value})}clearValue(){this.setState({value:void 0})}copy(){this.setState({copied:!1});const e=this.props,t=i.findDOMNode(this);if(e.lines&&1!=e.lines){const e=t.getElementsByTagName("textarea")[0];e.focus(),e.setSelectionRange(0,9999)}else{const e=t.getElementsByTagName("input")[0];e.focus(),e.setSelectionRange(0,9999)}try{const e=document.execCommand("copy");pxt.debug("copy: "+e),this.setState({copied:!!e})}catch(e){this.setState({copied:!1})}}handleClick(e){this.props.selectOnClick&&e.target.setSelectionRange(0,9999)}handleChange(e){e=e.target.value;this.props.readOnly||this.state&&this.state.value===e||this.setState({value:e,copied:!1}),this.props.onChange&&this.props.onChange(e)}handleEnterPressed(e){var t;a.keyCodeFromEvent(e)===a.ENTER_KEY&&(t=this.props["onEnter"],t)&&(e.preventDefault(),t())}renderCore(){var e=this.props,{copy:t,error:i,ariaLabel:n,id:r,label:o,inputLabel:a,lines:s,autoFocus:l,placeholder:c,readOnly:d,autoComplete:u}=e,{value:p,copied:h}=this.state,h=t&&document.queryCommandSupported("copy")?N.createElement(L,{className:`ui right labeled ${h?"green":"primary"} icon button`,text:h?lf("Copied!"):lf("Copy"),icon:"copy",onClick:this.copy}):null;return N.createElement(f,{ariaLabel:n,htmlFor:r,label:o},N.createElement("div",{className:"ui input"+(e.inputLabel?" labelled":"")+(t?" action fluid":"")+(e.disabled?" disabled":"")},a?N.createElement("div",{className:"ui label"},a):"",s&&1!=s?N.createElement("textarea",{id:r,className:"ui input "+(e.class||"")+(a?" labelled":""),rows:s,placeholder:c,value:p||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed}):N.createElement("input",{ref:"inputField",autoFocus:l,id:r,className:e.class||"",type:e.type||"text",placeholder:c,value:p||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed,autoComplete:u?"":"off",autoCorrect:u?"":"off",autoCapitalize:u?"":"off",spellCheck:u}),h),i?N.createElement("div",{className:"ui yellow message"},i):void 0)}}T.Input=d;class u extends n.Component{constructor(e){super(e),this.state={},this.handleChange=this.handleChange.bind(this)}handleChange(e){this.props.onChange(e.currentTarget.checked)}renderCore(){var e=this.props;return N.createElement(f,{label:e.label},N.createElement("div",{className:"ui toggle checkbox"},N.createElement("input",{type:"checkbox",checked:e.checked,"aria-checked":e.checked,"aria-label":e.label||e.inputLabel,onChange:this.handleChange}),e.inputLabel?N.createElement("label",null,e.inputLabel):void 0))}}T.Checkbox=u,T.Icon=e=>{var{icon:t,className:i,onClick:n,onKeyDown:r,children:o}=e,e=A(e,["icon","className","onClick","onKeyDown","children"]);return N.createElement("i",Object.assign({className:`icon ${t} `+(i||""),onClick:n,onKeyDown:r||D,"aria-hidden":!0,role:"presentation"},e),o)};class h extends n.Component{constructor(e){super(e),this.handleClick=e=>{var t=this.props["onClick"];t&&t(e,this.props)}}renderCore(){var{active:e,children:t,className:i,color:n,content:r,fitted:o,header:a,icon:s,link:l,name:c,onClick:d,position:u,ariaControls:p,id:h,tabIndex:f,dataTooltip:m}=this.props,n=P([n,u,e?"active":"",!0===s||s&&!c&&!r?"icon":"",a?"header":"",l||d?"link":"",o?1==o?""+o:"fitted "+o:"","item",i]);return t?N.createElement("div",{role:"menuitem",className:n,onClick:this.handleClick},t):N.createElement("div",{id:h,key:h,tabIndex:null!=f?f:-1,className:n,onClick:this.handleClick,onKeyDown:D,role:"tab","aria-controls":p,"aria-selected":e,"aria-label":""+(r||c),"data-tooltip":m},s?N.createElement(T.Icon,{icon:s}):void 0,r||c)}}T.MenuItem=h;class m extends n.Component{constructor(e){super(e),this.handleKeyboardNavigation=r=>{var r=a.keyCodeFromEvent(r),o=37===r||38===r,r=39===r||40===r;if(o||r){let e,t=this.child(".item"),i=-1,n=0;for(;-1===i&&n<t.length;)pxt.BrowserUtils.containsClass(t[n],"active")&&(i=n),n++;-1!==i&&(o&&!pxt.Util.isUserLanguageRtl()||r&&pxt.Util.isUserLanguageRtl()?e=0===i?t[t.length-1]:t[i-1]:(r&&!pxt.Util.isUserLanguageRtl()||o&&pxt.Util.isUserLanguageRtl())&&(e=i===t.length-1?t[0]:t[i+1]),void 0!==e)&&(e.click(),e.focus())}}}componentDidMount(){this.child(".item").forEach((e,t)=>{e.onkeydown=this.handleKeyboardNavigation})}renderCore(){var{attached:e,borderless:t,children:i,className:n,color:r,compact:o,fixed:a,floated:s,fluid:l,icon:c,inverted:d,pagination:u,pointing:p,secondary:h,size:f,stackable:m,tabular:g,text:b,vertical:v}=this.props,r=P(["ui",r,f,t?"borderless":"",o?"compact":"",l?"fluid":"",d?"inverted":"",u?"pagination":"",p?"pointing":"",h?"secondary":"",m?"stackable":"",b?"text":"",v?"vertical":"",e?1==e?"attached":e+" attached ":"",s?1==s?"floated":s+" floated":"",c?1==c?"icon":c+" icon":"",g?1==g?"tabular":g+" tabular":"",a?"tabular "+g:"",n,"menu"]);return N.createElement("div",{className:r,role:"tablist"},i)}}T.Menu=m;class g extends n.Component{constructor(e){super(e),this.setPositionAndClassNames=()=>{const e=this.props["dimmer"];let t;e&&(t="dimmable dimmed","blurring"===e)&&(t+=" blurring");var i={},n=this.getRef();if(n){const e=n.getBoundingClientRect()["height"],r=-Math.round(e/2),o=e>=window.innerHeight;this.state.marginTop!==r&&(i.marginTop=r),this.state.scrolling!==o&&(i.scrolling=o),o&&(t+=" scrolling")}this.state.mountClasses!==t&&(i.mountClasses=t),0<Object.keys(i).length&&(this.setState(i),this.props.onPositionChanged)&&this.props.onPositionChanged(this.props),this.animationRequestId=requestAnimationFrame(this.setPositionAndClassNames)},this.id=ts.pxtc.Util.guidGen(),this.state={},this.onRequestClose=this.onRequestClose.bind(this),this.afterOpen=this.afterOpen.bind(this)}afterOpen(){var e=this.props["modalDidOpen"];this.setState({scrolling:!1}),this.setPositionAndClassNames(),e&&e(this.getRef())}onClose(){cancelAnimationFrame(this.animationRequestId)}getRef(){var e=this.refs.modal;return e&&e.node&&e.node.firstChild&&e.node.firstChild.firstChild}componentWillUnmount(){cancelAnimationFrame(this.animationRequestId)}onRequestClose(){var e=this.props["onClose"];this.onClose(),e()}renderCore(){var e=this.props,{isOpen:t,size:i,longer:n,basic:r,className:o,onClose:a,closeIcon:s,children:l,header:c,headerIcon:d,headerClass:u,headerActions:p,helpUrl:h,description:f,closeOnDimmerClick:m,closeOnDocumentClick:g,closeOnEscape:b,shouldCloseOnEsc:v,shouldCloseOnOverlayClick:y,shouldFocusAfterRender:w,overlayClassName:k}=e,e=A(e,["isOpen","size","longer","basic","className","onClose","closeIcon","children","onKeyDown","header","headerIcon","headerClass","headerActions","helpUrl","description","closeOnDimmerClick","closeOnDocumentClick","closeOnEscape","shouldCloseOnEsc","shouldCloseOnOverlayClick","shouldFocusAfterRender","overlayClassName"]),{marginTop:x,scrolling:E,mountClasses:C}=this.state,_="fullscreen"==i,S=_&&!!s,i=P(["ui",i,n?"longer":"",r?"basic":"",E?"scrolling":"",s?"closable":"","modal transition visible active",o]),r=P([this.getData(O.HIGHCONTRAST)?"hc":"",C]),E={labelledby:c?this.id+"title":void 0,describedby:!_&&f?this.id+"description":this.id+"desc"},o={content:{marginTop:x}};return N.createElement(I,Object.assign({isOpen:t,ref:"modal",appElement:T.appElement,onRequestClose:this.onRequestClose,onAfterOpen:this.afterOpen,shouldReturnFocusAfterClose:!0,shouldFocusAfterRender:w,shouldCloseOnEsc:v||b,shouldCloseOnOverlayClick:y||g||m,portalClassName:r,overlayClassName:`ui page modals dimmer transition ${k} `+(t?"visible active":""),className:i,style:o,role:"dialog",aria:E},e),c||S||h?N.createElement("div",{id:this.id+"title",className:"header "+(u||"")},d&&N.createElement(T.Icon,{icon:d}),N.createElement("h3",{className:"header-title",style:{margin:`0 ${h?"-20rem":"0"} 0 `+(S?"-20rem":"0")}},c),S?N.createElement("div",{className:"header-close"},N.createElement(L,{className:"back-button large",title:lf("Go back"),onClick:a,tabIndex:0,onKeyDown:D},N.createElement(T.Icon,{icon:"arrow left"}),N.createElement("span",{className:"ui text landscape only"},lf("Go back")))):void 0,h?N.createElement("div",{className:"header-help"},N.createElement("a",{className:"ui icon help-button",href:h,target:"_docs",role:"link","aria-label":lf("Help on {0} dialog",c),title:lf("Help on {0} dialog",c)},N.createElement(T.Icon,{icon:"help"}))):void 0):void 0,_&&p?N.createElement("div",{className:"header-actions"},p):void 0,!_&&f?N.createElement("label",{id:this.id+"description",className:"accessible-hidden"},f):void 0,N.createElement("div",{id:this.id+"desc",className:`${n?"scrolling":""} ${p?"has-actions":""} content`},l),!_&&(this.props.actions&&this.props.actions.length||this.props.buttons&&this.props.buttons.length)?N.createElement("div",{className:"actions"},null==(C=this.props.actions)?void 0:C.map((e,t)=>N.createElement("div",{key:"action_left_"+t,className:"left-action"},e)),null==(x=this.props.buttons)?void 0:x.map(e=>e.url?N.createElement(M,{key:"action_"+e.label,icon:e.icon,text:e.label,title:e.title||e.label,className:`ui button approve ${e.icon?"icon right":""} ${e.label&&!e.urlButton?"labeled":""} ${e.className||""} ${e.loading?"loading disabled":""} `+(e.disabled?"disabled":""),href:e.url,target:e.fileName?void 0:"_blank",download:e.fileName?pxt.Util.htmlEscape(e.fileName):void 0}):N.createElement(B,Object.assign({key:"action_"+e.label},e,{labelPosition:e.labelPosition})))):void 0,!_&&s&&N.createElement(R,{onClick:a}))}}T.Modal=g;class B extends n.PureComponent{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){!this.props.disabled&&this.props.onclick&&this.props.onclick()}renderCore(){var e=this.props;return N.createElement(L,{icon:e.icon,text:e.label,labelPosition:e.labelPosition,className:`approve ${e.icon?`icon ${e.labelPosition||"right"} labeled`:""} ${e.className||""} ${e.loading?"loading disabled":""} `+(e.disabled?"disabled":""),onClick:this.handleClick,onKeyDown:D,ariaLabel:this.props.ariaLabel||this.props.label,title:this.props.title})}}T.Dimmer=class extends s{render(){var e=this.props,{disabled:t,inverted:i,page:n,simple:r,closable:o,onClose:a,active:s,children:l}=e,e=A(e,["disabled","inverted","page","simple","closable","onClose","active","children"]),s=P(["ui dimmer",s?"active transition visible":"",t?"disabled":"",i?"inverted":"",n?"page":"",r?"simple":""]);return N.createElement(I,Object.assign({appElement:T.appElement,style:{content:{background:"none",border:"0"}},shouldCloseOnOverlayClick:o,onRequestClose:a,overlayClassName:s,role:"dialog"},e),l)}},T.Loader=class extends s{render(){var{active:e,children:t,disabled:i,inverted:n,size:r,className:o}=this.props,r=P(["ui loader",r,e?"active":"",i?"disabled":"",n?"inverted":"",t?"text":"",o]);return N.createElement("div",{className:r},t)}};class b extends N.Component{constructor(e){super(e),this.state={}}render(){var e=this.props,{id:t,content:i,className:n}=e,e=A(e,["id","content","className"]);return N.createElement("div",null,N.createElement("div",{"data-tip":"tooltip","data-for":t},this.props.children),N.createElement(r,Object.assign({id:t,className:"pxt-tooltip "+(n||""),effect:"solid"},e),i))}}T.Tooltip=b;class v extends N.Component{constructor(e){super(e),this.radius=100/(2*Math.PI),this.view=2*this.radius+this.props.stroke}getPathStyle(){return{strokeWidth:this.props.stroke}}render(){var e=this.props,t=this.radius;return N.createElement("div",{className:"progresscircle"},N.createElement("svg",{viewBox:`0 0 ${this.view} `+this.view,"aria-labelledby":"circletitle",role:"img"},N.createElement("title",{id:"circletitle"},"Currently on step ",e.progress," of ",e.steps),N.createElement("path",{style:this.getPathStyle(),strokeDasharray:Math.round(100*e.progress/e.steps)+", 100",d:`M${this.view/2} ${e.stroke/2} a ${t} ${t} 0 0 1 0 ${2*t} a ${t} ${t} 0 0 1 0 -`+2*t})))}}T.ProgressCircle=v;class y extends n.Component{constructor(e){super(e),this.state={isChecked:this.props.isChecked},this.setCheckedBit=this.setCheckedBit.bind(this)}setCheckedBit(){var e=!this.state.isChecked;this.props.onChange(e),this.setState({isChecked:e})}renderCore(){return N.createElement(u,{inputLabel:this.props.label,checked:this.state.isChecked,onChange:this.setCheckedBit})}}T.PlainCheckbox=y},{"./auth":8,"./core":64,"./data":67,react:320,"react-dom":276,"react-modal":289,"react-tooltip":313}],130:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ToolboxStyle=i.ToolboxTrashIcon=i.ToolboxSearch=i.TreeGroup=i.TreeItem=i.TreeSeparator=i.TreeRow=i.CategoryItem=i.Toolbox=i.CategoryNameID=void 0;const y=e("react"),n=e("./data"),w=e("./sui"),d=e("./core"),r=e("./coretsx");var v=pxt.Util;(e=i.CategoryNameID||(i.CategoryNameID={})).Loops="loops",e.Logic="logic",e.Variables="variables",e.Maths="Math",e.Functions="functions",e.Arrays="arrays",e.Text="text",e.Extensions="addpackage";const o="monaco";class a extends n.Component{constructor(e){super(e),this.handleRootElementRef=e=>{this.rootElement=e},this.state={categories:[],visible:!1,loading:!1,showAdvanced:!1,shouldAnimate:!pxt.shell.getToolboxAnimation()},this.setSelection=this.setSelection.bind(this),this.advancedClicked=this.advancedClicked.bind(this),this.recoverToolbox=this.recoverToolbox.bind(this)}getElement(){return this.rootElement}hide(){this.setState({visible:!1})}showLoading(){this.setState({visible:!0,loading:!0})}show(){this.setState({visible:!0})}setSelectedItem(e){this.selectedItem=e}setPreviousItem(){var e,t;0<this.selectedIndex?(e=--this.selectedIndex,t=this.items[e],this.setSelection(t,e)):this.state.showSearchBox&&(t=this.refs.searchbox)&&t.focus()}setNextItem(){var e;this.items.length-1>this.selectedIndex&&(e=++this.selectedIndex,this.setSelection(this.items[e],e))}setSearch(){var e=this.refs.searchbox;e&&e.focus()}clear(){this.clearSelection(),this.selectedIndex=0,this.selectedTreeRow=void 0}clearSelection(){this.setState({selectedItem:void 0,focusSearch:!1})}clearExpandedItem(){this.setState({expandedItem:void 0})}clearSearch(){this.setState({hasSearch:!1,searchBlocks:void 0,focusSearch:!1})}setSelection(t,i,e){var{editorname:n,parent:r}=this.props,{nameid:o,subns:a,customClick:s}=t,n=(pxt.tickEvent(n+".toolbox.click",void 0,{interactiveConsent:!0}),a?o+a:o);if(this.state.selectedItem!=n||e){let e=!1;null!=(a=r.parent.state)&&a.accessibleBlocks&&Blockly.navigation.setState(Blockly.navigation.STATE_TOOLBOX),s&&(e=s(r))||(e||(this.setState({selectedItem:n,expandedItem:o,focusSearch:!1}),this.selectedIndex=i,(this.selectedTreeRow=t).advanced&&!this.state.showAdvanced&&this.showAdvanced(),s)||this.showFlyout(t))}else this.clearSelection(),this.closeFlyout(),null!=(e=r.parent.state)&&e.accessibleBlocks&&Blockly.navigation.setState(Blockly.navigation.STATE_WS)}focus(){var e,t;this.rootElement&&(this.selectedItem&&this.selectedItem.getTreeRow()?(e=this.selectedItem.props.treeRow,t=this.items.indexOf(e),this.setSelection(e,t,!0)):this.selectFirstItem())}selectFirstItem(){this.items[0]&&this.setSelection(this.items[0],0,!0)}moveFocusToFlyout(){var e=this.props["parent"];e.moveFocusToFlyout()}UNSAFE_componentWillReceiveProps(e){(this.props.editorname==o&&e.editorname!=o||e.editorname==o&&e.parent.parent.state.fullscreen&&this.state.shouldAnimate)&&(pxt.shell.setToolboxAnimation(),this.setState({shouldAnimate:!1}))}componentDidUpdate(e,t){t.visible==this.state.visible&&t.loading==this.state.loading&&t.showAdvanced==this.state.showAdvanced&&this.state.expandedItem==t.expandedItem||this.props.parent.resize(),this.state.hasSearch&&this.state.searchBlocks!=t.searchBlocks?this.refreshSearchItem():t.hasSearch&&!this.state.hasSearch&&"search"==this.state.selectedItem&&this.closeFlyout()}componentDidCatch(e,t){var i=this.props["editorname"];pxt.tickEvent(i+".toolbox.crashed",{error:e}),this.setState({hasError:!0})}componentWillUnmount(){this.props.editorname==o&&pxt.shell.setToolboxAnimation()}recoverToolbox(){this.setState({hasError:!1})}advancedClicked(){var e=this.props["editorname"];pxt.tickEvent(e+".advanced",void 0,{interactiveConsent:!0}),this.showAdvanced()}showAdvanced(){var{}=this.props;this.selectedItem&&this.selectedItem.props.treeRow&&this.selectedItem.props.treeRow.advanced&&(this.clear(),this.closeFlyout()),this.setState({showAdvanced:!this.state.showAdvanced})}getSearchBlocks(){var{}=this.props,e=this.state["searchBlocks"];return e.map(e=>({name:e.qName,attributes:{blockId:e.id},builtinBlock:e.builtinBlock,builtinField:e.field}))}refreshSelection(){var e=this.props["parent"];this.state.selectedItem&&this.selectedTreeRow&&(this.selectedTreeRow.customClick?this.selectedTreeRow.customClick(e):this.showFlyout(this.selectedTreeRow))}refreshSearchItem(){var e=E.getSearchTreeRow();this.showFlyout(e)}showFlyout(e){var t=this.props["parent"];t.showFlyout(e)}closeFlyout(){var e=this.props["parent"];e.closeFlyout()}hasAdvancedCategories(){var e=this.state["categories"];return e.some(e=>e.advanced)}getNonAdvancedCategories(){var e=this.state["categories"];return e.filter(e=>!e.advanced)}getAdvancedCategories(){var e=this.state["categories"];return e.filter(e=>e.advanced)}getAllCategoriesList(t){const{categories:e,hasSearch:i,expandedItem:n}=this.state,r=[];return i&&r.push(E.getSearchTreeRow()),e.forEach(e=>{r.push(e),!e.subcategories||t&&e.nameid!=n||e.subcategories.forEach(e=>{r.push(e)})}),r}shouldComponentUpdate(e,t){return this.state!=t}isRtl(){var e=this.props["editorname"];return"monaco"!=e&&v.isUserLanguageRtl()}renderCore(){const{editorname:e,parent:t}=this.props,{showAdvanced:i,visible:n,loading:r,selectedItem:o,expandedItem:a,hasSearch:s,showSearchBox:l,hasError:c}=this.state;if(!n)return y.createElement("div",{style:{display:"none"}});var d=pxt.appTarget.appTheme,u=t.parent.state.tutorialOptions,u=!!u&&!!u.tutorial,d=!!d.topBlocks&&!u;if(r||c)return y.createElement("div",null,y.createElement("div",{className:"blocklyTreeRoot"},y.createElement("div",{className:"blocklyTreeRow",style:{opacity:0}})),r?y.createElement("div",{className:"ui active dimmer"},y.createElement("div",{className:"ui loader indeterminate"})):void 0,c?y.createElement("div",{className:"ui"},lf("Toolbox crashed.."),y.createElement(w.Button,{icon:"refresh",onClick:this.recoverToolbox,text:lf("Reload"),className:"fluid"})):void 0);var u=this.hasAdvancedCategories(),p=this.getNonAdvancedCategories(),h=u?this.getAdvancedCategories():[],f=(this.items=this.getAllCategoriesList(),E.getSearchTreeRow()),m={nameid:"topblocks",name:lf("{id:category}Basic"),color:pxt.toolbox.getNamespaceColor("topblocks"),icon:pxt.toolbox.getNamespaceIcon("topblocks")},g=pxt.appTarget.appTheme,g=w.cx(["pxtToolbox",g.invertedToolbox?"invertedToolbox":"",g.coloredToolbox?"coloredToolbox":""]);let b=0,v=0;return y.createElement("div",{ref:this.handleRootElementRef,className:g,id:e+"EditorToolbox"},y.createElement(C,{categories:this.items}),l?y.createElement(E,{ref:"searchbox",parent:t,toolbox:this,editorname:e}):void 0,y.createElement("div",{className:"blocklyTreeRoot"},y.createElement("div",{role:"tree"},s?y.createElement(k,{key:"search",toolbox:this,index:b++,selected:"search"==o,treeRow:f,onCategoryClick:this.setSelection}):void 0,d?y.createElement(k,{key:"topblocks",toolbox:this,selected:"topblocks"==o,treeRow:m,onCategoryClick:this.setSelection}):void 0,p.map(e=>y.createElement(k,{key:e.nameid,toolbox:this,index:b++,selected:o==e.nameid,childrenVisible:a==e.nameid,treeRow:e,onCategoryClick:this.setSelection,topRowIndex:v++,shouldAnimate:this.state.shouldAnimate},e.subcategories?e.subcategories.map(e=>y.createElement(k,{key:e.nameid+e.subns,index:b++,toolbox:this,selected:o==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection})):void 0)),u?y.createElement(x,{key:"advancedseparator"}):void 0,u?y.createElement(k,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.advancedTitle(),color:pxt.toolbox.getNamespaceColor("advanced"),icon:pxt.toolbox.getNamespaceIcon(i?"advancedexpanded":"advancedcollapsed")},onCategoryClick:this.advancedClicked,topRowIndex:v++}):void 0,i?h.map(e=>y.createElement(k,{key:e.nameid,toolbox:this,index:b++,selected:o==e.nameid,childrenVisible:a==e.nameid,treeRow:e,onCategoryClick:this.setSelection},e.subcategories?e.subcategories.map(e=>y.createElement(k,{key:e.nameid,toolbox:this,index:b++,selected:o==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection})):void 0)):void 0)))}}i.Toolbox=a;class k extends n.Component{constructor(e){super(e),this.handleTreeRowRef=e=>{this.treeRowElement=e},this.state={selected:e.selected},this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}getTreeRow(){return this.treeRowElement}UNSAFE_componentWillReceiveProps(e){var t={};null!=e.selected&&(t.selected=e.selected),0<Object.keys(t).length&&this.setState(t)}componentDidUpdate(e,t){var i=this.props["toolbox"];this.state.selected&&(this.props.toolbox.setSelectedItem(this),i.state.focusSearch||r.dialogIsShowing()||this.focusElement())}focusElement(){this.treeRowElement.focus()}handleClick(e){var{treeRow:t,onCategoryClick:i,index:n}=this.props;i&&i(t,n),e.preventDefault(),e.stopPropagation()}handleKeyDown(e){var t=this.props["toolbox"],i=v.isUserLanguageRtl(),n=Blockly.getMainWorkspace().keyboardAccessibilityMode,r=Blockly.navigation.currentState_,o=n?83:40,a=n?87:38,s=n?65:37,l=n?68:39,c=d.keyCodeFromEvent(e);n&&1==r?(c==s&&!i||c==l&&i)&&(this.focusElement(),e.stopPropagation()):c==o?this.nextItem():c==a?this.previousItem():c==l&&!i||c==s&&i?t.moveFocusToFlyout():27==c?t.closeFlyout():c==d.ENTER_KEY||c==d.SPACE_KEY?w.fireClickOnEnter.call(this,e):c==d.TAB_KEY||37==c||39==c||17==c||16==c||91==c||n||t.setSearch()}previousItem(){var e=this.props["toolbox"],t=e.props.editorname;pxt.tickEvent(t+'.toolbox.keyboard.prev"',void 0,{interactiveConsent:!0}),e.setPreviousItem()}nextItem(){var e=this.props["toolbox"],t=e.props.editorname;pxt.tickEvent(t+'.toolbox.keyboard.next"',void 0,{interactiveConsent:!0}),e.setNextItem()}renderCore(){var{toolbox:e,childrenVisible:t}=this.props,i=this.state["selected"];return y.createElement(l,null,y.createElement(s,Object.assign({ref:this.handleTreeRowRef,isRtl:e.isRtl()},this.props,{selected:i,onClick:this.handleClick,onKeyDown:this.handleKeyDown})),y.createElement(c,{visible:t},this.props.children))}}i.CategoryItem=k;class s extends n.Component{constructor(e){super(e),this.baseAnimationDelay=1,this.animationDelay=.15,this.handleTreeRowRef=e=>{this.treeRow=e},this.state={},this.onmouseenter=this.onmouseenter.bind(this),this.onmouseleave=this.onmouseleave.bind(this)}focus(){this.treeRow&&this.treeRow.focus()}getProperties(){var e=this.props["treeRow"];return e}onmouseenter(){var e=pxt.appTarget.appTheme,t=this.getMetaColor(),i=e.blocklyOptions&&e.blocklyOptions.toolboxOptions&&e.blocklyOptions.toolboxOptions.invertedMultiplier||.3;e.invertedToolbox&&(this.treeRow.style.backgroundColor=pxt.toolbox.fadeColor(t||"#ddd",i,!1))}onmouseleave(){var e=pxt.appTarget.appTheme,t=this.getMetaColor();e.invertedToolbox&&(this.treeRow.style.backgroundColor=t||"#ddd")}getMetaColor(){var e=this.props.treeRow["color"];return pxt.toolbox.convertColor(e)||pxt.toolbox.getNamespaceColor("default")}renderCore(){const{selected:e,onClick:t,onKeyDown:i,isRtl:n,topRowIndex:r}=this.props,{nameid:o,subns:a,name:s,icon:l}=this.props.treeRow,c=pxt.appTarget.appTheme,d=this.getMetaColor(),u=c.blocklyOptions&&c.blocklyOptions.toolboxOptions&&c.blocklyOptions.toolboxOptions.invertedMultiplier||.3;let p={paddingLeft:"0px"},h="blocklyTreeRow";if(c.invertedToolbox)p.backgroundColor=d||"#ddd",p.color="#fff";else{c.coloredToolbox&&(p.color=""+d);const e="8px solid "+d;n?p.borderRight=e:p.borderLeft=e,r&&this.props.shouldAnimate&&(p.animationDelay=r*this.animationDelay+this.baseAnimationDelay+"s",h+=" blocklyTreeAnimate")}e&&(h+=" blocklyTreeSelected",c.invertedToolbox?p.backgroundColor=""+pxt.toolbox.fadeColor(d,u,!1):p.backgroundColor=d||"#ddd",p.color="#fff");var f=("blocklyTreeIcon"+(a?"more":l?(o||l).toLowerCase():"Default")).replace(/\s/g,"");let m,g=a?pxt.toolbox.getNamespaceIcon("more"):l||pxt.toolbox.getNamespaceIcon("default");1<g.length&&(m=y.createElement("style",null,`.blocklyTreeIcon.${f} {
                    background-image: url("${v.pathJoin(pxt.webConfig.commitCdnUrl,encodeURI(l))}")!important;
                    width: 30px;
                    height: 100%;
                    background-size: 20px !important;
                    background-repeat: no-repeat !important;
                    background-position: 50% 50% !important;
                }`),g=void 0);var b=s||v.capitalize(a||o);return y.createElement("div",{role:"button",ref:this.handleTreeRowRef,className:h,style:p,tabIndex:0,"aria-label":lf("Toggle category {0}",b),"aria-expanded":e,onMouseEnter:this.onmouseenter,onMouseLeave:this.onmouseleave,onClick:t,onContextMenu:t,onKeyDown:i||w.fireClickOnEnter},y.createElement("span",{className:"blocklyTreeIcon",role:"presentation"}),m,y.createElement("span",{style:{display:"inline-block"},className:"blocklyTreeIcon "+f,role:"presentation"},g),y.createElement("span",{className:"blocklyTreeLabel"},b))}}i.TreeRow=s;class x extends n.Component{renderCore(){return y.createElement(l,null,y.createElement("div",{className:"blocklyTreeSeparator"},y.createElement("span",{style:{display:"inline-block"},role:"presentation"})))}}i.TreeSeparator=x;class l extends n.Component{renderCore(){var e=this.props["selected"];return y.createElement("div",{role:"treeitem","aria-selected":e},this.props.children)}}i.TreeItem=l;class c extends n.Component{renderCore(){var e=this.props["visible"];return this.props.children?y.createElement("div",{role:"tree",style:{backgroundPosition:"0px 0px",display:e?"":"none"}},this.props.children):y.createElement("div",null)}}i.TreeGroup=c;class E extends n.Component{constructor(e){super(e),this.search=v.debounce(()=>{this.searchImmediate()},300,!1),this.state={},this.searchImmediate=this.searchImmediate.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleChange=this.handleChange.bind(this)}static getSearchTreeRow(){return{nameid:"search",name:lf("{id:category}Search"),color:pxt.toolbox.getNamespaceColor("search"),icon:pxt.toolbox.getNamespaceIcon("search")}}handleChange(){this.search()}handleKeyDown(e){var t=this.props["toolbox"];40===("number"==typeof e.which?e.which:e.keyCode)&&t.selectFirstItem()}focus(){this.refs.searchInput.focus()}searchImmediate(){const{parent:e,toolbox:i,editorname:t}=this.props,n=this.refs.searchInput.value;let r,o;pxt.tickEvent(t+".search",void 0,{interactiveConsent:!0}),e.searchAsync(n).then(e=>{r=0==e.length?lf("No search results..."):lf("{0} result matching '{1}'",e.length,n.toLowerCase()),o=""!=n;var t={};t.hasSearch=o,t.searchBlocks=e,t.focusSearch=!0,o&&(t.selectedItem="search"),i.setState(t),this.setState({searchAccessibilityLabel:r})})}renderCore(){var e=this.state["searchAccessibilityLabel"];return y.createElement("div",{id:"blocklySearchArea"},y.createElement("div",{id:"blocklySearchInput",className:"ui fluid icon input",role:"search"},y.createElement("input",{ref:"searchInput",type:"text",placeholder:lf("Search..."),onFocus:this.searchImmediate,onKeyDown:this.handleKeyDown,onChange:this.handleChange,id:"blocklySearchInputField",className:"blocklySearchInputField","aria-label":lf("Search"),autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),y.createElement("i",{className:"search icon",role:"presentation","aria-hidden":"true"}),y.createElement("div",{className:"accessible-hidden",id:"blocklySearchLabel","aria-live":"polite"}," ",e," ")))}}i.ToolboxSearch=E;class u extends n.Component{constructor(e){super(e)}getStyle(){var e,t={opacity:0,display:"none"};return this.props.flyoutOnly&&(e=document.querySelector(".blocklyFlyout"))&&(t.left=e.clientWidth/2,t.transform="translateX(-45%)"),t}renderCore(){return y.createElement("div",{id:"blocklyTrashIcon",style:this.getStyle()},y.createElement("i",{className:"trash icon","aria-hidden":"true"}))}}i.ToolboxTrashIcon=u;class C extends n.Component{renderCore(){var e=this.props["categories"];return y.createElement("style",null,e.filter(e=>!!e.color).map(e=>`span.docs.inlineblock.${e.nameid.toLowerCase()} {
                    background-color: ${e.color};
                    border-color: ${pxt.toolbox.fadeColor(e.color,.1,!1)};
                }`))}}i.ToolboxStyle=C},{"./core":64,"./coretsx":65,"./data":67,"./sui":129,react:320}],131:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ToolboxEditor=void 0;const n=e("./srceditor"),r=e("./compiler");class o extends n.Editor{constructor(){super(...arguments),this.extensionsMap={},this.subcategoryMap={},this.topBlocks=[]}shouldShowBlock(e,t,i){const n=this.parent.state.editorState&&this.parent.state.editorState.filters;if(n){e=n.blocks&&(n.blocks[e]||this.blockIdMap&&(null==(e=this.blockIdMap[e])?void 0:e.some(e=>n.blocks[e]))),t=n.namespaces&&n.namespaces[t];if(null!=e&&e==pxt.editor.FilterState.Hidden&&!i)return!1;if(null!=e)return!0;if(null!=t&&t==pxt.editor.FilterState.Hidden)return!1;if(null!=t)return!0;if(null!=n.defaultState&&n.defaultState==pxt.editor.FilterState.Hidden&&!i)return!1}return!0}shouldShowCustomCategory(e){var t=this.parent.state.editorState&&this.parent.state.editorState.filters;return!t||!("variables"!==e||t.blocks&&!t.blocks.variables_set&&!t.blocks.variables_get&&!t.blocks.variables_change||t.namespaces&&t.namespaces.variables===pxt.editor.FilterState.Disabled)||!("functions"!==e||t.blocks&&!t.blocks.function_definition&&!t.blocks.procedures_defnoreturn&&!t.blocks.procedures_callnoreturn||t.namespaces&&t.namespaces.functions===pxt.editor.FilterState.Disabled)}getSearchSubset(){if(!this.searchSubset&&this.blockInfo){this.searchSubset={};const i=this.searchSubset;var e=pxt.blocks.blockDefinitions();for(const n in e){var t=e[n];this.shouldShowBlock(n,t.category)&&(i[n]=!0)}this.blockInfo.blocks.forEach(e=>{var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];e.attributes.debug&&!pxt.options.debug||e.attributes.blockHidden||e.attributes.deprecated&&null==this.parent.state.tutorialOptions||this.shouldShowBlock(e.attributes.blockId,t)&&(i[e.attributes.blockId]=!0)})}return this.searchSubset}searchAsync(t){var e={term:t,subset:this.getSearchSubset()};return r.apiSearchAsync(e).then(e=>e).then(e=>(pxt.debug("searching for: "+t),e))}clearCaches(){super.clearCaches(),this.searchSubset=void 0,this.blockGroupsCache=void 0}getAllCategories(){return this.getToolboxCategories(!1).concat(this.getToolboxCategories(!0))}getToolboxCategories(t){if(!this.blockInfo)return[];let u=this;return e=this.getNamespaces().map(e=>[e,u.getNamespaceAttrs(e)]).filter(([,e])=>!(e.deprecated&&null==u.parent.state.tutorialOptions)&&(t?e.advanced:!e.advanced)),p=t,e.sort(([,e],[,t])=>(t&&t.weight||50)>=(e&&e.weight||50)?1:-1).map(([t,e])=>{var o,a,i,n=u.isBuiltIn(t),r=n?u.getBuiltinCategory(t):void 0,s=u.getBlocksForCategory(t).filter(e=>u.shouldShowBlock(e.attributes.blockId,t)),l=u.extensionsMap[t],c=r&&r.customClick;let d;if(((e.subcategories&&e.subcategories.length||u.subcategoryMap[t])&&(d=(o=[t,e],i=e.subcategories||Object.keys(u.subcategoryMap[t]),a=p,i.map(e=>{const t=o[0],i=o[1],n=u.getBlocksForCategory(t,e).filter(e=>u.shouldShowBlock(e.attributes.blockId,t));var r;if(n.length)return r=pxt.Util.rlf("{id:subcategory}"+e),{nameid:t,name:r,subns:e,color:i.color,icon:i.icon,groups:i.groups,groupIcons:i.groupIcons,groupHelp:i.groupHelp,labelLineWidth:i.labelLineWidth,blocks:n,advanced:a}}).filter(e=>!!e))),s.length||l||c||d&&d.length)&&(!c||u.shouldShowCustomCategory(t)))return i={nameid:t,name:e.block||void 0,color:e.color,icon:e.icon,groups:e.groups,groupIcons:e.groupIcons,groupHelp:e.groupHelp,labelLineWidth:e.labelLineWidth,blocks:s,subcategories:d,advanced:p},n&&(i.name=r.name,i.icon=e.icon?pxt.toolbox.getNamespaceIcon(e.icon)||e.icon:pxt.toolbox.getNamespaceIcon(t),i.groups=r.groups||e.groups,i.customClick=r.customClick),i}).filter(e=>!!e);var e,p}moveFocusToFlyout(){}abstractShowFlyout(e){var{nameid:t,name:i,subns:n,icon:r,color:o,labelLineWidth:a,blocks:s}=e,l=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if(!s||!s.length)return!1;pxt.appTarget.appTheme.hideFlyoutHeadings||this.showFlyoutHeadingLabel(t,i,n,r,o);var c=this.getBlockGroups(e);for(let e=0;e<c.length;++e){var d=c[e];d.blocks&&d.blocks.length&&(d.name==pxt.DEFAULT_GROUP_NAME||l||1==c.length||this.showFlyoutGroupLabel(d.name,d.icon,a,d.hasHelp?"help":""),this.showFlyoutBlocks(t,o,d.blocks))}return!0}getNamespaceAttrs(e){const t=this.blockInfo.apis.byQName[e];if(t)return t.attributes;if(this.extensionsMap[e]){const t=this.extensionsMap[e];return{weight:0,blockId:t.name,color:t.extension.color||"#7f8c8d",advanced:t.extension.advanced||!1,callingConvention:0,paramDefl:{}}}}getNamespaces(){const r=[];return this.extensions.forEach(e=>{const t=e.config,i=t.name,n=t.extension.namespace||i;this.extensionsMap[n]||(this.extensionsMap[n]=t),r.filter(e=>e==n)||r.push(i)}),r}getTopBlocks(){return this.topBlocks.sort((e,t)=>{e=e.attributes.topblockWeight||e.attributes.weight||50;return(t.attributes.topblockWeight||t.attributes.weight||50)>=e?1:-1})}getBlockGroups(e){var t=e.nameid+(e.subns||"");if(this.blockGroupsCache||(this.blockGroupsCache={}),!this.blockGroupsCache[t]){var{groups:e,groupIcons:r,groupHelp:o,blocks:a}=e;let n=e||[];a.forEach(e=>{e=e.attributes&&e.attributes.group||pxt.DEFAULT_GROUP_NAME;n.indexOf(e)<0&&n.push(e)});var s=[];if(n)for(let i=0;i<n.length;i++){let t=n[i],e=a.filter(e=>(e.attributes.group||pxt.DEFAULT_GROUP_NAME)==t).sort((e,t)=>(t.attributes.weight||50)+(t.attributes.advanced?0:1e3)>(e.attributes.weight||50)+(e.attributes.advanced?0:1e3)?1:-1);e&&0<e.length&&s.push({name:t,icon:r&&r[i]||"",hasHelp:o&&!!o[i],blocks:e})}if(null!=(e=null==(e=this.parent.state)?void 0:e.editorState)&&e.filters)return s;this.blockGroupsCache[t]=s}return this.blockGroupsCache[t]}}i.ToolboxEditor=o},{"./compiler":18,"./srceditor":128}],132:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WorkspaceHeader=i.TutorialCard=i.TutorialHint=i.TutorialStepCircle=i.TutorialMenuItemLink=i.TutorialMenuItem=i.TutorialMenu=i.getUsedBlocksAsync=void 0;const b=e("react"),n=e("react-dom"),r=e("./data"),v=e("./sui"),o=e("./sounds"),a=e("./core"),y=e("./marked"),p=e("./compiler"),w=e("./hinttooltip"),s=e("./editortoolbar"),f=e("./immersivereader"),k=e("./tutorialCodeValidation");function l(a,s,t,l,c=!1){const d={},u={};return p.getBlocksAsync().then(e=>(pxt.blocks.initializeAndInject(e),"python"==t?p.decompilePySnippetstoXmlAsync(a):p.decompileSnippetstoXmlAsync(a))).then(i=>{var n;if(0<(null==i?void 0:i.length)){let e;for(let t=0;t<i.length;t++){const c=i[t],o=pxt.BrowserUtils.getTutorialCodeHash([a[t]]);if(!(e=pxt.blocks.loadWorkspaceXml(c)))throw pxt.debug(`used blocks xml failed to load
`+c),new Error("blocksXml failed to load");var r=e.getAllBlocks();d[o]={};for(let e=0;e<r.length;++e){const c=r[e];"typescript_statement"==c.type?pxt.tickEvent("tutorial.usedblocks.greyblock",{tutorial:s,code:null==(n=a[t])?void 0:n.substring(0,2e3)}):c.isShadow()||(d[o][c.type]||(d[o][c.type]=0),d[o][c.type]=d[o][c.type]+1,u[c.type]=1)}}null!=e&&e.dispose(),pxt.options.debug&&pxt.debug(JSON.stringify(d,null,2));try{l&&!c&&l.setAsync(s,d,a)}catch(e){pxt.log("Unable to cache used blocks in DB")}pxt.tickEvent("tutorial.usedblocks.computed",{tutorial:s})}else if(0<(null==a?void 0:a.length))throw new Error("Failed to decompile");return{snippetBlocks:d,usedBlocks:u}}).catch(e=>{throw pxt.reportException(e),new Error("Failed to decompile tutorial")})}i.getUsedBlocksAsync=function(i,n,r,o=!1){var e;if(!i)return Promise.resolve(void 0);if(null!=(e=pxt.appTarget)&&e.tutorialInfo&&!o){const r=pxt.BrowserUtils.getTutorialCodeHash(i);if(pxt.appTarget.tutorialInfo[r])return pxt.tickEvent("tutorial.usedblocks.cached",{tutorial:n}),Promise.resolve(pxt.appTarget.tutorialInfo[r])}return pxt.BrowserUtils.tutorialInfoDbAsync().then(t=>t.getAsync(n,i).then(e=>null!=e&&e.blocks&&0<Object.keys(e.blocks).length&&!o?(pxt.tickEvent("tutorial.usedblocks.indexeddb",{tutorial:n}),null!=e&&e.snippets||l(i,n,r,t,o),Promise.resolve({snippetBlocks:e.snippets,usedBlocks:e.blocks})):l(i,n,r,t,o)).catch(e=>l(i,n,r,t,o))).catch(e=>l(i,n,r,null,o))};class c extends r.Component{constructor(e){super(e);e=this.props.parent.state.tutorialOptions;this.hasActivities=e&&e.tutorialActivityInfo&&1<e.tutorialActivityInfo.length}renderCore(){var e=this.props.parent.state.tutorialOptions,t=null==(t=e.tutorialStepInfo)?void 0:t[e.tutorialStep].headerContentMd,i=pxt.appTarget.appTheme.immersiveReader;return this.hasActivities?b.createElement("div",{className:"menu tutorial-menu"},b.createElement(h,{parent:this.props.parent}),i&&b.createElement(f.ImmersiveReaderButton,{content:t,tutorialOptions:e})):e.tutorialStepInfo.length<8?b.createElement("div",{className:"menu tutorial-menu"},b.createElement(d,{parent:this.props.parent}),i&&b.createElement(f.ImmersiveReaderButton,{content:t,tutorialOptions:e})):b.createElement("div",{className:"menu tutorial-menu"},b.createElement(d,{parent:this.props.parent,className:"mobile hide"}),b.createElement(h,{parent:this.props.parent,className:"mobile only"}),i&&b.createElement(f.ImmersiveReaderButton,{content:t,tutorialOptions:e}))}}i.TutorialMenu=c;class d extends r.Component{constructor(e){super(e),this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){var t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:n,tutorialStepInfo:r,tutorialStep:e}=this.props.parent.state.tutorialOptions,o=e;return n?b.createElement("div",{className:"ui item "+this.props.className},b.createElement("div",{className:"ui item tutorial-menuitem",role:"menubar"},r.map((e,t)=>{return t==o?b.createElement("span",{className:"step-label",key:"tutorialStep"+t},b.createElement(u,{index:t,className:`ui circular label ${o==t?"blue selected":"inverted"} `+(n?"":"disabled"),ariaLabel:lf("Tutorial step {0}. This is the current step",t+1),onClick:this.openTutorialStep},t+1)):b.createElement("span",{className:"ui step-label "+(i=t,r.length<8||0==i||i==r.length-1||Math.abs(i-o)<2?"":"mobile hide"),key:"tutorialStep"+t,"data-tooltip":""+(t+1),"data-inverted":"","data-position":"bottom center"},b.createElement(u,{index:t,className:`ui empty circular label ${n?"":"disabled"} clear`,ariaLabel:lf("Tutorial step {0}",t+1),onClick:this.openTutorialStep}));var i}))):b.createElement("div",null)}}i.TutorialMenuItem=d;class u extends r.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.index)}}renderCore(){var{className:e,ariaLabel:t}=this.props;return b.createElement("a",{className:e,role:"menuitem","aria-label":t,tabIndex:0,onClick:this.handleClick,onKeyDown:v.fireClickOnEnter},this.props.children)}}i.TutorialMenuItemLink=u;class h extends r.Component{constructor(e){super(e),this.handleNextClick=()=>{var e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep+1)},this.handlePrevClick=()=>{var e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep-1)},this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){var t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){var{tutorialReady:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions,n=i,r=e&&0!=n,o=e&&n!=t.length-1;return e?b.createElement("div",{id:"tutorialsteps",className:"ui item "+this.props.className},b.createElement("div",{className:"ui item",role:"menubar"},b.createElement(v.Button,{role:"button",icon:"left chevron",disabled:!r,className:"prevbutton left "+(r?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.handlePrevClick,onKeyDown:v.fireClickOnEnter}),b.createElement("span",{className:"step-label",key:"tutorialStep"+n},b.createElement(v.ProgressCircle,{progress:n+1,steps:t.length,stroke:4.5}),b.createElement("span",{className:"ui circular label blue selected "+(e?"":"disabled"),"aria-label":lf("You are currently at tutorial step {0}.")},i+1)),b.createElement(v.Button,{role:"button",icon:"right chevron",disabled:!o,rightIcon:!0,className:"nextbutton right "+(o?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.handleNextClick,onKeyDown:v.fireClickOnEnter}))):b.createElement("div",null)}}i.TutorialStepCircle=h;class x extends r.Component{constructor(e){super(e),this.setRef=e=>{this.elementRef=e},this.next=this.next.bind(this),this.showHint=this.showHint.bind(this),this.closeHint=this.closeHint.bind(this)}next(){var{tutorialStep:e,tutorial:t}=this.props.parent.state.tutorialOptions,e=(this.setState({visible:!1}),e+1);pxt.tickEvent("tutorial.hint.next",{tutorial:t,step:e}),this.props.parent.setTutorialStep(e)}showHint(e,t){e&&Blockly.hideChaff(),this.setState({visible:e,showFullText:t})}closeHint(){this.showHint(!1,this.state.showFullText)}renderCore(){const e=this.state["visible"],t=this.props.parent.state.tutorialOptions,{tutorialReady:i,tutorialStepInfo:n,tutorialStep:r,tutorialName:o}=t;if(!i)return b.createElement("div",null);const a=n[r],s=a.hintContentMd,l=a.contentMd,c=t.metadata.hideIteration,d=t.metadata.flyoutOnly,u=pxt.appTarget.appTheme.immersiveReader;if(a.showDialog){var p=r<n.length-1?this.next:this.closeHint,h=[];u&&h.push({className:"immersive-reader-button",onclick:()=>{f.launchImmersiveReader(l,t)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")}),h.push({label:c&&d?lf("Start"):lf("Ok"),onclick:p,icon:"check",className:"green"});const s=this.props.parent.createModalClasses("hintdialog");return b.createElement(v.Modal,{isOpen:e,className:s,closeIcon:!1,header:o,buttons:h,onClose:p,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},b.createElement(y.MarkedContent,{markdown:l,parent:this.props.parent}))}return s?b.createElement("div",{className:"tutorialhint no-select "+(e?"":"hidden"),ref:this.setRef},b.createElement(y.MarkedContent,{markdown:this.state.showFullText?l:s,unboxSnippets:!0,parent:this.props.parent})):b.createElement("div",null)}}i.TutorialHint=x;class m extends r.Component{constructor(e){super(e),this.closeLightboxOnEscape=e=>{27===a.keyCodeFromEvent(e)&&this.closeLightbox()},this.lastStep=-1;e=this.props.parent.state.tutorialOptions;this.prevStep=e.tutorialStep,this.state={showSeeMore:!1,showHint:e.tutorialStepInfo[this.prevStep].showHint,showTutorialValidationMessage:!1},this.toggleHint=this.toggleHint.bind(this),this.closeHint=this.closeHint.bind(this),this.hintOnClick=this.hintOnClick.bind(this),this.closeLightbox=this.closeLightbox.bind(this),this.tutorialCardKeyDown=this.tutorialCardKeyDown.bind(this),this.okButtonKeyDown=this.okButtonKeyDown.bind(this),this.previousTutorialStep=this.previousTutorialStep.bind(this),this.nextTutorialStep=this.nextTutorialStep.bind(this),this.finishTutorial=this.finishTutorial.bind(this),this.toggleExpanded=this.toggleExpanded.bind(this),this.onMarkdownDidRender=this.onMarkdownDidRender.bind(this),this.handleResize=this.handleResize.bind(this),this.showTutorialValidationMessageOnClick=this.showTutorialValidationMessageOnClick.bind(this),this.closeTutorialValidationMessage=this.closeTutorialValidationMessage.bind(this),this.doubleClickedNextStep=this.doubleClickedNextStep.bind(this),this.validationTelemetry=this.validationTelemetry.bind(this)}previousTutorialStep(){this.showHint(!1);var e=this.props.parent.state.tutorialOptions,t=e.tutorialStep-1;e.tutorialStep=t,pxt.tickEvent("tutorial.previous",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),this.setState({showTutorialValidationMessage:!1})}nextTutorialStep(){this.showHint(!1);var e=this.props.parent.state.tutorialOptions,t=e.tutorialStep+1;e.tutorialStep=t,pxt.tickEvent("tutorial.next",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),e.metadata.tutorialCodeValidation&&this.state.showTutorialValidationMessage&&this.setState({showTutorialValidationMessage:!1})}doubleClickedNextStep(){this.validationTelemetry("next"),this.nextTutorialStep()}finishTutorial(){this.closeLightbox(),this.removeHintOnClick(),this.props.parent.completeTutorialAsync()}closeLightbox(){o.tutorialNext(),document.documentElement.removeEventListener("keydown",this.closeLightboxOnEscape),this.props.parent.hideLightbox()}UNSAFE_componentWillUpdate(){document.documentElement.addEventListener("keydown",this.closeLightboxOnEscape)}tutorialCardKeyDown(e){a.keyCodeFromEvent(e)==a.TAB_KEY&&(e.preventDefault(),e=this.refs.tutorialok,n.findDOMNode(e).focus())}okButtonKeyDown(e){a.keyCodeFromEvent(e)==a.TAB_KEY&&(e.preventDefault(),this.refs.tutorialmessage.focus())}componentDidUpdate(e,t){const i=this.props.parent.state.tutorialOptions,n=this.refs.tutorialmessage,r=this.props.parent.state.tutorialOptions.tutorialStep;if(r!=this.lastStep){const e=`fade ${r<this.lastStep?"right":"left"} in visible transition animating`;n.style.animationDuration="500ms",this.lastStep=r,pxsim.U.addClass(n,e),pxt.Util.delay(500).then(()=>pxsim.U.removeClass(n,e))}this.prevStep!=r&&(this.setShowSeeMore(i.autoexpandStep),this.prevStep=r,this.setState({showHint:i.tutorialStepInfo[r].showDialog||i.tutorialStepInfo[r].showHint}))}handleResize(){var e=this.props.parent.state.tutorialOptions;this.setShowSeeMore(e.autoexpandStep)}componentDidMount(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep),this.resizeDebouncer=pxt.Util.debounce(this.handleResize,500),window.addEventListener("resize",this.resizeDebouncer)}onMarkdownDidRender(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep)}componentWillUnmount(){y.MarkedContent.clearBlockSnippetCache(),this.lastStep=-1,this.props.parent.stopPokeUserActivity(),this.removeHintOnClick(),window.removeEventListener("resize",this.resizeDebouncer)}removeHintOnClick(){document.removeEventListener("click",this.closeHint)}toggleExpanded(e){e.stopPropagation(),e.preventDefault();e=this.props.parent.state.tutorialOptions.tutorialStepExpanded;return this.props.parent.setTutorialInstructionsExpanded(!e),!1}hasHint(){var{tutorialReady:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions;return!!e&&(!!t[i].hintContentMd||t[i].showDialog)}hintOnClick(e){var t,i=this.props.parent.state.tutorialOptions;i?(e&&e.stopPropagation(),{tutorialStepInfo:e,tutorialStep:i}=i,t=e[i],i=i<e.length-1&&t&&!!t.showDialog,this.props.parent.clearUserPoke(),i||this.toggleHint()):pxt.reportError("tutorial","leaking hintonclick")}showTutorialValidationMessageOnClick(e){this.setState({showTutorialValidationMessage:!0})}expandedHintOnClick(e){e.stopPropagation()}setShowSeeMore(e){var t=this.refs.tutorialmessage;let i=!1;t&&t.firstElementChild&&t.firstElementChild.firstElementChild&&(i=t.clientHeight<=t.firstElementChild.firstElementChild.scrollHeight)&&(this.cardHeight=t.firstElementChild.firstElementChild.scrollHeight,e)&&this.props.parent.setTutorialInstructionsExpanded(!0),this.setState({showSeeMore:i}),this.props.parent.setEditorOffset()}getCardHeight(){return this.cardHeight}getExpandedCardStyle(e){return{[e]:`calc(${this.getCardHeight()}px + 2rem)`}}toggleHint(e){this.showHint(!this.state.showHint,e)}closeHint(e){this.showHint(!1)}showHint(e,t){if(this.removeHintOnClick(),this.closeLightbox(),this.hasHint()){var i=this.refs.tutorialhint;if(i){var n=this.props.parent.state.tutorialOptions.tutorialStep;if(e){i.elementRef&&i.elementRef.addEventListener("click",this.expandedHintOnClick),this.setState({showHint:!0}),this.props.parent.stopPokeUserActivity();const e=this.props.parent.state.tutorialOptions;e.tutorialStepInfo[e.tutorialStep].showDialog||document.addEventListener("click",this.closeHint),pxt.tickEvent("tutorial.showhint",{tutorial:e.tutorial,step:e.tutorialStep}),this.props.parent.setHintSeen(n)}else i.elementRef&&i.elementRef.removeEventListener("click",this.expandedHintOnClick),this.setState({showHint:!1}),this.props.parent.pokeUserActivity();i.showHint(e,t),e&&this.setState({showTutorialValidationMessage:!1})}}}closeTutorialValidationMessage(){this.setState({showTutorialValidationMessage:!1})}isCodeValidated(t){if(null==t)return!1;for(let e=0;e<t.length;e++)if(t[e].ruleTurnOn&&!t[e].ruleStatus)return!1;return!0}areStrictRulesPresent(e){return null!=(e=null==e?void 0:e.some(e=>e.ruleTurnOn&&e.isStrict))&&e}validationTelemetry(t){const{tutorialName:e,tutorialStepInfo:i,tutorialStep:n}=this.props.parent.state.tutorialOptions,r=i[n].listOfValidationRules;if(null!=r){const i={tutorial:e,step:n};for(let e=0;e<r.length;e++){var o;r[e].ruleTurnOn&&(i.ruleName=r[e].ruleName,o="tutorial.validation."+t+(r[e].ruleStatus?".pass":".fail"),pxt.tickEvent(o,i))}}}renderCore(){var{tutorialReady:e,tutorialStepInfo:t,tutorialStep:i,tutorialStepExpanded:n,metadata:r}=this.props.parent.state.tutorialOptions;if(!e)return b.createElement("div",null);var o=t[i],a=!!pxt.appTarget.appTheme.lockedEditor,t=t.length,r=r&&r.hideIteration,s=e&&0!=i&&!r,l=e&&i!=t-1&&!r,a=!a&&i==t-1&&!r,i=this.hasHint(),t=o.headerContentMd,r=o.showDialog,c=null!=o.listOfValidationRules,d=this.isCodeValidated(o.listOfValidationRules),u=this.state.showTutorialValidationMessage&&c,p=this.areStrictRulesPresent(o.listOfValidationRules),c=!c||!p||d&&p?this.nextTutorialStep:this.state.showTutorialValidationMessage?this.doubleClickedNextStep:this.showTutorialValidationMessageOnClick,h=lf("Press Space or Enter to show a hint."),f=lf("Click to show a hint!");let m=this.hintOnClick;(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&this.state.showHint&&!r&&(m=null);var g=pxt.Util.isUserLanguageRtl();return b.createElement("div",{id:"tutorialcard",className:`ui ${n?"tutorialExpanded":""} ${e?"tutorialReady":""} ${this.state.showSeeMore?"seemore":""}  ${this.state.showHint?"":"showTooltip"} `+(i?"hasHint":""),style:n?this.getExpandedCardStyle("height"):null},i&&this.state.showHint&&!r&&b.createElement("div",{className:"mask",role:"region",onClick:this.closeHint}),b.createElement("div",{className:"ui buttons"},s?b.createElement(v.Button,{icon:(g?"right":"left")+" chevron large",className:"prevbutton left attached "+(s?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.previousTutorialStep,onKeyDown:v.fireClickOnEnter}):void 0,b.createElement("div",{className:"ui segment attached tutorialsegment"},b.createElement("div",{ref:"tutorialmessage",className:"tutorialmessage",role:"alert"},b.createElement("div",{className:"content"},!r&&b.createElement(y.MarkedContent,{className:"no-select",tabIndex:0,markdown:t,parent:this.props.parent,onDidRender:this.onMarkdownDidRender}))),b.createElement("div",{className:"avatar-container"},!r&&i&&b.createElement(v.Button,{className:"ui circular label blue hintbutton hidelightbox "+(this.props.pokeUser?"shake flash":""),icon:"lightbulb","aria-label":h,title:f,onClick:m,onKeyDown:v.fireClickOnEnter}),!r&&i&&b.createElement(w.HintTooltip,{ref:"hinttooltip",pokeUser:this.props.pokeUser,text:f,onClick:m}),b.createElement(x,{ref:"tutorialhint",parent:this.props.parent})),this.state.showSeeMore&&!n&&b.createElement(v.Button,{className:"fluid compact lightgrey",icon:"chevron down",tabIndex:0,text:lf("More..."),onClick:this.toggleExpanded,onKeyDown:v.fireClickOnEnter}),this.state.showSeeMore&&n&&b.createElement(v.Button,{className:"fluid compact lightgrey",icon:"chevron up",tabIndex:0,text:lf("Less..."),onClick:this.toggleExpanded,onKeyDown:v.fireClickOnEnter})),l?b.createElement(v.Button,{icon:(g?"left":"right")+" chevron large",className:`nextbutton right attached ${l?"":"disabled"}  `+(d?"isValidated":""),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:c,onKeyDown:v.fireClickOnEnter}):void 0,u&&b.createElement(k.ShowValidationMessage,{onYesButtonClick:this.nextTutorialStep,onNoButtonClick:this.closeTutorialValidationMessage,initialVisible:this.state.showTutorialValidationMessage,isTutorialCodeInvalid:!d,ruleComponents:o.listOfValidationRules,areStrictRulesPresent:p,validationTelemetry:this.validationTelemetry,parent:this.props.parent}),a?b.createElement(v.Button,{icon:"left checkmark",className:"orange right attached "+(e?"":"disabled"),text:lf("Finish"),ariaLabel:lf("Finish the tutorial."),onClick:this.finishTutorial,onKeyDown:v.fireClickOnEnter}):void 0))}}i.TutorialCard=m;class g extends r.Component{constructor(e){super(e),this.flyoutWidth=0,this.flyoutTitle=lf("Toolbox"),this.workspaceWidth=0,this.handleResize=this.handleResize.bind(this),this.state={windowSize:window.innerWidth}}handleResize(){this.setState({windowSize:window.innerWidth})}componentDidMount(){window.addEventListener("resize",this.handleResize),window.addEventListener("wheel",this.handleResize),window.addEventListener("pointermove",this.handleResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("wheel",this.handleResize),window.removeEventListener("pointermove",this.handleResize)}UNSAFE_componentWillUpdate(){var e=document.querySelector(".blocklyFlyout"),e=(e&&(this.flyoutWidth=e.getBoundingClientRect().width),document.querySelector("#blocksArea"));e&&(this.workspaceWidth=e.clientWidth-this.flyoutWidth-4)}headerStyle(){return{width:this.flyoutWidth}}workspaceStyle(){return{width:this.workspaceWidth}}renderCore(){return b.createElement("div",{id:"headers"},b.createElement("div",{id:"flyoutHeader",style:this.headerStyle()},b.createElement("div",{id:"flyoutHeaderTitle",className:"no-select"},this.flyoutTitle)),b.createElement("div",{id:"workspaceHeader",style:this.workspaceStyle()},b.createElement(s.SmallEditorToolbar,{parent:this.props.parent})))}}i.WorkspaceHeader=g},{"./compiler":18,"./core":64,"./data":67,"./editortoolbar":76,"./hinttooltip":89,"./immersivereader":93,"./marked":97,"./sounds":127,"./sui":129,"./tutorialCodeValidation":133,react:320,"react-dom":276}],133:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ShowValidationMessage=void 0;const r=e("react"),n=e("./data"),o=e("./sui"),a=e("./compiler");class s extends n.Component{constructor(e){super(e),this.renderedBlockCache={},this.state={visible:this.props.initialVisible,ruleBlocks:{}}}showTutorialValidationMessage(e){this.setState({visible:e})}moveOnToNextTutorialStep(){this.props.validationTelemetry("continue"),this.props.onYesButtonClick(),this.showTutorialValidationMessage(!1)}stayOnThisTutorialStep(){this.props.validationTelemetry("edit"),this.props.onNoButtonClick()}componentDidMount(){this.props.ruleComponents.forEach(e=>{var t;!e.blockIds||null!=(t=null==(t=this.state.ruleBlocks)?void 0:t[e.ruleName])&&t.length||this.getRuleBlocksAsync(e)})}UNSAFE_componentWillReceiveProps(e,i){e.ruleComponents.forEach(t=>{var e=this.props.ruleComponents.find(e=>e.ruleName==t.ruleName);(t.blockIds&&t.blockIds.sort().toString()!=(null==(e=null==(e=null==e?void 0:e.blockIds)?void 0:e.sort())?void 0:e.toString())||(null==(e=t.blockIds)?void 0:e.length)!=(null==(e=null==(e=i.ruleBlocks)?void 0:e[t.ruleName])?void 0:e.length))&&this.getRuleBlocksAsync(t)})}renderRule(e,t){var i=null==(i=this.state.ruleBlocks)?void 0:i[e.ruleName];return i?r.createElement("div",null,r.createElement("div",{className:"codeValidationPopUpText"},e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:""),r.createElement("div",{className:"validationRendering"},i.map((e,t)=>r.createElement("div",null," ",r.createElement("img",{key:t+e,src:e,alt:"block rendered"}))))):r.createElement("p",{key:t+e.ruleName},e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:"")}getRuleBlocksAsync(t){t.blockIds&&a.getBlocksAsync().then(o=>Promise.all(t.blockIds.map(e=>{if(this.renderedBlockCache[e])return Promise.resolve(this.renderedBlockCache[e]);if(o.blocksById[e]){var t=pxt.blocks.blockSymbol(e);if(t){const e=pxt.blocks.compileInfo(t),i=pxt.blocks.createToolboxBlock(o,t,e),n=pxt.blocks.render(`<xml xmlns="https://developers.google.com/blockly/xml">${i.outerHTML}</xml>`,{snippetMode:!0,splitSvg:!1}),r=n.getAttribute("viewBox").split(/\s+/).map(e=>parseInt(e));return pxt.blocks.layout.blocklyToSvgAsync(n,r[0],r[1],r[2],r[3]).then(e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:1}):Promise.resolve(void 0))}}return Promise.resolve(void 0)})).then(e=>{this.setState({ruleBlocks:Object.assign(Object.assign({},this.state.ruleBlocks),{[t.ruleName]:e.filter(e=>!!e)})})}))}renderCore(){var e=this.props.isTutorialCodeInvalid,t=this.props.ruleComponents,i=null!=t,n=this.props.areStrictRulesPresent;return r.createElement("div",null,this.state.visible&&r.createElement("div",{className:"mask",role:"region",onClick:this.props.onNoButtonClick}),r.createElement("div",{className:"tutorialCodeValidation no-select "+(e&&n?"":"hidden")},r.createElement("div",null,i&&t.map((e,t)=>this.renderRule(e,t))),r.createElement("div",{className:"codeValidationPopUpText"},lf("Do you still want to continue?")),r.createElement("div",{className:"moveOnButtons"},r.createElement(o.Button,{className:"yes",ariaLabel:lf("yes button for tutorial code validation"),onClick:this.moveOnToNextTutorialStep.bind(this),onKeyDown:o.fireClickOnEnter}," ",lf("Continue Anyway")," "),r.createElement(o.Button,{className:"no",ariaLabel:lf("no button for tutorial code validation"),onClick:this.stayOnThisTutorialStep.bind(this),onKeyDown:o.fireClickOnEnter}," ",lf("Keep Editing")," "))))}}i.ShowValidationMessage=s},{"./compiler":18,"./data":67,"./sui":129,react:320}],134:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProfileDialog=void 0;const o=e("react"),a=e("./sui"),n=e("./core"),s=e("./auth"),r=e("./cloudsync");class l extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.handleTabClick=e=>{this.setState({location:e})},this.state={visible:e.visible,location:"my-stuff"}}show(e){this.setState({visible:!0,location:e=null!=e?e:"my-stuff"})}renderCore(){var e,t;return this.isLoggedIn()?(e=this.getUserProfile(),t=r.githubProvider().user(),o.createElement(a.Modal,{isOpen:this.state.visible,className:"ui profiledialog",size:"fullscreen",onClose:this.hide,dimmer:!0,closeIcon:!0,header:null==(e=null==e?void 0:e.idp)?void 0:e.displayName,closeOnDimmerClick:!1,closeOnDocumentClick:!1,closeOnEscape:!1},o.createElement(c,{parent:this}),t?o.createElement(d,{parent:this}):void 0,o.createElement(u,{parent:this}))):null}}i.ProfileDialog=l;class c extends a.UIElement{constructor(){super(...arguments),this.handleSignoutClicked=async()=>{await s.logoutAsync()},this.handleDeleteAccountClick=async()=>{this.getData(s.USER_PROFILE),await n.confirmAsync({header:lf("Delete Profile"),body:lf("Are you sure? This cannot be reversed! Your cloud-saved projects will be converted to local projects on this device."),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Confirm"),disagreeLbl:lf("Back to safety"),disagreeIcon:"arrow right",confirmationCheckbox:lf("I understand this is permanent. No undo.")})&&(await s.deleteProfileAsync(),this.props.parent.hide(),n.infoNotification(lf("Profile deleted!")))}}renderCore(){var e,t=this.getData(s.USER_PROFILE),i=pxt.auth.identityProvider(null==(i=null==t?void 0:t.idp)?void 0:i.provider),n=o.createElement("div",{className:"profile-pic avatar"},o.createElement("img",{src:null==(n=null==(n=null==t?void 0:t.idp)?void 0:n.picture)?void 0:n.dataUrl,alt:lf("User")})),r=o.createElement("div",{className:"profile-pic avatar"},o.createElement("span",null,pxt.auth.userInitials(t)));return o.createElement("div",{className:"ui card panel"},o.createElement("div",{className:"header-text"},o.createElement("label",null,lf("Profile"))),null!=(e=null==(e=null==t?void 0:t.idp)?void 0:e.picture)&&e.dataUrl?n:r,o.createElement("div",{className:"row-span-two"},o.createElement("label",{className:"title"},lf("Name")),o.createElement("p",{className:"value"},(null==(e=null==t?void 0:t.idp)?void 0:e.displayName)||(null==(n=null==t?void 0:t.idp)?void 0:n.username))),o.createElement("div",{className:"row-span-two"},o.createElement("label",{className:"title"},lf("Username")),o.createElement("p",{className:"value"},null==(r=null==t?void 0:t.idp)?void 0:r.username)),o.createElement("div",{className:"row-span-two"},o.createElement("label",{className:"title"},lf("Provider")),o.createElement("p",{className:"value"},i.name)),o.createElement("div",{className:"row-span-two"},o.createElement(a.Button,{text:lf("Sign out"),icon:"xicon "+(null==(e=null==t?void 0:t.idp)?void 0:e.provider),ariaLabel:lf("Sign out {0}",null==(n=null==t?void 0:t.idp)?void 0:n.provider),onClick:this.handleSignoutClicked})),o.createElement("div",{className:"row-span-two"},o.createElement(a.Link,{className:"ui",text:lf("I want to delete my profile"),ariaLabel:lf("delete profile"),onClick:this.handleDeleteAccountClick})))}}class d extends a.UIElement{constructor(){super(...arguments),this.handleUnlinkClicked=()=>{var e=r.githubProvider();e&&e.logout()}}renderUsername(){var e=r.githubProvider().user();return o.createElement(o.Fragment,null,o.createElement("div",{className:"row-span-two"},o.createElement("label",{className:"title"},lf("Name")),o.createElement("p",{className:"value"},null==e?void 0:e.name)),o.createElement("div",{className:"row-span-two"},o.createElement("label",{className:"title"},lf("Username")),o.createElement("p",{className:"value"},null==e?void 0:e.userName)))}renderUserPhoto(e){return o.createElement("div",{className:"profile-pic avatar"},o.createElement("img",{src:e,alt:lf("GitHub user photo")}))}renderUnlink(){return o.createElement("div",{className:"row-span-two"},o.createElement(a.Button,{text:lf("Unlink"),icon:"github",ariaLabel:lf("Unlink GitHub"),onClick:this.handleUnlinkClicked}))}renderDisconnected(){return o.createElement("div",{className:"row-span-two"},o.createElement("p",{className:"description"},lf("You haven't linked a GitHub account.")))}renderCore(){var e=r.githubProvider();return e?(e=e.user(),o.createElement("div",{className:"ui card panel"},o.createElement("div",{className:"header-text"},o.createElement("label",null,lf("GitHub"))),null!=e&&e.photo?this.renderUserPhoto(e.photo):void 0,e?this.renderUsername():void 0,e?this.renderUnlink():void 0,e?void 0:this.renderDisconnected())):null}}class u extends a.UIElement{renderCore(){return o.createElement("div",{className:"ui card panel"},o.createElement("div",{className:"header-text"},o.createElement("label",null,lf("Feedback"))),o.createElement("div",{className:"row-span-two"},lf("What do you think about the Sign In & Cloud Save feature? Is there something you'd like to change? Did you encounter issues? Please let us know!")),o.createElement("div",{className:"row-span-two"},o.createElement(a.Link,{className:"ui",text:lf("Take the Survey"),icon:"external alternate",ariaLabel:lf("Provide feedback in a form"),href:"https://aka.ms/AAcnpaj",target:"_blank",onKeyDown:a.fireClickOnEnter})))}}},{"./auth":8,"./cloudsync":15,"./core":64,"./sui":129,react:320}],135:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.renderUnpairDialog=i.webUsbPairLegacyDialogAsync=i.webUsbPairThemedDialogAsync=i.webUsbPairDialogAsync=void 0;const c=e("react"),d=e("./core");async function r(e,t){var i=p();if(!await function(e){const t=h().connectDeviceImage,i=p(),n=t?"two":"one";return u(e,()=>c.createElement("div",{className:`ui ${n} column grid padded download-dialog`},c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},lf("First, make sure your {0} is connected to your computer with a USB cable.",i))))),t&&c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"image download-dialog-image"},c.createElement("img",{alt:lf("Image connecting {0} to a computer",i),className:"ui medium rounded image",src:t}))))),lf("Next"),lf("Connect your {0}…",i),"downloaddialog.button.connectusb")}(t))return 0;if(!await function(e){const t=p();let i,n=h().webUSBDeviceNames;1===(n=n&&n.length?n:[t]).length||3<n.length?i=lf("Pair your {0} to the computer by selecting {1} from the popup that appears after you press the 'Next' button below.",t,"{1}"):2===n.length?i=lf("Pair your {0} to the computer by selecting {1} or {2} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}"):3===n.length&&(i=lf("Pair your {0} to the computer by selecting {1}, {2}, or {3} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}","{3}"));const r=i.split(/\{\d\}/),o=[];let a=n.map(e=>c.createElement("span",{className:"download-device-name"},"'",e,"'"));for(;a.length;)if(o.push(r.shift()),1<a.length&&1===r.length){for(let e=0;e<a.length;e++)o.push(a[e]),e<a.length-1&&o.push(", ");a=[]}else o.push(a.shift());o.push(...r);const s=h().selectDeviceImage,l=s?"two":"one";return u(e,()=>c.createElement("div",{className:`ui ${l} column grid padded download-dialog`},c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},o)))),s&&c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"image download-dialog-image"},c.createElement("img",{alt:lf("Image selecting {0} from a list of web usb devices",t),className:"ui medium rounded image",src:s}))))),lf("Next"),lf("Connect your {0}…",t),"downloaddialog.button.pickusbdevice")}(t))return 0;let n;d.showLoading("pair",lf('Select your {0} and press "Connect".',i));try{n=await e()}catch(e){d.errorNotification(lf("Pairing error: {0}",e.message)),n=!1}finally{d.hideLoading("pair")}return n?await function(e){const t=p(),i=h().connectionSuccessImage,n=i?"two":"one";return u(e,()=>c.createElement("div",{className:`ui ${n} column grid padded download-dialog`},c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},lf("Your {0} is connected! Pressing 'Download' will now automatically copy your code to your {0}.",t),c.createElement("br",null),c.createElement("br",null),lf("If you need to unpair this {0}, you can do so through the '…' menu next to the 'Download' button",t))))),i&&c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"image download-dialog-image"},c.createElement("img",{alt:lf("Image of {0}",t),className:"ui medium rounded image",src:i}))))),lf("Done"),lf("Connected to {0}",t),"downloaddialog.button.webusbsuccess",void 0,"large circle check purple")}(t):await function(e){const t=p();let i;i=h().minimumFirmwareVersion?lf("Make sure your {0} firmware is version {1} or above.",t,h().minimumFirmwareVersion):lf("Make sure your {0} has the latest firmware.",t);const n=h().checkUSBCableImage||h().connectDeviceImage,r=h().checkFirmwareVersionImage;return u(e,()=>c.createElement("div",null,c.createElement("div",{className:"ui content download-troubleshoot-header"},lf("We couldn't find your {0}. Here's a few ways to fix that:",t)),c.createElement("div",{className:"download-troubleshoot"},c.createElement("div",{className:"download-column"},n&&c.createElement("div",{className:"download-row image-row"},c.createElement("img",{alt:lf("Image connecting {0} to a computer",t),src:n})),c.createElement("div",{className:"download-row"},lf("Check the USB cable connecting your {0} to your computer.",t))),c.createElement("div",{className:"download-column"},r&&c.createElement("div",{className:"download-row image-row"},c.createElement("img",{alt:lf("Image depicting the firmware of {0}",t),src:r})),c.createElement("div",{className:"download-row"},i,c.createElement("br",null),c.createElement("a",{target:"_blank",href:h().firmwareHelpURL,rel:"noopener noreferrer"},lf("Learn more about firmware.",t)))))),lf("Try Again"),lf("Connect failed"),"downloaddialog.button.webusbfailed",h().troubleshootWebUSBHelpURL,"exclamation triangle purple")}(t)&&await r(e,t),n?1:0}function u(e,t,i,n,r,o,a){let s=!1;return e({header:n,jsxd:t,hasCloseIcon:!0,hideAgree:!0,className:"downloaddialog",helpUrl:o,bigHelpButton:!!o,headerIcon:a?a+" header-inline-icon":void 0,buttons:[{label:i,className:"primary",onclick:()=>{pxt.tickEvent(r),d.hideDialog(),s=!0}}]}).then(()=>s)}function n(r,o){let a=!1;const s=pxt.appTarget.appTheme.boardName||lf("device"),l=pxt.appTarget.appTheme.usbDocs;return new Promise((t,e)=>{const i=p(),n=()=>({header:lf("Connect to your {0}…",i),jsxd:()=>{var e,t=a&&function(){var e,t=null==(e=null==(t=null==(e=pxt.appTarget)?void 0:e.simulator)?void 0:t.boardDefinition)?void 0:e.id;if(t){const e=pxt.appTarget.bundledpkgs[t];if(e){const t=pxt.Package.parseAndValidConfig(e[pxt.CONFIG_NAME]);if(t)return t.firmwareUrl}}}();return null!=(e=pxt.commands)&&e.renderUsbPairDialog?null==(e=pxt.commands)?void 0:e.renderUsbPairDialog(t,a):c.createElement("div",{className:`ui ${t?"four":"three"} column grid stackable`},t&&c.createElement("div",{className:"column firmware"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},lf("Update Firmware"),c.createElement("br",null),c.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer"},lf("Check your firmware version and update if needed")))))),c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},c.createElement("span",{className:"ui yellow circular label"},"1"),lf("Connect {0} to your computer with a USB cable",s),c.createElement("br",null))))),c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},c.createElement("span",{className:"ui blue circular label"},"2"),lf("Select the device in the pairing dialog"))))),c.createElement("div",{className:"column"},c.createElement("div",{className:"ui"},c.createElement("div",{className:"content"},c.createElement("div",{className:"description"},c.createElement("span",{className:"ui blue circular label"},"3"),lf('Press "Connect"'))))))},hasCloseIcon:!0,hideAgree:!0,helpUrl:l,className:"downloaddialog",buttons:[{label:lf("Connect device"),icon:"usb",className:"primary",onclick:()=>{d.showLoading("pair",lf('Select your {0} and press "Connect".',i)),r().finally(()=>{d.hideLoading("pair"),d.hideDialog()}).then(e=>{e||a?t(e?1:0):(a=!0,d.forceUpdate(),o(n()))}).catch(e=>{pxt.reportException(e),d.errorNotification(lf("Pairing error: {0}",e.message)),t(0)})}}]});o(n())})}function p(){return pxt.appTarget.appTheme.boardName||lf("device")}function h(){return pxt.appTarget.appTheme.downloadDialogTheme||{}}i.webUsbPairDialogAsync=function(e,t){return(pxt.appTarget.appTheme.downloadDialogTheme?r:n)(e,t)},i.webUsbPairThemedDialogAsync=r,i.webUsbPairLegacyDialogAsync=n,i.renderUnpairDialog=function(){var e=p();return{header:lf("How to unpair your {0}",e),jsx:c.createElement("div",null,c.createElement("p",null,lf("You can unpair your {0} if the WebUSB download is malfunctioning. Click on the lock icon and uncheck your device.",e)),c.createElement("img",{className:"ui image centered medium",src:"./static/webusb/unpair.gif",alt:lf("A gif showing how to unpair the {0}",e)})),helpUrl:pxt.appTarget.appTheme.usbDocs&&pxt.appTarget.appTheme.usbDocs+"/webusb#unpair"}}},{"./core":64,react:320}],136:[function(e,M,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listAssetsAsync=t.saveAssetAsync=t.loadedAsync=t.resetAsync=t.syncAsync=t.installByIdAsync=t.downloadFilesByIdAsync=t.importGithubAsync=t.initializeGithubRepoAsync=t.prepareConfigForGithub=t.recomputeHeaderFlagsAsync=t.exportToGithubAsync=t.mergeUpstreamAsync=t.restoreCommitAsync=t.commitAsync=t.bumpAsync=t.bumpedVersion=t.prAsync=t.hasMergeConflictMarkersAsync=t.revertAllAsync=t.pullAsync=t.hasPullAsync=t.PullStatus=t.getPublishedScriptAsync=t.fixupFileNames=t.saveScreenshotAsync=t.createDuplicateName=t.duplicateAsync=t.installAsync=t.importAsync=t.saveAsync=t.partialSaveAsync=t.forceSaveAsync=t.anonymousPublishAsync=t.getTextAsync=t.initAsync=t.getLastCloudSync=t.getHeaderLastCloudSync=t.isHeaderSessionOutdated=t.acquireHeaderSession=t.computeSessionId=t.isHeadersSessionOutdated=t.getHeader=t.restoreFromBackupAsync=t.makeBackupAsync=t.getHeaders=t.setupWorkspace=t.copyProjectToLegacyEditor=t.gitsha=t.getWorkspaceType=void 0,t.dbgHdrToString=t.fireEvent=t.isBrowserWorkspace=void 0;const B=e("./db"),s=e("./core"),g=e("./data"),i=e("./browserworkspace"),n=e("./fileworkspace"),r=e("./memoryworkspace"),j=e("./iframeworkspace"),m=e("./cloudsync"),F=e("./idbworkspace"),b=e("./compiler"),o=e("./auth"),U=e("./cloud");var l,v=pxt.Util,c=pxt.Cloud;const H=e("crypto-js/sha1");let a,d,u=[],q=new v.PromiseQueue;function y(t){return u.find(e=>e.header.id==t||e.header.path==t)}function w(e,t="utf-8"){if("base64"!=t)return H("blob "+v.toUTF8(e).length+"\0"+e)+"";{const t=atob(e);return H("blob "+t.length+"\0"+t)+""}}async function z(e){var t;pxt.BrowserUtils.isWinRT()||(pxt.log(`workspace: error '${e}', switching from ${d} to memory workspace`),t=pxt.appTarget.appTheme.disableMemoryWorkspaceWarning||a===r.provider||pxt.shell.isSandboxMode()||pxt.shell.isReadOnly()||pxt.BrowserUtils.isIFrame(),pxt.tickEvent("workspace.syncerror",{ws:d,reason:e,expected:t?1:0}),t||await s.confirmAsync({header:lf("Warning! Project Auto-Save Disabled"),body:lf("We are unable to save your projects at this time. You can still manually save your project via direct download, or sharing your project."),agreeLbl:lf("Continue"),headerIcon:"warning",agreeClass:"cancel",agreeIcon:"cancel",helpUrl:"/browsers/no-auto-save",className:"auto-save-disabled-warning",hasCloseIcon:!0}),a=r.provider,d="mem")}function p(t=!1,e=!0){var i;x();const n=null==(i=o.userProfile())?void 0:i.id;let r=u.map(e=>e.header).filter(e=>(t||!e.isDeleted)&&!e.isBackup&&(!e.cloudUserId||e.cloudUserId===n));return(r=e?r.filter(e=>!!e.isSkillmapProject===pxt.BrowserUtils.isSkillmapEditor()):r).sort((e,t)=>{e=e.cloudUserId?Math.min(e.cloudLastSyncTime,e.modificationTime):e.modificationTime;return(t.cloudUserId?Math.min(t.cloudLastSyncTime,t.modificationTime):t.modificationTime)-e}),r}function h(e){x();e=y(e);return e&&!e.header.isDeleted?e.header:null}t.getWorkspaceType=function(){return d},t.gitsha=w,t.copyProjectToLegacyEditor=function(e,t){return le()?i.copyProjectToLegacyEditor(e,t):Promise.reject("Copy operation only works in browser workspace")},t.setupWorkspace=function(e){switch(v.assert(!a,"workspace set twice"),pxt.log("workspace: "+e),d=null!=e?e:"browser",e){case"fs":case"file":a=n.provider;break;case"mem":case"memory":a=r.provider;break;case"iframe":a=j.provider;break;case"uwp":n.setApiAsync(pxt.winrt.workspace.fileApiAsync),a=pxt.winrt.workspace.getProvider(n.provider);break;case"idb":a=F.provider;break;default:a=i.provider}},t.getHeaders=p,t.makeBackupAsync=function(e,t){let i=v.flatClone(e);return i.id=v.guidGen(),delete i._rev,delete i._id,i.isBackup=!0,A(i,t).then(()=>(e.backupRef=i.id,S(i))).then(()=>i)},t.restoreFromBackupAsync=function(t){if(!t.backupRef||t.isDeleted)return Promise.resolve();const i=t.backupRef;return _(i).then(e=>(delete t.backupRef,S(t,e))).then(()=>{var e=h(i);return e.isDeleted=!0,S(e)}).catch(()=>(delete t.backupRef,S(t)))},t.getHeader=h;let f="";function k(){return pxt.storage.getLocal("workspacesessionid")!=f}function x(){return k()?R().then(()=>{}):Promise.resolve()}function G(e){return e.length+" "+e.map(e=>e.modificationTime).reduce((e,t)=>Math.max(e,t),0).toString()}function V(){f=G(u.map(e=>e.header)),k()&&(pxt.storage.setLocal("workspacesessionid",f),pxt.debug("workspace: refreshed headers session to "+f),g.invalidate("header:*"),g.invalidate("text:*"))}t.isHeadersSessionOutdated=k,t.computeSessionId=G;const E=pxt.Util.guidGen();function W(e){e&&pxt.storage.removeLocal("workspaceheadersessionid:"+e.id)}function $(e){return!!e&&(e=pxt.storage.getLocal("workspaceheadersessionid:"+e.id))&&e!=E}function C(e){$(e)&&(pxt.tickEvent("workspace.conflict.header"),s.errorNotification(lf("This project is already opened elsewhere.")),pxt.debug("saved session ID: "+pxt.storage.getLocal("workspaceheadersessionid:"+e.id)),pxt.debug("our session ID: "+E),pxt.Util.assert(!1,"trying to access outdated session"))}function K(e){return e.cloudLastSyncTime||0}function _(e){return x().then(()=>{let t=y(e);return t?t.text?Promise.resolve(t.text):q.enqueue(e,()=>a.getAsync(t.header).then(e=>(t.text||(t.text=I(e.text)),t.version=e.version,t.text))):Promise.resolve(null)})}function S(e,t,i){return W(e),T(e,t,i)}async function T(p,h,e){var t;if(pxt.debug("workspace.saveAsync "+ue(p)),p.isDeleted&&W(p),C(p),v.assert(p.target==pxt.appTarget.id),p.temporary)return Promise.resolve();let f=y(p.id);const m=!f,i=(m&&(f={header:p,text:h,version:null},u.push(f)),!e&&!h),r=!e&&(p.isDeleted||h&&(()=>{if(m)return!0;const e=function(e,t){const i=e.header||{},n=t.header||{},r=e.text||{},o=t.text||{},a=v.unique([...Object.keys(i),...Object.keys(n)],e=>e).filter(e=>{return t=i[e],e=n[e],JSON.stringify(t)!==JSON.stringify(e);var t}),s=a.filter(e=>e in i&&!(e in n)).map(e=>({kind:"del",key:e,oldVal:i[e]})),l=a.filter(e=>!(e in i)&&e in n).map(e=>({kind:"add",key:e,newVal:n[e]})),c=a.filter(e=>e in i&&e in n).map(e=>({kind:"mod",key:e,oldVal:i[e],newVal:n[e]})),d=v.unique([...Object.keys(r),...Object.keys(o)],e=>e).filter(e=>r[e]!==o[e]);return{header:[...s,...l,...c],files:[...d.filter(e=>e in r&&!(e in o)&&!!t.text).map(e=>({kind:"del",key:e,oldVal:r[e].length})),...d.filter(e=>!(e in r)&&e in o).map(e=>({kind:"add",key:e,newVal:o[e].length})),...d.filter(e=>e in r&&e in o).map(e=>({kind:"mod",key:e,oldVal:r[e].length,newVal:o[e].length}))]}}(f,{header:p,text:h}),t=[P,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE],i=["recentUse","modificationTime","cloudCurrent","_rev","_id","cloudVersion"],n={header:e.header.filter(e=>i.indexOf(e.key)<0),files:e.files.filter(e=>t.indexOf(e.key)<0)},r=0<n.header.length||0<n.files.length;return r&&(pxt.debug("user changes:"),pxt.debug((a=e=>"\t"+e,s=e=>`${e.kind} ${e.key}: (${e.oldVal||""}) => (${e.newVal||""})`,l="",c=(o=n).header.filter(e=>"del"===e.kind),d=o.header.filter(e=>"add"===e.kind),u=o.header.filter(e=>"mod"===e.kind),l=(l=`HEADER (+${d.length}-${c.length}~${u.length})`+"\n")+o.header.map(s).map(a).join("\n")+"\n",d=o.files.filter(e=>"del"===e.kind),c=o.files.filter(e=>"add"===e.kind),u=o.files.filter(e=>"mod"===e.kind),(l=(l=l+`FILES (+${c.length}-${d.length}~${u.length})`+"\n")+o.files.map(s).map(a).join("\n"))+"\n"))),r;var o,a,s,l,c,d,u})());if((i||r)&&(p.pubCurrent=!1,p.cloudCurrent=!1,p.modificationTime=v.nowSeconds(),p.targetVersion=p.targetVersion||"0.0.0",o.hasIdentity())&&o.loggedIn()&&(p.cloudUserId=null==(t=o.userProfile())?void 0:t.id),e||(p.recentUse=v.nowSeconds()),m||(Object.assign(f.header,p),Object.keys(f.header).filter(e=>void 0===p[e]).forEach(e=>delete f.header[e]),p=f.header),h&&(f.text=h),(h||p.isDeleted)&&(p.saveId=null),h&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition){const e=pxt.Package.parseAndValidConfig(h[pxt.CONFIG_NAME]);e&&e.dependencies&&(p.board=Object.keys(e.dependencies).filter(e=>!!pxt.bundledSvg(e))[0])}return q.enqueue(p.id,async()=>{let t;await(void 0!==(i=f).version?Promise.resolve():a.getAsync(i.header).then(e=>{i.version=e.version}));var i,n=h?f.text:null;try{t=await a.setAsync(p,f.version,n)}catch(e){await z("write failed"),t=await a.setAsync(p,e.version,n)}!t&&h&&pxt.debug("write rejected due to version conflict!"),h&&(f.version=t),r&&(p.pubCurrent=!1,p.cloudCurrent=!1,p.saveId=null),(h||p.isDeleted)&&(g.invalidate("text:"+p.id),g.invalidate("pkg-git-status:"+p.id)),g.invalidateHeader("header",p),m&&g.invalidate("headers:"),V()})}function A(e,t,i=!1){return e.path=function(){let t=e.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(y(t=t||"Untitled")){let e=2;for(;y(t+"-"+e);)e++;t+="-"+e}return t}(),S(e,t,i)}function N(e,t,i=!1){v.assert(e.target==pxt.appTarget.id);const n=e;i||(n.id=ts.pxtc.Util.guidGen()),n.recentUse=v.nowSeconds(),n.modificationTime=n.recentUse;e=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);return e&&e.preferredEditor&&(n.editor=e.preferredEditor,pxt.shell.setEditorLanguagePref(e.preferredEditor)),pxt.github.cacheProjectDependenciesAsync(e).then(()=>A(n,t)).then(()=>n)}function J(e){let t=-1<e.name.indexOf("#")?e.name.substring(0,e.name.lastIndexOf("#")).trim():e.name,i=v.toDictionary(u.filter(e=>!e.header.isDeleted),e=>e.header.name),n=2;for(;i.hasOwnProperty(t+" #"+n);)n++;return t+" #"+n}function I(t){return t&&(["kind.json","yelm.json"].forEach(e=>{!t[pxt.CONFIG_NAME]&&t[e]&&(t[pxt.CONFIG_NAME]=t[e],delete t[e])}),t)}t.acquireHeaderSession=function(e){e&&pxt.storage.setLocal("workspaceheadersessionid:"+e.id,E)},t.isHeaderSessionOutdated=$,t.getHeaderLastCloudSync=K,t.getLastCloudSync=function(){var e;if(!o.loggedIn())return 0;const t=null==(e=o.userProfile())?void 0:e.id,i=p(!0).filter(e=>e.cloudUserId&&e.cloudUserId===t);return i.length?Math.min(...i.map(K)):0},t.initAsync=function(){return a||(a=i.provider,d="browser"),R().then(e=>function(){const e=u.map(e=>e.header),t={};return e.filter(e=>e.backupRef).forEach(e=>t[e.backupRef]=!0),Promise.all(e.filter(e=>e.isBackup&&!t[e.id]).map(e=>(e.isDeleted=!0,S(e))))}().then(()=>e)).then(e=>(pxt.perf.recordMilestone("workspace init finished"),e))},t.getTextAsync=_,t.anonymousPublishAsync=function(t,e,i,n){C(t);const r={};let o,a;if(t.saveId=r,n){const t=/^data:(image\/(png|gif));base64,([a-zA-Z0-9+/]+=*)$/.exec(n);t&&(o=t[3],a=t[1])}n=JSON.stringify(e,null,2)+"\n",e={name:t.name,target:t.target,targetVersion:t.targetVersion,description:i.description||lf("Made with ❤️ in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:t.editor,text:e,meta:{versions:pxt.appTarget.versions,blocksHeight:i.blocksHeight,blocksWidth:i.blocksWidth},thumbnailBuffer:o,thumbnailMimeType:a};return pxt.debug(`publishing script; ${n.length} bytes`),c.privatePostAsync("scripts",e,!0).then(e=>(e.shortid&&(e.id=e.shortid),t.pubId=e.shortid,t.pubCurrent=t.saveId===r,t.meta=e.meta,pxt.debug("published; id /"+t.pubId),T(t).then(()=>e)))},t.forceSaveAsync=S,t.partialSaveAsync=async function(e,t,i){var n,r=y(e);if(r)return(n=Object.assign({},await _(e)))[t]=i,T(r.header,n);pxt.log("Failed to save to unknown project: "+e),pxt.tickEvent("workspace.invalidSaveToUnknownProject")},t.saveAsync=T,t.importAsync=A,t.installAsync=N,t.duplicateAsync=async function(e,t){var i=await _(e.id);t=t||J(e);let n=v.flatClone(e);e=v.flatClone(i),n.id=v.guidGen(),n.name=t,t=JSON.parse(i[pxt.CONFIG_NAME]);return t.name=n.name,e[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(t),delete n._rev,delete n._id,delete n.githubCurrent,delete n.githubId,delete n.githubTag,n.cloudVersion&&pxt.tickEvent("identity.duplicatingCloudProject"),A(n=U.excludeLocalOnlyMetadataFields(n),e).then(()=>n)},t.createDuplicateName=J,t.saveScreenshotAsync=function(e,t,i){return C(e),a.saveScreenshotAsync?a.saveScreenshotAsync(e,t,i):Promise.resolve()},t.fixupFileNames=I;const Y=new v.PromiseQueue,X=new B.Table("script");async function O(i){pxt.github.isGithubId(i)&&(i=pxt.github.normalizeRepoId(i));const n=await pxt.packagesConfigAsync(),r=encodeURIComponent(pxt.github.upgradedPackageId(n,i));return Y.enqueue(r,async()=>{let t;try{t=(await X.getAsync(r)).files}catch(e){t=pxt.github.isGithubId(i)?(await pxt.github.downloadPackageAsync(i,n)).files:await c.downloadScriptFilesAsync(i).catch(s.handleNetworkError);try{await X.setAsync({id:r,files:t})}catch(e){pxt.log("Unable to cache script in DB")}}return I(t)})}t.getPublishedScriptAsync=O,(e=l=t.PullStatus||(t.PullStatus={}))[e.NoSourceControl=0]="NoSourceControl",e[e.UpToDate=1]="UpToDate",e[e.GotChanges=2]="GotChanges",e[e.NeedsCommit=3]="NeedsCommit",e[e.BranchNotFound=4]="BranchNotFound";const P=pxt.github.GIT_JSON;async function Q(e,t=!1){var i=await _(e.id),n=(await re(e,i),i[P]);if(!n)return l.NoSourceControl;var n=JSON.parse(n),r=pxt.github.parseRepoId(n.repo),o=r.tag,o=await pxt.github.getRefAsync(r.slug,o);if(!o){const e=await pxt.github.listRefsAsync(r.slug,"heads");return e&&e.length?l.BranchNotFound:l.NoSourceControl}if(o==n.commit.sha)return l.UpToDate;if(t)return l.GotChanges;try{return await L(e,{repo:n.repo,sha:o,files:i,tryDiff3:!0}),l.GotChanges}catch(e){if(e.isMergeError)return l.NeedsCommit;throw e}}function Z(e){e=pxt.semver.parse(e.version,"0.0.0");return e.patch++,pxt.semver.stringify(e)}t.hasPullAsync=async function(e){return await Q(e,!0)==l.GotChanges},t.pullAsync=Q,t.revertAllAsync=async function(e){const t=(await _(e.id))[P];if(!t)return l.NoSourceControl;var i=JSON.parse(t),n=pxt.github.parseRepoId(e.githubId),r=i.commit,i=pxt.github.lookupFile(n,r,pxt.CONFIG_NAME),o=pxt.Package.parseAndValidConfig(i&&i.blobContent);if(!o)return l.NoSourceControl;var a={};a[P]=t,a[pxt.CONFIG_NAME]=i.blobContent;for(const e of o.files.concat(o.testFiles)){const t=pxt.github.lookupFile(n,r,e);if(!t||void 0===t.blobContent)return pxt.log(`cannot revert ${e}, corrupted based commit`),l.NoSourceControl;a[e]=t.blobContent}return await S(e,a),l.UpToDate},t.hasMergeConflictMarkersAsync=async function(e){const t=await _(e.id);return!!Object.keys(t).find(e=>pxt.diff.hasMergeConflictMarker(t[e]))},t.prAsync=async function(e,t,i){var n=pxt.github.parseRepoId(e.githubId),r=await pxt.github.getNewBranchNameAsync(n.slug,"merge-"),t=(await pxt.github.createNewBranchAsync(n.slug,r,t),await pxt.github.createPRFromBranchAsync(n.slug,n.tag,r,i)),r=await pxt.github.getRefAsync(n.slug,n.tag);return await L(e,{repo:e.githubId,sha:r,files:{}}),t},t.bumpedVersion=Z,t.bumpAsync=async function(e,i=""){C(e);const t=await _(e.id),n=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);n.version=i||Z(n);i="v"+n.version;if(n.dependencies){const i=pxt.github.parseRepoId(e.githubId);Object.keys(n.dependencies).forEach(e=>{var t=n.dependencies[e],t=/^github:/.test(t)&&pxt.github.parseRepoId(t);t&&i.slug===t.slug&&(n.dependencies[e]="github:"+pxt.github.join(i.slug,t.fileName),pxt.debug(`patching dep ${e} to `+n.dependencies[e]))})}return t[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(n),await T(e,t),ne(e,{message:n.version,createRelease:i,binaryJs:!0})};const ee=".github/makecode/blocksdiff.png",te="assets/js/binary.js",ie="assets/version.txt";async function ne(e,o={}){await m.ensureGitHubTokenAsync();let t=await _(e.id),i=t[P],a=(i||v.userError(lf("Not a git extension.")),JSON.parse(i)),s=pxt.github.parseRepoId(a.repo),n=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]),l={base_tree:a.commit.tree.sha,tree:[]};const r=o.filenamesToCommit||pxt.allPkgFiles(n),c=[P,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE];for(const e of r.filter(e=>c.indexOf(e)<0)){const o=t[e];await f(e,o)}let d;if(0==l.tree.length&&v.userError(lf("Nothing to commit!")),o&&l.tree.find(e=>e.path==pxt.MAIN_BLOCKS)){if(o.blocksScreenshotAsync){const e=await o.blocksScreenshotAsync();e&&await f(".github/makecode/blocks.png",e)}if(o.blocksDiffScreenshotAsync){const e=await o.blocksDiffScreenshotAsync();e&&(d=await f(ee,e))}}if(pxt.appTarget.appTheme.githubCompiledJs&&o.binaryJs&&(!s.tag||"master"==s.tag)){const e=n.version||"0.0.0",o={jsMetaVersion:e},t=await b.compileAsync(o);if(t&&t.success&&t.outfiles[pxtc.BINARY_JS]&&(await f(te,t.outfiles[pxtc.BINARY_JS]),await f(ie,e),!n.disableTargetTemplateFiles)){const e=pxt.template.targetTemplateFiles();if(e)for(const o of Object.keys(e))await f(o,e[o])}}var u=await pxt.github.createObjectAsync(s.slug,"tree",l),u={message:o.message||lf("Update {0}",l.tree.map(e=>e.path).filter(e=>!/\.github\/makecode\//.test(e)).join(", ")),parents:[a.commit.sha],tree:u};a.mergeSha&&u.parents.push(a.mergeSha);let p=await pxt.github.createObjectAsync(s.slug,"commit",u),h=p;return null==(h=await pxt.github.fastForwardAsync(s.slug,s.tag,p)?h:await pxt.github.mergeAsync(s.slug,s.tag,p))?p:(g.invalidate("gh-commits:*"),d&&await pxt.github.postCommitComment(s.slug,p,`![${lf("Difference between blocks")}](https://raw.githubusercontent.com/`+pxt.github.join(s.slug,p,s.fileName,ee)),await L(e,{repo:a.repo,sha:h,files:t,saveTag:o.createRelease}),o.createRelease&&(await pxt.github.createReleaseAsync(s.slug,o.createRelease,h),await pxt.github.enablePagesAsync(s.slug),await pxt.github.listRefsAsync(s.slug,"tags",!0,!0)),"");async function f(e,t){var i={content:t,encoding:"utf-8"},n=(e==pxt.CONFIG_NAME&&(i.content=oe(i.content,!!o.createRelease)),/^data:([^;]+);base64,/.exec(t)),t=(n&&(i.encoding="base64",i.content=t.substr(n[0].length)),w(i.content,i.encoding)),n=pxt.github.lookupFile(s,a.commit,e);let r;if(!n||n.sha!=t){if("utf-8"==i.encoding&&pxt.diff.hasMergeConflictMarker(i.content))throw(n=new Error("Merge conflict marker error")).isMergeConflictMarkerError=!0,n;r=await pxt.github.createObjectAsync(s.slug,"blob",i),"utf-8"==i.encoding&&v.assert(r==t,`sha not matching ${r} != `+t);const o=pxt.github.join(s.fileName,e);l.tree.push({path:o,mode:"100644",type:"blob",sha:r,url:void 0})}return r}}function D(){var e=new Error("Merge error");return e.isMergeError=!0,e}async function L(e,o){const{repo:t,sha:a,files:s,justJSON:l}=o,c=pxt.github.parseRepoId(t),d=await pxt.github.getCommitAsync(c.slug,a);let u=JSON.parse(s[P]||"{}");u.commit||(u={repo:t,commit:null});const p={};let h=0,f=!1;const i=async e=>{p[e]=!0;var t=pxt.github.lookupFile(c,d,e),i=pxt.github.lookupFile(c,u.commit,e),n=null!=s[e]&&(!i||i.blobContent!=s[e]);if(!t)return o.tryDiff3&&n?s[e]:(l||(s[e]=""),"");let r=i?i.blobContent:s[e];if(null!=r&&w(r)==t.sha)t.blobContent=r,o.tryDiff3||o.justJSON||(s[e]=r);else{if(r=await pxt.github.downloadTextAsync(c.fullName,a,e),w(t.blobContent=r)!=t.sha&&w(`﻿`+r)!==t.sha&&v.userError(lf("Corrupt SHA1 on download of '{0}'.",e)),o.tryDiff3&&n)if(e==pxt.CONFIG_NAME){if(!(r=pxt.diff.mergeDiff3Config(s[e],i.blobContent,t.blobContent)))throw D()}else if(/\.blocks$/.test(e)){const o=pxt.blocks.mergeXml(s[e],i.blobContent,t.blobContent);f=f||!o,r=o||""}else if(e==te||e==ie||e==pxt.TUTORIAL_INFO_FILE||e==pxt.ASSETS_FILE)r=s[e];else{const o=pxt.diff.diff3(s[e],i.blobContent,t.blobContent,lf("local changes"),lf("remote changes (pulled from Github)"));if(!o)throw D();if(h+=o.numConflicts,o.numConflicts&&!/\.ts$/.test(e))throw D();r=o.merged}l||(s[e]=r)}return r},n=pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME]),r=await i(pxt.CONFIG_NAME);let m=pxt.Package.parseAndValidConfig(r);if(m||(e&&v.userError(lf("Invalid pxt.json file.")),pxt.debug("github: reconstructing pxt.json"),m=pxt.diff.reconstructConfig(c,s,d,pxt.appTarget.blocksprj||pxt.appTarget.tsprj),s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m)),n){let i=0;Object.keys(m.dependencies).filter(e=>/^github:/.test(m.dependencies[e])&&n.dependencies[e]).forEach(e=>{var t;pxt.github.parseRepoId(m.dependencies[e])&&(t=n.dependencies[e],m.dependencies[e]=t,i++)}),i&&(s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m))}for(const e of pxt.allPkgFiles(m).slice(1))await i(e);if(m.name||(m.name=(c.fileName||c.project||c.fullName).replace(/[^\w\-]/g,""),l)||(s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(m)),!l){if(f&&h)throw D();for(var g of Object.keys(s))"."==g[0]||p[g]||delete s[g]}d.tag=o.saveTag,u.mergeSha=void 0,u.commit=d,s[P]=JSON.stringify(u,null,4);var b=((null==(b=m.targetVersions)?void 0:b.targetId)===pxt.appTarget.id&&m.targetVersions.target?m.targetVersions:pxt.appTarget.versions).target;return e?(e.name=m.name,await S(e,s)):e=await N({name:m.name,githubId:t,pubId:"",pubCurrent:!1,meta:{},editor:pxt.BLOCKS_PROJECT_NAME,target:pxt.appTarget.id,targetVersion:b},s),e}async function re(n,r){C(n),n.githubCurrent=!1;var o=JSON.parse(r[P]||"{}");if(n.githubId=o&&o.repo,n.githubTag=o&&o.commit&&o.commit.tag,n.githubId&&o.commit&&o.commit.tree){const l=pxt.github.parseRepoId(n.githubId);let t=!0,i=!1;for(var a of Object.keys(r))if(a!=P&&a!=pxt.SIMSTATE_JSON&&a!=pxt.SERIAL_EDITOR_FILE){var s=pxt.github.lookupFile(l,o.commit,a);if(s&&"blob"==s.type){null==s.blobContent&&(i=!0);let e=r[a];(e=a==pxt.CONFIG_NAME?oe(e):e)&&s.sha!=w(e)&&(t=!1)}else t=!1}if(n.githubCurrent=t,i&&await L(n,{repo:o.repo,sha:o.commit.sha,files:r,justJSON:!0}),null==o.isFork){const l=pxt.github.parseRepoId(o.repo),e=await pxt.github.repoAsync(l.fullName,null);e&&(o.isFork=!!e.fork,r[P]=JSON.stringify(o,null,4),await T(n,r))}}}function oe(e,t){const i=pxt.Package.parseAndValidConfig(e);if(!i)return e;delete i.installedVersion,delete i.additionalFilePath,delete i.additionalFilePaths;var e=i.supportedTargets||[],n=(e.indexOf(pxt.appTarget.id)<0&&(e.push(pxt.appTarget.id),e.sort(),i.supportedTargets=e),i.targetVersions=Object.assign(Object.assign({},i.targetVersions),{target:pxt.appTarget.versions.target,targetId:pxt.appTarget.id}),Object.keys(i.dependencies).filter(e=>/^(file|workspace):/.test(i.dependencies[e])));for(const e of n){r=void 0;o=void 0;var r=e;const a=i.dependencies[r],s=h(a.substring(a.indexOf(":")+1));if(s)if(s.githubId){const a=pxt.github.parseRepoId(s.githubId);t&&!/^v\d+/.test(s.githubTag)&&v.userError(lf("You need to create a release for dependency {0}.",r));var o=s.githubTag||a.tag;i.dependencies[r]=`github:${a.fullName}#`+o}else t&&v.userError(lf("Dependency {0} is a local project.",r))}return pxt.Package.stringifyConfig(i)}async function ae(e,t,i,n){await m.ensureGitHubTokenAsync();let r=pxt.github.parseRepoId(t),o=r.fullName.replace(/.*\//,""),a=await _(e.id);var s=pxt.template.packageFiles(o);if(pxt.template.packageFilesFixup(s,{repo:r.fullName,repoowner:r.owner,reponame:r.project,repotag:r.tag}),i)v.jsonMergeFrom(a,s);else{pxt.Package.parseAndValidConfig(a[pxt.CONFIG_NAME])||delete a[pxt.CONFIG_NAME];let e=s[pxt.README_FILE];const t=a[pxt.README_FILE];(e||t)&&(e=[t,e].filter(e=>!!e).join("\n\n")),v.jsonMergeFrom(s,a),a=s,e&&(a[pxt.README_FILE]=e)}const l=pxt.Package.parseAndValidConfig(a[pxt.CONFIG_NAME]),c=l.files;c.filter(e=>/\.ts$/.test(e)).length||Object.keys(a).filter(e=>/\.(blocks|ts|py|asm|md|json)$/.test(e)).filter(e=>e!=pxt.CONFIG_NAME).forEach(e=>c.push(e));t=l.testFiles||(l.testFiles=[]);a["test.ts"]&&t.indexOf("test.ts")<0&&t.push("test.ts"),a[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(l),await S(e,a),await ne(e,{message:lf("Initial files for MakeCode project"),filenamesToCommit:Object.keys(a),binaryJs:n}),a=await _(e.id);const d=pxt.allPkgFiles(pxt.Package.parseAndValidConfig(a[pxt.CONFIG_NAME])),u=[P,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE,pxt.CONFIG_NAME];Object.keys(a).filter(e=>u.indexOf(e)<0&&d.indexOf(e)<0).forEach(e=>delete a[e]),await T(e,a);try{await pxt.github.enablePagesAsync(r.slug)}catch(e){pxt.reportException(e)}return e}let se;function R(){return pxt.debug("workspace: sync"),se=se||a.listAsync().catch(e=>z("sync failed").then(()=>a.listAsync())).then(e=>{const i=v.toDictionary(u||[],e=>e.header.id);u=e.map(e=>{let t=i[e.id];return t?JSON.stringify(t.header)!==JSON.stringify(e)&&(v.jsonCopyFrom(t.header,e),t.text=void 0,t.version=void 0,g.invalidateHeader("header",e),g.invalidateHeader("text",e),g.invalidateHeader("pkg-git-status",e),g.invalidate("gh-commits:*")):t={header:e,text:void 0,version:void 0},t}),m.syncAsync()}).then(()=>(V(),a.getSyncState?a.getSyncState():null)).finally(()=>{se=void 0})}function le(){return a===i.provider}t.commitAsync=ne,t.restoreCommitAsync=async function(e,t){await m.ensureGitHubTokenAsync();var i=await _(e.id),n=i[P],n=JSON.parse(n),r=pxt.github.parseRepoId(n.repo),o=new Date(Date.parse(t.committer.date)),o={message:lf("Restore '{0} {1}'",o.toLocaleString(),t.message),parents:[n.commit.sha],tree:t.tree.sha},t=await pxt.github.createObjectAsync(r.slug,"commit",o);await pxt.github.fastForwardAsync(r.slug,r.tag,t),await L(e,{repo:n.repo,sha:t,files:i})},t.mergeUpstreamAsync=async function(e,t){return Promise.resolve()},t.exportToGithubAsync=async function(e,t){var i=pxt.github.parseRepoId(t),n=pxt.template.packageFiles(e.name),n=(await pxt.github.putFileAsync(i.fullName,".gitignore",n[".gitignore"]),await pxt.github.getRefAsync(i.slug,i.tag)),i=await pxt.github.getCommitAsync(i.slug,n),n=await _(e.id),i=(n[P]=JSON.stringify({repo:t,commit:i}),n[pxt.MAIN_BLOCKS]);if(i){const e=pxt.blocks.loadWorkspaceXml(i,!0);if(e){const t=pxt.blocks.saveWorkspaceXml(e,!0);t&&(n[pxt.MAIN_BLOCKS]=t)}}await S(e,n),await ae(e,t,!1,!0)},t.recomputeHeaderFlagsAsync=re,t.prepareConfigForGithub=oe,t.initializeGithubRepoAsync=ae,t.importGithubAsync=async function(e){const t=pxt.github.normalizeRepoId(e).replace(/^github:/,""),i=pxt.github.parseRepoId(t);let n="",r=!1,o=!1;try{n=await pxt.github.getRefAsync(i.slug,i.tag);const e=await pxt.github.getCommitAsync(i.slug,n),t=pxt.github.join(i.fileName,pxt.CONFIG_NAME);if(!e.tree.tree.find(e=>e.path==t)&&(pxt.debug("github: detected import non-makecode project"),pxt.shell.isReadOnly()&&v.userError(lf("This repository looks empty.")),r=!0,o=!1,!await s.confirmAsync({header:i.fileName?lf("Add a nested extension to existing GitHub repository?"):lf("Initialize GitHub repository for MakeCode?"),body:i.fileName?lf("We need to add a few files under the /{0} folder to your GitHub repository https://github.com/{1} to create the nested extension.",i.fileName,i.slug):lf("We need to add a few files to your GitHub repository https://github.com/{0} to make it work with MakeCode.",i.fullName),agreeLbl:lf("Ok"),hasCloseIcon:!0,helpUrl:"/github/import"})))return Promise.resolve(void 0)}catch(e){409==e.statusCode?(pxt.debug("github: detected import empty project"),pxt.shell.isReadOnly()&&v.userError(lf("This repository looks empty.")),await m.ensureGitHubTokenAsync(),await pxt.github.putFileAsync(i.fullName,".gitignore","# Initial\n"),r=!0,o=!0,n=await pxt.github.getRefAsync(i.slug,i.tag)):404==e.statusCode&&(s.errorNotification(lf("Sorry, that repository looks invalid.")),v.userError(lf("No such repository or branch.")))}var a=await L(null,{repo:t,sha:n,files:{}});return a&&r&&await ae(a,t,o,!1),a},t.downloadFilesByIdAsync=function(e){return c.privateGetAsync(e,!0).then(e=>O(e.id))},t.installByIdAsync=function(i){return c.privateGetAsync(i,!0).then(t=>O(t.id).then(e=>N({name:t.name,pubId:i,pubCurrent:!0,meta:t.meta,editor:t.editor,target:t.target,targetVersion:t.targetVersion||t.meta&&t.meta.versions&&t.meta.versions.target},e)))},t.syncAsync=R,t.resetAsync=function(){return u=[],a.resetAsync().then(m.resetAsync).then(B.destroyAsync).then(pxt.BrowserUtils.clearTranslationDbAsync).then(pxt.BrowserUtils.clearTutorialInfoDbAsync).then(b.clearApiInfoDbAsync).then(()=>{pxt.storage.clearLocal(),g.clearCache(),c.localToken&&pxt.storage.setLocal("local_token",c.localToken)}).then(()=>R()).then(()=>{})},t.loadedAsync=function(){return a.loadedAsync?a.loadedAsync():Promise.resolve()},t.saveAssetAsync=function(e,t,i){return a.saveAssetAsync?a.saveAssetAsync(e,t,i):Promise.reject(new Error(lf("Assets not supported here.")))},t.listAssetsAsync=function(e){return a.listAssetsAsync?a.listAssetsAsync(e):Promise.resolve([])},t.isBrowserWorkspace=le,t.fireEvent=function(e){if(a.fireEvent)return a.fireEvent(e)};const ce={};let de=1;function ue(e){return e?`${e.name} ${e.id.substr(0,4)}..v${t=e.cloudVersion,t?(ce[t]||(ce[t]="#"+de,de+=1),ce[t]):"#0"}@${e.modificationTime%100}-`+v.timeSince(e.modificationTime):"#null";var t}t.dbgHdrToString=ue,g.mountVirtualApi("header",{getSync:e=>"*"==(e=g.stripProtocol(e))?p():h(e)}),g.mountVirtualApi("headers",{getAsync:e=>{e=g.stripProtocol(e);const i=p();return e?b.projectSearchAsync({term:e,headers:i}).then(e=>e).then(e=>{let t=v.toDictionary(e||[],e=>e.id);return i.filter(e=>t[e.id])}):Promise.resolve(i)},expirationTime:e=>5e3,onInvalidated:()=>{b.projectSearchClear()}}),g.mountVirtualApi("text",{getAsync:e=>{const t=/^[\w\-]+:([^\/]+)(\/(.*))?/.exec(e);return _(t[1]).then(e=>t[3]?e[t[3]]:e)}})},{"./auth":8,"./browserworkspace":12,"./cloud":14,"./cloudsync":15,"./compiler":18,"./core":64,"./data":67,"./db":68,"./fileworkspace":82,"./idbworkspace":90,"./iframeworkspace":92,"./memoryworkspace":98,"crypto-js/sha1":157}],137:[function(e,t,i){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],138:[function(e,t,i){function n(){return t.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,n.apply(this,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],139:[function(e,t,i){var n=e("./setPrototypeOf.js");t.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./setPrototypeOf.js":143}],140:[function(e,t,i){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],141:[function(e,t,i){var a=e("./typeof.js").default;function s(e){var t,i;return"function"!=typeof WeakMap?null:(t=new WeakMap,i=new WeakMap,(s=function(e){return e?i:t})(e))}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};t=s(t);if(t&&t.has(e))return t.get(e);var i,n,r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&((n=o?Object.getOwnPropertyDescriptor(e,i):null)&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=e[i]);return r.default=e,t&&t.set(e,r),r},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":144}],142:[function(e,t,i){t.exports=function(e,t){if(null==e)return{};for(var i,n={},r=Object.keys(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||(n[i]=e[i]);return n},t.exports.__esModule=!0,t.exports.default=t.exports},{}],143:[function(e,i,t){function n(e,t){return i.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i.exports.__esModule=!0,i.exports.default=i.exports,n(e,t)}i.exports=n,i.exports.__esModule=!0,i.exports.default=i.exports},{}],144:[function(e,t,i){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],145:[function(e,t,i){var n=window,r=function(){return i=[function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=void 0,(t=t.CookiePolicy||(t.CookiePolicy={}))[t.Disable=0]="Disable",t[t.Enable=1]="Enable"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=t.launchAsync=t.close=t.renderButtons=void 0;var n=i(2),r=(Object.defineProperty(t,"renderButtons",{enumerable:!0,get:function(){return n.renderButtons}}),i(3)),o=(Object.defineProperty(t,"close",{enumerable:!0,get:function(){return r.close}}),Object.defineProperty(t,"launchAsync",{enumerable:!0,get:function(){return r.launchAsync}}),i(0));Object.defineProperty(t,"CookiePolicy",{enumerable:!0,get:function(){return o.CookiePolicy}}),"undefined"!=typeof window&&window.addEventListener("load",function(){var e;window.hasOwnProperty("Promise")||((e=document.createElement("script")).src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/promise-polyfill.min.js",document.head.appendChild(e)),n.renderButtons()})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderButtons=void 0;var n={af:"Indompelende leser",am:"በህያው ስሜት ፈጣሪ ዕይታ አንባቢ",ar:"القارئ الشامل",as:"ইমাৰচিভ ৰিডাৰ",az:"İmmersiv Oxuyucu",be:"Імерсіўны чытальнік",bg:"Концентриран четец",bn:"মনোগ্রাহী পাঠক","bn-bd":"ইমার্সিভ পাঠক",bs:"Koncentrirani čitalac",ca:"Lector immersiu",cs:"Asistivní čtečka","cy-gb":"Darllenydd Ymdrwythol",da:"Forenklet læser",de:"Plastischer Reader",el:"Προηγμένο πρόγραμμα ανάγνωσης",en:"Immersive Reader",es:"Lector inmersivo",et:"Süvaluger",eu:"Irakurgailu murgiltzailea",fa:"خواننده همه‌جانبه",fi:"Syventävä lukuohjelma",fil:"Immersive Reader",fr:"Lecteur immersif","ga-ie":"Léitheoir tumthach",gd:"An leughadair ùr-nòsach",gl:"Lector avanzado",gu:"ઇમર્સિવ રીડર",ha:"Mai karatu Mai barbazawa",he:"תצוגת קריאה מודרנית",hi:"इमर्सिव रीडर",hr:"Stopljeni čitač",hu:"Modern olvasó",hy:"Խորասուզված ընթերցիչ",id:"Pembaca Imersif",ig:"Ọgụụ Kenzipụtara",is:"Aðgengilegt lestrarumhverfi",it:"Strumento di lettura immersiva",ja:"イマーシブ リーダー",ka:"იმერსიული წამკითხველი",kk:"Иммерсивті оқу құралы",km:"កម្មវិធីអានពណ៌រំលេចនៅលើអេក្រង់",kn:"ಇಮ್ಮರ್ಸಿವ್ ಓದುಗ",ko:"몰입형 리더",kok:"तंद्री लागिल्लो वाचक","ku-arab":"خوێنەری پڕ",ky:"Курчаган Окугуч",lb:"Immersive Reader",lo:"ຕົວອ່ານອິມເມີສີບ",lt:"Įtraukianti skaitytuvė",lv:"Tīrskata lasītājs",mi:"Pūpānui Rumaki",mk:"Сеопфатен читач",ml:"ഇമ്മേഴ്‌സീവ് റീഡർ",mn:"Идэвхтэй уншигч",mr:"इमर्सिव्ह वाचक",ms:"Pembaca Imersif",mt:"Qarrej Immersiv",ne:"इमेर्सिभ रिडर",nl:"Insluitende lezer","nn-no":"Engasjerande lesar",no:"Engasjerende leser",nso:"Go Bala ka Mongwalo o Mokoto",or:"ଇମରସିଭ୍ ରିଡର୍",pa:"ਇਮਰਸਿਵ ਰੀਡਰ","pa-arab":"گھیرن آلا مطالعہ کار",pl:"Czytnik immersyjny",prs:"خواننده نمایش",pt:"Leitura Avançada",quc:"Nim ucholajil sik'inel uwach",quz:"Wankisqa Ñawiq",ro:"Immersive Reader",ru:"Иммерсивное средство чтения",rw:"Insakazasoma",sd:"امرسو ريڊر",si:"ගිලෙන සුළු කියවනය",sk:"Imerzná čítačka",sl:"Potopni bralnik",sq:"Lexuesi kredhës","sr-cyrl-ba":"Концентрисани читалац","sr-cyrl-rs":"Концентрисани читалац","sr-latn-rs":"Koncentrisani čitalac",sv:"Avancerad läsare",sw:"Kisomaji cha Kuzamisha",ta:"அற்புதமான ரீடர்",te:"మంత్రముగ్ధులను చేసే పఠన సాధనం","tg-cyrl-tj":"Хонандаи фарогир",th:"โปรแกรมช่วยอ่าน",ti:"ኣንባቢ ሕሉው ስምዒት ፈጣሪ",tk:"Giňişleýin okaýjy",tn:"Sebadi sa Imesife",tr:"Tam Ekran Okuyucu",tt:"Чолгап алучы уку чарасы","ug-cn":"چۆكمە ئوقۇغۇچ",uk:"Занурення в текст",ur:"امرسیو مطالعہ کار",uz:"Immersiv mutolaa vositasi",vi:"Trình đọc Chân thực",wo:"Jàngukaay bu Rafet",xh:"Isifundi Esikhulu",yo:"Ìwò Alámùtán",zh:"沉浸式阅读器","zh-hant":"沈浸式閱讀程式",zu:"Isifundi Sokuzizwisa"};function l(e){var t=document.createElement("img"),i=(t.src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/immersive-reader-icon.svg",e.getAttribute("data-icon-px-size")||"20"),i=(t.style.height=t.style.width=i+"px",t.style.verticalAlign="middle",t.style.marginTop="-2px",e.getAttribute("data-locale")||"en");t.alt=d(i),e.appendChild(t)}function c(e){var t=document.createElement("span"),i=e.getAttribute("data-locale")||"en";t.textContent=d(i),e.appendChild(t)}function d(e){return e=e.toLowerCase(),n[e]||("zh-hk"===e||"zh-mo"===e||"zh-tw"===e?n["zh-hant"]:(e=e.substring(0,e.lastIndexOf("-")),n[e]||(e=e.substring(0,e.lastIndexOf("-")),n[e])||n.en))}t.renderButtons=function(e){for(var t,i,n=document.createElement("style"),n=(n.innerHTML=".immersive-reader-button{cursor:pointer;display:inline-block;padding:5px;} .immersive-reader-button:hover{background:rgba(0,0,0,.05);border-radius:2px",document.head.appendChild(n),[].slice.call(document.getElementsByClassName("immersive-reader-button"))),r=0,o=n=e&&e.elements?e.elements:n;r<o.length;r++){var a=o[r],s=(a.setAttribute("role","button"),a.getAttribute("data-locale")||"en");switch(a.setAttribute("aria-label",d(s)),a.getAttribute("data-button-style")||"icon"){case"icon":l(a);break;case"text":c(a);break;case"iconAndText":l(a),t=a,i=void 0,(i=document.createElement("span")).style.marginLeft="8px",t.appendChild(i),c(a)}}}},function(e,t,i){"use strict";var g=this&&this.__assign||function(){return(g=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=(Object.defineProperty(t,"__esModule",{value:!0}),t.isValidSubdomain=t.close=t.launchAsync=void 0,i(0)),v=i(4),y={},w=(y[v.ErrorCode.TokenExpired]="The access token supplied is expired.",y[v.ErrorCode.Throttled]="You have exceeded your quota.",y[v.ErrorCode.ServerError]="An error occurred when calling the server to process the text.",!(y[v.ErrorCode.InvalidSubdomain]="The subdomain supplied is invalid."));function k(e){return!!e&&new RegExp("^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])$").test(e)}t.launchAsync=function(p,h,f,m){return w?Promise.reject("Immersive Reader is already launching"):new Promise(function(r,o){var a,e,s,l,t,c,i,d,n,u;p?f?f.chunks?f.chunks.length?k(h)||m&&m.customDomain?(w=!0,a=Date.now(),(m=g({uiZIndex:1e3,timeout:15e3,useWebview:!1,allowFullscreen:!0,hideExitButton:!1,cookiePolicy:b.CookiePolicy.Disable},m)).uiZIndex&&"number"==typeof m.uiZIndex||(m.uiZIndex=1e3),e=null,s=document.createElement("div"),(l=m.useWebview?document.createElement("webview"):document.createElement("iframe")).allow="autoplay",(t=document.createElement("style")).innerHTML="body{height:100%;overflow:hidden;}",c=function(){e&&(window.clearTimeout(e),e=null)},d=function(){if(i(),m.onExit)try{m.onExit()}catch(e){}},(i=function(){document.body.contains(s)&&document.body.removeChild(s),window.removeEventListener("message",n),c(),t.parentNode&&t.parentNode.removeChild(t)})(),n=function(e){if(e&&e.data&&"string"==typeof e.data)if("ImmersiveReader-ReadyForContent"===e.data){c();var t={cogSvcsAccessToken:p,cogSvcsSubdomain:h,request:f,launchToPostMessageSentDurationInMs:Date.now()-a,disableFirstRun:m.disableFirstRun,readAloudOptions:m.readAloudOptions,translationOptions:m.translationOptions,displayOptions:m.displayOptions,sendPreferences:!!m.onPreferencesChanged,preferences:m.preferences};l.contentWindow.postMessage(JSON.stringify({messageType:"Content",messageValue:t}),"*")}else if("ImmersiveReader-Exit"===e.data)d();else if(e.data.startsWith("ImmersiveReader-LaunchResponse:")){var t=null,i=null,n=null;try{n=JSON.parse(e.data.substring("ImmersiveReader-LaunchResponse:".length))}catch(e){}n&&n.success?t={container:s,sessionId:n.sessionId,charactersProcessed:n.meteredContentSize}:i=n&&!n.success?{code:n.errorCode,message:y[n.errorCode],sessionId:n.sessionId}:{code:v.ErrorCode.ServerError,message:y[v.ErrorCode.ServerError]},w=!1,t?(c(),r(t)):i&&(d(),o(i))}else if(e.data.startsWith("ImmersiveReader-Preferences:")&&m.onPreferencesChanged&&"function"==typeof m.onPreferencesChanged)try{m.onPreferencesChanged(e.data.substring("ImmersiveReader-Preferences:".length))}catch(e){}},window.addEventListener("message",n),e=window.setTimeout(function(){i(),w=!1,o({code:v.ErrorCode.Timeout,message:"Page failed to load after timeout ("+m.timeout+" ms)"})},m.timeout),m.allowFullscreen&&l.setAttribute("allowfullscreen",""),l.style.cssText="position: static; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0",m.useWebview&&l.addEventListener("loadstop",function(){l.contentWindow.postMessage(JSON.stringify({messageType:"WebviewHost"}),"*")}),u=(m.customDomain||"https://"+h+".cognitiveservices.azure.com/immersivereader/webapp/v1.0/")+"reader?exitCallback=ImmersiveReader-Exit&sdkPlatform=js&sdkVersion=1.1.0",u+="&cookiePolicy="+(m.cookiePolicy===b.CookiePolicy.Enable?"enable":"disable"),m.hideExitButton&&(u+="&hideExitButton=true"),m.uiLang&&(u+="&omkt="+m.uiLang),l.src=u,s.style.cssText="position: fixed; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0; -webkit-perspective: 1px; z-index: "+m.uiZIndex+"; background: white; overflow: hidden",s.appendChild(l),document.body.appendChild(s),document.head.appendChild(t)):o({code:v.ErrorCode.InvalidSubdomain,message:y[v.ErrorCode.InvalidSubdomain]}):o({code:v.ErrorCode.BadArgument,message:"Chunks must not be empty"}):o({code:v.ErrorCode.BadArgument,message:"Chunks must not be null"}):o({code:v.ErrorCode.BadArgument,message:"Content must not be null"}):o({code:v.ErrorCode.BadArgument,message:"Token must not be null"})})},t.close=function(){window.postMessage("ImmersiveReader-Exit","*")},t.isValidSubdomain=k},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,(t=t.ErrorCode||(t.ErrorCode={})).BadArgument="BadArgument",t.Timeout="Timeout",t.TokenExpired="TokenExpired",t.Throttled="Throttled",t.ServerError="ServerError",t.InvalidSubdomain="InvalidSubdomain"}],n={},r.m=i,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1);function r(e){var t;return(n[e]||(t=n[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}var i,n};"object"==typeof i&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof i?i.ImmersiveReader=r():n.ImmersiveReader=r()},{}],146:[function(e,t,i){"use strict";t.exports=function(n){return function(){var e=arguments.length;if(e){for(var t=[],i=-1;++i<e;)t[i]=arguments[i];return n.call(this,t)}return n.call(this,[])}}},{}],147:[function(x,E,e){!function(k){!function(){"use strict";var e=x("object-assign");function o(e,t){if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0}function a(e){return k.Buffer&&"function"==typeof k.Buffer.isBuffer?k.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var d=x("util/"),n=Object.prototype.hasOwnProperty,u=Array.prototype.slice,t="foo"===function(){}.name;function s(e){return Object.prototype.toString.call(e)}function l(e){return!a(e)&&"function"==typeof k.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&(e instanceof DataView||e.buffer&&e.buffer instanceof ArrayBuffer))}var c=E.exports=m,i=/\s*function\s+([^\(\s]*)\s*/;function r(e){if(d.isFunction(e))return t?e.name:(e=e.toString().match(i))&&e[1]}function p(e,t){return"string"!=typeof e||e.length<t?e:e.slice(0,t)}function h(e){return t||!d.isFunction(e)?d.inspect(e):"[Function"+((e=r(e))?": "+e:"")+"]"}function f(e,t,i,n,r){throw new c.AssertionError({message:i,actual:e,expected:t,operator:n,stackStartFunction:r})}function m(e,t){e||f(e,!0,t,"==",c.ok)}function g(e,t,i,n){var r;return e===t||(a(e)&&a(t)?0===o(e,t):d.isDate(e)&&d.isDate(t)?e.getTime()===t.getTime():d.isRegExp(e)&&d.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:null!==e&&"object"==typeof e||null!==t&&"object"==typeof t?l(e)&&l(t)&&s(e)===s(t)&&!(e instanceof Float32Array||e instanceof Float64Array)?0===o(new Uint8Array(e.buffer),new Uint8Array(t.buffer)):a(e)===a(t)&&(-1!==(r=(n=n||{actual:[],expected:[]}).actual.indexOf(e))&&r===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,i,n){if(null==e||null==t)return!1;if(d.isPrimitive(e)||d.isPrimitive(t))return e===t;if(i&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=b(e),o=b(t);if(r&&!o||!r&&o)return!1;if(r)return g(e=u.call(e),t=u.call(t),i);var a,s,l=w(e),c=w(t);if(l.length!==c.length)return!1;for(l.sort(),c.sort(),s=l.length-1;0<=s;s--)if(l[s]!==c[s])return!1;for(s=l.length-1;0<=s;s--)if(!g(e[a=l[s]],t[a],i,n))return!1;return!0}(e,t,i,n))):i?e===t:e==t)}function b(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function v(e,t){if(e&&t){if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return 1}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}}function y(e,t,i,n){if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),t=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),e&&!t&&f(t,i,"Missing expected exception"+n);var r="string"==typeof n,o=!e&&t&&!i;if((!e&&d.isError(t)&&r&&v(t,i)||o)&&f(t,i,"Got unwanted exception"+n),e&&t&&i&&!v(t,i)||!e&&t)throw t}c.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(h((i=this).actual),128)+" "+i.operator+" "+p(h(i.expected),128),this.generatedMessage=!0);var t,i=e.stackStartFunction||f;Error.captureStackTrace?Error.captureStackTrace(this,i):(e=new Error).stack&&(e=e.stack,t=r(i),0<=(t=e.indexOf("\n"+t))&&(t=e.indexOf("\n",t+1),e=e.substring(t+1)),this.stack=e)},d.inherits(c.AssertionError,Error),c.fail=f,c.ok=m,c.equal=function(e,t,i){e!=t&&f(e,t,i,"==",c.equal)},c.notEqual=function(e,t,i){e==t&&f(e,t,i,"!=",c.notEqual)},c.deepEqual=function(e,t,i){g(e,t,!1)||f(e,t,i,"deepEqual",c.deepEqual)},c.deepStrictEqual=function(e,t,i){g(e,t,!0)||f(e,t,i,"deepStrictEqual",c.deepStrictEqual)},c.notDeepEqual=function(e,t,i){g(e,t,!1)&&f(e,t,i,"notDeepEqual",c.notDeepEqual)},c.notDeepStrictEqual=function e(t,i,n){g(t,i,!0)&&f(t,i,n,"notDeepStrictEqual",e)},c.strictEqual=function(e,t,i){e!==t&&f(e,t,i,"===",c.strictEqual)},c.notStrictEqual=function(e,t,i){e===t&&f(e,t,i,"!==",c.notStrictEqual)},c.throws=function(e,t,i){y(!0,e,t,i)},c.doesNotThrow=function(e,t,i){y(!1,e,t,i)},c.ifError=function(e){if(e)throw e},c.strict=e(function e(t,i){t||f(t,!0,i,"==",e)},c,{equal:c.strictEqual,deepEqual:c.deepStrictEqual,notEqual:c.notStrictEqual,notDeepEqual:c.notDeepStrictEqual}),c.strict.strict=c.strict;var w=Object.keys||function(e){var t,i=[];for(t in e)n.call(e,t)&&i.push(t);return i}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":245,"util/":150}],148:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],149:[function(e,t,i){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],150:[function(p,e,T){!function(d,u){!function(){var s=/%[sdj%]/g;T.format=function(e){if(!w(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(l(arguments[i]));return t.join(" ")}for(var i=1,n=arguments,r=n.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(r<=i)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}}),a=n[i];i<r;a=n[++i])v(a)||!c(a)?o+=" "+a:o+=" "+l(a);return o},T.deprecate=function(e,t){var i;return k(u.process)?function(){return T.deprecate(e,t).apply(this,arguments)}:!0===d.noDeprecation?e:(i=!1,function(){if(!i){if(d.throwDeprecation)throw new Error(t);d.traceDeprecation?console.trace(t):console.error(t),i=!0}return e.apply(this,arguments)})};var e,n={};function l(e,t){var i={seen:[],stylize:o};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),b(t)?i.showHidden=t:t&&T._extend(i,t),k(i.showHidden)&&(i.showHidden=!1),k(i.depth)&&(i.depth=2),k(i.colors)&&(i.colors=!1),k(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=r),h(i,e,i.depth)}function r(e,t){t=l.styles[t];return t?"["+l.colors[t][0]+"m"+e+"["+l.colors[t][1]+"m":e}function o(e,t){return e}function h(t,i,n){if(t.customInspect&&i&&_(i.inspect)&&i.inspect!==T.inspect&&(!i.constructor||i.constructor.prototype!==i))return w(e=i.inspect(n,t))?e:h(t,e,n);e=t;var e,r=k(a=i)?e.stylize("undefined","undefined"):w(a)?(r="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(r,"string")):y(a)?e.stylize(""+a,"number"):b(a)?e.stylize(""+a,"boolean"):v(a)?e.stylize("null","null"):void 0;if(r)return r;var o,a=Object.keys(i),s=(o={},a.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(a=Object.getOwnPropertyNames(i)),C(i)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return f(i);if(0===a.length){if(_(i))return d=i.name?": "+i.name:"",t.stylize("[Function"+d+"]","special");if(x(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(E(i))return t.stylize(Date.prototype.toString.call(i),"date");if(C(i))return f(i)}var l,c,d="",u=!1,p=["{","}"];return g(i)&&(u=!0,p=["[","]"]),_(i)&&(d=" [Function"+(i.name?": "+i.name:"")+"]"),x(i)&&(d=" "+RegExp.prototype.toString.call(i)),E(i)&&(d=" "+Date.prototype.toUTCString.call(i)),C(i)&&(d=" "+f(i)),0!==a.length||u&&0!=i.length?n<0?x(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),a=u?function(t,i,n,r,e){for(var o=[],a=0,s=i.length;a<s;++a)S(i,String(a))?o.push(m(t,i,n,r,String(a),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(m(t,i,n,r,e,!0))}),o}(t,i,n,s,a):a.map(function(e){return m(t,i,n,s,e,u)}),t.seen.pop(),l=d,c=p,60<(a=a).reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===l?"":l+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+l+" "+a.join(", ")+" "+c[1]):p[0]+d+p[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,i,n,r,o){var a,s;if((t=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(s=e.stylize("[Setter]","special")),S(n,r)||(a="["+r+"]"),s||(e.seen.indexOf(t.value)<0?-1<(s=v(i)?h(e,t.value,null):h(e,t.value,i-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),k(a)){if(o&&r.match(/^\d+$/))return s;a=(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function g(e){return Array.isArray(e)}function b(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function w(e){return"string"==typeof e}function k(e){return void 0===e}function x(e){return c(e)&&"[object RegExp]"===t(e)}function c(e){return"object"==typeof e&&null!==e}function E(e){return c(e)&&"[object Date]"===t(e)}function C(e){return c(e)&&("[object Error]"===t(e)||e instanceof Error)}function _(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function i(e){return e<10?"0"+e.toString(10):e.toString(10)}T.debuglog=function(t){var i;return k(e)&&(e=d.env.NODE_DEBUG||""),t=t.toUpperCase(),n[t]||(new RegExp("\\b"+t+"\\b","i").test(e)?(i=d.pid,n[t]=function(){var e=T.format.apply(T,arguments);console.error("%s %d: %s",t,i,e)}):n[t]=function(){}),n[t]},(T.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},T.isArray=g,T.isBoolean=b,T.isNull=v,T.isNullOrUndefined=function(e){return null==e},T.isNumber=y,T.isString=w,T.isSymbol=function(e){return"symbol"==typeof e},T.isUndefined=k,T.isRegExp=x,T.isObject=c,T.isDate=E,T.isError=C,T.isFunction=_,T.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},T.isBuffer=p("./support/isBuffer");var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}T.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[i(e.getHours()),i(e.getMinutes()),i(e.getSeconds())].join(":"),[e.getDate(),a[e.getMonth()],t].join(" ")),T.format.apply(T,arguments))},T.inherits=p("inherits"),T._extend=function(e,t){if(t&&c(t))for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}.call(this)}.call(this,p("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":149,_process:270,inherits:148}],151:[function(e,t,i){"use strict";i.byteLength=function(e){var e=d(e),t=e[0],e=e[1];return 3*(t+e)/4-e},i.toByteArray=function(e){for(var t,i=d(e),n=i[0],i=i[1],r=new c(3*(n+i)/4-i),o=0,a=0<i?n-4:n,s=0;s<a;s+=4)t=l[e.charCodeAt(s)]<<18|l[e.charCodeAt(s+1)]<<12|l[e.charCodeAt(s+2)]<<6|l[e.charCodeAt(s+3)],r[o++]=t>>16&255,r[o++]=t>>8&255,r[o++]=255&t;return 2===i&&(t=l[e.charCodeAt(s)]<<2|l[e.charCodeAt(s+1)]>>4,r[o++]=255&t),1===i&&(t=l[e.charCodeAt(s)]<<10|l[e.charCodeAt(s+1)]<<4|l[e.charCodeAt(s+2)]>>2,r[o++]=t>>8&255,r[o++]=255&t),r},i.fromByteArray=function(e){for(var t,i=e.length,n=i%3,r=[],o=0,a=i-n;o<a;o+=16383)r.push(function(e,t,i){for(var n,r=[],o=t;o<i;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(n));return r.join("")}(e,o,a<o+16383?a:o+16383));return 1==n?(t=e[i-1],r.push(s[t>>2]+s[t<<4&63]+"==")):2==n&&(t=(e[i-2]<<8)+e[i-1],r.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),r.join("")};for(var s=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,o=n.length;r<o;++r)s[r]=n[r],l[n.charCodeAt(r)]=r;function d(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],152:[function(e,t,i){},{}],153:[function(O,e,P){!function(e){!function(){"use strict";var C=O("base64-js"),o=O("ieee754"),e="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null,t=(P.Buffer=u,P.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},P.INSPECT_MAX_BYTES=50,2147483647);function c(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return Object.setPrototypeOf(e,u.prototype),e}function u(e,t,i){if("number"!=typeof e)return n(e,t,i);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return a(e)}function n(e,t,i){if("string"==typeof e){var n=e,r=t;if(u.isEncoding(r="string"==typeof r&&""!==r?r:"utf8"))return(n=(a=c(o=0|f(n,r))).write(n,r))!==o?a.slice(0,n):a;throw new TypeError("Unknown encoding: "+r)}if(ArrayBuffer.isView(e))return A(o=e,Uint8Array)?p((n=new Uint8Array(o)).buffer,n.byteOffset,n.byteLength):d(o);var o;if(null!=e){if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer))return p(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return p(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return u.from(a,t,i);var s,l=u.isBuffer(r=e)?(0!==(s=c(l=0|h(r.length))).length&&r.copy(s,0,0,l),s):void 0!==r.length?"number"!=typeof r.length||N(r.length)?c(0):d(r):"Buffer"===r.type&&Array.isArray(r.data)?d(r.data):void 0;if(l)return l;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,i)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function r(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function a(e){return r(e),c(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),i=c(t),n=0;n<t;n+=1)i[n]=255&e[n];return i}function p(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');e=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i);return Object.setPrototypeOf(e,u.prototype),e}function h(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function f(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return E(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return S(e).length;default:if(r)return n?-1:E(e).length;t=(""+t).toLowerCase(),r=!0}}function i(e,t,i){var n,r=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var o=this,a=t,s=i,l=o.length;(!s||s<0||l<s)&&(s=l);for(var c="",d=a=!a||a<0?0:a;d<s;++d)c+=I[o[d]];return c;case"utf8":case"utf-8":return _(this,t,i);case"ascii":var u=this,l=t,p=i,h="";p=Math.min(u.length,p);for(var f=l;f<p;++f)h+=String.fromCharCode(127&u[f]);return h;case"latin1":case"binary":var m=this,a=t,g=i,b="";g=Math.min(m.length,g);for(var v=a;v<g;++v)b+=String.fromCharCode(m[v]);return b;case"base64":return y=this,n=i,0===(w=t)&&n===y.length?C.fromByteArray(y):C.fromByteArray(y.slice(w,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var y=t,w=i,k=this.slice(y,w),x="",E=0;E<k.length-1;E+=2)x+=String.fromCharCode(k[E]+256*k[E+1]);return x;default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function s(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function l(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),(i=(i=N(i=+i)?r?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:m(e,t,i,n,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(r?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):m(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function m(e,t,i,n,r){var o=1,a=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=o=2,s/=2,i/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r)for(var c=-1,d=i;d<a;d++)if(l(e,d)===l(t,-1===c?0:d-c)){if(d-(c=-1===c?d:c)+1===s)return c*o}else-1!==c&&(d-=d-c),c=-1;else for(d=i=a<i+s?a-s:i;0<=d;d--){for(var u=!0,p=0;p<s;p++)if(l(e,d+p)!==l(t,p)){u=!1;break}if(u)return d}return-1}function _(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var o,a,s,l,c=e[r],d=null,u=239<c?4:223<c?3:191<c?2:1;if(r+u<=i)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(o=e[r+1]))&&127<(l=(31&c)<<6|63&o)&&(d=l);break;case 3:o=e[r+1],a=e[r+2],128==(192&o)&&128==(192&a)&&2047<(l=(15&c)<<12|(63&o)<<6|63&a)&&(l<55296||57343<l)&&(d=l);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)&&l<1114112&&(d=l)}null===d?(d=65533,u=1):65535<d&&(n.push((d-=65536)>>>10&1023|55296),d=56320|1023&d),n.push(d),r+=u}var p=n,h=p.length;if(h<=g)return String.fromCharCode.apply(String,p);for(var f="",m=0;m<h;)f+=String.fromCharCode.apply(String,p.slice(m,m+=g));return f}P.kMaxLength=t,(u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=n,Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,i){return t=t,i=i,r(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?c(e).fill(t,i):c(e).fill(t):c(e)},u.allocUnsafe=a,u.allocUnsafeSlow=a,u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(A(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;for(var i=u.allocUnsafe(t),n=0,r=0;r<e.length;++r){var o=e[r];if(A(o,Uint8Array))n+o.length>i.length?u.from(o).copy(i,n):Uint8Array.prototype.set.call(i,o,n);else{if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n)}n+=o.length}return i},u.byteLength=f,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)s(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)s(this,t,t+3),s(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)s(this,t,t+7),s(this,t+1,t+6),s(this,t+2,t+5),s(this,t+3,t+4);return this},u.prototype.toLocaleString=u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):i.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",t=P.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},e&&(u.prototype[e]=u.prototype.inspect),u.prototype.compare=function(e,t,i,n,r){if(A(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),(t=void 0===t?0:t)<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(r<=n&&i<=t)return 0;if(r<=n)return-1;if(i<=t)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(n>>>=0),a=(i>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(n,r),c=e.slice(t,i),d=0;d<s;++d)if(l[d]!==c[d]){o=l[d],a=c[d];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},u.prototype.indexOf=function(e,t,i){return l(this,e,t,i,!0)},u.prototype.lastIndexOf=function(e,t,i){return l(this,e,t,i,!1)},u.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||r<i)&&(i=r),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,a,s,l,c,d,u=!1;;)switch(n){case"hex":var p=this,h=e,f=t,m=i,g=(f=Number(f)||0,p.length-f);(!m||(m=Number(m))>g)&&(m=g),(g=h.length)/2<m&&(m=g/2);for(var b=0;b<m;++b){var v=parseInt(h.substr(2*b,2),16);if(N(v))return b;p[f+b]=v}return b;case"utf8":case"utf-8":return g=t,d=i,T(E(e,(c=this).length-g),c,g,d);case"ascii":case"latin1":case"binary":return c=this,d=t,l=i,T(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(e),c,d,l);case"base64":return l=this,a=t,s=i,T(S(e),l,a,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=i,T(function(e,t){for(var i,n,r=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(i=e.charCodeAt(o))>>8,r.push(i%256),r.push(n);return r}(e,(o=this).length-a),o,a,s);default:if(u)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),u=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var g=4096;function b(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function v(e,t,i,n,r,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r<t||t<o)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function y(e,t,i,n){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function w(e,t,i,n,r){return t=+t,i>>>=0,r||y(e,0,i,4),o.write(e,t,i,n,23,4),i+4}function k(e,t,i,n,r){return t=+t,i>>>=0,r||y(e,0,i,8),o.write(e,t,i,n,52,8),i+8}u.prototype.slice=function(e,t){var i=this.length,i=((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),this.subarray(e,t));return Object.setPrototypeOf(i,u.prototype),i},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||b(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||b(e,t,this.length);for(var n=this[e+--t],r=1;0<t&&(r*=256);)n+=this[e+--t]*r;return n},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||b(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||b(e,t,this.length);for(var n=t,r=1,o=this[e+--n];0<n&&(r*=256);)o+=this[e+--n]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),o.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),o.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),o.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),o.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||v(this,e,t,i,Math.pow(2,8*i)-1,0);var r=1,o=0;for(this[t]=255&e;++o<i&&(r*=256);)this[t+o]=e/r&255;return t+i},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||v(this,e,t,i,Math.pow(2,8*i)-1,0);var r=i-1,o=1;for(this[t+r]=255&e;0<=--r&&(o*=256);)this[t+r]=e/o&255;return t+i},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,i,n){e=+e,t>>>=0,n||v(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var r=0,o=1,a=0;for(this[t]=255&e;++r<i&&(o*=256);)e<0&&0===a&&0!==this[t+r-1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+i},u.prototype.writeIntBE=function(e,t,i,n){e=+e,t>>>=0,n||v(this,e,t,i,(n=Math.pow(2,8*i-1))-1,-n);var r=i-1,o=1,a=0;for(this[t+r]=255&e;0<=--r&&(o*=256);)e<0&&0===a&&0!==this[t+r+1]&&(a=1),this[t+r]=(e/o>>0)-a&255;return t+i},u.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||v(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,i){return w(this,e,t,!0,i)},u.prototype.writeFloatBE=function(e,t,i){return w(this,e,t,!1,i)},u.prototype.writeDoubleLE=function(e,t,i){return k(this,e,t,!0,i)},u.prototype.writeDoubleBE=function(e,t,i){return k(this,e,t,!1,i)},u.prototype.copy=function(e,t,i,n){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i=i||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<i?i:n)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var r=(n=e.length-t<n-i?e.length-t+i:n)-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),r},u.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var r;1===e.length&&(r=e.charCodeAt(0),"utf8"===n&&r<128||"latin1"===n)&&(e=r)}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");var o;if(!(i<=t))if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(o=t;o<i;++o)this[o]=e;else{var a=u.isBuffer(e)?e:u.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=a[o%s]}return this};var x=/[^+/0-9A-Za-z-_]/g;function E(e,t){var i;t=t||1/0;for(var n=e.length,r=null,o=[],a=0;a<n;++a){if(55295<(i=e.charCodeAt(a))&&i<57344){if(!r){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&o.push(239,191,189);continue}r=i;continue}if(i<56320){-1<(t-=3)&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&-1<(t-=3)&&o.push(239,191,189);if(r=null,i<128){if(--t<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function S(e){return C.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function T(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function N(e){return e!=e}var I=function(){for(var e=new Array(256),t=0;t<16;++t)for(var i=16*t,n=0;n<16;++n)e[i+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}()}.call(this)}.call(this,O("buffer").Buffer)},{"base64-js":151,buffer:153,ieee754:184}],154:[function(e,t,i){!function(){"use strict";var a={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var n,r=typeof i;if("string"==r||"number"==r)e.push(i);else if(Array.isArray(i))i.length&&(n=s.apply(null,i))&&e.push(n);else if("object"==r)if(i.toString===Object.prototype.toString||i.toString.toString().includes("[native code]"))for(var o in i)a.call(i,o)&&i[o]&&e.push(o);else e.push(i.toString())}}return e.join(" ")}void 0!==t&&t.exports?t.exports=s.default=s:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return s}):window.classNames=s}()},{}],155:[function(e,t,i){function n(e){return Object.prototype.toString.call(e)}i.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},i.isBoolean=function(e){return"boolean"==typeof e},i.isNull=function(e){return null===e},i.isNullOrUndefined=function(e){return null==e},i.isNumber=function(e){return"number"==typeof e},i.isString=function(e){return"string"==typeof e},i.isSymbol=function(e){return"symbol"==typeof e},i.isUndefined=function(e){return void 0===e},i.isRegExp=function(e){return"[object RegExp]"===n(e)},i.isObject=function(e){return"object"==typeof e&&null!==e},i.isDate=function(e){return"[object Date]"===n(e)},i.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},i.isFunction=function(e){return"function"==typeof e},i.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},i.isBuffer=e("buffer").Buffer.isBuffer},{buffer:153}],156:[function(e,t,i){var n=function(){var c,i,e,t,n,d,r,o,a,s,l,u;function p(){}return c=Math,i=Object.create||function(e){return p.prototype=e,e=new p,p.prototype=null,e},t=(e={}).lib={},n=t.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<r;o++){var a=i[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(o=0;o<r;o+=4)t[n+o>>>2]=i[o>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=c.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4){var n=function(e){var t=987654321,i=4294967295;return function(){return((((t=36969*(65535&t)+(t>>16)&i)<<16)+(e=18e3*(65535&e)+(e>>16)&i)&i)/4294967296+.5)*(.5<c.random()?1:-1)}}(4294967296*(r||c.random())),r=987654071*n();t.push(4294967296*n()|0)}return new d.init(t,e)}}),r=e.enc={},o=r.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new d.init(i,t/2)}},a=r.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new d.init(i,t)}},s=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=s.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,i=t.words,n=t.sigBytes,r=this.blockSize,o=n/(4*r),a=(e?c.ceil(o):c.max((0|o)-this._minBufferSize,0))*r,e=c.min(4*a,n);if(a){for(var s=0;s<a;s+=r)this._doProcessBlock(i,s);var l=i.splice(0,a);t.sigBytes-=e}return new d.init(l,e)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),t.Hasher=l.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(e,t){return new i.init(t).finalize(e)}},_createHmacHelper:function(i){return function(e,t){return new u.HMAC.init(i,t).finalize(e)}}}),u=e.algo={},e};"object"==typeof i?t.exports=i=n():"function"==typeof define&&define.amd?define([],n):this.CryptoJS=n()},{}],157:[function(e,t,i){var n=function(e){var t,i=(t=e).lib,n=i.WordArray,r=i.Hasher,i=t.algo,d=[],i=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=0;l<80;l++){l<16?d[l]=0|e[t+l]:(c=d[l-3]^d[l-8]^d[l-14]^d[l-16],d[l]=c<<1|c>>>31);var c=(n<<5|n>>>27)+s+d[l];c+=l<20?1518500249+(r&o|~r&a):l<40?1859775393+(r^o^a):l<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,s=a,a=o,o=r<<30|r>>>2,r=n,n=c}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+o|0,i[3]=i[3]+a|0,i[4]=i[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=Math.floor(i/4294967296),t[15+(64+n>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});return t.SHA1=r._createHelper(i),t.HmacSHA1=r._createHmacHelper(i),e.SHA1};"object"==typeof i?t.exports=i=n(e("./core")):"function"==typeof define&&define.amd?define(["./core"],n):n(this.CryptoJS)},{"./core":156}],158:[function(e,t,i){t.exports={elementNames:{altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},attributeNames:{definitionurl:"definitionURL",attributename:"attributeName",attributetype:"attributeType",basefrequency:"baseFrequency",baseprofile:"baseProfile",calcmode:"calcMode",clippathunits:"clipPathUnits",diffuseconstant:"diffuseConstant",edgemode:"edgeMode",filterunits:"filterUnits",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",limitingconeangle:"limitingConeAngle",markerheight:"markerHeight",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textlength:"textLength",viewbox:"viewBox",viewtarget:"viewTarget",xchannelselector:"xChannelSelector",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan"}}},{}],159:[function(e,t,i){var c=e("domelementtype"),d=e("entities"),u=e("./foreignNames.json"),p=(u.elementNames.__proto__=null,{__proto__:u.attributeNames.__proto__=null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0}),h={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},f=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var i,n,r,o,a="",s=0;s<e.length;s++){var l=e[s];"root"===l.type?a+=f(l.children,t):c.isTag(l)?a+=(i=l,o=r=void 0,!(n="foreign"===(n=t).xmlMode&&(i.name=u.elementNames[i.name]||i.name,i.parent)&&0<=m.indexOf(i.parent.name)?Object.assign({},n,{xmlMode:!1}):n).xmlMode&&0<=["svg","math"].indexOf(i.name)&&(n=Object.assign({},n,{xmlMode:"foreign"})),r="<"+i.name,(o=function(e,t){if(e){var i,n,r="";for(n in e)i=e[n],r&&(r+=" "),"foreign"===t.xmlMode&&(n=u.attributeNames[n]||n),r+=n,(null!==i&&""!==i||t.xmlMode)&&(r+='="'+(t.decodeEntities?d.encodeXML(i):i.replace(/\"/g,"&quot;"))+'"');return r}}(i.attribs,n))&&(r+=" "+o),!n.xmlMode||i.children&&0!==i.children.length?(r+=">",i.children&&(r+=f(i.children,n)),h[i.name]&&!n.xmlMode||(r+="</"+i.name+">")):r+="/>",r):l.type===c.Directive?a+="<"+l.data+">":l.type===c.Comment?a+="\x3c!--"+l.data+"--\x3e":l.type===c.CDATA?a+="<![CDATA["+l.children[0].data+"]]>":a+=(o=t,n=void 0,n=(i=l).data||"",n=!o.decodeEntities||i.parent&&i.parent.name in p?n:d.encodeXML(n))}return a},m=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]},{"./foreignNames.json":158,domelementtype:160,entities:173}],160:[function(e,t,i){"use strict";var n,r;Object.defineProperty(i,"__esModule",{value:!0}),i.Doctype=i.CDATA=i.Tag=i.Style=i.Script=i.Comment=i.Directive=i.Text=i.Root=i.isTag=i.ElementType=void 0,(r=n=i.ElementType||(i.ElementType={})).Root="root",r.Text="text",r.Directive="directive",r.Comment="comment",r.Script="script",r.Style="style",r.Tag="tag",r.CDATA="cdata",r.Doctype="doctype",i.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},i.Root=n.Root,i.Text=n.Text,i.Directive=n.Directive,i.Comment=n.Comment,i.Script=n.Script,i.Style=n.Style,i.Tag=n.Tag,i.CDATA=n.CDATA,i.Doctype=n.Doctype},{}],161:[function(e,t,i){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],162:[function(e,t,i){var n=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach(function(t){Object.keys(t).forEach(function(e){n[e]=t[e].bind(n)})})},{"./lib/helpers":163,"./lib/legacy":164,"./lib/manipulation":165,"./lib/querying":166,"./lib/stringify":167,"./lib/traversal":168}],163:[function(e,t,i){i.removeSubsets=function(e){for(var t,i,n,r=e.length;-1<--r;){for(t=i=e[r],n=!(e[r]=null);i;){if(-1<e.indexOf(i)){n=!1,e.splice(r,1);break}i=i.parent}n&&(e[r]=t)}return e};var n=i.compareDocumentPosition=function(e,t){var i,n,r,o,a,s=[],l=[];if(e===t)return 0;for(i=e;i;)s.unshift(i),i=i.parent;for(i=t;i;)l.unshift(i),i=i.parent;for(a=0;s[a]===l[a];)a++;return 0===a?1:(r=(n=s[a-1]).children,o=l[a],r.indexOf(s[a])>r.indexOf(o)?n===t?20:4:n===e?10:2)};i.uniqueSort=function(e){var t,i=e.length;for(e=e.slice();-1<--i;)t=e[i],-1<(t=e.indexOf(t))&&t<i&&e.splice(i,1);return e.sort(function(e,t){e=n(e,t);return 2&e?-1:4&e?1:0}),e}},{}],164:[function(e,t,i){var e=e("domelementtype"),n=i.isTag=e.isTag,o=(i.testElement=function(e,t){for(var i in e)if(e.hasOwnProperty(i))if("tag_name"===i){if(!n(t)||!e.tag_name(t.name))return!1}else if("tag_type"===i){if(!e.tag_type(t.type))return!1}else if("tag_contains"===i){if(n(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[i](t.attribs[i]))return!1;return!0},{tag_name:function(t){return"function"==typeof t?function(e){return n(e)&&t(e.name)}:"*"===t?n:function(e){return n(e)&&e.name===t}},tag_type:function(t){return"function"==typeof t?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return"function"==typeof t?function(e){return!n(e)&&t(e.data)}:function(e){return!n(e)&&e.data===t}}});function a(t,i){return"function"==typeof i?function(e){return e.attribs&&i(e.attribs[t])}:function(e){return e.attribs&&e.attribs[t]===i}}function s(t,i){return function(e){return t(e)||i(e)}}i.getElements=function(i,e,t,n){var r=Object.keys(i).map(function(e){var t=i[e];return e in o?o[e](t):a(e,t)});return 0===r.length?[]:this.filter(r.reduce(s),e,t,n)},i.getElementById=function(e,t,i){return Array.isArray(t)||(t=[t]),this.findOne(a("id",e),t,!1!==i)},i.getElementsByTagName=function(e,t,i,n){return this.filter(o.tag_name(e),t,i,n)},i.getElementsByTagType=function(e,t,i,n){return this.filter(o.tag_type(e),t,i,n)}},{domelementtype:161}],165:[function(e,t,i){i.removeElement=function(e){var t;e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent&&(t=e.parent.children).splice(t.lastIndexOf(e),1)},i.replaceElement=function(e,t){var i=t.prev=e.prev,i=(i&&(i.next=t),t.next=e.next),i=(i&&(i.prev=t),t.parent=e.parent);i&&((i=i.children)[i.lastIndexOf(e)]=t)},i.appendChild=function(e,t){1!==(t.parent=e).children.push(t)&&(((e=e.children[e.children.length-2]).next=t).prev=e,t.next=null)},i.append=function(e,t){var i=e.parent,n=e.next;t.next=n,((t.prev=e).next=t).parent=i,n?(n.prev=t,i&&(e=i.children).splice(e.lastIndexOf(n),0,t)):i&&i.children.push(t)},i.prepend=function(e,t){var i,n=e.parent;n&&(i=n.children).splice(i.lastIndexOf(e),0,t),e.prev&&(e.prev.next=t),t.parent=n,t.prev=e.prev,(t.next=e).prev=t}},{}],166:[function(e,t,i){var a=e("domelementtype").isTag;function l(e,t,i,n){for(var r,o=[],a=0,s=t.length;a<s&&!(e(t[a])&&(o.push(t[a]),--n<=0))&&(r=t[a].children,!(i&&r&&0<r.length&&(r=l(e,r,i,n),o=o.concat(r),(n-=r.length)<=0)));a++);return o}t.exports={filter:function(e,t,i,n){return l(e,t=Array.isArray(t)?t:[t],!1!==i,n="number"==typeof n&&isFinite(n)?n:1/0)},find:l,findOneChild:function(e,t){for(var i=0,n=t.length;i<n;i++)if(e(t[i]))return t[i];return null},findOne:function e(t,i){for(var n=null,r=0,o=i.length;r<o&&!n;r++)a(i[r])&&(t(i[r])?n=i[r]:0<i[r].children.length&&(n=e(t,i[r].children)));return n},existsOne:function e(t,i){for(var n=0,r=i.length;n<r;n++)if(a(i[n])&&(t(i[n])||0<i[n].children.length&&e(t,i[n].children)))return!0;return!1},findAll:function(e,t){for(var i=[],n=t.slice();n.length;){var r=n.shift();a(r)&&(r.children&&0<r.children.length&&n.unshift.apply(n,r.children),e(r))&&i.push(r)}return i}}},{domelementtype:161}],167:[function(e,t,i){var n=e("domelementtype"),r=e("dom-serializer"),o=n.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map(function(e){return r(e,t)}).join(""):""},getOuterHTML:r,getText:function e(t){return Array.isArray(t)?t.map(e).join(""):o(t)?"br"===t.name?"\n":e(t.children):t.type===n.CDATA?e(t.children):t.type===n.Text?t.data:""}}},{"dom-serializer":159,domelementtype:161}],168:[function(e,t,i){var n=i.getChildren=function(e){return e.children},r=i.getParent=function(e){return e.parent};i.getSiblings=function(e){var t=r(e);return t?n(t):[e]},i.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},i.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},i.getName=function(e){return e.name}},{}],169:[function(e,t,i){"use strict";function n(e){if(this._capacity=o(e),this._length=0,this._front=0,r(e)){for(var t=e.length,i=0;i<t;++i)this[i]=e[i];this._length=t}}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),i=this._front,n=this._capacity,r=0;r<e;++r)t[r]=this[i+r&n-1];return t},n.prototype.push=function(e){var t=arguments.length,i=this._length;if(1<t){var n=this._capacity;if(n<i+t){for(var r=0;r<t;++r)this._checkCapacity(i+1),this[o=this._front+i&this._capacity-1]=arguments[r],this._length=++i;return i}for(var o=this._front,r=0;r<t;++r)this[o+i&n-1]=arguments[r],o++;return this._length=i+t,i+t}return 0===t?i:(this._checkCapacity(i+1),this[r=this._front+i&this._capacity-1]=e,this._length=i+1,i+1)},n.prototype.pop=function(){var e,t,i=this._length;if(0!==i)return t=this[e=this._front+i-1&this._capacity-1],this[e]=void 0,this._length=i-1,t},n.prototype.shift=function(){var e,t,i=this._length;if(0!==i)return t=this[e=this._front],this[e]=void 0,this._front=e+1&this._capacity-1,this._length=i-1,t},n.prototype.unshift=function(e){var t=this._length,i=arguments.length;if(1<i){if(t+i>(r=this._capacity)){for(var n=i-1;0<=n;n--){this._checkCapacity(t+1);var r=this._capacity;this[o=(this._front-1&r-1^r)-r]=arguments[n],t++,this._length=t,this._front=o}return t}for(var o,a=this._front,n=i-1;0<=n;n--)this[o=(a-1&r-1^r)-r]=arguments[n],a=o;return this._front=a,this._length=t+i,t+i}return 0===i?t:(this._checkCapacity(t+1),r=this._capacity,this[n=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=n,t+1)},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){if(e===(0|e)){var t=this._length;if(e<0&&(e+=t),!(e<0||t<=e))return this[this._front+e&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,i=this._capacity,n=0;n<e;++n)this[t+n&i-1]=void 0;this._length=0,this._front=0},n.prototype.valueOf=n.prototype.toString=function(){return this.toArray().toString()},n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity,e=(this._capacity=e,this._front),i=this._length;if(t<e+i)for(var n=this,r=this,o=t,a=e+i&t-1,s=0;s<a;++s)r[s+o]=n[s+0],n[s+0]=void 0};var r=Array.isArray;function o(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return e=Math.min(Math.max(16,e),1073741824),e>>>=0,--e,1+((e=(e=(e=(e|=e>>1)|e>>2)|e>>4)|e>>8)|e>>16)}t.exports=n},{}],170:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},s=(Object.defineProperty(i,"__esModule",{value:!0}),i.decodeHTML=i.decodeHTMLStrict=i.decodeXML=void 0,n(e("./maps/entities.json"))),l=n(e("./maps/legacy.json")),r=n(e("./maps/xml.json")),o=n(e("./decode_codepoint")),a=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function c(e){var t=u(e);return function(e){return String(e).replace(a,t)}}i.decodeXML=c(r.default),i.decodeHTMLStrict=c(s.default);function d(e,t){return e<t?1:-1}function u(i){return function(e){var t;return"#"===e.charAt(1)?"X"===(t=e.charAt(2))||"x"===t?o.default(parseInt(e.substr(3),16)):o.default(parseInt(e.substr(2),10)):i[e.slice(1,-1)]||e}}i.decodeHTML=function(){for(var e=Object.keys(l.default).sort(d),t=Object.keys(s.default).sort(d),i=0,n=0;i<t.length;i++)e[n]===t[i]?(t[i]+=";?",n++):t[i]+=";";var r=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),o=u(s.default);function a(e){return";"!==e.substr(-1)&&(e+=";"),o(e)}return function(e){return String(e).replace(r,a)}}()},{"./decode_codepoint":171,"./maps/entities.json":175,"./maps/legacy.json":176,"./maps/xml.json":177}],171:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=(Object.defineProperty(i,"__esModule",{value:!0}),n(e("./maps/decode.json"))),o=String.fromCodePoint||function(e){var t="";return 65535<e&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)};i.default=function(e){return 55296<=e&&e<=57343||1114111<e?"�":(e in r.default&&(e=r.default[e]),o(e))}},{"./maps/decode.json":174}],172:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=(Object.defineProperty(i,"__esModule",{value:!0}),i.escapeUTF8=i.escape=i.encodeNonAsciiHTML=i.encodeHTML=i.encodeXML=void 0,l(n(e("./maps/xml.json")).default)),o=c(r);i.encodeXML=f(r);var a,s,r=l(n(e("./maps/entities.json")).default),n=c(r);function l(i){return Object.keys(i).sort().reduce(function(e,t){return e[i[t]]="&"+t+";",e},{})}function c(e){for(var t=[],i=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];1===o.length?t.push("\\"+o):i.push(o)}t.sort();for(var a=0;a<t.length-1;a++){for(var s=a;s<t.length-1&&t[s].charCodeAt(1)+1===t[s+1].charCodeAt(1);)s+=1;var l=1+s-a;l<3||t.splice(a,l,t[a]+"-"+t[s])}return i.unshift("["+t.join("")+"]"),new RegExp(i.join("|"),"g")}i.encodeHTML=(a=r,s=n,function(e){return e.replace(s,function(e){return a[e]}).replace(d,p)}),i.encodeNonAsciiHTML=f(r);var d=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,u=null!=String.prototype.codePointAt?function(e){return e.codePointAt(0)}:function(e){return 1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536};function p(e){return"&#x"+(1<e.length?u(e):e.charCodeAt(0)).toString(16).toUpperCase()+";"}var h=new RegExp(o.source+"|"+d.source,"g");function f(t){return function(e){return e.replace(h,function(e){return t[e]||p(e)})}}i.escape=function(e){return e.replace(h,p)},i.escapeUTF8=function(e){return e.replace(o,p)}},{"./maps/entities.json":175,"./maps/xml.json":177}],173:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.decodeXMLStrict=i.decodeHTML5Strict=i.decodeHTML4Strict=i.decodeHTML5=i.decodeHTML4=i.decodeHTMLStrict=i.decodeHTML=i.decodeXML=i.encodeHTML5=i.encodeHTML4=i.escapeUTF8=i.escape=i.encodeNonAsciiHTML=i.encodeHTML=i.encodeXML=i.encode=i.decodeStrict=i.decode=void 0;var n=e("./decode"),r=e("./encode"),o=(i.decode=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTML)(e)},i.decodeStrict=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTMLStrict)(e)},i.encode=function(e,t){return(!t||t<=0?r.encodeXML:r.encodeHTML)(e)},e("./encode")),a=(Object.defineProperty(i,"encodeXML",{enumerable:!0,get:function(){return o.encodeXML}}),Object.defineProperty(i,"encodeHTML",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(i,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return o.encodeNonAsciiHTML}}),Object.defineProperty(i,"escape",{enumerable:!0,get:function(){return o.escape}}),Object.defineProperty(i,"escapeUTF8",{enumerable:!0,get:function(){return o.escapeUTF8}}),Object.defineProperty(i,"encodeHTML4",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(i,"encodeHTML5",{enumerable:!0,get:function(){return o.encodeHTML}}),e("./decode"));Object.defineProperty(i,"decodeXML",{enumerable:!0,get:function(){return a.decodeXML}}),Object.defineProperty(i,"decodeHTML",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(i,"decodeHTMLStrict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(i,"decodeHTML4",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(i,"decodeHTML5",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(i,"decodeHTML4Strict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(i,"decodeHTML5Strict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(i,"decodeXMLStrict",{enumerable:!0,get:function(){return a.decodeXML}})},{"./decode":170,"./encode":172}],174:[function(e,t,i){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],175:[function(e,t,i){t.exports={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}},{}],176:[function(e,t,i){t.exports={Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"}},{}],177:[function(e,t,i){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],178:[function(e,t,i){var n=e("prr");function a(e,t,i){t&&"string"!=typeof t&&(t=t.message||t.name),n(this,{type:e,name:e,cause:"string"!=typeof t?t:i,message:t},"ewr")}function s(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),a.call(this,"CustomError",e,t)}s.prototype=new Error,t.exports=function(o){function e(e,t){return i=o,n=e,(r=function(e,t){a.call(this,n,e,t),"FilesystemError"==n&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(i.errno[this.cause.errno]?i.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,r)}).prototype=new(t||s),r;var i,n,r}return{CustomError:s,FilesystemError:e("FilesystemError"),createError:e}}},{prr:274}],179:[function(e,t,i){var n=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},n.forEach(function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e}),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":178}],180:[function(e,t,i){var u=Object.create||function(e){function t(){}return t.prototype=e,new t},a=Object.keys||function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return t},n=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=u(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0;var o,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),o=0===l.x}catch(e){o=!1}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function d(e,t,i,n){var r,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');return(r=e._events)?(r.newListener&&(e.emit("newListener",t,i.listener||i),r=e._events),o=r[t]):(r=e._events=u(null),e._eventsCount=0),o?("function"==typeof o?o=r[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),!o.warned&&(n=c(e))&&0<n&&o.length>n&&(o.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",n.name,n.message)):(o=r[t]=i,++e._eventsCount),e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,i){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},t=n.call(p,e);return t.listener=i,e.wrapFn=t}function f(e,t,i){e=e._events;if(e){e=e[t];if(e)if("function"==typeof e)return i?[e.listener||e]:[e];else if(i){var n=e;for(var r=new Array(n.length),o=0;o<r.length;++o)r[o]=n[o].listener||n[o];return r;return}else return q(e,e.length);else;}return[]}function m(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function q(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}o?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):r.defaultMaxListeners=s,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){var t,i,n,r,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if((t=1<arguments.length?arguments[1]:t)instanceof Error)throw t;s=new Error('Unhandled "error" event. ('+t+")");throw s.context=t,s}if(!(i=a[e]))return!1;var l="function"==typeof i;switch(n=arguments.length){case 1:var c=i,d=l,u=this;if(d)c.call(u);else for(var p=c.length,R=q(c,p),h=0;h<p;++h)R[h].call(u);break;case 2:var d=i,c=l,f=this,m=arguments[1];if(c)d.call(f,m);else for(var g=d.length,M=q(d,g),b=0;b<g;++b)M[b].call(f,m);break;case 3:var v=i,y=l,w=this,k=arguments[1],x=arguments[2];if(y)v.call(w,k,x);else for(var E=v.length,B=q(v,E),C=0;C<E;++C)B[C].call(w,k,x);break;case 4:var y=i,v=l,_=this,S=arguments[1],T=arguments[2],A=arguments[3];if(v)y.call(_,S,T,A);else for(var N=y.length,j=q(y,N),I=0;I<N;++I)j[I].call(_,S,T,A);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];var O=i,F=l,P=this,D=r;if(F)O.apply(P,D);else for(var U=O.length,H=q(O,U),L=0;L<U;++L)H[L].apply(P,D)}return!0},r.prototype.on=r.prototype.addListener=function(e,t){return d(this,e,t,!1)},r.prototype.prependListener=function(e,t){return d(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},r.prototype.removeListener=function(e,t){var i,n,r,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((n=this._events)&&(i=n[e]))if(i===t||i.listener===t)0==--this._eventsCount?this._events=u(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;0<=o;o--)if(i[o]===t||i[o].listener===t){a=i[o].listener,r=o;break}if(r<0)return this;if(0===r)i.shift();else{var s=i;for(var l=r,c=l+1,d=s.length;c<d;l+=1,c+=1)s[l]=s[c];s.pop()}1===i.length&&(n[e]=i[0]),n.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.removeAllListeners=function(e){var t,i;if(i=this._events)if(i.removeListener){if(0===arguments.length){for(var n,r=a(i),o=0;o<r.length;++o)"removeListener"!==(n=r[o])&&this.removeAllListeners(n);this.removeAllListeners("removeListener"),this._events=u(null),this._eventsCount=0}else if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o])}else 0===arguments.length?(this._events=u(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=u(null):delete i[e]);return this},r.prototype.listeners=function(e){return f(this,e,!0)},r.prototype.rawListeners=function(e){return f(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],181:[function(e,i,t){!function(){"use strict";var e=!("undefined"==typeof window||!window.document||!window.document.createElement),t={canUseDOM:e,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:e&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:e&&!!window.screen};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):void 0!==i&&i.exports?i.exports=t:window.ExecutionEnvironment=t}()},{}],182:[function(e,t,i){"use strict";function p(e,t,i,n,r,o){this._color=e,this.key=t,this.value=i,this.left=n,this.right=r,this._count=o}function s(e){return new p(e._color,e.key,e.value,e.left,e.right,e._count)}function h(e,t){return new p(e,t.key,t.value,t.left,t.right,t._count)}function f(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function m(e,t){this._compare=e,this.root=t}t.exports=function(e){return new m(e||n,null)};t=m.prototype;function a(e,t){this.tree=e,this._stack=t}Object.defineProperty(t,"keys",{get:function(){var i=[];return this.forEach(function(e,t){i.push(e)}),i}}),Object.defineProperty(t,"values",{get:function(){var i=[];return this.forEach(function(e,t){i.push(t)}),i}}),Object.defineProperty(t,"length",{get:function(){return this.root?this.root._count:0}}),t.insert=function(e,t){for(var i=this._compare,n=this.root,r=[],o=[];n;){var a=i(e,n.key);r.push(n),o.push(a),n=a<=0?n.left:n.right}r.push(new p(0,e,t,null,null,1));for(var s=r.length-2;0<=s;--s)n=r[s],r[s]=o[s]<=0?new p(n._color,n.key,n.value,r[s+1],n.right,n._count+1):new p(n._color,n.key,n.value,n.left,r[s+1],n._count+1);for(s=r.length-1;1<s;--s){var l=r[s-1],n=r[s];if(1===l._color||1===n._color)break;var c,d,u=r[s-2];if(u.left===l){if(l.left===n){if(!(c=u.right)||0!==c._color){u._color=0,u.left=l.right,l._color=1,l.right=u,r[s-2]=l,r[s-1]=n,f(u),f(l),3<=s&&((d=r[s-3]).left===u?d.left=l:d.right=l);break}}else if(!(c=u.right)||0!==c._color){l.right=n.left,u._color=0,u.left=n.right,n._color=1,n.left=l,n.right=u,r[s-2]=n,r[s-1]=l,f(u),f(l),f(n),3<=s&&((d=r[s-3]).left===u?d.left=n:d.right=n);break}l._color=1,u.right=h(1,c)}else{if(l.right===n){if(!(c=u.left)||0!==c._color){u._color=0,u.right=l.left,l._color=1,l.left=u,r[s-2]=l,r[s-1]=n,f(u),f(l),3<=s&&((d=r[s-3]).right===u?d.right=l:d.left=l);break}}else if(!(c=u.left)||0!==c._color){l.left=n.right,u._color=0,u.right=n.left,n._color=1,n.right=l,n.left=u,r[s-2]=n,r[s-1]=l,f(u),f(l),f(n),3<=s&&((d=r[s-3]).right===u?d.right=n:d.left=n);break}l._color=1,u.left=h(1,c)}u._color=0,--s}return r[0]._color=1,new m(i,r[0])},t.forEach=function(e,t,i){if(this.root)switch(arguments.length){case 1:return function e(t,i){var n;return i.left&&(n=e(t,i.left))?n:(n=t(i.key,i.value))||(i.right?e(t,i.right):void 0)}(e,this.root);case 2:return function e(t,i,n,r){if(i(t,r.key)<=0){var o;if(r.left&&(o=e(t,i,n,r.left)))return o;if(o=n(r.key,r.value))return o}if(r.right)return e(t,i,n,r.right)}(t,this._compare,e,this.root);case 3:return 0<=this._compare(t,i)?void 0:function e(t,i,n,r,o){var a,s=n(t,o.key),l=n(i,o.key);if(s<=0){if(o.left&&(a=e(t,i,n,r,o.left)))return a;if(0<l&&(a=r(o.key,o.value)))return a}if(0<l&&o.right)return e(t,i,n,r,o.right)}(t,i,this._compare,e,this.root)}},Object.defineProperty(t,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new a(this,e)}}),Object.defineProperty(t,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new a(this,e)}}),t.at=function(e){if(!(e<0))for(var t=this.root,i=[];;){if(i.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new a(this,i);if(--e,!t.right)break;if(e>=t.right._count)break;t=t.right}return new a(this,[])},t.ge=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o<=0&&(r=n.length),i=o<=0?i.left:i.right}return n.length=r,new a(this,n)},t.gt=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o<0&&(r=n.length),i=o<0?i.left:i.right}return n.length=r,new a(this,n)},t.lt=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),0<o&&(r=n.length),i=o<=0?i.left:i.right}return n.length=r,new a(this,n)},t.le=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),0<=o&&(r=n.length),i=o<0?i.left:i.right}return n.length=r,new a(this,n)},t.find=function(e){for(var t=this._compare,i=this.root,n=[];i;){var r=t(e,i.key);if(n.push(i),0===r)return new a(this,n);i=r<=0?i.left:i.right}return new a(this,[])},t.remove=function(e){e=this.find(e);return e?e.remove():this},t.get=function(e){for(var t=this._compare,i=this.root;i;){var n=t(e,i.key);if(0===n)return i.value;i=n<=0?i.left:i.right}};t=a.prototype;function l(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function n(e,t){return e<t?-1:t<e?1:0}Object.defineProperty(t,"valid",{get:function(){return 0<this._stack.length}}),Object.defineProperty(t,"node",{get:function(){return 0<this._stack.length?this._stack[this._stack.length-1]:null},enumerable:!0}),t.clone=function(){return new a(this.tree,this._stack.slice())},t.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),i=e[e.length-1];t[t.length-1]=new p(i._color,i.key,i.value,i.left,i.right,i._count);for(var n=e.length-2;0<=n;--n)(i=e[n]).left===e[n+1]?t[n]=new p(i._color,i.key,i.value,t[n+1],i.right,i._count):t[n]=new p(i._color,i.key,i.value,i.left,t[n+1],i._count);if((i=t[t.length-1]).left&&i.right){for(var r=t.length,i=i.left;i.right;)t.push(i),i=i.right;var o=t[r-1];for(t.push(new p(i._color,o.key,o.value,i.left,i.right,i._count)),t[r-1].key=i.key,t[r-1].value=i.value,n=t.length-2;r<=n;--n)i=t[n],t[n]=new p(i._color,i.key,i.value,i.left,t[n+1],i._count);t[r-1].left=t[r]}if(0===(i=t[t.length-1])._color){o=t[t.length-2];for(o.left===i?o.left=null:o.right===i&&(o.right=null),t.pop(),n=0;n<t.length;++n)t[n]._count--}else if(i.left||i.right)for(i.left?l(i,i.left):i.right&&l(i,i.right),i._color=1,n=0;n<t.length-1;++n)t[n]._count--;else{if(1===t.length)return new m(this.tree._compare,null);for(n=0;n<t.length;++n)t[n]._count--;o=t[t.length-2];(function(e){for(var t,i,n,r=e.length-1;0<=r;--r){if(t=e[r],0===r)return t._color=1;if((i=e[r-1]).left===t){if((a=i.right).right&&0===a.right._color)return n=(a=i.right=s(a)).right=s(a.right),i.right=a.left,a.left=i,a.right=n,a._color=i._color,t._color=1,i._color=1,n._color=1,f(i),f(a),1<r&&((o=e[r-2]).left===i?o.left=a:o.right=a),e[r-1]=a;if(a.left&&0===a.left._color)return n=(a=i.right=s(a)).left=s(a.left),i.right=n.left,a.left=n.right,n.left=i,n.right=a,n._color=i._color,i._color=1,a._color=1,t._color=1,f(i),f(a),f(n),1<r&&((o=e[r-2]).left===i?o.left=n:o.right=n),e[r-1]=n;if(1===a._color){if(0===i._color)return i._color=1,i.right=h(0,a);i.right=h(0,a)}else a=s(a),i.right=a.left,a.left=i,a._color=i._color,i._color=0,f(i),f(a),1<r&&((o=e[r-2]).left===i?o.left=a:o.right=a),e[r-1]=a,e[r]=i,r+1<e.length?e[r+1]=t:e.push(t),r+=2}else{if((a=i.left).left&&0===a.left._color)return n=(a=i.left=s(a)).left=s(a.left),i.left=a.right,a.right=i,a.left=n,a._color=i._color,t._color=1,i._color=1,n._color=1,f(i),f(a),1<r&&((o=e[r-2]).right===i?o.right=a:o.left=a),e[r-1]=a;if(a.right&&0===a.right._color)return n=(a=i.left=s(a)).right=s(a.right),i.left=n.right,a.right=n.left,n.right=i,n.left=a,n._color=i._color,i._color=1,a._color=1,t._color=1,f(i),f(a),f(n),1<r&&((o=e[r-2]).right===i?o.right=n:o.left=n),e[r-1]=n;if(1===a._color){if(0===i._color)return i._color=1,i.left=h(0,a);i.left=h(0,a)}else{var o,a=s(a);i.left=a.right,a.right=i,a._color=i._color,i._color=0,f(i),f(a),1<r&&((o=e[r-2]).right===i?o.right=a:o.left=a),e[r-1]=a,e[r]=i,r+1<e.length?e[r+1]=t:e.push(t),r+=2}}}})(t),o.left===i?o.left=null:o.right=null}return new m(this.tree._compare,t[0])},Object.defineProperty(t,"key",{get:function(){if(0<this._stack.length)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(t,"value",{get:function(){if(0<this._stack.length)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(t,"index",{get:function(){var e,t=0,i=this._stack;if(0===i.length)return(e=this.tree.root)?e._count:0;i[i.length-1].left&&(t=i[i.length-1].left._count);for(var n=i.length-2;0<=n;--n)i[n+1]===i[n].right&&(++t,i[n].left)&&(t+=i[n].left._count);return t},enumerable:!0}),t.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();0<e.length&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(t,"hasNext",{get:function(){var e=this._stack;if(0!==e.length){if(e[e.length-1].right)return!0;for(var t=e.length-1;0<t;--t)if(e[t-1].left===e[t])return!0}return!1}}),t.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var i=new Array(t.length),n=t[t.length-1];i[i.length-1]=new p(n._color,n.key,e,n.left,n.right,n._count);for(var r=t.length-2;0<=r;--r)(n=t[r]).left===t[r+1]?i[r]=new p(n._color,n.key,n.value,i[r+1],n.right,n._count):i[r]=new p(n._color,n.key,n.value,n.left,i[r+1],n._count);return new m(this.tree._compare,i[0])},t.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();0<e.length&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(t,"hasPrev",{get:function(){var e=this._stack;if(0!==e.length){if(e[e.length-1].left)return!0;for(var t=e.length-1;0<t;--t)if(e[t-1].right===e[t])return!0}return!1}})},{}],183:[function(e,t,i){"use strict";var n=e("react-is"),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},u={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function p(e){return n.isMemo(e)?o:a[e.$$typeof]||r}a[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[n.Memo]=o;var h=Object.defineProperty,f=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,g=Object.getOwnPropertyDescriptor,b=Object.getPrototypeOf,v=Object.prototype;t.exports=function e(t,i,n){if("string"!=typeof i){v&&(r=b(i))&&r!==v&&e(t,r,n);var r,o=f(i);m&&(o=o.concat(m(i)));for(var a=p(t),s=p(i),l=0;l<o.length;++l){var c=o[l];if(!(u[c]||n&&n[c]||s&&s[c]||a&&a[c])){var d=g(i,c);try{h(t,c,d)}catch(t){}}}}return t}},{"react-is":280}],184:[function(e,t,i){i.read=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,c=l>>1,d=-7,u=i?r-1:0,p=i?-1:1,r=e[t+u];for(u+=p,o=r&(1<<-d)-1,r>>=-d,d+=s;0<d;o=256*o+e[t+u],u+=p,d-=8);for(a=o&(1<<-d)-1,o>>=-d,d+=n;0<d;a=256*a+e[t+u],u+=p,d-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(r?-1:1);a+=Math.pow(2,n),o-=c}return(r?-1:1)*a*Math.pow(2,o-n)},i.write=function(e,t,i,n,r,o){var a,s,l=8*o-r-1,c=(1<<l)-1,d=c>>1,u=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,h=n?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+d?u/n:u*Math.pow(2,1-d))*n&&(a++,n/=2),c<=a+d?(s=0,a=c):1<=a+d?(s=(t*n-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));8<=r;e[i+p]=255&s,p+=h,s/=256,r-=8);for(a=a<<r|s,l+=r;0<l;e[i+p]=255&a,p+=h,a/=256,l-=8);e[i+p-h]|=128*o}},{}],185:[function(e,c,t){!function(l){!function(){"use strict";var n,e,t,i,r=l.MutationObserver||l.WebKitMutationObserver,o=r?(e=0,r=new r(s),t=l.document.createTextNode(""),r.observe(t,{characterData:!0}),function(){t.data=e=++e%2}):l.setImmediate||void 0===l.MessageChannel?"document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var e=l.document.createElement("script");e.onreadystatechange=function(){s(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},l.document.documentElement.appendChild(e)}:function(){setTimeout(s,0)}:((i=new l.MessageChannel).port1.onmessage=s,function(){i.port2.postMessage(0)}),a=[];function s(){var e,t;n=!0;for(var i=a.length;i;){for(t=a,a=[],e=-1;++e<i;)t[e]();i=a.length}n=!1}c.exports=function(e){1!==a.push(e)||n||o()}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],186:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){var i;t&&(e.super_=t,(i=function(){}).prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e)}},{}],187:[function(e,t,i){"use strict";t.exports=function(e,t,i,n,r,o,a,s){var l,c,d;if(!e)throw void 0===t?l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."):(c=[i,n,r,o,a,s],d=0,(l=new Error(t.replace(/%s/g,function(){return c[d++]}))).name="Invariant Violation"),l.framesToPop=1,l}},{}],188:[function(e,t,i){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))||!!e._isBuffer);var t}},{}],189:[function(e,t,i){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],190:[function(e,t,i){var n=e("./lib/encodings");function r(e){if(!(this instanceof r))return new r(e);this.opts=e||{},this.encodings=n}(t.exports=r).prototype._encoding=function(e){return e=(e="string"==typeof e?n[e]:e)||n.id},r.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},r.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},r.prototype.encodeKey=function(e,t,i){return this._keyEncoding(t,i).encode(e)},r.prototype.encodeValue=function(e,t,i){return this._valueEncoding(t,i).encode(e)},r.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},r.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},r.prototype.encodeBatch=function(e,i){var n=this;return e.map(function(e){var t={type:e.type,key:n.encodeKey(e.key,i,e)};return n.keyAsBuffer(i,e)&&(t.keyEncoding="binary"),e.prefix&&(t.prefix=e.prefix),"value"in e&&(t.value=n.encodeValue(e.value,i,e),n.valueAsBuffer(i,e))&&(t.valueEncoding="binary"),t})};var o=["lt","gt","lte","gte","start","end"];r.prototype.encodeLtgt=function(t){var i=this,n={};return Object.keys(t).forEach(function(e){n[e]=-1<o.indexOf(e)?i.encodeKey(t[e],t):t[e]}),n},r.prototype.createStreamDecoder=function(i){var n=this;return i.keys&&i.values?function(e,t){return{key:n.decodeKey(e,i),value:n.decodeValue(t,i)}}:i.keys?function(e){return n.decodeKey(e,i)}:i.values?function(e,t){return n.decodeValue(t,i)}:function(){}},r.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},r.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":191}],191:[function(e,t,r){!function(n){!function(){function e(e){return e}function i(e){return null==e||n.isBuffer(e)}r.utf8=r["utf-8"]={encode:function(e){return i(e)?e:String(e)},decode:e,buffer:!1,type:"utf8"},r.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},r.binary={encode:function(e){return i(e)?e:n.from(e)},decode:e,buffer:!0,type:"binary"},r.none={encode:e,decode:e,buffer:!1,type:"id"},r.id=r.none,["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach(function(t){r[t]={encode:function(e){return i(e)?e:n.from(e,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}})}.call(this)}.call(this,e("buffer").Buffer)},{buffer:153}],192:[function(e,t,i){var e=e("errno").create,n=e("LevelUPError"),r=e("NotFoundError",n);r.prototype.notFound=!0,r.prototype.status=404,t.exports={LevelUPError:n,InitializationError:e("InitializationError",n),OpenError:e("OpenError",n),ReadError:e("ReadError",n),WriteError:e("WriteError",n),NotFoundError:r,EncodingError:e("EncodingError",n)}},{errno:179}],193:[function(e,t,i){var n=e("inherits"),r=e("readable-stream").Readable,o=e("xtend");function a(e,t){if(!(this instanceof a))return new a(e,t);r.call(this,o(t=t||{},{objectMode:!0})),this._iterator=e,this._options=t,this.on("end",this.destroy.bind(this,null,null))}n(t.exports=a,r),a.prototype._read=function(){var n=this,r=this._options;this.destroyed||this._iterator.next(function(e,t,i){if(!n.destroyed)return e?n.destroy(e):void(void 0===t&&void 0===i?n.push(null):!1!==r.keys&&!1===r.values?n.push(t):!1===r.keys&&!1!==r.values?n.push(i):n.push({key:t,value:i}))})},a.prototype._destroy=function(t,i){this._iterator.end(function(e){i(t||e)})}},{inherits:186,"readable-stream":208,xtend:384}],194:[function(e,t,i){"use strict";var s={};function n(e,n,t){t=t||Error;i=r=t,(o=a).prototype=Object.create(i.prototype),(o.prototype.constructor=o).__proto__=i;var r,i,o=a;function a(e,t,i){return r.call(this,"string"==typeof n?n:n(e,t,i))||this}o.prototype.name=t.name,o.prototype.code=e,s[e]=o}function l(e,t){var i;return Array.isArray(e)?(i=e.length,e=e.map(function(e){return String(e)}),2<i?"one of ".concat(t," ").concat(e.slice(0,i-1).join(", "),", or ")+e[i-1]:2===i?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])):"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),n("ERR_INVALID_ARG_TYPE",function(e,t,i){var n,r,o,a;return"string"==typeof t&&"not "===t.substr(0,"not ".length)?(n="must not be",t=t.replace(/^not /,"")):n="must be",o=e,(void 0===a||a>o.length)&&(a=o.length),(" argument"===o.substring(a-" argument".length,a)?"The ".concat(e," "):(a=(r="number"!=typeof r?0:r)+".".length>(o=e).length||-1===o.indexOf(".",r)?"argument":"property",'The "'.concat(e,'" ').concat(a," "))).concat(n," ").concat(l(t,"type"))+". Received type ".concat(typeof i)},TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s},{}],195:[function(d,u,e){!function(c){!function(){"use strict";var e=Object.keys||function(e){var t,i=[];for(t in e)i.push(t);return i},t=(u.exports=a,d("./_stream_readable")),i=d("./_stream_writable");d("inherits")(a,t);for(var n=e(i.prototype),r=0;r<n.length;r++){var o=n[r];a.prototype[o]||(a.prototype[o]=i.prototype[o])}function a(e){if(!(this instanceof a))return new a(e);t.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen)&&(this.allowHalfOpen=!1,this.once("end",s))}function s(){this._writableState.ended||c.nextTick(l,this)}function l(e){e.end()}Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}.call(this)}.call(this,d("_process"))},{"./_stream_readable":197,"./_stream_writable":199,_process:270,inherits:186}],196:[function(e,t,i){"use strict";t.exports=r;var n=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}e("inherits")(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":198,inherits:186}],197:[function(j,F,e){!function(M,B){!function(){"use strict";function m(e,t){return e.listeners(t).length}(F.exports=w).ReadableState=y,j("events").EventEmitter;var n,r,e,i,o=j("./internal/streams/stream"),u=j("buffer").Buffer,p=(void 0!==B?B:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},t=j("util"),g=t&&t.debuglog?t.debuglog("stream"):function(){},a=j("./internal/streams/buffer_list"),t=j("./internal/streams/destroy"),s=j("./internal/streams/state").getHighWaterMark,l=j("../errors").codes,h=l.ERR_INVALID_ARG_TYPE,f=l.ERR_STREAM_PUSH_AFTER_EOF,c=l.ERR_METHOD_NOT_IMPLEMENTED,b=l.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v=(j("inherits")(w,o),t.errorOrDestroy),d=["error","close","destroy","pause","resume"];function y(e,t,i){n=n||j("./_stream_duplex"),e=e||{},"boolean"!=typeof i&&(i=t instanceof n),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=s(this,e,"readableHighWaterMark",i),this.buffer=new a,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(r=r||j("string_decoder/").StringDecoder,this.decoder=new r(e.encoding),this.encoding=e.encoding)}function w(e){if(n=n||j("./_stream_duplex"),!(this instanceof w))return new w(e);var t=this instanceof n;this._readableState=new y(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy)&&(this._destroy=e.destroy),o.call(this)}function k(e,t,i,n,r){g("readableAddChunk",t);var o,a,s,l,c,d=e._readableState;if(null===t)d.reading=!1,s=e,l=d,g("onEofChunk"),l.ended||(l.decoder&&(c=l.decoder.end())&&c.length&&(l.buffer.push(c),l.length+=l.objectMode?1:c.length),l.ended=!0,l.sync?C(s):(l.needReadable=!1,l.emittedReadable||(l.emittedReadable=!0,_(s))));else if(r||(c=d,s=l=t,o=a=u.isBuffer(s)||s instanceof p||"string"==typeof l||void 0===l||c.objectMode?a:new h("chunk",["string","Buffer","Uint8Array"],l)),o)v(e,o);else if(d.objectMode||t&&0<t.length)if("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===u.prototype||(r=t,t=u.from(r)),n)d.endEmitted?v(e,new b):x(e,d,t,!0);else if(d.ended)v(e,new f);else{if(d.destroyed)return!1;d.reading=!1,!d.decoder||i||(t=d.decoder.write(t),d.objectMode)||0!==t.length?x(e,d,t,!1):S(e,d)}else n||(d.reading=!1,S(e,d));return!d.ended&&(d.length<d.highWaterMark||0===d.length)}function x(e,t,i,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",i)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&C(e)),S(e,t)}Object.defineProperty(w.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),w.prototype.destroy=t.destroy,w.prototype._undestroy=t.undestroy,w.prototype._destroy=function(e,t){t(e)},w.prototype.push=function(e,t){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),i=!0),k(this,e,t,!1,i)},w.prototype.unshift=function(e){return k(this,e,null,!0,!1)},w.prototype.isPaused=function(){return!1===this._readableState.flowing},w.prototype.setEncoding=function(e){var t=new(r=r||j("string_decoder/").StringDecoder)(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,n="";null!==i;)n+=t.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(1073741824<=(i=e)?i=1073741824:(i--,i=(i=(i=(i=(i|=i>>>1)|i>>>2)|i>>>4)|i>>>8)|i>>>16,i++),i)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var i}function C(e){var t=e._readableState;g("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(g("emitReadable",t.flowing),t.emittedReadable=!0,M.nextTick(_,e))}function _(e){var t=e._readableState;g("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,O(e)}function S(e,t){t.readingMore||(t.readingMore=!0,M.nextTick(T,e,t))}function T(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var i=t.length;if(g("maybeReadMore read 0"),e.read(0),i===t.length)break}t.readingMore=!1}function A(e){var t=e._readableState;t.readableListening=0<e.listenerCount("readable"),t.resumeScheduled&&!t.paused?t.flowing=!0:0<e.listenerCount("data")&&e.resume()}function N(e){g("readable nexttick read 0"),e.read(0)}function I(e,t){g("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),O(e),t.flowing&&!t.reading&&e.read(0)}function O(e){var t=e._readableState;for(g("flow",t.flowing);t.flowing&&null!==e.read(););}function P(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):i=t.buffer.consume(e,t.decoder),i);var i}function D(e){var t=e._readableState;g("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,M.nextTick(L,t,e))}function L(e,t){g("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)&&(!(e=t._writableState)||e.autoDestroy&&e.finished)&&t.destroy()}function R(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}w.prototype.read=function(e){g("read",e),e=parseInt(e,10);var t,i=this._readableState,n=e;return 0!==e&&(i.emittedReadable=!1),0===e&&i.needReadable&&((0!==i.highWaterMark?i.length>=i.highWaterMark:0<i.length)||i.ended)?(g("read: emitReadable",i.length,i.ended),(0===i.length&&i.ended?D:C)(this),null):0===(e=E(e,i))&&i.ended?(0===i.length&&D(this),null):(t=i.needReadable,g("need readable",t),(0===i.length||i.length-e<i.highWaterMark)&&g("length less than watermark",t=!0),i.ended||i.reading?g("reading or ended",t=!1):t&&(g("do read"),i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1,i.reading||(e=E(n,i))),null===(t=0<e?P(e,i):null)?(i.needReadable=i.length<=i.highWaterMark,e=0):(i.length-=e,i.awaitDrain=0),0===i.length&&(i.ended||(i.needReadable=!0),n!==e)&&i.ended&&D(this),null!==t&&this.emit("data",t),t)},w.prototype._read=function(e){v(this,new c("_read()"))},w.prototype.pipe=function(n,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=n;break;case 1:o.pipes=[o.pipes,n];break;default:o.pipes.push(n)}o.pipesCount+=1,g("pipe count=%d opts=%j",o.pipesCount,e);e=e&&!1===e.end||n===M.stdout||n===M.stderr?f:a;function a(){g("onend"),n.end()}o.endEmitted?M.nextTick(e):r.once("end",e),n.on("unpipe",function e(t,i){g("onunpipe"),t===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,g("cleanup"),n.removeListener("close",p),n.removeListener("finish",h),n.removeListener("drain",l),n.removeListener("error",u),n.removeListener("unpipe",e),r.removeListener("end",a),r.removeListener("end",f),r.removeListener("data",d),c=!0,!o.awaitDrain||n._writableState&&!n._writableState.needDrain||l())});t=r;var t,i,s,l=function(){var e=t._readableState;g("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&m(t,"data")&&(e.flowing=!0,O(t))},c=(n.on("drain",l),!1);function d(e){g("ondata");e=n.write(e);g("dest.write",e),!1===e&&((1===o.pipesCount&&o.pipes===n||1<o.pipesCount&&-1!==R(o.pipes,n))&&!c&&(g("false write response, pause",o.awaitDrain),o.awaitDrain++),r.pause())}function u(e){g("onerror",e),f(),n.removeListener("error",u),0===m(n,"error")&&v(n,e)}function p(){n.removeListener("finish",h),f()}function h(){g("onfinish"),n.removeListener("close",p),f()}function f(){g("unpipe"),r.unpipe(n)}return r.on("data",d),e="error",s=u,"function"==typeof(i=n).prependListener?i.prependListener(e,s):i._events&&i._events[e]?Array.isArray(i._events[e])?i._events[e].unshift(s):i._events[e]=[s,i._events[e]]:i.on(e,s),n.once("close",p),n.once("finish",h),n.emit("pipe",r),o.flowing||(g("pipe resume"),r.resume()),n},w.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i));else if(e){var n=R(t.pipes,e);-1!==n&&(t.pipes.splice(n,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i))}else{var r=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<o;a++)r[a].emit("unpipe",this,{hasUnpiped:!1})}return this},w.prototype.addListener=w.prototype.on=function(e,t){var t=o.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=0<this.listenerCount("readable"),!1!==i.flowing&&this.resume()):"readable"!==e||i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,g("on readable",i.length,i.reading),i.length?C(this):i.reading||M.nextTick(N,this)),t},w.prototype.removeListener=function(e,t){t=o.prototype.removeListener.call(this,e,t);return"readable"===e&&M.nextTick(A,this),t},w.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||M.nextTick(A,this),t},w.prototype.resume=function(){var e,t,i=this._readableState;return i.flowing||(g("resume"),i.flowing=!i.readableListening,e=this,(t=i).resumeScheduled||(t.resumeScheduled=!0,M.nextTick(I,e,t))),i.paused=!1,this},w.prototype.pause=function(){return g("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(g("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},w.prototype.wrap=function(t){var e,i=this,n=this._readableState,r=!1;for(e in t.on("end",function(){var e;g("wrapped end"),n.decoder&&!n.ended&&(e=n.decoder.end())&&e.length&&i.push(e),i.push(null)}),t.on("data",function(e){g("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e||(n.objectMode||e&&e.length)&&!i.push(e)&&(r=!0,t.pause())}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var o=0;o<d.length;o++)t.on(d[o],this.emit.bind(this,d[o]));return this._read=function(e){g("wrapped _read",e),r&&(r=!1,t.resume())},this},"function"==typeof Symbol&&(w.prototype[Symbol.asyncIterator]=function(){return(e=void 0===e?j("./internal/streams/async_iterator"):e)(this)}),Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(w.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(w.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),w._fromList=P,Object.defineProperty(w.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(w.from=function(e,t){return(i=void 0===i?j("./internal/streams/from"):i)(w,e,t)})}.call(this)}.call(this,j("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":194,"./_stream_duplex":195,"./internal/streams/async_iterator":200,"./internal/streams/buffer_list":201,"./internal/streams/destroy":202,"./internal/streams/from":204,"./internal/streams/state":206,"./internal/streams/stream":207,_process:270,buffer:153,events:180,inherits:186,"string_decoder/":365,util:152}],198:[function(e,t,i){"use strict";t.exports=l;var t=e("../errors").codes,n=t.ERR_METHOD_NOT_IMPLEMENTED,r=t.ERR_MULTIPLE_CALLBACK,o=t.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=t.ERR_TRANSFORM_WITH_LENGTH_0,s=e("./_stream_duplex");function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),this._transformState={afterTransform:function(e,t){var i=this._transformState,n=(i.transforming=!1,i.writecb);if(null===n)return this.emit("error",new r);i.writechunk=null,(i.writecb=null)!=t&&this.push(t),n(e),(i=this._readableState).reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush)&&(this._flush=e.flush),this.on("prefinish",c)}function c(){var i=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush(function(e,t){d(i,e,t)})}function d(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new a;if(e._transformState.transforming)throw new o;e.push(null)}e("inherits")(l,s),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,i){i(new n("_transform()"))},l.prototype._write=function(e,t,i){var n=this._transformState;n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming&&(i=this._readableState,n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){s.prototype._destroy.call(this,e,function(e){t(e)})}},{"../errors":194,"./_stream_duplex":195,inherits:186}],199:[function(I,O,e){!function(A,N){!function(){"use strict";function d(r){var o=this;this.next=null,this.entry=null,this.finish=function(){var e=o,t=r,i=e.entry;for(e.entry=null;i;){var n=i.callback;t.pendingcb--,n(void 0),i=i.next}t.corkedRequestsFree.next=e}}(O.exports=f).WritableState=h;var i,n,e={deprecate:I("util-deprecate")},r=I("./internal/streams/stream"),g=I("buffer").Buffer,b=(void 0!==N?N:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},t=I("./internal/streams/destroy"),o=I("./internal/streams/state").getHighWaterMark,a=I("../errors").codes,v=a.ERR_INVALID_ARG_TYPE,s=a.ERR_METHOD_NOT_IMPLEMENTED,u=a.ERR_MULTIPLE_CALLBACK,l=a.ERR_STREAM_CANNOT_PIPE,c=a.ERR_STREAM_DESTROYED,y=a.ERR_STREAM_NULL_VALUES,w=a.ERR_STREAM_WRITE_AFTER_END,p=a.ERR_UNKNOWN_ENCODING,k=t.errorOrDestroy;function x(){}function h(e,c,t){i=i||I("./_stream_duplex"),e=e||{},"boolean"!=typeof t&&(t=c instanceof i),this.objectMode=!!e.objectMode,t&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=o(this,e,"writableHighWaterMark",t),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;t=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!t,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,i,n,r,o=c,a=o._writableState,s=a.sync,l=a.writecb;if("function"!=typeof l)throw new u;(r=a).writing=!1,r.writecb=null,r.length-=r.writelen,r.writelen=0,e?(r=o,i=s,e=e,n=l,--(t=a).pendingcb,i?(A.nextTick(n,e),A.nextTick(T,r,t),r._writableState.errorEmitted=!0,k(r,e)):(n(e),r._writableState.errorEmitted=!0,k(r,e),T(r,t))):((i=_(a)||o.destroyed)||a.corked||a.bufferProcessing||!a.bufferedRequest||C(o,a),s?A.nextTick(m,o,a,i,l):m(o,a,i,l))},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}function f(e){var t=this instanceof(i=i||I("./_stream_duplex"));if(!t&&!n.call(f,this))return new f(e);this._writableState=new h(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final)&&(this._final=e.final),r.call(this)}function E(e,t,i,n,r,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new c("write")):i?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function m(e,t,i,n){var r;i||(i=e,0===(r=t).length&&r.needDrain&&(r.needDrain=!1,i.emit("drain"))),t.pendingcb--,n(),T(e,t)}function C(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,r=new Array(n),n=t.corkedRequestsFree;n.entry=i;for(var o=0,a=!0;i;)(r[o]=i).isBuf||(a=!1),i=i.next,o+=1;r.allBuffers=a,E(e,t,!0,t.length,r,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new d(t),t.bufferedRequestCount=0}else{for(;i;){var s=i.chunk,l=i.encoding,c=i.callback;if(E(e,t,!1,t.objectMode?1:s.length,s,l,c),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(t,i){t._final(function(e){i.pendingcb--,e&&k(t,e),i.prefinished=!0,t.emit("prefinish"),T(t,i)})}function T(e,t){var i,n,r=_(t);return r&&(i=e,(n=t).prefinished||n.finalCalled||("function"!=typeof i._final||n.destroyed?(n.prefinished=!0,i.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,A.nextTick(S,i,n))),0===t.pendingcb)&&(t.finished=!0,e.emit("finish"),t.autoDestroy)&&((!(i=e._readableState)||i.autoDestroy&&i.endEmitted)&&e.destroy()),r}I("inherits")(f,r),h.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t};try{Object.defineProperty(h.prototype,"buffer",{get:e.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(n=Function.prototype[Symbol.hasInstance],Object.defineProperty(f,Symbol.hasInstance,{value:function(e){return!!n.call(this,e)||this===f&&e&&e._writableState instanceof h}})):n=function(e){return e instanceof this},f.prototype.pipe=function(){k(this,new l)},f.prototype.write=function(e,t,i){var n,r,o,a,s,l,c,d,u,p,h=this._writableState,f=!1,m=!h.objectMode&&(m=e,g.isBuffer(m)||m instanceof b);return m&&!g.isBuffer(e)&&(p=e,e=g.from(p)),"function"==typeof t&&(i=t,t=null),t=m?"buffer":t||h.defaultEncoding,"function"!=typeof i&&(i=x),h.ending?(p=this,d=i,u=new w,k(p,u),A.nextTick(d,u)):m||(d=this,u=h,l=i,null===(s=e)?c=new y:"string"==typeof s||u.objectMode||(c=new v("chunk",["string","Buffer"],s)),!c)?(h.pendingcb++,s=this,h=h,e=e,t=t,i=i,(n=m)||(a=e,o=t,a=h.objectMode||!1===h.decodeStrings||"string"!=typeof a?a:g.from(a,o),e!==a&&(n=!0,t="buffer",e=a)),o=h.objectMode?1:e.length,h.length+=o,(a=h.length<h.highWaterMark)||(h.needDrain=!0),h.writing||h.corked?(r=h.lastBufferedRequest,h.lastBufferedRequest={chunk:e,encoding:t,isBuf:n,callback:i,next:null},r?r.next=h.lastBufferedRequest:h.bufferedRequest=h.lastBufferedRequest,h.bufferedRequestCount+=1):E(s,h,!1,o,e,t,i),f=a):(k(d,c),A.nextTick(l,c)),f},f.prototype.cork=function(){this._writableState.corked++},f.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||C(this,e))},f.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase()))return this._writableState.defaultEncoding=e,this;throw new p(e)},Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),f.prototype._write=function(e,t,i){i(new s("_write()"))},f.prototype._writev=null,f.prototype.end=function(e,t,i){var n=this._writableState;return"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||(e=this,t=i,(i=n).ending=!0,T(e,i),t&&(i.finished?A.nextTick(t):e.once("finish",t)),i.ended=!0,e.writable=!1),this},Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),f.prototype.destroy=t.destroy,f.prototype._undestroy=t.undestroy,f.prototype._destroy=function(e,t){t(e)}}.call(this)}.call(this,I("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":194,"./_stream_duplex":195,"./internal/streams/destroy":202,"./internal/streams/state":206,"./internal/streams/stream":207,_process:270,buffer:153,inherits:186,"util-deprecate":378}],200:[function(n,g,e){!function(m){!function(){"use strict";var e;function i(e,t,i){var n;n=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(t),(t="symbol"==typeof n?n:String(n))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}var r=n("./end-of-stream"),o=Symbol("lastResolve"),a=Symbol("lastReject"),s=Symbol("error"),l=Symbol("ended"),c=Symbol("lastPromise"),d=Symbol("handlePromise"),u=Symbol("stream");function p(e,t){return{value:e,done:t}}function h(e){var t,i=e[o];null!==i&&null!==(t=e[u].read())&&(e[c]=null,e[o]=null,e[a]=null,i(p(t,!1)))}var t=Object.getPrototypeOf(function(){}),f=Object.setPrototypeOf((i(e={get stream(){return this[u]},next:function(){var i=this,e=this[s];if(null!==e)return Promise.reject(e);if(this[l])return Promise.resolve(p(void 0,!0));if(this[u].destroyed)return new Promise(function(e,t){m.nextTick(function(){i[s]?t(i[s]):e(p(void 0,!0))})});var t,n,r,e=this[c];if(e)t=new Promise((n=e,r=this,function(e,t){n.then(function(){r[l]?e(p(void 0,!0)):r[d](e,t)},t)}));else{e=this[u].read();if(null!==e)return Promise.resolve(p(e,!1));t=new Promise(this[d])}return this[c]=t}},Symbol.asyncIterator,function(){return this}),i(e,"return",function(){var e=this;return new Promise(function(t,i){e[u].destroy(null,function(e){e?i(e):t(p(void 0,!0))})})}),e),t);g.exports=function(e){var t,n=Object.create(f,(i(t={},u,{value:e,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,a,{value:null,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,l,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var i=n[u].read();i?(n[c]=null,n[o]=null,n[a]=null,e(p(i,!1))):(n[o]=e,n[a]=t)},writable:!0}),t));return n[c]=null,r(e,function(e){var t;e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code?(null!==(t=n[a])&&(n[c]=null,n[o]=null,n[a]=null,t(e)),n[s]=e):(null!==(t=n[o])&&(n[c]=null,n[o]=null,t(p(void 0,!(n[a]=null)))),n[l]=!0)}),e.on("readable",function(e){m.nextTick(h,e)}.bind(null,n)),n}}.call(this)}.call(this,n("_process"))},{"./end-of-stream":203,_process:270}],201:[function(e,t,i){"use strict";function o(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function n(n){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var t,i;t=n,i=r[e=e],(e=a(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){e=function(e){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"==typeof e?e:String(e)}var s=e("buffer").Buffer,l=e("util").inspect,e=l&&l.custom||"inspect";function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.head=null,this.tail=null,this.length=0}t.exports=(r((t=c).prototype,[{key:"push",value:function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){var e;if(0!==this.length)return e=this.head.data,1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,i,n=s.allocUnsafe(e>>>0),r=this.head,o=0;r;)t=r.data,i=o,s.prototype.copy.call(t,n,i),o+=r.data.length,r=r.next;return n}},{key:"consume",value:function(e,t){var i;return e<this.head.data.length?(i=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):i=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,i=1,n=t.data;for(e-=n.length;t=t.next;){var r=t.data,o=e>r.length?r.length:e;if(o===r.length?n+=r:n+=r.slice(0,e),0==(e-=o)){o===r.length?(++i,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t).data=r.slice(o);break}++i}return this.length-=i,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),i=this.head,n=1;for(i.data.copy(t),e-=i.data.length;i=i.next;){var r=i.data,o=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,o),0==(e-=o)){o===r.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i).data=r.slice(o);break}++n}return this.length-=n,t}},{key:e,value:function(e,t){return l(this,n(n({},t),{},{depth:0,customInspect:!1}))}}]),Object.defineProperty(t,"prototype",{writable:!1}),c)},{buffer:153,util:152}],202:[function(e,t,i){!function(l){!function(){"use strict";function o(e,t){s(e,t),a(e)}function a(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function s(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var i=this,n=this._readableState&&this._readableState.destroyed,r=this._writableState&&this._writableState.destroyed;return n||r?t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,l.nextTick(s,this,e)):l.nextTick(s,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?i._writableState?i._writableState.errorEmitted?l.nextTick(a,i):(i._writableState.errorEmitted=!0,l.nextTick(o,i,e)):l.nextTick(o,i,e):t?(l.nextTick(a,i),t(e)):l.nextTick(a,i)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var i=e._readableState,n=e._writableState;i&&i.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}.call(this)}.call(this,e("_process"))},{_process:270}],203:[function(e,t,i){"use strict";var g=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function b(){}t.exports=function e(t,i,n){var r,o,a,s,l,c,d,u,p,h,f,m;return"function"==typeof i?e(t,null,i):(r=n||b,o=!1,n=function(){if(!o){o=!0;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r.apply(this,t)}},a=(i=i||{}).readable||!1!==i.readable&&t.readable,s=i.writable||!1!==i.writable&&t.writable,l=function(){t.writable||d()},c=t._writableState&&t._writableState.finished,d=function(){c=!(s=!1),a||n.call(t)},u=t._readableState&&t._readableState.endEmitted,p=function(){u=!(a=!1),s||n.call(t)},h=function(e){n.call(t,e)},f=function(){var e;return a&&!u?(t._readableState&&t._readableState.ended||(e=new g),n.call(t,e)):s&&!c?(t._writableState&&t._writableState.ended||(e=new g),n.call(t,e)):void 0},m=function(){t.req.on("finish",d)},t.setHeader&&"function"==typeof t.abort?(t.on("complete",d),t.on("abort",f),t.req?m():t.on("request",m)):s&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",p),t.on("finish",d),!1!==i.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",d),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",d),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",d),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)})}},{"../../../errors":194}],204:[function(e,t,i){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],205:[function(f,e,t){"use strict";var m,i=f("../../../errors").codes,n=i.ERR_MISSING_ARGS,g=i.ERR_STREAM_DESTROYED;function r(e){if(e)throw e}function b(e){e()}function o(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,d=new Array(e),t=0;t<e;t++)d[t]=arguments[t];var u,i,p=!(i=d).length||"function"!=typeof i[i.length-1]?r:i.pop();if((d=Array.isArray(d[0])?d[0]:d).length<2)throw new n("streams");var h=d.map(function(e,t){var i,n,r,o,a,s,l,c=t<d.length-1;return n=c,t=0<t,o=r=function(e){u=u||e,e&&h.forEach(b),c||(h.forEach(b),p(u))},a=!1,s=!(r=function(){a||(a=!0,o.apply(void 0,arguments))}),(i=e).on("close",function(){s=!0}),(m=void 0===m?f("./end-of-stream"):m)(i,{readable:n,writable:t},function(e){if(e)return r(e);s=!0,r()}),l=!1,function(e){if(!s&&!l)return l=!0,i.setHeader&&"function"==typeof i.abort?i.abort():"function"==typeof i.destroy?i.destroy():void r(e||new g("pipe"))}});return d.reduce(o)}},{"../../../errors":194,"./end-of-stream":203}],206:[function(e,t,i){"use strict";var r=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,i,n){t=null!=t.highWaterMark?t.highWaterMark:n?t[i]:null;if(null==t)return e.objectMode?16:16384;if(!isFinite(t)||Math.floor(t)!==t||t<0)throw new r(n?i:"highWaterMark",t);return Math.floor(t)}}},{"../../../errors":194}],207:[function(e,t,i){t.exports=e("events").EventEmitter},{events:180}],208:[function(e,t,i){(((i=t.exports=e("./lib/_stream_readable.js")).Stream=i).Readable=i).Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js"),i.finished=e("./lib/internal/streams/end-of-stream.js"),i.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":195,"./lib/_stream_passthrough.js":196,"./lib/_stream_readable.js":197,"./lib/_stream_transform.js":198,"./lib/_stream_writable.js":199,"./lib/internal/streams/end-of-stream.js":203,"./lib/internal/streams/pipeline.js":205}],209:[function(e,t,i){var o=e("level-errors").WriteError,a=e("./promisify"),s=e("./common").getCallback,l=e("./common").getOptions;function n(e){this._levelup=e,this.batch=e.db.batch(),this.ops=[],this.length=0}n.prototype.put=function(e,t){try{this.batch.put(e,t)}catch(e){throw new o(e)}return this.ops.push({type:"put",key:e,value:t}),this.length++,this},n.prototype.del=function(e){try{this.batch.del(e)}catch(e){throw new o(e)}return this.ops.push({type:"del",key:e}),this.length++,this},n.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new o(e)}return this.ops=[],this.length=0,this},n.prototype.write=function(e,t){var i,n=this._levelup,r=this.ops;(t=s(e,t))||(i=(t=a()).promise),e=l(e);try{this.batch.write(e,function(e){if(e)return t(new o(e));n.emit("batch",r),t()})}catch(e){throw new o(e)}return i},t.exports=n},{"./common":210,"./promisify":212,"level-errors":192}],210:[function(e,t,i){i.getCallback=function(e,t){return"function"==typeof e?e:t},i.getOptions=function(e){return"object"==typeof e&&null!==e?e:{}}},{}],211:[function(y,w,e){!function(v){!function(){var r=y("events").EventEmitter,e=y("util").inherits,t=y("xtend"),o=y("deferred-leveldown"),i=y("level-iterator-stream"),a=y("./batch"),n=y("level-errors"),s=y("assert"),l=y("./promisify"),c=y("./common").getCallback,d=y("./common").getOptions,u=n.WriteError,p=n.ReadError,h=n.NotFoundError,f=n.OpenError,m=n.InitializationError;function g(e,t,i){if(!(this instanceof g))return new g(e,t,i);var n;if(r.call(this),this.setMaxListeners(1/0),"function"==typeof t&&(i=t,t={}),t=t||{},!e||"object"!=typeof e){if(n=new m("First argument must be an abstract-leveldown compliant store"),"function"==typeof i)return v.nextTick(i,n);throw n}s.strictEqual(typeof e.status,"string",".status required, old abstract-leveldown"),this.options=d(t),this._db=e,this.db=new o(e),this.open(i)}function b(e,t){return!e._isOpening()&&!e.isOpen()&&(v.nextTick(t,new p("Database is not open")),1)}g.prototype.emit=r.prototype.emit,g.prototype.once=r.prototype.once,e(g,r),g.prototype.open=function(e,t){var i,n=this;return"function"==typeof e&&(t=e,e=null),t||(i=(t=l()).promise),e=e||this.options,this.isOpen()?v.nextTick(t,null,n):this._isOpening()?this.once("open",function(){t(null,n)}):(this.emit("opening"),this.db.open(e,function(e){if(e)return t(new f(e));n.db=n._db,t(null,n),n.emit("open"),n.emit("ready")})),i},g.prototype.close=function(e){var t,i=this;return e||(t=(e=l()).promise),this.isOpen()?(this.db.close(function(){i.emit("closed"),e.apply(null,arguments)}),this.emit("closing"),this.db=new o(this._db)):this.isClosed()?v.nextTick(e):"closing"===this.db.status?this.once("closed",e):this._isOpening()&&this.once("open",function(){i.close(e)}),t},g.prototype.isOpen=function(){return"open"===this.db.status},g.prototype._isOpening=function(){return"opening"===this.db.status},g.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)},g.prototype.get=function(i,e,n){if(null==i)throw new p("get() requires a key argument");var t;return(n=c(e,n))||(t=(n=l()).promise),b(this,n)||(e=d(e),this.db.get(i,e,function(e,t){if(e)return e=/notfound/i.test(e)||e.notFound?new h("Key not found in database ["+i+"]",e):new p(e),n(e);n(null,t)})),t},g.prototype.put=function(t,i,e,n){if(null==t)throw new u("put() requires a key argument");var r,o=this;return(n=c(e,n))||(r=(n=l()).promise),b(this,n)||(e=d(e),this.db.put(t,i,e,function(e){if(e)return n(new u(e));o.emit("put",t,i),n()})),r},g.prototype.del=function(t,e,i){if(null==t)throw new u("del() requires a key argument");var n,r=this;return(i=c(e,i))||(n=(i=l()).promise),b(this,i)||(e=d(e),this.db.del(t,e,function(e){if(e)return i(new u(e));r.emit("del",t),i()})),n},g.prototype.batch=function(t,e,i){if(!arguments.length)return new a(this);var n,r;if(Array.isArray(t))return r=this,(i=c(e,i))||(n=(i=l()).promise),b(this,i)||(e=d(e),this.db.batch(t,e,function(e){if(e)return i(new u(e));r.emit("batch",t),i()})),n;throw new u("batch() requires an array argument")},g.prototype.iterator=function(e){return this.db.iterator(e)},g.prototype.readStream=g.prototype.createReadStream=function(e){return"number"!=typeof(e=t({keys:!0,values:!0},e)).limit&&(e.limit=-1),new i(this.db.iterator(e),e)},g.prototype.keyStream=g.prototype.createKeyStream=function(e){return this.createReadStream(t(e,{keys:!0,values:!1}))},g.prototype.valueStream=g.prototype.createValueStream=function(e){return this.createReadStream(t(e,{keys:!1,values:!0}))},g.prototype.toString=function(){return"LevelUP"},g.errors=n,w.exports=g.default=g}.call(this)}.call(this,y("_process"))},{"./batch":209,"./common":210,"./promisify":212,_process:270,assert:147,"deferred-leveldown":218,events:180,"level-errors":192,"level-iterator-stream":193,util:381,xtend:384}],212:[function(e,t,i){t.exports=function(){var e,t=new Promise(function(i,n){e=function(e,t){e?n(e):i(t)}});return e.promise=t,e}},{}],213:[function(e,t,i){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(e,t){this._checkWritten();var i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},n.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},n.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},n.prototype._del=function(e){this._operations.push({type:"del",key:e})},n.prototype.clear=function(){return this._checkWritten(),this._clear(),this},n.prototype._clear=function(){this._operations=[]},n.prototype.write=function(e,t){if(this._checkWritten(),"function"!=typeof(t="function"==typeof e?e:t))throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},n.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=n},{}],214:[function(e,t,i){!function(i){!function(){function e(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}e.prototype.next=function(e){var t=this;if("function"!=typeof e)throw new Error("next() requires a callback argument");return t._ended?i.nextTick(e,new Error("cannot call next() after end()")):t._nexting?i.nextTick(e,new Error("cannot call next() before previous next() has completed")):(t._nexting=!0,t._next(function(){t._nexting=!1,e.apply(null,arguments)})),t},e.prototype._next=function(e){i.nextTick(e)},e.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},e.prototype._seek=function(e){},e.prototype.end=function(e){if("function"!=typeof e)throw new Error("end() requires a callback argument");if(this._ended)return i.nextTick(e,new Error("end() already called on iterator"));this._ended=!0,this._end(e)},e.prototype._end=function(e){i.nextTick(e)},t.exports=e}.call(this)}.call(this,e("_process"))},{_process:270}],215:[function(r,o,e){!function(n,c){!function(){var s=r("xtend"),t=r("./abstract-iterator"),e=r("./abstract-chained-batch"),a=Object.prototype.hasOwnProperty,l="start end gt gte lt lte".split(" ");function i(){this.status="new"}i.prototype.open=function(e,t){var i=this,n=this.status;if("function"!=typeof(t="function"==typeof e?e:t))throw new Error("open() requires a callback argument");(e="object"==typeof e&&null!==e?e:{}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists,this.status="opening",this._open(e,function(e){if(e)return i.status=n,t(e);i.status="open",t()})},i.prototype._open=function(e,t){c.nextTick(t)},i.prototype.close=function(t){var i=this,n=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");this.status="closing",this._close(function(e){if(e)return i.status=n,t(e);i.status="closed",t()})},i.prototype._close=function(e){c.nextTick(e)},i.prototype.get=function(e,t,i){if("function"!=typeof(i="function"==typeof t?t:i))throw new Error("get() requires a callback argument");var n=this._checkKey(e);if(n)return c.nextTick(i,n);e=this._serializeKey(e),(t="object"==typeof t&&null!==t?t:{}).asBuffer=!1!==t.asBuffer,this._get(e,t,i)},i.prototype._get=function(e,t,i){c.nextTick(function(){i(new Error("NotFound"))})},i.prototype.put=function(e,t,i,n){if("function"!=typeof(n="function"==typeof i?i:n))throw new Error("put() requires a callback argument");var r=this._checkKey(e)||this._checkValue(t);if(r)return c.nextTick(n,r);e=this._serializeKey(e),t=this._serializeValue(t),this._put(e,t,i="object"==typeof i&&null!==i?i:{},n)},i.prototype._put=function(e,t,i,n){c.nextTick(n)},i.prototype.del=function(e,t,i){if("function"!=typeof(i="function"==typeof t?t:i))throw new Error("del() requires a callback argument");var n=this._checkKey(e);if(n)return c.nextTick(i,n);e=this._serializeKey(e),this._del(e,t="object"==typeof t&&null!==t?t:{},i)},i.prototype._del=function(e,t,i){c.nextTick(i)},i.prototype.batch=function(e,t,i){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(i=t),"function"!=typeof(i="function"==typeof e?e:i))throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return c.nextTick(i,new Error("batch(array) requires an array argument"));if(0===e.length)return c.nextTick(i);"object"==typeof t&&null!==t||(t={});for(var n=new Array(e.length),r=0;r<e.length;r++){if("object"!=typeof e[r]||null===e[r])return c.nextTick(i,new Error("batch(array) element must be an object and not `null`"));var o=s(e[r]);if("put"!==o.type&&"del"!==o.type)return c.nextTick(i,new Error("`type` must be 'put' or 'del'"));var a=this._checkKey(o.key);if(a)return c.nextTick(i,a);if(o.key=this._serializeKey(o.key),"put"===o.type){a=this._checkValue(o.value);if(a)return c.nextTick(i,a);o.value=this._serializeValue(o.value)}n[r]=o}this._batch(n,t,i)},i.prototype._batch=function(e,t,i){c.nextTick(i)},i.prototype._setupIteratorOptions=function(e){return(e=function(e,t){var i,n,r,o={};for(i in t)a.call(t,i)&&(n=t[i],r=i,-1!==l.indexOf(r)&&(n=e._serializeKey(n)),o[i]=n);return o}(this,e)).reverse=!!e.reverse,e.keys=!1!==e.keys,e.values=!1!==e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=!1!==e.keyAsBuffer,e.valueAsBuffer=!1!==e.valueAsBuffer,e},i.prototype.iterator=function(e){return e=this._setupIteratorOptions(e="object"==typeof e&&null!==e?e:{}),this._iterator(e)},i.prototype._iterator=function(e){return new t(this)},i.prototype._chainedBatch=function(){return new e(this)},i.prototype._serializeKey=function(e){return e},i.prototype._serializeValue=function(e){return e},i.prototype._checkKey=function(e){return null==e?new Error("key cannot be `null` or `undefined`"):n.isBuffer(e)&&0===e.length?new Error("key cannot be an empty Buffer"):""===e?new Error("key cannot be an empty String"):Array.isArray(e)&&0===e.length?new Error("key cannot be an empty Array"):void 0},i.prototype._checkValue=function(e){if(null==e)return new Error("value cannot be `null` or `undefined`")},o.exports=i}.call(this)}.call(this,{isBuffer:r("../../../is-buffer/index.js")},r("_process"))},{"../../../is-buffer/index.js":188,"./abstract-chained-batch":213,"./abstract-iterator":214,_process:270,xtend:384}],216:[function(e,t,i){i.AbstractLevelDOWN=e("./abstract-leveldown"),i.AbstractIterator=e("./abstract-iterator"),i.AbstractChainedBatch=e("./abstract-chained-batch")},{"./abstract-chained-batch":213,"./abstract-iterator":214,"./abstract-leveldown":215}],217:[function(e,t,i){var n=e("abstract-leveldown").AbstractIterator;function r(e){n.call(this,e),this._options=e,this._iterator=null,this._operations=[]}e("inherits")(r,n),r.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach(function(e){t[e.method].apply(t,e.args)})},r.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach(function(e){r.prototype["_"+e]=function(){this._operation(e,arguments)}}),r.prototype.seek=function(){this._operation("seek",arguments)},t.exports=r},{"abstract-leveldown":216,inherits:186}],218:[function(e,t,i){var n=e("abstract-leveldown").AbstractLevelDOWN,r=e("inherits"),o=e("./deferred-iterator"),a="put get del batch".split(" ");function s(e){n.call(this,""),this._db=e,this._operations=[],this._iterators=[],l(this)}function l(t){a.forEach(function(e){t["_"+e]=function(){this._operations.push({method:e,args:arguments})}}),"function"==typeof t._db.approximateSize&&(t.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),t._iterator=function(e){e=new o(e);return this._iterators.push(e),e}}r(s,n),s.prototype._open=function(e,i){var n=this;this._db.open(e,function(e){if(e)return i(e);var t;n._operations.forEach(function(e){n._db[e.method].apply(n._db,e.args)}),n._operations=[],n._iterators.forEach(function(e){e.setDb(n._db)}),n._iterators=[],t=n,a.concat("iterator").forEach(function(e){t["_"+e]=function(){return this._db[e].apply(this._db,arguments)}}),t._db.approximateSize&&(t.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)}),i()})},s.prototype._close=function(t){var i=this;this._db.close(function(e){if(e)return t(e);l(i),t()})},s.prototype._serializeKey=function(e){return e},s.prototype._serializeValue=function(e){return e},t.exports=s,t.exports.DeferredIterator=o},{"./deferred-iterator":217,"abstract-leveldown":216,inherits:186}],219:[function(e,t,i){e=e("./_root").Symbol;t.exports=e},{"./_root":226}],220:[function(e,t,i){var n=e("./_Symbol"),r=e("./_getRawTag"),o=e("./_objectToString"),a=n?n.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(a&&a in Object(e)?r:o)(e)}},{"./_Symbol":219,"./_getRawTag":223,"./_objectToString":224}],221:[function(e,i,t){!function(t){!function(){var e="object"==typeof t&&t&&t.Object===Object&&t;i.exports=e}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],222:[function(e,t,i){e=e("./_overArg")(Object.getPrototypeOf,Object);t.exports=e},{"./_overArg":225}],223:[function(e,t,i){var e=e("./_Symbol"),n=Object.prototype,o=n.hasOwnProperty,a=n.toString,s=e?e.toStringTag:void 0;t.exports=function(e){var t=o.call(e,s),i=e[s];try{var n=!(e[s]=void 0)}catch(e){}var r=a.call(e);return n&&(t?e[s]=i:delete e[s]),r}},{"./_Symbol":219}],224:[function(e,t,i){var n=Object.prototype.toString;t.exports=function(e){return n.call(e)}},{}],225:[function(e,t,i){t.exports=function(t,i){return function(e){return t(i(e))}}},{}],226:[function(e,t,i){var e=e("./_freeGlobal"),n="object"==typeof self&&self&&self.Object===Object&&self,e=e||n||Function("return this")();t.exports=e},{"./_freeGlobal":221}],227:[function(e,t,i){t.exports=function(e){return null!=e&&"object"==typeof e}},{}],228:[function(e,t,i){var n=e("./_baseGetTag"),r=e("./_getPrototype"),o=e("./isObjectLike"),e=Function.prototype,a=Object.prototype,s=e.toString,l=a.hasOwnProperty,c=s.call(Object);t.exports=function(e){return!(!o(e)||"[object Object]"!=n(e))&&(null===(e=r(e))||"function"==typeof(e=l.call(e,"constructor")&&e.constructor)&&e instanceof e&&s.call(e)==c)}},{"./_baseGetTag":220,"./_getPrototype":222,"./isObjectLike":227}],229:[function(e,t,f){!function(h){!function(){function o(e){return void 0!==e&&""!==e}function l(e,t){return Object.hasOwnProperty.call(e,t)}function t(e,t){return Object.hasOwnProperty.call(e,t)&&t}f.compare=function(e,t){if(h.isBuffer(e)){for(var i=Math.min(e.length,t.length),n=0;n<i;n++){var r=e[n]-t[n];if(r)return r}return e.length-t.length}return e<t?-1:t<e?1:0};var n=f.lowerBoundKey=function(e){return t(e,"gt")||t(e,"gte")||t(e,"min")||(e.reverse?t(e,"end"):t(e,"start"))||void 0},a=f.lowerBound=function(e,t){var i=n(e);return i?e[i]:t},i=f.lowerBoundInclusive=function(e){return!l(e,"gt")},r=f.upperBoundInclusive=function(e){return!l(e,"lt")},s=f.lowerBoundExclusive=function(e){return!i(e)},c=f.upperBoundExclusive=function(e){return!r(e)},d=f.upperBoundKey=function(e){return t(e,"lt")||t(e,"lte")||t(e,"max")||(e.reverse?t(e,"start"):t(e,"end"))||void 0},u=f.upperBound=function(e,t){var i=d(e);return i?e[i]:t};function p(e){return e}f.start=function(e,t){return(e.reverse?u:a)(e,t)},f.end=function(e,t){return(e.reverse?a:u)(e,t)},f.startInclusive=function(e){return(e.reverse?r:i)(e)},f.endInclusive=function(e){return(e.reverse?i:r)(e)},f.toLtgt=function(e,t,i,n,r){t=t||{},i=i||p;var o=3<arguments.length,a=f.lowerBoundKey(e),s=f.upperBoundKey(e);return a?"gt"===a?t.gt=i(e.gt,!1):t.gte=i(e[a],!1):o&&(t.gte=i(n,!1)),s?"lt"===s?t.lt=i(e.lt,!0):t.lte=i(e[s],!0):o&&(t.lte=i(r,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),l(t,"max")&&delete t.max,l(t,"min")&&delete t.min,l(t,"start")&&delete t.start,l(t,"end")&&delete t.end,t},f.contains=function(e,t,i){i=i||f.compare;var n,r=a(e);return!(o(r)&&((n=i(t,r))<0||0===n&&s(e))||o(r=u(e))&&(0<(n=i(t,r))||0===n&&c(e)))},f.filter=function(t,i){return function(e){return f.contains(t,e,i)}}}.call(this)}.call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":188}],230:[function(e,b,v){!function(e){!function(){!function(e){"use strict";var d={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:f,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:f,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:f,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};function l(e){this.tokens=[],this.tokens.links={},this.options=e||g.defaults,this.rules=d.normal,this.options.gfm&&(this.options.tables?this.rules=d.tables:this.rules=d.gfm)}d._label=/(?:\\[\[\]]|[^\[\]])+/,d._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,d.def=t(d.def).replace("label",d._label).replace("title",d._title).getRegex(),d.bullet=/(?:[*+-]|\d+\.)/,d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,d.item=t(d.item,"gm").replace(/bull/g,d.bullet).getRegex(),d.list=t(d.list).replace(/bull/g,d.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+d.def.source+")").getRegex(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",d.html=t(d.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,d._tag).getRegex(),d.paragraph=t(d.paragraph).replace("hr",d.hr).replace("heading",d.heading).replace("lheading",d.lheading).replace("tag","<"+d._tag).getRegex(),d.blockquote=t(d.blockquote).replace("paragraph",d.paragraph).getRegex(),d.normal=m({},d),d.gfm=m({},d.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),d.gfm.paragraph=t(d.paragraph).replace("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|"+d.list.source.replace("\\1","\\3")+"|").getRegex(),d.tables=m({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),l.rules=d,l.lex=function(e,t){return new l(t).lex(e)},l.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},l.prototype.token=function(e,t){var i,n,r,o,a,s,l,c;for(e=e.replace(/^ +$/gm,"");e;)if((n=this.rules.newline.exec(e))&&(e=e.substring(n[0].length),1<n[0].length)&&this.tokens.push({type:"space"}),n=this.rules.code.exec(e))e=e.substring(n[0].length),n=n[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?n:n.replace(/\n+$/,"")});else if(n=this.rules.fences.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"code",lang:n[2],text:n[3]||""});else if(n=this.rules.heading.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"heading",depth:n[1].length,text:n[2]});else if(t&&(n=this.rules.nptable.exec(e))){for(e=e.substring(n[0].length),o={type:"table",header:n[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:n[3].replace(/\n$/,"").split("\n")},s=0;s<o.align.length;s++)/^ *-+: *$/.test(o.align[s])?o.align[s]="right":/^ *:-+: *$/.test(o.align[s])?o.align[s]="center":/^ *:-+ *$/.test(o.align[s])?o.align[s]="left":o.align[s]=null;for(s=0;s<o.cells.length;s++)o.cells[s]=o.cells[s].split(/ *\| */);this.tokens.push(o)}else if(n=this.rules.hr.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"hr"});else if(n=this.rules.blockquote.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"blockquote_start"}),n=n[0].replace(/^ *> ?/gm,""),this.token(n,t),this.tokens.push({type:"blockquote_end"});else if(n=this.rules.list.exec(e)){for(e=e.substring(n[0].length),c=1<(r=n[2]).length,this.tokens.push({type:"list_start",ordered:c,start:c?+r:""}),i=!1,l=(n=n[0].match(this.rules.item)).length,s=0;s<l;s++)a=(o=n[s]).length,~(o=o.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(a-=o.length,o=this.options.pedantic?o.replace(/^ {1,4}/gm,""):o.replace(new RegExp("^ {1,"+a+"}","gm"),"")),!this.options.smartLists||s===l-1||r===(a=d.bullet.exec(n[s+1])[0])||1<r.length&&1<a.length||(e=n.slice(s+1).join("\n")+e,s=l-1),a=i||/\n\n(?!\s*$)/.test(o),s!==l-1&&(i="\n"===o.charAt(o.length-1),a=a||i),this.tokens.push({type:a?"loose_item_start":"list_item_start"}),this.token(o,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(n=this.rules.html.exec(e))e=e.substring(n[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===n[1]||"script"===n[1]||"style"===n[1]),text:n[0]});else if(t&&(n=this.rules.def.exec(e)))e=e.substring(n[0].length),n[3]&&(n[3]=n[3].substring(1,n[3].length-1)),c=n[1].toLowerCase(),this.tokens.links[c]||(this.tokens.links[c]={href:n[2],title:n[3]});else if(t&&(n=this.rules.table.exec(e))){for(e=e.substring(n[0].length),o={type:"table",header:n[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:n[3].replace(/(?: *\| *)?\n$/,"").split("\n")},s=0;s<o.align.length;s++)/^ *-+: *$/.test(o.align[s])?o.align[s]="right":/^ *:-+: *$/.test(o.align[s])?o.align[s]="center":/^ *:-+ *$/.test(o.align[s])?o.align[s]="left":o.align[s]=null;for(s=0;s<o.cells.length;s++)o.cells[s]=o.cells[s].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(o)}else if(n=this.rules.lheading.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"heading",depth:"="===n[2]?1:2,text:n[1]});else if(t&&(n=this.rules.paragraph.exec(e)))e=e.substring(n[0].length),this.tokens.push({type:"paragraph",text:"\n"===n[1].charAt(n[1].length-1)?n[1].slice(0,-1):n[1]});else if(n=this.rules.text.exec(e))e=e.substring(n[0].length),this.tokens.push({type:"text",text:n[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var i={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:f,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:f,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};function n(e,t){if(this.options=t||g.defaults,this.links=e,this.rules=i.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=i.breaks:this.rules=i.gfm:this.options.pedantic&&(this.rules=i.pedantic)}function r(e){this.options=e||{}}function o(){}function c(e){this.tokens=[],this.token=null,this.options=e||g.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}function u(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function t(i,e){return i=i.source,e=e||"",{replace:function(e,t){return t=(t=t.source||t).replace(/(^|[^\[])\^/g,"$1"),i=i.replace(e,t),this},getRegex:function(){return new RegExp(i,e)}}}function a(e,t){return p[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?p[" "+e]=e+"/":p[" "+e]=e.replace(/[^/]*$/,"")),e=p[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}i._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,i._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,i.autolink=t(i.autolink).replace("scheme",i._scheme).replace("email",i._email).getRegex(),i._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,i._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,i.link=t(i.link).replace("inside",i._inside).replace("href",i._href).getRegex(),i.reflink=t(i.reflink).replace("inside",i._inside).getRegex(),i.normal=m({},i),i.pedantic=m({},i.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),i.gfm=m({},i.normal,{escape:t(i.escape).replace("])","~|])").getRegex(),url:t(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",i._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:t(i.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),i.breaks=m({},i.gfm,{br:t(i.br).replace("{2,}","*").getRegex(),text:t(i.gfm.text).replace("{2,}","*").getRegex()}),n.rules=i,n.output=function(e,t,i){return new n(t,i).output(e)},n.prototype.output=function(e){for(var t,i,n,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),n="@"===r[2]?"mailto:"+(i=u(this.mangle(r[1]))):i=u(r[1]),o+=this.renderer.link(n,null,i);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):u(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if(r=(r=this.rules.reflink.exec(e))||this.rules.nolink.exec(e)){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(u(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=this.renderer.text(u(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else r[0]=this.rules._backpedal.exec(r[0])[0],e=e.substring(r[0].length),n="@"===r[2]?"mailto:"+(i=u(r[0])):(i=u(r[0]),"www."===r[1]?"http://"+i:i),o+=this.renderer.link(n,null,i);return o},n.prototype.outputLink=function(e,t){var i=u(t.href),t=t.title?u(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(i,t,this.output(e[1])):this.renderer.image(i,t,u(e[1]))},n.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},n.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,i="",n=e.length,r=0;r<n;r++)t=e.charCodeAt(r),i+="&#"+(t=.5<Math.random()?"x"+t.toString(16):t)+";";return i},r.prototype.code=function(e,t,i){var n;return this.options.highlight&&null!=(n=this.options.highlight(e,t))&&n!==e&&(i=!0,e=n),t?'<pre><code class="'+this.options.langPrefix+u(t,!0)+'">'+(i?e:u(e,!0))+"\n</code></pre>\n":"<pre><code>"+(i?e:u(e,!0))+"\n</code></pre>"},r.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},r.prototype.html=function(e){return e},r.prototype.heading=function(e,t,i){return"<h"+t+' id="'+this.options.headerPrefix+i.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(e,t,i){var n=t?"ol":"ul";return"<"+n+(t&&1!==i?' start="'+i+'"':"")+">\n"+e+"</"+n+">\n"},r.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},r.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},r.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},r.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},r.prototype.tablecell=function(e,t){var i=t.header?"th":"td";return(t.align?"<"+i+' style="text-align:'+t.align+'">':"<"+i+">")+e+"</"+i+">\n"},r.prototype.strong=function(e){return"<strong>"+e+"</strong>"},r.prototype.em=function(e){return"<em>"+e+"</em>"},r.prototype.codespan=function(e){return"<code>"+e+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(e){return"<del>"+e+"</del>"},r.prototype.link=function(e,t,i){if(this.options.sanitize){try{var n=decodeURIComponent(s(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return i}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return i}n='<a href="'+(e=this.options.baseUrl&&!h.test(e)?a(this.options.baseUrl,e):e)+'"';return t&&(n+=' title="'+t+'"'),n+">"+i+"</a>"},r.prototype.image=function(e,t,i){e='<img src="'+(e=this.options.baseUrl&&!h.test(e)?a(this.options.baseUrl,e):e)+'" alt="'+i+'"';return t&&(e+=' title="'+t+'"'),e+(this.options.xhtml?"/>":">")},r.prototype.text=function(e){return e},o.prototype.strong=o.prototype.em=o.prototype.codespan=o.prototype.del=o.prototype.text=function(e){return e},o.prototype.link=o.prototype.image=function(e,t,i){return""+i},o.prototype.br=function(){return""},c.parse=function(e,t){return new c(t).parse(e)},c.prototype.parse=function(e){this.inline=new n(e.links,this.options),this.inlineText=new n(e.links,m({},this.options,{renderer:new o})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,s(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":for(var e,t,i="",n="",r="",o=0;o<this.token.header.length;o++)r+=this.renderer.tablecell(this.inline.output(this.token.header[o]),{header:!0,align:this.token.align[o]});for(i+=this.renderer.tablerow(r),o=0;o<this.token.cells.length;o++){for(e=this.token.cells[o],r="",t=0;t<e.length;t++)r+=this.renderer.tablecell(this.inline.output(e[t]),{header:!1,align:this.token.align[t]});n+=this.renderer.tablerow(r)}return this.renderer.table(i,n);case"blockquote_start":for(n="";"blockquote_end"!==this.next().type;)n+=this.tok();return this.renderer.blockquote(n);case"list_start":for(var n="",i=this.token.ordered,a=this.token.start;"list_end"!==this.next().type;)n+=this.tok();return this.renderer.list(n,i,a);case"list_item_start":for(n="";"list_item_end"!==this.next().type;)n+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(n);case"loose_item_start":for(n="";"list_item_end"!==this.next().type;)n+=this.tok();return this.renderer.listitem(n);case"html":i=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(i);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var p={},h=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function f(){}function m(e){for(var t,i,n=1;n<arguments.length;n++)for(i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}function g(e,i,n){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(n||"function"==typeof i){n||(n=i,i=null);var r,o=(i=m({},g.defaults,i||{})).highlight,t=0;try{r=l.lex(e,i)}catch(e){return n(e)}var a=r.length,s=function(t){if(t)return i.highlight=o,n(t);var e;try{e=c.parse(r,i)}catch(e){t=e}return i.highlight=o,t?n(t):n(null,e)};if(!o||o.length<3)return s();if(delete i.highlight,!a)return s();for(;t<r.length;t++)!function(i){"code"!==i.type?--a||s():o(i.text,i.lang,function(e,t){return e?s(e):null==t||t===i.text?--a||s():(i.text=t,i.escaped=!0,void(--a||s()))})}(r[t])}else try{return i=i&&m({},g.defaults,i),c.parse(l.lex(e,i),i)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(i||g.defaults).silent)return"<p>An error occurred:</p><pre>"+u(e.message+"",!0)+"</pre>";throw e}}f.exec=f,g.options=g.setOptions=function(e){return m(g.defaults,e),g},g.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new r,xhtml:!1,baseUrl:null},g.Parser=c,g.parser=c.parse,g.Renderer=r,g.TextRenderer=o,g.Lexer=l,g.lexer=l.lex,g.InlineLexer=n,g.inlineLexer=n.output,g.parse=g,void 0!==b&&"object"==typeof v?b.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):e.marked=g}(this||("undefined"!=typeof window?window:e))}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],231:[function(e,t,i){t.exports=e("immediate")},{immediate:238}],232:[function(f,m,e){!function(h){!function(){var e=f("inherits"),t=f("abstract-leveldown").AbstractLevelDOWN,i=f("abstract-leveldown").AbstractIterator,n=f("ltgt"),r=f("functional-red-black-tree"),o={},c=f("./immediate");function a(e){return 0<n.compare(e,this._end)}function s(e){return 0<=n.compare(e,this._end)}function l(e){return n.compare(e,this._end)<0}function d(e){return n.compare(e,this._end)<=0}function u(e,t){i.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);e=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=n.upperBound(t),this._end=n.lowerBound(t),void 0===this._start?this._tree=e.end:n.upperBoundInclusive(t)?this._tree=e.le(this._start):this._tree=e.lt(this._start),this._end&&(n.lowerBoundInclusive(t)?this._test=s:this._test=a)):(this._incr="next",this._start=n.lowerBound(t),this._end=n.upperBound(t),void 0===this._start?this._tree=e.begin:n.lowerBoundInclusive(t)?this._tree=e.ge(this._start):this._tree=e.gt(this._start),this._end&&(n.upperBoundInclusive(t)?this._test=d:this._test=l))}function p(e){if(!(this instanceof p))return new p(e);t.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?o:this,this._store[this._location]=this._store[this._location]||r(n.compare)}e(u,i),u.prototype._next=function(e){var t,i;return!(this._done++>=this._limit)&&this._tree.valid&&(t=this._tree.key,i=this._tree.value,this._test(t))?(this.keyAsBuffer&&(t=new h(t)),this.valueAsBuffer&&(i=new h(i)),this._tree[this._incr](),void c(function(){e(null,t,i)})):c(e)},u.prototype._test=function(){return!0},p.clearGlobalStore=function(e){e?Object.keys(o).forEach(function(e){delete o[e]}):o={}},e(p,t),p.prototype._open=function(e,t){var i=this;c(function(){t(null,i)})},p.prototype._put=function(e,t,i,n){null==t&&(t="");var r=this._store[this._location].find(e);r.valid?this._store[this._location]=r.update(t):this._store[this._location]=this._store[this._location].insert(e,t),c(n)},p.prototype._get=function(e,t,i){var n=this._store[this._location].get(e);if(void 0===n)return c(function(){i(new Error("NotFound"))});!1===t.asBuffer||this._isBuffer(n)||(n=new h(String(n))),c(function(){i(null,n)})},p.prototype._del=function(e,t,i){this._store[this._location]=this._store[this._location].remove(e),c(i)},p.prototype._batch=function(e,t,i){for(var n,r,o,a=-1,s=e.length,l=this._store[this._location];++a<s;)e[a]&&(n=this._isBuffer(e[a].key)?e[a].key:String(e[a].key),o=l.find(n),l="put"===e[a].type?(r=this._isBuffer(e[a].value)?e[a].value:String(e[a].value),o.valid?o.update(r):l.insert(n,r)):o.remove());this._store[this._location]=l,c(i)},p.prototype._iterator=function(e){return new u(this,e)},p.prototype._isBuffer=function(e){return h.isBuffer(e)},p.destroy=function(e,t){e="$"+e;e in o&&delete o[e],c(t)},m.exports=p}.call(this)}.call(this,f("buffer").Buffer)},{"./immediate":231,"abstract-leveldown":236,buffer:153,"functional-red-black-tree":182,inherits:186,ltgt:244}],233:[function(e,t,i){!function(i){!function(){function e(e){this._db=e,this._operations=[],this._written=!1}e.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},e.prototype.put=function(e,t){this._checkWritten();var i=this._db._checkKey(e,"key",this._db._isBuffer);if(i)throw i;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},e.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},e.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},e.prototype.write=function(e,t){if(this._checkWritten(),"function"!=typeof(t="function"==typeof e?e:t))throw new Error("write() requires a callback argument");return"object"!=typeof e&&(e={}),this._written=!0,"function"==typeof this._write?this._write(t):"function"==typeof this._db._batch?this._db._batch(this._operations,e,t):void i.nextTick(t)},t.exports=e}.call(this)}.call(this,e("_process"))},{_process:270}],234:[function(e,t,i){!function(i){!function(){function e(e){this.db=e,this._ended=!1,this._nexting=!1}e.prototype.next=function(e){var t=this;if("function"!=typeof e)throw new Error("next() requires a callback argument");return t._ended?e(new Error("cannot call next() after end()")):t._nexting?e(new Error("cannot call next() before previous next() has completed")):(t._nexting=!0,"function"==typeof t._next?t._next(function(){t._nexting=!1,e.apply(null,arguments)}):void i.nextTick(function(){t._nexting=!1,e()}))},e.prototype.end=function(e){if("function"!=typeof e)throw new Error("end() requires a callback argument");return this._ended?e(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(e):void i.nextTick(e))},t.exports=e}.call(this)}.call(this,e("_process"))},{_process:270}],235:[function(o,a,e){!function(r,s){!function(){var e=o("xtend"),t=o("./abstract-iterator"),i=o("./abstract-chained-batch");function n(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}n.prototype.open=function(e,t){var i=this,n=this.status;if("function"!=typeof(t="function"==typeof e?e:t))throw new Error("open() requires a callback argument");(e="object"!=typeof e?{}:e).createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,function(e){if(e)return i.status=n,t(e);i.status="open",t()})):(this.status="open",s.nextTick(t))},n.prototype.close=function(t){var i=this,n=this.status;if("function"!=typeof t)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close(function(e){if(e)return i.status=n,t(e);i.status="closed",t()})):(this.status="closed",s.nextTick(t))},n.prototype.get=function(e,t,i){var n;if("function"!=typeof(i="function"==typeof t?t:i))throw new Error("get() requires a callback argument");return(n=this._checkKey(e,"key",this._isBuffer))?i(n):(this._isBuffer(e)||(e=String(e)),(t="object"!=typeof t?{}:t).asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,i):void s.nextTick(function(){i(new Error("NotFound"))}))},n.prototype.put=function(e,t,i,n){var r;if("function"!=typeof(n="function"==typeof i?i:n))throw new Error("put() requires a callback argument");return(r=this._checkKey(e,"key",this._isBuffer))?n(r):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||s.browser||(t=String(t)),"object"!=typeof i&&(i={}),"function"==typeof this._put?this._put(e,t,i,n):void s.nextTick(n))},n.prototype.del=function(e,t,i){var n;if("function"!=typeof(i="function"==typeof t?t:i))throw new Error("del() requires a callback argument");return(n=this._checkKey(e,"key",this._isBuffer))?i(n):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,i):void s.nextTick(i))},n.prototype.batch=function(e,t,i){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(i=t),"function"!=typeof(i="function"==typeof e?e:i))throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return i(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var n,r,o=0,a=e.length;o<a;o++)if("object"==typeof(n=e[o])){if(r=this._checkKey(n.type,"type",this._isBuffer))return i(r);if(r=this._checkKey(n.key,"key",this._isBuffer))return i(r)}if("function"==typeof this._batch)return this._batch(e,t,i);s.nextTick(i)},n.prototype.approximateSize=function(e,t,i){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof i)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,i);s.nextTick(function(){i(null,0)})},n.prototype._setupIteratorOptions=function(t){var i=this;return t=e(t),["start","end","gt","gte","lt","lte"].forEach(function(e){t[e]&&i._isBuffer(t[e])&&0===t[e].length&&delete t[e]}),t.reverse=!!t.reverse,t.keys=0!=t.keys,t.values=0!=t.values,t.limit="limit"in t?t.limit:-1,t.keyAsBuffer=0!=t.keyAsBuffer,t.valueAsBuffer=0!=t.valueAsBuffer,t},n.prototype.iterator=function(e){return e=this._setupIteratorOptions(e="object"!=typeof e?{}:e),"function"==typeof this._iterator?this._iterator(e):new t(this)},n.prototype._chainedBatch=function(){return new i(this)},n.prototype._isBuffer=function(e){return r.isBuffer(e)},n.prototype._checkKey=function(e,t){if(null==e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},a.exports=n}.call(this)}.call(this,{isBuffer:o("../../../is-buffer/index.js")},o("_process"))},{"../../../is-buffer/index.js":188,"./abstract-chained-batch":233,"./abstract-iterator":234,_process:270,xtend:384}],236:[function(e,t,i){i.AbstractLevelDOWN=e("./abstract-leveldown"),i.AbstractIterator=e("./abstract-iterator"),i.AbstractChainedBatch=e("./abstract-chained-batch"),i.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":233,"./abstract-iterator":234,"./abstract-leveldown":235,"./is-leveldown":237}],237:[function(e,t,i){var n=e("./abstract-leveldown");t.exports=function(t){return!(!t||"object"!=typeof t)&&Object.keys(n.prototype).filter(function(e){return"_"!=e[0]&&"approximateSize"!=e}).every(function(e){return"function"==typeof t[e]})}},{"./abstract-leveldown":235}],238:[function(e,t,i){"use strict";var n,r,o,a=[e("./nextTick"),e("./queueMicrotask"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],s=-1,l=[],c=!1;function d(){n&&r&&(n=!1,r.length?l=r.concat(l):s=-1,l.length)&&u()}function u(){if(!n){n=!(c=!1);for(var e=l.length,t=setTimeout(d);e;){for(r=l,l=[];r&&++s<e;)r[s].run();s=-1,e=l.length}r=null,n=!(s=-1),clearTimeout(t)}}for(var p=-1,h=a.length;++p<h;)if(a[p]&&a[p].test&&a[p].test()){o=a[p].install(u);break}function f(e,t){this.fun=e,this.array=t}f.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new f(e,t)),c||n||(c=!0,o())}},{"./messageChannel":239,"./mutation.js":240,"./nextTick":152,"./queueMicrotask":241,"./stateChange":242,"./timeout":243}],239:[function(e,t,n){!function(i){!function(){"use strict";n.test=function(){return!i.setImmediate&&void 0!==i.MessageChannel},n.install=function(e){var t=new i.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],240:[function(e,t,i){!function(r){!function(){"use strict";var n=r.MutationObserver||r.WebKitMutationObserver;i.test=function(){return n},i.install=function(e){var t=0,e=new n(e),i=r.document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],241:[function(e,t,i){!function(t){!function(){"use strict";i.test=function(){return"function"==typeof t.queueMicrotask},i.install=function(e){return function(){t.queueMicrotask(e)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],242:[function(e,t,n){!function(i){!function(){"use strict";n.test=function(){return"document"in i&&"onreadystatechange"in i.document.createElement("script")},n.install=function(t){return function(){var e=i.document.createElement("script");return e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},i.document.documentElement.appendChild(e),t}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],243:[function(e,t,i){"use strict";i.test=function(){return!0},i.install=function(e){return function(){setTimeout(e,0)}}},{}],244:[function(e,t,f){!function(h){!function(){function l(e,t){return Object.hasOwnProperty.call(e,t)}function o(e){return void 0!==e&&""!==e}function l(e,t){return Object.hasOwnProperty.call(e,t)}function t(e,t){return Object.hasOwnProperty.call(e,t)&&t}f.compare=function(e,t){if(h.isBuffer(e)){for(var i=Math.min(e.length,t.length),n=0;n<i;n++){var r=e[n]-t[n];if(r)return r}return e.length-t.length}return e<t?-1:t<e?1:0};var i=f.lowerBoundKey=function(e){return t(e,"gt")||t(e,"gte")||t(e,"min")||(e.reverse?t(e,"end"):t(e,"start"))||void 0},a=f.lowerBound=function(e){var t=i(e);return t&&e[t]},n=f.lowerBoundInclusive=function(e){return!l(e,"gt")},r=f.upperBoundInclusive=function(e){return!l(e,"lt")},s=f.lowerBoundExclusive=function(e){return!n(e)},c=f.upperBoundExclusive=function(e){return!r(e)},d=f.upperBoundKey=function(e){return t(e,"lt")||t(e,"lte")||t(e,"max")||(e.reverse?t(e,"start"):t(e,"end"))||void 0},u=f.upperBound=function(e){var t=d(e);return t&&e[t]};function p(e){return e}f.toLtgt=function(e,t,i,n,r){t=t||{},i=i||p;var o=3<arguments.length,a=f.lowerBoundKey(e),s=f.upperBoundKey(e);return a?"gt"===a?t.gt=i(e.gt,!1):t.gte=i(e[a],!1):o&&(t.gte=i(n,!1)),s?"lt"===s?t.lt=i(e.lt,!0):t.lte=i(e[s],!0):o&&(t.lte=i(r,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),l(t,"max")&&delete t.max,l(t,"min")&&delete t.min,l(t,"start")&&delete t.start,l(t,"end")&&delete t.end,t},f.contains=function(e,t,i){i=i||f.compare;var n,r=a(e);return!(o(r)&&((n=i(t,r))<0||0===n&&s(e))||o(r=u(e))&&(0<(n=i(t,r))||0===n&&c(e)))},f.filter=function(t,i){return function(e){return f.contains(t,e,i)}}}.call(this)}.call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":188}],245:[function(e,t,i){"use strict";var l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(Object.assign){var e=new String("abc");if(e[5]="de","5"!==Object.getOwnPropertyNames(e)[0]){for(var t,i={},n=0;n<10;n++)i["_"+String.fromCharCode(n)]=n;if("0123456789"===Object.getOwnPropertyNames(i).map(function(e){return i[e]}).join(""))return t={},"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},t)).join("")}}}catch(e){}}()?Object.assign:function(e,t){for(var i,n=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),r=1;r<arguments.length;r++){for(var o in i=Object(arguments[r]))c.call(i,o)&&(n[o]=i[o]);if(l)for(var a=l(i),s=0;s<a.length;s++)d.call(i,a[s])&&(n[a[s]]=i[a[s]])}return n}},{}],246:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var h=n(e("levelup")),m=n(e("sublevel-pouchdb")),v=e("through2"),g=n(e("argsarray")),y=n(e("double-ended-queue")),I=n(e("buffer-from")),O=e("pouchdb-adapter-utils"),P=e("pouchdb-merge"),r=e("pouchdb-json"),D=e("pouchdb-md5"),L=e("pouchdb-binary-utils"),R=e("pouchdb-collections"),M=e("pouchdb-utils"),B=e("pouchdb-errors");function w(e,t){e=new Uint8Array(e);return L.blob([e],{type:t})}function o(e,t){var t=t.prefix()[0],e=e._cache,i=e.get(t);return i||(i=new R.Map,e.set(t,i)),i}function j(){this._batch=[],this._cache=new R.Map}j.prototype.get=function(e,i,n){var r=o(this,e),t=r.get(i);return t?M.nextTick(function(){n(null,t)}):null===t?M.nextTick(function(){n({name:"NotFoundError"})}):void e.get(i,function(e,t){if(e)return"NotFoundError"===e.name&&r.set(i,null),n(e);r.set(i,t),n(null,t)})},j.prototype.batch=function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],r=o(this,n.prefix);"put"===n.type?r.set(n.key,n.value):r.set(n.key,null)}this._batch=this._batch.concat(e)},j.prototype.execute=function(e,t){for(var i=new R.Set,n=[],r=this._batch.length-1;0<=r;r--){var o=this._batch[r],a=o.prefix.prefix()[0]+"ÿ"+o.key;i.has(a)||(i.add(a),n.push(o))}e.batch(n,t)};var k=new R.Map,F="_local_last_update_seq",U="_local_doc_count",x="_local_uuid",E={encode:r.safeJsonStringify,decode:r.safeJsonParse,buffer:!1,type:"cheap-json"},H=new M.changesHandler;function C(e){return"winningRev"in e?e.winningRev:P.winningRev(e)}function _(e,t){return"deleted"in e?e.deleted:O.isDeleted(e,t)}function q(e,i,n){var r=[];return e.forEach(function(t){t.doc&&t.doc._attachments&&Object.keys(t.doc._attachments).forEach(function(e){e=t.doc._attachments[e];"data"in e||r.push(e)})}),Promise.all(r.map(function(e){return t=i,a=n,s=(o=e).content_type,new Promise(function(n,r){t.binaryStore.get(o.digest,function(e,t){var i;if(e){if("NotFoundError"!==e.name)return r(e);i=a.binary?L.binaryStringToBlobOrBuffer("",s):""}else i=a.binary?w(t,s):t.toString("base64");delete o.stub,delete o.length,o.data=i,n()})});var o,t,a,s}))}t.exports=function(t,i){t=M.clone(t);var n,b,S=this,T={},f=t.revs_limit,A=t.name;void 0===t.createIfMissing&&(t.createIfMissing=!0);var r,o=t.db,e=M.functionName(o);function a(){T.docStore=b.sublevel("document-store",{valueEncoding:E}),T.bySeqStore=b.sublevel("by-sequence",{valueEncoding:"json"}),T.attachmentStore=b.sublevel("attach-store",{valueEncoding:"json"}),T.binaryStore=b.sublevel("attach-binary-store",{valueEncoding:"binary"}),T.localStore=b.sublevel("local-store",{valueEncoding:"json"}),T.metaStore=b.sublevel("meta-store",{valueEncoding:"json"}),"object"==typeof t.migrate?t.migrate.doMigrationTwo(b,T,s):s()}function s(){T.metaStore.get(F,function(e,t){void 0===b._updateSeq&&(b._updateSeq=t||0),T.metaStore.get(U,function(e,t){b._docCount=e?0:t,T.metaStore.get(x,function(e,t){n=e?M.uuid():t,T.metaStore.put(x,n,function(){M.nextTick(function(){i(null,S)})})})})})}function l(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function c(){var e,t,i=b._queue.peekFront();if("read"===i.type){for(var n=[i],r=1,o=b._queue.get(r);void 0!==o&&"read"===o.type;)n.push(o),o=b._queue.get(++r);var a=0;n.forEach(function(e){var t=e.args,i=t[t.length-1];t[t.length-1]=g(function(e){i.apply(null,e),++a===n.length&&M.nextTick(function(){n.forEach(function(){b._queue.shift()}),b._queue.length&&c()})}),l(e.fun,t)})}else e=(i=i).args,t=e[e.length-1],e[e.length-1]=g(function(e){t.apply(null,e),M.nextTick(function(){b._queue.shift(),b._queue.length&&c()})}),l(i.fun,e)}function d(t){return g(function(e){b._queue.push({fun:t,args:e,type:"write"}),1===b._queue.length&&M.nextTick(c)})}function u(t){return g(function(e){b._queue.push({fun:t,args:e,type:"read"}),1===b._queue.length&&M.nextTick(c)})}function N(e){return("0000000000000000"+e).slice(-16)}function p(e,t){"destroy"in o?o.destroy(e,t):t(null)}k.has(e)?r=k.get(e):(r=new R.Map,k.set(e,r)),r.has(A)?(b=r.get(A),a()):r.set(A,m(h(o(A),t,function(e){if(e)return r.delete(A),i(e);(b=r.get(A))._docCount=-1,b._queue=new y,"object"==typeof t.migrate?t.migrate.doMigrationOne(A,b,a):a()}))),S._remote=!1,S.type=function(){return"leveldb"},S._id=function(e){e(null,n)},S._info=function(e){var t={doc_count:b._docCount,update_seq:b._updateSeq,backend_adapter:M.functionName(o)};return M.nextTick(function(){e(null,t)})},S._get=u(function(e,t,r){t=M.clone(t),T.docStore.get(e,function(e,i){if(e||!i)return r(B.createError(B.MISSING_DOC,"missing"));var n;if(t.rev)n=t.latest?P.latest(t.rev,i):t.rev;else if(n=C(i),_(i,n))return r(B.createError(B.MISSING_DOC,"deleted"));e=i.rev_map[n];T.bySeqStore.get(N(e),function(e,t){if(!t)return r(B.createError(B.MISSING_DOC));if("_id"in t&&t._id!==i.id)return r(new Error("wrong doc returned"));if(t._id=i.id,"_rev"in t){if(t._rev!==n)return r(new Error("wrong doc returned"))}else t._rev=n;return r(null,{doc:t,metadata:i})})})}),S._getAttachment=function(e,t,i,n,r){var o=i.digest,a=i.content_type;T.binaryStore.get(o,function(e,t){if(e)return"NotFoundError"!==e.name?r(e):r(null,n.binary?L.blob([""],{type:a}):"");n.binary?r(null,w(t,a)):r(null,t.toString("base64"))})},S._bulkDocs=d(function(e,i,v){var a,n,r,o,s,t=i.new_edits,y=new Array(e.docs.length),w=new R.Map,k=new R.Map,x=new j,E=0,C=b._updateSeq,l=e.docs,c=l.map(function(e){return e._id&&O.isLocalId(e._id)||(e=O.parseDoc(e,t,S.__opts)).metadata&&!e.metadata.rev_map&&(e.metadata.rev_map={}),e}),e=c.filter(function(e){return e.error});return e.length?v(e[0]):(a={},c.length?(n=function(e){if(e)return v(e);function n(){if(++t===l.length){var e=r;if(e)return v(e);O.processDocs(f,c,S,w,x,y,p,i,u)}}var r,t;t=0,l.forEach(function(i){if(i._id&&O.isLocalId(i._id))return n();x.get(T.docStore,i._id,function(e,t){e?"NotFoundError"!==e.name&&(r=e):w.set(i._id,t),n()})})},s=[],l.forEach(function(t){t&&t._attachments&&Object.keys(t._attachments).forEach(function(e){e=t._attachments[e];e.stub&&s.push(e.digest)})}),void(s.length?(o=0,s.forEach(function(e){var t,i;t=e,i=function(e){e&&!r&&(r=e),++o===s.length&&n(r)},x.get(T.attachmentStore,t,function(e){e?(e=B.createError(B.MISSING_STUB,"unknown stub attachment with digest "+t),i(e)):i()})})):n())):v(null,[]));function d(e,t){var i=Promise.resolve();e.forEach(function(e,n){i=i.then(function(){return new Promise(function(t,i){S._doCompactionNoLock(n,e,{ctx:x},function(e){if(e)return i(e);t()})})})}),i.then(function(){t()},t)}function u(){d(k,function(e){var i;e&&h(e),S.auto_compaction?(e=h,i=new R.Map,w.forEach(function(e,t){i.set(t,P.compactTree(e))}),d(i,e)):h()})}function p(t,e,i,n,r,o,a,s){E+=o;var l=null,c=0,d=(t.metadata.winningRev=e,t.metadata.deleted=i,t.data._id=t.metadata.id,t.data._rev=t.metadata.rev,n&&(t.data._deleted=!0),t.stemmedRevs.length&&k.set(t.metadata.id,t.stemmedRevs),t.data._attachments?Object.keys(t.data._attachments):[]);function u(e){c++,l||(e?s(l=e):c===d.length&&b())}function p(t,i,n){return function(e){var a,s,l,c;D.binaryMd5(e,(a=t,s=i,l=e,c=n,function(e){var i,n,r,t,o;i="md5-"+e,n=l,r=c,delete(t=(e=a).data._attachments[s]).data,t.digest=i,t.length=n.length,o=e.metadata.id,e=e.metadata.rev,t.revpos=parseInt(e,10),_(o,e,i,function(e,t){return!e&&0!==n.length&&t?(x.batch([{type:"put",prefix:T.binaryStore,key:i,value:I(n,"binary")}]),void r()):r(e)})}))}}for(var h=0;h<d.length;h++){var f,m=d[h],g=t.data._attachments[m];if(g.stub)_(t.data._id,t.data._rev,g.digest,u);else if("string"==typeof g.data){try{f=L.atob(g.data)}catch(t){return void v(B.createError(B.BAD_ARG,"Attachment is not a valid base64 string"))}p(t,m,u)(f)}else g=g.data,m=p(t,m,u),L.readAsBinaryString(g,m)}function b(){if(t.metadata.rev_map[t.metadata.rev])return s();var e=++C,e=[{key:N(t.metadata.rev_map[t.metadata.rev]=t.metadata.seq=e),value:t.data,prefix:T.bySeqStore,type:"put"},{key:t.metadata.id,value:t.metadata,prefix:T.docStore,type:"put"}];x.batch(e),y[a]={ok:!0,id:t.metadata.id,rev:t.metadata.rev},w.set(t.metadata.id,t.metadata),s()}d.length||b()}function _(n,r,o,t){function e(t){var e=[n,r].join("@"),i={};return t?t.refs&&(i.refs=t.refs,i.refs[e]=!0):(i.refs={},i.refs[e]=!0),new Promise(function(e){x.batch([{type:"put",prefix:T.attachmentStore,key:o,value:i}]),e(!t)})}var i=a[o]||Promise.resolve();a[o]=i.then(function(){return new Promise(function(i,n){x.get(T.attachmentStore,o,function(e,t){if(e&&"NotFoundError"!==e.name)return n(e);i(t)})}).then(e).then(function(e){t(null,e)},t)})}function h(e){if(e)return M.nextTick(function(){v(e)});x.batch([{prefix:T.metaStore,type:"put",key:F,value:C},{prefix:T.metaStore,type:"put",key:U,value:b._docCount+E}]),x.execute(b,function(e){if(e)return v(e);b._docCount+=E,b._updateSeq=C,H.notify(A),M.nextTick(function(){v(null,y)})})}}),S._allDocs=function(e,t){return"keys"in e?O.allDocsKeysQuery(this,e):u(function(u,r){var e;u=M.clone(u),e=function(e,t){var s,l,i,c,d,n;return e?r(e):(e={},l=u.skip||0,u.startkey&&(e.gte=u.startkey),u.endkey&&(e.lte=u.endkey),u.key&&(e.gte=e.lte=u.key),u.descending&&(e.reverse=!0,i=e.lte,e.lte=e.gte,e.gte=i),0===(s="number"==typeof u.limit?u.limit:s)||"gte"in e&&"lte"in e&&e.lte<e.gte?(i={total_rows:t,offset:u.skip,rows:[]},u.update_seq&&(i.update_seq=b._updateSeq),r(null,i)):(c=[],d=T.docStore.readStream(e),n=v.obj(function(e,t,n){var r=e.value,o=C(r),a=_(r,o);if(a){if("ok"!==u.deleted)return void n()}else{if(0<l--)return void n();if("number"==typeof s&&s--<=0)return d.unpipe(),d.destroy(),void n()}function i(e){var t,i={id:r.id,key:r.id,value:{rev:o}};if(u.include_docs)for(t in i.doc=e,i.doc._rev=i.value.rev,u.conflicts&&(e=P.collectConflicts(r)).length&&(i.doc._conflicts=e),i.doc._attachments)i.doc._attachments.hasOwnProperty(t)&&(i.doc._attachments[t].stub=!0);if(!1===u.inclusive_end&&r.id===u.endkey)return n();if(a){if("ok"!==u.deleted)return n();i.value.deleted=!0,i.doc=null}c.push(i),n()}u.include_docs?(e=r.rev_map[o],T.bySeqStore.get(N(e),function(e,t){i(t)})):i()},function(e){Promise.resolve().then(function(){if(u.include_docs&&u.attachments)return q(c,T,u)}).then(function(){var e={total_rows:t,offset:u.skip,rows:c};u.update_seq&&(e.update_seq=b._updateSeq),r(null,e)},r),e()}).on("unpipe",function(){n.end()}),d.on("error",r),void d.pipe(n)))},b.isClosed()?e(new Error("database is closed")):e(null,b._docCount)})(e,t)},S._changes=function(s){var e,l,c,d,u,p,t,h,f,m,i,n;return(s=M.clone(s)).continuous?(e=A+":"+M.uuid(),H.addListener(A,e,S,s),H.notify(A),{cancel:function(){H.removeListener(A,e)}}):(c=s.descending,d=[],u=s.since||0,p=0,t={reverse:c},"limit"in s&&0<s.limit&&(l=s.limit),t.reverse||(t.start=N(s.since||0)),h=s.doc_ids&&new R.Set(s.doc_ids),f=M.filterChange(s),m=new R.Map,i=T.bySeqStore.readStream(t),n=v.obj(function(e,t,r){var i,o,a;return l&&l<=p?(g(),r()):s.cancelled||s.done||(i=e.key,o=parseInt(i,10),a=e.value,o===s.since&&!c)||h&&!h.has(a._id)?r():(i=m.get(a._id))?n(i):void T.docStore.get(a._id,function(e,t){if(s.cancelled||s.done||b.isClosed()||O.isLocalId(t.id))return r();m.set(a._id,t),n(t)});function n(i){var e=C(i);function n(e){var t=s.processChange(e,i,s),e=(t.seq=i.seq,f(t));if("object"==typeof e)return s.complete(e);e&&(p++,s.attachments&&s.include_docs?q([t],T,s).then(function(){s.onChange(t)}):s.onChange(t),s.return_docs)&&d.push(t),r()}return i.seq!==o?r():(u=o,e===a._rev?n(a):(e=i.rev_map[e],void T.bySeqStore.get(N(e),function(e,t){n(t)})))}},function(e){if(s.cancelled)return e();s.return_docs&&s.limit&&s.limit<d.length&&(d.length=s.limit),e()}).on("unpipe",function(){n.end(),g()}),i.pipe(n),{cancel:function(){s.cancelled=!0,g()}});function g(){s.done=!0,s.return_docs&&s.limit&&s.limit<d.length&&(d.length=s.limit),i.unpipe(n),i.destroy(),s.continuous||s.cancelled||(s.include_docs&&s.attachments&&s.return_docs?q(d,T,s).then(function(){s.complete(null,{results:d,last_seq:u})}):s.complete(null,{results:d,last_seq:u}))}},S._close=function(t){if(b.isClosed())return t(B.createError(B.NOT_OPEN));b.close(function(e){e?t(e):(r.delete(A),t())})},S._getRevisionTree=function(e,i){T.docStore.get(e,function(e,t){e?i(B.createError(B.MISSING_DOC)):i(null,t.rev_tree)})},S._doCompaction=d(function(e,t,i,n){S._doCompactionNoLock(e,t,i,n)}),S._doCompactionNoLock=function(u,p,t,h){if("function"==typeof t&&(h=t,t={}),!p.length)return h();var f=t.ctx||new j;f.get(T.docStore,u,function(e,i){if(e)return h(e);var e=p.map(function(e){var t=i.rev_map[e];return delete i.rev_map[e],t}),a=(P.traverseRevTree(i.rev_tree,function(e,t,i,n,r){-1!==p.indexOf(t+"-"+i)&&(r.status="missing")}),[]);a.push({key:i.id,value:i,type:"put",prefix:T.docStore});var s,l={},c=0;function n(e){if(e&&(s=e),++c===p.length){if(s)return h(s);(n=Object.keys(l)).length?(i=0,o=new R.Map,p.forEach(function(e){o.set(u+"@"+e,!0)}),n.forEach(function(n){f.get(T.attachmentStore,n,function(e,t){if(e)return"NotFoundError"===e.name?r():r(e);var e=Object.keys(t.refs||{}).filter(function(e){return!o.has(e)}),i={};e.forEach(function(e){i[e]=!0}),e.length?a.push({key:n,type:"put",value:{refs:i},prefix:T.attachmentStore}):a=a.concat([{key:n,type:"del",prefix:T.attachmentStore},{key:n,type:"del",prefix:T.binaryStore}]),r()})})):d()}function r(e){e&&(t=e),++i===n.length&&d(t)}var t,i,o,n}function d(e){return e?h(e):(f.batch(a),t.ctx?h():void f.execute(b,h))}e.forEach(function(e){a.push({key:N(e),type:"del",prefix:T.bySeqStore}),f.get(T.bySeqStore,N(e),function(e,t){if(e)return"NotFoundError"===e.name?n():n(e);Object.keys(t._attachments||{}).forEach(function(e){e=t._attachments[e].digest;l[e]=!0}),n()})})})},S._getLocal=function(e,i){T.localStore.get(e,function(e,t){e?i(B.createError(B.MISSING_DOC)):i(null,t)})},S._putLocal=function(e,t,i){"function"==typeof t&&(i=t,t={}),t.ctx?S._putLocalNoLock(e,t,i):S._putLocalWithLock(e,t,i)},S._putLocalWithLock=d(function(e,t,i){S._putLocalNoLock(e,t,i)}),S._putLocalNoLock=function(n,r,o){delete n._revisions;var a=n._rev,s=n._id,l=r.ctx||new j;l.get(T.localStore,s,function(e,t){if(e&&a)return o(B.createError(B.REV_CONFLICT));if(t&&t._rev!==a)return o(B.createError(B.REV_CONFLICT));n._rev=a?"0-"+(parseInt(a.split("-")[1],10)+1):"0-1";var e=[{type:"put",prefix:T.localStore,key:s,value:n}],i=(l.batch(e),{ok:!0,id:n._id,rev:n._rev});if(r.ctx)return o(null,i);l.execute(b,function(e){if(e)return o(e);o(null,i)})})},S._removeLocal=function(e,t,i){"function"==typeof t&&(i=t,t={}),t.ctx?S._removeLocalNoLock(e,t,i):S._removeLocalWithLock(e,t,i)},S._removeLocalWithLock=d(function(e,t,i){S._removeLocalNoLock(e,t,i)}),S._removeLocalNoLock=function(n,r,o){var a=r.ctx||new j;a.get(T.localStore,n._id,function(e,t){if(e)return"NotFoundError"!==e.name?o(e):o(B.createError(B.MISSING_DOC));if(t._rev!==n._rev)return o(B.createError(B.REV_CONFLICT));a.batch([{prefix:T.localStore,type:"del",key:n._id}]);var i={ok:!0,id:n._id,rev:"0-0"};if(r.ctx)return o(null,i);a.execute(b,function(e){if(e)return o(e);o(null,i)})})},S._destroy=function(e,t){var i,n=M.functionName(o);if(!k.has(n))return p(A,t);(i=k.get(n)).has(A)?(H.removeAllListeners(A),i.get(A).close(function(){i.delete(A),p(A,t)})):p(A,t)}}},{argsarray:146,"buffer-from":247,"double-ended-queue":169,levelup:211,"pouchdb-adapter-utils":250,"pouchdb-binary-utils":251,"pouchdb-collections":252,"pouchdb-errors":253,"pouchdb-json":254,"pouchdb-md5":255,"pouchdb-merge":256,"pouchdb-utils":257,"sublevel-pouchdb":366,through2:248}],247:[function(e,t,i){!function(l){!function(){var a=Object.prototype.toString,s="function"==typeof l.alloc&&"function"==typeof l.allocUnsafe&&"function"==typeof l.from;t.exports=function(e,t,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("ArrayBuffer"===a.call(e).slice(8,-1)){var n=e,r=t,o=n.byteLength-(r>>>=0);if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=o;else if((i>>>=0)>o)throw new RangeError("'length' is out of bounds");return s?l.from(n.slice(r,r+i)):new l(new Uint8Array(n.slice(r,r+i)))}if("string"!=typeof e)return s?l.from(e):new l(e);o=e,n=t;if(l.isEncoding(n="string"==typeof n&&""!==n?n:"utf8"))return s?l.from(o,n):new l(o,n);throw new TypeError('"encoding" must be a valid string encoding')}}.call(this)}.call(this,e("buffer").Buffer)},{buffer:153}],248:[function(n,s,e){!function(i){!function(){var t=n("readable-stream").Transform,r=n("util").inherits;function o(e){t.call(this,e),this._destroyed=!1}function a(e,t,i){i(null,e)}function e(n){return function(e,t,i){return"function"==typeof e&&(i=t,t=e,e={}),n(e,t="function"!=typeof t?a:t,i="function"!=typeof i?null:i)}}r(o,t),o.prototype.destroy=function(e){var t;this._destroyed||(this._destroyed=!0,t=this,i.nextTick(function(){e&&t.emit("error",e),t.emit("close")}))},s.exports=e(function(e,t,i){e=new o(e);return e._transform=t,i&&(e._flush=i),e}),s.exports.ctor=e(function(t,e,i){function n(e){if(!(this instanceof n))return new n(e);this.options=Object.assign({},t,e),o.call(this,this.options)}return r(n,o),n.prototype._transform=e,i&&(n.prototype._flush=i),n}),s.exports.obj=e(function(e,t,i){e=new o(Object.assign({objectMode:!0,highWaterMark:16},e));return e._transform=t,i&&(e._flush=i),e})}.call(this)}.call(this,n("_process"))},{_process:270,"readable-stream":333,util:381}],249:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e("pouchdb-utils"),o=n(e("pouchdb-adapter-leveldb-core")),a=n(e("memdown"));function s(e,t){e=r.assign({db:a},e);o.call(this,e,t)}s.valid=function(){return!0},s.use_prefix=!1,t.exports=function(e){e.adapter("memory",s,!0)}},{memdown:232,"pouchdb-adapter-leveldb-core":246,"pouchdb-utils":257}],250:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var u=e("pouchdb-utils"),a=e("pouchdb-binary-utils"),s=e("pouchdb-md5"),l=e("pouchdb-collections"),b=e("pouchdb-errors"),v=e("pouchdb-merge");function n(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}var p=n(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),h=n(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function f(e){var t,i;return/^\d+-/.test(e)?(t=e.indexOf("-"),i=e.substring(0,t),e=e.substring(t+1),{prefix:parseInt(i,10),id:e}):b.createError(b.INVALID_REV)}function m(e,t,i){i=i||{deterministic_revs:!0};var n,r,o,a={status:"available"};if(e._deleted&&(a.deleted=!0),t)if(e._id||(e._id=u.uuid()),r=u.rev(e,i.deterministic_revs),e._rev){if((o=f(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,a,[]]]]}],n=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,a,[]]}],n=1;else if(e._revisions&&(e._rev_tree=function(e){for(var t=e.start-e.ids.length+1,i=e.ids,n=[i[0],a,[]],r=1,o=i.length;r<o;r++)n=[i[r],{status:"missing"},[n]];return[{pos:t,ids:n}]}(e._revisions),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((o=f(e._rev)).error)return o;n=o.prefix,r=o.id,e._rev_tree=[{pos:n,ids:[r,a,[]]}]}u.invalidIdError(e._id),e._rev=n+"-"+r;var s,l={metadata:{},data:{}};for(s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var c,d="_"===s[0];if(d&&!p[s])throw(c=b.createError(b.DOC_VALIDATION,s)).message=b.DOC_VALIDATION.message+": "+s,c;d&&!h[s]?l.metadata[s.slice(1)]=e[s]:l.data[s]=e[s]}return l}function c(e,t,i){if(e.stub)return i();var n,r,o;"string"==typeof e.data?function(t,e,i){var n=function(e){try{return a.atob(e)}catch(e){return{error:b.createError(b.BAD_ARG,"Attachment is not a valid base64 string")}}}(t.data);if(n.error)return i(n.error);t.length=n.length,t.data="blob"===e?a.binaryStringToBlobOrBuffer(n,t.content_type):"base64"===e?a.btoa(n):n,s.binaryMd5(n,function(e){t.digest="md5-"+e,i()})}(e,t,i):(n=e,r=t,o=i,s.binaryMd5(n.data,function(e){n.digest="md5-"+e,n.length=n.data.size||n.data.length||0,"binary"===r?a.blobOrBufferToBinaryString(n.data,function(e){n.data=e,o()}):"base64"===r?a.blobOrBufferToBase64(n.data,function(e){n.data=e,o()}):o()}))}function y(e,t,i,n,r,o,a,s){var l,c,d,u;return v.revExists(t.rev_tree,i.metadata.rev)&&!s?(n[r]=i,o()):(c=t.winningRev||v.winningRev(t),l="deleted"in t?t.deleted:v.isDeleted(t,c),u="deleted"in i.metadata?i.metadata.deleted:v.isDeleted(i.metadata),d=/^1-/.test(i.metadata.rev),l&&!u&&s&&d&&((d=i.data)._rev=c,d._id=i.metadata.id,i=m(d,s)),c=v.merge(t.rev_tree,i.metadata.rev_tree[0],e),s&&(l&&u&&"new_leaf"!==c.conflicts||!l&&"new_leaf"!==c.conflicts||l&&!u&&"new_branch"===c.conflicts)?(d=b.createError(b.REV_CONFLICT),n[r]=d,o()):(e=i.metadata.rev,i.metadata.rev_tree=c.tree,i.stemmedRevs=c.stemmedRevs||[],t.rev_map&&(i.metadata.rev_map=t.rev_map),s=v.winningRev(i.metadata),n=l===(u=v.isDeleted(i.metadata,s))?0:l<u?-1:1,void a(i,s,u,e===s?u:v.isDeleted(i.metadata,e),!0,n,r,o)))}i.invalidIdError=u.invalidIdError,i.normalizeDdocFunctionName=u.normalizeDdocFunctionName,i.parseDdocFunctionName=u.parseDdocFunctionName,i.isDeleted=v.isDeleted,i.isLocalId=v.isLocalId,i.allDocsKeysQuery=function(e,o){var t=o.keys,a={offset:o.skip};return Promise.all(t.map(function(r){var t=u.assign({key:r,deleted:"ok"},o);return["limit","skip","keys"].forEach(function(e){delete t[e]}),new Promise(function(i,n){e._allDocs(t,function(e,t){if(e)return n(e);o.update_seq&&void 0!==t.update_seq&&(a.update_seq=t.update_seq),a.total_rows=t.total_rows,i(t.rows[0]||{key:r,error:"not_found"})})})})).then(function(e){return a.rows=e,a})},i.parseDoc=m,i.preprocessAttachments=function(e,o,t){if(!e.length)return t();var a,i=0;function s(){i++,e.length===i&&(a?t(a):t())}e.forEach(function(e){var t,i=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],n=0;if(!i.length)return s();function r(e){a=e,++n===i.length&&s()}for(t in e.data._attachments)e.data._attachments.hasOwnProperty(t)&&c(e.data._attachments[t],o,r)})},i.processDocs=function(d,e,n,u,r,p,h,f,t){d=d||1e3;var m=f.new_edits,o=new l.Map,i=0,a=e.length;function g(){++i===a&&t&&t()}e.forEach(function(e,i){var t;e._id&&v.isLocalId(e._id)?(t=e._deleted?"_removeLocal":"_putLocal",n[t](e,{ctx:r},function(e,t){p[i]=e||t,g()})):(t=e.metadata.id,o.has(t)?(a--,o.get(t).push([e,i])):o.set(t,[[e,i]]))}),o.forEach(function(a,s){var l=0;function c(){(++l<a.length?e:g)()}function e(){var e,t,i,n,r=a[l],o=r[0],r=r[1];u.has(s)?y(d,u.get(s),o,p,r,c,h,m):(e=v.merge([],o.metadata.rev_tree[0],d),o.metadata.rev_tree=e.tree,o.stemmedRevs=e.stemmedRevs||[],e=o,o=r,r=c,i=v.winningRev(e.metadata),n=v.isDeleted(e.metadata,i),"was_delete"in f&&n?(p[o]=b.createError(b.MISSING_DOC,"deleted"),r()):m&&"missing"===e.metadata.rev_tree[0].ids[1].status?(t=b.createError(b.REV_CONFLICT),p[o]=t,r()):h(e,i,n,n,!1,n?0:1,o,r))}e()})},i.updateDoc=y},{"pouchdb-binary-utils":251,"pouchdb-collections":252,"pouchdb-errors":253,"pouchdb-md5":255,"pouchdb-merge":256,"pouchdb-utils":257}],251:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});function n(e){return atob(e)}function r(e){return btoa(e)}function o(t,i){t=t||[],i=i||{};try{return new Blob(t,i)}catch(e){if("TypeError"!==e.name)throw e;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(i.type)}}function a(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r++)n[r]=e.charCodeAt(r);return i}function s(e,t){return o([a(e)],{type:t})}function l(e,t){var i=new FileReader,n="function"==typeof i.readAsBinaryString;i.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(function(){for(var e="",t=new Uint8Array(r),i=t.byteLength,n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e}())},n?i.readAsBinaryString(e):i.readAsArrayBuffer(e)}function c(e,t){l(e,function(e){t(e)})}i.atob=n,i.btoa=r,i.base64StringToBlobOrBuffer=function(e,t){return s(n(e),t)},i.binaryStringToArrayBuffer=a,i.binaryStringToBlobOrBuffer=s,i.blob=o,i.blobOrBufferToBase64=function(e,t){c(e,function(e){t(r(e))})},i.blobOrBufferToBinaryString=c,i.readAsArrayBuffer=function(e,t){var i=new FileReader;i.onloadend=function(e){e=e.target.result||new ArrayBuffer(0);t(e)},i.readAsArrayBuffer(e)},i.readAsBinaryString=l,i.typedBuffer=function(){}},{}],252:[function(e,t,i){"use strict";function n(){this._store={}}function r(e){if(this._store=new n,e&&Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this.add(e[t])}Object.defineProperty(i,"__esModule",{value:!0}),n.prototype.get=function(e){return this._store["$"+e]},n.prototype.set=function(e,t){return this._store["$"+e]=t,!0},n.prototype.has=function(e){return"$"+e in this._store},n.prototype.delete=function(e){var e="$"+e,t=e in this._store;return delete this._store[e],t},n.prototype.forEach=function(e){for(var t=Object.keys(this._store),i=0,n=t.length;i<n;i++){var r=t[i];e(this._store[r],r.substring(1))}},Object.defineProperty(n.prototype,"size",{get:function(){return Object.keys(this._store).length}}),r.prototype.add=function(e){return this._store.set(e,!0)},r.prototype.has=function(e){return this._store.has(e)},r.prototype.forEach=function(i){this._store.forEach(function(e,t){i(t)})},Object.defineProperty(r.prototype,"size",{get:function(){return this._store.size}}),function(){var e;if("undefined"!=typeof Symbol&&"undefined"!=typeof Map&&"undefined"!=typeof Set)return(e=Object.getOwnPropertyDescriptor(Map,Symbol.species))&&"get"in e&&Map[Symbol.species]===Map}()?(i.Set=Set,i.Map=Map):(i.Set=r,i.Map=n)},{}],253:[function(e,t,i){"use strict";function n(e,t,i){Error.call(this,i),this.status=e,this.name=t,this.message=i,this.error=!0}Object.defineProperty(i,"__esModule",{value:!0}),((e=e("inherits"))&&"object"==typeof e&&"default"in e?e.default:e)(n,Error),n.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var e=new n(401,"unauthorized","Name or password is incorrect."),r=new n(400,"bad_request","Missing JSON list of 'docs'"),o=new n(404,"not_found","missing"),a=new n(409,"conflict","Document update conflict"),s=new n(400,"bad_request","_id field must contain a string"),l=new n(412,"missing_id","_id is required for puts"),c=new n(400,"bad_request","Only reserved document ids may start with underscore."),d=new n(412,"precondition_failed","Database not open"),u=new n(500,"unknown_error","Database encountered an unknown error"),p=new n(500,"badarg","Some query argument is invalid"),h=new n(400,"invalid_request","Request was invalid"),f=new n(400,"query_parse_error","Some query parameter is invalid"),m=new n(500,"doc_validation","Bad special document member"),g=new n(400,"bad_request","Something wrong with the request"),b=new n(400,"bad_request","Document must be a JSON object"),v=new n(404,"not_found","Database not found"),y=new n(500,"indexed_db_went_bad","unknown"),w=new n(500,"web_sql_went_bad","unknown"),k=new n(500,"levelDB_went_went_bad","unknown"),x=new n(403,"forbidden","Forbidden by design doc validate_doc_update function"),E=new n(400,"bad_request","Invalid rev format"),C=new n(412,"file_exists","The database could not be created, the file already exists."),_=new n(412,"missing_stub","A pre-existing attachment stub wasn't found"),S=new n(413,"invalid_url","Provided URL is invalid");i.UNAUTHORIZED=e,i.MISSING_BULK_DOCS=r,i.MISSING_DOC=o,i.REV_CONFLICT=a,i.INVALID_ID=s,i.MISSING_ID=l,i.RESERVED_ID=c,i.NOT_OPEN=d,i.UNKNOWN_ERROR=u,i.BAD_ARG=p,i.INVALID_REQUEST=h,i.QUERY_PARSE_ERROR=f,i.DOC_VALIDATION=m,i.BAD_REQUEST=g,i.NOT_AN_OBJECT=b,i.DB_MISSING=v,i.WSQ_ERROR=w,i.LDB_ERROR=k,i.FORBIDDEN=x,i.INVALID_REV=E,i.FILE_EXISTS=C,i.MISSING_STUB=_,i.IDB_ERROR=y,i.INVALID_URL=S,i.createError=function(i,e){function t(e){for(var t in i)"function"!=typeof i[t]&&(this[t]=i[t]);void 0!==e&&(this.reason=e)}return t.prototype=n.prototype,new t(e)},i.generateErrorFromResponse=function(e){var t;return"object"!=typeof e&&(t=e,(e=u).data=t),"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:186}],254:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=(e=e("vuvuzela"))&&"object"==typeof e&&"default"in e?e.default:e;i.safeJsonParse=function(t){try{return JSON.parse(t)}catch(e){return n.parse(t)}},i.safeJsonStringify=function(t){try{return JSON.stringify(t)}catch(e){return n.stringify(t)}}},{vuvuzela:382}],255:[function(i,e,n){!function(t){!function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e,p=i("pouchdb-binary-utils"),h=(e=i("spark-md5"))&&"object"==typeof e&&"default"in e?e.default:e,f=t.setImmediate||t.setTimeout;function m(t,e,i,n,r){var o;(0<i||n<e.size)&&(i=i,n=n,e=(o=e).webkitSlice?o.webkitSlice(i,n):o.slice(i,n)),p.readAsArrayBuffer(e,function(e){t.append(e),r()})}function g(e,t,i,n,r){(0<i||n<t.length)&&(t=t.substring(i,n)),e.appendBinary(t),r()}n.binaryMd5=function(t,i){var e="string"==typeof t,n=e?t.length:t.size,r=Math.min(32768,n),o=Math.ceil(n/r),a=0,s=new(e?h:h.ArrayBuffer),l=e?g:m;function c(){f(u)}function d(){e=s.end(!0);var e=p.btoa(e);i(e),s.destroy()}function u(){var e=a*r;l(s,t,e,e+r,++a<o?c:d)}u()},n.stringMd5=function(e){return h.hash(e)}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":251,"spark-md5":363}],256:[function(e,t,i){"use strict";function s(e){for(var t,i,n,r=e.rev_tree.slice();d=r.pop();){var o=d.ids,a=o[2],s=d.pos;if(a.length)for(var l=0,c=a.length;l<c;l++)r.push({pos:s+1,ids:a[l]});else{var d=!!o[1].deleted,o=o[0];t&&!(n!==d?n:i!==s?i<s:t<o)||(t=o,i=s,n=d)}}return i+"-"+t}function h(e,t){for(var i,n=e.slice();i=n.pop();)for(var r=i.pos,o=i.ids,a=o[2],s=t(0===a.length,r,o[0],i.ctx,o[1]),l=0,c=a.length;l<c;l++)n.push({pos:r+1,ids:a[l],ctx:s})}function n(e,t){return e.pos-t.pos}function l(e){var o=[];h(e,function(e,t,i,n,r){e&&o.push({rev:t+"-"+i,pos:t,opts:r})}),o.sort(n).reverse();for(var t=0,i=o.length;t<i;t++)delete o[t].pos;return o}function f(e){for(var t,i=[],n=e.slice();t=n.pop();){var r=t.pos,o=t.ids,a=o[0],s=o[1],l=o[2],o=0===l.length,c=t.history?t.history.slice():[];c.push({id:a,opts:s}),o&&i.push({pos:r+1-c.length,ids:c});for(var d=0,u=l.length;d<u;d++)n.push({pos:r+1,ids:l[d],history:c})}return i.reverse()}function y(e,t){return e.pos-t.pos}function m(e,t){for(var i,n,r=t,o=e.length;r<o;r++){var a=e[r],a=[a.id,a.opts,[]];n?(n[2].push(a),n=a):i=n=a}return i}function g(e,t){return e[0]<t[0]?-1:1}function w(e,t){for(var i,n,r,o=[{tree1:e,tree2:t}],a=!1;0<o.length;){var s=o.pop(),l=s.tree1,c=s.tree2;(l[1].status||c[1].status)&&(l[1].status="available"===l[1].status||"available"===c[1].status?"available":"missing");for(var d=0;d<c[2].length;d++)if(l[2][0]){for(var u=!1,p=0;p<l[2].length;p++)l[2][p][0]===c[2][d][0]&&(o.push({tree1:l[2][p],tree2:c[2][d]}),u=!0);u||(a="new_branch",i=l[2],n=c[2][d],r=function(e,t,i){for(var n,r=0,o=e.length;r<o;)i(e[n=r+o>>>1],t)<0?r=1+n:o=n;return r}(i,n,r=g),i.splice(r,0,n))}else a="new_leaf",l[2][0]=c[2][d]}return{conflicts:a,tree:e}}function b(e,t,i){var n,r=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,l=e.length;s<l;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=w(c.ids,t.ids),r.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==i){var d=c.pos<t.pos?c:t,u=c.pos<t.pos?t:c,p=u.pos-d.pos,h=[],f=[];for(f.push({ids:d.ids,diff:p,parent:null,parentIdx:null});0<f.length;){var m=f.pop();if(0!==m.diff)for(var g=m.ids[2],b=0,v=g.length;b<v;b++)f.push({ids:g[b],diff:m.diff-1,parent:m.ids,parentIdx:b});else m.ids[0]===u.ids[0]&&h.push(m)}p=h[0];p?(n=w(p.ids,u.ids),p.parent[2][p.parentIdx]=n.tree,r.push({pos:d.pos,ids:d.ids}),o=o||n.conflicts,a=!0):r.push(c)}else r.push(c)}return a||r.push(t),r.sort(y),{tree:r,conflicts:o||"internal_node"}}function o(e){return e.ids}Object.defineProperty(i,"__esModule",{value:!0}),i.collectConflicts=function(e){for(var t=s(e),i=l(e.rev_tree),n=[],r=0,o=i.length;r<o;r++){var a=i[r];a.rev===t||a.opts.deleted||n.push(a.rev)}return n},i.collectLeaves=l,i.compactTree=function(e){var o=[];return h(e.rev_tree,function(e,t,i,n,r){"available"!==r.status||e||(o.push(t+"-"+i),r.status="missing")}),o},i.isDeleted=function(e,t){for(var i,n=(t=t||s(e)).substring(t.indexOf("-")+1),r=e.rev_tree.map(o);i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}},i.isLocalId=function(e){return/^_local/.test(e)},i.merge=function(e,t,i){e=b(e,t),t=function(e,t){for(var i,n=f(e),r=0,o=n.length;r<o;r++){var a=n[r],s=a.ids;if(s.length>t)for(var l=l||{},c=s.length-t,d={pos:a.pos+c,ids:m(s,c)},u=0;u<c;u++){var p=a.pos+u+"-"+s[u].id;l[p]=!0}else d={pos:a.pos,ids:m(s,0)};i=i?b(i,d,!0).tree:[d]}return l&&h(i,function(e,t,i){delete l[t+"-"+i]}),{tree:i,revs:l?Object.keys(l):[]}}(e.tree,i);return{tree:t.tree,stemmedRevs:t.revs,conflicts:e.conflicts}},i.revExists=function(e,t){for(var i,n=e.slice(),e=t.split("-"),r=parseInt(e[0],10),o=e[1];i=n.pop();){if(i.pos===r&&i.ids[0]===o)return!0;for(var a=i.ids[2],s=0,l=a.length;s<l;s++)n.push({pos:i.pos+1,ids:a[s]})}return!1},i.rootToLeaf=f,i.traverseRevTree=h,i.winningRev=s,i.latest=function(e,t){for(var i,n=t.rev_tree.slice();i=n.pop();){var r=i.pos,o=i.ids,a=o[0],s=o[1],l=o[2],o=0===l.length,c=i.history?i.history.slice():[];if(c.push({id:a,pos:r,opts:s}),o)for(var d=0,u=c.length;d<u;d++){var p=c[d];if(p.pos+"-"+p.id===e)return r+"-"+a}for(var h=0,f=l.length;h<f;h++)n.push({pos:r+1,ids:l[h],history:c})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],257:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(i,"__esModule",{value:!0});var r=n(e("argsarray")),o=e("pouchdb-collections"),a=n(e("inherits")),s=n(e("immediate")),l=e("pouchdb-errors"),c=e("events"),d=n(e("uuid")),u=e("pouchdb-md5");var p,h=Function.prototype.toString,f=h.call(Object);function m(e){var t,i,n,r,o,a,s,l;if(!e||"object"!=typeof e)return e;if(Array.isArray(e))for(t=[],i=0,n=e.length;i<n;i++)t[i]=m(e[i]);else{if(e instanceof Date)return e.toISOString();if(a=e,"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob)return(a=e)instanceof ArrayBuffer?"function"==typeof(o=a).slice?o.slice(0):(s=new ArrayBuffer(o.byteLength),r=new Uint8Array(s),o=new Uint8Array(o),r.set(o),s):(r=a.size,o=a.type,"function"==typeof a.slice?a.slice(0,r,o):a.webkitSlice(0,r,o));if(!(null===(s=Object.getPrototypeOf(e))||"function"==typeof(s=s.constructor)&&s instanceof s&&h.call(s)==f))return e;for(i in t={},e)Object.prototype.hasOwnProperty.call(e,i)&&void 0!==(l=m(e[i]))&&(t[i]=l)}return t}function g(t){var i=!1;return r(function(e){if(i)throw new Error("once called more than once");i=!0,t.apply(this,e)})}function b(a){return r(function(r){r=m(r);var o=this,t="function"==typeof r[r.length-1]&&r.pop(),e=new Promise(function(i,n){var e;try{var t=g(function(e,t){e?n(e):i(t)});r.push(t),(e=a.apply(o,r))&&"function"==typeof e.then&&i(e)}catch(e){n(e)}});return t&&e.then(function(e){t(null,e)},t),e})}function v(e,t){for(var i={},n=0,r=t.length;n<r;n++){var o=t[n];o in e&&(i[o]=e[o])}return i}function y(e){return e}function w(e){return[{ok:e}]}try{localStorage.setItem("_pouch_check_localstorage",1),p=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){p=!1}function k(){return p}function x(){var t;c.EventEmitter.call(this),this._listeners={},t=this,p&&addEventListener("storage",function(e){t.emit(e.key)})}function E(e){var t;"undefined"!=typeof console&&"function"==typeof console[e]&&(t=Array.prototype.slice.call(arguments,1),console[e].apply(console,t))}a(x,c.EventEmitter),x.prototype.addListener=function(e,t,i,n){var r,o;function a(){var e;r._listeners[t]&&(o?o="waiting":(o=!0,e=v(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]),i.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===o&&s(a),o=!1}).on("error",function(){o=!1})))}this._listeners[t]||(o=!1,(r=this)._listeners[t]=a,this.on(e,a))},x.prototype.removeListener=function(e,t){t in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},x.prototype.notifyLocalWindows=function(e){p&&(localStorage[e]="a"===localStorage[e]?"b":"a")},x.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var a="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},C=function(){}.name?function(e){return e.name}:function(e){e=e.toString().match(/^\s*function\s*(?:(\S+)\s*)?\(/);return e&&e[1]?e[1]:""};function _(e){var t;return e?2===(t=e.split("/")).length?t:1===t.length?[e,e]:null:null}var S=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],T=/(?:^|&)([^&=]*)=?([^&]*)/g,A=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var N=d.v4;i.adapterFun=function(l,c){return b(r(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this,o=r,a=l,e=n;if(o.constructor.listeners("debug").length){for(var t=["api",o.name,a],i=0;i<e.length-1;i++)t.push(e[i]);o.constructor.emit("debug",t);var s=e[e.length-1];e[e.length-1]=function(e,t){var i=(i=["api",o.name,a]).concat(e?["error",e]:["success",t]);o.constructor.emit("debug",i),s(e,t)}}return this.taskqueue.isReady?c.apply(this,n):new Promise(function(t,i){r.taskqueue.addTask(function(e){e?i(e):t(r[l].apply(r,n))})})}))},i.assign=a,i.bulkGetShim=function(s,l,c){var e=l.docs,d=new o.Map,u=(e.forEach(function(e){d.has(e.id)?d.get(e.id).push(e):d.set(e.id,[e])}),d.size),p=0,h=new Array(u);var n=[],t=(d.forEach(function(e,t){n.push(t)}),0);!function a(){var e,i;n.length<=t||(e=Math.min(t+6,n.length),e=n.slice(t,e),i=t,e.forEach(function(n,e){var r=i+e,e=d.get(n),t=v(e[0],["atts_since","attachments"]),o=(t.open_revs=e.map(function(e){return e.rev}),t.open_revs=t.open_revs.filter(y),y);0===t.open_revs.length&&(delete t.open_revs,o=w),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in l&&(t[e]=l[e])}),s.get(n,t,function(e,t){var i,e=e?[{error:e}]:o(t);h[r]={id:n,docs:e},++p===u&&(i=[],h.forEach(function(t){t.docs.forEach(function(e){i.push({id:t.id,docs:[e]})})}),c(null,{results:i})),a()})}),t+=e.length)}()},i.changesHandler=x,i.clone=m,i.defaultBackOff=function(e){var t;return t=(e=e)?0:2e3,e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,6e5<t&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)},i.explainError=function(e,t){E("info","The above "+e+" is totally normal. "+t)},i.filterChange=function(n){var r={},o=n.filter&&"function"==typeof n.filter;return r.query=n.query_params,function(e){e.doc||(e.doc={});var t=o&&function(e,t,i){try{return!e(t,i)}catch(e){t="Filter function threw: "+e.toString();return l.createError(l.BAD_REQUEST,t)}}(n.filter,e.doc,r);if("object"==typeof t)return t;if(t)return!1;if(n.include_docs){if(!n.attachments)for(var i in e.doc._attachments)e.doc._attachments.hasOwnProperty(i)&&(e.doc._attachments[i].stub=!0)}else delete e.doc;return!0}},i.flatten=function(e){for(var t=[],i=0,n=e.length;i<n;i++)t=t.concat(e[i]);return t},i.functionName=C,i.guardedConsole=E,i.hasLocalStorage=k,i.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=l.createError(l.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=l.createError(l.RESERVED_ID)):t=l.createError(l.MISSING_ID),t)throw t},i.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(E("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},i.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):c.EventEmitter.listenerCount(e,t)},i.nextTick=s,i.normalizeDdocFunctionName=function(e){e=_(e);return e?e.join("/"):null},i.once=g,i.parseDdocFunctionName=_,i.parseUri=function(e){for(var t=A.exec(e),n={},i=14;i--;){var r=S[i],o=t[i]||"",a=-1!==["user","password"].indexOf(r);n[r]=a?decodeURIComponent(o):o}return n.queryKey={},n[S[12]].replace(T,function(e,t,i){t&&(n.queryKey[t]=i)}),n},i.pick=v,i.rev=function(e,t){e=m(e);return t?(delete e._rev_tree,u.stringMd5(JSON.stringify(e))):d.v4().replace(/-/g,"").toLowerCase()},i.scopeEval=function(e,t){var i,n=[],r=[];for(i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)},i.toPromise=b,i.upsert=function s(l,c,d){return new Promise(function(o,a){l.get(c,function(e,t){if(e){if(404!==e.status)return a(e);t={}}var i,n,r,e=t._rev;if(!(t=d(t)))return o({updated:!1,rev:e});t._id=c,t._rev=e,o((n=t,r=d,(i=l).put(n).then(function(e){return{updated:!0,rev:e.rev}},function(e){if(409!==e.status)throw e;return s(i,n._id,r)})))})})},i.uuid=N},{argsarray:146,events:180,immediate:185,inherits:186,"pouchdb-collections":252,"pouchdb-errors":253,"pouchdb-md5":255,uuid:258}],258:[function(e,t,i){var n=e("./v1"),e=e("./v4"),r=e;r.v1=n,r.v4=e,t.exports=r},{"./v1":261,"./v4":262}],259:[function(e,t,i){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var t=t||0,i=n;return[i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[+t]]].join("")}},{}],260:[function(e,t,i){var n,r,o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);o?(n=new Uint8Array(16),t.exports=function(){return o(n),n}):(r=new Array(16),t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r})},{}],261:[function(e,t,i){var d,u,p=e("./lib/rng"),h=e("./lib/bytesToUuid"),f=0,m=0;t.exports=function(e,t,i){var n=t&&i||0,r=t||[],o=(e=e||{}).node||d,i=void 0!==e.clockseq?e.clockseq:u,a=(null!=o&&null!=i||(a=p(),null==o&&(o=d=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==i&&(i=u=16383&(a[6]<<8|a[7]))),void 0!==e.msecs?e.msecs:(new Date).getTime()),s=void 0!==e.nsecs?e.nsecs:m+1,l=a-f+(s-m)/1e4;if(l<0&&void 0===e.clockseq&&(i=i+1&16383),1e4<=(s=(l<0||f<a)&&void 0===e.nsecs?0:s))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=a,u=i;l=(1e4*(268435455&(a+=122192928e5))+(m=s))%4294967296,r[n++]=l>>>24&255,r[n++]=l>>>16&255,r[n++]=l>>>8&255,r[n++]=255&l,e=a/4294967296*1e4&268435455;r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=i>>>8|128,r[n++]=255&i;for(var c=0;c<6;++c)r[n+c]=o[c];return t||h(r)}},{"./lib/bytesToUuid":259,"./lib/rng":260}],262:[function(e,t,i){var a=e("./lib/rng"),s=e("./lib/bytesToUuid");t.exports=function(e,t,i){var n=t&&i||0,r=("string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),(e=e||{}).random||(e.rng||a)());if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;++o)t[n+o]=r[o];return t||s(r)}},{"./lib/bytesToUuid":259,"./lib/rng":260}],263:[function(sn,ln,e){!function(on,an){!function(){"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var C,M=e(sn("immediate")),i=e(sn("uuid")),g=e(sn("spark-md5")),w=e(sn("vuvuzela")),k=e(sn("argsarray")),t=e(sn("inherits")),s=sn("events");function n(){this._store={}}function x(e){if(this._store=new n,e&&Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this.add(e[t])}n.prototype.get=function(e){return this._store["$"+e]},n.prototype.set=function(e,t){return this._store["$"+e]=t,!0},n.prototype.has=function(e){return"$"+e in this._store},n.prototype.delete=function(e){var e="$"+e,t=e in this._store;return delete this._store[e],t},n.prototype.forEach=function(e){for(var t=Object.keys(this._store),i=0,n=t.length;i<n;i++){var r=t[i];e(this._store[r],r.substring(1))}},Object.defineProperty(n.prototype,"size",{get:function(){return Object.keys(this._store).length}}),x.prototype.add=function(e){return this._store.set(e,!0)},x.prototype.has=function(e){return this._store.has(e)},x.prototype.forEach=function(i){this._store.forEach(function(e,t){i(t)})},Object.defineProperty(x.prototype,"size",{get:function(){return this._store.size}});var _,L=function(){var e;if("undefined"!=typeof Symbol&&"undefined"!=typeof Map&&"undefined"!=typeof Set)return(e=Object.getOwnPropertyDescriptor(Map,Symbol.species))&&"get"in e&&Map[Symbol.species]===Map}()?(C=Set,Map):(C=x,n),E=Function.prototype.toString,S=E.call(Object);function B(e){var t,i,n,r,o,a,s,l;if(!e||"object"!=typeof e)return e;if(Array.isArray(e))for(t=[],i=0,n=e.length;i<n;i++)t[i]=B(e[i]);else{if(e instanceof Date)return e.toISOString();if(a=e,"undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer||"undefined"!=typeof Blob&&a instanceof Blob)return(a=e)instanceof ArrayBuffer?"function"==typeof(o=a).slice?o.slice(0):(s=new ArrayBuffer(o.byteLength),r=new Uint8Array(s),o=new Uint8Array(o),r.set(o),s):(r=a.size,o=a.type,"function"==typeof a.slice?a.slice(0,r,o):a.webkitSlice(0,r,o));if(!(null===(s=Object.getPrototypeOf(e))||"function"==typeof(s=s.constructor)&&s instanceof s&&E.call(s)==S))return e;for(i in t={},e)Object.prototype.hasOwnProperty.call(e,i)&&void 0!==(l=B(e[i]))&&(t[i]=l)}return t}function T(t){var i=!1;return k(function(e){if(i)throw new Error("once called more than once");i=!0,t.apply(this,e)})}function A(a){return k(function(r){r=B(r);var o=this,t="function"==typeof r[r.length-1]&&r.pop(),e=new Promise(function(i,n){var e;try{var t=T(function(e,t){e?n(e):i(t)});r.push(t),(e=a.apply(o,r))&&"function"==typeof e.then&&i(e)}catch(e){n(e)}});return t&&e.then(function(e){t(null,e)},t),e})}function u(l,c){return A(k(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this,o=r,a=l,e=n;if(o.constructor.listeners("debug").length){for(var t=["api",o.name,a],i=0;i<e.length-1;i++)t.push(e[i]);o.constructor.emit("debug",t);var s=e[e.length-1];e[e.length-1]=function(e,t){var i=(i=["api",o.name,a]).concat(e?["error",e]:["success",t]);o.constructor.emit("debug",i),s(e,t)}}return this.taskqueue.isReady?c.apply(this,n):new Promise(function(t,i){r.taskqueue.addTask(function(e){e?i(e):t(r[l].apply(r,n))})})}))}function N(e,t){for(var i={},n=0,r=t.length;n<r;n++){var o=t[n];o in e&&(i[o]=e[o])}return i}function I(e){return e}function O(e){return[{ok:e}]}function P(s,l,c){var e=l.docs,d=new L,u=(e.forEach(function(e){d.has(e.id)?d.get(e.id).push(e):d.set(e.id,[e])}),d.size),p=0,h=new Array(u);var n=[],t=(d.forEach(function(e,t){n.push(t)}),0);!function a(){var e,i;n.length<=t||(e=Math.min(t+6,n.length),e=n.slice(t,e),i=t,e.forEach(function(n,e){var r=i+e,e=d.get(n),t=N(e[0],["atts_since","attachments"]),o=(t.open_revs=e.map(function(e){return e.rev}),t.open_revs=t.open_revs.filter(I),I);0===t.open_revs.length&&(delete t.open_revs,o=O),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in l&&(t[e]=l[e])}),s.get(n,t,function(e,t){var i,e=e?[{error:e}]:o(t);h[r]={id:n,docs:e},++p===u&&(i=[],h.forEach(function(t){t.docs.forEach(function(e){i.push({id:t.id,docs:[e]})})}),c(null,{results:i})),a()})}),t+=e.length)}()}try{localStorage.setItem("_pouch_check_localstorage",1),_=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){_=!1}function D(){var t;s.EventEmitter.call(this),this._listeners={},t=this,_&&addEventListener("storage",function(e){t.emit(e.key)})}function h(e){var t;"undefined"!=typeof console&&"function"==typeof console[e]&&(t=Array.prototype.slice.call(arguments,1),console[e].apply(console,t))}function Z(e){var t;return t=(e=e)?0:2e3,e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,6e5<t&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}function ee(e,t){h("info","The above "+e+" is totally normal. "+t)}t(D,s.EventEmitter),D.prototype.addListener=function(e,t,i,n){var r,o;function a(){var e;r._listeners[t]&&(o?o="waiting":(o=!0,e=N(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]),i.changes(e).on("change",function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))}).on("complete",function(){"waiting"===o&&M(a),o=!1}).on("error",function(){o=!1})))}this._listeners[t]||(o=!1,(r=this)._listeners[t]=a,this.on(e,a))},D.prototype.removeListener=function(e,t){t in this._listeners&&(s.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},D.prototype.notifyLocalWindows=function(e){_&&(localStorage[e]="a"===localStorage[e]?"b":"a")},D.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var te="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function r(e,t,i){Error.call(this,i),this.status=e,this.name=t,this.message=i,this.error=!0}t(r,Error),r.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new r(401,"unauthorized","Name or password is incorrect.");var ie=new r(400,"bad_request","Missing JSON list of 'docs'"),R=new r(404,"not_found","missing"),ne=new r(409,"conflict","Document update conflict"),re=new r(400,"bad_request","_id field must contain a string"),oe=new r(412,"missing_id","_id is required for puts"),ae=new r(400,"bad_request","Only reserved document ids may start with underscore."),se=(new r(412,"precondition_failed","Database not open"),new r(500,"unknown_error","Database encountered an unknown error")),le=new r(500,"badarg","Some query argument is invalid"),ce=(new r(400,"invalid_request","Request was invalid"),new r(400,"query_parse_error","Some query parameter is invalid")),de=new r(500,"doc_validation","Bad special document member"),ue=new r(400,"bad_request","Something wrong with the request"),pe=new r(400,"bad_request","Document must be a JSON object"),he=(new r(404,"not_found","Database not found"),new r(500,"indexed_db_went_bad","unknown")),fe=(new r(500,"web_sql_went_bad","unknown"),new r(500,"levelDB_went_went_bad","unknown"),new r(403,"forbidden","Forbidden by design doc validate_doc_update function"),new r(400,"bad_request","Invalid rev format")),me=(new r(412,"file_exists","The database could not be created, the file already exists."),new r(412,"missing_stub","A pre-existing attachment stub wasn't found"));function j(i,e){function t(e){for(var t in i)"function"!=typeof i[t]&&(this[t]=i[t]);void 0!==e&&(this.reason=e)}return t.prototype=r.prototype,new t(e)}function ge(e){var t;return"object"!=typeof e&&(t=e,(e=se).data=t),"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function be(n){var r={},o=n.filter&&"function"==typeof n.filter;return r.query=n.query_params,function(e){e.doc||(e.doc={});var t=o&&function(e,t,i){try{return!e(t,i)}catch(e){t="Filter function threw: "+e.toString();return j(ue,t)}}(n.filter,e.doc,r);if("object"==typeof t)return t;if(t)return!1;if(n.include_docs){if(!n.attachments)for(var i in e.doc._attachments)e.doc._attachments.hasOwnProperty(i)&&(e.doc._attachments[i].stub=!0)}else delete e.doc;return!0}}function ve(e){for(var t=[],i=0,n=e.length;i<n;i++)t=t.concat(e[i]);return t}function ye(e){var t;if(e?"string"!=typeof e?t=j(re):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=j(ae)):t=j(oe),t)throw t}function b(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(h("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function we(e){var t;return e?2===(t=e.split("/")).length?t:1===t.length?[e,e]:null:null}function ke(e){e=we(e);return e?e.join("/"):null}new r(413,"invalid_url","Provided URL is invalid");var xe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Ee="queryKey",Ce=/(?:^|&)([^&=]*)=?([^&]*)/g,_e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Se(e){for(var t=_e.exec(e),n={},i=14;i--;){var r=xe[i],o=t[i]||"",a=-1!==["user","password"].indexOf(r);n[r]=a?decodeURIComponent(o):o}return n[Ee]={},n[xe[12]].replace(Ce,function(e,t,i){t&&(n[Ee][t]=i)}),n}function Te(e,t){var i,n=[],r=[];for(i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function Ae(s,l,c){return new Promise(function(o,a){s.get(l,function(e,t){if(e){if(404!==e.status)return a(e);t={}}var i,n,r,e=t._rev,t=c(t);if(!t)return o({updated:!1,rev:e});t._id=l,t._rev=e,o((n=t,r=c,(i=s).put(n).then(function(e){return{updated:!0,rev:e.rev}},function(e){if(409!==e.status)throw e;return Ae(i,n._id,r)})))})})}var Ne=function(e){return atob(e)},Ie=function(e){return btoa(e)};function Oe(t,i){t=t||[],i=i||{};try{return new Blob(t,i)}catch(e){if("TypeError"!==e.name)throw e;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(i.type)}}function Pe(e,t){return Oe([function(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r++)n[r]=e.charCodeAt(r);return i}(e)],{type:t})}function De(e,t){return Pe(Ne(e),t)}function Le(e,t){var i=new FileReader,n="function"==typeof i.readAsBinaryString;i.onloadend=function(e){var r=e.target.result||"";if(n)return t(r);t(function(){for(var e="",t=new Uint8Array(r),i=t.byteLength,n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e}())},n?i.readAsBinaryString(e):i.readAsArrayBuffer(e)}function Re(e,t){Le(e,function(e){t(e)})}function Me(e,t){Re(e,function(e){t(Ie(e))})}var Be=an.setImmediate||an.setTimeout;function je(t,e,i,n,r){var o;(0<i||n<e.size)&&(i=i,n=n,e=(o=e).webkitSlice?o.webkitSlice(i,n):o.slice(i,n)),o=e,(i=new FileReader).onloadend=function(e){e=e.target.result||new ArrayBuffer(0);t.append(e),r()},i.readAsArrayBuffer(o)}function Fe(e,t,i,n,r){(0<i||n<t.length)&&(t=t.substring(i,n)),e.appendBinary(t),r()}function Ue(t,i){var e="string"==typeof t,n=e?t.length:t.size,r=Math.min(32768,n),o=Math.ceil(n/r),a=0,s=new(e?g:g.ArrayBuffer),l=e?Fe:je;function c(){Be(u)}function d(){e=s.end(!0);var e=Ie(e);i(e),s.destroy()}function u(){var e=a*r;l(s,t,e,e+r,++a<o?c:d)}u()}function He(e){return g.hash(e)}function qe(e,t){e=B(e);return t?(delete e._rev_tree,He(JSON.stringify(e))):i.v4().replace(/-/g,"").toLowerCase()}var ze=i.v4;function F(e){for(var t,i,n,r=e.rev_tree.slice();d=r.pop();){var o=d.ids,a=o[2],s=d.pos;if(a.length)for(var l=0,c=a.length;l<c;l++)r.push({pos:s+1,ids:a[l]});else{var d=!!o[1].deleted,o=o[0];t&&!(n!==d?n:i!==s?i<s:t<o)||(t=o,i=s,n=d)}}return i+"-"+t}function U(e,t){for(var i,n=e.slice();i=n.pop();)for(var r=i.pos,o=i.ids,a=o[2],s=t(0===a.length,r,o[0],i.ctx,o[1]),l=0,c=a.length;l<c;l++)n.push({pos:r+1,ids:a[l],ctx:s})}function Ge(e,t){return e.pos-t.pos}function Ve(e){var o=[];U(e,function(e,t,i,n,r){e&&o.push({rev:t+"-"+i,pos:t,opts:r})}),o.sort(Ge).reverse();for(var t=0,i=o.length;t<i;t++)delete o[t].pos;return o}function We(e){for(var t=F(e),i=Ve(e.rev_tree),n=[],r=0,o=i.length;r<o;r++){var a=i[r];a.rev===t||a.opts.deleted||n.push(a.rev)}return n}function $e(e){for(var t,i=[],n=e.slice();t=n.pop();){var r=t.pos,o=t.ids,a=o[0],s=o[1],l=o[2],o=0===l.length,c=t.history?t.history.slice():[];c.push({id:a,opts:s}),o&&i.push({pos:r+1-c.length,ids:c});for(var d=0,u=l.length;d<u;d++)n.push({pos:r+1,ids:l[d],history:c})}return i.reverse()}function Ke(e,t){return e.pos-t.pos}function Je(e,t){for(var i,n,r=t,o=e.length;r<o;r++){var a=e[r],a=[a.id,a.opts,[]];n?(n[2].push(a),n=a):i=n=a}return i}function Ye(e,t){return e[0]<t[0]?-1:1}function Xe(e,t){for(var i,n,r,o=[{tree1:e,tree2:t}],a=!1;0<o.length;){var s=o.pop(),l=s.tree1,c=s.tree2;(l[1].status||c[1].status)&&(l[1].status="available"===l[1].status||"available"===c[1].status?"available":"missing");for(var d=0;d<c[2].length;d++)if(l[2][0]){for(var u=!1,p=0;p<l[2].length;p++)l[2][p][0]===c[2][d][0]&&(o.push({tree1:l[2][p],tree2:c[2][d]}),u=!0);u||(a="new_branch",i=l[2],n=c[2][d],r=function(e,t,i){for(var n,r=0,o=e.length;r<o;)i(e[n=r+o>>>1],t)<0?r=1+n:o=n;return r}(i,n,r=Ye),i.splice(r,0,n))}else a="new_leaf",l[2][0]=c[2][d]}return{conflicts:a,tree:e}}function Qe(e,t,i){var n,r=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,l=e.length;s<l;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=Xe(c.ids,t.ids),r.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,a=!0;else if(!0!==i){var d=c.pos<t.pos?c:t,u=c.pos<t.pos?t:c,p=u.pos-d.pos,h=[],f=[];for(f.push({ids:d.ids,diff:p,parent:null,parentIdx:null});0<f.length;){var m=f.pop();if(0!==m.diff)for(var g=m.ids[2],b=0,v=g.length;b<v;b++)f.push({ids:g[b],diff:m.diff-1,parent:m.ids,parentIdx:b});else m.ids[0]===u.ids[0]&&h.push(m)}p=h[0];p?(n=Xe(p.ids,u.ids),p.parent[2][p.parentIdx]=n.tree,r.push({pos:d.pos,ids:d.ids}),o=o||n.conflicts,a=!0):r.push(c)}else r.push(c)}return a||r.push(t),r.sort(Ke),{tree:r,conflicts:o||"internal_node"}}function Ze(e,t,i){e=Qe(e,t),t=function(e,t){for(var i,n=$e(e),r=0,o=n.length;r<o;r++){var a=n[r],s=a.ids;if(s.length>t)for(var l=l||{},c=s.length-t,d={pos:a.pos+c,ids:Je(s,c)},u=0;u<c;u++){var p=a.pos+u+"-"+s[u].id;l[p]=!0}else d={pos:a.pos,ids:Je(s,0)};i=i?Qe(i,d,!0).tree:[d]}return l&&U(i,function(e,t,i){delete l[t+"-"+i]}),{tree:i,revs:l?Object.keys(l):[]}}(e.tree,i);return{tree:t.tree,stemmedRevs:t.revs,conflicts:e.conflicts}}function et(e){return e.ids}function H(e,t){for(var i,n=(t=t||F(e)).substring(t.indexOf("-")+1),r=e.rev_tree.map(et);i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function q(e){return/^_local/.test(e)}function tt(n,t,i){s.EventEmitter.call(this);var r=this,o=(this.db=n,(t=t?B(t):{}).complete=T(function(e,t){var i;e?0<("listenerCount"in(i=r)?i.listenerCount("error"):s.EventEmitter.listenerCount(i,"error"))&&r.emit("error",e):r.emit("complete",t),r.removeAllListeners(),n.removeListener("destroyed",a)}));function a(){r.cancel()}i&&(r.on("complete",function(e){i(null,e)}),r.on("error",i)),n.once("destroyed",a),t.onChange=function(e,t,i){if(!r.isCancelled){var n=r;try{n.emit("change",e,t,i)}catch(n){h("error",'Error in .on("change", function):',n)}}};var e=new Promise(function(i,n){t.complete=function(e,t){e?n(e):i(t)}});r.once("cancel",function(){n.removeListener("destroyed",a),t.complete(null,{status:"cancelled"})}),this.then=e.then.bind(e),this.catch=e.catch.bind(e),this.then(function(e){o(null,e)},o),n.taskqueue.isReady?r.validateChanges(t):n.taskqueue.addTask(function(e){e?t.complete(e):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}function it(e,t,i){var n=[{rev:e._rev}],n=("all_docs"===i.style&&(n=Ve(t.rev_tree).map(function(e){return{rev:e.rev}})),{id:t.id,changes:n,doc:e});return H(t,e._rev)&&(n.deleted=!0),i.conflicts&&(n.doc._conflicts=We(t),n.doc._conflicts.length||delete n.doc._conflicts),n}function nt(e,t){return e<t?-1:t<e?1:0}function rt(i,n){return function(e,t){e||t[0]&&t[0].error?((e=e||t[0]).docId=n,i(e)):i(null,t.length?t[0]:t)}}function ot(e,t){var i=nt(e._id,t._id);return 0!==i?i:nt(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function o(){for(var e in s.EventEmitter.call(this),o.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function at(){this.isReady=!1,this.failed=!1,this.queue=[]}function l(e,t){if(!(this instanceof l))return new l(e,t);var r=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=B(t),r.auto_compaction=t.auto_compaction,r.prefix=l.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var i=function(e,t){var i=e.match(/([a-z-]*):\/\/(.*)/);if(i)return{name:/https?/.test(i[1])?i[1]+"://"+i[2]:i[2],adapter:i[1]};var n=l.adapters,r=l.preferredAdapters,o=l.prefix,a=t.adapter;if(!a)for(var s=0;s<r.length&&"idb"===(a=r[s])&&"websql"in n&&_&&localStorage["_pouch__websqldb_"+o+e];++s)h("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');i=n[a];return{name:i&&"use_prefix"in i&&!i.use_prefix?e:o+e,adapter:a}}((t.prefix||"")+e,t);if(t.name=i.name,t.adapter=t.adapter||i.adapter,r.name=e,r._adapter=t.adapter,l.emit("debug",["adapter","Picked adapter: ",t.adapter]),!l.adapters[t.adapter]||!l.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);o.call(r),r.taskqueue=new at,r.adapter=t.adapter,l.adapters[t.adapter].call(r,t,function(e){if(e)return r.taskqueue.fail(e);function t(e){n.removeListener("closed",i),e||n.constructor.emit("destroyed",n.name)}function i(){n.removeListener("destroyed",t),n.constructor.emit("unref",n)}var n;(n=r).once("destroyed",t),n.once("closed",i),n.constructor.emit("ref",n),r.emit("created",r),l.emit("created",r.name),r.taskqueue.ready(r)})}t(tt,s.EventEmitter),tt.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},tt.prototype.validateChanges=function(t){var i=t.complete,n=this;l._changesFilterPlugin?l._changesFilterPlugin.validate(t,function(e){if(e)return i(e);n.doChanges(t)}):n.doChanges(t)},tt.prototype.doChanges=function(t){var i=this,n=t.complete;if("live"in(t=B(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=it,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(l._changesFilterPlugin){if(l._changesFilterPlugin.normalize(t),l._changesFilterPlugin.shouldFilter(this,t))return l._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(e){e in t&&h("warn",'The "'+e+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=n;var r,o=this.db._changes(t);o&&"function"==typeof o.cancel&&(r=i.cancel,i.cancel=k(function(e){o.cancel(),r.apply(this,e)}))}else this.db.info().then(function(e){i.isCancelled?n(null,{status:"cancelled"}):(t.since=e.update_seq,i.doChanges(t))},n)},t(o,s.EventEmitter),o.prototype.post=u("post",function(e,t,i){if("function"==typeof t&&(i=t,t={}),"object"!=typeof e||Array.isArray(e))return i(j(pe));this.bulkDocs({docs:[e]},t,rt(i,e._id))}),o.prototype.put=u("put",function(i,t,n){var e,r,o,a;return"function"==typeof t&&(n=t,t={}),"object"!=typeof i||Array.isArray(i)?n(j(pe)):(ye(i._id),q(i._id)&&"function"==typeof this._putLocal?i._deleted?this._removeLocal(i,n):this._putLocal(i,n):(a=this,void(t.force&&i._rev?(e=(r=i._rev.split("-"))[1],r=parseInt(r[0],10)+1,o=qe(),i._revisions={start:r,ids:[o,e]},i._rev=r+"-"+o,t.new_edits=!1,s(function(e){var t=e?null:{ok:!0,id:i._id,rev:i._rev};n(e,t)})):s(n))));function s(e){"function"==typeof a._put&&!1!==t.new_edits?a._put(i,t,e):a.bulkDocs({docs:[i]},t,rt(e,i._id))}}),o.prototype.putAttachment=u("putAttachment",function(t,i,n,r,o){var a=this;function s(e){var t="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[i]={content_type:o,data:r,revpos:++t},a.put(e)}return"function"==typeof o&&(o=r,r=n,n=null),void 0===o&&(o=r,r=n,n=null),o||h("warn","Attachment",i,"on document",t,"is missing content_type"),a.get(t).then(function(e){if(e._rev!==n)throw j(ne);return s(e)},function(e){if(e.reason===R.message)return s({_id:t});throw e})}),o.prototype.removeAttachment=u("removeAttachment",function(e,i,n,r){var o=this;o.get(e,function(e,t){if(e)r(e);else if(t._rev===n){if(!t._attachments)return r();delete t._attachments[i],0===Object.keys(t._attachments).length&&delete t._attachments,o.put(t,r)}else r(j(ne))})}),o.prototype.remove=u("remove",function(e,t,i,n){"string"==typeof t?(r={_id:e,_rev:t},"function"==typeof i&&(n=i,i={})):(r=e,i="function"==typeof t?(n=t,{}):(n=i,t)),(i=i||{}).was_delete=!0;var r,e={_id:r._id,_rev:r._rev||i.rev,_deleted:!0};if(q(e._id)&&"function"==typeof this._removeLocal)return this._removeLocal(r,n);this.bulkDocs({docs:[e]},i,rt(n,e._id))}),o.prototype.revsDiff=u("revsDiff",function(r,e,s){"function"==typeof e&&(s=e,e={});var l=Object.keys(r);if(!l.length)return s(null,{});var c=0,d=new L;function u(e,t){d.has(e)||d.set(e,{missing:[]}),d.get(e).missing.push(t)}l.map(function(n){this._getRevisionTree(n,function(e,t){if(e&&404===e.status&&"missing"===e.message)d.set(n,{missing:r[n]});else{if(e)return s(e);e=t,a=r[o=n].slice(0),U(e,function(e,t,i,n,r){t=t+"-"+i,i=a.indexOf(t);-1!==i&&(a.splice(i,1),"available"!==r.status)&&u(o,t)}),a.forEach(function(e){u(o,e)})}var o,a,i;if(++c===l.length)return i={},d.forEach(function(e,t){i[t]=e}),s(null,i)})},this)}),o.prototype.bulkGet=u("bulkGet",function(e,t){P(this,e,t)}),o.prototype.compactDocument=u("compactDocument",function(n,l,c){var d=this;this._getRevisionTree(n,function(e,t){if(e)return c(e);r={},o=[],U(t,function(e,t,i,n){t=t+"-"+i;return e&&(r[t]=0),void 0!==n&&o.push({from:n,to:t}),t}),o.reverse(),o.forEach(function(e){void 0===r[e.from]?r[e.from]=1+r[e.to]:r[e.from]=Math.min(r[e.from],1+r[e.to])});var r,o,i=r,a=[],s=[];Object.keys(i).forEach(function(e){l<i[e]&&a.push(e)}),U(t,function(e,t,i,n,r){t=t+"-"+i;"available"===r.status&&-1!==a.indexOf(t)&&s.push(t)}),d._doCompaction(n,s,c)})}),o.prototype.compact=u("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&function i(n){var e=n._compactionQueue[0],t=e.opts,r=e.callback;n.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(t.last_seq=e.last_seq),n._compact(t,function(e,t){e?r(e):r(null,t),M(function(){n._compactionQueue.shift(),n._compactionQueue.length&&i(n)})})})}(this)}),o.prototype._compact=function(e,i){var n=this,e={return_docs:!1,last_seq:e.last_seq||0},r=[];n.changes(e).on("change",function(e){r.push(n.compactDocument(e.id,0))}).on("complete",function(e){var t=e.last_seq;Promise.all(r).then(function(){return Ae(n,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<t)&&(e.last_seq=t,e)})}).then(function(){i(null,{ok:!0})}).catch(i)}).on("error",i)},o.prototype.get=u("get",function(g,b,v){if("function"==typeof b&&(v=b,b={}),"string"!=typeof g)return v(j(re));if(q(g)&&"function"==typeof this._getLocal)return this._getLocal(g,v);var i=[],y=this;function n(){var a=[],s=i.length;if(!s)return v(null,a);i.forEach(function(o){y.get(g,{rev:o,revs:b.revs,latest:b.latest,attachments:b.attachments,binary:b.binary},function(e,t){if(e)a.push({missing:o});else{for(var i,n=0,r=a.length;n<r;n++)if(a[n].ok&&a[n].ok._rev===t._rev){i=!0;break}i||a.push({ok:t})}--s||v(null,a)})})}if(!b.open_revs)return this._get(g,b,function(e,t){if(e)return e.docId=g,v(e);var r=t.doc,i=t.metadata,o=t.ctx;if(b.conflicts&&(t=We(i)).length&&(r._conflicts=t),H(i,r._rev)&&(r._deleted=!0),b.revs||b.revs_info){for(var t=r._rev.split("-"),n=parseInt(t[0],10),a=t[1],s=$e(i.rev_tree),l=null,c=0;c<s.length;c++){var d=s[c],u=d.ids.map(function(e){return e.id}).indexOf(a);u!==n-1&&(l||-1===u)||(l=d)}if(!l)return(e=new Error("invalid rev tree")).docId=g,v(e);var p,t=l.ids.map(function(e){return e.id}).indexOf(r._rev.split("-")[1])+1,i=l.ids.length-t;l.ids.splice(t,i),l.ids.reverse(),b.revs&&(r._revisions={start:l.pos+l.ids.length-1,ids:l.ids.map(function(e){return e.id})}),b.revs_info&&(p=l.pos+l.ids.length,r._revs_info=l.ids.map(function(e){return{rev:--p+"-"+e.id,status:e.opts.status}}))}if(b.attachments&&r._attachments){var h=r._attachments,f=Object.keys(h).length;if(0===f)return v(null,r);Object.keys(h).forEach(function(n){this._getAttachment(r._id,n,h[n],{rev:r._rev,binary:b.binary,ctx:o},function(e,t){var i=r._attachments[n];i.data=t,delete i.stub,delete i.length,--f||v(null,r)})},y)}else{if(r._attachments)for(var m in r._attachments)r._attachments.hasOwnProperty(m)&&(r._attachments[m].stub=!0);v(null,r)}});if("all"===b.open_revs)this._getRevisionTree(g,function(e,t){if(e)return v(e);i=Ve(t).map(function(e){return e.rev}),n()});else{if(!Array.isArray(b.open_revs))return v(j(se,"function_clause"));for(var i=b.open_revs,e=0;e<i.length;e++){var t=i[e];if("string"!=typeof t||!/^\d+-/.test(t))return v(j(fe))}n()}}),o.prototype.getAttachment=u("getAttachment",function(i,n,r,o){var a=this;r instanceof Function&&(o=r,r={}),this._get(i,r,function(e,t){return e?o(e):t.doc._attachments&&t.doc._attachments[n]?(r.ctx=t.ctx,r.binary=!0,void a._getAttachment(i,n,t.doc._attachments[n],r,o)):o(j(R))})}),o.prototype.allDocs=u("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var i=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(i)return void e(j(ce,"Query parameter `"+i+"` is not compatible with multi-get"));if(!b(this)&&(n="limit"in(i=t)?i.keys.slice(i.skip,i.limit+i.skip):0<i.skip?i.keys.slice(i.skip):i.keys,i.keys=n,i.skip=0,delete i.limit,i.descending&&(n.reverse(),i.descending=!1),0===t.keys.length))return this._allDocs({limit:0},e)}var n;return this._allDocs(t,e)}),o.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new tt(this,e,t)},o.prototype.close=u("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),o.prototype.info=u("info",function(i){var n=this;this._info(function(e,t){if(e)return i(e);t.db_name=t.db_name||n.name,t.auto_compaction=!(!n.auto_compaction||b(n)),t.adapter=n.adapter,i(null,t)})}),o.prototype.id=u("id",function(e){return this._id(e)}),o.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},o.prototype.bulkDocs=u("bulkDocs",function(e,r,o){if("function"==typeof r&&(o=r,r={}),r=r||{},!(e=Array.isArray(e)?{docs:e}:e)||!e.docs||!Array.isArray(e.docs))return o(j(ie));for(var n,t=0;t<e.docs.length;++t)if("object"!=typeof e.docs[t]||Array.isArray(e.docs[t]))return o(j(pe));if(e.docs.forEach(function(i){i._attachments&&Object.keys(i._attachments).forEach(function(e){var t;n=n||"_"===(t=e).charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'",i._attachments[e].content_type||h("warn","Attachment",e,"on document",i._id,"is missing content_type")})}),n)return o(j(ue,n));"new_edits"in r||(r.new_edits=!("new_edits"in e)||e.new_edits);for(var a=this,i=(r.new_edits||b(a)||e.docs.sort(ot),e.docs),s=0;s<i.length;s++){var l=i[s];if(l._deleted)delete l._attachments;else if(l._attachments)for(var c=Object.keys(l._attachments),d=0;d<c.length;d++){var u=c[d];l._attachments[u]=N(l._attachments[u],["data","digest","content_type","length","revpos","stub"])}}var p=e.docs.map(function(e){return e._id});return this._bulkDocs(e,r,function(e,t){if(e)return o(e);if(r.new_edits||(t=t.filter(function(e){return e.error})),!b(a))for(var i=0,n=t.length;i<n;i++)t[i].id=t[i].id||p[i];o(null,t)})}),o.prototype.registerDependentDatabase=u("registerDependentDatabase",function(t,e){var i=new this.constructor(t,this.__opts);Ae(this,"_local/_pouch_dependentDbs",function(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}).then(function(){e(null,{db:i})}).catch(e)}),o.prototype.destroy=u("destroy",function(e,n){"function"==typeof e&&(n=e,e={});var r=this,o=!("use_prefix"in r)||r.use_prefix;function a(){r._destroy(e,function(e,t){if(e)return n(e);r._destroyed=!0,r.emit("destroyed"),n(null,t||{ok:!0})})}if(b(r))return a();r.get("_local/_pouch_dependentDbs",function(e,t){if(e)return 404!==e.status?n(e):a();var e=t.dependentDbs,i=r.constructor,t=Object.keys(e).map(function(e){e=o?e.replace(new RegExp("^"+i.prefix),""):e;return new i(e,r.__opts).destroy()});Promise.all(t).then(a,n)})}),at.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},at.prototype.fail=function(e){this.failed=e,this.execute()},at.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},at.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},t(l,o);var st,a,lt="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},ct=fetch,dt=Headers,ut=(l.adapters={},l.preferredAdapters=[],l.prefix="_pouch_",new s.EventEmitter);function pt(e,t){for(var i=e,n=0,r=t.length;n<r&&(i=i[t[n]]);n++);return i}function ht(e){for(var t=[],i="",n=0,r=e.length;n<r;n++){var o=e[n];"."===o?i=0<n&&"\\"===e[n-1]?i.substring(0,i.length-1)+".":(t.push(i),""):i+=o}return t.push(i),t}st=l,Object.keys(s.EventEmitter.prototype).forEach(function(e){"function"==typeof s.EventEmitter.prototype[e]&&(st[e]=ut[e].bind(ut))}),a=st._destructionListeners=new L,st.on("ref",function(e){a.has(e.name)||a.set(e.name,[]),a.get(e.name).push(e)}),st.on("unref",function(e){var t,i;!a.has(e.name)||(i=(t=a.get(e.name)).indexOf(e))<0||(t.splice(i,1),1<t.length?a.set(e.name,t):a.delete(e.name))}),st.on("destroyed",function(e){var t;a.has(e)&&(t=a.get(e),a.delete(e),t.forEach(function(e){e.emit("destroyed",!0)}))}),l.adapter=function(e,t,i){t.valid()&&(l.adapters[e]=t,i)&&l.preferredAdapters.push(e)},l.plugin=function(t){if("function"==typeof t)t(l);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){l.prototype[e]=t[e]})}return this.__defaults&&(l.__defaults=te({},this.__defaults)),l},l.defaults=function(e){function i(e,t){if(!(this instanceof i))return new i(e,t);t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),t=te({},i.__defaults,t),l.call(this,e,t)}return t(i,l),i.preferredAdapters=l.preferredAdapters.slice(),Object.keys(l).forEach(function(e){e in i||(i[e]=l[e])}),i.__defaults=te({},this.__defaults,e),i},l.fetch=function(e,t){return ct(e,t)};var ft=["$or","$nor","$not"];function mt(e){return-1<ft.indexOf(e)}function gt(e){return Object.keys(e)[0]}function bt(e){var i={};return e.forEach(function(t){Object.keys(t).forEach(function(e){var s,l=t[e];"object"!=typeof l&&(l={$eq:l}),mt(e)?i[e]=l instanceof Array?l.map(function(e){return bt([e])}):bt([l]):(s=i[e]=i[e]||{},Object.keys(l).forEach(function(e){var t,i,n,r,o,a=l[e];return"$gt"===e||"$gte"===e?(n=e,r=a,void(void 0===(o=s).$eq&&(void 0!==o.$gte?"$gte"===n?r>o.$gte&&(o.$gte=r):r>=o.$gte&&(delete o.$gte,o.$gt=r):void 0!==o.$gt?"$gte"===n?r>o.$gt&&(delete o.$gt,o.$gte=r):r>o.$gt&&(o.$gt=r):o[n]=r))):"$lt"===e||"$lte"===e?(o=e,n=a,void(void 0===(r=s).$eq&&(void 0!==r.$lte?"$lte"===o?n<r.$lte&&(r.$lte=n):n<=r.$lte&&(delete r.$lte,r.$lt=n):void 0!==r.$lt?"$lte"===o?n<r.$lt&&(delete r.$lt,r.$lte=n):n<r.$lt&&(r.$lt=n):r[o]=n))):"$ne"===e?(t=a,void("$ne"in(i=s)?i.$ne.push(t):i.$ne=[t])):"$eq"===e?(i=a,delete(t=s).$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,void(t.$eq=i)):void(s[e]=a)}))})}),i}function vt(e){var t=B(e),i=!1;!function e(t,i){for(var n in t)"$and"===n&&(i=!0),"object"==typeof(n=t[n])&&(i=e(n,i));return i}(t,!1)||("$and"in(t=function e(t){for(var i in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=bt(t[n].$and));"object"==typeof(i=t[i])&&e(i)}return t}(t))&&(t=bt(t.$and)),i=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),i=0;i<t.length;i++){var n=t[i],r=e[n];"object"==typeof r&&null!==r||(e[n]={$eq:r})}})}),"$not"in t&&(t.$not=bt([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],a=t[o];"object"!=typeof a||null===a?a={$eq:a}:"$ne"in a&&!i&&(a.$ne=[a.$ne]),t[o]=a}return t}var yt=-324;function z(e,t){if(e===t)return 0;e=f(e),t=f(t);var i=wt(e),n=wt(t);if(i-n!=0)return i-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return e===t?0:t<e?1:-1}return(Array.isArray(e)?function(e,t){for(var i=Math.min(e.length,t.length),n=0;n<i;n++){var r=z(e[n],t[n]);if(0!==r)return r}return e.length===t.length?0:e.length>t.length?1:-1}:function(e,t){for(var i=Object.keys(e),n=Object.keys(t),r=Math.min(i.length,n.length),o=0;o<r;o++){var a=z(i[o],n[o]);if(0!==a)return a;if(0!==(a=z(e[i[o]],t[n[o]])))return a}return i.length===n.length?0:i.length>n.length?1:-1})(e,t)}function f(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t,i=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=f(i[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var o in e={},i)i.hasOwnProperty(o)&&void 0!==(t=i[o])&&(e[o]=f(t))}}return e}function m(e){return wt(e=f(e))+""+function(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":var t=e;if(0===t)return"1";var i=t.toExponential().split(/e\+?/),n=parseInt(i[1],10),r=(t=t<0)?"0":"2";o=((t?-n:n)-yt).toString(),r+=""+(function(){for(var e="",t=3-o.length;e.length<t;)e+="0";return e}()+o);var o,n=Math.abs(parseFloat(i[0]));return r+(n=t?10-n:n).toFixed(20).replace(/\.?0+$/,"");case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var i=Array.isArray(e),a=i?e:Object.keys(e),s=-1,l=a.length,c="";if(i)for(;++s<l;)c+=m(a[s]);else for(;++s<l;){var d=a[s];c+=m(d)+m(e[d])}return c}return""}(e)+"\0"}function wt(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function kt(a,s,e){return e.every(function(e){var t,i,n=s[e],r=ht(e),o=pt(a,r);return mt(e)?(t=n,i=a,"$or"===(e=e)?t.some(function(e){return kt(i,e,Object.keys(e))}):"$not"===e?!kt(i,t,Object.keys(t)):!t.find(function(e){return kt(i,e,Object.keys(e))})):xt(n,a,r,o)})}function xt(i,n,r,o){return!i||("object"==typeof i?Object.keys(i).every(function(e){var t=i[e];if(_t[e])return _t[e](n,t,r,o);throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all')}):i===o)}function Et(e){return null!=e}function c(e){return void 0!==e}function Ct(t,e){return e.some(function(e){return t instanceof Array?-1<t.indexOf(e):t===e})}var _t={$elemMatch:function(t,i,n,e){return!!Array.isArray(e)&&0!==e.length&&("object"==typeof e[0]?e.some(function(e){return kt(e,i,Object.keys(i))}):e.some(function(e){return xt(i,t,n,e)}))},$allMatch:function(t,i,n,e){return!!Array.isArray(e)&&0!==e.length&&("object"==typeof e[0]?e.every(function(e){return kt(e,i,Object.keys(i))}):e.every(function(e){return xt(i,t,n,e)}))},$eq:function(e,t,i,n){return c(n)&&0===z(n,t)},$gte:function(e,t,i,n){return c(n)&&0<=z(n,t)},$gt:function(e,t,i,n){return c(n)&&0<z(n,t)},$lte:function(e,t,i,n){return c(n)&&z(n,t)<=0},$lt:function(e,t,i,n){return c(n)&&z(n,t)<0},$exists:function(e,t,i,n){return t?c(n):!c(n)},$mod:function(e,n,t,i){return Et(i)&&function(e){var t=n[0],i=n[1];if(0===t)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(t,10)!==t)throw new Error("Divisor is not an integer");if(parseInt(i,10)!==i)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%t===i}(i)},$ne:function(e,t,i,n){return t.every(function(e){return 0!==z(n,e)})},$in:function(e,t,i,n){return Et(n)&&Ct(n,t)},$nin:function(e,t,i,n){return Et(n)&&!Ct(n,t)},$size:function(e,t,i,n){return Et(n)&&n.length===t},$all:function(e,t,i,n){return Array.isArray(n)&&(r=n,t.every(function(e){return-1<r.indexOf(e)}));var r},$regex:function(e,t,i,n){return Et(n)&&(n=n,new RegExp(t).test(n))},$type:function(e,t,i,n){var r=n,n=t;switch(n){case"null":return null===r;case"boolean":return"boolean"==typeof r;case"number":return"number"==typeof r;case"string":return"string"==typeof r;case"array":return r instanceof Array;case"object":return"[object Object]"==={}.toString.call(r)}throw new Error(n+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}};function St(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter)return e="string"==typeof e.filter?e.filter:"function",t(new Error('selector invalid for filter "'+e+'"'));t()}function Tt(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=ke(e.view):e.filter=ke(e.filter))}function At(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!b(e.db)}function Nt(i,s){var e,n,r=s.complete;if("_view"===s.filter){if(!s.view||"string"!=typeof s.view)return e=j(ue,"`view` filter parameter not found or invalid."),r(e);var o=we(s.view);i.db.get("_design/"+o[0],function(e,t){return i.isCancelled?r(null,{status:"cancelled"}):e?r(ge(e)):(e=t&&t.views&&t.views[o[1]]&&t.views[o[1]].map)?(s.filter=Te(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),void i.doChanges(s)):r(j(R,t.views?"missing json key: "+o[1]:"missing json key: views"))})}else s.selector?(s.filter=function(e){var t,i,n,r,o=s.selector;if("object"!=typeof o)throw new Error("Selector error: expected a JSON object");function a(t){return n.map(function(e){e=ht(gt(e));return pt(t,e)})}return e=[{doc:e}],t={selector:o=vt(o)},i=Object.keys(o),e=e.filter(function(e){return kt(e.doc,t.selector,i)}),t.sort&&(n=t.sort,e=e.sort(function(e,t){var i=z(a(e.doc),a(t.doc));return 0!==i?i:(i=e.doc._id,e=t.doc._id,i<e?-1:e<i?1:0)}),"string"!=typeof t.sort[0])&&"desc"===(r=t.sort[0])[gt(r)]&&(e=e.reverse()),("limit"in t||"skip"in t)&&(r=t.skip||0,o=("limit"in t?t.limit:e.length)+r,e=e.slice(r,o)),e&&1===e.length},i.doChanges(s)):(n=we(s.filter),i.db.get("_design/"+n[0],function(e,t){return i.isCancelled?r(null,{status:"cancelled"}):e?r(ge(e)):(e=t&&t.filters&&t.filters[n[1]])?(s.filter=Te('"use strict";\nreturn '+e+";",{}),void i.doChanges(s)):r(j(R,t&&t.filters?"missing json key: "+n[1]:"missing json key: filters"))}))}function It(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}l.plugin(function(e){e._changesFilterPlugin={validate:St,normalize:Tt,shouldFilter:At,filter:Nt}}),l.version="7.2.1";var Ot=It(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Pt=It(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Dt(e){var t,i;return/^\d+-/.test(e)?(t=e.indexOf("-"),i=e.substring(0,t),e=e.substring(t+1),{prefix:parseInt(i,10),id:e}):j(fe)}function Lt(e,t,i){i=i||{deterministic_revs:!0};var n,r,o,a={status:"available"};if(e._deleted&&(a.deleted=!0),t)if(e._id||(e._id=ze()),r=qe(e,i.deterministic_revs),e._rev){if((o=Dt(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,a,[]]]]}],n=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,a,[]]}],n=1;else if(e._revisions&&(e._rev_tree=function(e){for(var t=e.start-e.ids.length+1,i=e.ids,n=[i[0],a,[]],r=1,o=i.length;r<o;r++)n=[i[r],{status:"missing"},[n]];return[{pos:t,ids:n}]}(e._revisions),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((o=Dt(e._rev)).error)return o;n=o.prefix,r=o.id,e._rev_tree=[{pos:n,ids:[r,a,[]]}]}ye(e._id),e._rev=n+"-"+r;var s,l={metadata:{},data:{}};for(s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var c,d="_"===s[0];if(d&&!Ot[s])throw(c=j(de,s)).message=de.message+": "+s,c;d&&!Pt[s]?l.metadata[s.slice(1)]=e[s]:l.data[s]=e[s]}return l}function Rt(e,t,i){if(e.stub)return i();var n,r,o,a,s,l,c;"string"==typeof e.data?(s=t,l=i,(c=function(e){try{return Ne(e)}catch(e){return{error:j(le,"Attachment is not a valid base64 string")}}}((a=e).data)).error?l(c.error):(a.length=c.length,a.data="blob"===s?Pe(c,a.content_type):"base64"===s?Ie(c):c,Ue(c,function(e){a.digest="md5-"+e,l()}))):(r=t,o=i,Ue((n=e).data,function(e){n.digest="md5-"+e,n.length=n.data.size||n.data.length||0,"binary"===r?Re(n.data,function(e){n.data=e,o()}):"base64"===r?Me(n.data,function(e){n.data=e,o()}):o()}))}var G="document-store",V="by-sequence",W="attach-store",$="attach-seq-store",K="meta-store",J="local-store",Mt="detect-blob-support";function Y(i){return function(e){var t="unknown_error";e.target&&e.target.error&&(t=e.target.error.name||e.target.error.message),i(j(he,t,e.type))}}function Bt(e,t,i){return{data:function(t){try{return JSON.stringify(t)}catch(e){return w.stringify(t)}}(e),winningRev:t,deletedOrLocal:i?"1":"0",seq:e.seq,id:e.id}}function X(e){var t;return e?((t=function(t){try{return JSON.parse(t)}catch(e){return w.parse(t)}}(e.data)).winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t):null}function jt(e){var t;return e&&(t=e._doc_id_rev.lastIndexOf(":"),e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev),e}function Ft(e,t,i,n){i?n(e?"string"!=typeof e?e:De(e,t):Oe([""],{type:t})):e?"string"!=typeof e?Le(e,function(e){n(Ie(e))}):n(e):n("")}function Ut(n,r,o,e){var t=Object.keys(n._attachments||{});if(!t.length)return e&&e();var i=0;function a(){++i===t.length&&e&&e()}t.forEach(function(e){var t,i;r.attachments&&r.include_docs?(t=n._attachments[e],i=t.digest,o.objectStore(W).get(i).onsuccess=function(e){t.body=e.target.result.body,a()}):(n._attachments[e].stub=!0,a())})}function Ht(e,a){return Promise.all(e.map(function(o){var e;if(o.doc&&o.doc._attachments)return e=Object.keys(o.doc._attachments),Promise.all(e.map(function(i){var e,n,r=o.doc._attachments[i];if("body"in r)return e=r.body,n=r.content_type,new Promise(function(t){Ft(e,n,a,function(e){o.doc._attachments[i]=te(N(r,["digest","content_type"]),{data:e}),t()})})}))}))}function qt(e,t,i){var n=[],r=i.objectStore(V),o=i.objectStore(W),a=i.objectStore($),s=e.length;function l(){--s||n.length&&n.forEach(function(t){a.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::￿",!1,!1)).onsuccess=function(e){e.target.result||o.delete(t)}})}e.forEach(function(e){r.index("_doc_id_rev").getKey(t+"::"+e).onsuccess=function(e){e=e.target.result;if("number"!=typeof e)return l();r.delete(e),a.index("seq").openCursor(IDBKeyRange.only(e)).onsuccess=function(e){var t,e=e.target.result;e?(t=e.value.digestSeq.split("::")[0],n.push(t),a.delete(e.primaryKey),e.continue()):l()}}})}function Q(e,t,i){try{return{txn:e.transaction(t,i)}}catch(e){return{error:e}}}var zt=new D;function Gt(c,e,d,p,t,s){for(var h,f,m,y,g,i,n,l,u=e.docs,r=0,o=u.length;r<o;r++){var a=u[r];a._id&&q(a._id)||(a=u[r]=Lt(a,d.new_edits,c)).error&&!n&&(n=a)}if(n)return s(n);var b,v,w,k,x,E=!1,C=0,_=new Array(u.length),S=new L,T=!1,e=p._meta.blobSupport?"blob":"base64";function A(){E=!0,N()}function N(){l&&E&&(l.docCount+=C,i.put(l))}function I(){T||(zt.notify(p._meta.name),s(null,_))}function O(e,t,i,n,r,o,a,s){e.metadata.winningRev=t,e.metadata.deleted=i;var l,c,d,u,p,h,f,m,g=e.data;function b(){f===m.length&&P(l,c,d,u,p,h)}function v(){f++,b()}g._id=e.metadata.id,g._rev=e.metadata.rev,n&&(g._deleted=!0),g._attachments&&Object.keys(g._attachments).length?(c=t,d=i,u=r,p=a,h=s,n=(l=e).data,f=0,(m=Object.keys(n._attachments)).forEach(function(e){var t,i,n,r,e=l.data._attachments[e];e.stub?(f++,b()):(t=e.data,delete e.data,e.revpos=parseInt(c,10),i=e.digest,n=t,r=v,y.count(i).onsuccess=function(e){if(e.target.result)return r();y.put({digest:i,body:n}).onsuccess=r})})):(C+=o,N(),P(e,t,i,r,a,s))}function P(l,n,r,a,c,d){var t=l.data,u=l.metadata;function i(e){var o,t=l.stemmedRevs||[],i=((t=a&&p.auto_compaction?t.concat((i=l.metadata,o=[],U(i.rev_tree,function(e,t,i,n,r){"available"!==r.status||e||(o.push(t+"-"+i),r.status="missing")}),o)):t)&&t.length&&qt(t,l.metadata.id,h),u.seq=e.target.result,Bt(u,n,r));f.put(i).onsuccess=s}function s(){_[c]={ok:!0,id:u.id,rev:u.rev},S.set(l.metadata.id,l.metadata);var e=l,t=u.seq,i=d,n=0,r=Object.keys(e.data._attachments||{});if(r.length)for(var o,a=0;a<r.length;a++)o=r[a],o=e.data._attachments[o].digest,(o=g.put({seq:t,digestSeq:o+"::"+t})).onsuccess=s,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),s()};else i();function s(){++n===r.length&&i()}}t._doc_id_rev=u.id+"::"+u.rev,delete t._id,delete t._rev;var e=m.put(t);e.onsuccess=i,e.onerror=function(e){e.preventDefault(),e.stopPropagation(),m.index("_doc_id_rev").getKey(t._doc_id_rev).onsuccess=function(e){m.put(t,e.target.result).onsuccess=i}}}function D(){x++,b.length===x&&(k?w(k):w())}v=e,w=function(e){if(e)return s(e);var n,r,o,a;(e=Q(t,[G,V,W,J,$,K],"readwrite")).error?s(e.error):((h=e.txn).onabort=Y(s),h.ontimeout=Y(s),h.oncomplete=I,f=h.objectStore(G),m=h.objectStore(V),y=h.objectStore(W),g=h.objectStore($),(i=h.objectStore(K)).get(K).onsuccess=function(e){l=e.target.result,N()},n=function(e){if(e)return T=!0,s(e);if(u.length)for(var l=0,t=0,i=u.length;t<i;t++){var n=u[t];n._id&&q(n._id)?r():f.get(n.metadata.id).onsuccess=o}function r(){function n(){++i===s&&t&&t()}var v,e,r,y,o,w,k,x,t,E,a,i,s;++l===u.length&&(v=c.revs_limit,e=u,r=p,y=S,o=h,w=_,k=O,t=A,v=v||1e3,E=(x=d).new_edits,a=new L,i=0,s=e.length,e.forEach(function(e,i){var t;e._id&&q(e._id)?(t=e._deleted?"_removeLocal":"_putLocal",r[t](e,{ctx:o},function(e,t){w[i]=e||t,n()})):(t=e.metadata.id,a.has(t)?(s--,a.get(t).push([e,i])):a.set(t,[[e,i]]))}),a.forEach(function(f,m){var g=0;function b(){(++g<f.length?e:n)()}function e(){var e,t,i,n,r,o,a,s,l,c,d,u,p=f[g],h=p[0],p=p[1];y.has(m)?(e=v,t=y.get(m),i=h,n=w,r=p,o=b,a=k,s=E,function(e,t){for(var i,n=e.slice(),e=t.split("-"),r=parseInt(e[0],10),o=e[1];i=n.pop();){if(i.pos===r&&i.ids[0]===o)return 1;for(var a=i.ids[2],s=0,l=a.length;s<l;s++)n.push({pos:i.pos+1,ids:a[s]})}}(t.rev_tree,i.metadata.rev)&&!s?(n[r]=i,o()):(c=t.winningRev||F(t),l="deleted"in t?t.deleted:H(t,c),u="deleted"in i.metadata?i.metadata.deleted:H(i.metadata),d=/^1-/.test(i.metadata.rev),l&&!u&&s&&d&&((d=i.data)._rev=c,d._id=i.metadata.id,i=Lt(d,s)),c=Ze(t.rev_tree,i.metadata.rev_tree[0],e),s&&(l&&u&&"new_leaf"!==c.conflicts||!l&&"new_leaf"!==c.conflicts||l&&!u&&"new_branch"===c.conflicts)?(d=j(ne),n[r]=d,o()):(e=i.metadata.rev,i.metadata.rev_tree=c.tree,i.stemmedRevs=c.stemmedRevs||[],t.rev_map&&(i.metadata.rev_map=t.rev_map),s=F(i.metadata),n=l===(u=H(i.metadata,s))?0:l<u?-1:1,a(i,s,u,e===s?u:H(i.metadata,e),!0,n,r,o)))):(d=Ze([],h.metadata.rev_tree[0],v),h.metadata.rev_tree=d.tree,h.stemmedRevs=d.stemmedRevs||[],c=p,t=b,a=F((l=h).metadata),s=H(l.metadata,a),"was_delete"in x&&s?(w[c]=j(R,"deleted"),t()):E&&"missing"===l.metadata.rev_tree[0].ids[1].status?(u=j(ne),w[c]=u,t()):k(l,a,s,s,!1,s?0:1,c,t))}e()}))}function o(e){e=X(e.target.result);e&&S.set(e.id,e),r()}},a=[],u.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){e=t.data._attachments[e];e.stub&&a.push(e.digest)})}),a.length?(o=0,a.forEach(function(e){var t,i;t=e,i=function(e){e&&!r&&(r=e),++o===a.length&&n(r)},y.get(t).onsuccess=function(e){e.target.result?i():((e=j(me,"unknown stub attachment with digest "+t)).status=412,i(e))}})):n())},(b=u).length?(x=0,b.forEach(function(e){var t,i=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],n=0;if(!i.length)return D();function r(e){k=e,++n===i.length&&D()}for(t in e.data._attachments)e.data._attachments.hasOwnProperty(t)&&Rt(e.data._attachments[t],v,r)})):w()}function Vt(i,n,e,r,o){var a,s,t;function l(e){s=e.target.result,a&&o(a,s,t)}function c(e){a=e.target.result,s&&o(a,s,t)}function d(e){e=e.target.result;if(!e)return o();o([e.key],[e.value],e)}-1===r&&(r=1e3),"function"==typeof i.getAll&&"function"==typeof i.getAllKeys&&1<r&&!e?(t={continue:function(){if(!a.length)return o();var e,t=a[a.length-1];if(n&&n.upper)try{e=IDBKeyRange.bound(t,n.upper,!0,n.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return o()}else e=IDBKeyRange.lowerBound(t,!0);n=e,s=a=null,i.getAll(n,r).onsuccess=l,i.getAllKeys(n,r).onsuccess=c}},i.getAll(n,r).onsuccess=l,i.getAllKeys(n,r).onsuccess=c):e?i.openCursor(n,"prev").onsuccess=d:i.openCursor(n).onsuccess=d}function Wt(o,e,t){var i,n,r="startkey"in o&&o.startkey,a="endkey"in o&&o.endkey,s="key"in o&&o.key,l="keys"in o&&o.keys,c=o.skip||0,d="number"==typeof o.limit?o.limit:-1,u=!1!==o.inclusive_end;if(!l&&(n=(i=function(e,t,i,n,r){try{if(e&&t)return r?IDBKeyRange.bound(t,e,!i,!1):IDBKeyRange.bound(e,t,!1,!i);if(e)return r?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return r?IDBKeyRange.lowerBound(t,!i):IDBKeyRange.upperBound(t,!i);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}(r,a,u,s,o.descending))&&i.error)&&("DataError"!==n.name||0!==n.code))return t(j(he,n.name,n.message));r=[G,V,K],o.attachments&&r.push(W),a=Q(e,r,"readonly");if(a.error)return t(a.error);var p=a.txn;p.oncomplete=function(){o.attachments?Ht(E,o.binary).then(S):S()},p.onabort=Y(t);var h,f,m,g,b,v,y,w,k,u=p.objectStore(G),s=p.objectStore(V),e=p.objectStore(K),x=s.index("_doc_id_rev"),E=[];function C(e){for(var t=0,i=e.length;t<i&&E.length!==d;t++){var n=e[t];n.error&&l?E.push(n):function(e,t){var i,n,r={id:t.id,key:t.id,value:{rev:e}};t.deleted?l&&(E.push(r),r.value.deleted=!0,r.doc=null):c--<=0&&(E.push(r),o.include_docs)&&(n=r,r=(i=t).id+"::"+e,x.get(r).onsuccess=function(e){n.doc=jt(e.target.result)||{},o.conflicts&&(e=We(i)).length&&(n.doc._conflicts=e),Ut(n.doc,o,p)})}((n=X(n)).winningRev,n)}}function _(e,t,i){i&&(C(t),E.length<d)&&i.continue()}function S(){var e={total_rows:h,offset:o.skip,rows:E};o.update_seq&&void 0!==f&&(e.update_seq=f),t(null,e)}e.get(K).onsuccess=function(e){h=e.target.result.docCount},o.update_seq&&(s.openCursor(null,"prev").onsuccess=function(e){var e=e.target.result,t=void 0;e&&e.key&&(t=e.key),(e={target:{result:[t]}}).target.result&&0<e.target.result.length&&(f=e.target.result[0])}),n||0===d||(l?(b=o.keys,v=u,y=_,w=new Array(b.length),k=0,b.forEach(function(t,i){v.get(t).onsuccess=function(e){e.target.result?w[i]=e.target.result:w[i]={key:t,error:"not_found"},++k===b.length&&y(b,w,{})}})):-1===d?(r=i,m=function(e){e=e.target.result;C(e=o.descending?e.reverse():e)},"function"!=typeof(a=u).getAll?(g=[],a.openCursor(r).onsuccess=function(e){e=e.target.result;e?(g.push(e.value),e.continue()):m({target:{result:g}})}):a.getAll(r).onsuccess=m):Vt(u,i,o.descending,d+c,_))}var $t=!1,Kt=[];function Jt(){!$t&&Kt.length&&($t=!0,Kt.shift()())}var Yt,Xt=new L,Qt=new L;function Zt(t,e){var r,o,i=this;r=e,o=i.constructor,Kt.push(function(){function s(e,n){var r=e.objectStore(G);r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),r.openCursor().onsuccess=function(e){var t,i,e=e.target.result;e?(i=H(t=e.value),t.deletedOrLocal=i?"1":"0",r.put(t),e.continue()):n()}}function l(e,a){var s=e.objectStore(J),l=e.objectStore(G),c=e.objectStore(V);l.openCursor().onsuccess=function(e){var t,i,n,r,o=e.target.result;o?(n=q(i=(e=o.value).id),e=F(e),n?(t=i+"::"+e,n=i+"::",e=i+"::~",i=c.index("_doc_id_rev"),n=IDBKeyRange.bound(n,e,!1,!1),(r=i.openCursor(n)).onsuccess=function(e){((r=e.target.result)?((e=r.value)._doc_id_rev===t&&s.put(e),c.delete(r.primaryKey),r):(l.delete(o.primaryKey),o)).continue()}):o.continue()):a&&a()}}function c(e,l){var t=e.objectStore(V),i=e.objectStore(W),c=e.objectStore($);i.count().onsuccess=function(e){if(!e.target.result)return l();t.openCursor().onsuccess=function(e){e=e.target.result;if(!e)return l();for(var t=e.value,i=e.primaryKey,n=Object.keys(t._attachments||{}),r={},o=0;o<n.length;o++)r[t._attachments[n[o]].digest]=!0;for(var a=Object.keys(r),o=0;o<a.length;o++){var s=a[o];c.put({seq:i,digestSeq:s+"::"+i})}e.continue()}}}function d(e){var a=e.objectStore(V),s=e.objectStore(G);s.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var i,n,r=(e=t.value).data?X(e):(e.deleted="1"===e.deletedOrLocal,e);if(r.winningRev=r.winningRev||F(r),r.seq)return o();e=r.id+"::",i=r.id+"::￿",e=a.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,i)),n=0,e.onsuccess=function(e){e=e.target.result;if(!e)return r.seq=n,o();var t=e.primaryKey;n<t&&(n=t),e.continue()}}function o(){var e=Bt(r,r.winningRev,r.deleted);s.put(e).onsuccess=function(){t.continue()}}}}var u,n,p,x,E,e;u=i,p=function(e,t){var i=r,n=e,e=t,t=o;try{i(n,e)}catch(n){t.emit("error",n)}$t=!1,M(function(){Jt()})},x=(n=t).name,E=null,u._meta=null,u._remote=!1,u.type=function(){return"idb"},u._id=A(function(e){e(null,u._meta.instanceId)}),u._bulkDocs=function(e,t,i){Gt(n,e,t,u,E,i)},u._get=function(e,i,t){var n,r,o,a=i.ctx;if(!a){var s=Q(E,[G,V,W],"readonly");if(s.error)return t(s.error);a=s.txn}function l(){t(o,{doc:n,metadata:r,ctx:a})}a.objectStore(G).get(e).onsuccess=function(e){if(!(r=X(e.target.result)))return o=j(R,"missing"),l();if(i.rev)t=i.latest?function(e,t){for(var i,n=t.rev_tree.slice();i=n.pop();){var r=i.pos,o=i.ids,a=o[0],s=o[1],l=o[2],o=0===l.length,c=i.history?i.history.slice():[];if(c.push({id:a,pos:r,opts:s}),o)for(var d=0,u=c.length;d<u;d++){var p=c[d];if(p.pos+"-"+p.id===e)return r+"-"+a}for(var h=0,f=l.length;h<f;h++)n.push({pos:r+1,ids:l[h],history:c})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(i.rev,r):i.rev;else if(t=r.winningRev,H(r))return o=j(R,"deleted"),l();var e=a.objectStore(V),t=r.id+"::"+t;e.index("_doc_id_rev").get(t).onsuccess=function(e){if(!(n=(n=e.target.result)&&jt(n)))return o=j(R,"missing"),l();l()}}},u._getAttachment=function(e,t,i,n,r){var o;if(n.ctx)o=n.ctx;else{var a=Q(E,[G,V,W],"readonly");if(a.error)return r(a.error);o=a.txn}var a=i.digest,s=i.content_type;o.objectStore(W).get(a).onsuccess=function(e){Ft(e.target.result.body,s,n.binary,function(e){r(null,e)})}},u._info=function(e){var t,i,n=Q(E,[K,V],"readonly");if(n.error)return e(n.error);n=n.txn;n.objectStore(K).get(K).onsuccess=function(e){i=e.target.result.docCount},n.objectStore(V).openCursor(null,"prev").onsuccess=function(e){e=e.target.result;t=e?e.key:0},n.oncomplete=function(){e(null,{doc_count:i,update_seq:t,idb_attachment_format:u._meta.blobSupport?"binary":"base64"})}},u._allDocs=function(e,t){Wt(e,E,t)},u._changes=function(e){var t,h=e,e=u,i=x,n=E;if((h=B(h)).continuous)return t=i+":"+ze(),zt.addListener(i,t,e,h),zt.notify(i),{cancel:function(){zt.removeListener(i,t)}};var o=h.doc_ids&&new C(h.doc_ids),f=(h.since=h.since||0,h.since),m="limit"in h?h.limit:-1;0===m&&(m=1);var g,a,r,b=[],v=0,y=be(h),w=new L;function k(e,t,i,n){return i.seq!==t?n():i.winningRev===e._rev?n(i,e):(t=e._id+"::"+i.winningRev,void(r.get(t).onsuccess=function(e){n(i,jt(e.target.result))}))}function s(){h.complete(null,{results:b,last_seq:f})}e=[G,V];if(h.attachments&&e.push(W),(n=Q(n,e,"readonly")).error)return h.complete(n.error);(g=n.txn).onabort=Y(h.complete),g.oncomplete=function(){!h.continuous&&h.attachments?Ht(b).then(s):s()},e=g.objectStore(V),a=g.objectStore(G),r=e.index("_doc_id_rev"),Vt(e,h.since&&!h.descending?IDBKeyRange.lowerBound(h.since,!0):null,h.descending,m,function(l,e,c){var d,u,p;c&&l.length&&(d=new Array(l.length),u=new Array(l.length),p=0,e.forEach(function(e,s){var t,i,n,r;t=jt(e),i=l[s],n=function(e,t){if(u[s]=e,d[s]=t,++p===l.length){for(var i=[],n=0,r=d.length;n<r&&v!==m;n++){var o,a=d[n];a&&(o=u[n],i.push(function(e,t){var i=h.processChange(t,e,h),e=(f=i.seq=e.seq,y(i));return"object"==typeof e?Promise.reject(e):e?(v++,h.return_docs&&b.push(i),h.attachments&&h.include_docs?new Promise(function(e){Ut(t,h,g,function(){Ht([i],h.binary).then(function(){e(i)})})}):Promise.resolve(i)):Promise.resolve()}(o,a)))}Promise.all(i).then(function(e){for(var t=0,i=e.length;t<i;t++)e[t]&&h.onChange(e[t])}).catch(h.complete),v!==m&&c.continue()}},o&&!o.has(t._id)?n():(r=w.get(t._id))?k(t,i,r,n):a.get(t._id).onsuccess=function(e){r=X(e.target.result),w.set(t._id,r),k(t,i,r,n)}}))})},u._close=function(e){E.close(),Xt.delete(x),e()},u._getRevisionTree=function(e,t){var i=Q(E,[G],"readonly");if(i.error)return t(i.error);i.txn.objectStore(G).get(e).onsuccess=function(e){e=X(e.target.result);e?t(null,e.rev_tree):t(j(R))}},u._doCompaction=function(n,o,e){var t=Q(E,[G,V,W,$],"readwrite");if(t.error)return e(t.error);var r=t.txn;r.objectStore(G).get(n).onsuccess=function(e){var e=X(e.target.result),t=(U(e.rev_tree,function(e,t,i,n,r){-1!==o.indexOf(t+"-"+i)&&(r.status="missing")}),qt(o,n,r),e.winningRev),i=e.deleted;r.objectStore(G).put(Bt(e,t,i))},r.onabort=Y(e),r.oncomplete=function(){e()}},u._getLocal=function(e,t){var i=Q(E,[J],"readonly");if(i.error)return t(i.error);i=i.txn.objectStore(J).get(e);i.onerror=Y(t),i.onsuccess=function(e){e=e.target.result;e?(delete e._doc_id_rev,t(null,e)):t(j(R))}},u._putLocal=function(t,i,n){"function"==typeof i&&(n=i,i={}),delete t._revisions;var r=t._rev,e=t._id;t._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var o,a=i.ctx;if(!a){var s=Q(E,[J],"readwrite");if(s.error)return n(s.error);(a=s.txn).onerror=Y(n),a.oncomplete=function(){o&&n(null,o)}}var l,c=a.objectStore(J);r?(l=c.get(e)).onsuccess=function(e){e=e.target.result;e&&e._rev===r?c.put(t).onsuccess=function(){o={ok:!0,id:t._id,rev:t._rev},i.ctx&&n(null,o)}:n(j(ne))}:((l=c.add(t)).onerror=function(e){n(j(ne)),e.preventDefault(),e.stopPropagation()},l.onsuccess=function(){o={ok:!0,id:t._id,rev:t._rev},i.ctx&&n(null,o)})},u._removeLocal=function(t,i,n){"function"==typeof i&&(n=i,i={});var r,e=i.ctx;if(!e){var o=Q(E,[J],"readwrite");if(o.error)return n(o.error);(e=o.txn).oncomplete=function(){r&&n(null,r)}}var a=t._id,s=e.objectStore(J),o=s.get(a);o.onerror=Y(n),o.onsuccess=function(e){e=e.target.result;e&&e._rev===t._rev?(s.delete(a),r={ok:!0,id:a,rev:"0-0"},i.ctx&&n(null,r)):n(j(R))}},u._destroy=function(e,t){zt.removeAllListeners(x);var i=Qt.get(x),i=(i&&i.result&&(i.result.close(),Xt.delete(x)),indexedDB.deleteDatabase(x));i.onsuccess=function(){Qt.delete(x),_&&x in localStorage&&delete localStorage[x],t(null,{ok:!0})},i.onerror=Y(t)},(e=Xt.get(x))?(E=e.idb,u._meta=e.global,M(function(){p(null,u)})):(e=indexedDB.open(x,5),Qt.set(x,e),e.onupgradeneeded=function(e){var t,i=e.target.result;if(e.oldVersion<1)return t=(n=i).createObjectStore(G,{keyPath:"id"}),n.createObjectStore(V,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),n.createObjectStore(W,{keyPath:"digest"}),n.createObjectStore(K,{keyPath:"id",autoIncrement:!1}),n.createObjectStore(Mt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.createObjectStore(J,{keyPath:"_id"}),(t=n.createObjectStore($,{autoIncrement:!0})).createIndex("seq","seq"),void t.createIndex("digestSeq","digestSeq",{unique:!0});var n,r=e.currentTarget.transaction,o=(e.oldVersion<3&&i.createObjectStore(J,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.oldVersion<4&&((n=i.createObjectStore($,{autoIncrement:!0})).createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})),[s,l,c,d]),a=e.oldVersion;!function e(){var t=o[a-1];a++,t&&t(r,e)}()},e.onsuccess=function(e){(E=e.target.result).onversionchange=function(){E.close(),Xt.delete(x)},E.onabort=function(e){h("error","Database has a global failure",e.target.error),E.close(),Xt.delete(x)};var t,i,n,r,o,a=E.transaction([K,Mt,G],"readwrite"),s=!1;function l(){void 0!==n&&s&&(u._meta={name:x,instanceId:r,blobSupport:n},Xt.set(x,{idb:E,global:u._meta}),p(null,u))}function c(){var e;void 0!==i&&void 0!==t&&((e=x+"_id")in t?r=t[e]:t[e]=r=ze(),t.docCount=i,a.objectStore(K).put(t))}a.objectStore(K).get(K).onsuccess=function(e){t=e.target.result||{id:K},c()},a.objectStore(G).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){e=e.target.result,i=e,c()},Yt||(o=a,Yt=new Promise(function(i){var e=Oe([""]),e=o.objectStore(Mt).put(e,"key");e.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);i(t||!e||43<=parseInt(e[1],10))},e.onerror=o.onabort=function(e){e.preventDefault(),e.stopPropagation(),i(!1)}}).catch(function(){return!1})),Yt.then(function(e){n=e,l()}),a.oncomplete=function(){s=!0,l()},a.onabort=Y(p)},e.onerror=function(e){e=e.target.error&&e.target.error.message;e?-1!==e.indexOf("stored database is a higher version")&&(e=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):e="Failed to open indexedDB, are you in private browsing mode?",h("error",e),p(j(he,e))})}),Jt()}Zt.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var ei={};function ti(e){var e=e.doc||e.ok,t=e&&e._attachments;t&&Object.keys(t).forEach(function(e){e=t[e];e.data=De(e.data,e.content_type)})}function p(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function ii(i){return i._attachments&&Object.keys(i._attachments)?Promise.all(Object.keys(i._attachments).map(function(e){var t=i._attachments[e];if(t.data&&"string"!=typeof t.data)return new Promise(function(e){Me(t.data,e)}).then(function(e){t.data=e})})):Promise.resolve()}function y(e,t){return ni(e,e.db+"/"+t)}function ni(e,t){var i=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+i+t}function ri(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function oi(s,e){var t,i,n,o=this,g=(t=s.name,i=s,function(){var e;if(i.prefix)return"http"===(e=Se(i.prefix).protocol)||"https"===e}()&&(n=i.name.substr(i.prefix.length),t=i.prefix.replace(/\/?$/,"/")+encodeURIComponent(n)),((n=Se(t)).user||n.password)&&(n.auth={username:n.user,password:n.password}),t=n.path.replace(/(^\/|\/$)/g,"").split("/"),n.db=t.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=t.join("/"),n),r=y(g,"");s=B(s);var a,l=function(e,t){(t=t||{}).headers=t.headers||new dt,t.credentials="include",(s.auth||g.auth)&&(i=(i=s.auth||g.auth).username+":"+i.password,i=Ie(unescape(encodeURIComponent(i))),t.headers.set("Authorization","Basic "+i));var i,n,r,o,a=s.headers||{};return Object.keys(a).forEach(function(e){t.headers.append(e,a[e])}),i=t,n="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r=-1!==n.indexOf("msie"),o=-1!==n.indexOf("trident"),n=-1!==n.indexOf("edge"),i=!("method"in i)||"GET"===i.method,(r||o||n)&&i&&(e+=(-1===e.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(s.fetch||ct)(e,t)};function c(e,i){return u(e,k(function(t){v().then(function(){return i.apply(this,t)}).catch(function(e){t.pop()(e)})})).bind(o)}function b(e,t,i){var n={};return(t=t||{}).headers=t.headers||new dt,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),l(e,t).then(function(e){return n.ok=e.ok,n.status=e.status,e.json()}).then(function(e){if(n.data=e,!n.ok){n.data.status=n.status;e=ge(n.data);if(i)return i(e);throw e}if(Array.isArray(n.data)&&(n.data=n.data.map(function(e){return e.error||e.missing?ge(e):e})),!i)return n;i(null,n.data)})}function v(){return s.skip_setup?Promise.resolve():a||((a=b(r).catch(function(e){return e&&e.status&&404===e.status?(ee(404,"PouchDB is just detecting if the remote exists."),b(r,{method:"PUT"})):Promise.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)})).catch(function(){a=null}),a)}function d(e){return e.split("/").map(encodeURIComponent).join("/")}M(function(){e(null,o)}),o._remote=!0,o.type=function(){return"http"},o.id=c("id",function(t){l(ni(g,"")).then(function(e){return e.json()}).catch(function(){return{}}).then(function(e){e=e&&e.uuid?e.uuid+g.db:y(g,"");t(null,e)})}),o.compact=c("compact",function(n,r){"function"==typeof n&&(r=n,n={}),n=B(n),b(y(g,"_compact"),{method:"POST"}).then(function(){!function i(){o.info(function(e,t){t&&!t.compact_running?r(null,{ok:!0}):setTimeout(i,n.interval||200)})}()})}),o.bulkGet=u("bulkGet",function(i,a){var s=this;function e(t){var e={};i.revs&&(e.revs=!0),i.attachments&&(e.attachments=!0),i.latest&&(e.latest=!0),b(y(g,"_bulk_get"+ri(e)),{method:"POST",body:JSON.stringify({docs:i.docs})}).then(function(e){i.attachments&&i.binary&&e.data.results.forEach(function(e){e.docs.forEach(ti)}),t(null,e.data)}).catch(t)}function n(){var n=Math.ceil(i.docs.length/50),r=0,o=new Array(n);for(var e=0;e<n;e++){var t=N(i,["revs","attachments","binary","latest"]);t.docs=i.docs.slice(50*e,Math.min(i.docs.length,50*(e+1))),P(s,t,function(i){return function(e,t){o[i]=t.results,++r===n&&a(null,{results:ve(o)})}}(e))}}var r=ni(g,""),t=ei[r];"boolean"!=typeof t?e(function(e,t){e?(ei[r]=!1,ee(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),n()):(ei[r]=!0,a(null,t))}):t?e(a):n()}),o._info=function(t){v().then(function(){return l(y(g,""))}).then(function(e){return e.json()}).then(function(e){e.host=y(g,""),t(null,e)}).catch(t)},o.fetch=function(t,i){return v().then(function(){var e="/"===t.substring(0,1)?ni(g,t.substring(1)):y(g,t);return l(e,i)})},o.get=c("get",function(t,o,i){"function"==typeof o&&(i=o,o={});var e={};function n(n){var u,r=n._attachments,e=r&&Object.keys(r);if(r&&e.length)return u=e.map(function(t){return function(){return i=r[e=t],e=p(n._id)+"/"+d(e)+"?rev="+n._rev,l(y(g,e)).then(function(e){return"buffer"in e?e.buffer():e.blob()}).then(function(t){var e;return o.binary?((e=Object.getOwnPropertyDescriptor(t.__proto__,"type"))&&!e.set||(t.type=i.content_type),t):new Promise(function(e){Me(t,e)})}).then(function(e){delete i.stub,delete i.length,i.data=e});var e,i}}),new Promise(function(e,t){var i,n=0,r=0,o=0,a=u.length;function s(){++o===a?i?t(i):e():d()}function l(){n--,s()}function c(e){n--,i=i||e,s()}function d(){for(;n<5&&r<a;)n++,u[r++]().then(l,c)}d()})}(o=B(o)).revs&&(e.revs=!0),o.revs_info&&(e.revs_info=!0),o.latest&&(e.latest=!0),o.open_revs&&("all"!==o.open_revs&&(o.open_revs=JSON.stringify(o.open_revs)),e.open_revs=o.open_revs),o.rev&&(e.rev=o.rev),o.conflicts&&(e.conflicts=o.conflicts),o.update_seq&&(e.update_seq=o.update_seq),t=p(t),b(y(g,t+ri(e))).then(function(t){return Promise.resolve().then(function(){if(o.attachments)return e=t.data,Array.isArray(e)?Promise.all(e.map(function(e){if(e.ok)return n(e.ok)})):n(e);var e}).then(function(){i(null,t.data)})}).catch(function(e){e.docId=t,i(e)})}),o.remove=c("remove",function(e,t,i,n){"string"==typeof t?(r={_id:e,_rev:t},"function"==typeof i&&(n=i,i={})):(r=e,i="function"==typeof t?(n=t,{}):(n=i,t));var r,e=r._rev||i.rev;b(y(g,p(r._id))+"?rev="+e,{method:"DELETE"},n).catch(n)}),o.getAttachment=c("getAttachment",function(e,t,i,n){"function"==typeof i&&(n=i,i={});var r,i=i.rev?"?rev="+i.rev:"",e=y(g,p(e))+"/"+d(t)+i;l(e,{method:"GET"}).then(function(e){if(r=e.headers.get("content-type"),e.ok)return void 0===on||on.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e}).then(function(e){void 0===on||on.browser||(e.type=r),n(null,e)}).catch(function(e){n(e)})}),o.removeAttachment=c("removeAttachment",function(e,t,i,n){b(y(g,p(e)+"/"+d(t))+"?rev="+i,{method:"DELETE"},n).catch(n)}),o.putAttachment=c("putAttachment",function(e,t,i,n,r,o){"function"==typeof r&&(o=r,r=n,n=i,i=null);var a,t=p(e)+"/"+d(t),t=y(g,t);if(i&&(t+="?rev="+i),"string"==typeof n){try{a=Ne(n)}catch(e){return o(j(le,"Attachment is not a valid base64 string"))}n=a?Pe(a,r):""}b(t,{headers:new dt({"Content-Type":r}),method:"PUT",body:n},o).catch(o)}),o._bulkDocs=function(e,t,i){e.new_edits=t.new_edits,v().then(function(){return Promise.all(e.docs.map(ii))}).then(function(){return b(y(g,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},i)}).catch(i)},o._put=function(t,e,i){v().then(function(){return ii(t)}).then(function(){return b(y(g,p(t._id)),{method:"PUT",body:JSON.stringify(t)})}).then(function(e){i(null,e.data)}).catch(function(e){e.docId=t&&t._id,i(e)})},o.allDocs=c("allDocs",function(t,i){"function"==typeof t&&(i=t,t={});var e,n={},r="GET",n=((t=B(t)).conflicts&&(n.conflicts=!0),t.update_seq&&(n.update_seq=!0),t.descending&&(n.descending=!0),t.include_docs&&(n.include_docs=!0),t.attachments&&(n.attachments=!0),t.key&&(n.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(n.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(n.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(n.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(n.limit=t.limit),void 0!==t.skip&&(n.skip=t.skip),ri(n));void 0!==t.keys&&(r="POST",e={keys:t.keys}),b(y(g,"_all_docs"+n),{method:r,body:JSON.stringify(e)}).then(function(e){t.include_docs&&t.attachments&&t.binary&&e.data.rows.forEach(ti),i(null,e.data)}).catch(i)}),o._changes=function(o){var a="batch_size"in o?o.batch_size:25,e=(!(o=B(o)).continuous||"heartbeat"in o||(o.heartbeat=1e4),"timeout"in o?o.timeout:3e4),r=("timeout"in o&&o.timeout&&e-o.timeout<5e3&&(e=o.timeout+5e3),"heartbeat"in o&&o.heartbeat&&e-o.heartbeat<5e3&&(e=o.heartbeat+5e3),{}),s=("timeout"in o&&o.timeout&&(r.timeout=o.timeout),void 0!==o.limit&&o.limit),l=s;if(o.style&&(r.style=o.style),(o.include_docs||o.filter&&"function"==typeof o.filter)&&(r.include_docs=!0),o.attachments&&(r.attachments=!0),o.continuous&&(r.feed="longpoll"),o.seq_interval&&(r.seq_interval=o.seq_interval),o.conflicts&&(r.conflicts=!0),o.descending&&(r.descending=!0),o.update_seq&&(r.update_seq=!0),"heartbeat"in o&&o.heartbeat&&(r.heartbeat=o.heartbeat),o.filter&&"string"==typeof o.filter&&(r.filter=o.filter),o.view&&"string"==typeof o.view&&(r.filter="_view",r.view=o.view),o.query_params&&"object"==typeof o.query_params)for(var t in o.query_params)o.query_params.hasOwnProperty(t)&&(r[t]=o.query_params[t]);var c,d="GET";o.doc_ids?(r.filter="_doc_ids",d="POST",c={doc_ids:o.doc_ids}):o.selector&&(r.filter="_selector",d="POST",c={selector:o.selector});var u,p=new lt,h=function(e,t){var i,n;o.aborted||(r.since=e,"object"==typeof r.since&&(r.since=JSON.stringify(r.since)),o.descending?s&&(r.limit=l):r.limit=!s||a<l?a:l,i=y(g,"_changes"+ri(r)),n={signal:p.signal,method:d,body:JSON.stringify(c)},u=e,o.aborted)||v().then(function(){return b(i,n,t)}).catch(t)},f={results:[]},m=function(e,t){if(!o.aborted){var i=0;if(t&&t.results){i=t.results.length,f.last_seq=t.last_seq;var n=null,r=null;"number"==typeof t.pending&&(n=t.pending),"string"!=typeof f.last_seq&&"number"!=typeof f.last_seq||(r=f.last_seq),o.query_params,t.results=t.results.filter(function(e){l--;var t=be(o)(e);return t&&(o.include_docs&&o.attachments&&o.binary&&ti(e),o.return_docs&&f.results.push(e),o.onChange(e,n,r)),t})}else if(e)return o.aborted=!0,void o.complete(e);t&&t.last_seq&&(u=t.last_seq);e=s&&l<=0||t&&i<a||o.descending;(!o.continuous||s&&l<=0)&&e?o.complete(null,f):M(function(){h(u,m)})}};return h(o.since||0,m),{cancel:function(){o.aborted=!0,p.abort()}}},o.revsDiff=c("revsDiff",function(e,t,i){"function"==typeof t&&(i=t,t={}),b(y(g,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},i).catch(i)}),o._close=function(e){e()},o._destroy=function(e,t){b(y(g,""),{method:"DELETE"}).then(function(e){t(null,e)}).catch(function(e){404===e.status?t(null,{ok:!0}):t(e)})}}function d(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,d)}catch(e){}}function ai(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,ai)}catch(e){}}function si(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,si)}catch(e){}}function li(e,t){t&&e.then(function(e){M(function(){t(null,e)})},function(e){M(function(){t(e)})})}function ci(i,n){return function(){var e=arguments,t=this;return i.add(function(){return n.apply(t,e)})}}function di(e){var e=new C(e),t=new Array(e.size),i=-1;return e.forEach(function(e){t[++i]=e}),t}function ui(e){var i=new Array(e.size),n=-1;return e.forEach(function(e,t){i[++n]=t}),i}function pi(e){return new si("builtin "+e+" function requires map values to be numbers or number arrays")}function hi(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];if("number"!=typeof r){if(!Array.isArray(r))throw pi("_sum");for(var t="number"==typeof t?[t]:t,o=0,a=r.length;o<a;o++){var s=r[o];if("number"!=typeof s)throw pi("_sum");void 0===t[o]?t.push(s):t[o]+=s}}else"number"==typeof t?t+=r:t[0]+=r}return t}oi.valid=function(){return!0},t(d,Error),t(ai,Error),t(si,Error);var fi=h.bind(null,"log"),mi=Array.isArray,gi=JSON.parse;function bi(e,t){return Te("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:hi,log:fi,isArray:mi,toJSON:gi})}function vi(){this.promise=new Promise(function(e){e()})}function yi(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function wi(n,r,o,a,t,s){e=a;var l,e,c=yi(o)+yi(e)+"undefined";return!t&&(l=n._cachedViews=n._cachedViews||{})[c]?l[c]:(e=n.info().then(function(e){var i=e.db_name+"-mrview-"+(t?"temp":He(c));return Ae(n,"_local/"+s,function(e){e.views=e.views||{};var t=r,t=(-1===t.indexOf("/")&&(t=r+"/"+r),e.views[t]=e.views[t]||{});if(!t[i])return t[i]=!0,e}).then(function(){return n.registerDependentDatabase(i).then(function(e){var e=e.db,t=(e.auto_compaction=!0,{name:i,db:e,sourceDB:n,adapter:n.adapter,mapFun:o,reduceFun:a});return t.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return t.seq=e?e.seq:0,l&&t.db.once("destroyed",function(){delete l[c]}),t})})})}),l&&(l[c]=e),e)}vi.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},vi.prototype.finish=function(){return this.promise};var ki={},xi=new vi;function Ei(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Ci(e,t){try{e.emit("error",t)}catch(e){h("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),h("error",t)}}function _i(e,t){return hi(t)}function Si(e,t){return t.length}function Ti(e,t){return{sum:hi(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];t+=r*r}return t}(t)}}Ai="mrviews",Ni=function(e,t){var i;return"function"==typeof e&&2===e.length?(i=e,function(e){return i(e,t)}):bi(e.toString(),t)},Ii=function(e){e=e.toString();return function(e){if(/^_sum/.test(e))return _i;if(/^_count/.test(e))return Si;if(/^_stats/.test(e))return Ti;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(e)||bi(e)};var Ai,Ni,Ii,Oi,Pi={query:function(e,t,i){var n=this,r=("function"==typeof t&&(i=t,t={}),t=t?((r=t).group_level=Mi(r.group_level),r.limit=Mi(r.limit),r.skip=Mi(r.skip),r):{},"function"==typeof e&&(e={map:e}),Promise.resolve().then(function(){return qi(n,e,t)}));return li(r,i),r},viewCleanup:(Oi=function(){var t,e,i=this;return"function"==typeof this._viewCleanup?(e=this,new Promise(function(i,n){e._viewCleanup(function(e,t){if(e)return n(e);i(t)})})):b(this)?i.fetch("_view_cleanup",{headers:new dt({"Content-Type":"application/json"}),method:"POST"}).then(function(e){return e.json()}):(t=i).get("_local/"+Ai).then(function(a){var s=new L,e=(Object.keys(a.views).forEach(function(e){var e=Ei(e),t="_design/"+e[0],e=e[1],i=s.get(t);i||(i=new C,s.set(t,i)),i.add(e)}),{keys:ui(s),include_docs:!0});return t.allDocs(e).then(function(e){var o={},e=(e.rows.forEach(function(n){var r=n.key.substring(8);s.get(n.key).forEach(function(e){var t=r+"/"+e,t=(a.views[t]||(t=e),Object.keys(a.views[t])),i=n.doc&&n.doc.views&&n.doc.views[e];t.forEach(function(e){o[e]=o[e]||i})})}),Object.keys(o).filter(function(e){return!o[e]}).map(function(e){return ci(Fi(e),function(){return new t.constructor(e,t.__opts).destroy()})()}));return Promise.all(e).then(function(){return{ok:!0}})})},ji({ok:!0}))},k(function(e){var t=e.pop(),e=Oi.apply(this,e);return"function"==typeof t&&li(e,t),e}))};function Di(e,t){var i=z(e.key,t.key);return 0!==i?i:z(e.value,t.value)}function Li(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function Ri(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&e.rows.forEach(function(e){var i=e.doc&&e.doc._attachments;i&&Object.keys(i).forEach(function(e){var t=i[e];i[e].data=De(t.data,t.content_type)})}),e}}function v(e,t,i,n){t=t[e];void 0!==t&&(n&&(t=encodeURIComponent(JSON.stringify(t))),i.push(e+"="+t))}function Mi(e){var t;if(void 0!==e)return t=Number(e),isNaN(t)||t!==parseInt(e,10)?e:t}function Bi(t,e){var i=t.descending?"endkey":"startkey",n=t.descending?"startkey":"endkey";if(void 0!==t[i]&&void 0!==t[n]&&0<z(t[i],t[n]))throw new d("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&!1!==t.reduce){if(t.include_docs)throw new d("{include_docs:true} is invalid for reduce");if(t.keys&&1<t.keys.length&&!t.group&&!t.group_level)throw new d("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){e=function(e){if(e)return"number"!=typeof e?new d('Invalid value for integer: "'+e+'"'):e<0?new d('Invalid value for positive integer: "'+e+'"'):void 0}(t[e]);if(e)throw e})}function ji(t){return function(e){if(404===e.status)return t;throw e}}function Fi(e){e="string"==typeof e?e:e.name;return ki[e]||(ki[e]=new vi)}function Ui(t){return ci(Fi(t),function(){return u=Ni((l=t).mapFun,function(e,t){e={id:d._id,key:f(e)};null!=t&&(e.value=f(t)),c.push(e)}),p=l.seq||0,r=new vi,n().then(function(){return r.finish()}).then(function(){l.seq=p});function i(e,t){return function(){return o=e,i=t,(r=l).db.get("_local/lastSeq").catch(ji({_id:"_local/lastSeq",seq:0})).then(function(t){var e=ui(o);return Promise.all(e.map(function(e){return t=r,n={_id:i="_local/doc_"+e,keys:[]},e=o.get(e),d=e[0],(1===(e=e[1]).length&&/^1-/.test(e[0].rev)?Promise.resolve(n):t.db.get(i).catch(ji(n))).then(function(c){return(c.keys.length?t.db.allDocs({keys:c.keys,include_docs:!0}):Promise.resolve({rows:[]})).then(function(e){for(var t=c,i=e,n=[],r=new C,o=0,a=i.rows.length;o<a;o++){var s,l=i.rows[o].doc;!l||(n.push(l),r.add(l._id),l._deleted=!d.has(l._id),l._deleted)||"value"in(s=d.get(l._id))&&(l.value=s.value)}e=ui(d);return e.forEach(function(e){var t;r.has(e)||(t={_id:e},"value"in(e=d.get(e))&&(t.value=e.value),n.push(t))}),t.keys=di(e.concat(t.keys)),n.push(t),n})});var t,i,n,d})).then(function(e){e=ve(e);return t.seq=i,e.push(t),r.db.bulkDocs({docs:e})})});var r,o,i}}function n(){return l.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:p,limit:50}).then(e)}function e(e){e=e.results;if(e.length){var t=function(e){for(var t=new L,i=0,n=e.length;i<n;i++){var r=e[i];if("_"!==r.doc._id[0]){if(c=[],!(d=r.doc)._deleted){o=void 0;a=void 0;s=void 0;var o=l.sourceDB;var a=u;var s=d;try{a(s)}catch(a){Ci(o,a)}}c.sort(Di);s=function(e){for(var t,i=new L,n=0,r=e.length;n<r;n++){var o=e[n],a=[o.key,o.id];0<n&&0===z(o.key,t)&&a.push(n),i.set(m(a),o),t=o.key}return i}(c);t.set(r.doc._id,[s,r.changes])}p=r.seq}return t}(e);if(r.add(i(t,p)),!(e.length<50))return n()}}var l,c,d,u,p,r})()}function Hi(d,u){return ci(Fi(d),function(){return r=u,l=(i=d).reduceFun&&!1!==r.reduce,c=r.skip||0,void 0===r.keys||r.keys.length||(r.limit=0,delete r.keys),(void 0!==r.keys?(n=r.keys.map(function(e){e={startkey:m([e]),endkey:m([e,{}])};return r.update_seq&&(e.update_seq=!0),t(e)}),Promise.all(n).then(ve)):(n={descending:r.descending},r.update_seq&&(n.update_seq=!0),"start_key"in r&&(a=r.start_key),"startkey"in r&&(a=r.startkey),"end_key"in r&&(s=r.end_key),"endkey"in r&&(s=r.endkey),void 0!==a&&(n.startkey=r.descending?m([a,{}]):m([a])),void 0!==s&&(a=!1!==r.inclusive_end,r.descending&&(a=!a),n.endkey=m(a?[s,{}]:[s])),void 0!==r.key&&(a=m([r.key]),s=m([r.key,{}]),n.descending?(n.endkey=a,n.startkey=s):(n.startkey=a,n.endkey=s)),l||("number"==typeof r.limit&&(n.limit=r.limit),n.skip=c),t(n))).then(e);function t(e){return e.include_docs=!0,i.db.allDocs(e).then(function(e){return o=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),i=["id","key","value"];if(!(t<i||i<t))return e.doc.value}i=function(e){for(var t,i,n,r,o=[],a=[],s=0;;){var l=e[s++];if("\0"!==l)switch(l){case"1":o.push(null);break;case"2":o.push("1"===e[s]),s++;break;case"3":var c=function(e,t){var i,n=t;if("1"===e[t])i=0,t++;else{var r="0"===e[t],o="",a=e.substring(++t,t+3),a=parseInt(a,10)+yt;for(r&&(a=-a),t+=3;;){var s=e[t];if("\0"===s)break;o+=s,t++}i=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),r&&(i-=10),0!==a&&(i=parseFloat(i+"e"+a))}return{num:i,length:t-n}}(e,s);o.push(c.num),s+=c.length;break;case"4":for(var d="";;){var u=e[s];if("\0"===u)break;d+=u,s++}d=d.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),o.push(d);break;case"5":c={element:[],index:o.length};o.push(c.element),a.push(c);break;case"6":var p={element:{},index:o.length};o.push(p.element),a.push(p);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+l)}else{if(1===o.length)return o.pop();i=a,r=n=void 0,r=(t=o).pop(),i.length&&(r===(n=i[i.length-1]).element&&(i.pop(),n=i[i.length-1]),i=n.element,n=n.index,Array.isArray(i)?i.push(r):n===t.length-2?i[t.pop()]=r:t.push(r))}}}(e.doc._id);return{key:i[0],id:i[1],value:"value"in e.doc?e.doc.value:null}})})}function e(t){var e,n=l?function(e,t,i){0===i.group_level&&delete i.group_level;var n=i.group||i.group_level,r=Ii(e.reduceFun),o=[],a=isNaN(i.group_level)?Number.POSITIVE_INFINITY:i.group_level;t.forEach(function(e){var t=o[o.length-1],i=n?e.key:null;n&&Array.isArray(i)&&(i=i.slice(0,a)),t&&0===z(t.groupKey,i)?(t.keys.push([e.key,e.id]),t.values.push(e.value)):o.push({keys:[[e.key,e.id]],values:[e.value],groupKey:i})}),t=[];for(var s,l,c=0,d=o.length;c<d;c++){var u=o[c],p=function(e,t,i,n,r){try{return{output:t(i,n,r)}}catch(t){return Ci(e,t),{error:t}}}(e.sourceDB,r,u.keys,u.values,!1);if(p.error&&p.error instanceof si)throw p.error;t.push({value:p.error?null:p.output,key:u.groupKey})}return{rows:(s=t,l=i.limit,i=(i=i.skip)||0,"number"==typeof l?s.slice(i,l+i):0<i?s.slice(i):s)}}(i,t,r):{total_rows:o,offset:c,rows:t};return r.update_seq&&(n.update_seq=i.seq),r.include_docs?(e=di(t.map(Li)),i.sourceDB.allDocs({keys:e,include_docs:!0,conflicts:r.conflicts,attachments:r.attachments,binary:r.binary}).then(function(e){var i=new L;return e.rows.forEach(function(e){i.set(e.id,e.doc)}),t.forEach(function(e){var t=Li(e),t=i.get(t);t&&(e.doc=t)}),n})):n}var i,r,o,n,a,s,l,c})()}function qi(o,e,a){var t,r,s,i,n,l,c,d,u,p,h,f,m,g;return"function"==typeof o._query?(t=o,r=e,s=a,new Promise(function(i,n){t._query(r,s,function(e,t){if(e)return n(e);i(t)})})):b(o)?(i=o,n=e,m="GET",v("reduce",l=a,p=[]),v("include_docs",l,p),v("attachments",l,p),v("limit",l,p),v("descending",l,p),v("group",l,p),v("group_level",l,p),v("skip",l,p),v("stale",l,p),v("conflicts",l,p),v("startkey",l,p,!0),v("start_key",l,p,!0),v("endkey",l,p,!0),v("end_key",l,p,!0),v("inclusive_end",l,p),v("key",l,p,!0),v("update_seq",l,p),p=""===(p=p.join("&"))?"":"?"+p,void 0!==l.keys&&((f="keys="+encodeURIComponent(JSON.stringify(l.keys))).length+p.length+1<=2e3?p+=("?"===p[0]?"&":"?")+f:(m="POST","string"==typeof n?c={keys:l.keys}:n.keys=l.keys)),("string"==typeof n?(f=Ei(n),i.fetch("_design/"+f[0]+"/_view/"+f[1]+p,{headers:new dt({"Content-Type":"application/json"}),method:m,body:JSON.stringify(c)}).then(function(e){return d=e.ok,u=e.status,e.json()}).then(function(e){if(d)return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e;throw e.status=u,ge(e)})):(c=c||{},Object.keys(n).forEach(function(e){Array.isArray(n[e])?c[e]=n[e]:c[e]=n[e].toString()}),i.fetch("_temp_view"+p,{headers:new dt({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(c)}).then(function(e){return d=e.ok,u=e.status,e.json()}).then(function(e){if(d)return e;throw e.status=u,ge(e)}))).then(Ri(l))):"string"!=typeof e?(Bi(a,e),xi.add(function(){return wi(o,"temp_view/temp_view",e.map,e.reduce,!0,Ai).then(function(e){return t=function(){return e.db.destroy()},Ui(e).then(function(){return Hi(e,a)}).then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})});var t})}),xi.finish()):(m=(f=Ei(h=e))[0],g=f[1],o.get("_design/"+m).then(function(e){var t=e.views&&e.views[g];if(t){var i=e,n=g,r=i.views&&i.views[n];if("string"!=typeof r.map)throw new ai("ddoc "+i._id+" has no string view named "+n+", instead found object of type: "+typeof r.map);return Bi(a,t),wi(o,h,t.map,t.reduce,!1,Ai).then(function(e){return"ok"===a.stale||"update_after"===a.stale?("update_after"===a.stale&&M(function(){Ui(e)}),Hi(e,a)):Ui(e).then(function(){return Hi(e,a)})})}throw new ai("ddoc "+e._id+" has no view named "+g)}))}var zi={query:function(e,t,i){return Pi.query.call(this,e,t,i)},viewCleanup:function(e){return Pi.viewCleanup.call(this,e)}};function Gi(e){return/^1-/.test(e)}function Vi(t,i){var e=Object.keys(i._attachments);return Promise.all(e.map(function(e){return t.getAttachment(i._id,e,{rev:i._rev})}))}function Wi(s,l,n,r){n=B(n);var o=[],c=!0;return Promise.resolve().then(function(){var e=Object.keys(n).filter(function(e){e=n[e].missing;return 1===e.length&&Gi(e[0])});if(0<e.length)return s.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(e){if(r.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){var t;e.deleted||!e.doc||!Gi(e.value.rev)||(t=e.doc)._attachments&&0<Object.keys(t._attachments).length||(t=e.doc)._conflicts&&0<t._conflicts.length||(e.doc._conflicts&&delete e.doc._conflicts,o.push(e.doc),delete n[e.id])})})}).then(function(){e=n,i=[],Object.keys(e).forEach(function(t){e[t].missing.forEach(function(e){i.push({id:t,rev:e})})});var e,i,t={docs:i,revs:!0,latest:!0};if(t.docs.length)return s.bulkGet(t).then(function(e){if(r.cancelled)throw new Error("cancelled");return Promise.all(e.results.map(function(e){return Promise.all(e.docs.map(function(e){var i,n,r,o,a=e.ok;return e.error&&(c=!1),a&&a._attachments?(i=l,r=a,e=b(n=s)&&!b(i),o=Object.keys(r._attachments),(e?i.get(r._id).then(function(t){return Promise.all(o.map(function(e){return t._attachments&&t._attachments[e]&&t._attachments[e].digest===r._attachments[e].digest?i.getAttachment(t._id,e):n.getAttachment(r._id,e)}))}).catch(function(e){if(404!==e.status)throw e;return Vi(n,r)}):Vi(n,r)).then(function(e){var i=Object.keys(a._attachments);return e.forEach(function(e,t){t=a._attachments[i[t]];delete t.stub,delete t.length,t.data=e}),a})):a}))})).then(function(e){o=o.concat(ve(e).filter(Boolean))})})}).then(function(){return{ok:c,docs:o}})}function $i(t,i,n,r,o){return t.get(i).catch(function(e){if(404===e.status)return"http"!==t.adapter&&"https"!==t.adapter||ee(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:i,history:[],replicator:"pouchdb",version:1};throw e}).then(function(e){if(!o.cancelled&&e.last_seq!==n)return e.history=(e.history||[]).filter(function(e){return e.session_id!==r}),e.history.unshift({last_seq:n,session_id:r}),e.history=e.history.slice(0,5),e.version=1,e.replicator="pouchdb",e.session_id=r,e.last_seq=n,t.put(e).catch(function(e){if(409===e.status)return $i(t,i,n,r,o);throw e})})}function Ki(e,t,i,n,r){this.src=e,this.target=t,this.id=i,this.returnValue=n,this.opts=r||{}}Ki.prototype.writeCheckpoint=function(e,t){var i=this;return this.updateTarget(e,t).then(function(){return i.updateSource(e,t)})},Ki.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?$i(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},Ki.prototype.updateSource=function(e,t){var i;return this.opts.writeSourceCheckpoint?$i((i=this).src,this.id,e,t,this.returnValue).catch(function(e){if(Xi(e))return!(i.opts.writeSourceCheckpoint=!1);throw e}):Promise.resolve(!0)};var Ji={undefined:function(e,t){return 0===z(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return(t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:function e(t,i){var n=t[0],r=t.slice(1),o=i[0],a=i.slice(1);return n&&0!==i.length?Yi(n.session_id,i)?{last_seq:n.last_seq,history:t}:Yi(o.session_id,r)?{last_seq:o.last_seq,history:a}:e(r,a):{last_seq:0,history:[]}}(t.history,e.history)).last_seq}};function Yi(e,t){var i=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===i.session_id||Yi(e,n))}function Xi(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function Qi(c,d,u,p,o){var i,h,n=[],r={seq:0,changes:[],docs:[]},a=!1,s=!1,l=!1,f=0,m=u.continuous||u.live||!1,t=u.batch_size||100,g=u.batches_limit||10,b=!1,v=u.doc_ids,y=u.selector,w=[],k=ze(),x=(o=o||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]},{});function e(){return h?Promise.resolve():(e=c,t=d,r=(i=u).doc_ids?i.doc_ids.sort(z):"",o=i.filter?i.filter.toString():"",l=s=a="",i.selector&&(l=JSON.stringify(i.selector)),i.filter&&i.query_params&&(a=JSON.stringify((n=i.query_params,Object.keys(n).sort(z).reduce(function(e,t){return e[t]=n[t],e},{})))),i.filter&&"_view"===i.filter&&(s=i.view.toString()),Promise.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+o+s+a+r+l;return new Promise(function(e){Ue(t,e)})}).then(function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")}).then(function(e){var t=!1===u.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===u.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===u.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0};h=new Ki(c,d,e,p,t)}));var e,t,i,n,r,o,a,s,l}function E(){var t,e;if(w=[],0!==i.docs.length)return t=i.docs,e={timeout:u.timeout},d.bulkDocs({docs:t,new_edits:!1},e).then(function(e){if(p.cancelled)throw N(),new Error("cancelled");var n=Object.create(null),e=(e.forEach(function(e){e.error&&(n[e.id]=e)}),Object.keys(n).length);o.doc_write_failures+=e,o.docs_written+=t.length-e,t.forEach(function(e){var t=n[e._id];if(t){o.errors.push(t);var i=(t.name||"").toLowerCase();if("unauthorized"!==i&&"forbidden"!==i)throw t;p.emit("denied",B(t))}else w.push(e)})},function(e){throw o.doc_write_failures+=t.length,e})}function C(){if(i.error)throw new Error("There was a problem getting docs.");o.last_seq=f=i.seq;var e=B(o);return w.length&&(e.docs=w,"number"==typeof i.pending&&(e.pending=i.pending,delete i.pending),p.emit("change",e)),a=!0,h.writeCheckpoint(i.seq,k).then(function(){if(a=!1,p.cancelled)throw N(),new Error("cancelled");i=void 0,D()}).catch(function(e){throw R(e),e})}function _(){return Wi(c,d,i.diffs,p).then(function(e){i.error=!e.ok,e.docs.forEach(function(e){delete i.diffs[e._id],o.docs_read++,i.docs.push(e)})})}function S(){var t;p.cancelled||i||(0!==n.length?(i=n.shift(),t={},i.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(e){return e.rev}))}),d.revsDiff(t).then(function(e){if(p.cancelled)throw N(),new Error("cancelled");i.diffs=e}).then(_).then(E).then(C).then(S).catch(function(e){A("batch processing terminated with error",e)})):T(!0))}function T(e){0!==r.changes.length?(e||s||r.changes.length>=t)&&(n.push(r),r={seq:0,changes:[],docs:[]},"pending"!==p.state&&"stopped"!==p.state||(p.state="active",p.emit("active")),S()):0!==n.length||i||((m&&x.live||s)&&(p.state="pending",p.emit("paused")),s&&N())}function A(e,t){l||(t.message||(t.message=e),o.ok=!1,o.status="aborting",n=[],r={seq:0,changes:[],docs:[]},N(t))}function N(e){var t,i,n,r;l||p.cancelled&&(o.status="cancelled",a)||(o.status=o.status||"complete",o.end_time=(new Date).toISOString(),o.last_seq=f,l=!0,e?((e=j(e)).result=o,"unauthorized"===(n=(e.name||"").toLowerCase())||"forbidden"===n?(p.emit("error",e),p.removeAllListeners()):(i=p,n=e,!1===(t=u).retry?(i.emit("error",n),i.removeAllListeners()):("function"!=typeof t.back_off_function&&(t.back_off_function=Z),i.emit("requestError",n),"active"!==i.state&&"pending"!==i.state||(i.emit("paused",n),i.state="stopped",r=function(){t.current_back_off=0},i.once("paused",function(){i.removeListener("active",r)}),i.once("active",r)),t.current_back_off=t.current_back_off||0,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(function(){Qi(c,d,u,p)},t.current_back_off)))):(p.emit("complete",o),p.removeAllListeners()))}function I(e,t,i){if(p.cancelled)return N();"number"==typeof t&&(r.pending=t),be(u)(e)&&(r.seq=e.seq||i,r.changes.push(e),M(function(){T(0===n.length&&x.live)}))}function O(e){if(b=!1,p.cancelled)return N();var t;0<e.results.length?(x.since=e.results[e.results.length-1].seq,D(),T(!0)):(t=function(){m?(x.live=!0,D()):s=!0,T(!0)},i||0!==e.results.length?t():(a=!0,h.writeCheckpoint(e.last_seq,k).then(function(){a=!1,o.last_seq=f=e.last_seq,t()}).catch(R)))}function P(e){if(b=!1,p.cancelled)return N();A("changes rejected",e)}function D(){var e;function t(){e.cancel()}function i(){p.removeListener("cancel",t)}!b&&!s&&n.length<g&&(b=!0,p._changes&&(p.removeListener("cancel",p._abortChanges),p._changes.cancel()),p.once("cancel",t),(e=c.changes(x).on("change",I)).then(i,i),e.then(O).catch(P),u.retry)&&(p._changes=e,p._abortChanges=t)}function L(){e().then(function(){if(!p.cancelled)return h.getCheckpoint().then(function(e){x={since:f=e,limit:t,batch_size:t,style:"all_docs",doc_ids:v,selector:y,return_docs:!0},u.filter&&("string"!=typeof u.filter?x.include_docs=!0:x.filter=u.filter),"heartbeat"in u&&(x.heartbeat=u.heartbeat),"timeout"in u&&(x.timeout=u.timeout),u.query_params&&(x.query_params=u.query_params),u.view&&(x.view=u.view),D()});N()}).catch(function(e){A("getCheckpoint rejected with ",e)})}function R(e){a=!1,A("writeCheckpoint completed with error",e)}p.ready(c,d),p.cancelled?N():(p._addedListeners||(p.once("cancel",N),"function"==typeof u.complete&&(p.once("error",u.complete),p.once("complete",function(e){u.complete(null,e)})),p._addedListeners=!0),void 0===u.since?L():e().then(function(){return a=!0,h.writeCheckpoint(u.since,k)}).then(function(){a=!1,(p.cancelled?N:(f=u.since,L))()}).catch(R))}function Zi(){s.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var i=this,n=new Promise(function(e,t){i.once("complete",e),i.once("error",t)});i.then=function(e,t){return n.then(e,t)},i.catch=function(e){return n.catch(e)},i.catch(function(){})}function en(e,t){var i=t.PouchConstructor;return"string"==typeof e?new i(e,t):e}function tn(e,t,i,n){if("function"==typeof i&&(n=i,i={}),(i=void 0===i?{}:i).doc_ids&&!Array.isArray(i.doc_ids))throw j(ue,"`doc_ids` filter parameter is not a list.");i.complete=n,(i=B(i)).continuous=i.continuous||i.live,i.retry="retry"in i&&i.retry,i.PouchConstructor=i.PouchConstructor||this;n=new Zi;return Qi(en(e,i),en(t,i),i,n),n}function nn(e,t,i,n){return"function"==typeof i&&(n=i,i={}),(i=B(i=void 0===i?{}:i)).PouchConstructor=i.PouchConstructor||this,new rn(e=en(e,i),t=en(t,i),i,n)}function rn(e,t,i,n){var r=this,o=(this.canceled=!1,i.push?te({},i,i.push):i),a=i.pull?te({},i,i.pull):i;function s(e){r.emit("change",{direction:"pull",change:e})}function l(e){r.emit("change",{direction:"push",change:e})}function c(e){r.emit("denied",{direction:"push",doc:e})}function d(e){r.emit("denied",{direction:"pull",doc:e})}function u(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function p(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function h(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function f(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}this.push=tn(e,t,o),this.pull=tn(t,e,a),this.pushPaused=!0,this.pullPaused=!0;var m={};function g(i){return function(e,t){("change"!==e||t!==s&&t!==l)&&("denied"!==e||t!==d&&t!==c)&&("paused"!==e||t!==p&&t!==u)&&("active"!==e||t!==f&&t!==h)||(e in m||(m[e]={}),m[e][i]=!0,2!==Object.keys(m[e]).length)||r.removeAllListeners(e)}}function b(e,t,i){-1==e.listeners(t).indexOf(i)&&e.on(t,i)}i.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",function(e){"change"===e?(b(r.pull,"change",s),b(r.push,"change",l)):"denied"===e?(b(r.pull,"denied",d),b(r.push,"denied",c)):"active"===e?(b(r.pull,"active",f),b(r.push,"active",h)):"paused"===e&&(b(r.pull,"paused",p),b(r.push,"paused",u))}),this.on("removeListener",function(e){"change"===e?(r.pull.removeListener("change",s),r.push.removeListener("change",l)):"denied"===e?(r.pull.removeListener("denied",d),r.push.removeListener("denied",c)):"active"===e?(r.pull.removeListener("active",f),r.push.removeListener("active",h)):"paused"===e&&(r.pull.removeListener("paused",p),r.push.removeListener("paused",u))}),this.pull.on("removeListener",g("pull")),this.push.on("removeListener",g("push"));var v=Promise.all([this.push,this.pull]).then(function(e){e={push:e[0],pull:e[1]};return r.emit("complete",e),n&&n(null,e),r.removeAllListeners(),e},function(e){if(r.cancel(),n?n(e):r.emit("error",e),r.removeAllListeners(),n)throw e});this.then=function(e,t){return v.then(e,t)},this.catch=function(e){return v.catch(e)}}Ki.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(e){return e.last_seq||0}).catch(function(e){if(404!==e.status)throw e;return 0}):t.target.get(t.id).then(function(i){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?i.last_seq||0:t.src.get(t.id).then(function(e){return i.version===e.version&&(t=i.version?i.version.toString():"undefined")in Ji?Ji[t](i,e):0;var t},function(e){if(404===e.status&&i.last_seq)return t.src.put({_id:t.id,last_seq:0}).then(function(){return 0},function(e){return Xi(e)?(t.opts.writeSourceCheckpoint=!1,i.last_seq):0});throw e})}).catch(function(e){if(404!==e.status)throw e;return 0})},t(Zi,s.EventEmitter),Zi.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Zi.prototype.ready=function(e,t){var i=this;function n(){i.cancel()}i._readyCalled||(i._readyCalled=!0,e.once("destroyed",n),t.once("destroyed",n),i.once("complete",function(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)}))},t(rn,s.EventEmitter),rn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},l.plugin(function(e){e.adapter("idb",Zt,!0)}).plugin(function(e){e.adapter("http",oi,!1),e.adapter("https",oi,!1)}).plugin(zi).plugin(function(e){e.replicate=tn,e.sync=nn,Object.defineProperty(e.prototype,"replicate",{get:function(){var n=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(e,t,i){return n.constructor.replicate(e,n,t,i)},to:function(e,t,i){return n.constructor.replicate(n,e,t,i)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,i){return this.constructor.sync(this,e,t,i)}}),ln.exports=l}.call(this)}.call(this,sn("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:270,argsarray:146,events:180,immediate:185,inherits:186,"spark-md5":363,uuid:264,vuvuzela:382}],264:[function(e,t,i){var n=e("./v1"),e=e("./v4"),r=e;r.v1=n,r.v4=e,t.exports=r},{"./v1":267,"./v4":268}],265:[function(e,t,i){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var t=t||0,i=n;return[i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[+t]]].join("")}},{}],266:[function(e,t,i){var n,r,o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);o?(n=new Uint8Array(16),t.exports=function(){return o(n),n}):(r=new Array(16),t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r})},{}],267:[function(e,t,i){var d,u,p=e("./lib/rng"),h=e("./lib/bytesToUuid"),f=0,m=0;t.exports=function(e,t,i){var n=t&&i||0,r=t||[],o=(e=e||{}).node||d,i=void 0!==e.clockseq?e.clockseq:u,a=(null!=o&&null!=i||(a=p(),null==o&&(o=d=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==i&&(i=u=16383&(a[6]<<8|a[7]))),void 0!==e.msecs?e.msecs:(new Date).getTime()),s=void 0!==e.nsecs?e.nsecs:m+1,l=a-f+(s-m)/1e4;if(l<0&&void 0===e.clockseq&&(i=i+1&16383),1e4<=(s=(l<0||f<a)&&void 0===e.nsecs?0:s))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=a,u=i;l=(1e4*(268435455&(a+=122192928e5))+(m=s))%4294967296,r[n++]=l>>>24&255,r[n++]=l>>>16&255,r[n++]=l>>>8&255,r[n++]=255&l,e=a/4294967296*1e4&268435455;r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=i>>>8|128,r[n++]=255&i;for(var c=0;c<6;++c)r[n+c]=o[c];return t||h(r)}},{"./lib/bytesToUuid":265,"./lib/rng":266}],268:[function(e,t,i){var a=e("./lib/rng"),s=e("./lib/bytesToUuid");t.exports=function(e,t,i){var n=t&&i||0,r=("string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),(e=e||{}).random||(e.rng||a)());if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;++o)t[n+o]=r[o];return t||s(r)}},{"./lib/bytesToUuid":265,"./lib/rng":266}],269:[function(e,t,i){!function(s){!function(){"use strict";void 0===s||!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,i,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var r,o,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,i)});case 4:return s.nextTick(function(){e.call(null,t,i,n)});default:for(r=new Array(a-1),o=0;o<r.length;)r[o++]=arguments[o];return s.nextTick(function(){e.apply(null,r)})}}}:t.exports=s}.call(this)}.call(this,e("_process"))},{_process:270}],270:[function(e,t,i){var n,r,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}var l,c=[],d=!1,u=-1;function p(){d&&l&&(d=!1,l.length?c=l.concat(c):u=-1,c.length)&&h()}function h(){if(!d){var e=s(p);d=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,d=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return(r=clearTimeout)(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new f(e,t)),1!==c.length||d||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=m,t.addListener=m,t.once=m,t.off=m,t.removeListener=m,t.removeAllListeners=m,t.emit=m,t.prependListener=m,t.prependOnceListener=m,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],271:[function(e,t,i){"use strict";var a=e("./lib/ReactPropTypesSecret");function n(){}function r(){}r.resetWarningCache=n,t.exports=function(){function e(e,t,i,n,r,o){if(o!==a)throw(o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")).name="Invariant Violation",o}function t(){return e}var i={array:e.isRequired=e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:n};return i.PropTypes=i}},{"./lib/ReactPropTypesSecret":273}],272:[function(e,t,i){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":271}],273:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],274:[function(e,t,i){var n=function(){var c="function"==typeof Object.defineProperty?function(e,t,i){return Object.defineProperty(e,t,i),e}:function(e,t,i){return e[t]=i.value,e};return function(e,t,i,n){var r,o,a,s;if(i=i,s=!(a="object"==typeof(o=n))&&"string"==typeof o,n={enumerable:l("enumerable"),configurable:l("configurable"),writable:l("writable"),value:i},"object"==typeof t){for(r in t)Object.hasOwnProperty.call(t,r)&&(n.value=t[r],c(e,r,n));return e}function l(e){return a?!!o[e]:!!s&&-1<o.indexOf(e[0])}return c(e,t,n)}};void 0!==t&&t.exports?t.exports=n():this.prr=n()},{}],275:[function(n,A,N){"use strict";var I=n("react"),m=n("object-assign"),o=n("scheduler");function B(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!I)throw Error(B(227));var O=null,P={};function D(){if(O)for(var e in P){var t=P[e],i=O.indexOf(e);if(!(-1<i))throw Error(B(96,e));if(!G[i]){if(!t.extractEvents)throw Error(B(97,e));for(var n in i=(G[i]=t).eventTypes){var r=void 0,o=i[n],a=t,s=n;if(V.hasOwnProperty(s))throw Error(B(99,s));var l=(V[s]=o).phasedRegistrationNames;if(l){for(r in l)l.hasOwnProperty(r)&&z(l[r],a,s);r=!0}else r=!!o.registrationName&&(z(o.registrationName,a,s),!0);if(!r)throw Error(B(98,n,e))}}}}function z(e,t,i){if(W[e])throw Error(B(100,e));W[e]=t,$[e]=t.eventTypes[i].dependencies}var G=[],V={},W={},$={};var K=!1,J=null,Y=!1,X=null,Q={onError:function(e){K=!0,J=e}};function Z(e,t,i,n,r,o,a,s,l){K=!1,J=null,function(e,t,i,n,r,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}.apply(Q,arguments)}var ee=null,te=null,ie=null;function ne(e,t,i){var n=e.type||"unknown-event";e.currentTarget=ie(i),function(){if(Z.apply(this,arguments),K){if(!K)throw Error(B(198));var e=J;K=!1,J=null,Y||(Y=!0,X=e)}}(n,t,void 0,e),e.currentTarget=null}function re(e,t){if(null==t)throw Error(B(30));return null==e?t:Array.isArray(e)?(Array.isArray(t)?e.push.apply(e,t):e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function oe(e,t,i){Array.isArray(e)?e.forEach(t,i):e&&t.call(i,e)}var ae=null;function se(e){if(e){var t=e._dispatchListeners,i=e._dispatchInstances;if(Array.isArray(t))for(var n=0;n<t.length&&!e.isPropagationStopped();n++)ne(e,t[n],i[n]);else t&&ne(e,t,i);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function le(e){if(e=ae=null!==e?re(ae,e):ae,ae=null,e){if(oe(e,se),ae)throw Error(B(95));if(Y)throw e=X,Y=!1,X=null,e}}n={injectEventPluginOrder:function(e){if(O)throw Error(B(101));O=Array.prototype.slice.call(e),D()},injectEventPluginsByName:function(e){var t,i=!1;for(t in e)if(e.hasOwnProperty(t)){var n=e[t];if(!P.hasOwnProperty(t)||P[t]!==n){if(P[t])throw Error(B(102,t));P[t]=n,i=!0}}i&&D()}};function ce(e,t){var i=e.stateNode;if(!i)return null;var n=ee(i);if(!n)return null;switch(i=n[t],t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":e=!(n=(n=!n.disabled)||!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e));break;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(B(231,t,typeof i));return i}var a=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,de=(a.hasOwnProperty("ReactCurrentDispatcher")||(a.ReactCurrentDispatcher={current:null}),a.hasOwnProperty("ReactCurrentBatchConfig")||(a.ReactCurrentBatchConfig={suspense:null}),/^(.*)[\\\/]/),e="function"==typeof Symbol&&Symbol.for,ue=e?Symbol.for("react.element"):60103,pe=e?Symbol.for("react.portal"):60106,he=e?Symbol.for("react.fragment"):60107,fe=e?Symbol.for("react.strict_mode"):60108,me=e?Symbol.for("react.profiler"):60114,ge=e?Symbol.for("react.provider"):60109,be=e?Symbol.for("react.context"):60110,ve=e?Symbol.for("react.concurrent_mode"):60111,ye=e?Symbol.for("react.forward_ref"):60112,we=e?Symbol.for("react.suspense"):60113,ke=e?Symbol.for("react.suspense_list"):60120,xe=e?Symbol.for("react.memo"):60115,Ee=e?Symbol.for("react.lazy"):60116,Ce=(e&&Symbol.for("react.fundamental"),e&&Symbol.for("react.responder"),e&&Symbol.for("react.scope"),"function"==typeof Symbol&&Symbol.iterator);function _e(e){return null!==e&&"object"==typeof e&&"function"==typeof(e=Ce&&e[Ce]||e["@@iterator"])?e:null}function Se(e){if(null!=e){if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case he:return"Fragment";case pe:return"Portal";case me:return"Profiler";case fe:return"StrictMode";case we:return"Suspense";case ke:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case be:return"Context.Consumer";case ge:return"Context.Provider";case ye:var t=(t=e.render).displayName||t.name||"";return e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case xe:return Se(e.type);case Ee:if(e=1===e._status?e._result:null)return Se(e)}}return null}function Te(e){var t="";do{switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var i="";break;default:var n=e._debugOwner,r=e._debugSource,o=Se(e.type),i=null;n&&(i=Se(n.type)),n=o,o="",r?o=" (at "+r.fileName.replace(de,"")+":"+r.lineNumber+")":i&&(o=" (created by "+i+")"),i="\n    in "+(n||"Unknown")+o}}while(t+=i,e=e.return);return t}var Ae=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Ne=null,Ie=null,Oe=null;function Pe(e){if(e=te(e)){if("function"!=typeof Ne)throw Error(B(280));var t=ee(e.stateNode);Ne(e.stateNode,e.type,t)}}function De(e){Ie?Oe?Oe.push(e):Oe=[e]:Ie=e}function Le(){if(Ie){var e=Ie,t=Oe;if(Oe=Ie=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function Re(e,t){return e(t)}function Me(e,t,i,n){return e(t,i,n)}function Be(){}var je=Re,Fe=!1,Ue=!1;function He(){null===Ie&&null===Oe||(Be(),Le())}new Map;var qe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ze=Object.prototype.hasOwnProperty,Ge={},Ve={};function i(e,t,i,n,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=o}var s={},We=("children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){s[e]=new i(e,0,!1,e,null,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];s[t]=new i(t,1,!1,e[1],null,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){s[e]=new i(e,2,!1,e.toLowerCase(),null,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){s[e]=new i(e,2,!1,e,null,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){s[e]=new i(e,3,!1,e.toLowerCase(),null,!1)}),["checked","multiple","muted","selected"].forEach(function(e){s[e]=new i(e,3,!0,e,null,!1)}),["capture","download"].forEach(function(e){s[e]=new i(e,4,!1,e,null,!1)}),["cols","rows","size","span"].forEach(function(e){s[e]=new i(e,6,!1,e,null,!1)}),["rowSpan","start"].forEach(function(e){s[e]=new i(e,5,!1,e.toLowerCase(),null,!1)}),/[\-:]([a-z])/g);function $e(e){return e[1].toUpperCase()}function Ke(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Je(e,n,t,i){var r,o=s.hasOwnProperty(n)?s[n]:null;(null!==o?0!==o.type:i||!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&(function(e,t,i){if(null==e||function(e,t,i,n){if(null===i||0!==i.type)switch(typeof t){case"function":case"symbol":return 1;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return}}(n,e,t,i))return 1;if(!i&&null!==t)switch(t.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||e<1}}(t,o,i)&&(t=null),i||null===o?(r=n,(ze.call(Ve,r)||!ze.call(Ge,r)&&(qe.test(r)?Ve[r]=!0:(Ge[r]=!0,0)))&&(null===t?e.removeAttribute(n):e.setAttribute(n,""+t))):o.mustUseProperty?e[o.propertyName]=null===t?3!==o.type&&"":t:(n=o.attributeName,i=o.attributeNamespace,null===t?e.removeAttribute(n):(t=3===(o=o.type)||4===o&&!0===t?"":""+t,i?e.setAttributeNS(i,n,t):e.setAttribute(n,t))))}function Ye(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Xe(e){e._valueTracker||(e._valueTracker=function(e){var t,i,n=Ye(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),o=""+e[n];if(!e.hasOwnProperty(n)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set)return t=r.get,i=r.set,Object.defineProperty(e,n,{configurable:!0,get:function(){return t.call(this)},set:function(e){o=""+e,i.call(this,e)}}),Object.defineProperty(e,n,{enumerable:r.enumerable}),{getValue:function(){return o},setValue:function(e){o=""+e},stopTracking:function(){e._valueTracker=null,delete e[n]}}}(e))}function Qe(e){var t,i,n;if(e)return(t=e._valueTracker)?(i=t.getValue(),n="",(e=n=e?Ye(e)?e.checked?"true":"false":e.value:n)!==i&&(t.setValue(e),1)):1}function Ze(e,t){var i=t.checked;return m({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function et(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked,i=Ke(null!=t.value?t.value:i);e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function tt(e,t){null!=(t=t.checked)&&Je(e,"checked",t,!1)}function it(e,t){tt(e,t);var i=Ke(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return e.removeAttribute("value");t.hasOwnProperty("value")?rt(e,t.type,i):t.hasOwnProperty("defaultValue")&&rt(e,t.type,Ke(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function nt(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function rt(e,t,i){"number"===t&&e.ownerDocument.activeElement===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}function ot(e,t){return e=m({children:void 0},t),i=t.children,n="",I.Children.forEach(i,function(e){null!=e&&(n+=e)}),(t=n)&&(e.children=t),e;var i,n}function at(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+Ke(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,n&&(e[r].defaultSelected=!0);null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function st(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(B(91));return m({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function lt(e,t){var i=t.value;if(null==i){if(i=t.defaultValue,null!=(t=t.children)){if(null!=i)throw Error(B(92));if(Array.isArray(t)){if(!(t.length<=1))throw Error(B(93));t=t[0]}i=t}null==i&&(i="")}e._wrapperState={initialValue:Ke(i)}}function ct(e,t){var i=Ke(t.value),n=Ke(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue)&&e.defaultValue!==i&&(e.defaultValue=i),null!=n&&(e.defaultValue=""+n)}function dt(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(We,$e);s[t]=new i(t,1,!1,e,null,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(We,$e);s[t]=new i(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(We,$e);s[t]=new i(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)}),["tabIndex","crossOrigin"].forEach(function(e){s[e]=new i(e,1,!1,e.toLowerCase(),null,!1)}),s.xlinkHref=new i("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach(function(e){s[e]=new i(e,1,!1,e.toLowerCase(),null,!0)});var ut="http://www.w3.org/1999/xhtml";function pt(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ht(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pt(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}mt=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ft=ft||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ft.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}};var ft,mt,gt="undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction(function(){return mt(e,t)})}:mt;function bt(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return i.nodeValue=t}e.textContent=t}function vt(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var yt={animationend:vt("Animation","AnimationEnd"),animationiteration:vt("Animation","AnimationIteration"),animationstart:vt("Animation","AnimationStart"),transitionend:vt("Transition","TransitionEnd")},wt={},kt={};function xt(e){if(wt[e])return wt[e];if(yt[e]){var t,i=yt[e];for(t in i)if(i.hasOwnProperty(t)&&t in kt)return wt[e]=i[t]}return e}Ae&&(kt=document.createElement("div").style,"AnimationEvent"in window||(delete yt.animationend.animation,delete yt.animationiteration.animation,delete yt.animationstart.animation),"TransitionEvent"in window||delete yt.transitionend.transition);var Et=xt("animationend"),Ct=xt("animationiteration"),_t=xt("animationstart"),St=xt("transitionend"),Tt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function At(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else for(e=t;0!=(1026&(t=e).effectTag)&&(i=t.return),e=t.return;);return 3===t.tag?i:null}function Nt(e){if(13===e.tag){var t=e.memoizedState;if(null!==(t=null===t&&null!==(e=e.alternate)?e.memoizedState:t))return t.dehydrated}return null}function It(e){if(At(e)!==e)throw Error(B(188))}function Ot(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=At(e)))throw Error(B(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var o=r.alternate;if(null===o){if(null===(n=r.return))break;i=n}else{if(r.child===o.child){for(o=r.child;o;){if(o===i)return It(r),e;if(o===n)return It(r),t;o=o.sibling}throw Error(B(188))}if(i.return!==n.return)i=r,n=o;else{for(var a=!1,s=r.child;s;){if(s===i){a=!0,i=r,n=o;break}if(s===n){a=!0,n=r,i=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===i){a=!0,i=o,n=r;break}if(s===n){a=!0,n=o,i=r;break}s=s.sibling}if(!a)throw Error(B(189))}}if(i.alternate!==n)throw Error(B(190))}}if(3!==i.tag)throw Error(B(188));return i.stateNode.current===i?e:t}(e))for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t=(t.child.return=t).child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var Pt,Dt,Lt,Rt=!1,r=[],Mt=null,Bt=null,jt=null,Ft=new Map,Ut=new Map,Ht=[],qt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),zt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Gt(e,t,i,n){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|i,nativeEvent:n}}function Vt(e,t){switch(e){case"focus":case"blur":Mt=null;break;case"dragenter":case"dragleave":Bt=null;break;case"mouseover":case"mouseout":jt=null;break;case"pointerover":case"pointerout":Ft.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ut.delete(t.pointerId)}}function Wt(e,t,i,n,r){return null===e||e.nativeEvent!==r?(e=Gt(t,i,n,r),null!==t&&null!==(t=Nn(t))&&Dt(t)):e.eventSystemFlags|=n,e}function $t(e){var t,i;if(null===e.blockedOn)return null===(t=Ki(e.topLevelType,e.eventSystemFlags,e.nativeEvent))||(null!==(i=Nn(t))&&Dt(i),e.blockedOn=t,0)}function Kt(e,t,i){$t(e)&&i.delete(t)}function Jt(){for(Rt=!1;0<r.length;){var e=r[0];if(null!==e.blockedOn){null!==(e=Nn(e.blockedOn))&&Pt(e);break}var t=Ki(e.topLevelType,e.eventSystemFlags,e.nativeEvent);null!==t?e.blockedOn=t:r.shift()}null!==Mt&&$t(Mt)&&(Mt=null),null!==Bt&&$t(Bt)&&(Bt=null),null!==jt&&$t(jt)&&(jt=null),Ft.forEach(Kt),Ut.forEach(Kt)}function Yt(e,t){e.blockedOn===t&&(e.blockedOn=null,Rt||(Rt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,Jt)))}function Xt(t){function e(e){return Yt(e,t)}if(0<r.length){Yt(r[0],t);for(var i=1;i<r.length;i++){var n=r[i];n.blockedOn===t&&(n.blockedOn=null)}}for(null!==Mt&&Yt(Mt,t),null!==Bt&&Yt(Bt,t),null!==jt&&Yt(jt,t),Ft.forEach(e),Ut.forEach(e),i=0;i<Ht.length;i++)(n=Ht[i]).blockedOn===t&&(n.blockedOn=null);for(;0<Ht.length&&null===(i=Ht[0]).blockedOn;)(function(e){var t=An(e.target);if(null!==t){var i=At(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Nt(i)))return e.blockedOn=t,o.unstable_runWithPriority(e.priority,function(){Lt(i)})}else if(3===t&&i.stateNode.hydrate)return e.blockedOn=3===i.tag?i.stateNode.containerInfo:null}e.blockedOn=null})(i),null===i.blockedOn&&Ht.shift()}function Qt(e){return 3===(e=(e=e.target||e.srcElement||window).correspondingUseElement?e.correspondingUseElement:e).nodeType?e.parentNode:e}function Zt(e){for(;(e=e.return)&&5!==e.tag;);return e||null}function ei(e,t,i){(t=ce(e,i.dispatchConfig.phasedRegistrationNames[t]))&&(i._dispatchListeners=re(i._dispatchListeners,t),i._dispatchInstances=re(i._dispatchInstances,e))}function ti(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,i=[];t;)i.push(t),t=Zt(t);for(t=i.length;0<t--;)ei(i[t],"captured",e);for(t=0;t<i.length;t++)ei(i[t],"bubbled",e)}}function ii(e,t,i){e&&i&&i.dispatchConfig.registrationName&&(t=ce(e,i.dispatchConfig.registrationName))&&(i._dispatchListeners=re(i._dispatchListeners,t),i._dispatchInstances=re(i._dispatchInstances,e))}function ni(e){e&&e.dispatchConfig.registrationName&&ii(e._targetInst,null,e)}function ri(e){oe(e,ti)}function oi(){return!0}function ai(){return!1}function l(e,t,i,n){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=i,e=this.constructor.Interface)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(i):"target"===r?this.target=n:this[r]=i[r]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?oi:ai,this.isPropagationStopped=ai,this}function si(e,t,i,n){var r;return this.eventPool.length?(r=this.eventPool.pop(),this.call(r,e,t,i,n),r):new this(e,t,i,n)}function li(e){if(!(e instanceof this))throw Error(B(279));e.destructor(),this.eventPool.length<10&&this.eventPool.push(e)}function ci(e){e.eventPool=[],e.getPooled=si,e.release=li}m(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=oi)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=oi)},persist:function(){this.isPersistent=oi},isPersistent:ai,destructor:function(){for(var e in this.constructor.Interface)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=ai,this._dispatchInstances=this._dispatchListeners=null}}),l.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},l.extend=function(e){function t(){}function i(){return n.apply(this,arguments)}var n=this,r=(t.prototype=n.prototype,new t);return m(r,i.prototype),((i.prototype=r).constructor=i).Interface=m({},n.Interface,e),i.extend=n.extend,ci(i),i},ci(l);var di=l.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ui=l.extend({clipboardData:function(e){return("clipboardData"in e?e:window).clipboardData}}),pi=l.extend({view:null,detail:null}),hi=pi.extend({relatedTarget:null});function fi(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,32<=(e=10===e?13:e)||13===e?e:0}var mi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vi(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=bi[e])&&!!t[e]}function yi(){return vi}for(var wi=pi.extend({key:function(e){if(e.key){var t=mi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=fi(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?gi[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:yi,charCode:function(e){return"keypress"===e.type?fi(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?fi(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ki=0,xi=0,Ei=!1,Ci=!1,_i=pi.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:yi,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){var t;return"movementX"in e?e.movementX:(t=ki,ki=e.screenX,Ei?"mousemove"===e.type?e.screenX-t:0:(Ei=!0,0))},movementY:function(e){var t;return"movementY"in e?e.movementY:(t=xi,xi=e.screenY,Ci?"mousemove"===e.type?e.screenY-t:0:(Ci=!0,0))}}),Si=_i.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Ti=_i.extend({dataTransfer:null}),Ai=pi.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:yi}),Ni=l.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),Ii=_i.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),Oi=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Et,"animationEnd",2],[Ct,"animationIteration",2],[_t,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[St,"transitionEnd",2],["waiting","waiting",2]],Pi={},Di={},Li=0;Li<Oi.length;Li++){var Ri=Oi[Li],Mi=Ri[0],Bi=Ri[1],Ri=Ri[2],ji="on"+(Bi[0].toUpperCase()+Bi.slice(1)),ji={phasedRegistrationNames:{bubbled:ji,captured:ji+"Capture"},dependencies:[Mi],eventPriority:Ri};Di[Mi]=Pi[Bi]=ji}var e={eventTypes:Pi,getEventPriority:function(e){return void 0!==(e=Di[e])?e.eventPriority:2},extractEvents:function(e,t,i,n){var r=Di[e];if(!r)return null;switch(e){case"keypress":if(0===fi(i))return null;case"keydown":case"keyup":e=wi;break;case"blur":case"focus":e=hi;break;case"click":if(2===i.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=_i;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=Ti;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=Ai;break;case Et:case Ct:case _t:e=di;break;case St:e=Ni;break;case"scroll":e=pi;break;case"wheel":e=Ii;break;case"copy":case"cut":case"paste":e=ui;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Si;break;default:e=l}return ri(t=e.getPooled(r,t,i,n)),t}},Fi=o.unstable_UserBlockingPriority,Ui=o.unstable_runWithPriority,Hi=e.getEventPriority,qi=[];function zi(e){var t=n=e.targetInst;do{if(!t){e.ancestors.push(t);break}var i=t;if(3===i.tag)i=i.stateNode.containerInfo;else{for(;i.return;)i=i.return;i=3!==i.tag?null:i.stateNode.containerInfo}}while(i&&(5!==(n=t.tag)&&6!==n||e.ancestors.push(t),t=An(i)));for(t=0;t<e.ancestors.length;t++){for(var n=e.ancestors[t],r=Qt(e.nativeEvent),i=e.topLevelType,o=e.nativeEvent,a=e.eventSystemFlags,s=null,l=0;l<G.length;l++){var c=G[l];(c=c&&c.extractEvents(i,n,o,r,a))&&(s=re(s,c))}le(s)}}var Gi=!0;function g(e,t){Vi(t,e,!1)}function Vi(e,t,i){switch(Hi(t)){case 0:var n=function(e,t,i){Fe||Be();var n=$i,r=Fe;Fe=!0;try{Me(n,e,t,i)}finally{(Fe=r)||He()}}.bind(null,t,1);break;case 1:n=function(e,t,i){Ui(Fi,$i.bind(null,e,t,i))}.bind(null,t,1);break;default:n=$i.bind(null,t,1)}i?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1)}function Wi(e,t,i,n){var r;e=qi.length?((r=qi.pop()).topLevelType=e,r.eventSystemFlags=t,r.nativeEvent=i,r.targetInst=n,r):{topLevelType:e,eventSystemFlags:t,nativeEvent:i,targetInst:n,ancestors:[]};try{if(t=zi,i=e,Ue)t(i,void 0);else{Ue=!0;try{je(t,i,void 0)}finally{Ue=!1,He()}}}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,qi.length<10&&qi.push(e)}}function $i(e,t,i){var n;Gi&&(0<r.length&&-1<qt.indexOf(e)?(e=Gt(null,e,t,i),r.push(e)):null===(n=Ki(e,t,i))?Vt(e,i):-1<qt.indexOf(e)?(e=Gt(n,e,t,i),r.push(e)):function(e,t,i,n){switch(t){case"focus":return Mt=Wt(Mt,e,t,i,n),1;case"dragenter":return Bt=Wt(Bt,e,t,i,n),1;case"mouseover":return jt=Wt(jt,e,t,i,n),1;case"pointerover":var r=n.pointerId;return Ft.set(r,Wt(Ft.get(r)||null,e,t,i,n)),1;case"gotpointercapture":return r=n.pointerId,Ut.set(r,Wt(Ut.get(r)||null,e,t,i,n)),1}}(n,e,t,i)||(Vt(e,i),Wi(e,t,i,null)))}function Ki(e,t,i){var n=Qt(i);if(null!==(n=An(n))){var r=At(n);if(null===r)n=null;else{var o=r.tag;if(13===o){if(null!==(n=Nt(r)))return n;n=null}else if(3===o){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Wi(e,t,i,n),null}function Ji(e){var t;return!!Ae&&((t=(e="on"+e)in document)||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t)}var Yi=new("function"==typeof WeakMap?WeakMap:Map);function Xi(e){var t=Yi.get(e);return void 0===t&&(t=new Set,Yi.set(e,t)),t}function Qi(e,t,i){if(!i.has(e)){switch(e){case"scroll":Vi(t,"scroll",!0);break;case"focus":case"blur":Vi(t,"focus",!0),Vi(t,"blur",!0),i.add("blur"),i.add("focus");break;case"cancel":case"close":Ji(e)&&Vi(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Tt.indexOf(e)&&g(e,t)}i.add(e)}}var Zi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},en=["Webkit","ms","Moz","O"];function tn(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||Zi.hasOwnProperty(e)&&Zi[e]?(""+t).trim():t+"px"}function nn(e,t){for(var i in e=e.style,t){var n,r;t.hasOwnProperty(i)&&(n=0===i.indexOf("--"),r=tn(i,t[i],n),"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r)}}Object.keys(Zi).forEach(function(t){en.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Zi[e]=Zi[t]})});var rn=m({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function on(e,t){if(t){if(rn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(B(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(B(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(B(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(B(62,""))}}function an(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function sn(e,t){var i=Xi(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=$[t];for(var n=0;n<t.length;n++)Qi(t[n],e,i)}function ln(){}function cn(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function dn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function un(e,t){var i,n=dn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&t<=i)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=dn(n)}}function pn(){for(var e=window,t=cn();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=cn((e=t.contentWindow).document)}return t}function hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var fn="$?",mn="$!",gn=null,bn=null;function vn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function yn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var wn="function"==typeof setTimeout?setTimeout:void 0,kn="function"==typeof clearTimeout?clearTimeout:void 0;function xn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function En(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||i===mn||i===fn){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var Cn=Math.random().toString(36).slice(2),_n="__reactInternalInstance$"+Cn,Sn="__reactEventHandlers$"+Cn,Tn="__reactContainere$"+Cn;function An(e){var t=e[_n];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Tn]||i[_n]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=En(e);null!==e;){if(i=e[_n])return i;e=En(e)}return t}i=(e=i).parentNode}return null}function Nn(e){return!(e=e[_n]||e[Tn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function In(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(B(33))}function On(e){return e[Sn]||null}var Pn=null,Dn=null,Ln=null;function Rn(){if(Ln)return Ln;for(var e=Dn,t=e.length,i=("value"in Pn?Pn.value:Pn.textContent),n=i.length,r=0;r<t&&e[r]===i[r];r++);for(var o=t-r,a=1;a<=o&&e[t-a]===i[n-a];a++);return Ln=i.slice(r,1<a?1-a:void 0)}var Mn=l.extend({data:null}),Bn=l.extend({data:null}),jn=[9,13,27,32],Fn=Ae&&"CompositionEvent"in window,Cn=null,Un=(Ae&&"documentMode"in document&&(Cn=document.documentMode),Ae&&"TextEvent"in window&&!Cn),Hn=Ae&&(!Fn||Cn&&8<Cn&&Cn<=11),qn=String.fromCharCode(32),zn={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Gn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==jn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return 1;default:return}}function Wn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var $n=!1,Cn={eventTypes:zn,extractEvents:function(i,e,t,n){var r;if(Fn)e:{switch(i){case"compositionstart":var o=zn.compositionStart;break e;case"compositionend":o=zn.compositionEnd;break e;case"compositionupdate":o=zn.compositionUpdate;break e}o=void 0}else $n?Vn(i,t)&&(o=zn.compositionEnd):"keydown"===i&&229===t.keyCode&&(o=zn.compositionStart);return r=o?(Hn&&"ko"!==t.locale&&($n||o!==zn.compositionStart?o===zn.compositionEnd&&$n&&(r=Rn()):(Dn="value"in(Pn=n)?Pn.value:Pn.textContent,$n=!0)),o=Mn.getPooled(o,e,t,n),!r&&null===(r=Wn(t))||(o.data=r),ri(o),o):null,(i=Un?function(e,t){switch(i){case"compositionend":return Wn(t);case"keypress":return 32!==t.which?null:(Gn=!0,qn);case"textInput":return(e=t.data)===qn&&Gn?null:e;default:return null}}(0,t):function(e,t){if($n)return"compositionend"===e||!Fn&&Vn(e,t)?(e=Rn(),Ln=Dn=Pn=null,$n=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hn&&"ko"!==t.locale?null:t.data;default:return null}}(i,t))?((e=Bn.getPooled(zn.beforeInput,e,t,n)).data=i,ri(e)):e=null,null===r?e:null===e?r:[r,e]}},Kn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?Kn[e.type]:"textarea"===t}var Yn={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Xn(e,t,i){return(e=l.getPooled(Yn.change,e,t,i)).type="change",De(i),ri(e),e}var Qn=null,Zn=null;function er(e){le(e)}function tr(e){if(Qe(In(e)))return e}function ir(e,t){if("change"===e)return t}var nr=!1;function rr(){Qn&&(Qn.detachEvent("onpropertychange",or),Zn=Qn=null)}function or(e){if("value"===e.propertyName&&tr(Zn))if(e=Xn(Zn,e,Qt(e)),Fe)le(e);else{Fe=!0;try{Re(er,e)}finally{Fe=!1,He()}}}function ar(e,t,i){"focus"===e?(rr(),Zn=i,(Qn=t).attachEvent("onpropertychange",or)):"blur"===e&&rr()}function sr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return tr(Zn)}function lr(e,t){if("click"===e)return tr(t)}function cr(e,t){if("input"===e||"change"===e)return tr(t)}Ae&&(nr=Ji("input")&&(!document.documentMode||9<document.documentMode));var dr,ur={eventTypes:Yn,_isInputEventSupported:nr,extractEvents:function(e,t,i,n){var r,o,a=t?In(t):window,s=a.nodeName&&a.nodeName.toLowerCase();if("select"===s||"input"===s&&"file"===a.type?r=ir:Jn(a)?nr?r=cr:(r=sr,o=ar):!(s=a.nodeName)||"input"!==s.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type||(r=lr),r=r&&r(e,t))return Xn(r,i,n);o&&o(e,a,t),"blur"===e&&(e=a._wrapperState)&&e.controlled&&"number"===a.type&&rt(a,"number",a.value)}},pr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},hr={eventTypes:pr,extractEvents:function(e,t,i,n,r){var o,a,s,l,c="mouseover"===e||"pointerover"===e,d="mouseout"===e||"pointerout"===e;if(c&&0==(32&r)&&(i.relatedTarget||i.fromElement)||!d&&!c)return null;if(r=n.window===n?n:(r=n.ownerDocument)?r.defaultView||r.parentWindow:window,d?(d=t,null!==(t=(t=i.relatedTarget||i.toElement)?An(t):null)&&(t!==At(t)||5!==t.tag&&6!==t.tag)&&(t=null)):d=null,d===t)return null;if("mouseout"===e||"mouseover"===e?(o=_i,a=pr.mouseLeave,s=pr.mouseEnter,l="mouse"):"pointerout"!==e&&"pointerover"!==e||(o=Si,a=pr.pointerLeave,s=pr.pointerEnter,l="pointer"),e=null==d?r:In(d),r=null==t?r:In(t),(a=o.getPooled(a,d,i,n)).type=l+"leave",a.target=e,a.relatedTarget=r,(n=o.getPooled(s,t,i,n)).type=l+"enter",n.target=r,n.relatedTarget=e,l=t,(o=d)&&l)e:{for(e=l,d=0,t=s=o;t;t=Zt(t))d++;for(t=0,r=e;r;r=Zt(r))t++;for(;0<d-t;)s=Zt(s),d--;for(;0<t-d;)e=Zt(e),t--;for(;d--;){if(s===e||s===e.alternate)break e;s=Zt(s),e=Zt(e)}s=null}else s=null;for(e=s,s=[];o&&o!==e&&(null===(d=o.alternate)||d!==e);)s.push(o),o=Zt(o);for(o=[];l&&l!==e&&(null===(d=l.alternate)||d!==e);)o.push(l),l=Zt(l);for(l=0;l<s.length;l++)ii(s[l],"bubbled",a);for(l=o.length;0<l--;)ii(o[l],"captured",n);return i===dr?(dr=null,[a]):(dr=i,[a,n])}},fr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},mr=Object.prototype.hasOwnProperty;function gr(e,t){if(fr(e,t))return 1;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){var i=Object.keys(e),n=Object.keys(t);if(i.length===n.length){for(n=0;n<i.length;n++)if(!mr.call(t,i[n])||!fr(e[i[n]],t[i[n]]))return;return 1}}}var br=Ae&&"documentMode"in document&&document.documentMode<=11,vr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},yr=null,wr=null,kr=null,xr=!1;function Er(e,t){var i=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return xr||null==yr||yr!==cn(i)||(i="selectionStart"in(i=yr)&&hn(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},kr&&gr(kr,i))?null:(kr=i,(e=l.getPooled(vr.select,wr,e,t)).type="select",e.target=yr,ri(e),e)}var Cr={eventTypes:vr,extractEvents:function(e,t,i,n){if(!(o=!(r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument))){e:{for(var r=Xi(r),o=$.onSelect,a=0;a<o.length;a++)if(!r.has(o[a])){r=!1;break e}r=!0}o=!r}if(!o)switch(r=t?In(t):window,e){case"focus":!Jn(r)&&"true"!==r.contentEditable||(yr=r,wr=t,kr=null);break;case"blur":kr=wr=yr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":return xr=!1,Er(i,n);case"selectionchange":if(br)break;case"keydown":case"keyup":return Er(i,n)}return null}},_r=(n.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),ee=On,te=Nn,ie=In,n.injectEventPluginsByName({SimpleEventPlugin:e,EnterLeaveEventPlugin:hr,ChangeEventPlugin:ur,SelectEventPlugin:Cr,BeforeInputEventPlugin:Cn}),new Set,[]),Sr=-1;function b(e){Sr<0||(e.current=_r[Sr],_r[Sr]=null,Sr--)}function v(e,t){_r[++Sr]=e.current,e.current=t}var Tr={},f={current:Tr},y={current:!1},Ar=Tr;function Nr(e,t){var i=e.type.contextTypes;if(!i)return Tr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in i)o[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function w(e){return null!=e.childContextTypes}function Ir(){b(y),b(f)}function Or(){b(y),b(f)}function Pr(e,t,i){if(f.current!==Tr)throw Error(B(168));v(f,t),v(y,i)}function Dr(e,t,i){var n,r=e.stateNode;if(e=t.childContextTypes,"function"!=typeof r.getChildContext)return i;for(n in r=r.getChildContext())if(!(n in e))throw Error(B(108,Se(t)||"Unknown",n));return m({},i,{},r)}function Lr(e){e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr;Ar=f.current,v(f,e),v(y,y.current)}function Rr(e,t,i){var n=e.stateNode;if(!n)throw Error(B(169));i?(t=Dr(e,t,Ar),n.__reactInternalMemoizedMergedChildContext=t,b(y),b(f),v(f,t)):b(y),v(y,i)}var Mr=o.unstable_runWithPriority,Br=o.unstable_scheduleCallback,jr=o.unstable_cancelCallback,Fr=o.unstable_shouldYield,e=o.unstable_requestPaint,Ur=o.unstable_now,Hr=o.unstable_getCurrentPriorityLevel,qr=o.unstable_ImmediatePriority,zr=o.unstable_UserBlockingPriority,Gr=o.unstable_NormalPriority,Vr=o.unstable_LowPriority,Wr=o.unstable_IdlePriority,$r={},Kr=void 0!==e?e:function(){},Jr=null,Yr=null,Xr=!1,Qr=Ur(),k=Qr<1e4?Ur:function(){return Ur()-Qr};function Zr(){switch(Hr()){case qr:return 99;case zr:return 98;case Gr:return 97;case Vr:return 96;case Wr:return 95;default:throw Error(B(332))}}function eo(e){switch(e){case 99:return qr;case 98:return zr;case 97:return Gr;case 96:return Vr;case 95:return Wr;default:throw Error(B(332))}}function to(e,t){return e=eo(e),Mr(e,t)}function io(e,t,i){return e=eo(e),Br(e,t,i)}function no(e){return null===Jr?(Jr=[e],Yr=Br(qr,ro)):Jr.push(e),$r}function L(){var e;null!==Yr&&(e=Yr,Yr=null,jr(e)),ro()}function ro(){if(!Xr&&null!==Jr){Xr=!0;var t=0;try{var i=Jr;to(99,function(){for(;t<i.length;t++)for(var e=i[t];null!==(e=e(!0)););}),Jr=null}catch(i){throw null!==Jr&&(Jr=Jr.slice(t+1)),Br(qr,L),i}finally{Xr=!1}}}var oo=3;function ao(e,t,i){return 1073741821-(1+((1073741821-e+t/10)/(i/=10)|0))*i}function R(e,t){if(e&&e.defaultProps)for(var i in t=m({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}var so={current:null},lo=null,co=null,uo=null;function po(){uo=co=lo=null}function ho(e,t){e=e.type._context;v(so,e._currentValue),e._currentValue=t}function fo(e){var t=so.current;b(so),e.type._context._currentValue=t}function mo(e,t){for(;null!==e;){var i=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==i&&i.childExpirationTime<t&&(i.childExpirationTime=t);else{if(!(null!==i&&i.childExpirationTime<t))break;i.childExpirationTime=t}e=e.return}}function go(e,t){(uo=co=null)!==(e=(lo=e).dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(h=!0),e.firstContext=null)}function x(e,t){if(uo!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(uo=e,t=1073741823),t={context:e,observedBits:t,next:null},null===co){if(null===lo)throw Error(B(308));co=t,lo.dependencies={expirationTime:0,firstContext:t,responders:null}}else co=co.next=t;return e._currentValue}var bo=!1;function vo(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function yo(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function wo(e,t){return{expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function ko(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function xo(e,t){var i,n,r=e.alternate;null===r?(n=null)===(i=e.updateQueue)&&(i=e.updateQueue=vo(e.memoizedState)):(i=e.updateQueue,n=r.updateQueue,null===i?null===n?(i=e.updateQueue=vo(e.memoizedState),n=r.updateQueue=vo(r.memoizedState)):i=e.updateQueue=yo(n):null===n&&(n=r.updateQueue=yo(i))),null===n||i===n?ko(i,t):null===i.lastUpdate||null===n.lastUpdate?(ko(i,t),ko(n,t)):(ko(i,t),n.lastUpdate=t)}function Eo(e,t){var i=e.updateQueue;null===(i=null===i?e.updateQueue=vo(e.memoizedState):Co(e,i)).lastCapturedUpdate?i.firstCapturedUpdate=i.lastCapturedUpdate=t:(i.lastCapturedUpdate.next=t,i.lastCapturedUpdate=t)}function Co(e,t){var i=e.alternate;return t=null!==i&&t===i.updateQueue?e.updateQueue=yo(t):t}function _o(e,t,i,n,r,o){switch(i.tag){case 1:return"function"==typeof(e=i.payload)?e.call(o,n,r):e;case 3:e.effectTag=-4097&e.effectTag|64;case 0:if(null==(r="function"==typeof(e=i.payload)?e.call(o,n,r):e))break;return m({},n,r);case 2:bo=!0}return n}function So(e,t,i,n,r){bo=!1;for(var o=(t=Co(e,t)).baseState,a=null,s=0,l=t.firstUpdate,c=o;null!==l;){var d=l.expirationTime;d<r?(null===a&&(a=l,o=c),s<d&&(s=d)):(el(d,l.suspenseConfig),c=_o(e,0,l,c,i,n),null!==l.callback&&(e.effectTag|=32,(l.nextEffect=null)===t.lastEffect?t.firstEffect=t.lastEffect=l:(t.lastEffect.nextEffect=l,t.lastEffect=l))),l=l.next}for(d=null,l=t.firstCapturedUpdate;null!==l;){var u=l.expirationTime;u<r?(null===d&&(d=l,null===a)&&(o=c),s<u&&(s=u)):(c=_o(e,0,l,c,i,n),null!==l.callback&&(e.effectTag|=32,(l.nextEffect=null)===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=l:(t.lastCapturedEffect.nextEffect=l,t.lastCapturedEffect=l))),l=l.next}null===a&&(t.lastUpdate=null),null===d?t.lastCapturedUpdate=null:e.effectTag|=32,null===a&&null===d&&(o=c),t.baseState=o,t.firstUpdate=a,t.firstCapturedUpdate=d,tl(s),e.expirationTime=s,e.memoizedState=c}function To(e,t,i){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),Ao(t.firstEffect,i),t.firstEffect=t.lastEffect=null,Ao(t.firstCapturedEffect,i),t.firstCapturedEffect=t.lastCapturedEffect=null}function Ao(e,t){for(;null!==e;){var i=e.callback;if(null!==i){e.callback=null;var n=t;if("function"!=typeof i)throw Error(B(191,i));i.call(n)}e=e.nextEffect}}var No=a.ReactCurrentBatchConfig,Io=(new I.Component).refs;function Oo(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:m({},t,i),e.memoizedState=i,null!==(n=e.updateQueue)&&0===e.expirationTime&&(n.baseState=i)}var Po={isMounted:function(e){return!!(e=e._reactInternalFiber)&&At(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternalFiber;var n=T(),r=No.suspense;(r=wo(n=zs(n,e,r),r)).payload=t,null!=i&&(r.callback=i),xo(e,r),Gs(e,n)},enqueueReplaceState:function(e,t,i){e=e._reactInternalFiber;var n=T(),r=No.suspense;(r=wo(n=zs(n,e,r),r)).tag=1,r.payload=t,null!=i&&(r.callback=i),xo(e,r),Gs(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var i=T(),n=No.suspense;(n=wo(i=zs(i,e,n),n)).tag=2,null!=t&&(n.callback=t),xo(e,n),Gs(e,i)}};function Do(e,t,i,n,r,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&gr(i,n)&&gr(r,o))}function Lo(e,t,i){var n=!1,r=Tr,o=t.contextType;t=new t(i,o="object"==typeof o&&null!==o?x(o):(r=w(t)?Ar:f.current,(n=null!=t.contextTypes)?Nr(e,r):Tr)),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Po,(e.stateNode=t)._reactInternalFiber=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o)}function Ro(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Po.enqueueReplaceState(t,t.state,null)}function Mo(e,t,i,n){var r=e.stateNode,o=(r.props=i,r.state=e.memoizedState,r.refs=Io,t.contextType);"object"==typeof o&&null!==o?r.context=x(o):(o=w(t)?Ar:f.current,r.context=Nr(e,o)),null!==(o=e.updateQueue)&&(So(e,o,i,r,n),r.state=e.memoizedState),"function"==typeof(o=t.getDerivedStateFromProps)&&(Oo(e,0,o,i),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Po.enqueueReplaceState(r,r.state,null),null!==(o=e.updateQueue)&&(So(e,o,i,r,n),r.state=e.memoizedState)),"function"==typeof r.componentDidMount&&(e.effectTag|=4)}var Bo=Array.isArray;function jo(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(B(309));var n=i.stateNode}var r;if(n)return r=""+e,null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===r?t.ref:((t=function(e){var t=n.refs;t===Io&&(t=n.refs={}),null===e?delete t[r]:t[r]=e})._stringRef=r,t);throw Error(B(147,e))}if("string"!=typeof e)throw Error(B(284));if(!i._owner)throw Error(B(290,e))}return e}function Fo(e,t){if("textarea"!==e.type)throw Error(B(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Uo(T){function A(e,t){var i;T&&(null!==(i=e.lastEffect)?(i.nextEffect=t,e.lastEffect=t):e.firstEffect=e.lastEffect=t,t.nextEffect=null,t.effectTag=8)}function N(e,t){if(T)for(;null!==t;)A(e,t),t=t.sibling;return null}function I(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function O(e,t){return(e=bl(e,t)).index=0,e.sibling=null,e}function P(e,t,i){return e.index=i,T?null===(i=e.alternate)||(i=i.index)<t?(e.effectTag=2,t):i:t}function D(e){return T&&null===e.alternate&&(e.effectTag=2),e}function o(e,t,i,n){return null===t||6!==t.tag?(t=wl(i,e.mode,n)).return=e:(t=O(t,i)).return=e,t}function a(e,t,i,n){return null!==t&&t.elementType===i.type?(n=O(t,i.props)).ref=jo(0,t,i):(n=vl(i.type,i.key,i.props,null,e.mode,n)).ref=jo(0,t,i),n.return=e,n}function s(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?(t=kl(i,e.mode,n)).return=e:(t=O(t,i.children||[])).return=e,t}function l(e,t,i,n,r){return null===t||7!==t.tag?(t=yl(i,e.mode,n,r)).return=e:(t=O(t,i)).return=e,t}function L(e,t,i){if("string"==typeof t||"number"==typeof t)return(t=wl(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ue:return(i=vl(t.type,t.key,t.props,null,e.mode,i)).ref=jo(0,null,t),i.return=e,i;case pe:return(t=kl(t,e.mode,i)).return=e,t}if(Bo(t)||_e(t))return(t=yl(t,e.mode,i,null)).return=e,t;Fo(e,t)}return null}function R(e,t,i,n){var r=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==r?null:o(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ue:return i.key===r?i.type===he?l(e,t,i.props.children,n,r):a(e,t,i,n):null;case pe:return i.key===r?s(e,t,i,n):null}if(Bo(i)||_e(i))return null!==r?null:l(e,t,i,n,null);Fo(e,i)}return null}function M(e,t,i,n,r){if("string"==typeof n||"number"==typeof n)return o(t,e=e.get(i)||null,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ue:return e=e.get(null===n.key?i:n.key)||null,n.type===he?l(t,e,n.props.children,r,n.key):a(t,e,n,r);case pe:return s(t,e=e.get(null===n.key?i:n.key)||null,n,r)}if(Bo(n)||_e(n))return l(t,e=e.get(i)||null,n,r,null);Fo(t,n)}return null}return function(e,t,i,n){var r="object"==typeof i&&null!==i&&i.type===he&&null===i.key,o="object"==typeof(i=r?i.props.children:i)&&null!==i;if(o)switch(i.$$typeof){case ue:e:{for(o=i.key,r=t;null!==r;){if(r.key===o){if(7===r.tag?i.type===he:r.elementType===i.type){N(e,r.sibling),(t=O(r,i.type===he?i.props.children:i.props)).ref=jo(0,r,i),t.return=e,e=t;break e}N(e,r);break}A(e,r),r=r.sibling}e=i.type===he?((t=yl(i.props.children,e.mode,n,i.key)).return=e,t):((n=vl(i.type,i.key,i.props,null,e.mode,n)).ref=jo(0,t,i),n.return=e,n)}return D(e);case pe:e:{for(r=i.key;null!==t;){if(t.key===r){if(4===t.tag&&t.stateNode.containerInfo===i.containerInfo&&t.stateNode.implementation===i.implementation){N(e,t.sibling),(t=O(t,i.children||[])).return=e,e=t;break e}N(e,t);break}A(e,t),t=t.sibling}(t=kl(i,e.mode,n)).return=e,e=t}return D(e)}if("string"==typeof i||"number"==typeof i)return i=""+i,null!==t&&6===t.tag?(N(e,t.sibling),(t=O(t,i)).return=e):(N(e,t),(t=wl(i,e.mode,n)).return=e),D(e=t);if(Bo(i)){for(var a=e,s=t,l=i,c=n,d=null,u=null,p=s,h=s=0,f=null;null!==p&&h<l.length;h++){p.index>h?(f=p,p=null):f=p.sibling;var m=R(a,p,l[h],c);if(null===m){null===p&&(p=f);break}T&&p&&null===m.alternate&&A(a,p),s=P(m,s,h),null===u?d=m:u.sibling=m,u=m,p=f}if(h===l.length)N(a,p);else if(null===p)for(;h<l.length;h++)null!==(p=L(a,l[h],c))&&(s=P(p,s,h),null===u?d=p:u.sibling=p,u=p);else{for(p=I(a,p);h<l.length;h++)null!==(f=M(p,a,h,l[h],c))&&(T&&null!==f.alternate&&p.delete(null===f.key?h:f.key),s=P(f,s,h),null===u?d=f:u.sibling=f,u=f);T&&p.forEach(function(e){return A(a,e)})}return d}if(_e(i)){var g=e,b=t,v=i,y=n,w=_e(v);if("function"!=typeof w)throw Error(B(150));if(null==(v=w.call(v)))throw Error(B(151));for(var k=w=null,x=b,E=b=0,C=null,_=v.next();null!==x&&!_.done;E++,_=v.next()){x.index>E?(C=x,x=null):C=x.sibling;var S=R(g,x,_.value,y);if(null===S){null===x&&(x=C);break}T&&x&&null===S.alternate&&A(g,x),b=P(S,b,E),null===k?w=S:k.sibling=S,k=S,x=C}if(_.done)N(g,x);else if(null===x)for(;!_.done;E++,_=v.next())null!==(_=L(g,_.value,y))&&(b=P(_,b,E),null===k?w=_:k.sibling=_,k=_);else{for(x=I(g,x);!_.done;E++,_=v.next())null!==(_=M(x,g,E,_.value,y))&&(T&&null!==_.alternate&&x.delete(null===_.key?E:_.key),b=P(_,b,E),null===k?w=_:k.sibling=_,k=_);T&&x.forEach(function(e){return A(g,e)})}return w}if(o&&Fo(e,i),void 0===i&&!r)switch(e.tag){case 1:case 0:throw e=e.type,Error(B(152,e.displayName||e.name||"Component"))}return N(e,t)}}var Ho=Uo(!0),qo=Uo(!1),zo={},E={current:zo},Go={current:zo},Vo={current:zo};function Wo(e){if(e===zo)throw Error(B(174));return e}function $o(e,t){v(Vo,t),v(Go,e),v(E,zo);var i=t.nodeType;switch(i){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ht(null,"");break;default:t=ht(t=(i=8===i?t.parentNode:t).namespaceURI||null,i.tagName)}b(E),v(E,t)}function Ko(){b(E),b(Go),b(Vo)}function Jo(e){Wo(Vo.current);var t=Wo(E.current),i=ht(t,e.type);t!==i&&(v(Go,e),v(E,i))}function Yo(e){Go.current===e&&(b(E),b(Go))}var C={current:0};function Xo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||i.data===fn||i.data===mn))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t=(t.child.return=t).child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Qo(e,t){return{responder:e,props:t}}var Zo=a.ReactCurrentDispatcher,c=a.ReactCurrentBatchConfig,ea=0,ta=null,d=null,u=null,ia=null,p=null,na=null,ra=0,oa=null,aa=0,sa=!1,la=null,ca=0;function t(){throw Error(B(321))}function da(e,t){if(null!==t){for(var i=0;i<t.length&&i<e.length;i++)if(!fr(e[i],t[i]))return;return 1}}function ua(e,t,i,n,r,o){if(ea=o,ta=t,u=null!==e?e.memoizedState:null,Zo.current=null===u?Ia:Oa,t=i(n,r),sa){for(;sa=!1,ca+=1,u=null!==e?e.memoizedState:null,na=ia,oa=p=d=null,Zo.current=Oa,t=i(n,r),sa;);la=null,ca=0}if(Zo.current=Na,(e=ta).memoizedState=ia,e.expirationTime=ra,e.updateQueue=oa,e.effectTag|=aa,e=null!==d&&null!==d.next,na=p=ia=u=d=ta=null,oa=null,aa=ra=ea=0,e)throw Error(B(300));return t}function pa(){Zo.current=Na,na=p=ia=u=d=ta=null,sa=!1,la=oa=null,ca=aa=ra=ea=0}function ha(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===p?ia=p=e:p=p.next=e,p}function fa(){if(null!==na)na=(p=na).next,u=null!==(d=u)?d.next:null;else{if(null===u)throw Error(B(310));var e={memoizedState:(d=u).memoizedState,baseState:d.baseState,queue:d.queue,baseUpdate:d.baseUpdate,next:null};p=null===p?ia=e:p.next=e,u=d.next}return p}function ma(e,t){return"function"==typeof t?t(e):t}function ga(e){var t=fa(),i=t.queue;if(null===i)throw Error(B(311));if(i.lastRenderedReducer=e,0<ca){var n=i.dispatch;if(null!==la){var r=la.get(i);if(void 0!==r){la.delete(i);for(var o=t.memoizedState;o=e(o,r.action),null!==(r=r.next););return fr(o,t.memoizedState)||(h=!0),t.memoizedState=o,t.baseUpdate===i.last&&(t.baseState=o),[i.lastRenderedState=o,n]}}return[t.memoizedState,n]}var n=i.last,a=t.baseUpdate,o=t.baseState;if(null!==(n=null!==a?(null!==n&&(n.next=null),a.next):null!==n?n.next:null)){var s=r=null,l=n,c=!1;do{var d=l.expirationTime}while(d<ea?(c||(c=!0,s=a,r=o),ra<d&&tl(ra=d)):(el(d,l.suspenseConfig),o=l.eagerReducer===e?l.eagerState:e(o,l.action)),null!==(l=(a=l).next)&&l!==n);c||(s=a,r=o),fr(o,t.memoizedState)||(h=!0),t.memoizedState=o,t.baseUpdate=s,t.baseState=r,i.lastRenderedState=o}return[t.memoizedState,i.dispatch]}function ba(e){var t=ha();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,lastRenderedReducer:ma,lastRenderedState:e}).dispatch=Aa.bind(null,ta,e),[t.memoizedState,e]}function va(e){return ga(ma)}function ya(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===oa?(oa={lastEffect:null}).lastEffect=e.next=e:null===(t=oa.lastEffect)?oa.lastEffect=e.next=e:(i=t.next,(t.next=e).next=i,oa.lastEffect=e),e}function wa(e,t,i,n){var r=ha();aa|=e,r.memoizedState=ya(t,i,void 0,void 0===n?null:n)}function ka(e,t,i,n){var r=fa(),o=(n=void 0===n?null:n,void 0);if(null!==d){var a=d.memoizedState,o=a.destroy;if(null!==n&&da(n,a.deps))return void ya(0,i,o,n)}aa|=e,r.memoizedState=ya(t,i,o,n)}function xa(e,t){return wa(516,192,e,t)}function Ea(e,t){return ka(516,192,e,t)}function Ca(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function _a(){}function Sa(e,t){return ha().memoizedState=[e,void 0===t?null:t],e}function Ta(e,t){var i=fa(),n=(t=void 0===t?null:t,i.memoizedState);return null!==n&&null!==t&&da(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Aa(e,t,i){if(!(ca<25))throw Error(B(301));var n=e.alternate;if(e===ta||null!==n&&n===ta)if(sa=!0,e={expirationTime:ea,suspenseConfig:null,action:i,eagerReducer:null,eagerState:null,next:null},void 0===(i=(la=null===la?new Map:la).get(t)))la.set(t,e);else{for(t=i;null!==t.next;)t=t.next;t.next=e}else{var r,o,a={expirationTime:r=zs(T(),e,a=No.suspense),suspenseConfig:a,action:i,eagerReducer:null,eagerState:null,next:null},s=t.last;if(null===s?a.next=a:(null!==(o=s.next)&&(a.next=o),s.next=a),t.last=a,0===e.expirationTime&&(null===n||0===n.expirationTime)&&null!==(n=t.lastRenderedReducer))try{var l=t.lastRenderedState,c=n(l,i);if(a.eagerReducer=n,a.eagerState=c,fr(c,l))return}catch(e){}Gs(e,r)}}var Na={readContext:x,useCallback:t,useContext:t,useEffect:t,useImperativeHandle:t,useLayoutEffect:t,useMemo:t,useReducer:t,useRef:t,useState:t,useDebugValue:t,useResponder:t,useDeferredValue:t,useTransition:t},Ia={readContext:x,useCallback:Sa,useContext:x,useEffect:xa,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,wa(4,36,Ca.bind(null,t,e),i)},useLayoutEffect:function(e,t){return wa(4,36,e,t)},useMemo:function(e,t){var i=ha();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=ha();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={last:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Aa.bind(null,ta,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ha().memoizedState=e},useState:ba,useDebugValue:_a,useResponder:Qo,useDeferredValue:function(t,i){var e=ba(t),n=e[0],r=e[1];return xa(function(){o.unstable_next(function(){var e=c.suspense;c.suspense=void 0===i?null:i;try{r(t)}finally{c.suspense=e}})},[t,i]),n},useTransition:function(i){var e=ba(!1),t=e[0],n=e[1];return[Sa(function(t){n(!0),o.unstable_next(function(){var e=c.suspense;c.suspense=void 0===i?null:i;try{n(!1),t()}finally{c.suspense=e}})},[i,t]),t]}},Oa={readContext:x,useCallback:Ta,useContext:x,useEffect:Ea,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,ka(4,36,Ca.bind(null,t,e),i)},useLayoutEffect:function(e,t){return ka(4,36,e,t)},useMemo:function(e,t){var i=fa(),n=(t=void 0===t?null:t,i.memoizedState);return null!==n&&null!==t&&da(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)},useReducer:ga,useRef:function(){return fa().memoizedState},useState:va,useDebugValue:_a,useResponder:Qo,useDeferredValue:function(t,i){var e=va(),n=e[0],r=e[1];return Ea(function(){o.unstable_next(function(){var e=c.suspense;c.suspense=void 0===i?null:i;try{r(t)}finally{c.suspense=e}})},[t,i]),n},useTransition:function(i){var e=va(),t=e[0],n=e[1];return[Ta(function(t){n(!0),o.unstable_next(function(){var e=c.suspense;c.suspense=void 0===i?null:i;try{n(!1),t()}finally{c.suspense=e}})},[i,t]),t]}},Pa=null,Da=null,La=!1;function Ra(e,t){var i=ml(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=t,i.return=e,i.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Ma(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,1);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,1);default:return}}function Ba(e){if(La){var t=Da;if(t){var i=t;if(!Ma(e,t)){if(!(t=xn(i.nextSibling))||!Ma(e,t))return e.effectTag=-1025&e.effectTag|2,La=!1,Pa=e;Ra(Pa,i)}Pa=e,Da=xn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,La=!1,Pa=e}}function ja(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Pa=e}function Fa(e){if(e===Pa){if(!La)return ja(e),La=!0,0;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!yn(t,e.memoizedProps))for(t=Da;t;)Ra(e,t),t=xn(t.nextSibling);if(ja(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(B(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){Da=xn(e.nextSibling);break e}t--}else"$"!==i&&i!==mn&&i!==fn||t++}e=e.nextSibling}Da=null}}else Da=Pa?xn(e.stateNode.nextSibling):null;return 1}}function Ua(){Da=Pa=null,La=!1}var Ha=a.ReactCurrentOwner,h=!1;function _(e,t,i,n){t.child=null===e?qo(t,null,i,n):Ho(t,e.child,i,n)}function qa(e,t,i,n,r){i=i.render;var o=t.ref;return go(t,r),n=ua(e,t,i,n,o,r),null===e||h?(t.effectTag|=1,_(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ts(e,t,r))}function za(e,t,i,n,r,o){var a;return null===e?"function"!=typeof(a=i.type)||gl(a)||void 0!==a.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=vl(i.type,null,n,null,t.mode,o)).ref=t.ref,(e.return=t).child=e):(t.tag=15,t.type=a,Ga(e,t,a,n,r,o)):(a=e.child,r<o&&(r=a.memoizedProps,(i=null!==(i=i.compare)?i:gr)(r,n))&&e.ref===t.ref?ts(e,t,o):(t.effectTag|=1,(e=bl(a,n)).ref=t.ref,(e.return=t).child=e))}function Ga(e,t,i,n,r,o){return null!==e&&gr(e.memoizedProps,n)&&e.ref===t.ref&&(h=!1,r<o)?ts(e,t,o):Wa(e,t,i,n,o)}function Va(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.effectTag|=128)}function Wa(e,t,i,n,r){var o=Nr(t,w(i)?Ar:f.current);return go(t,r),i=ua(e,t,i,n,o,r),null===e||h?(t.effectTag|=1,_(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ts(e,t,r))}function $a(e,t,i,n,r){var o,a,s,l,c,d,u,p,h;return w(i)?(o=!0,Lr(t)):o=!1,go(t,r),n=null===t.stateNode?(null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Lo(t,i,n),Mo(t,i,n,r),!0):null===e?(a=t.stateNode,s=t.memoizedProps,a.props=s,p=a.context,l="object"==typeof(l=i.contextType)&&null!==l?x(l):Nr(t,l=w(i)?Ar:f.current),(d="function"==typeof(c=i.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||s===n&&p===l||Ro(0,a,n,l),bo=!1,u=t.memoizedState,p=a.state=u,null!==(h=t.updateQueue)&&(So(t,h,n,a,r),p=t.memoizedState),s!==n||u!==p||y.current||bo?("function"==typeof c&&(Oo(t,0,c,n),p=t.memoizedState),(s=bo||Do(t,i,s,n,u,p,l))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.effectTag|=4)):("function"==typeof a.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=p),a.props=n,a.state=p,a.context=l,s):("function"==typeof a.componentDidMount&&(t.effectTag|=4),!1)):(a=t.stateNode,s=t.memoizedProps,a.props=t.type===t.elementType?s:R(t.type,s),p=a.context,l="object"==typeof(l=i.contextType)&&null!==l?x(l):Nr(t,l=w(i)?Ar:f.current),(d="function"==typeof(c=i.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||s===n&&p===l||Ro(0,a,n,l),bo=!1,p=t.memoizedState,u=a.state=p,null!==(h=t.updateQueue)&&(So(t,h,n,a,r),u=t.memoizedState),s!==n||p!==u||y.current||bo?("function"==typeof c&&(Oo(t,0,c,n),u=t.memoizedState),(c=bo||Do(t,i,s,n,p,u,l))?(d||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(n,u,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,u,l)),"function"==typeof a.componentDidUpdate&&(t.effectTag|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=u),a.props=n,a.state=u,a.context=l,c):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.effectTag|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&p===e.memoizedState||(t.effectTag|=256),!1)),Ka(e,t,i,n,o,r)}function Ka(e,t,i,n,r,o){Va(e,t);var a=0!=(64&t.effectTag);if(!n&&!a)return r&&Rr(t,i,!1),ts(e,t,o);n=t.stateNode,Ha.current=t;var s=a&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.effectTag|=1,null!==e&&a?(t.child=Ho(t,e.child,null,o),t.child=Ho(t,null,s,o)):_(e,t,s,o),t.memoizedState=n.state,r&&Rr(t,i,!0),t.child}function Ja(e){var t=e.stateNode;t.pendingContext?Pr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pr(0,t.context,!1),$o(e,t.containerInfo)}var Ya={dehydrated:null,retryTime:0};function Xa(e,t,i){var n=t.mode,r=t.pendingProps,o=C.current,a=!1;if(0!=(64&t.effectTag)||0!=(2&o)&&(null===e||null!==e.memoizedState)?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===r.fallback||!0===r.unstable_avoidThisFallback||(o|=1),v(C,1&o),null===e){if(void 0!==r.fallback&&Ba(t),a){if(a=r.fallback,0==(2&((r=yl(null,n,0,null)).return=t).mode))for(e=(null!==t.memoizedState?t.child:t).child,r.child=e;null!==e;)e.return=r,e=e.sibling;return(i=yl(a,n,i,null)).return=t,r.sibling=i,t.memoizedState=Ya,t.child=r,i}return n=r.children,t.memoizedState=null,t.child=qo(t,null,n,i)}if(null!==e.memoizedState){if(n=(e=e.child).sibling,a){if(r=r.fallback,0==(2&((i=bl(e,e.pendingProps)).return=t).mode)&&(a=(null!==t.memoizedState?t.child:t).child)!==e.child)for(i.child=a;null!==a;)a.return=i,a=a.sibling;return(n=bl(n,r,n.expirationTime)).return=t,i.sibling=n,i.childExpirationTime=0,t.memoizedState=Ya,t.child=i,n}return i=Ho(t,e.child,r.children,i),t.memoizedState=null,t.child=i}if(e=e.child,a){if(a=r.fallback,(r=yl(null,n,0,null)).return=t,null!==(r.child=e)&&(e.return=r),0==(2&t.mode))for(e=(null!==t.memoizedState?t.child:t).child,r.child=e;null!==e;)e.return=r,e=e.sibling;return(i=yl(a,n,i,null)).return=t,(r.sibling=i).effectTag|=2,r.childExpirationTime=0,t.memoizedState=Ya,t.child=r,i}return t.memoizedState=null,t.child=Ho(t,e,r.children,i)}function Qa(e,t){e.expirationTime<t&&(e.expirationTime=t);var i=e.alternate;null!==i&&i.expirationTime<t&&(i.expirationTime=t),mo(e.return,t)}function Za(e,t,i,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,last:n,tail:i,tailExpiration:0,tailMode:r,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.last=n,a.tail=i,a.tailExpiration=0,a.tailMode=r,a.lastEffect=o)}function es(e,t,i){var n=t.pendingProps,r=n.revealOrder,o=n.tail;if(_(e,t,n.children,i),0!=(2&(n=C.current)))n=1&n|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qa(e,i);else if(19===e.tag)Qa(e,i);else if(null!==e.child){e=(e.child.return=e).child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(v(C,n),0==(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===Xo(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Za(t,!1,r,i,o,t.lastEffect);break;case"backwards":for(r=t.child,t.child=i=null;null!==r;){if(null!==(e=r.alternate)&&null===Xo(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Za(t,!0,i,null,o,t.lastEffect);break;case"together":Za(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ts(e,t,i){null!==e&&(t.dependencies=e.dependencies);var n=t.expirationTime;if(0!==n&&tl(n),t.childExpirationTime<i)return null;if(null!==e&&t.child!==e.child)throw Error(B(153));if(null!==t.child){for(i=bl(e=t.child,e.pendingProps,e.expirationTime),(t.child=i).return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=bl(e,e.pendingProps,e.expirationTime)).return=t;i.sibling=null}return t.child}function is(e){e.effectTag|=4}function ns(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":for(var i=e.tail,n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function rs(e,t){return{value:e,source:t,stack:Te(t)}}var os=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i=(i.child.return=i).child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},as=function(e,t,i,n,r){var o=e.memoizedProps;if(o!==n){var a,s,l=t.stateNode;switch(Wo(E.current),e=null,i){case"input":o=Ze(l,o),n=Ze(l,n),e=[];break;case"option":o=ot(l,o),n=ot(l,n),e=[];break;case"select":o=m({},o,{value:void 0}),n=m({},n,{value:void 0}),e=[];break;case"textarea":o=st(l,o),n=st(l,n),e=[];break;default:"function"!=typeof o.onClick&&"function"==typeof n.onClick&&(l.onclick=ln)}for(a in on(i,n),i=null,o)if(!n.hasOwnProperty(a)&&o.hasOwnProperty(a)&&null!=o[a])if("style"===a)for(s in l=o[a])l.hasOwnProperty(s)&&(i=i||{},i[s]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(W.hasOwnProperty(a)?e=e||[]:(e=e||[]).push(a,null));for(a in n){var c=n[a],l=null!=o?o[a]:void 0;if(n.hasOwnProperty(a)&&c!==l&&(null!=c||null!=l))if("style"===a)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(i=i||{},i[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(i=i||{},i[s]=c[s])}else i||(e=e||[]).push(a,i),i=c;else"dangerouslySetInnerHTML"===a?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(e=e||[]).push(a,""+c)):"children"===a?l===c||"string"!=typeof c&&"number"!=typeof c||(e=e||[]).push(a,""+c):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(W.hasOwnProperty(a)?(null!=c&&sn(r,a),e||l===c||(e=[])):(e=e||[]).push(a,c))}i&&(e=e||[]).push("style",i),r=e,(t.updateQueue=r)&&is(t)}},ss=function(e,t,i,n){i!==n&&is(t)},ls="function"==typeof WeakSet?WeakSet:Set;function cs(e,t){var i=t.source;null===t.stack&&null!==i&&Te(i),null!==i&&Se(i.type),t=t.value,null!==e&&1===e.tag&&Se(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function ds(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){cl(e,t)}else t.current=null}function us(e,t,i){if(null!==(i=null!==(i=i.updateQueue)?i.lastEffect:null)){var n,r=i=i.next;do{}while(0!=(r.tag&e)&&(n=r.destroy,(r.destroy=void 0)!==n)&&n(),0!=(r.tag&t)&&(n=r.create,r.destroy=n()),(r=r.next)!==i)}}function ps(e,n,t){switch("function"==typeof hl&&hl(n),n.tag){case 0:case 11:case 14:case 15:var r;null!==(e=n.updateQueue)&&null!==(e=e.lastEffect)&&(r=e.next,to(97<t?97:t,function(){var e=r;do{var t=e.destroy;if(void 0!==t){var i=n;try{t()}catch(e){cl(i,e)}}}while((e=e.next)!==r)}));break;case 1:if(ds(n),"function"==typeof(t=n.stateNode).componentWillUnmount){var i=n;var o=t;try{o.props=i.memoizedProps,o.state=i.memoizedState,o.componentWillUnmount()}catch(o){cl(i,o)}}break;case 5:ds(n);break;case 4:ms(e,n,t)}}function hs(e){return 5===e.tag||3===e.tag||4===e.tag}function fs(e){e:{for(var t=e.return;null!==t;){if(hs(t)){var i=t;break e}t=t.return}throw Error(B(160))}switch(t=i.stateNode,i.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(B(161))}16&i.effectTag&&(bt(t,""),i.effectTag&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||hs(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.effectTag)continue t;if(null===i.child||4===i.tag)continue t;i=(i.child.return=i).child}if(!(2&i.effectTag)){i=i.stateNode;break e}}for(var r=e;;){var o=5===r.tag||6===r.tag;if(o){var a,s=o?r.stateNode:r.stateNode.instance;i?n?(a=s,s=i,(8===(o=t).nodeType?o.parentNode:o).insertBefore(a,s)):t.insertBefore(s,i):n?(8===(a=t).nodeType?(o=a.parentNode).insertBefore(s,a):(o=a).appendChild(s),null==(a=a._reactRootContainer)&&null===o.onclick&&(o.onclick=ln)):t.appendChild(s)}else if(4!==r.tag&&null!==r.child){r=(r.child.return=r).child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function ms(e,t,i){for(var n,r,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(B(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var s=e,l=o,c=i,d=l;;)if(ps(s,d,c),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===l)break;for(;null===d.sibling;){if(null===d.return||d.return===l)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r?(s=n,l=o.stateNode,(8===s.nodeType?s.parentNode:s).removeChild(l)):n.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,r=!0,o=(o.child.return=o).child;continue}}else if(ps(e,o,i),null!==o.child){o=(o.child.return=o).child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function gs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:us(4,8,t);break;case 1:break;case 5:var i=t.stateNode;if(null!=i){var n=t.memoizedProps,r=null!==e?e.memoizedProps:n,o=(e=t.type,t.updateQueue);if((t.updateQueue=null)!==o){for(i[Sn]=n,"input"===e&&"radio"===n.type&&null!=n.name&&tt(i,n),an(e,r),t=an(e,n),r=0;r<o.length;r+=2){var a=o[r],s=o[r+1];"style"===a?nn(i,s):"dangerouslySetInnerHTML"===a?gt(i,s):"children"===a?bt(i,s):Je(i,a,s,t)}switch(e){case"input":it(i,n);break;case"textarea":ct(i,n);break;case"select":t=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!n.multiple,null!=(e=n.value)?at(i,!!n.multiple,e,!1):t!==!!n.multiple&&(null!=n.defaultValue?at(i,!!n.multiple,n.defaultValue,!0):at(i,!!n.multiple,n.multiple?[]:"",!1))}}}break;case 6:if(null===t.stateNode)throw Error(B(162));t.stateNode.nodeValue=t.memoizedProps;break;case 3:(t=t.stateNode).hydrate&&(t.hydrate=!1,Xt(t.containerInfo));break;case 12:break;case 13:if(null===(i=t).memoizedState?n=!1:(n=!0,i=t.child,Ps=k()),null!==i)e:for(e=i;;){if(5===e.tag)o=e.stateNode,n?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,r=null!=(r=e.memoizedProps.style)&&r.hasOwnProperty("display")?r.display:null,o.style.display=tn("display",r));else if(6===e.tag)e.stateNode.nodeValue=n?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e=(e.child.return=e).child;continue}}if(e===i)break;for(;null===e.sibling;){if(null===e.return||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}bs(t);break;case 19:bs(t);break;case 17:case 20:case 21:break;default:throw Error(B(163))}}function bs(i){var n,e=i.updateQueue;null!==e&&((i.updateQueue=null)===(n=i.stateNode)&&(n=i.stateNode=new ls),e.forEach(function(e){var t=function(e,t){var i=e.stateNode;null!==i&&i.delete(t),t=0,t=zs(t=T(),e,null),null!==(e=Vs(e,t))&&q(e)}.bind(null,i,e);n.has(e)||(n.add(e),e.then(t,t))}))}var vs="function"==typeof WeakMap?WeakMap:Map;function ys(e,t,i){(i=wo(i,null)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Ds||(Ds=!0,Ls=n),cs(e,t)},i}function ws(t,i,e){(e=wo(e,null)).tag=3;var n,r=t.type.getDerivedStateFromError,o=("function"==typeof r&&(n=i.value,e.payload=function(){return cs(t,i),r(n)}),t.stateNode);return null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){"function"!=typeof r&&(null===Rs?Rs=new Set([this]):Rs.add(this),cs(t,i));var e=i.stack;this.componentDidCatch(i.value,{componentStack:null!==e?e:""})}),e}var ks=Math.ceil,xs=a.ReactCurrentDispatcher,Es=a.ReactCurrentOwner,Cs=16,_s=32,M=0,j=null,F=null,U=0,S=0,Ss=null,Ts=1073741823,As=1073741823,Ns=null,Is=0,Os=!1,Ps=0,H=null,Ds=!1,Ls=null,Rs=null,Ms=!1,Bs=null,js=90,Fs=null,Us=0,Hs=null,qs=0;function T(){return 0!=(48&M)?1073741821-(k()/10|0):0!==qs?qs:qs=1073741821-(k()/10|0)}function zs(e,t,i){if(0==(2&(t=t.mode)))return 1073741823;var n=Zr();if(0==(4&t))return 99===n?1073741823:1073741822;if(0!=(M&Cs))return U;if(null!==i)e=ao(e,0|i.timeoutMs||5e3,250);else switch(n){case 99:e=1073741823;break;case 98:e=ao(e,150,100);break;case 97:case 96:e=ao(e,5e3,250);break;case 95:e=2;break;default:throw Error(B(326))}return null!==j&&e===U&&--e,e}function Gs(e,t){if(50<Us)throw Us=0,Hs=null,Error(B(185));var i;null!==(e=Vs(e,t))&&(i=Zr(),1073741823===t?0!=(8&M)&&0==(48&M)?Ks(e):(q(e),0===M&&L()):q(e),0==(4&M)||98!==i&&99!==i||(null===Fs?Fs=new Map([[e,t]]):(void 0===(i=Fs.get(e))||t<i)&&Fs.set(e,t)))}function Vs(e,t){e.expirationTime<t&&(e.expirationTime=t);var i=e.alternate,n=(null!==i&&i.expirationTime<t&&(i.expirationTime=t),e.return),r=null;if(null===n&&3===e.tag)r=e.stateNode;else for(;null!==n;){if(i=n.alternate,n.childExpirationTime<t&&(n.childExpirationTime=t),null!==i&&i.childExpirationTime<t&&(i.childExpirationTime=t),null===n.return&&3===n.tag){r=n.stateNode;break}n=n.return}return null!==r&&(j===r&&(tl(t),4===S)&&Cl(r,U),_l(r,t)),r}function Ws(e){var t=e.lastExpiredTime;return 0!==t||!El(e,t=e.firstPendingTime)||(t=e.lastPingedTime)>(e=e.nextKnownPendingLevel)?t:e}function q(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=no(Ks.bind(null,e));else{var t=Ws(e),i=e.callbackNode;if(0===t)null!==i&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var n=T(),n=1073741823===t?99:1===t||2===t?95:(n=10*(1073741821-t)-10*(1073741821-n))<=0?99:n<=250?98:n<=5250?97:95;if(null!==i){var r=e.callbackPriority;if(e.callbackExpirationTime===t&&n<=r)return;i!==$r&&jr(i)}e.callbackExpirationTime=t,e.callbackPriority=n,t=1073741823===t?no(Ks.bind(null,e)):io(n,$s.bind(null,e),{timeout:10*(1073741821-t)-k()}),e.callbackNode=t}}}function $s(e,t){if(qs=0,t)Sl(e,t=T()),q(e);else{var i=Ws(e);if(0!==i){if(t=e.callbackNode,0!=(48&M))throw Error(B(327));if(al(),e===j&&i===U||Xs(e,i),null!==F){var n=M;M|=Cs;for(var r=Zs();;)try{for(;null!==F&&!Fr();)F=il(F);break}catch(t){Qs(e,t)}if(po(),M=n,xs.current=r,1===S)throw t=Ss,Xs(e,i),Cl(e,i),q(e),t;if(null===F)switch(r=e.finishedWork=e.current.alternate,e.finishedExpirationTime=i,n=S,j=null,n){case 0:case 1:throw Error(B(345));case 2:Sl(e,2<i?2:i);break;case 3:if(Cl(e,i),i===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=rl(r)),1073741823===Ts&&10<(r=Ps+500-k())){if(Os){var o=e.lastPingedTime;if(0===o||i<=o){e.lastPingedTime=i,Xs(e,i);break}}if(0!==(o=Ws(e))&&o!==i)break;if(0!==n&&n!==i){e.lastPingedTime=n;break}e.timeoutHandle=wn(ol.bind(null,e),r)}else ol(e);break;case 4:(Cl(e,i),i===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=rl(r)),Os&&(0===(r=e.lastPingedTime)||i<=r))?(e.lastPingedTime=i,Xs(e,i)):0!==(r=Ws(e))&&r!==i||(0!==n&&n!==i?e.lastPingedTime=n:(1073741823!==As?n=10*(1073741821-As)-k():1073741823===Ts?n=0:(n=10*(1073741821-Ts)-5e3,(n=(r=k())-n)<0&&(n=0),(i=10*(1073741821-i)-r)<(n=(n<120?120:n<480?480:n<1080?1080:n<1920?1920:n<3e3?3e3:n<4320?4320:1960*ks(n/1960))-n)&&(n=i)),10<n?e.timeoutHandle=wn(ol.bind(null,e),n):ol(e)));break;case 5:if(1073741823!==Ts&&null!==Ns){var o=Ts,a=Ns;if(10<(n=(n=0|a.busyMinDurationMs)<=0||(r=0|a.busyDelayMs,(o=k()-(10*(1073741821-o)-(0|a.timeoutMs||5e3)))<=r)?0:r+n-o)){Cl(e,i),e.timeoutHandle=wn(ol.bind(null,e),n);break}}ol(e);break;default:throw Error(B(329))}if(q(e),e.callbackNode===t)return $s.bind(null,e)}}}return null}function Ks(e){var t=e.lastExpiredTime;if(e.finishedExpirationTime===(t=0!==t?t:1073741823))ol(e);else{if(0!=(48&M))throw Error(B(327));if(al(),e===j&&t===U||Xs(e,t),null!==F){var i=M;M|=Cs;for(var n=Zs();;)try{for(;null!==F;)F=il(F);break}catch(t){Qs(e,t)}if(po(),M=i,xs.current=n,1===S)throw i=Ss,Xs(e,t),Cl(e,t),q(e),i;if(null!==F)throw Error(B(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,j=null,ol(e),q(e)}}return null}function Js(e,t){var i=M;M|=1;try{return e(t)}finally{0===(M=i)&&L()}}function Ys(e,t){var i=M;M=-2&M|8;try{e(t)}finally{0===(M=i)&&L()}}function Xs(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,kn(i)),null!==F)for(i=F.return;null!==i;){var n=i;switch(n.tag){case 1:null!=n.type.childContextTypes&&Ir();break;case 3:Ko(),Or();break;case 5:Yo(n);break;case 4:Ko();break;case 13:case 19:b(C);break;case 10:fo(n)}i=i.return}F=bl((j=e).current,null),U=t,As=Ts=1073741823,Ns=Ss=null,Is=S=0,Os=!1}function Qs(e,t){for(;;){try{if(po(),pa(),null===F||null===F.return)return S=1,Ss=t;e:{var i=e,n=F.return,r=t;if(t=U,(m=F).effectTag|=2048,(m.firstEffect=m.lastEffect=null)!==r&&"object"==typeof r&&"function"==typeof r.then){var o,a,s,l=r,c=0!=(1&C.current),d=n;do{if(s=(s=13===d.tag)?null!==(o=d.memoizedState)?null!==o.dehydrated:void 0!==(a=d.memoizedProps).fallback&&(!0!==a.unstable_avoidThisFallback||!c):s){var u,p,h=d.updateQueue;if(null===h?((u=new Set).add(l),d.updateQueue=u):h.add(l),0==(2&d.mode)){d.effectTag|=64,m.effectTag&=-2981,1===m.tag&&(null===m.alternate?m.tag=17:((p=wo(1073741823,null)).tag=2,xo(m,p))),m.expirationTime=1073741823;break e}var f,r=void 0,m=t,g=i.pingCache;null===g?(g=i.pingCache=new vs,r=new Set,g.set(l,r)):void 0===(r=g.get(l))&&(r=new Set,g.set(l,r)),r.has(m)||(r.add(m),f=dl.bind(null,i,l,m),l.then(f,f)),d.effectTag|=4096,d.expirationTime=t;break e}}while(null!==(d=d.return));r=Error((Se(m.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+Te(m))}5!==S&&(S=2),r=rs(r,m),d=n;do{switch(d.tag){case 3:l=r,d.effectTag|=4096,d.expirationTime=t,Eo(d,ys(d,l,t));break e;case 1:var l=r,b=d.type,v=d.stateNode;if(0==(64&d.effectTag)&&("function"==typeof b.getDerivedStateFromError||null!==v&&"function"==typeof v.componentDidCatch&&(null===Rs||!Rs.has(v)))){d.effectTag|=4096,d.expirationTime=t,Eo(d,ws(d,l,t));break e}}}while(null!==(d=d.return))}F=nl(F)}catch(e){t=e;continue}break}}function Zs(){var e=xs.current;return xs.current=Na,null===e?Na:e}function el(e,t){e<Ts&&2<e&&(Ts=e),null!==t&&e<As&&2<e&&(As=e,Ns=t)}function tl(e){Is<e&&(Is=e)}function il(e){var t=ul(e.alternate,e,U);return e.memoizedProps=e.pendingProps,null===t&&(t=nl(e)),Es.current=null,t}function nl(e){F=e;do{var t=F.alternate;if(e=F.return,0==(2048&F.effectTag)){e:{var i=t,n=U,r=(t=F).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:w(t.type)&&Ir();break;case 3:Ko(),Or(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==i&&null!==i.child||!Fa(t)||is(t);break;case 5:Yo(t);var n=Wo(Vo.current),o=t.type;if(null!==i&&null!=t.stateNode)as(i,t,o,r,n),i.ref!==t.ref&&(t.effectTag|=128);else if(r){var a=Wo(E.current);if(Fa(t)){var s=(r=t).stateNode,i=r.type,l=r.memoizedProps,c=n;switch(s[_n]=r,s[Sn]=l,o=void 0,n=s,i){case"iframe":case"object":case"embed":g("load",n);break;case"video":case"audio":for(s=0;s<Tt.length;s++)g(Tt[s],n);break;case"source":g("error",n);break;case"img":case"image":case"link":g("error",n),g("load",n);break;case"form":g("reset",n),g("submit",n);break;case"details":g("toggle",n);break;case"input":et(n,l),g("invalid",n),sn(c,"onChange");break;case"select":n._wrapperState={wasMultiple:!!l.multiple},g("invalid",n),sn(c,"onChange");break;case"textarea":lt(n,l),g("invalid",n),sn(c,"onChange")}for(o in on(i,l),s=null,l)l.hasOwnProperty(o)&&(a=l[o],"children"===o?"string"==typeof a?n.textContent!==a&&(s=["children",a]):"number"==typeof a&&n.textContent!==""+a&&(s=["children",""+a]):W.hasOwnProperty(o)&&null!=a&&sn(c,o));switch(i){case"input":Xe(n),nt(n,l,!0);break;case"textarea":Xe(n),dt(n);break;case"select":case"option":break;default:"function"==typeof l.onClick&&(n.onclick=ln)}o=s,r.updateQueue=o,(r=null!==o)&&is(t)}else{i=t,c=o,l=r,s=9===n.nodeType?n:n.ownerDocument,(a=a===ut?pt(c):a)===ut?"script"===c?((l=s.createElement("div")).innerHTML="<script><\/script>",s=l.removeChild(l.firstChild)):"string"==typeof l.is?s=s.createElement(c,{is:l.is}):(s=s.createElement(c),"select"===c&&(c=s,l.multiple?c.multiple=!0:l.size&&(c.size=l.size))):s=s.createElementNS(a,c),(l=s)[_n]=i,l[Sn]=r,os(l,t),t.stateNode=l;var d=n,u=an(c=o,i=r);switch(c){case"iframe":case"object":case"embed":g("load",l),n=i;break;case"video":case"audio":for(n=0;n<Tt.length;n++)g(Tt[n],l);n=i;break;case"source":g("error",l),n=i;break;case"img":case"image":case"link":g("error",l),g("load",l),n=i;break;case"form":g("reset",l),g("submit",l),n=i;break;case"details":g("toggle",l),n=i;break;case"input":et(l,i),n=Ze(l,i),g("invalid",l),sn(d,"onChange");break;case"option":n=ot(l,i);break;case"select":l._wrapperState={wasMultiple:!!i.multiple},n=m({},i,{value:void 0}),g("invalid",l),sn(d,"onChange");break;case"textarea":lt(l,i),n=st(l,i),g("invalid",l),sn(d,"onChange");break;default:n=i}on(c,n);var p,s=void 0,a=c,h=l,f=n;for(s in f)f.hasOwnProperty(s)&&(p=f[s],"style"===s?nn(h,p):"dangerouslySetInnerHTML"===s?null!=(p=p?p.__html:void 0)&&gt(h,p):"children"===s?"string"==typeof p?"textarea"===a&&""===p||bt(h,p):"number"==typeof p&&bt(h,""+p):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(W.hasOwnProperty(s)?null!=p&&sn(d,s):null!=p&&Je(h,s,p,u)));switch(c){case"input":Xe(l),nt(l,i,!1);break;case"textarea":Xe(l),dt(l);break;case"option":null!=i.value&&l.setAttribute("value",""+Ke(i.value));break;case"select":(n=l).multiple=!!i.multiple,null!=(l=i.value)?at(n,!!i.multiple,l,!1):null!=i.defaultValue&&at(n,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof n.onClick&&(l.onclick=ln)}(r=vn(o,r))&&is(t)}null!==t.ref&&(t.effectTag|=128)}else if(null===t.stateNode)throw Error(B(166));break;case 6:if(i&&null!=t.stateNode)ss(0,t,i.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(B(166));n=Wo(Vo.current),Wo(E.current),Fa(t)?(o=(r=t).stateNode,n=r.memoizedProps,o[_n]=r,(r=o.nodeValue!==n)&&is(t)):(o=t,(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[_n]=o,t.stateNode=r)}break;case 11:break;case 13:if(b(C),r=t.memoizedState,0!=(64&t.effectTag)){t.expirationTime=n;break e}r=null!==r,o=!1,null===i?void 0!==t.memoizedProps.fallback&&Fa(t):(o=null!==(n=i.memoizedState),r||null===n||null!==(n=i.child.sibling)&&(null!==(l=t.firstEffect)?(t.firstEffect=n).nextEffect=l:(t.firstEffect=t.lastEffect=n).nextEffect=null,n.effectTag=8)),r&&!o&&0!=(2&t.mode)&&(null===i&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&C.current)?0===S&&(S=3):(0!==S&&3!==S||(S=4),0!==Is&&null!==j&&(Cl(j,U),_l(j,Is)))),(r||o)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:Ko();break;case 10:fo(t);break;case 9:case 14:break;case 17:w(t.type)&&Ir();break;case 19:if(b(C),null===(r=t.memoizedState))break;if(o=0!=(64&t.effectTag),null===(l=r.rendering)){if(o)ns(r,!1);else if(0!==S||null!==i&&0!=(64&i.effectTag))for(i=t.child;null!==i;){if(null!==(l=Xo(i))){for(t.effectTag|=64,ns(r,!1),null!==(o=l.updateQueue)&&(t.updateQueue=o,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,o=t.child;null!==o;)i=r,(n=o).effectTag&=2,n.nextEffect=null,n.firstEffect=null,(n.lastEffect=null)===(l=n.alternate)?(n.childExpirationTime=0,n.expirationTime=i,n.child=null,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null):(n.childExpirationTime=l.childExpirationTime,n.expirationTime=l.expirationTime,n.child=l.child,n.memoizedProps=l.memoizedProps,n.memoizedState=l.memoizedState,n.updateQueue=l.updateQueue,i=l.dependencies,n.dependencies=null===i?null:{expirationTime:i.expirationTime,firstContext:i.firstContext,responders:i.responders}),o=o.sibling;v(C,1&C.current|2),t=t.child;break e}i=i.sibling}}else{if(!o)if(null!==(i=Xo(l))){if(t.effectTag|=64,o=!0,null!==(n=i.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),ns(r,!0),null===r.tail&&"hidden"===r.tailMode){null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null);break}}else k()>r.tailExpiration&&1<n&&(t.effectTag|=64,ns(r,!(o=!0)),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=r.last)?n.sibling=l:t.child=l,r.last=l)}if(null===r.tail)break;0===r.tailExpiration&&(r.tailExpiration=k()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,n.sibling=null,r=C.current,v(C,r=o?1&r|2:1&r),t=n;break e;case 20:case 21:break;default:throw Error(B(156,t.tag))}t=null}if(r=F,1===U||1!==r.childExpirationTime){for(o=0,n=r.child;null!==n;)(i=n.expirationTime)>o&&(o=i),(l=n.childExpirationTime)>o&&(o=l),n=n.sibling;r.childExpirationTime=o}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=F.firstEffect),null!==F.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=F.firstEffect),e.lastEffect=F.lastEffect),1<F.effectTag)&&(null!==e.lastEffect?e.lastEffect.nextEffect=F:e.firstEffect=F,e.lastEffect=F)}else{if(null!==(t=function(e){switch(e.tag){case 1:w(e.type)&&Ir();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Ko(),Or(),0!=(64&(t=e.effectTag)))throw Error(B(285));return e.effectTag=-4097&t|64,e;case 5:return Yo(e),null;case 13:return b(C),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return b(C),null;case 4:return Ko(),null;case 10:return fo(e),null;default:return null}}(F)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=F.sibling))return t}while(null!==(F=e));return 0===S&&(S=5),null}function rl(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function ol(e){var t=Zr();return to(99,function(e,t){if(al(),0!=(48&M))throw Error(B(327));var i=e.finishedWork,n=e.finishedExpirationTime;if(null!==i){if(e.finishedWork=null,e.finishedExpirationTime=0,i===e.current)throw Error(B(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var r=rl(i);if(e.firstPendingTime=r,n<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:n<=e.firstSuspendedTime&&(e.firstSuspendedTime=n-1),n<=e.lastPingedTime&&(e.lastPingedTime=0),n<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===j&&(F=j=null,U=0),null!==(r=1<i.effectTag?null!==i.lastEffect?(i.lastEffect.nextEffect=i).firstEffect:i:i.firstEffect)){var o=M,a=(M|=_s,Es.current=null,gn=Gi,pn());if(hn(a)){if("selectionStart"in a)var s={start:a.selectionStart,end:a.selectionEnd};else e:{var l=(s=(s=a.ownerDocument)&&s.defaultView||window).getSelection&&s.getSelection();if(l&&0!==l.rangeCount){s=l.anchorNode;var c=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{s.nodeType,d.nodeType}catch(e){s=null;break e}var u,p=0,h=-1,f=-1,m=0,g=0,b=a,v=null;t:for(;;){for(;b!==s||0!==c&&3!==b.nodeType||(h=p+c),b!==d||0!==l&&3!==b.nodeType||(f=p+l),3===b.nodeType&&(p+=b.nodeValue.length),null!==(u=b.firstChild);)v=b,b=u;for(;;){if(b===a)break t;if(v===s&&++m===c&&(h=p),v===d&&++g===l&&(f=p),null!==(u=b.nextSibling))break;v=(b=v).parentNode}b=u}s=-1===h||-1===f?null:{start:h,end:f}}else s=null}s=s||{start:0,end:0}}else s=null;Gi=!(bn={focusedElem:a,selectionRange:s}),H=r;do{try{!function(){for(;null!==H;){var e=H.effectTag;0!=(256&e)&&function(e,t){switch(t.tag){case 0:case 11:case 15:us(2,0,t);break;case 1:var i,n;256&t.effectTag&&null!==e&&(i=e.memoizedProps,n=e.memoizedState,t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?i:R(t.type,i),n),e.__reactInternalSnapshotBeforeUpdate=t);break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}(H.alternate,H),0==(512&e)||Ms||(Ms=!0,io(97,function(){return al(),null})),H=H.nextEffect}}()}catch(e){if(null===H)throw Error(B(330));cl(H,e),H=H.nextEffect}}while(null!==H);H=r;do{try{for(a=e,s=t;null!==H;){var y,w,k=H.effectTag;switch(16&k&&bt(H.stateNode,""),128&k&&null!==(y=H.alternate)&&null!==(w=y.ref)&&("function"==typeof w?w(null):w.current=null),1038&k){case 2:fs(H),H.effectTag&=-3;break;case 6:fs(H),H.effectTag&=-3,gs(H.alternate,H);break;case 1024:H.effectTag&=-1025;break;case 1028:H.effectTag&=-1025,gs(H.alternate,H);break;case 4:gs(H.alternate,H);break;case 8:ms(a,c=H,s),function e(t){var i=t.alternate;t.return=null,t.child=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.alternate=null,t.firstEffect=null,t.lastEffect=null,t.pendingProps=null,(t.memoizedProps=null)!==i&&e(i)}(c)}H=H.nextEffect}}catch(e){if(null===H)throw Error(B(330));cl(H,e),H=H.nextEffect}}while(null!==H);if(w=bn,y=pn(),k=w.focusedElem,s=w.selectionRange,y!==k&&k&&k.ownerDocument&&function e(t,i){return!(!t||!i)&&(t===i||(!t||3!==t.nodeType)&&(i&&3===i.nodeType?e(t,i.parentNode):"contains"in t?t.contains(i):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(i))))}(k.ownerDocument.documentElement,k)){null!==s&&hn(k)&&(y=s.start,void 0===(w=s.end)&&(w=y),"selectionStart"in k?(k.selectionStart=y,k.selectionEnd=Math.min(w,k.value.length)):(w=(y=k.ownerDocument||document)&&y.defaultView||window).getSelection&&(w=w.getSelection(),c=k.textContent.length,a=Math.min(s.start,c),s=void 0===s.end?a:Math.min(s.end,c),!w.extend&&s<a&&(c=s,s=a,a=c),c=un(k,a),d=un(k,s),c)&&d&&(1!==w.rangeCount||w.anchorNode!==c.node||w.anchorOffset!==c.offset||w.focusNode!==d.node||w.focusOffset!==d.offset)&&((y=y.createRange()).setStart(c.node,c.offset),w.removeAllRanges(),s<a?(w.addRange(y),w.extend(d.node,d.offset)):(y.setEnd(d.node,d.offset),w.addRange(y)))),y=[];for(w=k;w=w.parentNode;)1===w.nodeType&&y.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"==typeof k.focus&&k.focus(),k=0;k<y.length;k++)(w=y[k]).element.scrollLeft=w.left,w.element.scrollTop=w.top}Gi=!!gn,gn=bn=null,e.current=i,H=r;do{try{for(k=n;null!==H;){var x,E,C=H.effectTag;if(36&C){var _,S,T,A=H.alternate;switch(w=k,(y=H).tag){case 0:case 11:case 15:us(16,32,y);break;case 1:var N,I=y.stateNode,O=(4&y.effectTag&&(null===A?I.componentDidMount():(N=y.elementType===y.type?A.memoizedProps:R(y.type,A.memoizedProps),I.componentDidUpdate(N,A.memoizedState,I.__reactInternalSnapshotBeforeUpdate))),y.updateQueue);null!==O&&To(0,O,I);break;case 3:var P=y.updateQueue;if(null!==P){if((a=null)!==y.child)switch(y.child.tag){case 5:case 1:a=y.child.stateNode}To(0,P,a)}break;case 5:var D=y.stateNode;null===A&&4&y.effectTag&&vn(y.type,y.memoizedProps)&&D.focus();break;case 6:case 4:case 12:break;case 13:null===y.memoizedState&&null!==(_=y.alternate)&&null!==(S=_.memoizedState)&&null!==(T=S.dehydrated)&&Xt(T);break;case 19:case 17:case 20:case 21:break;default:throw Error(B(163))}}128&C&&(y=void 0,null!==(x=H.ref))&&(E=H.stateNode,H.tag,y=E,"function"==typeof x?x(y):x.current=y),H=H.nextEffect}}catch(e){if(null===H)throw Error(B(330));cl(H,e),H=H.nextEffect}}while(null!==H);H=null,Kr(),M=o}else e.current=i;if(Ms)Ms=!1,Bs=e,js=t;else for(H=r;null!==H;)t=H.nextEffect,H.nextEffect=null,H=t;if(0===(t=e.firstPendingTime)&&(Rs=null),1073741823===t?e===Hs?Us++:(Us=0,Hs=e):Us=0,"function"==typeof pl&&pl(i.stateNode,n),q(e),Ds)throw Ds=!1,e=Ls,Ls=null,e;0==(8&M)&&L()}return null}.bind(null,e,t)),null}function al(){var e;if(90!==js)return e=97<js?97:js,js=90,to(e,sl)}function sl(){if(null===Bs)return!1;var e=Bs;if(Bs=null,0!=(48&M))throw Error(B(331));var t=M;for(M|=_s,e=e.current.firstEffect;null!==e;){try{var i=e;if(0!=(512&i.effectTag))switch(i.tag){case 0:case 11:case 15:us(128,0,i),us(0,64,i)}}catch(t){if(null===e)throw Error(B(330));cl(e,t)}i=e.nextEffect,e.nextEffect=null,e=i}return M=t,L(),!0}function ll(e,t,i){xo(e,t=ys(e,t=rs(i,t),1073741823)),null!==(e=Vs(e,1073741823))&&q(e)}function cl(e,t){if(3===e.tag)ll(e,e,t);else for(var i=e.return;null!==i;){if(3===i.tag){ll(i,e,t);break}if(1===i.tag){var n=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Rs||!Rs.has(n))){xo(i,e=ws(i,e=rs(t,e),1073741823)),null!==(i=Vs(i,1073741823))&&q(i);break}}i=i.return}}function dl(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),j===e&&U===i?4===S||3===S&&1073741823===Ts&&k()-Ps<500?Xs(e,U):Os=!0:!El(e,i)||0!==(t=e.lastPingedTime)&&t<i||(e.lastPingedTime=i,e.finishedExpirationTime===i&&(e.finishedExpirationTime=0,e.finishedWork=null),q(e))}var ul=function(e,t,i){var n,r,o=t.expirationTime;if(null!==e){var a=t.pendingProps;if(e.memoizedProps!==a||y.current)h=!0;else{if(o<i){switch(h=!1,t.tag){case 3:Ja(t),Ua();break;case 5:if(Jo(t),4&t.mode&&1!==i&&a.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:w(t.type)&&Lr(t);break;case 4:$o(t,t.stateNode.containerInfo);break;case 10:ho(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(o=t.child.childExpirationTime)&&i<=o?Xa(e,t,i):(v(C,1&C.current),null!==(t=ts(e,t,i))?t.sibling:null);v(C,1&C.current);break;case 19:if(o=t.childExpirationTime>=i,0!=(64&e.effectTag)){if(o)return es(e,t,i);t.effectTag|=64}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null),v(C,C.current),!o)return null}return ts(e,t,i)}h=!1}}else h=!1;switch(t.expirationTime=0,t.tag){case 2:var s,o=t.type;return null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,a=Nr(t,f.current),go(t,i),a=ua(null,t,o,e,a,i),t.effectTag|=1,t="object"==typeof a&&null!==a&&"function"==typeof a.render&&void 0===a.$$typeof?(t.tag=1,pa(),w(o)?(s=!0,Lr(t)):s=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,"function"==typeof(d=o.getDerivedStateFromProps)&&Oo(t,0,d,e),a.updater=Po,Mo((t.stateNode=a)._reactInternalFiber=t,o,e,i),Ka(null,t,o,!0,s,i)):(t.tag=0,_(null,t,a,i),t.child);case 16:if(a=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,-1===(n=a)._status&&(n._status=0,r=(r=n._ctor)(),(n._result=r).then(function(e){0===n._status&&(e=e.default,n._status=1,n._result=e)},function(e){0===n._status&&(n._status=2,n._result=e)})),1!==a._status)throw a._result;switch(a=a._result,t.type=a,s=t.tag=function(e){if("function"==typeof e)return gl(e)?1:0;if(null!=e){if((e=e.$$typeof)===ye)return 11;if(e===xe)return 14}return 2}(a),e=R(a,e),s){case 0:t=Wa(null,t,a,e,i);break;case 1:t=$a(null,t,a,e,i);break;case 11:t=qa(null,t,a,e,i);break;case 14:t=za(null,t,a,R(a.type,e),o,i);break;default:throw Error(B(306,a,""))}return t;case 0:return o=t.type,a=t.pendingProps,Wa(e,t,o,a=t.elementType===o?a:R(o,a),i);case 1:return o=t.type,a=t.pendingProps,$a(e,t,o,a=t.elementType===o?a:R(o,a),i);case 3:if(Ja(t),null===(o=t.updateQueue))throw Error(B(282));if(a=null!==(a=t.memoizedState)?a.element:null,So(t,o,t.pendingProps,null,i),(o=t.memoizedState.element)===a)Ua(),t=ts(e,t,i);else{if((a=t.stateNode.hydrate)&&(Da=xn(t.stateNode.containerInfo.firstChild),Pa=t,a=La=!0),a)for(i=qo(t,null,o,i),t.child=i;i;)i.effectTag=-3&i.effectTag|1024,i=i.sibling;else _(e,t,o,i),Ua();t=t.child}return t;case 5:return Jo(t),null===e&&Ba(t),o=t.type,a=t.pendingProps,s=null!==e?e.memoizedProps:null,d=a.children,yn(o,a)?d=null:null!==s&&yn(o,s)&&(t.effectTag|=16),Va(e,t),t=4&t.mode&&1!==i&&a.hidden?(t.expirationTime=t.childExpirationTime=1,null):(_(e,t,d,i),t.child);case 6:return null===e&&Ba(t),null;case 13:return Xa(e,t,i);case 4:return $o(t,t.stateNode.containerInfo),o=t.pendingProps,null===e?t.child=Ho(t,null,o,i):_(e,t,o,i),t.child;case 11:return o=t.type,a=t.pendingProps,qa(e,t,o,a=t.elementType===o?a:R(o,a),i);case 7:return _(e,t,t.pendingProps,i),t.child;case 8:case 12:return _(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(o=t.type._context,a=t.pendingProps,d=t.memoizedProps,ho(t,s=a.value),null!==d){var l=d.value;if(0==(s=fr(l,s)?0:0|("function"==typeof o._calculateChangedBits?o._calculateChangedBits(l,s):1073741823))){if(d.children===a.children&&!y.current){t=ts(e,t,i);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c)for(var d=l.child,u=c.firstContext;null!==u;){if(u.context===o&&0!=(u.observedBits&s)){1===l.tag&&((u=wo(i,null)).tag=2,xo(l,u)),l.expirationTime<i&&(l.expirationTime=i),null!==(u=l.alternate)&&u.expirationTime<i&&(u.expirationTime=i),mo(l.return,i),c.expirationTime<i&&(c.expirationTime=i);break}u=u.next}else d=10===l.tag&&l.type===t.type?null:l.child;if(null!==d)d.return=l;else for(d=l;null!==d;){if(d===t){d=null;break}if(null!==(l=d.sibling)){l.return=d.return,d=l;break}d=d.return}l=d}}_(e,t,a.children,i),t=t.child}return t;case 9:return a=t.type,o=(s=t.pendingProps).children,go(t,i),o=o(a=x(a,s.unstable_observedBits)),t.effectTag|=1,_(e,t,o,i),t.child;case 14:return s=R(a=t.type,t.pendingProps),za(e,t,a,s=R(a.type,s),o,i);case 15:return Ga(e,t,t.type,t.pendingProps,o,i);case 17:return o=t.type,a=t.pendingProps,a=t.elementType===o?a:R(o,a),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,w(o)?(e=!0,Lr(t)):e=!1,go(t,i),Lo(t,o,a),Mo(t,o,a,i),Ka(null,t,o,!0,e,i);case 19:return es(e,t,i)}throw Error(B(156,t.tag))},pl=null,hl=null;function fl(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function ml(e,t,i,n){return new fl(e,t,i,n)}function gl(e){return(e=e.prototype)&&e.isReactComponent}function bl(e,t){var i=e.alternate;return null===i?((i=ml(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,(i.alternate=e).alternate=i):(i.pendingProps=t,i.effectTag=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function vl(e,t,i,n,r,o){var a=2;if("function"==typeof(n=e))gl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case he:return yl(i.children,r,o,t);case ve:a=8,r|=7;break;case fe:a=8,r|=1;break;case me:return(e=ml(12,i,t,8|r)).elementType=me,e.type=me,e.expirationTime=o,e;case we:return(e=ml(13,i,t,r)).type=we,e.elementType=we,e.expirationTime=o,e;case ke:return(e=ml(19,i,t,r)).elementType=ke,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case ge:a=10;break e;case be:a=9;break e;case ye:a=11;break e;case xe:a=14;break e;case Ee:a=16,n=null;break e}throw Error(B(130,null==e?e:typeof e,""))}return(t=ml(a,i,t,r)).elementType=e,t.type=n,t.expirationTime=o,t}function yl(e,t,i,n){return(e=ml(7,e,n,t)).expirationTime=i,e}function wl(e,t,i){return(e=ml(6,e,null,t)).expirationTime=i,e}function kl(e,t,i){return(t=ml(4,null!==e.children?e.children:[],e.key,t)).expirationTime=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function xl(e,t,i){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function El(e,t){var i=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==i&&t<=i&&e<=t}function Cl(e,t){var i=e.firstSuspendedTime,n=e.lastSuspendedTime;i<t&&(e.firstSuspendedTime=t),(t<n||0===i)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function _l(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var i=e.firstSuspendedTime;0!==i&&(i<=t?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel)&&(e.nextKnownPendingLevel=t)}function Sl(e,t){var i=e.lastExpiredTime;(0===i||t<i)&&(e.lastExpiredTime=t)}function Tl(e,t,i,n){var r=t.current,o=T(),a=No.suspense,o=zs(o,r,a);e:if(i){t:{if(At(i=i._reactInternalFiber)!==i||1!==i.tag)throw Error(B(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break t;case 1:if(w(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break t}}}while(null!==(s=s.return));throw Error(B(171))}if(1===i.tag){var l=i.type;if(w(l)){i=Dr(i,l,s);break e}}i=s}else i=Tr;null===t.context?t.context=i:t.pendingContext=i,(t=wo(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),xo(r,t),Gs(r,o)}function Al(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Nl(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Il(e,t){Nl(e,t),(e=e.alternate)&&Nl(e,t)}function Ol(e,t,i){var n,r,o=new xl(e,t,i=null!=i&&!0===i.hydrate),a=ml(3,null,null,2===t?7:1===t?3:0);(o.current=a).stateNode=o,e[Tn]=o.current,i&&0!==t&&(n=9===e.nodeType?e:e.ownerDocument,r=Xi(n),qt.forEach(function(e){Qi(e,n,r)}),zt.forEach(function(e){Qi(e,n,r)})),this._internalRoot=o}function Pl(e){return e&&(1===e.nodeType||9===e.nodeType||11===e.nodeType||8===e.nodeType&&" react-mount-point-unstable "===e.nodeValue)}function Dl(e,t,i,n,r){var o,a,s,l=i._reactRootContainer;return l?(s=l._internalRoot,"function"==typeof r&&(o=r,r=function(){var e=Al(s);o.call(e)}),Tl(t,s,e,r)):(s=(i._reactRootContainer=function(e,t){if(!(t=t||!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))))for(var i;i=e.lastChild;)e.removeChild(i);return new Ol(e,0,t?{hydrate:!0}:void 0)}(i,n))._internalRoot,"function"==typeof r&&(a=r,r=function(){var e=Al(s);a.call(e)}),Ys(function(){Tl(t,s,e,r)})),Al(s)}function Ll(e,t){if(Pl(t))return function(e,t,i,n){return{$$typeof:pe,key:null==(n=3<arguments.length&&void 0!==n?n:null)?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null);throw Error(B(200))}Pt=function(e){var t;13===e.tag&&(Gs(e,t=ao(T(),150,100)),Il(e,t))},Dt=function(e){var t;13===e.tag&&(T(),Gs(e,t=oo++),Il(e,t))},Lt=function(e){var t;13===e.tag&&(Gs(e,t=zs(T(),e,null)),Il(e,t))},Ne=function(e,t,i){switch(t){case"input":if(it(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=On(n);if(!r)throw Error(B(90));Qe(n),it(n,r)}}}break;case"textarea":ct(e,i);break;case"select":null!=(t=i.value)&&at(e,!!i.multiple,t,!1)}},Ol.prototype.render=function(e,t){Tl(e,this._internalRoot,null,void 0===t?null:t)},Ol.prototype.unmount=function(e){Tl(null,this._internalRoot,null,void 0===e?null:e)},Me=function(e,t,i,n){var r=M;M|=4;try{return to(98,e.bind(null,t,i,n))}finally{0===(M=r)&&L()}};je=function(e,t){var i=M;M|=2;try{return e(t)}finally{0===(M=i)&&L()}},hr={createPortal:Ll,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0!==t)return null===(e=Ot(t))?null:e.stateNode;if("function"==typeof e.render)throw Error(B(188));throw Error(B(268,Object.keys(e)))},hydrate:function(e,t,i){if(Pl(t))return Dl(null,e,t,!0,i);throw Error(B(200))},render:function(e,t,i){if(Pl(t))return Dl(null,e,t,!1,i);throw Error(B(200))},unstable_renderSubtreeIntoContainer:function(e,t,i,n){if(!Pl(i))throw Error(B(200));if(null==e||void 0===e._reactInternalFiber)throw Error(B(38));return Dl(e,t,i,!1,n)},unmountComponentAtNode:function(e){if(Pl(e))return!!e._reactRootContainer&&(Ys(function(){Dl(null,null,e,!1,function(){e._reactRootContainer=null})}),!0);throw Error(B(40))},unstable_createPortal:function(){return Ll.apply(void 0,arguments)},unstable_batchedUpdates:Re=Js,flushSync:function(e,t){if(0!=(48&M))throw Error(B(187));var i=M;M|=1;try{return to(99,e.bind(null,t))}finally{M=i,L()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[Nn,In,On,n.injectEventPluginsByName,V,ri,function(e){oe(e,ni)},De,Le,$i,le,al,{current:!(Be=function(){var e;0==(49&M)&&(null!==Fs&&(e=Fs,Fs=null,e.forEach(function(e,t){Sl(t,e),q(t)}),L()),al())})}]}};(function(e){var t=e.findFiberByHostInstance,i=m({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ot(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null});if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var n=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(n.isDisabled||!n.supportsFiber)return;try{var r=n.inject(i);pl=function(e){try{n.onCommitFiberRoot(r,e,void 0,64==(64&e.current.effectTag))}catch(e){}},hl=function(e){try{n.onCommitFiberUnmount(r,e)}catch(e){}}}catch(i){}}})({findFiberByHostInstance:An,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"});A.exports=hr.default||hr},{"object-assign":245,react:320,scheduler:278}],276:[function(e,t,i){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":275}],277:[function(M,B,s){"use strict";var o,l,c,t,i,n,e,r,a,d,u,p,h,f,m,g,b,v,y,w;function k(e,t){var i=e.length;for(e.push(t);;){var n=Math.floor((i-1)/2),r=e[n];if(!(void 0!==r&&0<C(r,t)))break;e[n]=t,e[i]=r,i=n}}function x(e){return void 0===(e=e[0])?null:e}function E(e){var t=e[0];if(void 0!==t){var i=e.pop();if(i!==t){e[0]=i;for(var n=0,r=e.length;n<r;){var o=2*(n+1)-1,a=e[o],s=1+o,l=e[s];if(void 0!==a&&C(a,i)<0)n=void 0!==l&&C(l,a)<0?(e[n]=l,e[s]=i,s):(e[n]=a,e[o]=i,o);else{if(!(void 0!==l&&C(l,i)<0))break;e[n]=l,e[s]=i,n=s}}}}}function C(e,t){var i=e.sortIndex-t.sortIndex;return 0!=i?i:e.id-t.id}Object.defineProperty(s,"__esModule",{value:!0}),"undefined"==typeof window||"function"!=typeof MessageChannel?(i=t=null,n=function(){if(null!==t)try{var e=s.unstable_now();t(!0,e),t=null}catch(e){throw setTimeout(n,0),e}},e=Date.now(),s.unstable_now=function(){return Date.now()-e},o=function(e){null!==t?setTimeout(o,0,e):(t=e,setTimeout(n,0))},l=function(e,t){i=setTimeout(e,t)},c=function(){clearTimeout(i)},v=function(){return!1},y=s.unstable_forceFrameRate=function(){}):(r=window.performance,a=window.Date,d=window.setTimeout,u=window.clearTimeout,R=window.cancelAnimationFrame,"undefined"!=typeof console&&("function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof R)&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"object"==typeof r&&"function"==typeof r.now?s.unstable_now=function(){return r.now()}:(p=a.now(),s.unstable_now=function(){return a.now()-p}),h=!1,f=null,m=-1,g=5,b=0,v=function(){return s.unstable_now()>=b},y=function(){},s.unstable_forceFrameRate=function(e){e<0||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):g=0<e?Math.floor(1e3/e):33.33},R=new MessageChannel,w=R.port2,R.port1.onmessage=function(){if(null!==f){var e=s.unstable_now();b=e+g;try{f(!0,e)?w.postMessage(null):(h=!1,f=null)}catch(e){throw w.postMessage(null),e}}else h=!1},o=function(e){f=e,h||(h=!0,w.postMessage(null))},l=function(e,t){m=d(function(){e(s.unstable_now())},t)},c=function(){u(m),m=-1});var _=[],S=[],j=1,T=null,A=3,N=!1,I=!1,O=!1;function P(e){for(var t=x(S);null!==t;){if(null===t.callback)E(S);else{if(!(t.startTime<=e))break;E(S),t.sortIndex=t.expirationTime,k(_,t)}t=x(S)}}function D(e){var t;O=!1,P(e),I||(null!==x(_)?(I=!0,o(L)):null!==(t=x(S))&&l(D,t.startTime-e))}function L(e,t){I=!1,O&&(O=!1,c()),N=!0;var i=A;try{for(P(t),T=x(_);null!==T&&(!(T.expirationTime>t)||e&&!v());){var n,r=T.callback;null!==r?(T.callback=null,A=T.priorityLevel,n=r(T.expirationTime<=t),t=s.unstable_now(),"function"==typeof n?T.callback=n:T===x(_)&&E(_),P(t)):E(_),T=x(_)}var o,a=null!==T||(null!==(o=x(S))&&l(D,o.startTime-t),!1);return a}finally{T=null,A=i,N=!1}}function F(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var R=y;s.unstable_ImmediatePriority=1,s.unstable_UserBlockingPriority=2,s.unstable_NormalPriority=3,s.unstable_IdlePriority=5,s.unstable_LowPriority=4,s.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=A;A=e;try{return t()}finally{A=i}},s.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var i=A;A=t;try{return e()}finally{A=i}},s.unstable_scheduleCallback=function(e,t,i){var n,r=s.unstable_now();return"object"==typeof i&&null!==i?(n="number"==typeof(n=i.delay)&&0<n?r+n:r,i="number"==typeof i.timeout?i.timeout:F(e)):(i=F(e),n=r),e={id:j++,callback:t,priorityLevel:e,startTime:n,expirationTime:i=n+i,sortIndex:-1},r<n?(e.sortIndex=n,k(S,e),null===x(_)&&e===x(S)&&(O?c():O=!0,l(D,n-r))):(e.sortIndex=i,k(_,e),I||N||(I=!0,o(L))),e},s.unstable_cancelCallback=function(e){e.callback=null},s.unstable_wrapCallback=function(t){var i=A;return function(){var e=A;A=i;try{return t.apply(this,arguments)}finally{A=e}}},s.unstable_getCurrentPriorityLevel=function(){return A},s.unstable_shouldYield=function(){var e=s.unstable_now(),t=(P(e),x(_));return t!==T&&null!==T&&null!==t&&null!==t.callback&&t.startTime<=e&&t.expirationTime<T.expirationTime||v()},s.unstable_requestPaint=R,s.unstable_continueExecution=function(){I||N||(I=!0,o(L))},s.unstable_pauseExecution=function(){},s.unstable_getFirstCallbackNode=function(){return x(_)},s.unstable_Profiling=null},{}],278:[function(e,t,i){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":277}],279:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,l=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,d=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,b=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,w=n?Symbol.for("react.responder"):60118,k=n?Symbol.for("react.scope"):60119;function x(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case p:case a:case l:case s:case f:return e;default:switch(e=e&&e.$$typeof){case d:case h:case b:case g:case c:return e;default:return t}}case o:return t}}}function E(e){return x(e)===p}i.AsyncMode=u,i.ConcurrentMode=p,i.ContextConsumer=d,i.ContextProvider=c,i.Element=r,i.ForwardRef=h,i.Fragment=a,i.Lazy=b,i.Memo=g,i.Portal=o,i.Profiler=l,i.StrictMode=s,i.Suspense=f,i.isAsyncMode=function(e){return E(e)||x(e)===u},i.isConcurrentMode=E,i.isContextConsumer=function(e){return x(e)===d},i.isContextProvider=function(e){return x(e)===c},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},i.isForwardRef=function(e){return x(e)===h},i.isFragment=function(e){return x(e)===a},i.isLazy=function(e){return x(e)===b},i.isMemo=function(e){return x(e)===g},i.isPortal=function(e){return x(e)===o},i.isProfiler=function(e){return x(e)===l},i.isStrictMode=function(e){return x(e)===s},i.isSuspense=function(e){return x(e)===f},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===p||e===l||e===s||e===f||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===b||e.$$typeof===g||e.$$typeof===c||e.$$typeof===d||e.$$typeof===h||e.$$typeof===y||e.$$typeof===w||e.$$typeof===k||e.$$typeof===v)},i.typeOf=x},{}],280:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":279}],281:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.bodyOpenClassName=i.portalClassName=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e},r=e("react"),l=h(r),c=h(e("react-dom")),o=h(e("prop-types")),d=h(e("./ModalPortal")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../helpers/ariaAppHider")),p=e("../helpers/safeHTMLElement"),e=h(p);function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}i.portalClassName="ReactModalPortal",i.bodyOpenClassName="ReactModal__Body--open";var m=void 0!==c.default.createPortal,g=m?c.default.createPortal:c.default.unstable_renderSubtreeIntoContainer;function b(e){return e()}var v=function(){function a(){var t,e=this,i=a;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=t=f(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(r))),t.removePortal=function(){m||c.default.unmountComponentAtNode(t.node),b(t.props.parentSelector).removeChild(t.node)},t.portalRef=function(e){t.portal=e},t.renderPortal=function(e){e=g(t,l.default.createElement(d.default,s({defaultStyles:a.defaultStyles},e)),t.node);t.portalRef(e)},f(t,i)}var e=a,t=r.Component;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n(a,[{key:"componentDidMount",value:function(){p.canUseDOM&&(m||(this.node=document.createElement("div")),this.node.className=this.props.portalClassName,b(this.props.parentSelector).appendChild(this.node),!m)&&this.renderPortal(this.props)}},{key:"componentWillReceiveProps",value:function(e){var t,i;p.canUseDOM&&(t=e.isOpen,this.props.isOpen||t)&&(t=b(this.props.parentSelector),(i=b(e.parentSelector))!==t&&(t.removeChild(this.node),i.appendChild(this.node)),m||this.renderPortal(e))}},{key:"componentWillUpdate",value:function(e){p.canUseDOM&&e.portalClassName!==this.props.portalClassName&&(this.node.className=e.portalClassName)}},{key:"componentWillUnmount",value:function(){var e,t,i;p.canUseDOM&&this.node&&this.portal&&(e=this.portal.state,t=Date.now(),(i=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS))?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,i-t)):this.removePortal())}},{key:"render",value:function(){return p.canUseDOM&&m?(!this.node&&m&&(this.node=document.createElement("div")),g(l.default.createElement(d.default,s({ref:this.portalRef,defaultStyles:a.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){u.setElement(e)}}]),a}();v.propTypes={isOpen:o.default.bool.isRequired,style:o.default.shape({content:o.default.object,overlay:o.default.object}),portalClassName:o.default.string,bodyOpenClassName:o.default.string,htmlOpenClassName:o.default.string,className:o.default.oneOfType([o.default.string,o.default.shape({base:o.default.string.isRequired,afterOpen:o.default.string.isRequired,beforeClose:o.default.string.isRequired})]),overlayClassName:o.default.oneOfType([o.default.string,o.default.shape({base:o.default.string.isRequired,afterOpen:o.default.string.isRequired,beforeClose:o.default.string.isRequired})]),appElement:o.default.instanceOf(e.default),onAfterOpen:o.default.func,onRequestClose:o.default.func,closeTimeoutMS:o.default.number,ariaHideApp:o.default.bool,shouldFocusAfterRender:o.default.bool,shouldCloseOnOverlayClick:o.default.bool,shouldReturnFocusAfterClose:o.default.bool,parentSelector:o.default.func,aria:o.default.object,role:o.default.string,contentLabel:o.default.string,shouldCloseOnEsc:o.default.bool,overlayRef:o.default.func,contentRef:o.default.func},v.defaultProps={isOpen:!1,portalClassName:"ReactModalPortal",bodyOpenClassName:"ReactModal__Body--open",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,parentSelector:function(){return document.body}},v.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},i.default=v},{"../helpers/ariaAppHider":283,"../helpers/safeHTMLElement":286,"./ModalPortal":282,"prop-types":272,react:320,"react-dom":276}],282:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,i){return t&&h(e.prototype,t),i&&h(e,i),e},a=e("react"),s=m(a),l=m(e("prop-types")),c=f(e("../helpers/focusManager")),d=m(e("../helpers/scopeTab")),u=f(e("../helpers/ariaAppHider")),p=f(e("../helpers/classList")),e=m(e("../helpers/safeHTMLElement"));function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var g={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},b=0,v=function(){function t(e){var r;if(this instanceof t)return(r=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))).setFocusAfterRender=function(e){r.focusAfterRender=r.props.shouldFocusAfterRender&&e},r.setOverlayRef=function(e){r.overlay=e,r.props.overlayRef&&r.props.overlayRef(e)},r.setContentRef=function(e){r.content=e,r.props.contentRef&&r.props.contentRef(e)},r.afterClose=function(){var e=r.props,t=e.appElement,i=e.ariaHideApp,n=e.htmlOpenClassName,e=e.bodyOpenClassName;p.remove(document.body,e),n&&p.remove(document.getElementsByTagName("html")[0],n),i&&0<b&&0==--b&&u.show(t),r.props.shouldFocusAfterRender&&(r.props.shouldReturnFocusAfterClose?(c.returnFocus(),c.teardownScopedFocus()):c.popWithoutFocus())},r.open=function(){r.beforeOpen(),r.state.afterOpen&&r.state.beforeClose?(clearTimeout(r.closeTimer),r.setState({beforeClose:!1})):(r.props.shouldFocusAfterRender&&(c.setupScopedFocus(r.node),c.markForFocusLater()),r.setState({isOpen:!0},function(){r.setState({afterOpen:!0}),r.props.isOpen&&r.props.onAfterOpen&&r.props.onAfterOpen()}))},r.close=function(){0<r.props.closeTimeoutMS?r.closeWithTimeout():r.closeWithoutTimeout()},r.focusContent=function(){return r.content&&!r.contentHasFocus()&&r.content.focus()},r.closeWithTimeout=function(){var e=Date.now()+r.props.closeTimeoutMS;r.setState({beforeClose:!0,closesAt:e},function(){r.closeTimer=setTimeout(r.closeWithoutTimeout,r.state.closesAt-Date.now())})},r.closeWithoutTimeout=function(){r.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},r.afterClose)},r.handleKeyDown=function(e){9===e.keyCode&&(0,d.default)(r.content,e),r.props.shouldCloseOnEsc&&27===e.keyCode&&(e.stopPropagation(),r.requestClose(e))},r.handleOverlayOnClick=function(e){null===r.shouldClose&&(r.shouldClose=!0),r.shouldClose&&r.props.shouldCloseOnOverlayClick&&(r.ownerHandlesClose()?r.requestClose(e):r.focusContent()),r.shouldClose=null,r.moveFromContentToOverlay=null},r.handleOverlayOnMouseUp=function(){null===r.moveFromContentToOverlay&&(r.shouldClose=!1),r.props.shouldCloseOnOverlayClick&&(r.shouldClose=!0)},r.handleContentOnMouseUp=function(){r.shouldClose=!1},r.handleOverlayOnMouseDown=function(e){r.props.shouldCloseOnOverlayClick||e.target!=r.overlay||e.preventDefault(),r.moveFromContentToOverlay=!1},r.handleContentOnClick=function(){r.shouldClose=!1},r.handleContentOnMouseDown=function(){r.shouldClose=!1,r.moveFromContentToOverlay=!1},r.requestClose=function(e){return r.ownerHandlesClose()&&r.props.onRequestClose(e)},r.ownerHandlesClose=function(){return r.props.onRequestClose},r.shouldBeClosed=function(){return!r.state.isOpen&&!r.state.beforeClose},r.contentHasFocus=function(){return document.activeElement===r.content||r.content.contains(document.activeElement)},r.buildClassName=function(e,t){var e="object"===(void 0===t?"undefined":n(t))?t:{base:g[e],afterOpen:g[e]+"--after-open",beforeClose:g[e]+"--before-close"},i=e.base;return r.state.afterOpen&&(i=i+" "+e.afterOpen),r.state.beforeClose&&(i=i+" "+e.beforeClose),"string"==typeof t&&t?i+" "+t:i},r.ariaAttributes=function(i){return Object.keys(i).reduce(function(e,t){return e["aria-"+t]=i[t],e},{})},r.state={afterOpen:!1,beforeClose:!1},r.shouldClose=null,r.moveFromContentToOverlay=null,r;throw new TypeError("Cannot call a class as a function")}var e=t,i=a.Component;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i),o(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&(this.setFocusAfterRender(!0),this.open())}},{key:"componentWillReceiveProps",value:function(e){!this.props.isOpen&&e.isOpen?(this.setFocusAfterRender(!0),this.open()):this.props.isOpen&&!e.isOpen&&this.close()}},{key:"componentDidUpdate",value:function(){this.focusAfterRender&&(this.focusContent(),this.setFocusAfterRender(!1))}},{key:"componentWillUnmount",value:function(){this.afterClose(),clearTimeout(this.closeTimer)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,i=e.ariaHideApp,n=e.htmlOpenClassName,e=e.bodyOpenClassName;p.add(document.body,e),n&&p.add(document.getElementsByTagName("html")[0],n),i&&(b+=1,u.hide(t))}},{key:"render",value:function(){var e=this.props,t=e.className,i=e.overlayClassName,e=e.defaultStyles,n=t?{}:e.content,e=i?{}:e.overlay;return this.shouldBeClosed()?null:s.default.createElement("div",{ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:r({},e,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown,onMouseUp:this.handleOverlayOnMouseUp,"aria-modal":"true"},s.default.createElement("div",r({ref:this.setContentRef,style:r({},n,this.props.style.content),className:this.buildClassName("content",t),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.ariaAttributes(this.props.aria||{})),this.props.children))}}]),t}();v.defaultProps={style:{overlay:{},content:{}}},v.propTypes={isOpen:l.default.bool.isRequired,defaultStyles:l.default.shape({content:l.default.object,overlay:l.default.object}),style:l.default.shape({content:l.default.object,overlay:l.default.object}),className:l.default.oneOfType([l.default.string,l.default.object]),overlayClassName:l.default.oneOfType([l.default.string,l.default.object]),bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,ariaHideApp:l.default.bool,appElement:l.default.instanceOf(e.default),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,role:l.default.string,contentLabel:l.default.string,aria:l.default.object,children:l.default.node,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func},i.default=v,t.exports=i.default},{"../helpers/ariaAppHider":283,"../helpers/classList":284,"../helpers/focusManager":285,"../helpers/safeHTMLElement":286,"../helpers/scopeTab":287,"prop-types":272,react:320}],283:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.assertNodeList=o,i.setElement=function(e){var t;return"string"==typeof e&&(o(t=document.querySelectorAll(e),e),e="length"in t?t[0]:t),r=e||r},i.validateElement=a,i.hide=function(e){a(e)&&(e||r).setAttribute("aria-hidden","true")},i.show=function(e){a(e)&&(e||r).removeAttribute("aria-hidden")},i.documentNotReadyOrSSRTesting=function(){r=null},i.resetForTesting=function(){r=null};var i=e("warning"),n=i&&i.__esModule?i:{default:i},r=null;function o(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function a(e){return!(!e&&!r&&((0,n.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),1))}},{warning:383}],284:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dumpClassLists=function(){};var o={},a={};i.add=function(e,t){var n,r;n=e.classList,r="html"==e.nodeName.toLowerCase()?o:a,t.split(" ").forEach(function(e){var t,i;(t=r)[i=e]||(t[i]=0),t[i]+=1,n.add(e)})},i.remove=function(e,t){var i,n;i=e.classList,n="html"==e.nodeName.toLowerCase()?o:a,t.split(" ").forEach(function(e){var t;(t=n)[e]&&--t[e],0===n[e]&&i.remove(e)})}},{}],285:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.handleBlur=s,i.handleFocus=l,i.markForFocusLater=function(){r.push(document.activeElement)},i.returnFocus=function(){var t=null;try{0!==r.length&&(t=r.pop()).focus()}catch(e){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},i.popWithoutFocus=function(){0<r.length&&r.pop()},i.setupScopedFocus=function(e){o=e,window.addEventListener?(window.addEventListener("blur",s,!1),document.addEventListener("focus",l,!0)):(window.attachEvent("onBlur",s),document.attachEvent("onFocus",l))},i.teardownScopedFocus=function(){o=null,window.addEventListener?(window.removeEventListener("blur",s),document.removeEventListener("focus",l)):(window.detachEvent("onBlur",s),document.detachEvent("onFocus",l))};var i=e("../helpers/tabbable"),n=i&&i.__esModule?i:{default:i},r=[],o=null,a=!1;function s(){a=!0}function l(){a&&(a=!1,o)&&setTimeout(function(){o.contains(document.activeElement)||((0,n.default)(o)[0]||o).focus()},0)}},{"../helpers/tabbable":288}],286:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.canUseDOM=void 0;var e=e("exenv"),e=(e&&e.__esModule?e:{default:e}).default,n=e.canUseDOM?window.HTMLElement:{};i.canUseDOM=e.canUseDOM,i.default=n},{exenv:181}],287:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t){var i=(0,s.default)(e);if(i.length){var n,r=t.shiftKey,o=i[0],a=i[i.length-1];if(e===document.activeElement){if(!r)return;n=a}(a!==document.activeElement||r||(n=o),n=o===document.activeElement&&r?a:n)?(t.preventDefault(),n.focus()):null!=(e=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent))&&"Chrome"!=e[1]&&null==/\biPod\b|\biPad\b/g.exec(navigator.userAgent)&&(-1<(o=i.indexOf(document.activeElement))&&(o+=r?-1:1),t.preventDefault(),i[o].focus())}else t.preventDefault()};var e=e("./tabbable"),s=e&&e.__esModule?e:{default:e};t.exports=i.default},{"./tabbable":288}],288:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){return[].slice.call(e.querySelectorAll("*"),0).filter(o)};var r=/input|select|textarea|button|object/;function n(n,e){var t=n.nodeName.toLowerCase();return(r.test(t)&&!n.disabled||"a"===t&&n.href||e)&&function(){for(var e,t,i=n;i&&i!==document.body;){if(t=void 0,(t=(e=i).offsetWidth<=0&&e.offsetHeight<=0)&&!e.innerHTML||(e=window.getComputedStyle(e),t?"visible"!==e.getPropertyValue("overflow"):"none"==e.getPropertyValue("display")))return!1;i=i.parentNode}return!0}()}function o(e){var t=e.getAttribute("tabindex"),i=(null===t&&(t=void 0),isNaN(t));return(i||0<=t)&&n(e,!i)}t.exports=i.default},{}],289:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});e=e("./components/Modal"),e=e&&e.__esModule?e:{default:e};i.default=e.default,t.exports=i.default},{"./components/Modal":281}],290:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireWildcard"),r=e("@babel/runtime/helpers/interopRequireDefault"),a=(i.__esModule=!0,i.createProvider=o,i.default=void 0,r(e("@babel/runtime/helpers/inheritsLoose"))),s=n(e("react")),l=r(e("prop-types")),c=e("../utils/PropTypes");function o(i){var e,n,t=(i=void 0===i?"store":i)+"Subscription",r=(n=s.Component,(0,a.default)(o,n),(r=o.prototype).getChildContext=function(){var e;return(e={})[i]=this[i],e[t]=null,e},r.render=function(){return s.Children.only(this.props.children)},o);function o(e,t){return(t=n.call(this,e,t)||this)[i]=e.store,t}return r.propTypes={store:c.storeShape.isRequired,children:l.default.element.isRequired},r.childContextTypes=((e={})[i]=c.storeShape.isRequired,e[t]=c.subscriptionShape,e),r}r(e("../utils/warning")),s.default.forwardRef;n=o();i.default=n},{"../utils/PropTypes":300,"../utils/warning":305,"@babel/runtime/helpers/inheritsLoose":139,"@babel/runtime/helpers/interopRequireDefault":140,"@babel/runtime/helpers/interopRequireWildcard":141,"prop-types":272,react:320}],291:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireWildcard"),r=e("@babel/runtime/helpers/interopRequireDefault"),v=(i.__esModule=!0,i.default=function(a,e){var e=e=void 0===e?{}:e,t=e.getDisplayName,s=void 0===t?function(e){return"ConnectAdvanced("+e+")"}:t,t=e.methodName,l=void 0===t?"connectAdvanced":t,t=e.renderCountProp,c=void 0===t?void 0:t,t=e.shouldHandleStateChanges,d=void 0===t||t,t=e.storeKey,u=void 0===t?"store":t,t=e.withRef,p=void 0!==t&&t,h=(0,o.default)(e,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef"]),f=u+"Subscription",m=A++,g=((t={})[u]=S.storeShape,t[f]=S.subscriptionShape,t),b=((e={})[f]=S.subscriptionShape,e);return function(t){(0,x.default)((0,C.isValidElementType)(t),"You must pass a component to the function returned by "+l+". Instead received "+JSON.stringify(t));var n,e=t.displayName||t.name||"Component",r=s(e),o=(0,w.default)({},h,{getDisplayName:s,methodName:l,renderCountProp:c,shouldHandleStateChanges:d,storeKey:u,withRef:p,displayName:r,wrappedComponentName:e,WrappedComponent:t}),e=(n=E.Component,(0,v.default)(i,n),(e=i.prototype).getChildContext=function(){var e,t=this.propsMode?null:this.subscription;return(e={})[f]=t||this.context[f],e},e.componentDidMount=function(){d&&(this.subscription.trySubscribe(),this.selector.run(this.props),this.selector.shouldComponentUpdate)&&this.forceUpdate()},e.componentWillReceiveProps=function(e){this.selector.run(e)},e.shouldComponentUpdate=function(){return this.selector.shouldComponentUpdate},e.componentWillUnmount=function(){this.subscription&&this.subscription.tryUnsubscribe(),this.subscription=null,this.notifyNestedSubs=I,this.store=null,this.selector.run=I,this.selector.shouldComponentUpdate=!1},e.getWrappedInstance=function(){return(0,x.default)(p,"To access the wrapped instance, you need to specify { withRef: true } in the options argument of the "+l+"() call."),this.wrappedInstance},e.setWrappedInstance=function(e){this.wrappedInstance=e},e.initSelector=function(){var i,n,r,e=a(this.store.dispatch,o);this.selector=(i=e,n=this.store,r={run:function(e){try{var t=i(n.getState(),e);t===r.props&&!r.error||(r.shouldComponentUpdate=!0,r.props=t,r.error=null)}catch(e){r.shouldComponentUpdate=!0,r.error=e}}}),this.selector.run(this.props)},e.initSubscription=function(){var e;d&&(e=(this.propsMode?this.props:this.context)[f],this.subscription=new _.default(this.store,e,this.onStateChange.bind(this)),this.notifyNestedSubs=this.subscription.notifyNestedSubs.bind(this.subscription))},e.onStateChange=function(){this.selector.run(this.props),this.selector.shouldComponentUpdate?(this.componentDidUpdate=this.notifyNestedSubsOnComponentDidUpdate,this.setState(N)):this.notifyNestedSubs()},e.notifyNestedSubsOnComponentDidUpdate=function(){this.componentDidUpdate=void 0,this.notifyNestedSubs()},e.isSubscribed=function(){return Boolean(this.subscription)&&this.subscription.isSubscribed()},e.addExtraProps=function(e){var t;return p||c||this.propsMode&&this.subscription?(t=(0,w.default)({},e),p&&(t.ref=this.setWrappedInstance),c&&(t[c]=this.renderCount++),this.propsMode&&this.subscription&&(t[f]=this.subscription),t):e},e.render=function(){var e=this.selector;if(e.shouldComponentUpdate=!1,e.error)throw e.error;return(0,E.createElement)(t,this.addExtraProps(e.props))},i);function i(e,t){var i;return(i=n.call(this,e,t)||this).version=m,i.state={},i.renderCount=0,i.store=e[u]||t[u],i.propsMode=Boolean(e[u]),i.setWrappedInstance=i.setWrappedInstance.bind((0,y.default)((0,y.default)(i))),(0,x.default)(i.store,'Could not find "'+u+'" in either the context or props of "'+r+'". Either wrap the root component in a <Provider>, or explicitly pass "'+u+'" as a prop to "'+r+'".'),i.initSelector(),i.initSubscription(),i}return T&&(e.prototype.UNSAFE_componentWillReceiveProps=e.prototype.componentWillReceiveProps,delete e.prototype.componentWillReceiveProps),e.WrappedComponent=t,e.displayName=r,e.childContextTypes=b,e.contextTypes=g,e.propTypes=g,(0,k.default)(e,t)}},r(e("@babel/runtime/helpers/inheritsLoose"))),y=r(e("@babel/runtime/helpers/assertThisInitialized")),w=r(e("@babel/runtime/helpers/extends")),o=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),k=r(e("hoist-non-react-statics")),x=r(e("invariant")),E=n(e("react")),C=e("react-is"),_=r(e("../utils/Subscription")),S=e("../utils/PropTypes"),T=void 0!==E.default.forwardRef,A=0,N={};function I(){}},{"../utils/PropTypes":300,"../utils/Subscription":301,"@babel/runtime/helpers/assertThisInitialized":137,"@babel/runtime/helpers/extends":138,"@babel/runtime/helpers/inheritsLoose":139,"@babel/runtime/helpers/interopRequireDefault":140,"@babel/runtime/helpers/interopRequireWildcard":141,"@babel/runtime/helpers/objectWithoutPropertiesLoose":142,"hoist-non-react-statics":183,invariant:187,react:320,"react-is":280}],292:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),m=(i.__esModule=!0,i.createConnect=c,i.default=void 0,n(e("@babel/runtime/helpers/extends"))),g=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),r=n(e("../components/connectAdvanced")),b=n(e("../utils/shallowEqual")),o=n(e("./mapDispatchToProps")),a=n(e("./mapStateToProps")),s=n(e("./mergeProps")),l=n(e("./selectorFactory"));function v(i,e,n){for(var t=e.length-1;0<=t;t--){var r=e[t](i);if(r)return r}return function(e,t){throw new Error("Invalid value of type "+typeof i+" for "+n+" argument when connecting component "+t.wrappedComponentName+".")}}function y(e,t){return e===t}function c(e){var e=void 0===e?{}:e,t=e.connectHOC,d=void 0===t?r.default:t,t=e.mapStateToPropsFactories,u=void 0===t?a.default:t,t=e.mapDispatchToPropsFactories,p=void 0===t?o.default:t,t=e.mergePropsFactories,h=void 0===t?s.default:t,t=e.selectorFactory,f=void 0===t?l.default:t;return function(e,t,i,n){var n=n=void 0===n?{}:n,r=n.pure,r=void 0===r||r,o=n.areStatesEqual,o=void 0===o?y:o,a=n.areOwnPropsEqual,a=void 0===a?b.default:a,s=n.areStatePropsEqual,s=void 0===s?b.default:s,l=n.areMergedPropsEqual,l=void 0===l?b.default:l,n=(0,g.default)(n,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),c=v(e,u,"mapStateToProps"),t=v(t,p,"mapDispatchToProps"),i=v(i,h,"mergeProps");return d(f,(0,m.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:c,initMapDispatchToProps:t,initMergeProps:i,pure:r,areStatesEqual:o,areOwnPropsEqual:a,areStatePropsEqual:s,areMergedPropsEqual:l},n))}}n=c();i.default=n},{"../components/connectAdvanced":291,"../utils/shallowEqual":303,"./mapDispatchToProps":293,"./mapStateToProps":294,"./mergeProps":295,"./selectorFactory":296,"@babel/runtime/helpers/extends":138,"@babel/runtime/helpers/interopRequireDefault":140,"@babel/runtime/helpers/objectWithoutPropertiesLoose":142}],293:[function(e,t,i){"use strict";i.__esModule=!0,i.whenMapDispatchToPropsIsFunction=o,i.whenMapDispatchToPropsIsMissing=a,i.whenMapDispatchToPropsIsObject=s,i.default=void 0;var n=e("redux"),r=e("./wrapMapToProps");function o(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,r.wrapMapToPropsConstant)(function(e){return{dispatch:e}})}function s(t){return t&&"object"==typeof t?(0,r.wrapMapToPropsConstant)(function(e){return(0,n.bindActionCreators)(t,e)}):void 0}i.default=[o,a,s]},{"./wrapMapToProps":298,redux:341}],294:[function(e,t,i){"use strict";i.__esModule=!0,i.whenMapStateToPropsIsFunction=r,i.whenMapStateToPropsIsMissing=o,i.default=void 0;var n=e("./wrapMapToProps");function r(e){return"function"==typeof e?(0,n.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,n.wrapMapToPropsConstant)(function(){return{}})}i.default=[r,o]},{"./wrapMapToProps":298}],295:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),r=(i.__esModule=!0,i.defaultMergeProps=o,i.wrapMergePropsFunc=a,i.whenMergePropsIsFunction=s,i.whenMergePropsIsOmitted=l,i.default=void 0,n(e("@babel/runtime/helpers/extends")));function o(e,t,i){return(0,r.default)({},i,e,t)}function a(s){return function(e,t){t.displayName;var n,r=t.pure,o=t.areMergedPropsEqual,a=!1;return function(e,t,i){e=s(e,t,i);return a?r&&o(e,n)||(n=e):(a=!0,n=e),n}}}function s(e){return"function"==typeof e?a(e):void 0}function l(e){return e?void 0:function(){return o}}n(e("../utils/verifyPlainObject")),i.default=[s,l]},{"../utils/verifyPlainObject":304,"@babel/runtime/helpers/extends":138,"@babel/runtime/helpers/interopRequireDefault":140}],296:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=(i.__esModule=!0,i.impureFinalPropsSelectorFactory=a,i.pureFinalPropsSelectorFactory=s,i.default=function(e,t){var i=t.initMapStateToProps,n=t.initMapDispatchToProps,r=t.initMergeProps,t=(0,o.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),i=i(e,t),n=n(e,t),r=r(e,t);return(t.pure?s:a)(i,n,r,e,t)},n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")));function a(i,n,r,o){return function(e,t){return r(i(e,t),n(o,t),t)}}function s(a,s,l,c,e){var d,u,p,h,f,m=e.areStatesEqual,g=e.areOwnPropsEqual,b=e.areStatePropsEqual,v=!1;return function(e,t){return v?(i=e,r=!g(n=t,u),o=!m(i,d),d=i,u=n,r&&o?(p=a(d,u),s.dependsOnOwnProps&&(h=s(c,u)),f=l(p,h,u)):r?(a.dependsOnOwnProps&&(p=a(d,u)),s.dependsOnOwnProps&&(h=s(c,u)),f=l(p,h,u)):f=o&&(i=a(d,u),n=!b(i,p),p=i,n)?l(p,h,u):f):(p=a(d=e,u=t),h=s(c,u),f=l(p,h,u),v=!0,f);var i,n,r,o}}n(e("./verifySubselectors"))},{"./verifySubselectors":297,"@babel/runtime/helpers/interopRequireDefault":140,"@babel/runtime/helpers/objectWithoutPropertiesLoose":142}],297:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),r=(i.__esModule=!0,i.default=function(e,t,i,n){o(e,"mapStateToProps",n),o(t,"mapDispatchToProps",n),o(i,"mergeProps",n)},n(e("../utils/warning")));function o(e,t,i){if(!e)throw new Error("Unexpected value for "+t+" in "+i+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||e.hasOwnProperty("dependsOnOwnProps")||(0,r.default)("The selector for "+t+" of "+i+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":305,"@babel/runtime/helpers/interopRequireDefault":140}],298:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");function o(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}i.__esModule=!0,i.wrapMapToPropsConstant=function(r){return function(e,t){var i=r(e,t);function n(){return i}return n.dependsOnOwnProps=!1,n}},i.getDependsOnOwnProps=o,i.wrapMapToPropsFunc=function(r,e){return function(e,t){t.displayName;function n(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)}return n.dependsOnOwnProps=!0,n.mapToProps=function(e,t){n.mapToProps=r,n.dependsOnOwnProps=o(r);var i=n(e,t);return"function"==typeof i&&(n.mapToProps=i,n.dependsOnOwnProps=o(i),i=n(e,t)),i},n}},n(e("../utils/verifyPlainObject"))},{"../utils/verifyPlainObject":304,"@babel/runtime/helpers/interopRequireDefault":140}],299:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),r=e("@babel/runtime/helpers/interopRequireWildcard"),r=(i.__esModule=!0,r(e("./components/Provider"))),r=(i.Provider=r.default,i.createProvider=r.createProvider,n(e("./components/connectAdvanced"))),r=(i.connectAdvanced=r.default,n(e("./connect/connect")));i.connect=r.default},{"./components/Provider":290,"./components/connectAdvanced":291,"./connect/connect":292,"@babel/runtime/helpers/interopRequireDefault":140,"@babel/runtime/helpers/interopRequireWildcard":141}],300:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),n=(i.__esModule=!0,i.storeShape=i.subscriptionShape=void 0,n(e("prop-types"))),e=n.default.shape({trySubscribe:n.default.func.isRequired,tryUnsubscribe:n.default.func.isRequired,notifyNestedSubs:n.default.func.isRequired,isSubscribed:n.default.func.isRequired}),e=(i.subscriptionShape=e,n.default.shape({subscribe:n.default.func.isRequired,dispatch:n.default.func.isRequired,getState:n.default.func.isRequired}));i.storeShape=e},{"@babel/runtime/helpers/interopRequireDefault":140,"prop-types":272}],301:[function(e,t,i){"use strict";i.__esModule=!0,i.default=void 0;var n,r={notify:function(){}};function o(e,t,i){this.store=e,this.parentSub=t,this.onStateChange=i,this.unsubscribe=null,this.listeners=r}(n=o.prototype).addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},n.notifyNestedSubs=function(){this.listeners.notify()},n.isSubscribed=function(){return Boolean(this.unsubscribe)},n.trySubscribe=function(){var i,n;this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.onStateChange):this.store.subscribe(this.onStateChange),this.listeners=(i=[],n=[],{clear:function(){i=n=null},notify:function(){for(var e=i=n,t=0;t<e.length;t++)e[t]()},get:function(){return n},subscribe:function(e){var t=!0;return(n=n===i?i.slice():n).push(e),function(){t&&null!==i&&(t=!1,(n=n===i?i.slice():n).splice(n.indexOf(e),1))}}}))},n.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=r)},i.default=o},{}],302:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){if("object"!=typeof e||null===e)return!1;e=Object.getPrototypeOf(e);if(null===e)return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return e===t}},{}],303:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e,t){if(!a(e,t)){if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(var r=0;r<i.length;r++)if(!o.call(t,i[r])||!a(e[i[r]],t[i[r]]))return!1}return!0};var o=Object.prototype.hasOwnProperty;function a(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}},{}],304:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),r=(i.__esModule=!0,i.default=function(e,t,i){(0,r.default)(e)||(0,o.default)(i+"() in "+t+" must return a plain object. Instead received "+e+".")},n(e("./isPlainObject"))),o=n(e("./warning"))},{"./isPlainObject":302,"./warning":305,"@babel/runtime/helpers/interopRequireDefault":140}],305:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],306:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],307:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.isCustomEvent=function(e){return this.state.event||!!e.getAttribute("data-event")},e.prototype.customBindListener=function(i){var n=this,e=this.state,t=e.event,e=e.eventOff,t=i.getAttribute("data-event")||t,r=i.getAttribute("data-event-off")||e;t.split(" ").forEach(function(e){i.removeEventListener(e,s.get(i,e));var t=o.bind(n,r);s.set(i,e,t),i.addEventListener(e,t,!1)}),r&&r.split(" ").forEach(function(e){i.removeEventListener(e,n.hideTooltip),i.addEventListener(e,n.hideTooltip,!1)})},e.prototype.customUnbindListener=function(e){var t=this.state,i=t.event,t=t.eventOff,n=i||e.getAttribute("data-event"),t=t||e.getAttribute("data-event-off");e.removeEventListener(n,s.get(e,i)),t&&e.removeEventListener(t,this.hideTooltip)}};var o=function(e,t){var i=this.state.show,n=this.props.id,r=t.currentTarget.getAttribute("data-iscapture"),r=r&&"true"===r||this.props.isCapture,o=t.currentTarget.getAttribute("currentItem");r||t.stopPropagation(),i&&"true"===o?e||this.hideTooltip(t):(t.currentTarget.setAttribute("currentItem","true"),a(t.currentTarget,this.getTargetArray(n)),this.showTooltip(t))},a=function(e,t){for(var i=0;i<t.length;i++)e!==t[i]?t[i].setAttribute("currentItem","false"):t[i].setAttribute("currentItem","true")},s={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function(e,t,i){this.id in e?e[this.id][t]=i:Object.defineProperty(e,this.id,{configurable:!0,value:(e=i,(i=t)in(t={})?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t)})},get:function(e,t){e=e[this.id];if(void 0!==e)return e[t]}}},{}],308:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.getEffect=function(e){return e.getAttribute("data-effect")||this.props.effect||"float"}}},{}],309:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.isCapture=function(e){return e&&"true"===e.getAttribute("data-iscapture")||this.props.isCapture||!1}}},{}],310:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.hide=function(e){r(n.default.GLOBAL.HIDE,{target:e})},e.rebuild=function(){r(n.default.GLOBAL.REBUILD)},e.show=function(e){r(n.default.GLOBAL.SHOW,{target:e})},e.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},e.prototype.globalShow=function(e){this.mount&&(e={currentTarget:e.detail.target},this.showTooltip(e,!0))},e.prototype.globalHide=function(e){var t;this.mount&&(t=!!(e&&e.detail&&e.detail.target),this.hideTooltip({currentTarget:t&&e.detail.target},t))}};var i=e("../constant"),n=i&&i.__esModule?i:{default:i},r=function(e,t){var i=void 0;"function"==typeof window.CustomEvent?i=new window.CustomEvent(e,{detail:t}):((i=document.createEvent("Event")).initEvent(e,!1,!0),i.detail=t),window.dispatchEvent(i)}},{"../constant":306}],311:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.bindRemovalTracker=function(){var r=this,e=n();null!=e&&((e=new e(function(e){for(var t=0;t<e.length;t++)for(var i=e[t],n=0;n<i.removedNodes.length;n++)if(i.removedNodes[n]===r.state.currentTarget)return void r.hideTooltip()})).observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=e)},e.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}};var n=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}},{}],312:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(n.default.GLOBAL.HIDE,this.globalHide),window.addEventListener(n.default.GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(n.default.GLOBAL.SHOW,this.globalShow),window.addEventListener(n.default.GLOBAL.SHOW,this.globalShow,!1),e&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},e.prototype.unbindWindowEvents=function(){window.removeEventListener(n.default.GLOBAL.HIDE,this.globalHide),window.removeEventListener(n.default.GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(n.default.GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},e.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}};var i=e("../constant"),n=i&&i.__esModule?i:{default:i}},{"../constant":306}],313:[function(e,t,i){"use strict";var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n=function(e,t,i){return t&&k(e.prototype,t),i&&k(e,i),e},c=x(e("react")),r=x(e("prop-types")),f=x(e("react-dom")),d=x(e("classnames")),u=x(e("sanitize-html-react")),o=x(e("./decorators/staticMethods")),a=x(e("./decorators/windowListener")),s=x(e("./decorators/customEvent")),p=x(e("./decorators/isCapture")),h=x(e("./decorators/getEffect")),m=x(e("./decorators/trackRemoval")),g=x(e("./utils/getPosition")),b=x(e("./utils/getTipContent")),v=e("./utils/aria"),y=x(e("./utils/nodeListToArray")),w=x(e("./style"));function k(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function x(e){return e&&e.__esModule?e:{default:e}}s=(0,o.default)(a=(0,a.default)(a=(0,s.default)(a=(0,p.default)(a=(0,h.default)(a=(0,m.default)((o=e=function(){function s(e){var t;if(this instanceof s)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e))).state={place:e.place||"top",desiredPlace:e.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,v.parseAria)(e),isEmptyTip:!1,disable:!1,originTooltip:null,isMultiline:!1},t.bind(["showTooltip","updateTooltip","hideTooltip","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),t.mount=!0,t.delayShowLoop=null,t.delayHideLoop=null,t.delayReshow=null,t.intervalUpdateContent=null,t;throw new TypeError("Cannot call a class as a function")}var e=s,t=c.default.Component;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n(s,[{key:"bind",value:function(e){var t=this;e.forEach(function(e){t[e]=t[e].bind(t)})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.insecure,e=e.resizeHide;t&&this.setStyleHeader(),this.bindListener(),this.bindWindowEvents(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.ariaProps,i=(0,v.parseAria)(e);Object.keys(i).some(function(e){return i[e]!==t[e]})&&this.setState({ariaProps:i})}},{key:"componentWillUnmount",value:function(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function(){return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.matches=this.tooltipRef.msMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function(e){var t=void 0;return t=e?(e=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),document.querySelectorAll('[data-tip][data-for="'+e+'"]')):document.querySelectorAll("[data-tip]:not([data-for])"),(0,y.default)(t)}},{key:"bindListener",value:function(){var n=this,e=this.props,t=e.id,i=e.globalEventOff,e=e.isCapture;this.getTargetArray(t).forEach(function(e){var t=n.isCapture(e),i=n.getEffect(e);null===e.getAttribute("currentItem")&&e.setAttribute("currentItem","false"),n.unbindBasicListener(e),n.isCustomEvent(e)?n.customBindListener(e):(e.addEventListener("mouseenter",n.showTooltip,t),"float"===i&&e.addEventListener("mousemove",n.updateTooltip,t),e.addEventListener("mouseleave",n.hideTooltip,t))}),i&&(window.removeEventListener(i,this.hideTooltip),window.addEventListener(i,this.hideTooltip,e)),this.bindRemovalTracker()}},{key:"unbindListener",value:function(){var t=this,e=this.props,i=e.id,e=e.globalEventOff;this.getTargetArray(i).forEach(function(e){t.unbindBasicListener(e),t.isCustomEvent(e)&&t.customUnbindListener(e)}),e&&window.removeEventListener(e,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function(e){var t=this.isCapture(e);e.removeEventListener("mouseenter",this.showTooltip,t),e.removeEventListener("mousemove",this.updateTooltip,t),e.removeEventListener("mouseleave",this.hideTooltip,t)}},{key:"getTooltipContent",value:function(){var e=this.props,t=e.getContent,e=e.children,i=void 0;return t&&(i=Array.isArray(t)?t[0]&&t[0](this.state.originTooltip):t(this.state.originTooltip)),(0,b.default)(this.state.originTooltip,e,i,this.state.isMultiline)}},{key:"isEmptyTip",value:function(e){return"string"==typeof e&&""===e||null===e}},{key:"showTooltip",value:function(t,e){var i,n,r,o,a,s,l,c,d,u,p,h;e&&!this.getTargetArray(this.props.id).some(function(e){return e===t.currentTarget})||(c=(h=this.props).multiline,i=h.getContent,n=t.currentTarget.getAttribute("data-tip"),r=t.currentTarget.getAttribute("data-multiline")||c||!1,h=t instanceof window.FocusEvent||e,o=!0,t.currentTarget.getAttribute("data-scroll-hide")?o="true"===t.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(o=this.props.scrollHide),a=t.currentTarget.getAttribute("data-place")||this.props.place||"top",s=h?"solid":this.getEffect(t.currentTarget),l=t.currentTarget.getAttribute("data-offset")||this.props.offset||{},c=(0,g.default)(t,t.currentTarget,f.default.findDOMNode(this),a,a,s,l),d=c.isNewState?c.newState.place:a,this.clearTimer(),u=t.currentTarget,e=this.state.show?u.getAttribute("data-delay-update")||this.props.delayUpdate:0,p=this,h=function(){p.setState({originTooltip:n,isMultiline:r,desiredPlace:a,place:d,type:u.getAttribute("data-type")||p.props.type||"dark",effect:s,offset:l,html:u.getAttribute("data-html")?"true"===u.getAttribute("data-html"):p.props.html||!1,delayShow:u.getAttribute("data-delay-show")||p.props.delayShow||0,delayHide:u.getAttribute("data-delay-hide")||p.props.delayHide||0,delayUpdate:u.getAttribute("data-delay-update")||p.props.delayUpdate||0,border:u.getAttribute("data-border")?"true"===u.getAttribute("data-border"):p.props.border||!1,extraClass:u.getAttribute("data-class")||p.props.class||p.props.className||"",disable:u.getAttribute("data-tip-disable")?"true"===u.getAttribute("data-tip-disable"):p.props.disable||!1,currentTarget:u},function(){o&&p.addScrollListener(p.state.currentTarget),p.updateTooltip(t),i&&Array.isArray(i)&&(p.intervalUpdateContent=setInterval(function(){var e;p.mount&&(e=p.props.getContent,e=(0,b.default)(n,"",e[0](),r),e=p.isEmptyTip(e),p.setState({isEmptyTip:e}),p.updatePosition())},i[1]))})},e?this.delayReshow=setTimeout(h,e):h())}},{key:"updateTooltip",value:function(t){var i=this,e=this.state,n=e.delayShow,e=e.disable,r=this.props.afterShow,o=this.getTooltipContent(),a=parseInt(n,10),s=t.currentTarget||t.target;this.mouseOnToolTip()||this.isEmptyTip(o)||e||(e=function(){var e;(Array.isArray(o)&&0<o.length||o)&&(e=!i.state.show,i.setState({currentEvent:t,currentTarget:s,show:!0},function(){i.updatePosition(),e&&r&&r()}))},clearTimeout(this.delayShowLoop),n?this.delayShowLoop=setTimeout(e,a):e())}},{key:"listenForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function(t,e){var i=this,n=this.state,r=n.delayHide,n=n.disable,o=this.props.afterHide,a=this.getTooltipContent();!this.mount||this.isEmptyTip(a)||n||(!e||this.getTargetArray(this.props.id).some(function(e){return e===t.currentTarget})&&this.state.show)&&(a=function(){var e=i.state.show;i.mouseOnToolTip()?i.listenForTooltipExit():(i.removeListenerForTooltipExit(),i.setState({show:!1},function(){i.removeScrollListener(),e&&o&&o()}))},this.clearTimer(),r?this.delayHideLoop=setTimeout(a,parseInt(r,10)):a())}},{key:"addScrollListener",value:function(e){e=this.isCapture(e);window.addEventListener("scroll",this.hideTooltip,e)}},{key:"removeScrollListener",value:function(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function(){var e=this,t=this.state,i=t.currentEvent,n=t.currentTarget,r=t.place,o=t.desiredPlace,a=t.effect,t=t.offset,s=f.default.findDOMNode(this),i=(0,g.default)(i,n,s,r,o,a,t);if(i.isNewState)return this.setState(i.newState,function(){e.updatePosition()});s.style.left=i.position.left+"px",s.style.top=i.position.top+"px"}},{key:"setStyleHeader",value:function(){var e,t=document.getElementsByTagName("head")[0];t.querySelector('style[id="react-tooltip"]')||((e=document.createElement("style")).id="react-tooltip",e.innerHTML=w.default,"undefined"!=typeof __webpack_nonce__&&__webpack_nonce__&&e.setAttribute("nonce",__webpack_nonce__),t.insertBefore(e,t.firstChild))}},{key:"clearTimer",value:function(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function(){var t=this,e=this.state,i=e.extraClass,n=e.html,r=e.ariaProps,e=e.disable,o=this.getTooltipContent(),a=this.isEmptyTip(o),e=(0,d.default)("__react_component_tooltip",{show:this.state.show&&!e&&!a},{border:this.state.border},{"place-top":"top"===this.state.place},{"place-bottom":"bottom"===this.state.place},{"place-left":"left"===this.state.place},{"place-right":"right"===this.state.place},{"type-dark":"dark"===this.state.type},{"type-success":"success"===this.state.type},{"type-warning":"warning"===this.state.type},{"type-error":"error"===this.state.type},{"type-info":"info"===this.state.type},{"type-light":"light"===this.state.type},{allow_hover:this.props.delayUpdate}),a=this.props.wrapper;return s.supportedWrappers.indexOf(a)<0&&(a=s.defaultProps.wrapper),n?c.default.createElement(a,l({className:e+" "+i,id:this.props.id,ref:function(e){return t.tooltipRef=e}},r,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:(0,u.default)(o,this.props.sanitizeHtmlOptions)}})):c.default.createElement(a,l({className:e+" "+i,id:this.props.id},r,{ref:function(e){return t.tooltipRef=e},"data-id":"tooltip"}),o)}}]),s}(),e.propTypes={children:r.default.any,place:r.default.string,type:r.default.string,effect:r.default.string,offset:r.default.object,multiline:r.default.bool,border:r.default.bool,insecure:r.default.bool,class:r.default.string,className:r.default.string,id:r.default.string,html:r.default.bool,delayHide:r.default.number,delayUpdate:r.default.number,delayShow:r.default.number,event:r.default.string,eventOff:r.default.string,watchWindow:r.default.bool,isCapture:r.default.bool,globalEventOff:r.default.string,getContent:r.default.any,afterShow:r.default.func,afterHide:r.default.func,disable:r.default.bool,scrollHide:r.default.bool,resizeHide:r.default.bool,wrapper:r.default.string,sanitizeHtmlOptions:r.default.any},e.defaultProps={insecure:!0,resizeHide:!0,wrapper:"div"},e.supportedWrappers=["div","span"],e.displayName="ReactTooltip",a=o))||a)||a)||a)||a)||a)||a;t.exports=s},{"./decorators/customEvent":307,"./decorators/getEffect":308,"./decorators/isCapture":309,"./decorators/staticMethods":310,"./decorators/trackRemoval":311,"./decorators/windowListener":312,"./style":314,"./utils/aria":315,"./utils/getPosition":316,"./utils/getTipContent":317,"./utils/nodeListToArray":318,classnames:154,"prop-types":272,react:320,"react-dom":276,"sanitize-html-react":345}],314:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip.allow_hover{pointer-events:auto}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}'},{}],315:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.parseAria=function(t){var i={};return Object.keys(t).filter(function(e){return/(^aria-\w+$|^role$)/.test(e)}).forEach(function(e){i[e]=t[e]}),i}},{}],316:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i,n,r,o,a){for(var s=S(i),l=s.width,s=s.height,c=S(t),d=c.width,c=c.height,e=T(e,t,o),u=e.mouseX,p=e.mouseY,h=A(o,d,c,l,s),t=N(a),f=t.extraOffset_X,m=t.extraOffset_Y,g=window.innerWidth,b=window.innerHeight,e=I(i),o=e.parentTop,d=e.parentLeft,v=function(e){e=h[e].l;return u+e+f},y=function(e){e=h[e].t;return p+e+m},w=function(e){return v(e)<0||(t=h[e].r,g<u+t+f)||y(e)<0||(t=h[e].b,b<p+t+m);var t},k=function(e){return!w(e)},x=["top","bottom","left","right"],E=[],C=0;C<4;C++){var _=x[C];k(_)&&E.push(_)}c=!1,l=void 0;return k(r)&&r!==n?(c=!0,l=r):0<E.length&&w(r)&&w(n)&&(c=!0,l=E[0]),c?{isNewState:!0,newState:{place:l}}:{isNewState:!1,position:{left:parseInt(v(n)-d,10),top:parseInt(y(n)-o,10)}}};var S=function(e){var e=e.getBoundingClientRect(),t=e.height,e=e.width;return{height:parseInt(t,10),width:parseInt(e,10)}},T=function(e,t,i){var n=t.getBoundingClientRect(),r=n.top,n=n.left,t=S(t),o=t.width,t=t.height;return"float"===i?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:n+o/2,mouseY:r+t/2}},A=function(e,t,i,n,r){var o=void 0,a=void 0,s=void 0,l=void 0;return"float"===e?(o={l:-n/2,r:n/2,t:-(r+3+2),b:-3},s={l:-n/2,r:n/2,t:15,b:r+3+2+12},l={l:-(n+3+2),r:-3,t:-r/2,b:r/2},a={l:3,r:n+3+2,t:-r/2,b:r/2}):"solid"===e&&(o={l:-n/2,r:n/2,t:-(i/2+r+2),b:-i/2},s={l:-n/2,r:n/2,t:i/2,b:i/2+r+2},l={l:-(n+t/2+2),r:-t/2,t:-r/2,b:r/2},a={l:t/2,r:n+t/2+2,t:-r/2,b:r/2}),{top:o,bottom:s,left:l,right:a}},N=function(e){var t,i=0,n=0;for(t in e="[object String]"===Object.prototype.toString.apply(e)?JSON.parse(e.toString().replace(/\'/g,'"')):e)"top"===t?n-=parseInt(e[t],10):"bottom"===t?n+=parseInt(e[t],10):"left"===t?i-=parseInt(e[t],10):"right"===t&&(i+=parseInt(e[t],10));return{extraOffset_X:i,extraOffset_Y:n}},I=function(e){for(var t=e;t&&"none"===window.getComputedStyle(t).getPropertyValue("transform");)t=t.parentElement;return{parentTop:t&&t.getBoundingClientRect().top||0,parentLeft:t&&t.getBoundingClientRect().left||0}}},{}],317:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i,n){return t||(null!=i?i:null===i?null:(t=/<br\s*\/?>/,n&&"false"!==n&&t.test(e)?e.split(t).map(function(e,t){return r.default.createElement("span",{key:t,className:"multi-line"},e)}):e))};var i=e("react"),r=i&&i.__esModule?i:{default:i}},{react:320}],318:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){var e=t.length;return t.hasOwnProperty?Array.prototype.slice.call(t):new Array(e).fill().map(function(e){return t[e]})}},{}],319:[function(e,t,M){"use strict";var d=e("object-assign"),e="function"==typeof Symbol&&Symbol.for,u=e?Symbol.for("react.element"):60103,c=e?Symbol.for("react.portal"):60106,i=e?Symbol.for("react.fragment"):60107,n=e?Symbol.for("react.strict_mode"):60108,r=e?Symbol.for("react.profiler"):60114,o=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,s=e?Symbol.for("react.concurrent_mode"):60111,l=e?Symbol.for("react.forward_ref"):60112,p=e?Symbol.for("react.suspense"):60113,h=e?Symbol.for("react.memo"):60115,f=e?Symbol.for("react.lazy"):60116,m="function"==typeof Symbol&&Symbol.iterator;function g(e){for(var t,i,n=arguments.length-1,r="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=0;o<n;o++)r+="&args[]="+encodeURIComponent(arguments[o+1]);var a=!1,e="Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",s=r,l=void 0,c=void 0,d=void 0,u=void 0,p=void 0;if(!a)throw(a=void 0)===e?a=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings."):(t=[s,l,c,d,u,p],i=0,(a=Error(e.replace(/%s/g,function(){return t[i++]}))).name="Invariant Violation"),a.framesToPop=1,a}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function y(e,t,i){this.props=e,this.context=t,this.refs=v,this.updater=i||b}function w(){}function k(e,t,i){this.props=e,this.context=t,this.refs=v,this.updater=i||b}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&g("85"),this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=y.prototype;var e=k.prototype=new w,x=(e.constructor=k,d(e,y.prototype),e.isPureReactComponent=!0,{current:null}),E={current:null},C=Object.prototype.hasOwnProperty,_={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,i){var n=void 0,r={},o=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,n)&&!_.hasOwnProperty(n)&&(r[n]=t[n]);var s=arguments.length-2;if(1===s)r.children=i;else if(1<s){for(var l=Array(s),c=0;c<s;c++)l[c]=arguments[c+2];r.children=l}if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===r[n]&&(r[n]=s[n]);return{$$typeof:u,type:e,key:o,ref:a,props:r,_owner:E.current}}function T(e){return"object"==typeof e&&null!==e&&e.$$typeof===u}var A=/\/+/g,N=[];function I(e,t,i,n){var r;return N.length?((r=N.pop()).result=e,r.keyPrefix=t,r.func=i,r.context=n,r.count=0,r):{result:e,keyPrefix:t,func:i,context:n,count:0}}function O(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,N.length<10&&N.push(e)}function P(e,t,i){return null==e?0:function e(t,i,n,r){var o=typeof t,a=!1;if(null===(t="undefined"!==o&&"boolean"!==o?t:null))a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case u:case c:a=!0}}if(a)return n(r,t,""===i?"."+D(t,0):i),1;if(a=0,i=""===i?".":i+":",Array.isArray(t))for(var s=0;s<t.length;s++){var l=i+D(o=t[s],s);a+=e(o,l,n,r)}else if("function"==typeof(l=null!==t&&"object"==typeof t&&"function"==typeof(l=m&&t[m]||t["@@iterator"])?l:null))for(t=l.call(t),s=0;!(o=t.next()).done;)a+=e(o=o.value,l=i+D(o,s++),n,r);else"object"===o&&g("31","[object Object]"==(n=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":n,"");return a}(e,"",t,i)}function D(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(e=e.key,i={"=":"=0",":":"=2"},"$"+(""+e).replace(/[=:]/g,function(e){return i[e]})):t.toString(36);var i}function B(e,t){e.func.call(e.context,t,e.count++)}function j(e,t,i){var n=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?L(e,n,i,function(e){return e}):null!=e&&(T(e)&&(t=r+(!(r=e).key||t&&t.key===e.key?"":(""+e.key).replace(A,"$&/")+"/")+i,e={$$typeof:u,type:r.type,key:t,ref:r.ref,props:r.props,_owner:r._owner}),n.push(e))}function L(e,t,i,n,r){var o="";P(e,j,t=I(t,o=null!=i?(""+i).replace(A,"$&/")+"/":o,n,r)),O(t)}function R(){var e=x.current;return null===e&&g("307"),e}e={Children:{map:function(e,t,i){return null==e||L(e,e=[],null,t,i),e},forEach:function(e,t,i){if(null==e)return e;P(e,B,t=I(null,null,t,i)),O(t)},count:function(e){return P(e,function(){return null},null)},toArray:function(e){var t=[];return L(e,t,null,function(e){return e}),t},only:function(e){return T(e)||g("143"),e}},createRef:function(){return{current:null}},Component:y,PureComponent:k,createContext:function(e,t){return(e={$$typeof:a,_calculateChangedBits:t=void 0===t?null:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:l,render:e}},lazy:function(e){return{$$typeof:f,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return R().useCallback(e,t)},useContext:function(e,t){return R().useContext(e,t)},useEffect:function(e,t){return R().useEffect(e,t)},useImperativeHandle:function(e,t,i){return R().useImperativeHandle(e,t,i)},useDebugValue:function(){},useLayoutEffect:function(e,t){return R().useLayoutEffect(e,t)},useMemo:function(e,t){return R().useMemo(e,t)},useReducer:function(e,t,i){return R().useReducer(e,t,i)},useRef:function(e){return R().useRef(e)},useState:function(e){return R().useState(e)},Fragment:i,StrictMode:n,Suspense:p,createElement:S,cloneElement:function(e,t,i){null==e&&g("267",e);var n=void 0,r=d({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){void 0!==t.ref&&(a=t.ref,s=E.current),void 0!==t.key&&(o=""+t.key);var l=void 0;for(n in e.type&&e.type.defaultProps&&(l=e.type.defaultProps),t)C.call(t,n)&&!_.hasOwnProperty(n)&&(r[n]=(void 0===t[n]&&void 0!==l?l:t)[n])}if(1==(n=arguments.length-2))r.children=i;else if(1<n){for(var l=Array(n),c=0;c<n;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:u,type:e.type,key:o,ref:a,props:r,_owner:s}},createFactory:function(e){var t=S.bind(null,e);return t.type=e,t},isValidElement:T,version:"16.8.3",unstable_ConcurrentMode:s,unstable_Profiler:r,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:x,ReactCurrentOwner:E,assign:d}};t.exports=e.default||e},{"object-assign":245}],320:[function(e,t,i){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":319}],321:[function(e,t,i){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":322}],322:[function(e,t,i){"use strict";var n=e("process-nextick-args"),r=Object.keys||function(e){var t,i=[];for(t in e)i.push(t);return i},t=(t.exports=d,Object.create(e("core-util-is"))),o=(t.inherits=e("inherits"),e("./_stream_readable")),a=e("./_stream_writable");t.inherits(d,o);for(var s=r(a.prototype),l=0;l<s.length;l++){var c=s[l];d.prototype[c]||(d.prototype[c]=a.prototype[c])}function d(e){if(!(this instanceof d))return new d(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":324,"./_stream_writable":326,"core-util-is":155,inherits:186,"process-nextick-args":269}],323:[function(e,t,i){"use strict";t.exports=r;var n=e("./_stream_transform"),t=Object.create(e("core-util-is"));function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}t.inherits=e("inherits"),t.inherits(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":325,"core-util-is":155,inherits:186}],324:[function(O,P,e){!function(N,I){!function(){"use strict";var g=O("process-nextick-args");P.exports=r;function b(e,t){return e.listeners(t).length}var o,a,v=O("isarray"),i=(r.ReadableState=n,O("events").EventEmitter,O("./internal/streams/stream")),u=O("safe-buffer").Buffer,p=(void 0!==I?I:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},e=Object.create(O("core-util-is")),t=(e.inherits=O("inherits"),O("util")),y=void 0,y=t&&t.debuglog?t.debuglog("stream"):function(){},s=O("./internal/streams/BufferList"),t=O("./internal/streams/destroy"),l=(e.inherits(r,i),["error","close","destroy","pause","resume"]);function n(e,t){e=e||{};var t=t instanceof(o=o||O("./_stream_duplex")),i=(this.objectMode=!!e.objectMode,t&&(this.objectMode=this.objectMode||!!e.readableObjectMode),e.highWaterMark),n=e.readableHighWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:t&&(n||0===n)?n:r,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a=a||O("string_decoder/").StringDecoder,this.decoder=new a(e.encoding),this.encoding=e.encoding)}function r(e){if(o=o||O("./_stream_duplex"),!(this instanceof r))return new r(e);this._readableState=new n(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy)&&(this._destroy=e.destroy),i.call(this)}function c(e,t,i,n,r){var o,a,s,l,c,d=e._readableState;return null===t?(d.reading=!1,s=e,(l=d).ended||(l.decoder&&(c=l.decoder.end())&&c.length&&(l.buffer.push(c),l.length+=l.objectMode?1:c.length),l.ended=!0,f(s))):(r||(c=d,s=l=t,o=a=u.isBuffer(s)||s instanceof p||"string"==typeof l||void 0===l||c.objectMode?a:new TypeError("Invalid non-string/buffer chunk")),o?e.emit("error",o):d.objectMode||t&&0<t.length?("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===u.prototype||(r=t,t=u.from(r)),n?d.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):h(e,d,t,!0):d.ended?e.emit("error",new Error("stream.push() after EOF")):(d.reading=!1,!d.decoder||i||(t=d.decoder.write(t),d.objectMode)||0!==t.length?h(e,d,t,!1):w(e,d))):n||(d.reading=!1)),!d.ended&&(d.needReadable||d.length<d.highWaterMark||0===d.length)}function h(e,t,i,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&f(e)),w(e,t)}Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),r.prototype.destroy=t.destroy,r.prototype._undestroy=t.undestroy,r.prototype._destroy=function(e,t){this.push(null),t(e)},r.prototype.push=function(e,t){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),i=!0),c(this,e,t,!1,i)},r.prototype.unshift=function(e){return c(this,e,null,!0,!1)},r.prototype.isPaused=function(){return!1===this._readableState.flowing},r.prototype.setEncoding=function(e){return a=a||O("string_decoder/").StringDecoder,this._readableState.decoder=new a(e),this._readableState.encoding=e,this};function d(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(8388608<=(i=e)?i=8388608:(i--,i=(i=(i=(i=(i|=i>>>1)|i>>>2)|i>>>4)|i>>>8)|i>>>16,i++),i)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var i}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(y("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?g.nextTick(m,e):m(e))}function m(e){y("emit readable"),e.emit("readable"),C(e)}function w(e,t){t.readingMore||(t.readingMore=!0,g.nextTick(k,e,t))}function k(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(y("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function x(e){y("readable nexttick read 0"),e.read(0)}function E(e,t){t.reading||(y("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(y("flow",t.flowing);t.flowing&&null!==e.read(););}function _(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(e=e,i=t.buffer,t=t.decoder,e<i.head.data.length?(n=i.head.data.slice(0,e),i.head.data=i.head.data.slice(e)):n=e===i.head.data.length?i.shift():(t?function(e,t){var i=t.head,n=1,r=i.data;for(e-=r.length;i=i.next;){var o=i.data,a=e>o.length?o.length:e;if(a===o.length?r+=o:r+=o.slice(0,e),0==(e-=a)){a===o.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i).data=o.slice(a);break}++n}return t.length-=n,r}:function(e,t){var i=u.allocUnsafe(e),n=t.head,r=1;for(n.data.copy(i),e-=n.data.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(i,i.length-e,0,a),0==(e-=a)){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=o.slice(a);break}++r}return t.length-=r,i})(e,i),r=n),r);var i,n,r}function S(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,g.nextTick(T,t,e))}function T(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}r.prototype.read=function(e){y("read",e),e=parseInt(e,10);var t,i=this._readableState,n=e;return 0!==e&&(i.emittedReadable=!1),0===e&&i.needReadable&&(i.length>=i.highWaterMark||i.ended)?(y("read: emitReadable",i.length,i.ended),(0===i.length&&i.ended?S:f)(this),null):0===(e=d(e,i))&&i.ended?(0===i.length&&S(this),null):(t=i.needReadable,y("need readable",t),(0===i.length||i.length-e<i.highWaterMark)&&y("length less than watermark",t=!0),i.ended||i.reading?y("reading or ended",t=!1):t&&(y("do read"),i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1,i.reading||(e=d(n,i))),null===(t=0<e?_(e,i):null)?(i.needReadable=!0,e=0):i.length-=e,0===i.length&&(i.ended||(i.needReadable=!0),n!==e)&&i.ended&&S(this),null!==t&&this.emit("data",t),t)},r.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},r.prototype.pipe=function(n,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=n;break;case 1:o.pipes=[o.pipes,n];break;default:o.pipes.push(n)}o.pipesCount+=1,y("pipe count=%d opts=%j",o.pipesCount,e);e=e&&!1===e.end||n===N.stdout||n===N.stderr?m:a;function a(){y("onend"),n.end()}o.endEmitted?g.nextTick(e):r.once("end",e),n.on("unpipe",function e(t,i){y("onunpipe"),t===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,y("cleanup"),n.removeListener("close",h),n.removeListener("finish",f),n.removeListener("drain",l),n.removeListener("error",p),n.removeListener("unpipe",e),r.removeListener("end",a),r.removeListener("end",m),r.removeListener("data",u),c=!0,!o.awaitDrain||n._writableState&&!n._writableState.needDrain||l())});t=r;var t,i,s,l=function(){var e=t._readableState;y("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(t,"data")&&(e.flowing=!0,C(t))},c=(n.on("drain",l),!1),d=!1;function u(e){y("ondata"),(d=!1)!==n.write(e)||d||((1===o.pipesCount&&o.pipes===n||1<o.pipesCount&&-1!==A(o.pipes,n))&&!c&&(y("false write response, pause",o.awaitDrain),o.awaitDrain++,d=!0),r.pause())}function p(e){y("onerror",e),m(),n.removeListener("error",p),0===b(n,"error")&&n.emit("error",e)}function h(){n.removeListener("finish",f),m()}function f(){y("onfinish"),n.removeListener("close",h),m()}function m(){y("unpipe"),r.unpipe(n)}return r.on("data",u),e="error",s=p,"function"==typeof(i=n).prependListener?i.prependListener(e,s):i._events&&i._events[e]?v(i._events[e])?i._events[e].unshift(s):i._events[e]=[s,i._events[e]]:i.on(e,s),n.once("close",h),n.once("finish",f),n.emit("pipe",r),o.flowing||(y("pipe resume"),r.resume()),n},r.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i));else if(e){var n=A(t.pipes,e);-1!==n&&(t.pipes.splice(n,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i))}else{var r=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<o;a++)r[a].emit("unpipe",this,{hasUnpiped:!1})}return this},r.prototype.addListener=r.prototype.on=function(e,t){t=i.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"!==e||(e=this._readableState).endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.emittedReadable=!1,e.reading?e.length&&f(this):g.nextTick(x,this)),t},r.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(y("resume"),t.flowing=!0,e=this,(t=t).resumeScheduled||(t.resumeScheduled=!0,g.nextTick(E,e,t))),this},r.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this},r.prototype.wrap=function(t){var e,i=this,n=this._readableState,r=!1;for(e in t.on("end",function(){var e;y("wrapped end"),n.decoder&&!n.ended&&(e=n.decoder.end())&&e.length&&i.push(e),i.push(null)}),t.on("data",function(e){y("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e||(n.objectMode||e&&e.length)&&!i.push(e)&&(r=!0,t.pause())}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var o=0;o<l.length;o++)t.on(l[o],this.emit.bind(this,l[o]));return this._read=function(e){y("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(r.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),r._fromList=_}.call(this)}.call(this,O("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":322,"./internal/streams/BufferList":327,"./internal/streams/destroy":328,"./internal/streams/stream":329,_process:270,"core-util-is":155,events:180,inherits:186,isarray:189,"process-nextick-args":269,"safe-buffer":330,"string_decoder/":331,util:152}],325:[function(e,t,i){"use strict";t.exports=r;var n=e("./_stream_duplex"),t=Object.create(e("core-util-is"));function r(e){if(!(this instanceof r))return new r(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var i=this._transformState,n=(i.transforming=!1,i.writecb);if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,(i.writecb=null)!=t&&this.push(t),n(e),(i=this._readableState).reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush)&&(this._flush=e.flush),this.on("prefinish",o)}function o(){var i=this;"function"==typeof this._flush?this._flush(function(e,t){a(i,e,t)}):a(this,null,null)}function a(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");e.push(null)}t.inherits=e("inherits"),t.inherits(r,n),r.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},r.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},r.prototype._write=function(e,t,i){var n=this._transformState;n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming&&(i=this._readableState,n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)},r.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},r.prototype._destroy=function(e,t){var i=this;n.prototype._destroy.call(this,e,function(e){t(e),i.emit("close")})}},{"./_stream_duplex":322,"core-util-is":155,inherits:186}],326:[function(E,C,e){!function(c,k,x){!function(){"use strict";var m=E("process-nextick-args");function d(r){var o=this;this.next=null,this.entry=null,this.finish=function(){var e=o,t=r,i=e.entry;for(e.entry=null;i;){var n=i.callback;t.pendingcb--,n(void 0),i=i.next}t.corkedRequestsFree.next=e}}C.exports=s;var o,t,u=!c.browser&&-1<["v0.10","v0.9."].indexOf(c.version.slice(0,5))?x:m.nextTick,e=(s.WritableState=a,Object.create(E("core-util-is"))),i=(e.inherits=E("inherits"),{deprecate:E("util-deprecate")}),n=E("./internal/streams/stream"),g=E("safe-buffer").Buffer,b=(void 0!==k?k:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},r=E("./internal/streams/destroy");function v(){}function a(e,c){o=o||E("./_stream_duplex"),e=e||{};var t=c instanceof o,i=(this.objectMode=!!e.objectMode,t&&(this.objectMode=this.objectMode||!!e.writableObjectMode),e.highWaterMark),n=e.writableHighWaterMark,r=this.objectMode?16:16384,i=(this.highWaterMark=i||0===i?i:t&&(n||0===n)?n:r,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,(this.destroyed=!1)===e.decodeStrings);this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,i,n,r,o,a,s,l;e=e,a=(t=c)._writableState,s=a.sync,l=a.writecb,(o=a).writing=!1,o.writecb=null,o.length-=o.writelen,o.writelen=0,e?(o=t,n=s,e=e,r=l,--(i=a).pendingcb,n?(m.nextTick(r,e),m.nextTick(w,o,i),o._writableState.errorEmitted=!0,o.emit("error",e)):(r(e),o._writableState.errorEmitted=!0,o.emit("error",e),w(o,i))):((n=f(a))||a.corked||a.bufferProcessing||!a.bufferedRequest||h(t,a),s?u(p,t,a,n,l):p(t,a,n,l))},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}function s(e){if(o=o||E("./_stream_duplex"),!(t.call(s,this)||this instanceof o))return new s(e);this._writableState=new a(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final)&&(this._final=e.final),n.call(this)}function y(e,t,i,n,r,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,i?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function p(e,t,i,n){var r;i||(i=e,0===(r=t).length&&r.needDrain&&(r.needDrain=!1,i.emit("drain"))),t.pendingcb--,n(),w(e,t)}function h(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,r=new Array(n),n=t.corkedRequestsFree;n.entry=i;for(var o=0,a=!0;i;)(r[o]=i).isBuf||(a=!1),i=i.next,o+=1;r.allBuffers=a,y(e,t,!0,t.length,r,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new d(t),t.bufferedRequestCount=0}else{for(;i;){var s=i.chunk,l=i.encoding,c=i.callback;if(y(e,t,!1,t.objectMode?1:s.length,s,l,c),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function f(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function l(t,i){t._final(function(e){i.pendingcb--,e&&t.emit("error",e),i.prefinished=!0,t.emit("prefinish"),w(t,i)})}function w(e,t){var i,n,r=f(t);return r&&(i=e,(n=t).prefinished||n.finalCalled||("function"==typeof i._final?(n.pendingcb++,n.finalCalled=!0,m.nextTick(l,i,n)):(n.prefinished=!0,i.emit("prefinish"))),0===t.pendingcb)&&(t.finished=!0,e.emit("finish")),r}e.inherits(s,n),a.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t};try{Object.defineProperty(a.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(t=Function.prototype[Symbol.hasInstance],Object.defineProperty(s,Symbol.hasInstance,{value:function(e){return!!t.call(this,e)||this===s&&e&&e._writableState instanceof a}})):t=function(e){return e instanceof this},s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,i){var n,r,o,a,s,l,c,d,u,p=this._writableState,h=!1,f=!p.objectMode&&(f=e,g.isBuffer(f)||f instanceof b);return f&&!g.isBuffer(e)&&(u=e,e=g.from(u)),"function"==typeof t&&(i=t,t=null),t=f?"buffer":t||p.defaultEncoding,"function"!=typeof i&&(i=v),p.ended?(u=this,c=i,d=new Error("write after end"),u.emit("error",d),m.nextTick(c,d)):(f||(c=this,d=p,a=i,l=!(s=!0),null===(o=e)?l=new TypeError("May not write null values to stream"):"string"==typeof o||void 0===o||d.objectMode||(l=new TypeError("Invalid non-string/buffer chunk")),l&&(c.emit("error",l),m.nextTick(a,l),s=!1),s))&&(p.pendingcb++,o=this,a=p,l=e,s=t,p=i,(e=f)||(r=l,n=s,r=a.objectMode||!1===a.decodeStrings||"string"!=typeof r?r:g.from(r,n),l!==r&&(e=!0,s="buffer",l=r)),n=a.objectMode?1:l.length,a.length+=n,(r=a.length<a.highWaterMark)||(a.needDrain=!0),a.writing||a.corked?(t=a.lastBufferedRequest,a.lastBufferedRequest={chunk:l,encoding:s,isBuf:e,callback:p,next:null},t?t.next=a.lastBufferedRequest:a.bufferedRequest=a.lastBufferedRequest,a.bufferedRequestCount+=1):y(o,a,!1,n,l,s,p),h=r),h},s.prototype.cork=function(){this._writableState.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||h(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase()))return this._writableState.defaultEncoding=e,this;throw new TypeError("Unknown encoding: "+e)},Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),s.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||(e=this,t=i,(i=n).ending=!0,w(e,i),t&&(i.finished?m.nextTick(t):e.once("finish",t)),i.ended=!0,e.writable=!1)},Object.defineProperty(s.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),s.prototype.destroy=r.destroy,s.prototype._undestroy=r.undestroy,s.prototype._destroy=function(e,t){this.end(),t(e)}}.call(this)}.call(this,E("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("timers").setImmediate)},{"./_stream_duplex":322,"./internal/streams/destroy":328,"./internal/streams/stream":329,_process:270,"core-util-is":155,inherits:186,"process-nextick-args":269,"safe-buffer":330,timers:377,"util-deprecate":378}],327:[function(e,t,i){"use strict";var a=e("safe-buffer").Buffer,n=e("util");function r(){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.head=null,this.tail=null,this.length=0}t.exports=(r.prototype.push=function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},r.prototype.unshift=function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},r.prototype.shift=function(){var e;if(0!==this.length)return e=this.head.data,1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},r.prototype.concat=function(e){if(0===this.length)return a.alloc(0);for(var t,i,n=a.allocUnsafe(e>>>0),r=this.head,o=0;r;)t=r.data,i=o,t.copy(n,i),o+=r.data.length,r=r.next;return n},r),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var e=n.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":330,util:152}],328:[function(e,t,i){"use strict";var o=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var i=this,n=this._readableState&&this._readableState.destroyed,r=this._writableState&&this._writableState.destroyed;return n||r?t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,o.nextTick(a,this,e)):o.nextTick(a,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?i._writableState?i._writableState.errorEmitted||(i._writableState.errorEmitted=!0,o.nextTick(a,i,e)):o.nextTick(a,i,e):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":269}],329:[function(e,t,i){t.exports=e("events").EventEmitter},{events:180}],330:[function(e,t,i){var n=e("buffer"),r=n.Buffer;function o(e,t){for(var i in e)t[i]=e[i]}function a(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,i),i.Buffer=a),o(r,a),a.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},a.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=r(e);return void 0!==t?"string"==typeof i?e.fill(t,i):e.fill(t):e.fill(0),e},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:153}],331:[function(e,t,i){"use strict";var n=e("safe-buffer").Buffer,r=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"==typeof t||n.isEncoding!==r&&r(e))return t||e;throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=d,this.end=u,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t,i=this.lastTotal-this.lastNeed,n=(t=this,128!=(192&(n=e)[0])?(t.lastNeed=0,"�"):1<t.lastNeed&&1<n.length?128!=(192&n[1])?(t.lastNeed=1,"�"):2<t.lastNeed&&2<n.length&&128!=(192&n[2])?(t.lastNeed=2,"�"):void 0:void 0);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,i,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,i,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);t=e.toString("utf16le",t);if(t){var i=t.charCodeAt(t.length-1);if(55296<=i&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],t.slice(0,-1)}return t}function c(e){var t,e=e&&e.length?this.write(e):"";return this.lastNeed?(t=this.lastTotal-this.lastNeed,e+this.lastChar.toString("utf16le",0,t)):e}function d(e,t){var i=(e.length-t)%3;return 0==i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1==i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function u(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}(i.StringDecoder=o).prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},o.prototype.end=function(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e},o.prototype.text=function(e,t){i=this,o=t;var i,n,r,o=(r=(a=e).length-1)<o?0:0<=(n=s(a[r]))?(0<n&&(i.lastNeed=n-1),n):--r<o||-2===n?0:0<=(n=s(a[r]))?(0<n&&(i.lastNeed=n-2),n):!(--r<o||-2===n)&&0<=(n=s(a[r]))?(0<n&&(2===n?n=0:i.lastNeed=n-3),n):0;if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=o;var a=e.length-(o-this.lastNeed);return e.copy(this.lastChar,0,a),e.toString("utf8",t,a)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":330}],332:[function(e,t,i){t.exports=e("./readable").PassThrough},{"./readable":333}],333:[function(e,t,i){(((i=t.exports=e("./lib/_stream_readable.js")).Stream=i).Readable=i).Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":322,"./lib/_stream_passthrough.js":323,"./lib/_stream_readable.js":324,"./lib/_stream_transform.js":325,"./lib/_stream_writable.js":326}],334:[function(e,t,i){t.exports=e("./readable").Transform},{"./readable":333}],335:[function(e,t,i){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":326}],336:[function(e,t,i){"use strict";i.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};i.default=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return function(o){return function(e,t,i){var e=o(e,t,i),n=e.dispatch,r={getState:e.getState,dispatch:function(e){return n(e)}},t=a.map(function(e){return e(r)}),n=l.default.apply(void 0,t)(e.dispatch);return s({},e,{dispatch:n})}}};var i=e("./compose"),l=i&&i.__esModule?i:{default:i}},{"./compose":339}],337:[function(e,t,i){"use strict";function s(e,t){return function(){return t(e.apply(void 0,arguments))}}i.__esModule=!0,i.default=function(e,t){if("function"==typeof e)return s(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var i=Object.keys(e),n={},r=0;r<i.length;r++){var o=i[r],a=e[o];"function"==typeof a&&(n[o]=s(a,t))}return n}},{}],338:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){for(var t=Object.keys(e),c={},i=0;i<t.length;i++){var n=t[i];"function"==typeof e[n]&&(c[n]=e[n])}var r,d=Object.keys(c),u=void 0;try{r=c,Object.keys(r).forEach(function(e){var t=r[e];if(void 0===t(void 0,{type:o.ActionTypes.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===t(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+o.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}catch(e){u=e}return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(u)throw u;for(var i=!1,n={},r=0;r<d.length;r++){var o,a=d[r],s=c[a],l=e[a],s=s(l,t);if(void 0===s)throw o=function(e,t){t=t&&t.type;return"Given action "+(t&&'"'+t.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}(a,t),new Error(o);n[a]=s,i=i||s!==l}return i?n:e}};var o=e("./createStore");function n(e){e&&e.__esModule}n(e("lodash/isPlainObject")),n(e("./utils/warning"))},{"./createStore":340,"./utils/warning":342,"lodash/isPlainObject":228}],339:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}},{}],340:[function(e,t,i){"use strict";i.__esModule=!0,i.ActionTypes=void 0,i.default=function e(t,i,n){if("function"==typeof i&&void 0===n&&(n=i,i=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(e)(t,i)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var r=t,o=i,a=[],s=a,l=!1;function c(){s===a&&(s=a.slice())}function d(){return o}function u(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var i=!0;return c(),s.push(t),function(){var e;i&&(i=!1,c(),e=s.indexOf(t),s.splice(e,1))}}function p(e){if(!(0,h.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(l)throw new Error("Reducers may not dispatch actions.");try{l=!0,o=r(o,e)}finally{l=!1}for(var t=a=s,i=0;i<t.length;i++)(0,t[i])();return e}return p({type:m.INIT}),(n={dispatch:p,subscribe:u,getState:d,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");r=e,p({type:m.INIT})}})[f.default]=function(){var e,i=u;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");function t(){e.next&&e.next(d())}return t(),{unsubscribe:i(t)}}})[f.default]=function(){return this},e},n};var h=n(e("lodash/isPlainObject")),f=n(e("symbol-observable"));function n(e){return e&&e.__esModule?e:{default:e}}var m=i.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":228,"symbol-observable":375}],341:[function(e,t,i){"use strict";i.__esModule=!0,i.compose=i.applyMiddleware=i.bindActionCreators=i.combineReducers=i.createStore=void 0;var n=l(e("./createStore")),r=l(e("./combineReducers")),o=l(e("./bindActionCreators")),a=l(e("./applyMiddleware")),s=l(e("./compose"));function l(e){return e&&e.__esModule?e:{default:e}}l(e("./utils/warning")),i.createStore=n.default,i.combineReducers=r.default,i.bindActionCreators=o.default,i.applyMiddleware=a.default,i.compose=s.default},{"./applyMiddleware":336,"./bindActionCreators":337,"./combineReducers":338,"./compose":339,"./createStore":340,"./utils/warning":342}],342:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],343:[function(e,t,i){t.exports=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],344:[function(e,t,i){var n=e("buffer"),r=n.Buffer;function o(e,t){for(var i in e)t[i]=e[i]}function a(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,i),i.Buffer=a),a.prototype=Object.create(r.prototype),o(r,a),a.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},a.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=r(e);return void 0!==t?"string"==typeof i?e.fill(t,i):e.fill(t):e.fill(0),e},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:153}],345:[function(e,t,i){var n=e("htmlparser2"),r=e("xtend"),o=e("regexp-quote");function k(t,i){t&&Object.keys(t).forEach(function(e){i(t[e],e)})}function x(e,t){return{}.hasOwnProperty.call(e,t)}function E(e,a,t){var s="";function l(e,t){var i=this;this.tag=e,this.attribs=t||{},this.tagPosition=s.length,this.text="",this.updateParentNodeText=function(){g.length&&(g[g.length-1].text+=i.text)}}a?(a=r(E.defaults,a)).parser?a.parser=r(C,a.parser):a.parser=C:(a=E.defaults).parser=C;var c,d,u=a.nonTextTags||["script","style","textarea"],p=(a.allowedAttributes&&(c={},d={},k(a.allowedAttributes,function(e,t){c[t]=[];var i=[];e.forEach(function(e){0<=e.indexOf("*")?i.push(o(e).replace(/\\\*/g,".*")):c[t].push(e)}),d[t]=new RegExp("^("+i.join("|")+")$")})),{});k(a.allowedClasses,function(e,t){c&&(x(c,t)||(c[t]=[]),c[t].push("class")),p[t]=e});var h,f={},m=(k(a.transformTags,function(e,t){var i;"function"==typeof e?i=e:"string"==typeof e&&(i=E.simpleTransform(e)),"*"===t?h=i:f[t]=i}),0),g=[],b={},v={},y=!1,w=0,i=new n.Parser({onopentag:function(r,e){var o,t,i,n;y?w++:(o=new l(r,e),g.push(o),i=!1,n=!!o.text,x(f,r)&&(t=f[r](r,e),o.attribs=e=t.attribs,void 0!==t.text&&(o.innerText=t.text),r!==t.tagName)&&(o.name=r=t.tagName,v[m]=t.tagName),h&&(t=h(r,e),o.attribs=e=t.attribs,r!==t.tagName)&&(o.name=r=t.tagName,v[m]=t.tagName),a.allowedTags&&-1===a.allowedTags.indexOf(r)&&(i=!0,-1!==u.indexOf(r)&&(y=!0,w=1),b[m]=!0),m++,i||(s+="<"+r,c&&!x(c,r)&&!c["*"]||k(e,function(i,e){if(!c||x(c,r)&&-1!==c[r].indexOf(e)||c["*"]&&-1!==c["*"].indexOf(e)||x(d,r)&&d[r].test(e)||d["*"]&&d["*"].test(e))return("href"!==e&&"src"!==e||!function(e){var t=i.replace(/[\x00-\x20]+/g,"").replace(/<\!\-\-.*?\-\-\>/g,"").match(/^([a-zA-Z]+)\:/);if(t)return t=t[1].toLowerCase(),x(a.allowedSchemesByTag,e)?-1===a.allowedSchemesByTag[e].indexOf(t):!a.allowedSchemes||-1===a.allowedSchemes.indexOf(t)}(r))&&("class"!==e||(t=i,(i=(n=p[r])?(t=t.split(/\s+/)).filter(function(e){return-1!==n.indexOf(e)}).join(" "):t).length))?(s+=" "+e,void(i.length&&(s+='="'+i+'"'))):delete o.attribs[e];var t,n;delete o.attribs[e]}),-1!==a.selfClosing.indexOf(r)?s+=" />":(s+=">",!o.innerText||n||a.textFilter||(s+=o.innerText))))},ontext:function(e){var t,i;y||((i=g[g.length-1])&&(t=i.tag,e=void 0!==i.innerText?i.innerText:e),"script"!==t&&"style"!==t&&a.textFilter?s+=a.textFilter(e):s+=e,g.length&&(g[g.length-1].text+=e))},onclosetag:function(e){if(y){if(--w)return;y=!1}var t=g.pop();t&&(y=!1,b[--m]?(delete b[m],t.updateParentNodeText()):(v[m]&&(e=v[m],delete v[m]),a.exclusiveFilter&&a.exclusiveFilter(t)?s=s.substr(0,t.tagPosition):(t.updateParentNodeText(),-1===a.selfClosing.indexOf(e)&&(s+="</"+e+">"))))}},a.parser);return i.write(e),i.end(),s}t.exports=E;var C={decodeEntities:!0};E.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},E.simpleTransform=function(n,r,o){return o=void 0===o||o,r=r||{},function(e,t){if(o)for(var i in r)t[i]=r[i];else t=r;return{tagName:n,attribs:t}}}},{htmlparser2:361,"regexp-quote":343,xtend:384}],346:[function(e,t,i){var n=e("domelementtype"),r=/\s+/g,o=e("./lib/node"),a=e("./lib/element");function s(e,t,i){"object"==typeof e?(i=t,t=e,e=null):"function"==typeof t&&(i=t,t=l),this._callback=e,this._options=t||l,this._elementCB=i,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};s.prototype.onparserinit=function(e){this._parser=e},s.prototype.onreset=function(){s.call(this,this._callback,this._options,this._elementCB)},s.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},s.prototype._handleCallback=s.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},s.prototype.onclosetag=function(){var e=this._tagStack.pop();this._options.withEndIndices&&e&&(e.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(e)},s.prototype._createDomElement=function(e){if(!this._options.withDomLvl1)return e;var t,i="tag"===e.type?Object.create(a):Object.create(o);for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i},s.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],i=t?t.children:this.dom,n=i[i.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withEndIndices&&(e.endIndex=this._parser.endIndex),n?(e.prev=n).next=e:e.prev=null,i.push(e),e.parent=t||null},s.prototype.onopentag=function(e,t){e={type:"script"===e?n.Script:"style"===e?n.Style:n.Tag,name:e,attribs:t,children:[]},t=this._createDomElement(e);this._addDomElement(t),this._tagStack.push(t)},s.prototype.ontext=function(e){var t,i=this._options.normalizeWhitespace||this._options.ignoreWhitespace;!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===n.Text||this._tagStack.length&&(t=(t=this._tagStack[this._tagStack.length-1])&&t.children[t.children.length-1])&&t.type===n.Text?i?t.data=(t.data+e).replace(r," "):t.data+=e:(i&&(e=e.replace(r," ")),t=this._createDomElement({data:e,type:n.Text}),this._addDomElement(t))},s.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];t&&t.type===n.Comment?t.data+=e:(t={data:e,type:n.Comment},e=this._createDomElement(t),this._addDomElement(e),this._tagStack.push(e))},s.prototype.oncdatastart=function(){var e={children:[{data:"",type:n.Text}],type:n.CDATA},e=this._createDomElement(e);this._addDomElement(e),this._tagStack.push(e)},s.prototype.oncommentend=s.prototype.oncdataend=function(){this._tagStack.pop()},s.prototype.onprocessinginstruction=function(e,t){e=this._createDomElement({name:e,data:t,type:n.Directive});this._addDomElement(e)},t.exports=s},{"./lib/element":347,"./lib/node":348,domelementtype:161}],347:[function(e,t,i){var e=e("./node"),n=t.exports=Object.create(e),r={tagName:"name"};Object.keys(r).forEach(function(e){var t=r[e];Object.defineProperty(n,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{"./node":348}],348:[function(e,t,i){var n=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return o[this.type]||o.element}},r={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},o={element:1,text:3,cdata:4,comment:8};Object.keys(r).forEach(function(e){var t=r[e];Object.defineProperty(n,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e}})})},{}],349:[function(e,t,i){var n=e("../maps/decode.json");t.exports=function(e){var t;return 55296<=e&&e<=57343||1114111<e?"�":(t="",65535<(e=e in n?n[e]:e)&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e))}},{"../maps/decode.json":350}],350:[function(e,t,i){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],351:[function(e,t,i){t.exports={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}},{}],352:[function(e,t,i){t.exports={Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"}},{}],353:[function(e,t,i){arguments[4][177][0].apply(i,arguments)},{dup:177}],354:[function(e,t,i){function n(e){this._cbs=e||{},this.events=[]}t.exports=n;var r=e("./").EVENTS;Object.keys(r).forEach(function(i){if(0===r[i])i="on"+i,n.prototype[i]=function(){this.events.push([i]),this._cbs[i]&&this._cbs[i]()};else if(1===r[i])i="on"+i,n.prototype[i]=function(e){this.events.push([i,e]),this._cbs[i]&&this._cbs[i](e)};else{if(2!==r[i])throw Error("wrong number of arguments");i="on"+i,n.prototype[i]=function(e,t){this.events.push([i,e,t]),this._cbs[i]&&this._cbs[i](e,t)}}}),n.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},n.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e,t=0,i=this.events.length;t<i;t++)this._cbs[this.events[t][0]]&&(1===(e=this.events[t].length)?this._cbs[this.events[t][0]]():2===e?this._cbs[this.events[t][0]](this.events[t][1]):this._cbs[this.events[t][0]](this.events[t][1],this.events[t][2]))}},{"./":361}],355:[function(e,t,i){var r=e("domhandler"),n=e("domutils");function o(e,t){this.init(e,t)}function a(e,t){return n.getElementsByTagName(e,t,!0)}function s(e,t){return n.getElementsByTagName(e,t,!0,1)[0]}function l(e,t,i){return n.getText(n.getElementsByTagName(e,t,i,1)).trim()}function c(e,t,i,n,r){i=l(i,n,r);i&&(e[t]=i)}e("inherits")(o,r),o.prototype.init=r;function d(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}o.prototype.onend=function(){var e,t,i={},n=s(d,this.dom);n&&("feed"===n.name?(t=n.children,i.type="atom",c(i,"id","id",t),c(i,"title","title",t),(e=(e=(e=s("link",t))&&e.attribs)&&e.href)&&(i.link=e),c(i,"description","subtitle",t),(e=l("updated",t))&&(i.updated=new Date(e)),c(i,"author","email",t,!0),i.items=a("entry",t).map(function(e){var t,i={};return c(i,"id","id",e=e.children),c(i,"title","title",e),(t=(t=(t=s("link",e))&&t.attribs)&&t.href)&&(i.link=t),(t=l("summary",e)||l("content",e))&&(i.description=t),(t=l("updated",e))&&(i.pubDate=new Date(t)),i})):(t=s("channel",n.children).children,i.type=n.name.substr(0,3),i.id="",c(i,"title","title",t),c(i,"link","link",t),c(i,"description","description",t),(e=l("lastBuildDate",t))&&(i.updated=new Date(e)),c(i,"author","managingEditor",t,!0),i.items=a("item",n.children).map(function(e){var t={};return c(t,"id","guid",e=e.children),c(t,"title","title",e),c(t,"link","link",e),c(t,"description","description",e),(e=l("pubDate",e))&&(t.pubDate=new Date(e)),t}))),this.dom=i,r.prototype._handleCallback.call(this,n?null:Error("couldn't find root of feed"))},t.exports=o},{domhandler:346,domutils:162,inherits:186}],356:[function(e,t,i){var n=e("./Tokenizer.js"),r={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},o={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:r,input:r,output:r,button:r,datalist:r,textarea:r,option:{option:!0},optgroup:{optgroup:!0}},a={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},s={__proto__:null,math:!0,svg:!0},l={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function d(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(n=this._options.Tokenizer),this._tokenizer=new n(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(d,e("events").EventEmitter),d.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},d.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},d.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in o)for(var t;(t=this._stack[this._stack.length-1])in o[e];this.onclosetag(t));!this._options.xmlMode&&e in a||(this._stack.push(e),e in s?this._foreignContext.push(!0):e in l&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},d.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in a&&this._cbs.onclosetag(this._tagname),this._tagname=""},d.prototype.onclosetag=function(e){if(this._updatePosition(1),((e=this._lowerCaseTagNames?e.toLowerCase():e)in s||e in l)&&this._foreignContext.pop(),!this._stack.length||e in a&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},d.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},d.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},d.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},d.prototype.onattribdata=function(e){this._attribvalue+=e},d.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},d.prototype._getInstructionName=function(e){var t=e.search(c),e=t<0?e:e.substr(0,t);return e=this._lowerCaseTagNames?e.toLowerCase():e},d.prototype.ondeclaration=function(e){var t;this._cbs.onprocessinginstruction&&(t=this._getInstructionName(e),this._cbs.onprocessinginstruction("!"+t,"!"+e))},d.prototype.onprocessinginstruction=function(e){var t;this._cbs.onprocessinginstruction&&(t=this._getInstructionName(e),this._cbs.onprocessinginstruction("?"+t,"?"+e))},d.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},d.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},d.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},d.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;0<e;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},d.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},d.prototype.parseComplete=function(e){this.reset(),this.end(e)},d.prototype.write=function(e){this._tokenizer.write(e)},d.prototype.end=function(e){this._tokenizer.end(e)},d.prototype.pause=function(){this._tokenizer.pause()},d.prototype.resume=function(){this._tokenizer.resume()},d.prototype.parseChunk=d.prototype.write,d.prototype.done=d.prototype.end,t.exports=d},{"./Tokenizer.js":359,events:180,inherits:186}],357:[function(e,t,i){function n(e){this._cbs=e||{}}t.exports=n;var r=e("./").EVENTS;Object.keys(r).forEach(function(i){if(0===r[i])i="on"+i,n.prototype[i]=function(){this._cbs[i]&&this._cbs[i]()};else if(1===r[i])i="on"+i,n.prototype[i]=function(e){this._cbs[i]&&this._cbs[i](e)};else{if(2!==r[i])throw Error("wrong number of arguments");i="on"+i,n.prototype[i]=function(e,t){this._cbs[i]&&this._cbs[i](e,t)}}})},{"./":361}],358:[function(e,t,i){t.exports=r;var n=e("./WritableStream.js");function r(e){n.call(this,new o(this),e)}function o(e){this.scope=e}e("inherits")(r,n),r.prototype.readable=!0;var a=e("../").EVENTS;Object.keys(a).forEach(function(i){if(0===a[i])o.prototype["on"+i]=function(){this.scope.emit(i)};else if(1===a[i])o.prototype["on"+i]=function(e){this.scope.emit(i,e)};else{if(2!==a[i])throw Error("wrong number of arguments!");o.prototype["on"+i]=function(e,t){this.scope.emit(i,e,t)}}})},{"../":361,"./WritableStream.js":360,inherits:186}],359:[function(e,t,i){t.exports=p;var n=e("entities/lib/decode_codepoint.js"),r=e("entities/maps/entities.json"),o=e("entities/maps/legacy.json"),a=e("entities/maps/xml.json"),t=0,s=t++,e=(t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,t++,0),l=e++;function c(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function d(t,i,n){var r=t.toLowerCase();return t===r?function(e){e===r?this._state=i:(this._state=n,this._index--)}:function(e){e===r||e===t?this._state=i:(this._state=n,this._index--)}}function u(t,i){var n=t.toLowerCase();return function(e){e===n||e===t?this._state=i:(this._state=2,this._index--)}}function p(e,t){this._state=s,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=s,this._special=l,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}p.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=1,this._sectionStart=this._index):this._decodeEntities&&this._special===l&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=s,this._state=50,this._sectionStart=this._index)},p.prototype._stateBeforeTagName=function(e){"/"===e?this._state=4:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==l||c(e)?this._state=s:"!"===e?(this._state=14,this._sectionStart=this._index+1):"?"===e?(this._state=16,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?2:30,this._sectionStart=this._index)},p.prototype._stateInTagName=function(e){"/"!==e&&">"!==e&&!c(e)||(this._emitToken("onopentagname"),this._state=7,this._index--)},p.prototype._stateBeforeCloseingTagName=function(e){c(e)||(">"===e?this._state=s:this._special!==l?"s"===e||"S"===e?this._state=31:(this._state=s,this._index--):(this._state=5,this._sectionStart=this._index))},p.prototype._stateInCloseingTagName=function(e){">"!==e&&!c(e)||(this._emitToken("onclosetag"),this._state=6,this._index--)},p.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=s,this._sectionStart=this._index+1)},p.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=s,this._sectionStart=this._index+1):"/"===e?this._state=3:c(e)||(this._state=8,this._sectionStart=this._index)},p.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=s,this._sectionStart=this._index+1):c(e)||(this._state=7,this._index--)},p.prototype._stateInAttributeName=function(e){"="!==e&&"/"!==e&&">"!==e&&!c(e)||(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=9,this._index--)},p.prototype._stateAfterAttributeName=function(e){"="===e?this._state=10:"/"===e||">"===e?(this._cbs.onattribend(),this._state=7,this._index--):c(e)||(this._cbs.onattribend(),this._state=8,this._sectionStart=this._index)},p.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=11,this._sectionStart=this._index+1):"'"===e?(this._state=12,this._sectionStart=this._index+1):c(e)||(this._state=13,this._sectionStart=this._index,this._index--)},p.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},p.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},p.prototype._stateInAttributeValueNoQuotes=function(e){c(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=7,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=50,this._sectionStart=this._index)},p.prototype._stateBeforeDeclaration=function(e){this._state="["===e?21:"-"===e?17:15},p.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=s,this._sectionStart=this._index+1)},p.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=s,this._sectionStart=this._index+1)},p.prototype._stateBeforeComment=function(e){"-"===e?(this._state=18,this._sectionStart=this._index+1):this._state=15},p.prototype._stateInComment=function(e){"-"===e&&(this._state=19)},p.prototype._stateAfterComment1=function(e){this._state="-"===e?20:18},p.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=s,this._sectionStart=this._index+1):"-"!==e&&(this._state=18)},p.prototype._stateBeforeCdata1=d("C",22,15),p.prototype._stateBeforeCdata2=d("D",23,15),p.prototype._stateBeforeCdata3=d("A",24,15),p.prototype._stateBeforeCdata4=d("T",25,15),p.prototype._stateBeforeCdata5=d("A",26,15),p.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=27,this._sectionStart=this._index+1):(this._state=15,this._index--)},p.prototype._stateInCdata=function(e){"]"===e&&(this._state=28)},p.prototype._stateAfterCdata1=function(e){this._state="]"===e?29:27},p.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=s,this._sectionStart=this._index+1):"]"!==e&&(this._state=27)},p.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=32:"t"===e||"T"===e?this._state=42:(this._state=2,this._index--)},p.prototype._stateBeforeSpecialEnd=function(e){1!==this._special||"c"!==e&&"C"!==e?2!==this._special||"t"!==e&&"T"!==e?this._state=s:this._state=46:this._state=37},p.prototype._stateBeforeScript1=u("R",33),p.prototype._stateBeforeScript2=u("I",34),p.prototype._stateBeforeScript3=u("P",35),p.prototype._stateBeforeScript4=u("T",36),p.prototype._stateBeforeScript5=function(e){"/"!==e&&">"!==e&&!c(e)||(this._special=1),this._state=2,this._index--},p.prototype._stateAfterScript1=d("R",38,s),p.prototype._stateAfterScript2=d("I",39,s),p.prototype._stateAfterScript3=d("P",40,s),p.prototype._stateAfterScript4=d("T",41,s),p.prototype._stateAfterScript5=function(e){">"===e||c(e)?(this._special=l,this._state=5,this._sectionStart=this._index-6,this._index--):this._state=s},p.prototype._stateBeforeStyle1=u("Y",43),p.prototype._stateBeforeStyle2=u("L",44),p.prototype._stateBeforeStyle3=u("E",45),p.prototype._stateBeforeStyle4=function(e){"/"!==e&&">"!==e&&!c(e)||(this._special=2),this._state=2,this._index--},p.prototype._stateAfterStyle1=d("Y",47,s),p.prototype._stateAfterStyle2=d("L",48,s),p.prototype._stateAfterStyle3=d("E",49,s),p.prototype._stateAfterStyle4=function(e){">"===e||c(e)?(this._special=l,this._state=5,this._sectionStart=this._index-5,this._index--):this._state=s},p.prototype._stateBeforeEntity=d("#",51,52),p.prototype._stateBeforeNumericEntity=d("X",54,53),p.prototype._parseNamedEntityStrict=function(){var e,t;this._sectionStart+1<this._index&&(e=this._buffer.substring(this._sectionStart+1,this._index),(t=this._xmlMode?a:r).hasOwnProperty(e))&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)},p.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(6<t&&(t=6);2<=t;){var i=this._buffer.substr(e,t);if(o.hasOwnProperty(i))return this._emitPartial(o[i]),void(this._sectionStart+=t+1);t--}},p.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||"z"<e)&&(e<"A"||"Z"<e)&&(e<"0"||"9"<e)&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==s?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},p.prototype._decodeNumericEntity=function(e,t){var e=this._sectionStart+e;e!==this._index?(e=this._buffer.substring(e,this._index),e=parseInt(e,t),this._emitPartial(n(e)),this._sectionStart=this._index):this._sectionStart--,this._state=this._baseState},p.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},p.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||"f"<e)&&(e<"A"||"F"<e)&&(e<"0"||"9"<e)&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},p.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===s?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},p.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},p.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===s?this._stateText(e):1===this._state?this._stateBeforeTagName(e):2===this._state?this._stateInTagName(e):4===this._state?this._stateBeforeCloseingTagName(e):5===this._state?this._stateInCloseingTagName(e):6===this._state?this._stateAfterCloseingTagName(e):3===this._state?this._stateInSelfClosingTag(e):7===this._state?this._stateBeforeAttributeName(e):8===this._state?this._stateInAttributeName(e):9===this._state?this._stateAfterAttributeName(e):10===this._state?this._stateBeforeAttributeValue(e):11===this._state?this._stateInAttributeValueDoubleQuotes(e):12===this._state?this._stateInAttributeValueSingleQuotes(e):13===this._state?this._stateInAttributeValueNoQuotes(e):14===this._state?this._stateBeforeDeclaration(e):15===this._state?this._stateInDeclaration(e):16===this._state?this._stateInProcessingInstruction(e):17===this._state?this._stateBeforeComment(e):18===this._state?this._stateInComment(e):19===this._state?this._stateAfterComment1(e):20===this._state?this._stateAfterComment2(e):21===this._state?this._stateBeforeCdata1(e):22===this._state?this._stateBeforeCdata2(e):23===this._state?this._stateBeforeCdata3(e):24===this._state?this._stateBeforeCdata4(e):25===this._state?this._stateBeforeCdata5(e):26===this._state?this._stateBeforeCdata6(e):27===this._state?this._stateInCdata(e):28===this._state?this._stateAfterCdata1(e):29===this._state?this._stateAfterCdata2(e):30===this._state?this._stateBeforeSpecial(e):31===this._state?this._stateBeforeSpecialEnd(e):32===this._state?this._stateBeforeScript1(e):33===this._state?this._stateBeforeScript2(e):34===this._state?this._stateBeforeScript3(e):35===this._state?this._stateBeforeScript4(e):36===this._state?this._stateBeforeScript5(e):37===this._state?this._stateAfterScript1(e):38===this._state?this._stateAfterScript2(e):39===this._state?this._stateAfterScript3(e):40===this._state?this._stateAfterScript4(e):41===this._state?this._stateAfterScript5(e):42===this._state?this._stateBeforeStyle1(e):43===this._state?this._stateBeforeStyle2(e):44===this._state?this._stateBeforeStyle3(e):45===this._state?this._stateBeforeStyle4(e):46===this._state?this._stateAfterStyle1(e):47===this._state?this._stateAfterStyle2(e):48===this._state?this._stateAfterStyle3(e):49===this._state?this._stateAfterStyle4(e):50===this._state?this._stateBeforeEntity(e):51===this._state?this._stateBeforeNumericEntity(e):52===this._state?this._stateInNamedEntity(e):53===this._state?this._stateInNumericEntity(e):54===this._state?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},p.prototype.pause=function(){this._running=!1},p.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},p.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},p.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},p.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);27===this._state||28===this._state||29===this._state?this._cbs.oncdata(e):18===this._state||19===this._state||20===this._state?this._cbs.oncomment(e):52!==this._state||this._xmlMode?53!==this._state||this._xmlMode?54!==this._state||this._xmlMode?2!==this._state&&7!==this._state&&10!==this._state&&9!==this._state&&8!==this._state&&12!==this._state&&11!==this._state&&13!==this._state&&5!==this._state&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},p.prototype.reset=function(){p.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},p.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},p.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},p.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},p.prototype._emitPartial=function(e){this._baseState!==s?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":349,"entities/maps/entities.json":351,"entities/maps/legacy.json":352,"entities/maps/xml.json":353}],360:[function(e,t,i){t.exports=s;var r=e("./Parser.js"),o=e("readable-stream").Writable,a=e("string_decoder").StringDecoder,n=e("buffer").Buffer;function s(e,t){var i=this._parser=new r(e,t),n=this._decoder=new a;o.call(this,{decodeStrings:!1}),this.once("finish",function(){i.end(n.end())})}e("inherits")(s,o),s.prototype._write=function(e,t,i){e instanceof n&&(e=this._decoder.write(e)),this._parser.write(e),i()}},{"./Parser.js":356,buffer:153,inherits:186,"readable-stream":152,string_decoder:365}],361:[function(e,n,t){var r=e("./Parser.js"),o=e("domhandler");function i(e,t){return delete n.exports[e],n.exports[e]=t}n.exports={Parser:r,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:o,get FeedHandler(){return i("FeedHandler",e("./FeedHandler.js"))},get Stream(){return i("Stream",e("./Stream.js"))},get WritableStream(){return i("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return i("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return i("DomUtils",e("domutils"))},get CollectingHandler(){return i("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:o,get RssHandler(){return i("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var i=new o(t);return new r(i,t).end(e),i.dom},parseFeed:function(e,t){var i=new n.exports.FeedHandler(t);return new r(i,t).end(e),i.dom},createDomStream:function(e,t,i){e=new o(e,t,i);return new r(e,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":354,"./FeedHandler.js":355,"./Parser.js":356,"./ProxyHandler.js":357,"./Stream.js":358,"./Tokenizer.js":359,"./WritableStream.js":360,domelementtype:161,domhandler:346,domutils:162}],362:[function(e,t,i){function n(e){this.options=s.extend({},n.defaultOptions,e),this.disabled=!1,this.clear()}function r(e){this.options=s.extend({},r.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}var s;i=void 0===i?this:i,Date.now=Date.now||function(){return(new Date).getTime()},s={extend:function(){arguments[0]=arguments[0]||{};for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&("object"!=typeof arguments[e][t]||arguments[e][t]instanceof Array?arguments[0][t]=arguments[e][t]:arguments[0][t]=s.extend(arguments[0][t],arguments[e][t]));return arguments[0]},binarySearch:function(e,t){for(var i=0,n=e.length;i<n;){var r=i+n>>1;t<e[r][0]?n=r:i=1+r}return i}},n.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},n.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var t=this.data[e][1];t>this.maxValue&&(this.maxValue=t),t<this.minValue&&(this.minValue=t)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},n.prototype.append=function(e,t,i){for(var n=this.data.length-1;0<=n&&this.data[n][0]>e;)n--;-1===n?this.data.splice(0,0,[e,t]):0<this.data.length&&this.data[n][0]===e?i?(this.data[n][1]+=t,t=this.data[n][1]):this.data[n][1]=t:n<this.data.length-1?this.data.splice(n+1,0,[e,t]):this.data.push([e,t]),this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},r.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},yIntermediateFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!(n.prototype.dropOldData=function(e,t){for(var i=0;this.data.length-i>=t&&this.data[i+1][0]<e;)i++;0!==i&&this.data.splice(0,i)}),displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:r.tooltipFormatter=function(e,t){for(var i=[(this.options.timestampFormatter||r.timeFormatter)(new Date(e))],n=0;n<t.length;++n)i.push('<span style="color:'+t[n].series.options.strokeStyle+'">'+this.options.yMaxFormatter(t[n].value,this.options.labels.precision)+"</span>");return i.join("<br>")},nonRealtimeData:!1,responsive:!1,limitFPS:0},r.AnimateCompatibility={requestAnimationFrame:function(e,t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(function(){e(Date.now())},16)}).call(window,e,t)},cancelAnimationFrame:function(e){return(window.cancelAnimationFrame||function(e){clearTimeout(e)}).call(window,e)}},r.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},r.prototype.addTimeSeries=function(e,t){this.seriesSet.push({timeSeries:e,options:s.extend({},r.defaultSeriesPresentationOptions,t)}),e.options.resetBounds&&0<e.options.resetBoundsInterval&&(e.resetBoundsTimerId=setInterval(function(){e.resetBounds()},e.options.resetBoundsInterval))},r.prototype.removeTimeSeries=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e){this.seriesSet.splice(i,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},r.prototype.getTimeSeriesOptions=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e)return this.seriesSet[i].options},r.prototype.bringToFront=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e){var n=this.seriesSet.splice(i,1);this.seriesSet.push(n[0]);break}},r.prototype.streamTo=function(e,t){this.canvas=e,this.delay=t,this.start()},r.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},r.prototype.updateTooltip=function(){var e=this.getTooltipEl();if(this.mouseover&&this.options.tooltip){for(var t=this.lastChartTimestamp,i=this.options.scrollBackwards?t-this.mouseX*this.options.millisPerPixel:t-(this.canvas.offsetWidth-this.mouseX)*this.options.millisPerPixel,n=[],r=0;r<this.seriesSet.length;r++){var o,a=this.seriesSet[r].timeSeries;a.disabled||0<(o=s.binarySearch(a.data,i))&&o<a.data.length&&n.push({series:this.seriesSet[r],index:o,value:a.data[o][1]})}n.length?(e.innerHTML=this.options.tooltipFormatter.call(this,i,n),e.style.display="block"):e.style.display="none"}else e.style.display="none"},r.prototype.mousemove=function(e){this.mouseover=!0,this.mouseX=e.offsetX,this.mouseY=e.offsetY,this.mousePageX=e.pageX,this.mousePageY=e.pageY;e=this.getTooltipEl();e.style.top=Math.round(this.mousePageY)+"px",e.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()},r.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},r.prototype.resize=function(){var e,t,i=this.options.enableDpiScaling&&window?window.devicePixelRatio:1;this.options.responsive?(e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,e!==this.lastWidth&&(this.lastWidth=e,this.canvas.setAttribute("width",Math.floor(e*i).toString()),this.canvas.getContext("2d").scale(i,i)),t!==this.lastHeight&&(this.lastHeight=t,this.canvas.setAttribute("height",Math.floor(t*i).toString()),this.canvas.getContext("2d").scale(i,i))):1!==i&&(e=parseInt(this.canvas.getAttribute("width")),t=parseInt(this.canvas.getAttribute("height")),this.originalWidth&&Math.floor(this.originalWidth*i)===e||(this.originalWidth=e,this.canvas.setAttribute("width",Math.floor(e*i).toString()),this.canvas.style.width=e+"px",this.canvas.getContext("2d").scale(i,i)),this.originalHeight&&Math.floor(this.originalHeight*i)===t||(this.originalHeight=t,this.canvas.setAttribute("height",Math.floor(t*i).toString()),this.canvas.style.height=t+"px",this.canvas.getContext("2d").scale(i,i)))},r.prototype.start=function(){var i;this.frame||(this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout),(i=function(){this.frame=r.AnimateCompatibility.requestAnimationFrame(function(){var e,t;this.options.nonRealtimeData?(e=new Date(0),t=this.seriesSet.reduce(function(e,t){var t=t.timeSeries.data,i=(i=0<=(i=Math.round(this.options.displayDataFromPercentile*t.length)-1)?i:0)<=t.length-1?i:t.length-1;return e=t&&0<t.length?(t=t[i][0])<e?e:t:e}.bind(this),e),this.render(this.canvas,e<t?t:null)):this.render(),i()}.bind(this))}.bind(this))())},r.prototype.stop=function(){this.frame&&(r.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},r.prototype.updateValueRange=function(){for(var e,t,i=this.options,n=Number.NaN,r=Number.NaN,o=0;o<this.seriesSet.length;o++){var a=this.seriesSet[o].timeSeries;a.disabled||(isNaN(a.maxValue)||(n=isNaN(n)?a.maxValue:Math.max(n,a.maxValue)),isNaN(a.minValue))||(r=isNaN(r)?a.minValue:Math.min(r,a.minValue))}null!=i.maxValue?n=i.maxValue:n*=i.maxValueScale,null!=i.minValue?r=i.minValue:r-=Math.abs(r*i.minValueScale-r),this.options.yRangeFunction&&(r=(e=this.options.yRangeFunction({min:r,max:n})).min,n=e.max),isNaN(n)||isNaN(r)||(e=n-r-this.currentValueRange,t=r-this.currentVisMinValue,this.isAnimatingScale=.1<Math.abs(e)||.1<Math.abs(t),this.currentValueRange+=i.scaleSmoothing*e,this.currentVisMinValue+=i.scaleSmoothing*t),this.valueRange={min:r,max:n}},r.prototype.render=function(e,t){var i=Date.now();if(!(0<this.options.limitFPS&&i-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(!this.isAnimatingScale){var n=Math.min(1e3/6,this.options.millisPerPixel);if(i-this.lastRenderTimeMillis<n)return}this.resize(),this.updateTooltip(),this.lastRenderTimeMillis=i,e=e||this.canvas,t=t||i-(this.delay||0),t-=t%this.options.millisPerPixel,this.lastChartTimestamp=t;function r(e){return a.scrollBackwards?Math.round((t-e)/a.millisPerPixel):Math.round(s.width-(t-e)/a.millisPerPixel)}var o=e.getContext("2d"),a=this.options,s={top:0,left:0,width:e.clientWidth,height:e.clientHeight},l=t-s.width*a.millisPerPixel,c=function(e){e-=this.currentVisMinValue;return 0===this.currentValueRange?s.height:s.height-Math.round(e/this.currentValueRange*s.height)}.bind(this);if(this.updateValueRange(),o.font=a.labels.fontSize+"px "+a.labels.fontFamily,o.save(),o.translate(s.left,s.top),o.beginPath(),o.rect(0,0,s.width,s.height),o.clip(),o.save(),o.fillStyle=a.grid.fillStyle,o.clearRect(0,0,s.width,s.height),o.fillRect(0,0,s.width,s.height),o.restore(),o.save(),o.lineWidth=a.grid.lineWidth,o.strokeStyle=a.grid.strokeStyle,0<a.grid.millisPerLine){o.beginPath();for(var d=t-t%a.grid.millisPerLine;l<=d;d-=a.grid.millisPerLine){var u=r(d);a.grid.sharpLines&&(u-=.5),o.moveTo(u,0),o.lineTo(u,s.height)}o.stroke(),o.closePath()}for(var p=1;p<a.grid.verticalSections;p++){var h=Math.round(p*s.height/a.grid.verticalSections);a.grid.sharpLines&&(h-=.5),o.beginPath(),o.moveTo(0,h),o.lineTo(s.width,h),o.stroke(),o.closePath()}if(a.grid.borderVisible&&(o.beginPath(),o.strokeRect(0,0,s.width,s.height),o.closePath()),o.restore(),a.horizontalLines&&a.horizontalLines.length)for(var f=0;f<a.horizontalLines.length;f++){var m=a.horizontalLines[f],g=Math.round(c(m.value))-.5;o.strokeStyle=m.color||"#ffffff",o.lineWidth=m.lineWidth||1,o.beginPath(),o.moveTo(0,g),o.lineTo(s.width,g),o.stroke(),o.closePath()}for(var b,v=0;v<this.seriesSet.length;v++){o.save();var y=this.seriesSet[v].timeSeries;if(!y.disabled){var w=y.data,k=this.seriesSet[v].options;y.dropOldData(l,a.maxDataSetLength),o.lineWidth=k.lineWidth,o.strokeStyle=k.strokeStyle,o.beginPath();for(var x=0,E=0,C=0,_=0;_<w.length&&1!==w.length;_++){var S=r(w[_][0]),T=c(w[_][1]);if(0===_)o.moveTo(x=S,T);else switch(a.interpolation){case"linear":case"line":o.lineTo(S,T);break;case"bezier":default:o.bezierCurveTo(Math.round((E+S)/2),C,Math.round(E+S)/2,T,S,T);break;case"step":o.lineTo(S,C),o.lineTo(S,T)}E=S,C=T}1<w.length&&(k.fillStyle&&(o.lineTo(s.width+k.lineWidth+1,C),o.lineTo(s.width+k.lineWidth+1,s.height+k.lineWidth+1),o.lineTo(x,s.height+k.lineWidth),o.fillStyle=k.fillStyle,o.fill()),k.strokeStyle&&"none"!==k.strokeStyle&&o.stroke(),o.closePath()),o.restore()}}if(a.tooltip&&0<=this.mouseX&&(o.lineWidth=a.tooltipLine.lineWidth,o.strokeStyle=a.tooltipLine.strokeStyle,o.beginPath(),o.moveTo(this.mouseX,0),o.lineTo(this.mouseX,s.height),o.closePath(),o.stroke(),this.updateTooltip()),a.labels.disabled||isNaN(this.valueRange.min)||isNaN(this.valueRange.max)||(n=a.yMaxFormatter(this.valueRange.max,a.labels.precision),b=a.yMinFormatter(this.valueRange.min,a.labels.precision),i=a.scrollBackwards?0:s.width-o.measureText(n).width-2,e=a.scrollBackwards?0:s.width-o.measureText(b).width-2,o.fillStyle=a.labels.fillStyle,o.fillText(n,i,a.labels.fontSize),o.fillText(b,e,s.height-2)),a.labels.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&0<a.grid.verticalSections)for(var A=(this.valueRange.max-this.valueRange.min)/a.grid.verticalSections,N=s.height/a.grid.verticalSections,p=1;p<a.grid.verticalSections;p++){h=s.height-Math.round(p*N),a.grid.sharpLines&&(h-=.5);var I=a.yIntermediateFormatter(this.valueRange.min+p*A,a.labels.precision);intermediateLabelPos=a.labels.intermediateLabelSameAxis?a.scrollBackwards?0:s.width-o.measureText(I).width-2:a.scrollBackwards?s.width-o.measureText(I).width-2:0,o.fillText(I,intermediateLabelPos,h-a.grid.lineWidth)}if(a.timestampFormatter&&0<a.grid.millisPerLine)for(var O=a.scrollBackwards?o.measureText(b).width:s.width-o.measureText(b).width+4,d=t-t%a.grid.millisPerLine;l<=d;d-=a.grid.millisPerLine){var P,D,u=r(d);(!a.scrollBackwards&&u<O||a.scrollBackwards&&O<u)&&(P=new Date(d),P=a.timestampFormatter(P),D=o.measureText(P).width,O=a.scrollBackwards?u+D+2:u-D-2,o.fillStyle=a.labels.fillStyle,a.scrollBackwards?o.fillText(P,u,s.height-2):o.fillText(P,u-D,s.height-2))}o.restore()}},r.timeFormatter=function(e){function t(e){return(e<10?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},i.TimeSeries=n,i.SmoothieChart=r},{}],363:[function(e,t,i){function n(r){"use strict";var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function l(e,t){var i=e[0],n=e[1],r=e[2],o=e[3],n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[0]-680876936|0)<<7|i>>>25)+n|0)&n|~i&r)+t[1]-389564586|0)<<12|o>>>20)+i|0)&i|~o&n)+t[2]+606105819|0)<<17|r>>>15)+o|0)&o|~r&i)+t[3]-1044525330|0)<<22|n>>>10)+r|0;n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[4]-176418897|0)<<7|i>>>25)+n|0)&n|~i&r)+t[5]+1200080426|0)<<12|o>>>20)+i|0)&i|~o&n)+t[6]-1473231341|0)<<17|r>>>15)+o|0)&o|~r&i)+t[7]-45705983|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[8]+1770035416|0)<<7|i>>>25)+n|0)&n|~i&r)+t[9]-1958414417|0)<<12|o>>>20)+i|0)&i|~o&n)+t[10]-42063|0)<<17|r>>>15)+o|0)&o|~r&i)+t[11]-1990404162|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[12]+1804603682|0)<<7|i>>>25)+n|0)&n|~i&r)+t[13]-40341101|0)<<12|o>>>20)+i|0)&i|~o&n)+t[14]-1502002290|0)<<17|r>>>15)+o|0)&o|~r&i)+t[15]+1236535329|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[1]-165796510|0)<<5|i>>>27)+n|0)&r|n&~r)+t[6]-1069501632|0)<<9|o>>>23)+i|0)&n|i&~n)+t[11]+643717713|0)<<14|r>>>18)+o|0)&i|o&~i)+t[0]-373897302|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[5]-701558691|0)<<5|i>>>27)+n|0)&r|n&~r)+t[10]+38016083|0)<<9|o>>>23)+i|0)&n|i&~n)+t[15]-660478335|0)<<14|r>>>18)+o|0)&i|o&~i)+t[4]-405537848|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[9]+568446438|0)<<5|i>>>27)+n|0)&r|n&~r)+t[14]-1019803690|0)<<9|o>>>23)+i|0)&n|i&~n)+t[3]-187363961|0)<<14|r>>>18)+o|0)&i|o&~i)+t[8]+1163531501|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[13]-1444681467|0)<<5|i>>>27)+n|0)&r|n&~r)+t[2]-51403784|0)<<9|o>>>23)+i|0)&n|i&~n)+t[7]+1735328473|0)<<14|r>>>18)+o|0)&i|o&~i)+t[12]-1926607734|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[5]-378558|0)<<4|i>>>28)+n|0)^n^r)+t[8]-2022574463|0)<<11|o>>>21)+i|0)^i^n)+t[11]+1839030562|0)<<16|r>>>16)+o|0)^o^i)+t[14]-35309556|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[1]-1530992060|0)<<4|i>>>28)+n|0)^n^r)+t[4]+1272893353|0)<<11|o>>>21)+i|0)^i^n)+t[7]-155497632|0)<<16|r>>>16)+o|0)^o^i)+t[10]-1094730640|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[13]+681279174|0)<<4|i>>>28)+n|0)^n^r)+t[0]-358537222|0)<<11|o>>>21)+i|0)^i^n)+t[3]-722521979|0)<<16|r>>>16)+o|0)^o^i)+t[6]+76029189|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[9]-640364487|0)<<4|i>>>28)+n|0)^n^r)+t[12]-421815835|0)<<11|o>>>21)+i|0)^i^n)+t[15]+530742520|0)<<16|r>>>16)+o|0)^o^i)+t[2]-995338651|0)<<23|n>>>9)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[0]-198630844|0)<<6|i>>>26)+n|0)|~r))+t[7]+1126891415|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[14]-1416354905|0)<<15|r>>>17)+o|0)|~i))+t[5]-57434055|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[12]+1700485571|0)<<6|i>>>26)+n|0)|~r))+t[3]-1894986606|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[10]-1051523|0)<<15|r>>>17)+o|0)|~i))+t[1]-2054922799|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[8]+1873313359|0)<<6|i>>>26)+n|0)|~r))+t[15]-30611744|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[6]-1560198380|0)<<15|r>>>17)+o|0)|~i))+t[13]+1309151649|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[4]-145523070|0)<<6|i>>>26)+n|0)|~r))+t[11]-1120210379|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[2]+718787259|0)<<15|r>>>17)+o|0)|~i))+t[9]-343485551|0)<<21|n>>>11)+r|0,e[0]=i+e[0]|0,e[1]=n+e[1]|0,e[2]=r+e[2]|0,e[3]=o+e[3]|0}function c(e){for(var t=[],i=0;i<64;i+=4)t[i>>2]=e.charCodeAt(i)+(e.charCodeAt(i+1)<<8)+(e.charCodeAt(i+2)<<16)+(e.charCodeAt(i+3)<<24);return t}function d(e){for(var t=[],i=0;i<64;i+=4)t[i>>2]=e[i]+(e[i+1]<<8)+(e[i+2]<<16)+(e[i+3]<<24);return t}function i(e){for(var t,i,n,r,o=e.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=o;s+=64)l(a,c(e.substring(s-64,s)));for(t=(e=e.substring(s-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<t;s+=1)i[s>>2]|=e.charCodeAt(s)<<(s%4<<3);if(i[s>>2]|=128<<(s%4<<3),55<s)for(l(a,i),s=0;s<16;s+=1)i[s]=0;return r=(r=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),r=parseInt(r[1],16)||0,i[14]=n,i[15]=r,l(a,i),a}function a(e){for(var t=0;t<e.length;t+=1)e[t]=function(e){for(var t="",i=0;i<4;i+=1)t+=n[e>>8*i+4&15]+n[e>>8*i&15];return t}(e[t]);return e.join("")}function o(e){return e=/[\u0080-\uFFFF]/.test(e)?unescape(encodeURIComponent(e)):e}function s(e){for(var t=[],i=e.length,n=0;n<i-1;n+=2)t.push(parseInt(e.substr(n,2),16));return String.fromCharCode.apply(String,t)}function u(){this.reset()}return a(i("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var i=this.byteLength,e=p(e,i),n=i;return(n=t!==r?p(t,i):n)<e?new ArrayBuffer(0):(t=n-e,i=new ArrayBuffer(t),n=new Uint8Array(i),e=new Uint8Array(this,e,t),n.set(e),i)}),u.prototype.append=function(e){return this.appendBinary(o(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;for(var t=this._buff.length,i=64;i<=t;i+=64)l(this._hash,c(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},u.prototype.end=function(e){for(var t,i=this._buff,n=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)r[o>>2]|=i.charCodeAt(o)<<(o%4<<3);return this._finish(r,n),t=a(this._hash),e&&(t=s(t)),this.reset(),t},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var i,n=t;if(e[n>>2]|=128<<(n%4<<3),55<n)for(l(this._hash,e),n=0;n<16;n+=1)e[n]=0;t=(t=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(t[2],16),t=parseInt(t[1],16)||0,e[14]=i,e[15]=t,l(this._hash,e)},u.hash=function(e,t){return u.hashBinary(o(e),t)},u.hashBinary=function(e,t){e=a(i(e));return t?s(e):e},(u.ArrayBuffer=function(){this.reset()}).prototype.append=function(e){i=this._buff.buffer,n=e,(r=new Uint8Array(i.byteLength+n.byteLength)).set(new Uint8Array(i)),r.set(new Uint8Array(n),i.byteLength);var t,i,n,r,o=r,a=o.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)l(this._hash,d(o.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(o.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){for(var t,i=this._buff,n=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<n;o+=1)r[o>>2]|=i[o]<<(o%4<<3);return this._finish(r,n),t=a(this._hash),e&&(t=s(t)),this.reset(),t},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r+=1)n[r]=e.charCodeAt(r);return n}(e.buff),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){e=a(function(e){for(var t,i,n,r,o=e.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=o;s+=64)l(a,d(e.subarray(s-64,s)));for(t=(e=s-64<o?e.subarray(s-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<t;s+=1)i[s>>2]|=e[s]<<(s%4<<3);if(i[s>>2]|=128<<(s%4<<3),55<s)for(l(a,i),s=0;s<16;s+=1)i[s]=0;return r=(r=8*o).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),r=parseInt(r[1],16)||0,i[14]=n,i[15]=r,l(a,i),a}(new Uint8Array(e)));return t?s(e):e},u;function p(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}}var r;if("object"==typeof i)t.exports=n();else if("function"==typeof define&&define.amd)define(n);else{try{r=window}catch(n){r=self}r.SparkMD5=n()}},{}],364:[function(e,t,i){t.exports=n;var d=e("events").EventEmitter;function n(){d.call(this)}e("inherits")(n,d),n.Readable=e("readable-stream/readable.js"),n.Writable=e("readable-stream/writable.js"),n.Duplex=e("readable-stream/duplex.js"),n.Transform=e("readable-stream/transform.js"),n.PassThrough=e("readable-stream/passthrough.js"),(n.Stream=n).prototype.pipe=function(t,e){var i=this;function n(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function r(){i.readable&&i.resume&&i.resume()}i.on("data",n),t.on("drain",r),t._isStdio||e&&!1===e.end||(i.on("end",a),i.on("close",s));var o=!1;function a(){o||(o=!0,t.end())}function s(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function l(e){if(c(),0===d.listenerCount(this,"error"))throw e}function c(){i.removeListener("data",n),t.removeListener("drain",r),i.removeListener("end",a),i.removeListener("close",s),i.removeListener("error",l),t.removeListener("error",l),i.removeListener("end",c),i.removeListener("close",c),t.removeListener("close",c)}return i.on("error",l),t.on("error",l),i.on("end",c),i.on("close",c),t.on("close",c),t.emit("pipe",i),t}},{events:180,inherits:186,"readable-stream/duplex.js":321,"readable-stream/passthrough.js":332,"readable-stream/readable.js":333,"readable-stream/transform.js":334,"readable-stream/writable.js":335}],365:[function(e,t,i){"use strict";var n=e("safe-buffer").Buffer,r=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"==typeof t||n.isEncoding!==r&&r(e))return t||e;throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=d,this.end=u,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t,i=this.lastTotal-this.lastNeed,n=(t=this,128!=(192&(n=e)[0])?(t.lastNeed=0,"�"):1<t.lastNeed&&1<n.length?128!=(192&n[1])?(t.lastNeed=1,"�"):2<t.lastNeed&&2<n.length&&128!=(192&n[2])?(t.lastNeed=2,"�"):void 0:void 0);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,i,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,i,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);t=e.toString("utf16le",t);if(t){var i=t.charCodeAt(t.length-1);if(55296<=i&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],t.slice(0,-1)}return t}function c(e){var t,e=e&&e.length?this.write(e):"";return this.lastNeed?(t=this.lastTotal-this.lastNeed,e+this.lastChar.toString("utf16le",0,t)):e}function d(e,t){var i=(e.length-t)%3;return 0==i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1==i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function u(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}(i.StringDecoder=o).prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},o.prototype.end=function(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e},o.prototype.text=function(e,t){i=this,o=t;var i,n,r,o=(r=(a=e).length-1)<o?0:0<=(n=s(a[r]))?(0<n&&(i.lastNeed=n-1),n):--r<o||-2===n?0:0<=(n=s(a[r]))?(0<n&&(i.lastNeed=n-2),n):!(--r<o||-2===n)&&0<=(n=s(a[r]))?(0<n&&(2===n?n=0:i.lastNeed=n-3),n):0;if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=o;var a=e.length-(o-this.lastNeed);return e.copy(this.lastChar,0,a),e.toString("utf8",t,a)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":344}],366:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var o=n(e("ltgt")),r=n(e("events")),a=n(e("level-codec")),s=n(e("readable-stream")),e=n(e("inherits"));function l(){Error.call(this)}e(l,Error),l.prototype.name="NotFoundError";function p(r,o,i,n){var a=new c;function s(e){var t,i={};if(n)for(t in n)void 0!==n[t]&&(i[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(i[t]=e[t]);return i}return a.sublevels={},a.options=n,a.version="6.5.4",a.methods={},o=o||[],a.put=function(t,i,e,n){"function"==typeof e&&(n=e,e={}),r.apply([{key:t,value:i,prefix:o.slice(),type:"put"}],s(e),function(e){if(e)return n(e);a.emit("put",t,i),n(null)})},a.prefix=function(){return o.slice()},a.batch=function(t,e,i){"function"==typeof e&&(i=e,e={}),t=t.map(function(e){return{key:e.key,value:e.value,prefix:e.prefix||o,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}}),r.apply(t,s(e),function(e){if(e)return i(e);a.emit("batch",t),i(null)})},a.get=function(e,t,i){"function"==typeof t&&(i=t,t={}),r.get(e,o,s(t),function(e,t){e?i(d):i(null,t)})},a.sublevel=function(e,t){return a.sublevels[e]=a.sublevels[e]||p(r,o.concat(e),i,s(t))},a.readStream=a.createReadStream=function(e){(e=s(e)).prefix=o;var t=r.iterator(e);return(e=i(e,r.createDecoder(e))).setIterator(t),e},a.close=function(e){r.close(e)},a.isOpen=r.isOpen,a.isClosed=r.isClosed,a}var c=r.EventEmitter,d=new l,u=s.Readable;function h(e,t){if(!(this instanceof h))return new h(e,t);u.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}e(h,u),h.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end(function(){}):this._waiting?(this._waiting=!1,this._read()):this},h.prototype._read=function(){var n=this;if(!n._destroyed)return n._iterator?void n._iterator.next(function(e,t,i){if(e||void 0===t&&void 0===i)return e||n._destroyed||n.push(null),n._cleanup(e);i=n._makeData(t,i),n._destroyed||n.push(i)}):this._waiting=!0},h.prototype._cleanup=function(e){var t;this._destroyed||(this._destroyed=!0,t=this,e&&"iterator has ended"!==e.message&&t.emit("error",e),t._iterator?t._iterator.end(function(){t._iterator=null,t.emit("close")}):t.emit("close"))},h.prototype.destroy=function(){this._cleanup()};var f={encode:function(e){return"ÿ"+e[0]+"ÿ"+e[1]},decode:function(e){var e=e.toString(),t=e.indexOf("ÿ",1);return[e.substring(1,t),e.substring(t+1)]},lowerBound:"\0",upperBound:"ÿ"},m=new a;t.exports=function(e){return p((r=f,u=m,(d=e).open(function(){}),{apply:function(e,t,i){t=t||{};for(var n,r,o=[],a=-1,s=e.length;++a<s;){var l=e[a];(r=(n=l).prefix)&&r.options&&(n.keyEncoding=n.keyEncoding||r.options.keyEncoding,n.valueEncoding=n.valueEncoding||r.options.valueEncoding),l.prefix="function"==typeof(n=l.prefix).prefix?n.prefix():n,o.push({key:c(l.prefix,l.key,t,l),value:"del"!==l.type&&u.encodeValue(l.value,t,l),type:l.type})}d.db.batch(o,t,i)},get:function(e,t,i,n){return i.asBuffer=u.valueAsBuffer(i),d.db.get(c(t,e,i),i,function(e,t){e?n(e):n(null,u.decodeValue(t,i))})},createDecoder:function(i){return function(e,t){return{key:u.decodeKey(r.decode(e)[1],i),value:u.decodeValue(t,i)}}},isClosed:function(){return d.isClosed()},close:function(e){return d.close(e)},iterator:function(e){var t,i=function(e){var t,i={};for(t in e)i[t]=e[t];return i}(e||{}),n=e.prefix||[];return o.toLtgt(e,i,function(e){return c(n,e,i,{})},r.lowerBound,r.upperBound),i.prefix=null,i.keyAsBuffer=i.valueAsBuffer=!1,"number"!=typeof i.limit&&(i.limit=-1),i.keyAsBuffer=r.buffer,i.valueAsBuffer=u.valueAsBuffer(i),t=d.db.iterator(i),{next:function(e){return t.next(e)},end:function(e){t.end(e)}}}}),[],h,e.options);function c(e,t,i,n){return r.encode([e,u.encodeKey(t,i,n)])}var d,r,u}},{events:180,inherits:186,"level-codec":190,ltgt:229,"readable-stream":373}],367:[function(e,t,i){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],368:[function(u,p,e){!function(d){!function(){p.exports=r;var e=Object.keys||function(e){var t,i=[];for(t in e)i.push(t);return i},t=u("core-util-is"),i=(t.inherits=u("inherits"),u("./_stream_readable")),n=u("./_stream_writable");function r(e){if(!(this instanceof r))return new r(e);i.call(this,e),n.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",o)}function o(){this.allowHalfOpen||this._writableState.ended||d.nextTick(this.end.bind(this))}t.inherits(r,i);for(var a,s=e(n.prototype),l=0,c=s.length;l<c;l++)a=s[l],r.prototype[a]||(r.prototype[a]=n.prototype[a])}.call(this)}.call(this,u("_process"))},{"./_stream_readable":370,"./_stream_writable":372,_process:270,"core-util-is":155,inherits:186}],369:[function(e,t,i){t.exports=r;var n=e("./_stream_transform"),t=e("core-util-is");function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}t.inherits=e("inherits"),t.inherits(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":371,"core-util-is":155,inherits:186}],370:[function(y,w,e){!function(v){!function(){w.exports=i;var h=y("isarray"),u=y("buffer").Buffer,f=(i.ReadableState=t,y("events").EventEmitter);f.listenerCount||(f.listenerCount=function(e,t){return e.listeners(t).length});var n,r=y("stream"),e=y("core-util-is");function t(e,t){var i=(e=e||{}).highWaterMark;this.highWaterMark=i||0===i?i:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(n=n||y("string_decoder/").StringDecoder,this.decoder=new n(e.encoding),this.encoding=e.encoding)}function i(e){if(!(this instanceof i))return new i(e);this._readableState=new t(e),this.readable=!0,r.call(this)}function o(e,t,i,n,r){l=t,d=i,c=null;var o,a,s,l,c,d=c=u.isBuffer(d)||"string"==typeof d||null==d||l.objectMode?c:new TypeError("Invalid non-string/buffer chunk");return d?e.emit("error",d):null==i?(t.reading=!1,t.ended||(l=e,(c=t).decoder&&!c.ended&&(d=c.decoder.end())&&d.length&&(c.buffer.push(d),c.length+=c.objectMode?1:d.length),c.ended=!0,(0<c.length?p:b)(l))):t.objectMode||i&&0<i.length?t.ended&&!r?(o=new Error("stream.push() after EOF"),e.emit("error",o)):t.endEmitted&&r?(o=new Error("stream.unshift() after end event"),e.emit("error",o)):(!t.decoder||r||n||(i=t.decoder.write(i)),t.length+=t.objectMode?1:i.length,r?t.buffer.unshift(i):(t.reading=!1,t.buffer.push(i)),t.needReadable&&p(e),a=e,(s=t).readingMore||(s.readingMore=!0,v.nextTick(function(){for(var e=a,t=s,i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}))):r||(t.reading=!1),!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}e.inherits=y("inherits"),e.inherits(i,r),i.prototype.push=function(e,t){var i=this._readableState;return"string"!=typeof e||i.objectMode||(t=t||i.defaultEncoding)!==i.encoding&&(e=new u(e,t),t=""),o(this,i,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.setEncoding=function(e){n=n||y("string_decoder/").StringDecoder,this._readableState.decoder=new n(e),this._readableState.encoding=e};function a(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?(t.flowing&&t.buffer.length?t.buffer[0]:t).length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(8388608<=e)e=8388608;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function p(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?v.nextTick(function(){s(e)}):s(e))}function s(e){e.emit("readable")}function m(e){var n,r=e._readableState;function t(e,t,i){!1===e.write(n)&&r.awaitDrain++}for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes):d(r.pipes,t),e.emit("data",n),0<r.awaitDrain)return;if(0===r.pipesCount)return r.flowing=!1,0<f.listenerCount(e,"data")&&l(e);r.ranOut=!0}function g(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function l(t,e){if(t._readableState.flowing)throw new Error("Cannot switch to old mode now.");var i=e||!1,n=!1;t.readable=!0,t.pipe=r.prototype.pipe,t.on=t.addListener=r.prototype.on,t.on("readable",function(){var e;for(n=!0;!i&&null!==(e=t.read());)t.emit("data",e);null===e&&(n=!1,t._readableState.needReadable=!0)}),t.pause=function(){i=!0,this.emit("pause")},t.resume=function(){i=!1,n?v.nextTick(function(){t.emit("readable")}):this.read(0),this.emit("resume")},t.emit("readable")}function c(e,t){var i=t.buffer,n=t.length,r=!!t.decoder,t=!!t.objectMode;if(0===i.length)return null;if(0===n)o=null;else if(t)o=i.shift();else if(!e||n<=e)o=r?i.join(""):u.concat(i,n),i.length=0;else if(e<i[0].length)o=(c=i[0]).slice(0,e),i[0]=c.slice(e);else if(e===i[0].length)o=i.shift();else for(var o=r?"":new u(e),a=0,s=0,l=i.length;s<l&&a<e;s++){var c=i[0],d=Math.min(e-a,c.length);r?o+=c.slice(0,d):c.copy(o,a,0,d),d<c.length?i[0]=c.slice(d):i.shift(),a+=d}return o}function b(e){var t=e._readableState;if(0<t.length)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,v.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function d(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)}i.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var i,n,r=e;return("number"!=typeof e||0<e)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended)?(p(this),null):(0===(e=a(e,t))&&t.ended?(i=null,0<t.length&&t.decoder&&(i=c(e,t),t.length-=i.length),0===t.length&&b(this)):(n=t.needReadable,t.length-e<=t.highWaterMark&&(n=!0),(n=t.ended||t.reading?!1:n)&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),null===(i=0<(e=n&&!t.reading?a(r,t):e)?c(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&b(this)),i)},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(t,e){var i=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t)}n.pipesCount+=1;e=e&&!1===e.end||t===v.stdout||t===v.stderr?l:o;function r(e){e===i&&l()}function o(){t.end()}n.endEmitted?v.nextTick(e):i.once("end",e),t.on("unpipe",r);a=i;var a,s=function(){var e=a._readableState;e.awaitDrain--,0===e.awaitDrain&&m(a)};function l(){t.removeListener("close",d),t.removeListener("finish",u),t.removeListener("drain",s),t.removeListener("error",c),t.removeListener("unpipe",r),i.removeListener("end",o),i.removeListener("end",l),t._writableState&&!t._writableState.needDrain||s()}function c(e){p(),t.removeListener("error",c),0===f.listenerCount(t,"error")&&t.emit("error",e)}function d(){t.removeListener("finish",u),p()}function u(){t.removeListener("close",d),p()}function p(){i.unpipe(t)}return t.on("drain",s),t._events&&t._events.error?h(t._events.error)?t._events.error.unshift(c):t._events.error=[c,t._events.error]:t.on("error",c),t.once("close",d),t.once("finish",u),t.emit("pipe",i),n.flowing||(this.on("readable",g),n.flowing=!0,v.nextTick(function(){m(i)})),t},i.prototype.unpipe=function(e){var t=this._readableState;if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1,e&&e.emit("unpipe",this));else if(e)-1!==(r=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}(t.pipes,e))&&(t.pipes.splice(r,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this));else{var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1;for(var r=0;r<n;r++)i[r].emit("unpipe",this)}return this},i.prototype.addListener=i.prototype.on=function(e,t){t=r.prototype.on.call(this,e,t);return"data"!==e||this._readableState.flowing||l(this),"readable"===e&&this.readable&&!(e=this._readableState).readableListening&&(e.readableListening=!0,e.emittedReadable=!1,e.needReadable=!0,e.reading?e.length&&p(this):this.read(0)),t},i.prototype.resume=function(){l(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){l(this,!0),this.emit("pause")},i.prototype.wrap=function(t){var e,i=this._readableState,n=!1,r=this;for(e in t.on("end",function(){var e;i.decoder&&!i.ended&&(e=i.decoder.end())&&e.length&&r.push(e),r.push(null)}),t.on("data",function(e){i.decoder&&(e=i.decoder.write(e)),i.objectMode&&null==e||(i.objectMode||e&&e.length)&&!r.push(e)&&(n=!0,t.pause())}),t)"function"==typeof t[e]&&void 0===this[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));return d(["error","close","destroy","pause","resume"],function(e){t.on(e,r.emit.bind(r,e))}),r._read=function(e){n&&(n=!1,t.resume())},r},i._fromList=c}.call(this)}.call(this,y("_process"))},{_process:270,buffer:153,"core-util-is":155,events:180,inherits:186,isarray:367,stream:364,"string_decoder/":374}],371:[function(e,t,i){t.exports=o;var n=e("./_stream_duplex"),t=e("core-util-is");function r(e,o){this.afterTransform=function(e,t){var i=o,n=i._transformState,r=(n.transforming=!1,n.writecb);if(!r)return i.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,(n.writecb=null)!=t&&i.push(t),r&&r(e),(n=i._readableState).reading=!1,(n.needReadable||n.length<n.highWaterMark)&&i._read(n.highWaterMark)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState=new r(0,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){a(t,e)}):a(t)})}function a(e,t){if(t)return e.emit("error",t);var t=e._writableState,i=(e._readableState,e._transformState);if(t.length)throw new Error("calling transform done when ws.length != 0");if(i.transforming)throw new Error("calling transform done when still transforming");e.push(null)}t.inherits=e("inherits"),t.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,i){throw new Error("not implemented")},o.prototype._write=function(e,t,i){var n=this._transformState;n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming&&(i=this._readableState,n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":368,"core-util-is":155,inherits:186}],372:[function(o,t,e){!function(y){!function(){t.exports=r;var h=o("buffer").Buffer,e=(r.WritableState=n,o("core-util-is")),i=(e.inherits=o("inherits"),o("stream"));function f(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function n(e,m){var t=(e=e||{}).highWaterMark,t=(this.highWaterMark=t||0===t?t:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,(this.finished=!1)===e.decodeStrings);this.decodeStrings=!t,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,i,n,r=m,o=r._writableState,a=o.sync,s=o.writecb;if((n=o).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,e)n=r,t=e,i=s,a?y.nextTick(function(){i(t)}):i(t),n._writableState.errorEmitted=!0,n.emit("error",t);else{var l=v(0,o);if(!l&&!o.bufferProcessing&&o.buffer.length){var c=r;var d=o;d.bufferProcessing=!0;for(var u=0;u<d.buffer.length;u++){var p=d.buffer[u],h=p.chunk,f=p.encoding,p=p.callback;if(g(c,d,d.objectMode?1:h.length,h,f,p),d.writing){u++;break}}d.bufferProcessing=!1,u<d.buffer.length?d.buffer=d.buffer.slice(u):d.buffer.length=0}a?y.nextTick(function(){b(r,o,l,s)}):b(r,o,l,s)}},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function r(e){var t=o("./_stream_duplex");if(!(this instanceof r||this instanceof t))return new r(e);this._writableState=new n(e,this),this.writable=!0,i.call(this)}function g(e,t,i,n,r,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,r,t.onwrite),t.sync=!1}function b(e,t,i,n){var r,o;i||(r=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,r.emit("drain"))),n(),i&&a(e,t)}function v(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function a(e,t){var i=v(0,t);i&&(t.finished=!0,e.emit("finish"))}e.inherits(r,i),r.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},r.prototype.write=function(e,t,i){var n,r,o,a,s,l,c,d,u=this._writableState,p=!1;return"function"==typeof t&&(i=t,t=null),t=h.isBuffer(e)?"buffer":t||u.defaultEncoding,"function"!=typeof i&&(i=function(){}),u.ended?(l=this,c=i,d=new Error("write after end"),l.emit("error",d),y.nextTick(function(){c(d)})):(l=this,n=u,r=e,o=i,s=!0,h.isBuffer(r)||"string"==typeof r||null==r||n.objectMode||(a=new TypeError("Invalid non-string/buffer chunk"),l.emit("error",a),y.nextTick(function(){o(a)}),s=!1),s&&(r=this,n=i,i=s=e,t=e=t,s=i=(u=u).objectMode||!1===u.decodeStrings||"string"!=typeof i?i:new h(i,t),h.isBuffer(s)&&(e="buffer"),t=u.objectMode?1:s.length,u.length+=t,(i=u.length<u.highWaterMark)||(u.needDrain=!0),u.writing?u.buffer.push(new f(s,e,n)):g(r,u,t,s,e,n),p=i)),p},r.prototype._write=function(e,t,i){i(new Error("not implemented"))},r.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.ending||n.finished||(e=this,t=i,(i=n).ending=!0,a(e,i),t&&(i.finished?y.nextTick(t):e.once("finish",t)),i.ended=!0)}}.call(this)}.call(this,o("_process"))},{"./_stream_duplex":368,_process:270,buffer:153,"core-util-is":155,inherits:186,stream:364}],373:[function(e,t,i){var n=e("stream");(i=t.exports=e("./lib/_stream_readable.js")).Stream=n,(i.Readable=i).Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":368,"./lib/_stream_passthrough.js":369,"./lib/_stream_readable.js":370,"./lib/_stream_transform.js":371,"./lib/_stream_writable.js":372,stream:364}],374:[function(e,t,i){var n=e("buffer").Buffer,r=n.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},e=i.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!r(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=o)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function o(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}e.prototype.write=function(e){for(var t="";this.charLength;){var i=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";if(e=e.slice(i,e.length),!(55296<=(n=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&n<=56319)){if((this.charReceived=this.charLength=0)===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n,r,o=e.length;return this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,o),o-=this.charReceived),o=(t+=e.toString(this.encoding,0,o)).length-1,55296<=(n=t.charCodeAt(o))&&n<=56319?(r=this.surrogateSize,this.charLength+=r,this.charReceived+=r,this.charBuffer.copy(this.charBuffer,r,0,r),e.copy(this.charBuffer,0,0,r),t.substring(0,o)):t},e.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=t},e.prototype.end=function(e){var t,i,n="";return e&&e.length&&(n=this.write(e)),this.charReceived&&(e=this.charReceived,t=this.charBuffer,i=this.encoding,n+=t.slice(0,e).toString(i)),n}},{buffer:153}],375:[function(n,r,o){!function(i){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var e=n("./ponyfill.js"),e=e&&e.__esModule?e:{default:e},t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:void 0!==r?r:Function("return this")(),e=(0,e.default)(t);o.default=e}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":376}],376:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){var t,e=e.Symbol;return"function"==typeof e?e.observable?t=e.observable:(t=e("observable"),e.observable=t):t="@@observable",t}},{}],377:[function(l,e,c){!function(i,s){!function(){var n=l("process/browser.js").nextTick,e=Function.prototype.apply,r=Array.prototype.slice,o={},a=0;function t(e,t){this._id=e,this._clearFn=t}c.setTimeout=function(){return new t(e.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new t(e.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},t.prototype.unref=t.prototype.ref=function(){},t.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},c.setImmediate="function"==typeof i?i:function(e){var t=a++,i=!(arguments.length<2)&&r.call(arguments,1);return o[t]=!0,n(function(){o[t]&&(i?e.apply(null,i):e.call(null),c.clearImmediate(t))}),t},c.clearImmediate="function"==typeof s?s:function(e){delete o[e]}}.call(this)}.call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":270,timers:377}],378:[function(e,t,i){!function(i){!function(){function n(e){try{if(!i.localStorage)return}catch(e){return}var t=i.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){var i;return n("noDeprecation")?e:(i=!1,function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)})}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],379:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],380:[function(e,t,i){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],381:[function(p,e,T){!function(d,u){!function(){var s=/%[sdj%]/g;T.format=function(e){if(!w(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(l(arguments[i]));return t.join(" ")}for(var i=1,n=arguments,r=n.length,o=String(e).replace(s,function(e){if("%%"===e)return"%";if(r<=i)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}}),a=n[i];i<r;a=n[++i])v(a)||!c(a)?o+=" "+a:o+=" "+l(a);return o},T.deprecate=function(e,t){var i;return k(u.process)?function(){return T.deprecate(e,t).apply(this,arguments)}:!0===d.noDeprecation?e:(i=!1,function(){if(!i){if(d.throwDeprecation)throw new Error(t);d.traceDeprecation?console.trace(t):console.error(t),i=!0}return e.apply(this,arguments)})};var e,n={};function l(e,t){var i={seen:[],stylize:o};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),b(t)?i.showHidden=t:t&&T._extend(i,t),k(i.showHidden)&&(i.showHidden=!1),k(i.depth)&&(i.depth=2),k(i.colors)&&(i.colors=!1),k(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=r),h(i,e,i.depth)}function r(e,t){t=l.styles[t];return t?"["+l.colors[t][0]+"m"+e+"["+l.colors[t][1]+"m":e}function o(e,t){return e}function h(t,i,n){if(t.customInspect&&i&&_(i.inspect)&&i.inspect!==T.inspect&&(!i.constructor||i.constructor.prototype!==i))return w(e=i.inspect(n,t))?e:h(t,e,n);e=t;var e,r=k(a=i)?e.stylize("undefined","undefined"):w(a)?(r="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(r,"string")):y(a)?e.stylize(""+a,"number"):b(a)?e.stylize(""+a,"boolean"):v(a)?e.stylize("null","null"):void 0;if(r)return r;var o,a=Object.keys(i),s=(o={},a.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(a=Object.getOwnPropertyNames(i)),C(i)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return f(i);if(0===a.length){if(_(i))return d=i.name?": "+i.name:"",t.stylize("[Function"+d+"]","special");if(x(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(E(i))return t.stylize(Date.prototype.toString.call(i),"date");if(C(i))return f(i)}var l,c,d="",u=!1,p=["{","}"];return g(i)&&(u=!0,p=["[","]"]),_(i)&&(d=" [Function"+(i.name?": "+i.name:"")+"]"),x(i)&&(d=" "+RegExp.prototype.toString.call(i)),E(i)&&(d=" "+Date.prototype.toUTCString.call(i)),C(i)&&(d=" "+f(i)),0!==a.length||u&&0!=i.length?n<0?x(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),a=u?function(t,i,n,r,e){for(var o=[],a=0,s=i.length;a<s;++a)S(i,String(a))?o.push(m(t,i,n,r,String(a),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(m(t,i,n,r,e,!0))}),o}(t,i,n,s,a):a.map(function(e){return m(t,i,n,s,e,u)}),t.seen.pop(),l=d,c=p,60<(a=a).reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===l?"":l+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+l+" "+a.join(", ")+" "+c[1]):p[0]+d+p[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,i,n,r,o){var a,s;if((t=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(s=e.stylize("[Setter]","special")),S(n,r)||(a="["+r+"]"),s||(e.seen.indexOf(t.value)<0?-1<(s=v(i)?h(e,t.value,null):h(e,t.value,i-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),k(a)){if(o&&r.match(/^\d+$/))return s;a=(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function g(e){return Array.isArray(e)}function b(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return"number"==typeof e}function w(e){return"string"==typeof e}function k(e){return void 0===e}function x(e){return c(e)&&"[object RegExp]"===t(e)}function c(e){return"object"==typeof e&&null!==e}function E(e){return c(e)&&"[object Date]"===t(e)}function C(e){return c(e)&&("[object Error]"===t(e)||e instanceof Error)}function _(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function i(e){return e<10?"0"+e.toString(10):e.toString(10)}T.debuglog=function(t){var i;return k(e)&&(e=d.env.NODE_DEBUG||""),t=t.toUpperCase(),n[t]||(new RegExp("\\b"+t+"\\b","i").test(e)?(i=d.pid,n[t]=function(){var e=T.format.apply(T,arguments);console.error("%s %d: %s",t,i,e)}):n[t]=function(){}),n[t]},(T.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},T.isArray=g,T.isBoolean=b,T.isNull=v,T.isNullOrUndefined=function(e){return null==e},T.isNumber=y,T.isString=w,T.isSymbol=function(e){return"symbol"==typeof e},T.isUndefined=k,T.isRegExp=x,T.isObject=c,T.isDate=E,T.isError=C,T.isFunction=_,T.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},T.isBuffer=p("./support/isBuffer");var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}T.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[i(e.getHours()),i(e.getMinutes()),i(e.getSeconds())].join(":"),[e.getDate(),a[e.getMonth()],t].join(" ")),T.format.apply(T,arguments))},T.inherits=p("inherits"),T._extend=function(e,t){if(t&&c(t))for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}.call(this)}.call(this,p("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":380,_process:270,inherits:379}],382:[function(e,t,i){"use strict";function p(e,t,i){var n=i[i.length-1],i=(e===n.element&&(i.pop(),n=i[i.length-1]),n.element),n=n.index;Array.isArray(i)?i.push(e):n===t.length-2?i[t.pop()]=e:t.push(e)}i.stringify=function(e){var t=[];t.push({obj:e});for(var i,n,r,o,a,s,l,c,d="";n=t.pop();)if(i=n.obj,d+=n.prefix||"",n=n.val||"")d+=n;else if("object"!=typeof i)d+=void 0===i?null:JSON.stringify(i);else if(null===i)d+="null";else if(Array.isArray(i)){for(t.push({val:"]"}),r=i.length-1;0<=r;r--)t.push({obj:i[r],prefix:0===r?"":","});t.push({val:"["})}else{for(a in o=[],i)i.hasOwnProperty(a)&&o.push(a);for(t.push({val:"}"}),r=o.length-1;0<=r;r--)l=i[s=o[r]],c=0<r?",":"",c+=JSON.stringify(s)+":",t.push({obj:l,prefix:c});t.push({val:"{"})}return d},i.parse=function(e){for(var t,i,n,r,o,a,s,l,c=[],d=[],u=0;;)if("}"!==(t=e[u++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":u+=3,p(null,c,d);break;case"t":u+=3,p(!0,c,d);break;case"f":u+=4,p(!1,c,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(i="",u--;;){if(n=e[u++],!/[\d\.\-e\+]/.test(n)){u--;break}i+=n}p(parseFloat(i),c,d);break;case'"':for(r="",o=void 0,a=0;'"'!==(s=e[u++])||"\\"===o&&a%2==1;)r+=s,"\\"===(o=s)?a++:a=0;p(JSON.parse('"'+r+'"'),c,d);break;case"[":l={element:[],index:c.length},c.push(l.element),d.push(l);break;case"{":l={element:{},index:c.length},c.push(l.element),d.push(l);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===c.length)return c.pop();p(c.pop(),c,d)}}},{}],383:[function(e,t,i){"use strict";t.exports=function(){}},{}],384:[function(e,t,i){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i,n=arguments[t];for(i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}]},{},[5]);