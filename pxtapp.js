var e=function(){"use strict";function T(e,t){postMessage({action:3,cbn:t,result:e})}function m(e){var t=[];return t[e-1]=void 0,t}function R(e,t){return n(e[0]+t[0],e[1]+t[1])}function a(e,t){return n=~~Math.max(Math.min(e[1]/r,2147483647),-2147483648)&~~Math.max(Math.min(t[1]/r,2147483647),-2147483648),e=B(e)&B(t),(t=e)<0&&(t+=r),[t,n*r];var n}function M(e,t){var n,i;return e[0]==t[0]&&e[1]==t[1]?0:(n=e[1]<0,i=t[1]<0,n&&!i||(n||!i)&&Z(e,t)[1]<0?-1:1)}function n(e,t){var n,i;for(e%=0x10000000000000000,t=(t%=0x10000000000000000)-(n=t%r)+(i=Math.floor(e/r)*r),e=e-i+n;e<0;)e+=r,t-=r;for(;4294967295<e;)e-=r,t+=r;for(t%=0x10000000000000000;0x7fffffff00000000<t;)t-=0x10000000000000000;for(;t<-0x8000000000000000;)t+=0x10000000000000000;return[e,t]}function G(e,t){return e[0]==t[0]&&e[1]==t[1]}function L(e){return 0<=e?[e,0]:[e+r,-r]}function B(e){return 2147483648<=e[0]?~~Math.max(Math.min(e[0]-r,2147483647),-2147483648):~~Math.max(Math.min(e[0],2147483647),-2147483648)}function i(e){return e<=30?1<<e:i(30)*i(e-30)}function o(e,t){var n;if(t&=63,G(e,Ue))return t?H:e;if(e[1]<0)throw Error("Neg");return t=i(t),n=e[1]*t%0x10000000000000000,0x8000000000000000<=(n+=t=(e=e[0]*t)-e%r)&&(n-=0x10000000000000000),[e-=t,n]}function E(e,t){t=i(t&=63);return n(Math.floor(e[0]/t),e[1]/t)}function Z(e,t){return n(e[0]-t[0],e[1]-t[1])}function C(e,t){return e.Mc=t,e.Lc=0,e.Yb=t.length,e}function d(e){return e.Lc>=e.Yb?-1:255&e.Mc[e.Lc++]}function S(e){return e.Mc=m(32),e.Yb=0,e}function u(e){var t=e.Mc;return t.length=e.Yb,t}function I(e,t){e.Mc[e.Yb++]=t<<24>>24}function P(e,t,n,i){U(t,n,e.Mc,e.Yb,i),e.Yb+=i}function U(e,t,n,i,r){for(var s=0;s<r;++s)n[i+s]=e[t+s]}function _(t,n,i,r,s){var a,o;if(M(r,A)<0)throw Error("invalid length "+r);t.Tb=r;var l=a=function(e){var t;for(e.v=m(4),e.a=[],e.d={},e.C=m(192),e.bb=m(12),e.hb=m(12),e.Ub=m(12),e.vc=m(12),e._=m(192),e.K=[],e.Sb=m(114),e.S=g({},4),e.$=xe({}),e.i=xe({}),e.A={},e.m=[],e.P=[],e.lb=[],e.nc=m(16),e.x=m(4),e.Q=m(4),e.Xb=[H],e.uc=[H],e.Kc=[0],e.fc=m(5),e.yc=m(128),e.vb=0,e.X=1,e.D=0,e.Hb=-1,e.mb=0,t=0;t<4096;++t)e.a[t]={};for(t=0;t<4;++t)e.K[t]=g({},6);return e}({}),c=l,u=1<<s.s;c.ab=u;for(var d,h=0;1<<h<u;++h);c.$b=2*h,l.n=s.f,c=l,s=s.m,d=c.X,c.X=s,c.b&&d!=c.X&&(c.wb=-1,c.b=null),l.eb=0,l.fb=3,l.Y=2,l.y=3,a.Gc=void 0===e.disableEndMark;var p=a,s=i;p.fc[0]=9*(5*p.Y+p.eb)+p.fb<<24>>24;for(var f=0;f<4;++f)p.fc[1+f]=p.ab>>8*f<<24>>24;for(P(s,p.fc,0,5),o=0;o<64;o+=8)I(i,255&B(E(r,o)));t.yb=(a.W=0,a.oc=n,a.pc=0,function(e){e.b||(d=4,e.X||(d=2),d=d,(h=i={}).qb=2<d,h.qb?(h.w=0,h.xb=4,h.R=66560):(h.w=2,h.xb=3,h.R=0),e.b=i);var t,n,i,r,s,a,o,l,c,u=e.A,d=e.eb,h=e.fb;if(null==u.V||u.u!=h||u.I!=d)for(u.I=d,u.qc=(1<<d)-1,u.u=h,n=1<<u.u+u.I,u.V=m(n),t=0;t<n;++t)u.V[t]=function(e){return e.tb=m(768),e}({});e.ab==e.wb&&e.Hb==e.n||(i=e.b,r=e.ab,s=4096,a=e.n,o=274,r<1073741567&&(i.Fc=16+(a>>1),c=a+o,o=256+~~(((s=r+s)+a+o)/2),(l=i).Bc=s,l._b=c,s=s+c+o,null!=l.c&&l.Kb==s||(l.c=null,l.Kb=s,l.c=m(l.Kb)),l.H=l.Kb-c,i.ob=a,o=r+1,i.p!=o&&(i.L=m(2*(i.p=o))),s=65536,i.qb&&(s=r-1,16777216<(s=(s=(s=(s=(s|=s>>1)|s>>2)|s>>4)|s>>8)>>1|65535)&&(s>>=1),i.Ec=s,++s,s+=i.R),s!=i.rc)&&(i.ub=m(i.rc=s)),e.wb=e.ab,e.Hb=e.n)}(a),a.d.Ab=i,function(e){var t=e;t.l=0;for(var n=t.J=0;n<4;++n)t.v[n]=0;(a=e.d).mc=H,a.xc=H,a.E=-1,a.Jb=1,a.Oc=0,v(e.C),v(e._),v(e.bb),v(e.hb),v(e.Ub),v(e.vc),v(e.Sb);for(var i=e.A,r=1<<i.u+i.I,s=0;s<r;++s)v(i.V[s].tb);for(var a,o=0;o<4;++o)v(e.K[o].G);ve(e.$,1<<e.Y),ve(e.i,1<<e.Y),v(e.S.G),e.N=0,e.jb=0,e.q=0,e.s=0}(a),de(a),ue(a),a.$.rb=a.n+1-2,ke(a.$,1<<a.Y),a.i.rb=a.n+1-2,ke(a.i,1<<a.Y),a.g=H,d=a,(c={}).cb=d,c.Z=null,c.zc=1,c)}function N(e,t,n){return e.Nb=S({}),_(e,C({},t),e.Nb,L(t.length),n),e}function O(e,u,t){for(var n,i,r,s="",a=[],o=0;o<5;++o){if(-1==(i=d(u)))throw Error("truncated input");a[o]=i<<24>>24}if(!function(e,t){var n,i,r,s,a;if(!(t.length<5)){for(s=(r=255&t[0])%9,a=(r=~~(r/9))%5,r=~~(r/5),i=n=0;i<4;++i)n+=(255&t[1+i])<<8*i;return!(99999999<n)&&function(e,t,n,i){if(!(8<t||4<n||4<i)){var r,s,a=e.gb;if(null==a.V||a.u!=t||a.I!=n)for(a.I=n,a.qc=(1<<n)-1,a.u=t,s=1<<a.u+a.I,a.V=m(s),r=0;r<s;++r)a.V[r]=function(e){return e.Ib=m(768),e}({});n=1<<i;return se(e.Rb,n),se(e.sb,n),e.Dc=n-1,1}}(e,s,a,r)&&(s=e,!((a=n)<0))&&(s.Ob!=a&&(s.Ob=a,s.nb=Math.max(s.Ob,1),a=s.B,s=Math.max(s.nb,4096),null!=a.Lb&&a.M==s||(a.Lb=m(s)),a.M=s,a.o=0,a.h=0),1)}}(n=function(e){e.B={},e.e={},e.Gb=m(192),e.Zb=m(12),e.Cb=m(12),e.Db=m(12),e.Eb=m(12),e.pb=m(192),e.kb=m(4),e.kc=m(114),e.Fb=l({},4),e.Rb=oe({}),e.sb=oe({}),e.gb={};for(var t=0;t<4;++t)e.kb[t]=l({},6);return e}({}),a))throw Error("corrupted input");for(o=0;o<64;o+=8){if(-1==(i=d(u)))throw Error("truncated input");s=(i=1==(i=i.toString(16)).length?"0"+i:i)+""+s}/^0+$|^f+$/i.test(s)?e.Tb=A:(r=parseInt(s,16),e.Tb=4294967295<r?A:L(r)),e.yb=function(e,t,n){e.e.Ab=u,re(e.B),e.B.cc=t;var i=e;i.B.h=0,i.B.o=0,v(i.Gb),v(i.pb),v(i.Zb),v(i.Cb),v(i.Db),v(i.Eb),v(i.kc);for(var r=i.gb,s=1<<r.u+r.I,a=0;a<s;++a)v(r.V[a].Ib);for(var o=0;o<4;++o)v(i.kb[o].G);le(i.Rb),le(i.sb),v(i.Fb.G);var l=i.e;l.Bb=0,l.E=-1;for(var c=0;c<5;++c)l.Bb=l.Bb<<8|d(l.Ab);return e.U=0,e.ib=0,e.Jc=0,e.Ic=0,e.Qc=0,e.Nc=n,e.g=H,e.jc=0,(t={}).Z=e,t.cb=null,t.zc=1,t}(n,t,e.Tb)}function D(e,t){return e.Nb=S({}),O(e,C({},t),e.Nb),e}function V(e,t){return e.c[e.f+e.o+t]}function z(e,t,n,i){var r,s;for(e.T&&e.o+t+i>e.h&&(i=e.h-(e.o+t)),++n,s=e.f+e.o+t,r=0;r<i&&e.c[s+r]==e.c[s+r-n];++r);return r}function W(e){return e.h-e.o}function ee(e){var t,n,i,r;if(!e.T)for(;;){if(!(r=-e.f+e.Kb-e.h))return;if(-1==(t=e.cc,n=e.c,i=e.f+e.h,r=r,n=t.Lc>=t.Yb?-1:(r=Math.min(r,t.Yb-t.Lc),U(t.Mc,t.Lc,n,i,r),t.Lc+=r,r)))return e.zb=e.h,e.f+e.zb>e.H&&(e.zb=e.H-e.f),e.T=1;e.h+=n,e.h>=e.o+e._b&&(e.zb=e.h-e._b)}}function te(e,t){e.f+=t,e.zb-=t,e.o-=t,e.h-=t}function k(e){++e.k>=e.p&&(e.k=0);var t=e;if(++t.o,t.o>t.zb){if(t.f+t.o>t.H){var n,i,r,s=t;for(0<(r=s.f+s.o-s.Bc)&&--r,i=s.f+s.h-r,n=0;n<i;++n)s.c[n]=s.c[r+n];s.f-=r}ee(t)}1073741823==e.o&&(t=e.o-e.p,ne(e.L,2*e.p,t),ne(e.ub,e.rc,t),te(e,t))}function ne(e,t,n){for(var i,r=0;r<t;++r)n>=(i=e[r]||0)?i=0:i-=n,e[r]=i}function c(e){var t=e.o-e.h;t&&(P(e.cc,e.Lb,e.h,t),e.o>=e.M&&(e.o=0),e.h=e.o)}function ie(e,t){t=e.o-t-1;return t<0&&(t+=e.M),e.Lb[t]}function re(e){c(e),e.cc=null}function F(e){return(e-=2)<4?e:3}function q(e){return e<4?0:e<10?e-3:e-6}function h(e){if(e.zc){if(e.cb)(function(e,t,n,i){var r,s,a,o,l,c,u,d,h,p,f,m,g;if(t[0]=H,n[0]=H,i[0]=1,e.oc&&(e.b.cc=e.oc,(g=e.b).f=0,g.o=0,g.h=0,g.T=0,ee(g),g.k=0,te(g,-1),e.W=1,e.oc=null),!e.pc){if(e.pc=1,p=e.g,G(e.g,H)){if(!W(e.b))return he(e,B(e.g));me(e),h=B(e.g)&e.y,$(e.d,e.C,(e.l<<4)+h,0),e.l=q(e.l),r=V(e.b,-e.s),Ae(K(e.A,B(e.g),e.J),e.d,r),e.J=r,--e.s,e.g=R(e.g,_e)}if(!W(e.b))return he(e,B(e.g));for(;;){if(l=function(n,e){var t,i,M,r,s,a,L,o,l,c,u,d,h,B,p,F,f,j,m,g,$,b,v,y,w,x,k,A,T,E,C,H,S,G,I,P,U,_,N,O,D;if(n.jb!=n.q)return R=n.a[n.q].r-n.q,n.mb=n.a[n.q].j,n.q=n.a[n.q].r,R;if(n.q=n.jb=0,n.N?(u=n.vb,n.N=0):u=me(n),y=n.D,(b=W(n.b)+1)<2)return n.mb=-1,1;for(273<b&&(b=273),o=P=0;o<4;++o)n.x[o]=n.v[o],n.Q[o]=z(n.b,-1,n.x[o],273),n.Q[o]>n.Q[P]&&(P=o);if(n.Q[P]>=n.n)return n.mb=P,fe(n,(R=n.Q[P])-1),R;if(u>=n.n)return n.mb=n.m[y-1]+4,fe(n,u-1),u;if(a=V(n.b,-1),p=V(n.b,-n.v[0]-1-1),u<2&&a!=p&&n.Q[P]<2)return n.mb=-1,1;{var R;n.a[0].Hc=n.l,E=e&n.y,n.a[1].z=Q[n.C[(n.l<<4)+E]>>>2]+X(K(n.A,e,n.J),7<=n.l,p,a),Te(n.a[1]),I=(F=Q[2048-n.C[(n.l<<4)+E]>>>2])+Q[2048-n.bb[n.l]>>>2],p==a&&(U=I+function(e,t){return Q[n.hb[e]>>>2]+Q[n._[(e<<4)+t]>>>2]}(n.l,E),n.a[1].z>U)&&(n.a[1].z=U,(R=n.a[1]).j=0,R.t=0)}if((c=u>=n.Q[P]?u:n.Q[P])<2)return n.mb=n.a[1].j,1;n.a[1].r=0,n.a[0].bc=n.x[0],n.a[0].ac=n.x[1],n.a[0].dc=n.x[2],n.a[0].lc=n.x[3],l=c;for(;n.a[l--].z=268435455,2<=l;);for(o=0;o<4;++o)if(!((G=n.Q[o])<2))for(H=I+J(n,o,n.l,E);r=H+Y(n.i,G-2,E),(k=n.a[G]).z>r&&(k.z=r,k.r=0,k.j=o,k.t=0),2<=--G;);if($=F+Q[n.bb[n.l]>>>2],u>=(l=2<=n.Q[0]?n.Q[0]+1:2)){for(w=0;l>n.m[w];)w+=2;for(;r=$+pe(n,L=n.m[w+1],l,E),(k=n.a[l]).z>r&&(k.z=r,k.r=0,k.j=L+4,k.t=0),l!=n.m[w]||(w+=2)!=y;++l);}for(t=0;;){if(++t==c)return ce(n,t);if(f=me(n),y=n.D,f>=n.n)return n.vb=f,n.N=1,ce(n,t);if(++e,T=n.a[t].r,N=n.a[t].t?(--T,q(N=n.a[t].Ac?(N=n.a[n.a[t].r2].Hc,n.a[t].j2<4?N<7?8:11:N<7?7:10):n.a[T].Hc)):n.a[T].Hc,T==t-1?N=n.a[t].j?q(N):N<7?9:11:(N=n.a[t].t&&n.a[t].Ac?(T=n.a[t].r2,A=n.a[t].j2,N<7?8:11):(A=n.a[t].j)<4?N<7?8:11:N<7?7:10,T=n.a[T],A<4?A?1==A?(n.x[0]=T.ac,n.x[1]=T.bc,n.x[2]=T.dc,n.x[3]=T.lc):2==A?(n.x[0]=T.dc,n.x[1]=T.bc,n.x[2]=T.ac,n.x[3]=T.lc):(n.x[0]=T.lc,n.x[1]=T.bc,n.x[2]=T.ac,n.x[3]=T.dc):(n.x[0]=T.bc,n.x[1]=T.ac,n.x[2]=T.dc,n.x[3]=T.lc):(n.x[0]=A-4,n.x[1]=T.bc,n.x[2]=T.ac,n.x[3]=T.dc)),n.a[t].Hc=N,n.a[t].bc=n.x[0],n.a[t].ac=n.x[1],n.a[t].dc=n.x[2],n.a[t].lc=n.x[3],T=n.a[t].z,a=V(n.b,-1),p=V(n.b,-n.x[0]-1-1),E=e&n.y,i=T+Q[n.C[(N<<4)+E]>>>2]+X(K(n.A,e,V(n.b,-2)),7<=N,p,a),j=0,(m=n.a[t+1]).z>i&&(m.z=i,m.r=t,m.j=-1,m.t=0,j=1),I=(F=T+Q[2048-n.C[(N<<4)+E]>>>2])+Q[2048-n.bb[N]>>>2],p!=a||t>m.r&&!m.j||(U=I+(Q[n.hb[N]>>>2]+Q[n._[(N<<4)+E]>>>2]),m.z>=U&&(m.z=U,m.r=t,m.j=0,m.t=0,j=1)),!((b=v=(v=W(n.b)+1)>4095-t?4095-t:v)<2)){if(b>n.n&&(b=n.n),!j&&p!=a&&(D=Math.min(v-1,n.n),2<=(h=z(n.b,0,n.x[0],D)))){for(O=q(N),C=e+1&n.y,g=i+Q[2048-n.C[(O<<4)+C]>>>2]+Q[2048-n.bb[O]>>>2],x=t+1+h;c<x;)n.a[++c].z=268435455;r=g+(Y(n.i,h-2,C)+J(n,0,O,C)),(k=n.a[x]).z>r&&(k.z=r,k.r=t+1,k.j=0,k.t=1,k.Ac=0)}for(_=2,S=0;S<4;++S)if(!((d=z(n.b,-1,n.x[S],b))<2)){B=d;do{for(;c<t+d;)n.a[++c].z=268435455}while(r=I+(Y(n.i,d-2,E)+J(n,S,N,E)),(k=n.a[t+d]).z>r&&(k.z=r,k.r=t,k.j=S,k.t=0),2<=--d);if(d=B,S||(_=d+1),d<v&&(D=Math.min(v-1-d,n.n),2<=(h=z(n.b,d,n.x[S],D)))){for(O=N<7?8:11,C=e+d&n.y,M=I+(Y(n.i,d-2,E)+J(n,S,N,E))+Q[n.C[(O<<4)+C]>>>2]+X(K(n.A,e+d,V(n.b,d-1-1)),1,V(n.b,d-1-(n.x[S]+1)),V(n.b,d-1)),O=q(O),C=e+d+1&n.y,g=M+Q[2048-n.C[(O<<4)+C]>>>2]+Q[2048-n.bb[O]>>>2],x=d+1+h;c<t+x;)n.a[++c].z=268435455;r=g+(Y(n.i,h-2,C)+J(n,0,O,C)),(k=n.a[t+x]).z>r&&(k.z=r,k.r=t+d+1,k.j=0,k.t=1,k.Ac=1,k.r2=t,k.j2=S)}}if(b<f){for(f=b,y=0;f>n.m[y];y+=2);n.m[y]=f,y+=2}if(_<=f){for($=F+Q[n.bb[N]>>>2];c<t+f;)n.a[++c].z=268435455;for(w=0;_>n.m[w];)w+=2;for(d=_;;++d)if(r=$+pe(n,s=n.m[w+1],d,E),(k=n.a[t+d]).z>r&&(k.z=r,k.r=t,k.j=s+4,k.t=0),d==n.m[w]){if(d<v&&(D=Math.min(v-1-d,n.n),2<=(h=z(n.b,d,s,D)))){for(O=N<7?7:10,C=e+d&n.y,M=r+Q[n.C[(O<<4)+C]>>>2]+X(K(n.A,e+d,V(n.b,d-1-1)),1,V(n.b,d-(s+1)-1),V(n.b,d-1)),O=q(O),C=e+d+1&n.y,g=M+Q[2048-n.C[(O<<4)+C]>>>2]+Q[2048-n.bb[O]>>>2],x=d+1+h;c<t+x;)n.a[++c].z=268435455;r=g+(Y(n.i,h-2,C)+J(n,0,O,C)),(k=n.a[t+x]).z>r&&(k.z=r,k.r=t+d+1,k.j=0,k.t=1,k.Ac=1,k.r2=t,k.j2=s+4)}if((w+=2)==y)break}}}}}(e,B(e.g)),u=e.mb,h=B(e.g)&e.y,a=(e.l<<4)+h,1==l&&-1==u){$(e.d,e.C,a,0),r=V(e.b,-e.s),f=K(e.A,B(e.g),e.J);if(e.l<7)Ae(f,e.d,r);else{c=V(e.b,-e.v[0]-1-e.s);{b=void 0;v=void 0;y=void 0;w=void 0;x=void 0;k=void 0;A=void 0;T=void 0;E=void 0;C=void 0;var b=f;var v=e.d;var y=c;var w=r;var x,k,A,T,E=1,C=1;for(k=7;0<=k;--k)x=w>>k&1,T=C,E&&(T+=1+(A=y>>k&1)<<8,E=A==x),$(v,b.tb,T,x),C=C<<1|x}}e.J=r,e.l=q(e.l)}else{if($(e.d,e.C,a,1),u<4){if($(e.d,e.bb,e.l,1),u?($(e.d,e.hb,e.l,1),1==u?$(e.d,e.Ub,e.l,0):($(e.d,e.Ub,e.l,1),$(e.d,e.vc,e.l,u-2))):($(e.d,e.hb,e.l,0),$(e.d,e._,a,1==l?0:1)),1==l?e.l=e.l<7?9:11:(we(e.i,e.d,l-2,h),e.l=e.l<7?8:11),s=e.v[u],0!=u){for(o=u;1<=o;--o)e.v[o]=e.v[o-1];e.v[0]=s}}else{if($(e.d,e.bb,e.l,0),e.l=e.l<7?7:10,we(e.$,e.d,l-2,h),f=be(u-=4),c=F(l),j(e.K[c],e.d,f),4<=f){d=u-(m=(2|1&f)<<(a=(f>>1)-1));if(f<14){S=void 0;I=void 0;P=void 0;U=void 0;_=void 0;N=void 0;O=void 0;D=void 0;var S=e.Sb;var I=m-f-1;var P=e.d;var U=a;var _=d;var N,O,D=1;for(O=0;O<U;++O)$(P,S,I+D,N=1&_),D=D<<1|N,_>>=1}else Ce(e.d,d>>4,a-4),Ee(e.S,e.d,15&d),++e.Qb}for(s=u,o=3;1<=o;--o)e.v[o]=e.v[o-1];e.v[0]=s,++e.Mb}e.J=V(e.b,l-1-e.s)}if(e.s-=l,e.g=R(e.g,L(l)),!e.s){if(128<=e.Mb&&de(e),16<=e.Qb&&ue(e),t[0]=e.g,n[0]=R(R(L((m=e.d).Jb),m.mc),[4,0]),!W(e.b))return he(e,B(e.g));if(0<=M(Z(e.g,p),[4096,0]))return i[e.pc=0]=0}}}})((t=e).cb,t.cb.Xb,t.cb.uc,t.cb.Kc),t.Pb=t.cb.Xb[0],t.cb.Kc[0]&&(ge(n=t.cb),n.d.Ab=null,t.zc=0);else{n=e;t=function(e){var r,t,n,i,s=B(e.g)&e.Dc;if(b(e.e,e.Gb,(e.U<<4)+s)){if(b(e.e,e.Zb,e.U))i=0,b(e.e,e.Cb,e.U)?(b(e.e,e.Db,e.U)?(b(e.e,e.Eb,e.U)?(n=e.Qc,e.Qc=e.Ic):n=e.Ic,e.Ic=e.Jc):n=e.Jc,e.Jc=e.ib,e.ib=n):b(e.e,e.pb,(e.U<<4)+s)||(e.U=e.U<7?9:11,i=1),i||(i=ae(e.sb,e.e,s)+2,e.U=e.U<7?8:11);else if(e.Qc=e.Ic,e.Ic=e.Jc,e.Jc=e.ib,i=2+ae(e.Rb,e.e,s),e.U=e.U<7?7:10,4<=(n=p(e.kb[F(i)],e.e))){if(e.ib=(2|1&n)<<(r=(n>>1)-1),n<14)e.ib+=function(e,t,n,i){for(var r,s=1,a=0,o=0;o<i;++o)s=(s<<1)+(r=b(n,e,t+s)),a|=r<<o;return a}(e.kc,e.ib-n-1,e.e,r);else if(e.ib+=function(e){for(var t,n=0,i=r-4;0!=i;--i)e.E>>>=1,t=e.Bb-e.E>>>31,e.Bb-=e.E&t-1,n=n<<1|1-t,-16777216&e.E||(e.Bb=e.Bb<<8|d(e.Ab),e.E<<=8);return n}(e.e)<<4,e.ib+=function(e,t){for(var n,i=1,r=0,s=0;e.F>s;++s)i=(i<<1)+(n=b(t,e.G,i)),r|=n<<s;return r}(e.Fb,e.e),e.ib<0)return-1==e.ib?1:-1}else e.ib=n;if(0<=M(L(e.ib),e.g)||e.ib>=e.nb)return-1;var a=e.B,s=e.ib,o=i,l=a.o-s-1;for(l<0&&(l+=a.M);0!=o;--o)l>=a.M&&(l=0),a.Lb[a.o++]=a.Lb[l++],a.o>=a.M&&c(a);e.g=R(e.g,L(i)),e.jc=ie(e.B,0)}else n=e.gb,s=B(e.g),i=e.jc,s=n.V[((s&n.qc)<<n.u)+((255&i)>>>8-n.u)],e.jc=e.U<7?function(e,t){for(var n=1;(n=n<<1|b(t,e.Ib,n))<256;);return n<<24>>24}(s,e.e):function(e,t,n){var i,r,s=1;do{if(r=n>>7&1,n<<=1,s=s<<1|(i=b(t,e.Ib,(1+r<<8)+s)),r!=i){for(;s<256;)s=s<<1|b(t,e.Ib,s);break}}while(s<256);return s<<24>>24}(s,e.e,ie(e.B,e.ib)),s=e.B,t=e.jc,s.Lb[s.o++]=t,s.o>=s.M&&c(s),e.U=q(e.U),e.g=R(e.g,_e);return 0}(n.Z);if(-1==t)throw Error("corrupted input");n.Pb=A,n.Pc=n.Z.g,(t||0<=M(n.Z.Nc,H)&&0<=M(n.Z.g,n.Z.Nc))&&(c(n.Z.B),re(n.Z.B),n.Z.e.Ab=null,n.zc=0)}return e.zc}throw Error("bad state");var t,n}function se(e,t){for(;t>e.O;++e.O)e.ec[e.O]=l({},3),e.hc[e.O]=l({},3)}function ae(e,t,n){return b(t,e.wc,0)?8+(b(t,e.wc,1)?8+p(e.tc,t):p(e.hc[n],t)):p(e.ec[n],t)}function oe(e){return e.wc=m(2),e.ec=m(16),e.hc=m(16),e.tc=l({},8),e.O=0,e}function le(e){v(e.wc);for(var t=0;e.O>t;++t)v(e.ec[t].G),v(e.hc[t].G);v(e.tc.G)}function ce(e,t){var n,i,r,s;for(e.jb=t,r=e.a[t].r,i=e.a[t].j;e.a[t].t&&(Te(e.a[r]),e.a[r].r=r-1,e.a[t].Ac)&&(e.a[r-1].t=0,e.a[r-1].r=e.a[t].r2,e.a[r-1].j=e.a[t].j2),s=r,n=i,i=e.a[s].j,r=e.a[s].r,e.a[s].j=n,e.a[s].r=t,0<(t=s););return e.mb=e.a[0].j,e.q=e.a[0].r}function ue(e){for(var t=0;t<16;++t)e.nc[t]=function(e,t){var n,i,r=1,s=0;for(i=e.F;0!=i;--i)n=1&t,t>>>=1,s+=y(e.G[r],n),r=r<<1|n;return s}(e.S,t);e.Qb=0}function de(e){for(var t,n,i,r,s,a,o,l=4;l<128;++l)t=(2|1&(s=be(l)))<<(i=(s>>1)-1),e.yc[l]=function(e,t,n,i){var r,s,a=1,o=0;for(s=n;0!=s;--s)r=1&i,i>>>=1,o+=Q[(2047&(e[t+a]-r^-r))>>>2],a=a<<1|r;return o}(e.Sb,t-s-1,i,l-t);for(r=0;r<4;++r){for(n=e.K[r],a=r<<6,s=0;e.$b>s;++s)e.P[a+s]=f(n,s);for(s=14;e.$b>s;++s)e.P[a+s]+=(s>>1)-1-4<<6;for(o=128*r,l=0;l<4;++l)e.lb[o+l]=e.P[a+l];for(;l<128;++l)e.lb[o+l]=e.P[a+be(l)]+e.yc[l]}e.Mb=0}function he(e,t){var n;ge(e),n=t&(t=e).y,t.Gc&&($(t.d,t.C,(t.l<<4)+n,1),$(t.d,t.bb,t.l,0),t.l=t.l<7?7:10,we(t.$,t.d,0,n),n=F(2),j(t.K[n],t.d,63),Ce(t.d,67108863,26),Ee(t.S,t.d,15));for(var i=0;i<5;++i)Se(e.d)}function pe(e,t,n,i){var r=F(n);return(t<128?e.lb[128*r+t]:e.P[(r<<6)+(t<131072?s[t>>6]+12:t<134217728?s[t>>16]+32:s[t>>26]+52)]+e.nc[15&t])+Y(e.$,n-2,i)}function J(e,t,n,i){var r;return t?(r=Q[2048-e.hb[n]>>>2],1==t?r+=Q[e.Ub[n]>>>2]:r=(r+=Q[2048-e.Ub[n]>>>2])+y(e.vc[n],t-2)):(r=Q[e.hb[n]>>>2],r+=Q[2048-e._[(n<<4)+i]>>>2]),r}function fe(e,t){if(0<t){var n,i,r,s,a,o,l,c,u,d,h,p,f,m,g=e.b,b=t;do{if(g.h>=g.o+g.ob)u=g.ob;else if(u=g.h-g.o,g.xb>u){k(g);continue}for(d=g.o>g.p?g.o-g.p:0,i=g.f+g.o,a=g.qb?(a=1023&(m=Ne[255&g.c[i]]^255&g.c[i+1]),g.ub[a]=g.o,a=65535&(m^=(255&g.c[i+2])<<8),g.ub[1024+a]=g.o,(m^Ne[255&g.c[i+3]]<<5)&g.Ec):255&g.c[i]^(255&g.c[i+1])<<8,r=g.ub[g.R+a],g.ub[g.R+a]=g.o,p=1+(g.k<<1),f=g.k<<1,l=c=g.w,n=g.Fc;;){if(r<=d||0==n--){g.L[p]=g.L[f]=0;break}if(s=g.o-r,s=(g.k>=s?g.k-s:g.k-s+g.p)<<1,h=g.f+r,g.c[h+(o=l<c?l:c)]==g.c[i+o]){for(;++o!=u&&g.c[h+o]==g.c[i+o];);if(o==u){g.L[f]=g.L[s],g.L[p]=g.L[1+s];break}}(255&g.c[i+o])>(255&g.c[h+o])?(g.L[f]=r,r=g.L[f=1+s],c=o):(g.L[p]=r,r=g.L[p=s],l=o)}k(g)}while(0!=--b);e.s+=t}}function me(e){var t=0;return e.D=function(e,t){var n,i,r,s,a,o,l,c,u,d,h,p,f,m,g,b,v,y,w,x;if(e.h>=e.o+e.ob)f=e.ob;else if(f=e.h-e.o,e.xb>f)return k(e),0;for(m=e.o>e.p?e.o-e.p:0,i=e.f+e.o,g=1,u=c=b=0,x=e.qb?(c=1023&(x=Ne[255&e.c[i]]^255&e.c[i+1]),u=65535&(x^=(255&e.c[i+2])<<8),(x^Ne[255&e.c[i+3]]<<5)&e.Ec):255&e.c[i]^(255&e.c[i+1])<<8,r=e.ub[e.R+x]||0,e.qb&&(s=e.ub[c]||0,a=e.ub[1024+u]||0,e.ub[c]=e.o,e.ub[1024+u]=e.o,m<s&&e.c[e.f+s]==e.c[i]&&(t[b++]=g=2,t[b++]=e.o-s-1),m<a&&e.c[e.f+a]==e.c[i]&&(a==s&&(b-=2),t[b++]=g=3,t[b++]=e.o-a-1,s=a),0!=b)&&s==r&&(b-=2,g=1),e.ub[e.R+x]=e.o,y=1+(e.k<<1),w=e.k<<1,h=p=e.w,0!=e.w&&m<r&&e.c[e.f+r+e.w]!=e.c[i+e.w]&&(t[b++]=g=e.w,t[b++]=e.o-r-1),n=e.Fc;;){if(r<=m||0==n--){e.L[y]=e.L[w]=0;break}if(l=e.o-r,o=(e.k>=l?e.k-l:e.k-l+e.p)<<1,v=e.f+r,e.c[v+(d=h<p?h:p)]==e.c[i+d]){for(;++d!=f&&e.c[v+d]==e.c[i+d];);if(g<d&&(t[b++]=g=d,t[b++]=l-1,d==f)){e.L[w]=e.L[o],e.L[y]=e.L[1+o];break}}(255&e.c[i+d])>(255&e.c[v+d])?(e.L[w]=r,r=e.L[w=1+o],p=d):(e.L[y]=r,r=e.L[y=o],h=d)}return k(e),b}(e.b,e.m),0<e.D&&(t=e.m[e.D-2])==e.n&&(t+=z(e.b,t-1,e.m[e.D-1],273-t)),++e.s,t}function ge(e){e.b&&e.W&&(e.b.cc=null,e.W=0)}function be(e){return e<2048?s[e]:e<2097152?s[e>>10]+20:s[e>>20]+40}function ve(e,t){v(e.db);for(var n=0;n<t;++n)v(e.Vb[n].G),v(e.Wb[n].G);v(e.ic.G)}function ye(e,t,n,i,r){var s,a=Q[e.db[0]>>>2],o=(s=Q[2048-e.db[0]>>>2])+Q[e.db[1]>>>2],l=s+Q[2048-e.db[1]>>>2],c=0;for(c=0;c<8;++c){if(n<=c)return;i[r+c]=a+f(e.Vb[t],c)}for(;c<16;++c){if(n<=c)return;i[r+c]=o+f(e.Wb[t],c-8)}for(;c<n;++c)i[r+c]=l+f(e.ic,c-8-8)}function we(e,t,n,i){var r,s;r=e,t=t,s=i,(n=n)<8?($(t,r.db,0,0),j(r.Vb[s],t,n)):(n-=8,$(t,r.db,0,1),n<8?($(t,r.db,1,0),j(r.Wb[s],t,n)):($(t,r.db,1,1),j(r.ic,t,n-8))),0==--e.sc[i]&&(ye(e,i,e.rb,e.Cc,272*i),e.sc[i]=e.rb)}function xe(e){var t=e;t.db=m(2),t.Vb=m(16),t.Wb=m(16),t.ic=g({},8);for(var n=0;n<16;++n)t.Vb[n]=g({},3),t.Wb[n]=g({},3);return e.Cc=[],e.sc=[],e}function Y(e,t,n){return e.Cc[272*n+t]}function ke(e,t){for(var n=0;n<t;++n)ye(e,n,e.rb,e.Cc,272*n),e.sc[n]=e.rb}function K(e,t,n){return e.V[((t&e.qc)<<e.u)+((255&n)>>>8-e.u)]}function Ae(e,t,n){for(var i,r=1,s=7;0<=s;--s)$(t,e.tb,r,i=n>>s&1),r=r<<1|i}function X(e,t,n,i){var r,s,a=1,o=7,l=0;if(t)for(;0<=o;--o)if(l+=y(e.tb[(1+(s=n>>o&1)<<8)+a],r=i>>o&1),a=a<<1|r,s!=r){--o;break}for(;0<=o;--o)l+=y(e.tb[a],r=i>>o&1),a=a<<1|r;return l}function Te(e){e.j=-1,e.t=0}function l(e,t){return e.F=t,e.G=m(1<<t),e}function p(e,t){for(var n=1,i=e.F;0!=i;--i)n=(n<<1)+b(t,e.G,n);return n-(1<<e.F)}function g(e,t){return e.F=t,e.G=m(1<<t),e}function j(e,t,n){for(var i,r=1,s=e.F;0!=s;)i=n>>>--s&1,$(t,e.G,r,i),r=r<<1|i}function f(e,t){for(var n,i=1,r=0,s=e.F;0!=s;)n=t>>>--s&1,r+=y(e.G[i],n),i=(i<<1)+n;return r}function Ee(e,t,n){for(var i,r=1,s=0;e.F>s;++s)$(t,e.G,r,i=1&n),r=r<<1|i,n>>=1}function b(e,t,n){var i,r=t[n];return(-2147483648^(i=(e.E>>>11)*r))>(-2147483648^e.Bb)?(e.E=i,t[n]=r+(2048-r>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|d(e.Ab),e.E<<=8),0):(e.E-=i,e.Bb-=i,t[n]=r-(r>>>5)<<16>>16,-16777216&e.E||(e.Bb=e.Bb<<8|d(e.Ab),e.E<<=8),1)}function v(e){for(var t=e.length-1;0<=t;--t)e[t]=1024}function $(e,t,n,i){var r=t[n],s=(e.E>>>11)*r;i?(e.xc=R(e.xc,a(L(s),[4294967295,0])),e.E-=s,t[n]=r-(r>>>5)<<16>>16):(e.E=s,t[n]=r+(2048-r>>>5)<<16>>16),-16777216&e.E||(e.E<<=8,Se(e))}function Ce(e,t,n){for(var i=n-1;0<=i;--i)e.E>>>=1,1==(t>>>i&1)&&(e.xc=R(e.xc,L(e.E))),-16777216&e.E||(e.E<<=8,Se(e))}function Se(e){var t,n=B(function(e,t){t=E(e,t&=63);return t=e[1]<0?R(t,o([2,0],31)):t}(e.xc,32));if(0!=n||M(e.xc,[4278190080,0])<0){for(e.mc=R(e.mc,L(e.Jb)),t=e.Oc;I(e.Ab,t+n),t=255,0!=--e.Jb;);e.Oc=B(e.xc)>>>24}++e.Jb,e.xc=o(a(e.xc,[16777215,0]),8)}function y(e,t){return Q[(2047&(e-t^-t))>>>2]}function Ie(e){for(var t,n,i,r=0,s=0,a=e.length,o=[],l=[];r<a;++r,++s){if(128&(t=255&e[r]))if(192==(224&t)){if(a<=r+1)return e;if(128!=(192&(n=255&e[++r])))return e;l[s]=(31&t)<<6|63&n}else{if(224!=(240&t))return e;if(a<=r+2)return e;if(128!=(192&(n=255&e[++r])))return e;if(128!=(192&(i=255&e[++r])))return e;l[s]=(15&t)<<12|(63&n)<<6|63&i}else{if(!t)return e;l[s]=t}16383==s&&(o.push(String.fromCharCode.apply(String,l)),s=-1)}return 0<s&&(l.length=s,o.push(String.fromCharCode.apply(String,l))),o.join("")}function Pe(e){var t,n,i,r=[],s=0,a=e.length;if("object"==typeof e)return e;for(var o=e,l=a,c=r,u=0,d=0;d<l;++d)c[u++]=o.charCodeAt(d);for(i=0;i<a;++i)1<=(t=r[i])&&t<=127?++s:s+=!t||128<=t&&t<=2047?2:3;for(n=[],i=s=0;i<a;++i)1<=(t=r[i])&&t<=127?n[s++]=t<<24>>24:(!t||128<=t&&t<=2047?n[s++]=(192|t>>6&31)<<24>>24:(n[s++]=(224|t>>12&15)<<24>>24,n[s++]=(128|t>>6&63)<<24>>24),n[s++]=(128|63&t)<<24>>24);return n}function w(e){return e[1]+e[0]}var t,x="function"==typeof setImmediate?setImmediate:setTimeout,r=4294967296,A=[4294967295,-r],Ue=[0,-0x8000000000000000],H=[0,0],_e=[1,0],Ne=function(){for(var e,t,n=[],i=0;i<256;++i){for(t=i,e=0;e<8;++e)0!=(1&t)?t=t>>>1^-306674912:t>>>=1;n[i]=t}return n}(),s=function(){for(var e,t,n=2,i=[0,1],r=2;r<22;++r)for(t=1<<(r>>1)-1,e=0;e<t;++e,++n)i[n]=r<<24>>24;return i}(),Q=function(){for(var e,t,n=[],i=8;0<=i;--i)for(e=1<<9-i,t=1<<9-i-1;t<e;++t)n[t]=(i<<6)+(e-t<<6>>>9-i-1);return n}(),Oe=(t=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}],function(e){return t[e-1]||t[6]});return"undefined"==typeof onmessage||"undefined"!=typeof window&&void 0!==window.document||(onmessage=function(t){t&&t.gc&&(2==t.gc.action?e.decompress(t.gc.gc,t.gc.cbn):1==t.gc.action&&e.compress(t.gc.gc,t.gc.Rc,t.gc.cbn))}),{compress:function(e,t,i,r){var s,n,a={},o=void 0===i&&void 0===r;if("function"!=typeof i&&(n=i,i=r=0),r=r||function(e){return void 0!==n?T(e,n):void 0},i=i||function(e,t){return void 0!==n?postMessage({action:1,cbn:n,result:e,error:t}):void 0},o){for(a.c=N({},Pe(e),Oe(t));h(a.c.yb););return u(a.c.Nb)}try{a.c=N({},Pe(e),Oe(t)),r(0)}catch(e){return i(null,e)}x(function e(){try{for(var t,n=(new Date).getTime();h(a.c.yb);)if(s=w(a.c.yb.Pb)/w(a.c.Tb),200<(new Date).getTime()-n)return r(s),x(e,0),0;r(1),t=u(a.c.Nb),x(i.bind(null,t),0)}catch(e){i(null,e)}},0)},decompress:function(e,r,s){var a,n,o,l,c={},t=void 0===r&&void 0===s;if("function"!=typeof r&&(n=r,r=s=0),s=s||function(e){return void 0!==n?T(o?e:-1,n):void 0},r=r||function(e,t){return void 0!==n?postMessage({action:2,cbn:n,result:e,error:t}):void 0},t){for(c.d=D({},e);h(c.d.yb););return Ie(u(c.d.Nb))}try{c.d=D({},e),l=w(c.d.Tb),o=-1<l,s(0)}catch(e){return r(null,e)}x(function e(){try{for(var t,n=0,i=(new Date).getTime();h(c.d.yb);)if(++n%1e3==0&&200<(new Date).getTime()-i)return o&&(a=w(c.d.yb.Z.g)/l,s(a)),x(e,0),0;s(1),t=Ie(u(c.d.Nb)),x(r.bind(null,t),0)}catch(e){r(null,e)}},0)}}}(),pxt,pxt,pxt,pxt,pxt,ts,pxtc=(this.LZMA=this.LZMA_WORKER=e,function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DOMPurify=t()}(this,function(){"use strict";function e(r){return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o(r,e,n)}}function t(i){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return l(i,t)}}function be(e,t){s&&s(e,null);for(var n=t.length;n--;){var i,r=t[n];"string"==typeof r&&(i=Ie(r))!==r&&(a(t)||(t[n]=i),r=i),e[r]=!0}return e}function ve(e){var t={},n=void 0;for(n in e)o(i,e,[n])&&(t[n]=e[n]);return t}function ye(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=Object.hasOwnProperty,s=Object.setPrototypeOf,a=Object.isFrozen,we=Object.keys,xe=Object.freeze,n=Object.seal,r="undefined"!=typeof Reflect&&Reflect,o=(o=r.apply)||function(e,t,n){return e.apply(t,n)},xe=xe||function(e){return e},n=n||function(e){return e},l=(l=r.construct)||function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))},ke=e(Array.prototype.forEach),Ae=e(Array.prototype.indexOf),Te=e(Array.prototype.join),Ee=e(Array.prototype.pop),Ce=e(Array.prototype.push),Se=e(Array.prototype.slice),Ie=e(String.prototype.toLowerCase),Pe=e(String.prototype.match),Ue=e(String.prototype.replace),_e=e(String.prototype.indexOf),Ve=e(String.prototype.trim),Ne=e(RegExp.prototype.test),ze=t(RegExp),Oe=t(TypeError),De=xe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Re=xe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),Me=xe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Le=xe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),Be=xe(["#text"]),Fe=xe(["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","minlength","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"]),je=xe(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$e=xe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),He=xe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),We=n(/\{\{[\s\S]*|[\s\S]*\}\}/gm),qe=n(/<%[\s\S]*|[\s\S]*%>/gm),Je=n(/^data-[\-\w.\u00B7-\uFFFF]/),Ye=n(/^aria-[\-\w]+$/),Ke=n(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Xe=n(/^(?:\w+script|data):/i),Qe=n(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g),Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return function R(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window,c=function(e){return R(e)};if(c.version="2.0.8",c.removed=[],o&&o.document&&9===o.document.nodeType){var l=o.document,M=!1,L=!1,s=o.document,B=o.DocumentFragment,e=o.HTMLTemplateElement,u=o.Node,t=o.NodeFilter,n=o.NamedNodeMap,F=void 0===n?o.NamedNodeMap||o.MozNamedAttrMap:n,j=o.Text,$=o.Comment,H=o.DOMParser,n=o.trustedTypes,d=("function"==typeof e&&(e=s.createElement("template")).content&&e.content.ownerDocument&&(s=e.content.ownerDocument),function(e,t){if("object"!==(void 0===e?"undefined":Ge(e))||"function"!=typeof e.createPolicy)return null;var n=null,t="dompurify"+((n=t.currentScript&&t.currentScript.hasAttribute("data-tt-policy-suffix")?t.currentScript.getAttribute("data-tt-policy-suffix"):n)?"#"+n:"");try{return e.createPolicy(t,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+t+" could not be created."),null}}(n,l)),G=d?d.createHTML(""):"",e=s,a=e.implementation,V=e.createNodeIterator,z=e.getElementsByTagName,W=e.createDocumentFragment,q=l.importNode,i={},h=(c.isSupported=a&&void 0!==a.createHTMLDocument&&9!==s.documentMode,We),p=qe,J=Je,Y=Ye,K=Xe,X=Qe,r=Ke,f=null,Q=be({},[].concat(ye(De),ye(Re),ye(Me),ye(Le),ye(Be))),m=null,Z=be({},[].concat(ye(Fe),ye(je),ye($e),ye(He))),g=null,b=null,ee=!0,v=!0,te=!1,y=!1,w=!1,x=!1,k=!1,A=!1,T=!1,E=!1,ne=!1,C=!1,ie=!0,S=!0,I=!1,P={},re=be({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),se=be({},["audio","video","img","source","image"]),U=null,ae=be({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),_=null,oe=s.createElement("form"),le=function(e){_&&_===e||(e&&"object"===(void 0===e?"undefined":Ge(e))||(e={}),f="ALLOWED_TAGS"in e?be({},e.ALLOWED_TAGS):Q,m="ALLOWED_ATTR"in e?be({},e.ALLOWED_ATTR):Z,U="ADD_URI_SAFE_ATTR"in e?be(ve(ae),e.ADD_URI_SAFE_ATTR):ae,g="FORBID_TAGS"in e?be({},e.FORBID_TAGS):{},b="FORBID_ATTR"in e?be({},e.FORBID_ATTR):{},P="USE_PROFILES"in e&&e.USE_PROFILES,ee=!1!==e.ALLOW_ARIA_ATTR,v=!1!==e.ALLOW_DATA_ATTR,te=e.ALLOW_UNKNOWN_PROTOCOLS||!1,y=e.SAFE_FOR_JQUERY||!1,w=e.SAFE_FOR_TEMPLATES||!1,x=e.WHOLE_DOCUMENT||!1,T=e.RETURN_DOM||!1,E=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_DOM_IMPORT||!1,C=e.RETURN_TRUSTED_TYPE||!1,A=e.FORCE_BODY||!1,ie=!1!==e.SANITIZE_DOM,S=!1!==e.KEEP_CONTENT,I=e.IN_PLACE||!1,r=e.ALLOWED_URI_REGEXP||r,w&&(v=!1),E&&(T=!0),P&&(f=be({},[].concat(ye(Be))),m=[],!0===P.html&&(be(f,De),be(m,Fe)),!0===P.svg&&(be(f,Re),be(m,je),be(m,He)),!0===P.svgFilters&&(be(f,Me),be(m,je),be(m,He)),!0===P.mathMl)&&(be(f,Le),be(m,$e),be(m,He)),e.ADD_TAGS&&be(f=f===Q?ve(f):f,e.ADD_TAGS),e.ADD_ATTR&&be(m=m===Z?ve(m):m,e.ADD_ATTR),e.ADD_URI_SAFE_ATTR&&be(U,e.ADD_URI_SAFE_ATTR),S&&(f["#text"]=!0),x&&be(f,["html","head","body"]),f.table&&(be(f,["tbody"]),delete g.tbody),xe&&xe(e),_=e)},ce=function(t){Ce(c.removed,{element:t});try{t.parentNode.removeChild(t)}catch(e){t.outerHTML=G}},N=function(e,t){try{Ce(c.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){Ce(c.removed,{attribute:null,from:t})}t.removeAttribute(e)},O=function(e){var t,n=void 0,i=void 0,r=(A?e="<remove></remove>"+e:i=(r=Pe(e,/^[\s]+/))&&r[0],d?d.createHTML(e):e);if(M)try{n=(new H).parseFromString(r,"text/html")}catch(e){}return L&&be(g,["title"]),n&&n.documentElement||((t=(n=a.createHTMLDocument("")).body).parentNode.removeChild(t.parentNode.firstElementChild),t.outerHTML=r),e&&i&&n.body.insertBefore(s.createTextNode(i),n.body.childNodes[0]||null),z.call(n,x?"html":"body")[0]};if(c.isSupported){try{O('<svg><p><textarea><img src="</textarea><img src=x abc=1//">').querySelector("svg img")&&(M=!0)}catch(e){}try{var ue=O("<x/><title>&lt;/title&gt;&lt;img&gt;");Ne(/<\/title/,ue.querySelector("title").innerHTML)&&(L=!0)}catch(ue){}}var de=function(e){return V.call(e.ownerDocument||e,e,t.SHOW_ELEMENT|t.SHOW_COMMENT|t.SHOW_TEXT,function(){return t.FILTER_ACCEPT},!1)},he=function(e){return"object"===(void 0===u?"undefined":Ge(u))?e instanceof u:e&&"object"===(void 0===e?"undefined":Ge(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},D=function(e,t,n){i[e]&&ke(i[e],function(e){e.call(c,t,n,_)})},pe=function(e){var t;if(D("beforeSanitizeElements",e,null),(n=e)instanceof j||n instanceof $||"string"==typeof n.nodeName&&"string"==typeof n.textContent&&"function"==typeof n.removeChild&&n.attributes instanceof F&&"function"==typeof n.removeAttribute&&"function"==typeof n.setAttribute&&"string"==typeof n.namespaceURI){var n=Ie(e.nodeName);if(D("uponSanitizeElement",e,{tagName:n,allowedTags:f}),"svg"!==n&&"math"!==n||0===e.querySelectorAll("p, br").length){if(f[n]&&!g[n])return"noscript"===n&&Ne(/<\/noscript/i,e.innerHTML)||"noembed"===n&&Ne(/<\/noembed/i,e.innerHTML)?(ce(e),!0):(!y||e.firstElementChild||e.content&&e.content.firstElementChild||!Ne(/</g,e.textContent)||(Ce(c.removed,{element:e.cloneNode()}),e.innerHTML?e.innerHTML=Ue(e.innerHTML,/</g,"&lt;"):e.innerHTML=Ue(e.textContent,/</g,"&lt;")),w&&3===e.nodeType&&(t=e.textContent,t=Ue(t,h," "),t=Ue(t,p," "),e.textContent!==t)&&(Ce(c.removed,{element:e.cloneNode()}),e.textContent=t),D("afterSanitizeElements",e,null),!1);if(S&&!re[n]&&"function"==typeof e.insertAdjacentHTML)try{var i=e.innerHTML;e.insertAdjacentHTML("AfterEnd",d?d.createHTML(i):i)}catch(e){}}}return ce(e),!0},fe=function(e,t,n){if(ie&&("id"===t||"name"===t)&&(n in s||n in oe))return!1;if(!(v&&Ne(J,t)||ee&&Ne(Y,t))){if(!m[t]||b[t])return!1;if(!U[t]&&!Ne(r,Ue(n,X,""))&&("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==_e(n,"data:")||!se[e])&&(!te||Ne(K,Ue(n,X,"")))&&n)return!1}return!0},me=function(e){var t=void 0,n=void 0,i=(D("beforeSanitizeAttributes",e,null),e.attributes);if(i){for(var r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:m},n=i.length;n--;){o=i[n];var s=o.name,a=o.namespaceURI,t=Ve(o.value),o=Ie(s);if(r.attrName=o,r.attrValue=t,r.keepAttr=!0,r.forceKeepAttr=void 0,D("uponSanitizeAttribute",e,r),t=r.attrValue,!r.forceKeepAttr){if("name"===o&&"IMG"===e.nodeName&&i.id)l=i.id,i=Se(i,[]),N("id",e),N(s,e),Ae(i,l)>n&&e.setAttribute("id",l.value);else{if("INPUT"===e.nodeName&&"type"===o&&"file"===t&&r.keepAttr&&(m[o]||!b[o]))continue;"id"===s&&e.setAttribute(s,""),N(s,e)}if(r.keepAttr)if(y&&Ne(/\/>/i,t))N(s,e);else if(Ne(/svg|math/i,e.namespaceURI)&&Ne(ze("</("+Te(we(re),"|")+")","i"),t))N(s,e);else{w&&(t=Ue(t,h," "),t=Ue(t,p," "));var l=e.nodeName.toLowerCase();if(fe(l,o,t))try{a?e.setAttributeNS(a,s,t):e.setAttribute(s,t),Ee(c.removed)}catch(e){}}}}D("afterSanitizeAttributes",e,null)}},ge=function e(t){var n,i=de(t);for(D("beforeSanitizeShadowDOM",t,null);n=i.nextNode();)D("uponSanitizeShadowNode",n,null),pe(n)||(n.content instanceof B&&e(n.content),me(n));D("afterSanitizeShadowDOM",t,null)};c.sanitize=function(e,t){var n,i=void 0,r=void 0,s=void 0;if("string"!=typeof(e=e||"\x3c!--\x3e")&&!he(e)){if("function"!=typeof e.toString)throw Oe("toString is not a function");if("string"!=typeof(e=e.toString()))throw Oe("dirty is not a string, aborting")}if(!c.isSupported){if("object"===Ge(o.toStaticHTML)||"function"==typeof o.toStaticHTML){if("string"==typeof e)return o.toStaticHTML(e);if(he(e))return o.toStaticHTML(e.outerHTML)}return e}if(k||le(t),c.removed=[],!(I="string"==typeof e?!1:I))if(e instanceof u)1===(t=(i=O("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===t.nodeName||"HTML"===t.nodeName?i=t:i.appendChild(t);else{if(!T&&!w&&!x&&C&&-1===e.indexOf("<"))return d?d.createHTML(e):e;if(!(i=O(e)))return T?null:G}i&&A&&ce(i.firstChild);for(var a=de(I?e:i);n=a.nextNode();)3===n.nodeType&&n===r||pe(n)||(n.content instanceof B&&ge(n.content),me(n),r=n);if(r=null,I)return e;if(T){if(E)for(s=W.call(i.ownerDocument);i.firstChild;)s.appendChild(i.firstChild);else s=i;return s=ne?q.call(l,s,!0):s}t=x?i.outerHTML:i.innerHTML;return w&&(t=Ue(t,h," "),t=Ue(t,p," ")),d&&C?d.createHTML(t):t},c.setConfig=function(e){le(e),k=!0},c.clearConfig=function(){_=null,k=!1},c.isValidAttribute=function(e,t,n){_||le({});e=Ie(e),t=Ie(t);return fe(e,t,n)},c.addHook=function(e,t){"function"==typeof t&&(i[e]=i[e]||[],Ce(i[e],t))},c.removeHook=function(e){i[e]&&Ee(i[e])},c.removeHooks=function(e){i[e]&&(i[e]=[])},c.removeAllHooks=function(){i={}}}else c.isSupported=!1;return c}()}),pxt=pxt||{},function(s){{var e=s.analytics||(s.analytics={});const a={},o={};let t=!1;e.addDefaultProperties=function(t){Object.keys(t).forEach(e=>{"string"==typeof t[e]?a[e]=t[e]:o[e]=t[e]})},e.enable=function(){if(s.aiTrackException&&s.aiTrackEvent&&!t){t=!0,s.debug("setting up app insights");const i=s.tickEvent,r=(s.tickEvent=function(e,t,n){if(i&&i(e,t,n),null!=n&&n.interactiveConsent&&s.setInteractiveConsent(!0),t){const i=Object.assign({},a)||{},n=Object.assign({},o)||{};Object.keys(t).forEach(e=>{"string"==typeof t[e]?i[e]=t[e]:"number"==typeof t[e]?n[e]=t[e]:i[e]=JSON.stringify(t[e]||"")}),s.aiTrackEvent(e,i,n)}else s.aiTrackEvent(e)},s.reportException),e=(s.reportException=function(e,t){r&&r(e,t);var n={target:s.appTarget.id,version:s.appTarget.versions.target};t&&s.Util.jsonMergeFrom(n,t),s.aiTrackException(e,"exception",n)},s.reportError);s.reportError=function(t,n,i){e&&e(t,n,i);try{throw n}catch(e){t={target:s.appTarget.id,version:s.appTarget.versions.target,category:t,message:n};i&&s.Util.jsonMergeFrom(t,i),s.aiTrackException(e,"error",t)}}}}}}(pxt=pxt||{}),pxt=pxt||{},function(e){{e=e.AudioContextManager||(e.AudioContextManager={});let n,i,r,s=0,a=!1;function t(){n&&(r.gain.setTargetAtTime(0,n.currentTime,.015),s=0)}e.mute=function(e){n&&(a=e,t(),e)&&i&&(i.disconnect(),r.disconnect(),i=void 0,r=void 0)},e.stop=t,e.frequency=function(){return s},e.tone=function(e){if(!(a||e<0)){s=e;var t=n=n||function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}();if(t)try{i||((i=t.createOscillator()).type="triangle",(r=t.createGain()).gain.value=0,r.connect(t.destination),i.connect(r),i.start(0)),i.frequency.linearRampToValueAtTime(e,n.currentTime),r.gain.setTargetAtTime(.2,n.currentTime,.015)}catch(e){i=void 0}}}}}(pxt=pxt||{}),function(a){{var r=a.auth||(a.auth={});const l="auth",c="csrf-token",u="login-state",d="user-state";let e,t=!1,n=(r.DEFAULT_USER_PREFERENCES=()=>({highContrast:!1,language:a.appTarget.appTheme.defaultLocale,reader:"",skillmap:{mapProgress:{},completedTags:{}}}),r.client=function(){return e},0),i=0;r.AuthClient=class{constructor(){this.initialUserPreferences_=void 0,this.initialAuthCheck_=void 0,a.Util.assert(!e),e=this}async initAsync(){try{this.state$=await a.storage.shared.getAsync(l,d)}catch(e){}this.state$||(this.state$={}),this.setUserProfileAsync(this.state$.profile),this.setUserPreferencesAsync(this.state$.preferences)}async loginAsync(e,t,n){var i,r;o()&&(i=e,0<s().filter(e=>e.id===i).length)&&(n=null!=n?n:h,(r=this.getState()).profile||await this.authCheckAsync(),(null==(r=r.profile)?void 0:r.idp)===e?a.debug(`loginAsync: Already signed into ${e}.`):(this.clearState(),r={key:(Math.PI*Math.random()).toString(36).slice(2),callbackState:n,callbackPathname:window.location.pathname,idp:e},await a.storage.shared.setAsync(l,u,r),n=a.Util.stringifyQueryString("/api/auth/login",{response_type:"token",provider:e,persistent:t,redirect_uri:""+window.location.origin+window.location.pathname+"?authcallback=1&state="+r.key}),(t=await this.apiAsync(n)).success?(a.tickEvent("auth.login.start",{provider:e}),window.location.href=t.resp.loginUrl):await this.onSignInFailed()))}async logoutAsync(e){o()&&(a.tickEvent("auth.logout"),await this.apiAsync("/api/auth/logout"),await a.storage.shared.delAsync(l,c),this.clearState(),e=e?e.startsWith("#")?e:"#"+e:"",a.BrowserUtils.hasWindow())&&(window.location.href=""+window.location.origin+window.location.pathname+e,location.reload())}async deleteProfileAsync(){var e;if(await this.loggedInAsync()){var t=null==(e=this.getState().profile)?void 0:e.id,n=await this.apiAsync("/api/user",null,"DELETE");if(n.err)await this.onApiError(n.err);else try{await a.storage.shared.delAsync(l,c);try{await this.onProfileDeleted(t)}catch(e){a.tickEvent("auth.profile.cloudToLocalFailed")}this.clearState()}finally{a.tickEvent("auth.profile.deleted")}}}async initialUserPreferencesAsync(){if(await this.loggedInAsync())return this.initialUserPreferences_||(this.initialUserPreferences_=this.fetchUserPreferencesAsync()),this.initialUserPreferences_}async userProfileAsync(){var e;if(await this.loggedInAsync())return e=this.getState(),Object.assign({},e.profile)}async userPreferencesAsync(){var e=this.getState();return Object.assign({},e.preferences)}async authCheckAsync(){var e,t;if(o()&&await a.storage.shared.getAsync(l,c))return null!=(e=(t=this.getState()).profile)&&e.id?this.initialAuthCheck_||(this.initialAuthCheck_=Promise.resolve(t.profile)):this.initialAuthCheck_||(this.initialAuthCheck_=this.fetchUserAsync()),this.initialAuthCheck_}async loggedInAsync(){return await this.authCheckAsync(),this.hasUserId()}async updateUserProfileAsync(e){var t;return!!await this.loggedInAsync()&&(t=this.getState(),(t=await this.apiAsync("/api/user/profile",{id:t.profile.id,username:e.username,avatarUrl:e.avatarUrl})).success&&await this.setUserProfileAsync(t.resp),t.success)}async patchUserPreferencesAsync(t){var e;(t=Array.isArray(t)?t:[t]).length&&(e=await this.userPreferencesAsync(),ts.pxtc.jsonPatch.patchInPlace(e,t),await this.setUserPreferencesAsync(e),await this.loggedInAsync())&&(clearTimeout(n),e=async()=>{i=0;var e=await this.apiAsync("/api/user/preferences",t,"PATCH");e.success?(a.debug("Updating local user preferences w/ cloud data after result of POST"),this.setUserPreferencesAsync(e.resp)):a.reportError("identity","update preferences failed",e)},i=i||a.U.now(),3e4<a.U.now()-i?await e():n=setTimeout(e,5e3))}hasUserId(){var e;return!!o()&&!(null==(e=this.getState().profile)||!e.id)}async fetchUserAsync(){var e;if(o()){var t=this.getState();if(null!=(e=t.profile)&&e.id)return t.profile;t=await this.apiAsync("/api/user/profile");if(t.success){const e=t.resp;return await this.setUserProfileAsync(e),e}}}async setUserProfileAsync(e){var t=this.hasUserId(),e=(this.transformUserProfile(e),this.hasUserId());this.onUserProfileChanged(),e&&!t?await this.onSignedIn():!e&&t&&await this.onSignedOut()}async setUserPreferencesAsync(e){var t=null!=(t=this.getState().preferences)?t:r.DEFAULT_USER_PREFERENCES(),n=ts.pxtc.jsonPatch.diff(t,e);this.transformUserPreferences(Object.assign(Object.assign({},t),e)),await this.onUserPreferencesChanged(n)}async fetchUserPreferencesAsync(){var e,t;if(await this.loggedInAsync())return e=this.getState(),(t=await this.apiAsync("/api/user/preferences")).success&&t.resp?(this.setUserPreferencesAsync(t.resp),e.preferences):void 0}transformUserProfile(e){this.state$=Object.assign(Object.assign({},this.state$),{profile:Object.assign({},e)}),this.saveState()}transformUserPreferences(e){this.state$=Object.assign(Object.assign({},this.state$),{preferences:Object.assign({},e)}),this.saveState()}getState(){return this.state$}saveState(){a.storage.shared.setAsync(l,d,this.state$).then(()=>{})}clearState(){this.state$={},a.storage.shared.delAsync(l,d).then(()=>this.onStateCleared())}async apiAsync(t,e,n){var i={},r=await a.storage.shared.getAsync(l,c);return r&&(i.authorization="mkcd "+r),i["x-pxt-target"]=null==(r=a.appTarget)?void 0:r.id,t=a.BrowserUtils.isLocalHostDev()?"https://staging.pxt.io"+t:t,a.Util.requestAsync({url:t,headers:i,data:e,method:n||(e?"POST":"GET"),withCredentials:!0}).then(e=>({statusCode:e.statusCode,resp:e.json,success:2===Math.floor(e.statusCode/100),err:null})).catch(async e=>(/logout/.test(t)||401!=e.statusCode||await this.logoutAsync(),{statusCode:e.statusCode,err:e,resp:null,success:!1}))}};const h={hash:"",params:{}};function s(){var e;return Object.keys((null==(e=null==(e=a.appTarget)?void 0:e.cloud)?void 0:e.cloudProviders)||{}).map(e=>a.appTarget.cloud.cloudProviders[e]).filter(e=>e.identity).sort((e,t)=>e.order-t.order)}function o(){return!t&&!a.BrowserUtils.isPxtElectron()&&0<s().length}r.loginCallbackAsync=async function(e){let t,n=Object.assign({},h);do{if(!(t=await a.storage.shared.getAsync(l,u)))return void a.debug("Auth state not found in storge.");await a.storage.shared.delAsync(l,u);const i=e.state;if(!i||t.key!==i)return void a.debug("Failed to get auth state for key");n=Object.assign(Object.assign({},h),t.callbackState);const r=e.error;if(r){const l=e.error_description;a.tickEvent("auth.login.error",{error:r,provider:t.idp}),a.log(`Auth failed: ${r}:`+l),n=Object.assign({},h);break}const s=e.token;if(!s){a.debug("Missing authToken in auth callback.");break}await a.storage.shared.setAsync(l,c,s),a.tickEvent("auth.login.success",{provider:t.idp})}while(0);const i=n.hash.startsWith("#")?n.hash:"#"+n.hash,r=a.Util.stringifyQueryString("",n.params),s=""+(t.callbackPathname.startsWith("/")?t.callbackPathname:"/"+t.callbackPathname)+i+r;window.location.href=s},r.identityProviders=s,r.identityProvider=function(t){return s().filter(e=>e.id===t).shift()},r.hasIdentity=o,r.enableAuth=function(e=!0){t=!e},r.userName=function(e){var t;return null!=(e=null!=(t=null==(t=null==e?void 0:e.idp)?void 0:t.displayName)?t:null==(t=null==e?void 0:e.idp)?void 0:t.username)?e:"??"},r.userInitials=function(e){e=a.auth.userName(e);return ts.pxtc.Util.initials(e)},r.generateUserProfilePicDataUrl=function(e){var t,n;if(null!=(n=null==(t=null==e?void 0:e.idp)?void 0:t.picture)&&n.encoded){const t=window.URL||window.webkitURL;try{const n=a.Util.stringToUint8Array(atob(e.idp.picture.encoded)),i=new Blob([n],{type:e.idp.picture.mimeType});e.idp.picture.dataUrl=t.createObjectURL(i)}catch(e){}}}}}(pxt=pxt||{}),(pxt||(pxt={})).tickEvent=function(e){},function(e){(e.pxtc||(e.pxtc={})).__dummy=42}(ts=ts||{}),ts.pxtc),ts,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,ts,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,ts,pxt,pxt,pxt,pxt,ts,pxt,ts,pxtmelody,pxtmelody,pxtmelody,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxt,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(r){r=r.pxtc||(r.pxtc={});{var o=r.Util||(r.Util={});function s(e){return e.replace(/[^\w .!?\-$]/g,e=>{e=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-e.length)+e})}o.assert=function(e,t="Assertion failed"){if(!e)throw new Error(t)},o.flatClone=function(t){if(null==t)return null;let n={};return Object.keys(t).forEach(e=>{n[e]=t[e]}),n},o.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},o.htmlEscape=function(e){return e&&e.replace(/([^\w .!?\-$])/g,e=>"&#"+e.charCodeAt(0)+";")},o.htmlUnescape=function(e){return e&&e.replace(/(&#\d+;)/g,e=>String.fromCharCode(Number(e.substr(2,e.length-3))))},o.jsStringQuote=s,o.jsStringLiteral=function(e){return'"'+s(e)+'"'},o.initials=function(e){return(/^\w+@/.test(e)?e.match(/^\w\w/).shift():((e=e.match(/\b\w/g)||[]).shift()||"")+(e.pop()||"")).toUpperCase()};let t="en",n={},e={},i=!1;function a(){return t}function l(e){var t=/^(\w{2})-(\w{2}$)/i.exec(e);return t&&t[1]&&t[2]?[t[1].toLowerCase()+"-"+t[2].toUpperCase(),t[1].toLowerCase(),t[1].toLowerCase()+"-"+t[2].toLowerCase()]:[(e||"en").toLowerCase()]}function c(e,i){return 0==i.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){let r=i[parseInt(t)],s="",a=/^:f(\d*)\.(\d+)/.exec(n);if(a){let e=parseInt(a[2]),t=parseInt(a[1])||0,n=/^0/.test(a[1])?"0":" ",i=r.toFixed(e);if(0<t&&0<e&&(t+=e+1),0<t)for(;i.length<t;)i=n+i;s=i}else s=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(s.toLowerCase())?s="an "+s:/^\s*[bcdfgjklmnpqrstvwxz]/.test(s.toLowerCase())&&(s="a "+s):":s"==n?s=1==r?"":"s":":q"==n?s=o.htmlEscape(s):":jq"==n?s=o.jsStringQuote(s):":uri"==n?s=encodeURIComponent(s).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?s=encodeURI(s).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(s=(100*r).toFixed(1).toString()+"%"),s})}o.enableLiveLocalizationUpdates=function(){i=!0},o.liveLocalizationEnabled=function(){return i},o.localeInfo=function(){return(i?"live-":"")+t},o.userLanguage=a,o.normalizeLanguageCode=l,o.setUserLanguage=function(e){t=l(e)[0]},o.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(t)},o.TRANSLATION_LOCALE="pxt",o.isTranslationMode=function(){return t==o.TRANSLATION_LOCALE},o._localize=function(e){return n[e]||e},o.getLocalizedStrings=function(){return n},o.setLocalizedStrings=function(e){n=e},o.translationsCache=function(){return e},o.fmt_va=c,o.fmt=function(e,...t){return c(e,t)};const d={};function u(e,t){if(!e)return e;d[e]=(d[e]||0)+1;let n=o._localize(e);return c(n=n.replace(/^\{(id|loc):[^\}]+\}/g,""),t)}o.dumpLocStats=function(){const t={};Object.keys(d).sort((e,t)=>d[t]-d[e]).forEach(e=>t[e]=e),console.log("prioritized list of strings:"),console.log(JSON.stringify(t,null,2))},o.lf_va=u,o.lf=function(e,...t){return u(e,t)},o.rlf=function(e,...t){return u(e,t)},o.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},o.isoTime=function(e){e=new Date(1e3*e);return o.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())},o.userError=function(e){e=new Error(e);throw e.isUserError=!0,e},o.deq=function t(n,i){if(n!==i){if(!n||!i)return"Null value";if("object"!=typeof n||"object"!=typeof i)return"Unable to compare "+n+", "+i;if(Array.isArray(n)){if(!Array.isArray(i))return"Expected array";if(n.length!=i.length)return"Expected array of length "+n.length+", got "+i.length;for(let e=0;e<n.length;e++)if(null!=t(n[e],i[e]))return"Expected array value "+n[e]+" got "+i[e]}else{var r=Object.keys(n),e=Object.keys(n);if(r.length!=e.length)return"Expected "+r.length+" keys, got "+e.length;for(let e=0;e<r.length;e++){if(!Object.prototype.hasOwnProperty.call(i,r[e]))return"Missing key "+r[e];if(null!=t(n[r[e]],i[r[e]]))return"Expected value of "+r[e]+" to be "+n[r[e]]+", got "+i[r[e]]}}}return null}}}(ts=ts||{});const lf=ts.pxtc.Util.lf;!function(e){(e=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},e.encodeBase64=function(e){return btoa(e)}}(ts=ts||{}),function(l){var h=l.pxtc||(l.pxtc={});{var e,f=h.Util||(h.Util={});function i(t,n){if(n)for(let e=0;e<n.length;++e)t.push(n[e])}function t(t){var n=[];for(let e=0;e<t.length;++e)i(n,t[e]);return n}function r(e){return e&&"object"==typeof e&&!Array.isArray(e)}function a(t,n,i,r,s){void 0===r&&(r=0),void 0===s&&(s=i.length-r);for(let e=0;e<s;++e)t[n+e]=i[r+e]}function s(e,t){return e==t?0:e<t?-1:1}f.CancellationToken=class{constructor(){this.pending=!1,this.cancelled=!1}startOperation(){this.pending=!0}isRunning(){return this.pending}onProgress(e){this.progressHandler=e}reportProgress(e,t){this.progressHandler&&this.progressHandler(e,t)}cancel(){this.cancelled=!0,this.pending=!1}cancelAsync(){return this.cancelled||!this.pending?(this.cancelled=!0,this.pending=!1,Promise.resolve()):(this.cancelled=!0,this.deferred=new Promise(e=>{this.resolve=e}),this.deferred)}isCancelled(){return this.cancelled}throwIfCancelled(){if(this.isCancelled())throw new Error}resolveCancel(){this.pending=!1,this.deferred&&(this.resolve(),this.deferred=void 0,this.resolve=void 0)}},f.codalHash16=function(e){const r=[251,175,119,215,81,14,79,191,103,49,181,143,186,157,0,232,31,32,55,60,152,58,17,237,174,70,160,144,220,90,57,223,59,3,18,140,111,166,203,196,134,243,124,95,222,179,197,65,180,48,36,15,107,46,233,130,165,30,123,161,209,23,97,16,40,91,219,61,100,10,210,109,250,127,22,138,29,108,244,67,207,9,178,204,74,98,126,249,167,116,34,77,193,200,121,5,20,113,71,35,128,13,182,94,25,226,227,199,75,27,41,245,230,224,43,225,177,26,155,150,212,142,218,115,241,73,88,105,39,114,62,255,192,201,145,214,168,158,221,148,154,122,12,84,82,163,44,139,228,236,205,242,217,11,187,146,159,64,86,239,195,42,106,198,118,112,184,172,87,2,173,117,176,229,247,253,137,185,99,164,102,147,45,66,231,52,141,211,194,206,246,238,56,110,78,248,63,240,189,93,92,51,53,183,19,171,72,50,33,104,101,69,8,252,83,120,76,135,85,54,202,125,188,213,96,235,136,208,162,129,190,132,156,38,47,1,7,254,24,4,216,131,89,21,28,133,37,153,149,80,170,68,6,169,234,151];if(e){var n,i=e,s=new Uint8Array(i.length);for(let e=0;e<i.length;++e){const a=i.charCodeAt(e);s[e]=255&a}let t=0;for(let e=0;e<2;++e)n=function(t){let n=0;for(let e=0;e<t.length;e++){var i=t[e];n=r[n^i]}return n}(s),t|=n<<8*e,s[0]=(s[0]+1)%255;return t}return 0},f.bufferSerial=function(t,n="",i="?",r=255){for(let e=0;e<n.length;++e){var s=n[e];t[i]=(t[i]||"")+s,("\n"===s||t[i].length>r)&&(s=t[i],t[i]="",window.postMessage({type:"serial",id:i,data:s},"*"))}},f.blobReadAsDataURL=function(i){return i?new Promise((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=e=>t(e),n.readAsDataURL(i)}):Promise.resolve(void 0)},f.fileReadAsBufferAsync=function(i){return i?new Promise((t,e)=>{let n=new FileReader;n.onerror=e=>t(null),n.onload=e=>t(new Uint8Array(n.result)),n.readAsArrayBuffer(i)}):Promise.resolve(null)},f.fileReadAsTextAsync=function(i){return i?new Promise((t,e)=>{let n=new FileReader;n.onerror=e=>t(null),n.onload=e=>t(n.result),n.readAsText(i)}):Promise.resolve(null)},f.repeatMap=function(t,n){t=t||0;var i=[];for(let e=0;e<t;++e)i.push(n(e));return i},f.listsEqual=function(t,n){if(!t||!n||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0},f.oops=function(e="OOPS"){throw new Error(e)},f.reversed=function(e){return(e=e.slice(0)).reverse(),e},f.iterMap=function(t,n){Object.keys(t).forEach(e=>n(e,t[e]))},f.mapMap=function(t,n){let i={};return Object.keys(t).forEach(e=>i[e]=n(e,t[e])),i},f.values=function(t){return Object.keys(t||{}).map(e=>t[e])},f.pushRange=i,f.concatArrayLike=t,f.concat=t,f.memcpy=a,f.uint8ArrayConcat=function(e){let t=0;for(var n of e)t+=n.length;let i=new Uint8Array(t),r=0;for(var s of e)a(i,r,s),r+=s.length;return i},f.jsonTryParse=function(e){try{return JSON.parse(e)}catch(e){}},f.jsonMergeFrom=function t(n,i){i&&Object.keys(i).forEach(e=>{r(n[e])&&r(i[e])?t(n[e],i[e]):n[e]=f.clone(i[e])})},f.jsonCopyFrom=function(e,t){var n,i=f.clone(t);for(n of Object.keys(t))e[n]=i[n]},f.jsonFlatten=function(e){let i={},r=(e,t)=>{if(null!==t&&"object"==typeof t){f.assert(!Array.isArray(t)),e&&(e+=".");for(var n of Object.keys(t))r(e+n,t[n])}else i[e]=t};return r("",e),i},f.jsonUnFlatten=function(i){var r,e={};for(r of Object.keys(i)){let t=e,n=r.split(".");for(let e=0;e<n.length;++e){var s=n[e];e==n.length-1?t[s]=i[r]:("object"!=typeof t[s]&&(t[s]={}),t=t[s])}}return e},f.strcmp=s,f.stringMapEq=function(e,t){var n,i=Object.keys(e),r=Object.keys(t);if(i.length!=r.length)return!1;for(n of i){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n])return!1}return!0},f.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},f.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},f.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},f.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},f.snakify=function(n){const i=n.toUpperCase(),t=n.toLowerCase();if(n==i||n==t)return n;if(0<n.lastIndexOf("_"))return n;var r,s=e=>n[e]!=t[e];let a="",o=0;for(;o<n.length;){let e=s(o),t=o;for(;t<n.length;){if(e&&(r=t,n[r]!=i[r])){if(2<t-o){t--;break}e=!1}if(!e&&s(t))break;t++}a&&(a+="_"),a+=n.slice(o,t),o=t}return a.toUpperCase()===a?a:a.toLowerCase()},f.sortObjectFields=function(t){var e=Object.keys(t);e.sort(s);let n={};return e.forEach(e=>n[e]=t[e]),n},f.chopArray=function(t,n){var i=[];for(let e=0;e<t.length;e+=n)i.push(t.slice(e,e+n));return i},f.unique=function(e,n){let i=[],r={};return e.forEach(e=>{var t=n(e);r.hasOwnProperty(t)||(r[t]=null,i.push(e))}),i},f.groupBy=function(e,n){let i={};return e.forEach(e=>{var t=n(e);i.hasOwnProperty(t)||(i[t]=[]),i[t].push(e)}),i},f.toDictionary=function(e,t){let n={};return e.forEach(e=>{n[t(e)]=e}),n},f.toSet=function(e,t){let n={};return e.forEach(e=>{n[t(e)]=!0}),n},f.toArray=function(t){if(Array.isArray(t))return t;var n=[];if(t)for(let e=0;e<t.length;++e)n.push(t[e]);return n},f.indexOfMatching=function(t,n){for(let e=0;e<t.length;++e)if(n(t[e]))return e;return-1};const T=Promise.resolve();async function n(t,n,i){let r=0;const s=[],a=[];for(let e=0;e<t;e++){const t=(async()=>{for(;r<n.length;){var e=r++,t=n[e];a[e]=await i(t)}})();s.push(t)}try{await Promise.all(s)}catch(t){throw r=n.length,t}return a}function o(n,i){const r={};return e=>{var t=n(e);return r.hasOwnProperty(t)?r[t]:r[t]=i(e)}}function c(e){return e=e&&e.replace(/\\/g,"/")}function u(n){return f.httpRequestCoreAsync(n).then(e=>{const t=e.statusCode;if((n.successCodes||[304,200,201,202]).indexOf(t)<0&&!n.allowHttpErrors){const h=f.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,n.url,(e.text||"").slice(0,500)),t=new Error(h);return t.statusCode=e.statusCode,Promise.reject(t)}return e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=h.U.jsonTryParse(e.text)),e})}function p(n,i){let r="";if(n)for(let t=0;t<n.length;++t){let e=n.charCodeAt(t);var s;e<=127?r+=n.charAt(t):e<=2047?r+=String.fromCharCode(192|e>>6,128|63&e):(!i&&55296<=e&&e<=56319&&(s=n.charCodeAt(++t),isNaN(s)||(e=65536+(e-55296<<10)+(s-56320))),r+=e<=65535?String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e):String.fromCharCode(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return r}function m(){return Date.now()}function g(){var e=new Uint8Array(4);return f.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function b(r,s,a,o){function t(n){pxt.debug(`downloading translations for ${r} ${s} `+(a||""));let e=pxt.BrowserUtils.isLocalHost()||pxt.webConfig.isStatic?"https://makecode.com/api/":"",t=e+`translations?lang=${encodeURIComponent(r)}&filename=${encodeURIComponent(s)}&approved=true`;a&&(t+="&branch="+encodeURIComponent(a));var i={};return o&&!pxt.Cloud.useCdnApi()&&(i["If-None-Match"]=o),(e?u:pxt.Cloud.apiRequestWithCdnAsync)({url:t,headers:i}).then(t=>304==t.statusCode||200==t.statusCode?(o=t.headers.etag||"",pxt.BrowserUtils.translationDbAsync().then(e=>e.setAsync(r,s,a,o,t.json||n)).then(()=>t.json||n)):t.json,e=>{console.log("failed to load translations from "+t)})}return pxt.BrowserUtils.translationDbAsync().then(e=>e.getAsync(r,s,a)).then(e=>e?(o=e.etag,300<(Date.now()-e.time)/1e3&&t(e.strings),e.strings):t())}function v(e){var[e,t]=f.normalizeLanguageCode(e),n=pxt.appTarget.appTheme;if(n&&n.availableLocales){if(-1<n.availableLocales.indexOf(e))return!0;if(t&&-1<n.availableLocales.indexOf(t))return!0}return!1}f.nextTick=function(e){T.then(e)},f.delay=async function(t,e){e=await e;return await new Promise(e=>setTimeout(()=>e(),t)),e},f.promiseMapAll=function(e,t){return Promise.all(e.map(e=>t(e)))},f.promiseMapAllSeries=function(e,t){return n(1,e,t)},f.promisePoolAsync=n,f.memoizeString=function(e){return o(e=>e,e)},f.promiseTimeout=async function(n,e,i){let r,s;var t=new Promise((e,t)=>{s=e,r=setTimeout(()=>{s=void 0,clearTimeout(r),t(i||`Promise timed out after ${n}ms`)},n)});return Promise.race([e,t]).then(e=>(s&&(clearTimeout(r),s()),e))},f.defer=function(){let i,n,r,e=!1;return{resolve:function(t){e?pxt.debug("Deferred promise already resolved"):(n?n(t):i=i||new Promise(function(e){e(t)}),e=!0)},reject:function(n){e?pxt.debug("Deferred promise already resolved"):(r?r(n):i=i||new Promise(function(e,t){t(n)}),e=!0)},promise:new Promise(function(e,t){i?e(i):(n=e,r=t)})}},f.memoize=o,f.debounce=function(i,r,s){let a;return function(){let e=this,t=arguments,n=s&&!a;return clearTimeout(a),a=setTimeout(function(){a=null,s||i.apply(e,t)},r),n&&i.apply(e,t),a}},f.AdaptiveDebouncer=class{constructor(e,t=300,n=2e3,i=2){this.func=e,this.minDelay=t,this.maxDelay=n,this.slowdownFactor=i,this.lastPoke=0,this.recentGaps=[],this.wrapped=()=>{this.timeout=null,this.func()}}poke(){var e=Date.now();if(this.lastPoke){var t=e-this.lastPoke;if(t<10)return;for(t<4e3&&this.recentGaps.push(t);10<this.recentGaps.length;)this.recentGaps.shift()}this.lastPoke=e}trigger(){let e=this.maxDelay;var t;this.lastPoke&&((t=this.recentGaps.slice()).sort(),t=t[t.length>>1]||1,e=Math.min(Math.max(t*this.slowdownFactor|0,this.minDelay),this.maxDelay),(e-=Date.now()-this.lastPoke)<0&&(e=0),this.lastPoke=null),clearTimeout(this.timeout),this.timeout=setTimeout(this.wrapped,e)}},f.throttle=function(i,r,s){let a;return function(){let e=this,t=arguments,n=s&&!a;a=a||setTimeout(function(){a=null,s||i.apply(e,t)},r),n&&i.apply(e,t)}},f.randomPermute=function(t){for(let e=0;e<t.length;++e){var n=g()%t.length,i=t[e];t[e]=t[n],t[n]=i}},f.randomPick=function(e){return 0==e.length?null:e[g()%e.length]},f.timeSince=function(e){let t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?f.lf("in a few seconds"):t<120?f.lf("in a minute"):t<3600?f.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?f.lf("in an hour"):t<86400?f.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?f.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?f.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):f.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?f.lf("now"):t<10?f.lf("a few seconds ago"):t<60?f.lf("{0} second{0:s} ago",Math.floor(t)):t<120?f.lf("a minute ago"):t<3600?f.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?f.lf("an hour ago"):t<86400?f.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?f.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?f.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):f.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},f.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},f.escapeForRegex=function(e){return null==e?void 0:e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},f.stripUrlProtocol=function(e){return null==e?void 0:e.replace(/.*?:\/\//g,"")},f.normalizePath=c,f.pathJoin=function(e,t){if(c(e),c(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),e+(t="/"==t.charAt(0)?t.substring(1):t)):e:t},f.isNodeJS="undefined"==typeof window,f.requestAsync=u,f.httpGetTextAsync=function(e){return u({url:e}).then(e=>e.text)},f.httpGetJsonAsync=function(e){return u({url:e}).then(e=>e.json)},f.httpPostJsonAsync=function(e,t){return u({url:e,data:t||{}}).then(e=>e.json)},f.stringToUint8Array=function(t){var n=t.length,i=new Uint8Array(n);for(let e=0;e<n;++e)i[e]=255&t.charCodeAt(e);return i},f.uint8ArrayToString=function(t){let n=t.length,i="";for(let e=0;e<n;++e)i+=String.fromCharCode(t[e]);return i},f.fromUTF8=function(t){if(!t)return"";let n="";for(let e=0;e<t.length;++e){var i=255&t.charCodeAt(e);n+=37==i||127<i?"%"+i.toString(16):t.charAt(e)}return decodeURIComponent(n)},f.toUTF8=p,f.toHex=function(t){let n="";for(let e=0;e<t.length;++e)n+=("0"+t[e].toString(16)).slice(-2);return n},f.fromHex=function(t){var n=new Uint8Array(t.length>>1);for(let e=0;e<t.length;e+=2)n[e>>1]=parseInt(t.slice(e,e+2),16);return n},f.PromiseQueue=class{constructor(){this.promises={}}enqueue(i,r){return new Promise((e,t)=>{let n=this.promises[i];(n=n||(this.promises[i]=[])).push(()=>r().finally(()=>{n.shift(),0==n.length?delete this.promises[i]:n[0]()}).then(e,t)),1==n.length&&n[0]()})}};let d;function y(e,n,i,r,s,t,a){if(a=a||d.Editor,"en-US"===(i=f.normalizeLanguageCode(i)[0])||"en"===i)return Promise.resolve(void 0);let o,l,c=i+`/${t}/`+a;if(f.translationsCache()[c])return Promise.resolve(f.translationsCache()[c]);switch(a){case d.Editor:o=[{branch:r,staticName:"strings.json",path:"strings.json"},{branch:s,staticName:"target-strings.json",path:e+"/target-strings.json"}];break;case d.Sim:o=[{branch:s,staticName:"sim-strings.json",path:e+"/sim-strings.json"}];break;case d.Apis:o=[{branch:s,staticName:"bundled-strings.json",path:e+"/bundled-strings.json"}];break;case d.SkillMap:o=[{branch:s,staticName:"skillmap-strings.json",path:"/skillmap-strings.json"}]}function u(t){t&&(l=l||{},Object.keys(t).filter(e=>!!t[e]).forEach(e=>l[e]=t[e]))}if(t){let t=0;return h.U.promiseMapAllSeries(o,e=>b(i,e.path,e.branch).then(u,e=>{console.log(e.message),++t})).then(()=>(t&&(f.translationsCache()[c]=l),t!==o.length&&l?Promise.resolve(l):(pxt.tickEvent("translations.livetranslationsfailed"),y(e,n,i,r,s,!1,a))))}return Promise.all(o.map(e=>f.httpGetJsonAsync(n+`locales/${i}/`+e.staticName).catch(e=>{}))).then(e=>{let t={};e.forEach(e=>pxt.Util.jsonMergeFrom(t,e)),Object.keys(t).length&&(l=t,f.translationsCache()[c]=l)},e=>{console.error("failed to load localizations")}).then(()=>l)}function w(e){var t={};for(const n of Object.keys(e))t[n]=x(e[n]);return t}function x(e){var t;return{attributes:Object.assign({},e.attributes),parameters:null==(t=e.parameters)?void 0:t.map(k),extendsTypes:e.extendsTypes?[...e.extendsTypes]:void 0,pkgs:e.pkgs?[...e.pkgs]:void 0,combinedProperties:e.combinedProperties?[...e.combinedProperties]:void 0,name:e.name,namespace:e.namespace,fileName:e.fileName,kind:e.kind,retType:e.retType,isInstance:e.isInstance,isContextual:e.isContextual,qName:e.qName,pkg:e.pkg,snippet:e.snippet,snippetName:e.snippetName,snippetWithMarkers:e.snippetWithMarkers,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,pySnippetWithMarkers:e.pySnippetWithMarkers,blockFields:e.blockFields,isReadOnly:e.isReadOnly,pyName:e.pyName,pyQName:e.pyQName,snippetAddsDefinitions:e.snippetAddsDefinitions}}function k(e){var t;return{name:e.name,description:e.description,type:e.type,pyTypeString:e.pyTypeString,initializer:e.initializer,default:e.default,properties:null==(t=e.properties)?void 0:t.map(A),handlerParameters:null==(t=e.handlerParameters)?void 0:t.map(A),options:e.options?h.U.clone(e.options):void 0,isEnum:e.isEnum}}function A(e){return{name:e.name,type:e.type}}f.PromiseBuffer=class{constructor(){this.waiting=[],this.available=[]}drain(){for(var e of this.waiting)e(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]}pushError(e){this.push(e)}push(e){var t=this.waiting.shift();t?t(e):this.available.push(e)}shiftAsync(e=0){var t;return 0<this.available.length?(t=this.available.shift())instanceof Error?Promise.reject(t):Promise.resolve(t):new Promise((t,n)=>{let i=e=>{(e instanceof Error?n:t)(e)};this.waiting.push(i),0<e&&h.U.delay(e).then(()=>{var e=this.waiting.indexOf(i);0<=e&&(this.waiting.splice(e,1),n(new Error("Timeout")))})})}},f.now=m,f.nowSeconds=function(){return Math.round(m()/1e3)},f.timeout=function(t){return new Promise(e=>setTimeout(()=>e(),t))},f.cpuUs=()=>{const e="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now;return f.cpuUs=()=>1e3*e(),f.cpuUs()},f.getMime=function(e){e=/\.([a-zA-Z0-9]+)$/.exec(e);if(!e)return"application/octet-stream";switch(e[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},f.randomUint32=g,f.guidGen=function(){function e(){return(65536|g()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},f.downloadLiveTranslationsAsync=b,f.pxtLangCookieId="PXT_LANG",f.langCookieExpirationDays=30,f.allLanguages={af:{englishName:"Afrikaans",localizedName:"Afrikaans"},ar:{englishName:"Arabic",localizedName:"العربية"},az:{englishName:"Azerbaijani",localizedName:"آذربایجان دیلی"},bg:{englishName:"Bulgarian",localizedName:"български"},bn:{englishName:"Bengali",localizedName:"বাংলা"},ca:{englishName:"Catalan",localizedName:"Català"},cs:{englishName:"Czech",localizedName:"Čeština"},da:{englishName:"Danish",localizedName:"Dansk"},de:{englishName:"German",localizedName:"Deutsch"},el:{englishName:"Greek",localizedName:"Ελληνικά"},en:{englishName:"English",localizedName:"English"},"es-ES":{englishName:"Spanish (Spain)",localizedName:"Español (España)"},"es-MX":{englishName:"Spanish (Mexico)",localizedName:"Español (México)"},et:{englishName:"Estonian",localizedName:"Eesti"},eu:{englishName:"Basque",localizedName:"Euskara"},fa:{englishName:"Persian",localizedName:"فارسی"},fi:{englishName:"Finnish",localizedName:"Suomi"},fr:{englishName:"French",localizedName:"Français"},"fr-CA":{englishName:"French (Canada)",localizedName:"Français (Canada)"},"gu-IN":{englishName:"Gujarati",localizedName:"ગુજરાતી"},he:{englishName:"Hebrew",localizedName:"עברית"},hr:{englishName:"Croatian",localizedName:"Hrvatski"},hu:{englishName:"Hungarian",localizedName:"Magyar"},"hy-AM":{englishName:"Armenian (Armenia)",localizedName:"Հայերէն (Հայաստան)"},id:{englishName:"Indonesian",localizedName:"Bahasa Indonesia"},is:{englishName:"Icelandic",localizedName:"Íslenska"},it:{englishName:"Italian",localizedName:"Italiano"},ja:{englishName:"Japanese",localizedName:"日本語"},kab:{englishName:"Kabyle",localizedName:"شئعم"},ko:{englishName:"Korean",localizedName:"한국어"},kmr:{englishName:"Kurmanji (Kurdish)",localizedName:"کورمانجی‎"},kn:{englishName:"Kannada",localizedName:"ಕನ್ನಡ"},lt:{englishName:"Lithuanian",localizedName:"Lietuvių"},lv:{englishName:"Latvian",localizedName:"Latviešu"},"ml-IN":{englishName:"Malayalam",localizedName:"മലയാളം"},mr:{englishName:"Marathi",localizedName:"मराठी"},nl:{englishName:"Dutch",localizedName:"Nederlands"},no:{englishName:"Norwegian",localizedName:"Norsk"},nb:{englishName:"Norwegian Bokmal",localizedName:"Norsk bokmål"},"nn-NO":{englishName:"Norwegian Nynorsk",localizedName:"Norsk nynorsk"},"pa-IN":{englishName:"Punjabi",localizedName:"ਪੰਜਾਬੀ"},pl:{englishName:"Polish",localizedName:"Polski"},"pt-BR":{englishName:"Portuguese (Brazil)",localizedName:"Português (Brasil)"},"pt-PT":{englishName:"Portuguese (Portugal)",localizedName:"Português (Portugal)"},ro:{englishName:"Romanian",localizedName:"Română"},ru:{englishName:"Russian",localizedName:"Русский"},"si-LK":{englishName:"Sinhala (Sri Lanka)",localizedName:"සිංහල (ශ්රී ලංකා)"},sk:{englishName:"Slovak",localizedName:"Slovenčina"},sl:{englishName:"Slovenian",localizedName:"Slovenski"},sr:{englishName:"Serbian",localizedName:"Srpski"},su:{englishName:"Sundanese",localizedName:"ᮘᮞ ᮞᮥᮔ᮪ᮓ"},"sv-SE":{englishName:"Swedish (Sweden)",localizedName:"Svenska (Sverige)"},ta:{englishName:"Tamil",localizedName:"தமிழ்"},te:{englishName:"Telugu",localizedName:"తెలుగు"},th:{englishName:"Thai",localizedName:"ภาษาไทย"},tl:{englishName:"Tagalog",localizedName:"ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔"},tr:{englishName:"Turkish",localizedName:"Türkçe"},uk:{englishName:"Ukrainian",localizedName:"Українська"},"ur-IN":{englishName:"Urdu (India)",localizedName:"اردو (ہندوستان)"},"ur-PK":{englishName:"Urdu (Pakistan)",localizedName:"اردو (پاکستان)"},vi:{englishName:"Vietnamese",localizedName:"Tiếng việt"},"zh-CN":{englishName:"Chinese (Simplified)",localizedName:"简体中文"},"zh-TW":{englishName:"Chinese (Traditional)",localizedName:"繁體中文"}},f.isLocaleEnabled=v,f.updateLocalizationAsync=function(e){const{targetId:t,baseUrl:n,pxtBranch:i,targetBranch:r,force:s}=e;let a=e["code"];if((a="en-US"===(a=f.normalizeLanguageCode(a)[0])?"en":a)===f.userLanguage()||!v(a)&&!s)return pxt.debug(`loc: ${a} (using built-in)`),Promise.resolve();pxt.debug("loc: "+a);const o=pxt.Util.liveLocalizationEnabled();return y(t,n,a,i,r,o,l.pxtc.Util.TranslationsKind.Editor).then(e=>(e&&(f.setUserLanguage(a),f.setLocalizedStrings(e)),l.pxtc.Util.downloadTranslationsAsync(t,n,a,i,r,o,l.pxtc.Util.TranslationsKind.Apis).then(e=>{e&&(l.pxtc.apiLocalizationStrings=e)})))},(e=d=f.TranslationsKind||(f.TranslationsKind={}))[e.Editor=0]="Editor",e[e.Sim=1]="Sim",e[e.Apis=2]="Apis",e[e.SkillMap=3]="SkillMap",f.downloadTranslationsAsync=y,f.capitalize=function(e){return e&&e[0].toLocaleUpperCase()+e.slice(1)},f.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},f.range=function(t){var n=[];for(let e=0;e<t;++e)n.push(e);return n},f.multipartPostAsync=function(e,n={},t=null,i=null){const r="--------------------------0461489f461126c5";let s="";Object.keys(n).forEach(e=>{var t;t=n[e=e],s=(s+=r+"\r\n")+'Content-Disposition: form-data; name="'+e+'"\r\n\r\n'+t+"\r\n"}),t&&(i=i,a=(t=t).split("/").reverse()[0],s=(s=s+r+'\r\nContent-Disposition: form-data; name="files['+t+']"; filename="'+a+'"\r\n')+"\r\n"+i+"\r\n"),s+=r+"--\r\n";var a,t={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+r.slice(2)},data:s};return f.httpRequestCoreAsync(t)},f.toDataUri=function(e,t){return/^https?:/i.test(e)||/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?`data:${t},`+encodeURIComponent(e):`data:${t||"image/png"};base64,`+h.encodeBase64(p(e)))},f.imageMagic=1496611453,f.imageHeaderSize=36,f.encodeBlobAsync=function(e,t){var n=f.imageHeaderSize+t.length,i=3*(e.width*e.height-1);let r=1;for(;r<4&&!(i*r>=8*n);)r++;let s=i*r>>3,a=n-s,o=0,l=e.width*e.height*4;if(0<a){const t=3*e.width,f=(o=Math.ceil(a/t),document.createElement("canvas"));f.width=e.width,f.height=e.height+o,f.getContext("2d").drawImage(e,0,0),e=f}var c=pxt.HF2.encodeU32LE([f.imageMagic,t.length,o,0,0,0,0,0,0]);function u(n,i,r,s){let a=0,o=0,l=s[o++];var c=(1<<r)-1;let u=!0;for(;u;){let e=l>>a&c,t=8-a;if(t<=r){if(o>=s.length){if(0==t)break;u=!1}l=s[o++],e|=l<<t&c,a=r-t}else a+=r;n[i]=255&(n[i]&~c|e),3==(3&++i)&&(n[i++]=255)}return i}pxt.Util.assert(c.length==f.imageHeaderSize);var d=e.getContext("2d"),h=d.getImageData(0,0,e.width,e.height);u(h.data,0,1,[r]);let p=4;for(p=u(h.data,p,r,c),pxt.Util.assert(0==(3&p)),p=0==o?u(h.data,p,r,t):(c=s-c.length,p=u(h.data,p,r,t.slice(0,c)),u(h.data,l,8,t.slice(c))),p|=3;p<h.data.length;)h.data[p]=255,p+=4;return d.putImageData(h,0,0),e},f.decodeBlobAsync=function(e){return pxt.BrowserUtils.loadCanvasAsync(e).then(e=>{const o=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t=1&o[0]|(1&o[1])<<1|(1&o[2])<<2;if(5<t||0==t)return Promise.reject(new Error(f.lf("Invalid encoded PNG format")));function n(e,t,n){let i=0,r=0,s=0;for(var a=(1<<t)-1;r<n.length;)s|=(o[e++]&a)<<i,3==(3&e)&&e++,8<=(i+=t)&&(n[r++]=255&s,s>>=8,i-=8);return e}const i=new Uint8Array(pxt.Util.imageHeaderSize);var r=n(4,t,i),s=pxt.HF2.decodeU32LE(i);if(s[0]!=pxt.Util.imageMagic)return Promise.reject(new Error(f.lf("Invalid magic in encoded PNG")));var a=new Uint8Array(s[1]),s=s[2];if(0<s){const o=(e.height-s)*e.width,f=new Uint8Array((3*(o-1)*t>>3)-pxt.Util.imageHeaderSize),i=(n(r,t,f),a.set(f),new Uint8Array(a.length-f.length));n(4*o,8,i),a.set(i,f.length)}else n(r,t,a);return a})},f.parseQueryString=function(e){let i={};return e.replace(/\+/g," ").replace(/([^#?&=]+)=([^#?&=]*)/g,(e,t,n)=>(i[decodeURIComponent(t)]=decodeURIComponent(n),"")),i},f.stringifyQueryString=function(e,t){for(var n of Object.keys(t))0<=e.indexOf("?")?e+="&":e+="?",e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]);return e},f.cloneTargetBundle=function(e){const t=(e=Object.assign({},e)).apiInfo;delete e.apiInfo;var n=e.bundleddirs,i=(delete e.bundleddirs,e.bundledpkgs),r=(delete e.bundledpkgs,e.tutorialInfo),s=(delete e.tutorialInfo,f.clone(e));if(t){s.apiInfo={};for(const e of Object.keys(t)){const f=t[e].apis;s.apiInfo[e]={sha:t[e].sha,apis:{jres:Object.assign({},f.jres),byQName:w(f.byQName)}}}}if(n&&(s.bundleddirs=[...n]),i){s.bundledpkgs={};for(const e of Object.keys(i))s.bundledpkgs[e]=Object.assign({},i[e])}if(r){s.tutorialInfo={};for(const e of Object.keys(r)){const t=r[e];s.tutorialInfo[e]={hash:t.hash,usedBlocks:Object.assign({},t.usedBlocks),snippetBlocks:Object.assign({},t.snippetBlocks)}}}return s},f.cloneApis=w,f.cloneSymbolInfo=x,f.toUTF8Array=function(e){return(new TextEncoder).encode(e)},f.fromUTF8Array=function(e){return(new TextDecoder).decode(e)}}}(ts=ts||{}),function(e){var b=e.pxtc||(e.pxtc={});{e=b.BrowserImpl||(b.BrowserImpl={});b.Util.httpRequestCoreAsync=function(l){return new Promise((e,t)=>{let n,i=!1,r=b.Util.clone(l.headers)||{};n=new XMLHttpRequest,l.responseArrayBuffer&&(n.responseType="arraybuffer"),l.withCredentials&&(n.withCredentials=!0),n.onreadystatechange=()=>{if(!i&&4==n.readyState){i=!0;let t={statusCode:n.status,headers:{},buffer:n.responseBody||n.response,text:l.responseArrayBuffer?void 0:n.responseText};n.getAllResponseHeaders().split(/\r?\n/).forEach(e=>{e=/^\s*([^:]+): (.*)/.exec(e);e&&(t.headers[e[1].toLowerCase()]=e[2])}),e(t)}};let s,a=l.data,o=l.method||(null==a?"GET":"POST");null==a?s=null:a instanceof Uint8Array?s=a:"object"==typeof a?(s=JSON.stringify(a),r["content-type"]="application/json; charset=utf8"):"string"==typeof a?s=a:b.Util.oops("bad data"),n.open(o,l.url),Object.keys(r).forEach(e=>{n.setRequestHeader(e,r[e])}),null==s?n.send():n.send(s)})},b.Util.sha256=n,b.Util.getRandomBuf=t=>{if(window.crypto)window.crypto.getRandomValues(t);else for(let e=0;e<t.length;++e)t[e]=Math.floor(255*Math.random())};const y=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function v(e,t){return e>>>t|e<<32-t}function t(e){let m=new Uint32Array(8),g=(m[0]=1779033703,m[1]=3144134277,m[2]=1013904242,m[3]=2773480762,m[4]=1359893119,m[5]=2600822924,m[6]=528734635,m[7]=1541459225,new Uint32Array(64));function t(n){var e=n.length-63;for(let t=0;t<e;t+=64){for(let e=0;e<16;e++){var i=(e<<2)+t;g[e]=n[i]<<24|n[i+1]<<16|n[i+2]<<8|n[i+3]}{c=void 0;u=void 0;d=void 0;h=void 0;p=void 0;f=void 0;var c=m;var u=g;b.Util.assert(8==c.length),b.Util.assert(64==u.length);for(let e=16;e<64;++e){var d=v(u[e-15],7)^v(u[e-15],18)^u[e-15]>>>3,h=v(u[e-2],17)^v(u[e-2],19)^u[e-2]>>>10;u[e]=u[e-16]+d+u[e-7]+h|0}let t=c[0],n=c[1],i=c[2],r=c[3],s=c[4],a=c[5],o=c[6],l=c[7];for(let e=0;e<64;++e){var p=l+(v(s,6)^v(s,11)^v(s,25))+(s&a^~s&o)+y[e]+u[e]|0,f=t&n^t&i^n&i;l=o,o=a,a=s,s=r+p|0,r=i,i=n,t=p+((v(n=t,2)^v(t,13)^v(t,22))+f|0)|0}c[0]+=t,c[1]+=n,c[2]+=i,c[3]+=r,c[4]+=s,c[5]+=a,c[6]+=o,c[7]+=l}}}t(e);let n=64-(e.length+9)%64,i=(64==n&&(n=0),e.length-e.length%64),r=new Uint8Array(e.length-i+1+n+8),s=0;for(;i<e.length;)r[s++]=e[i++];for(r[s++]=128;0<n--;)r[s++]=0;let a=8*e.length;for(s=r.length;0<a;)r[--s]=255&a,a>>=8;t(r);let o="";for(let e=0;e<m.length;++e)o+=("000000000"+m[e].toString(16)).slice(-8);return o.toLowerCase()}function n(e){pxt.perf.measureStart("sha256buffer");e=t(b.Util.toUTF8Array(e));return pxt.perf.measureEnd("sha256buffer"),e}e.sha256buffer=t,e.sha256string=n}}(ts=ts||{}),function(e){e=e.pxtc||(e.pxtc={});{e=e.jsonPatch||(e.jsonPatch={});const o={add:(e,t,n)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");if(t in e)throw new Error("jsonPatch: object already contains key "+t);e[t]=n},replace:(e,t,n)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");e[t]=n},remove:(e,t)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");delete e[t]}},l={add:(e,t,n)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");if(t in e)throw new Error(`jsonPatch: key ${t} already exists in array`);"number"!=typeof t||t!==Math.floor(t)?e[t]=n:e.splice(t,0,n)},replace:(e,t,n)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");"number"!=typeof t||t!==Math.floor(t)?e[t]=n:e.splice(t,1,n)},remove:(e,t)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");"number"!=typeof t||t!==Math.floor(t)?delete e[t]:e.splice(t,1)}};e.diff=function(e,t){const c={add:[],remove:[],replace:[]};function u(e,t){return!Array.isArray(e)||(e=Number.parseFloat(t),Number.isNaN(e))?t:e}return function e(t,n,i){if(!Object.is(t,n)){n=n||{},t=t||{};for(var r of Object.keys(t))if(!(r in n)){const n=u(t,r);c.remove.push({op:"remove",path:i.concat(n)})}for(const l of Object.keys(n)){var s=t[l],a=n[l],o=u(n,l);o in t?"object"!=typeof s&&"object"!=typeof a&&s!==a||typeof s!=typeof a||Array.isArray(s)!==Array.isArray(a)?c.replace.push({op:"replace",path:i.concat(o),value:a}):e(s,a,i.concat(o)):void 0!==n[o]&&(i.length&&c.add.push({op:"add",path:i,value:Array.isArray(n)?[]:{}}),c.add.push({op:"add",path:i.concat(o),value:a}))}}}(e,t,[]),[...c.remove.reverse(),...c.replace,...c.add.sort((e,t)=>e.path.length-t.path.length)]},e.patchInPlace=function(n,i){if(!n||"object"!=typeof n)throw new Error("jsonPatch: Must be an object or an array.");for(const s of i){const i=s.path.slice(),a=i.pop();if(null==a)throw new Error("jsonPatch: missing last key");let e=n,t=i.shift();for(;null!=t;){if(!(t in e))throw new Error("jsonPatch: missing parent element "+t);e=e[t],t=i.shift()}if(Array.isArray(e)&&"number"!=typeof a)throw new Error("jsonPatch: expected numeric index for array object");var r=Array.isArray(e)?l:o;"remove"===s.op?r.remove(e,a):"add"!==s.op||a in e?"replace"===s.op&&r.replace(e,a,s.value):r.add(e,a,s.value)}}}}(ts=ts||{}),function(n){function s(t,n){if(t===n)return 1;if(t&&n&&"object"==typeof t&&"object"==typeof n){var e=Array.isArray(t),i=Array.isArray(n);if(e&&i){if(t.length!==n.length)return;for(let e=0;e<t.length;++e)if(!s(t[e],n[e]))return}else{if(e!==i)return;e=Object.keys(t);if(e.length!==Object.keys(n).length)return;for(const r of e){if(!n.hasOwnProperty(r))return;if(!s(t[r],n[r]))return}}return 1}return t!=t&&n!=n}var e;(e=(e=(e=n.pxtc||(n.pxtc={})).jsonPatch||(e.jsonPatch={})).tests||(e.tests={})).diffTests=function(){const e=[{comment:"test 1",obja:{a:4,b:5},objb:{a:3,b:5},expected:[{op:"replace",path:["a"],value:3}]},{comment:"test 2",obja:{a:3,b:5},objb:{a:4,c:5},expected:[{op:"remove",path:["b"]},{op:"replace",path:["a"],value:4},{op:"add",path:["c"],value:5}]},{comment:"test 3",obja:{a:4,b:[1,2,3]},objb:{a:3,b:[1,2,4]},expected:[{op:"replace",path:["a"],value:3},{op:"replace",path:["b",2],value:4}]},{comment:"test 4",obja:{a:3,b:[1,2,4]},objb:{a:3,b:[1,2,4,5]},expected:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",3],value:5}]},{comment:"test 5",obja:{a:4,b:{c:3}},objb:{a:4,b:{c:4}},expected:[{op:"replace",path:["b","c"],value:4}]},{comment:"test 6",obja:{a:4,b:{c:4}},objb:{a:5,b:{d:4}},expected:[{op:"remove",path:["b","c"]},{op:"replace",path:["a"],value:5},{op:"add",path:["b"],value:{}},{op:"add",path:["b","d"],value:4}]},{comment:"test 7",obja:{a:4,b:[2,"foo"]},objb:{a:4,b:[2,"foo",["this","that"]]},expected:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",2],value:["this","that"]}]}];for(const t of e){console.log(t.comment);const e=n.pxtc.jsonPatch.diff(t.obja,t.objb);s(e,t.expected)?console.log("succeeded"):(console.error("FAILED"),console.log("got",e),console.log("exp",t.expected))}},e.patchTests=function(){for(const e of[{comment:"test 1",obj:{a:"foo",b:[4,11]},patches:[{op:"remove",path:["b"]},{op:"replace",path:["a"],value:4},{op:"add",path:["c"],value:5}],expected:{a:4,c:5}},{comment:"test 2",obj:{a:4,b:[1,2,3]},patches:[{op:"replace",path:["a"],value:3},{op:"replace",path:["b",2],value:4},{op:"add",path:["b",3],value:9}],expected:{a:3,b:[1,2,4,9]}},{comment:"test 3",obj:{a:4,b:{c:3}},patches:[{op:"replace",path:["a"],value:5},{op:"remove",path:["b","c"]},{op:"add",path:["b","d"],value:4}],expected:{a:5,b:{d:4}}},{comment:"test 4",obj:{a:4},patches:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",0],value:"foo"},{op:"add",path:["b",1],value:"bar"}],expected:{a:4,b:["foo","bar"]},validate:e=>e.b&&e.b.forEach}])console.log(e.comment),n.pxtc.jsonPatch.patchInPlace(e.obj,e.patches),s(e.obj,e.expected)&&e.validate&&!e.validate(e.obj)?e.expected&&(console.error("FAILED"),console.log("got",e.obj),console.log("exp",e.expected)):console.log("succeeded")}}(ts=ts||{}),function(e){e.perf||(e.perf={})}(pxt=pxt||{}),pxt.perf.report||(pxt.perf.report=()=>{}),pxt.perf.recordMilestone||(pxt.perf.recordMilestone=()=>{}),pxt.perf.measureStart||(pxt.perf.measureStart=()=>{}),pxt.perf.measureEnd||(pxt.perf.measureEnd=()=>{}),function(r){let n;r.U=pxtc.Util,r.Util=pxtc.Util;let s,a,e,o={};function i(e,t){/^csv-/.test(e)?r.setAppTargetVariant(e.replace(/^csv-*/,"")):r.appTarget&&(o[e]=t,r.U.jsonCopyFrom(r.appTarget.compile.switches,o),r.U.jsonCopyFrom(n.compile.switches,o))}function l(){let t=r.appTarget.compile,n=((t=t||(r.appTarget.compile={isNative:!1,hasHex:!1,switches:{}})).hasHex&&!t.nativeType&&(t.nativeType=pxtc.NATIVE_TYPE_THUMB),t.switches||(t.switches={}),r.U.jsonCopyFrom(t.switches,o),t.jsRefCounting=!1,t.useUF2||t.useELF||null!=t.noSourceInFlash||(t.noSourceInFlash=!0),void 0===t.utf8&&(t.utf8=!0),r.appTarget.appTheme||(r.appTarget.appTheme={}),r.appTarget.appTheme.embedUrl||(r.appTarget.appTheme.embedUrl=r.appTarget.appTheme.homeUrl),r.appTarget.compileService);n&&n.yottaTarget&&!n.yottaBinary&&(n.yottaBinary="pxt-microbit-app-combined.hex");const i=r.appTarget.appTheme;i&&Object.keys(i).filter(e=>/(logo|hero)$/i.test(e)&&/^@cdnUrl@/.test(i[e])).forEach(e=>i[e]=r.BrowserUtils.patchCdn(i[e]));var e=r.appTarget.simulator;if(e&&e.boardDefinition&&e.boardDefinition.visual&&(e=e.boardDefinition.visual).image&&(e.image=r.BrowserUtils.patchCdn(e.image),e.outlineImage)&&(e.outlineImage=r.BrowserUtils.patchCdn(e.outlineImage)),Object.keys(r.appTarget.bundledpkgs).forEach(e=>{var e=r.appTarget.bundledpkgs[e],t=JSON.parse(e[r.CONFIG_NAME]);t.icon&&(t.icon=r.BrowserUtils.patchCdn(t.icon)),e[r.CONFIG_NAME]=r.Package.stringifyConfig(t)}),"undefined"!=typeof window){const t={"lockededitor=1":{appTheme:{lockedEditor:!0}},"hidemenu=1":{appTheme:{hideMenuBar:!0}}},n=(r.appTarget.queryVariants&&r.Util.jsonCopyFrom(t,r.appTarget.queryVariants),window.location.href);Object.keys(t).forEach(e=>{new RegExp(e,"i").exec(n)&&(e=t[e])&&r.U.jsonMergeFrom(r.appTarget,e)})}}function c(e=!1){r.perf.measureStart("reloadAppTargetVariant");var t=e?"":JSON.stringify(r.appTarget);if(r.appTarget=r.U.cloneTargetBundle(n),r.appTargetVariant){const n=r.appTarget.variants&&r.appTarget.variants[r.appTargetVariant];n?r.U.jsonMergeFrom(r.appTarget,n):r.U.userError(lf("Variant '{0}' not defined in pxtarget.json",r.appTargetVariant))}l(),!e&&r.onAppTargetChanged&&t!=JSON.stringify(r.appTarget)&&r.onAppTargetChanged(),r.perf.measureEnd("reloadAppTargetVariant")}function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",gifworkerjs:"/gifjs/gif.worker.js",serviceworkerjs:"/serviceworker.js",typeScriptWorkerJs:"/tsworker.js",pxtVersion:"local",pxtRelId:"localRelId",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:r.appTarget?r.appTarget.id:"",simUrl:"/sim/simulator.html",simserviceworkerUrl:"/simulatorserviceworker.js",simworkerconfigUrl:"/sim/workerConfig.js",partsUrl:"/sim/siminstructions.html"}}function u(){return e=e||r.Cloud.downloadTargetConfigAsync().then(e=>e||{},e=>({}))}function d(e=null){return(e=e||r.appTarget.compile).nativeType==ts.pxtc.NATIVE_TYPE_VM?e.useESP?e.useUF2?ts.pxtc.BINARY_UF2:ts.pxtc.BINARY_ESP:ts.pxtc.BINARY_PXT64:e.useUF2&&!e.switches.rawELF?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}r.setAppTarget=function(e){r.appTarget=e||{},l(),n=r.U.cloneTargetBundle(r.appTarget)},r.setBundledApiInfo=function(e){for(const r of Object.keys(e)){const s=e[r].apis.byQName;for(const e of Object.keys(s)){var t=s[e],n=e.lastIndexOf("."),i=t.pyQName,n=s[e]={kind:Math.abs(t.kind||7),qName:e,namespace:e.slice(0,n<0?0:n),name:e.slice(n+1),pyQName:i,pyName:i?i.slice(i.lastIndexOf(".")+1):void 0,fileName:"",attributes:t.attributes||{},retType:t.retType||"void",parameters:t.parameters?t.parameters.map(e=>({name:e.name,description:e.description||"",type:e.type||"number",initializer:e.initializer,default:e.default,options:e.options||{},isEnum:!!e.isEnum,handlerParameters:e.handlerParameters})):null,extendsTypes:t.extendsTypes,snippet:t.kind&&t.kind<0?null:void 0,isInstance:!!t.isInstance,isReadOnly:!!t.isReadOnly},i=n.attributes;i.paramDefl||(i.paramDefl={}),i.callingConvention||(i.callingConvention=0),i.paramHelp||(i.paramHelp={}),i.jsDoc||(i.jsDoc=""),i._name=n.name.replace(/@.*/,"")}}s=e},r.getBundledApiInfo=function(){return s},r.savedAppTheme=function(){return n?n.appTheme:void 0},r.setCompileSwitch=i,r.setCompileSwitches=function(e){if(e)for(var t of e.split(/[\s,;:]+/))t&&("-"==t[0]?i(t.slice(1),!1):i(t,!0))},r.bundledSvg=function(n){if(n){let e=a&&a[n];if(e)return e;if(r.appTarget.simulator&&r.appTarget.simulator.dynamicBoardDefinition){a=a||{};var i=r.appTarget.bundledpkgs[n];if(i){if(JSON.parse(i["pxt.json"]).core&&i["board.json"]){const t=JSON.parse(i["board.json"]);if(t&&t.visual&&t.visual.image){let e=t.visual.image;/^pkg:\/\//.test(e)&&(e=i[e.slice(6)]),a[n]="data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(r.Util.toUTF8(e))}}return a[n]}}}},r.reloadAppTargetVariant=c,r.setAppTargetVariant=function(e,t={}){r.debug("app variant: "+e),(t.force||r.appTargetVariant!==e&&(r.appTargetVariant||e))&&(r.appTargetVariant=e,c(t.temporary))},r.setHwVariant=function(e,t){e=e.replace(/.*---/,""),/^[\w\-]+$/.test(e)?(r.hwVariant=e,r.hwName=t||e):(r.hwVariant=null,r.hwName=null),r.debug(`hwVariant: ${r.hwVariant} (${r.hwName})`)},r.hasHwVariants=function(){return!!r.appTarget.variants&&Object.keys(r.appTarget.bundledpkgs).some(e=>/^hw---/.test(e))},r.getHwVariants=function(){return r.appTarget.variants?Object.keys(r.appTarget.bundledpkgs).filter(e=>/^hw---/.test(e)).map(e=>JSON.parse(r.appTarget.bundledpkgs[e][r.CONFIG_NAME])).filter(e=>!!r.appTarget.appTheme.experimentalHw||!e.experimentalHw):[]},r.options={},r.debug="undefined"!=typeof console&&console.debug?e=>{r.options.debug&&console.debug(e)}:()=>{},r.log="undefined"!=typeof console&&console.log?e=>{console.log(e)}:()=>{},r.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},r.reportError=function(e,t,n){if(console&&(console.error(e+": "+t),n))try{r.log(JSON.stringify(n,null,2))}catch(e){}},r.localWebConfig=t,r.getOnlineCdnUrl=function(){var e;return r.webConfig&&(e=/^(https:\/\/[^\/]+)/.exec(r.webConfig.commitCdnUrl))?e[1]:null},r.setupWebConfig=function(e){e?r.webConfig=e:r.webConfig||(r.webConfig=t())},r.getEmbeddedScript=function(e){return r.U.lookup(r.appTarget.bundledpkgs||{},e)},r.targetConfigAsync=u,r.packagesConfigAsync=function(){return u().then(e=>e?e.packages:void 0)},r.CONFIG_NAME="pxt.json",r.SIMSTATE_JSON=".simstate.json",r.SERIAL_EDITOR_FILE="serial.txt",r.README_FILE="README.md",r.GITIGNORE_FILE=".gitignore",r.ASSETS_FILE="assets.json",r.CLOUD_ID="pxt/",r.BLOCKS_PROJECT_NAME="blocksprj",r.JAVASCRIPT_PROJECT_NAME="tsprj",r.PYTHON_PROJECT_NAME="pyprj",r.MAIN_BLOCKS="main.blocks",r.MAIN_TS="main.ts",r.MAIN_PY="main.py",r.DEFAULT_GROUP_NAME="other",r.TILEMAP_CODE="tilemap.g.ts",r.TILEMAP_JRES="tilemap.g.jres",r.IMAGES_CODE="images.g.ts",r.IMAGES_JRES="images.g.jres",r.TUTORIAL_CODE_START="_onCodeStart.ts",r.TUTORIAL_CODE_STOP="_onCodeStop.ts",r.TUTORIAL_INFO_FILE="tutorial-info-cache.json",r.TUTORIAL_CUSTOM_TS="tutorial.custom.ts",r.BREAKPOINT_TABLET=991,r.outputName=d,r.isOutputText=function(e=null){return d(e)==ts.pxtc.BINARY_HEX}}(pxt=pxt||{}),function(r){{var i=r.blocks||(r.blocks={});const f="this";let t;function n(){if((t={device_while:{name:r.Util.lf("a loop that repeats while the condition is true"),tooltip:r.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:r.Util.lf("while %1"),appendField:r.Util.lf("{id:while}do")}},pxt_controls_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},controls_simple_for:{name:r.Util.lf("a loop that repeats the number of times you say"),tooltip:r.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:r.Util.lf("for %1 from 0 to %2"),variable:r.Util.lf("{id:var}index"),appendField:r.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},controls_for_of:{name:r.Util.lf("a loop that repeats for each value in an array"),tooltip:r.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:r.Util.lf("for element %1 of %2"),variable:r.Util.lf("{id:var}value"),appendField:r.Util.lf("{id:for_of}do")}},math_op2:{name:r.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:r.Util.lf("smaller value of 2 numbers"),max:r.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:r.Util.lf("absolute number"),tooltip:r.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:r.Util.lf("absolute of %1")}},math_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.appTarget&&r.appTarget.compile?r.Util.lf("a decimal number"):r.Util.lf("an integer number")},math_integer:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("an integer number")},math_whole_number:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math",tooltip:r.Util.lf("a whole number")},math_number_minmax:{name:r.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:r.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:r.Util.lf("Return the sum of the two numbers."),MINUS:r.Util.lf("Return the difference of the two numbers."),MULTIPLY:r.Util.lf("Return the product of the two numbers."),DIVIDE:r.Util.lf("Return the quotient of the two numbers."),POWER:r.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:r.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:r.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:r.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:r.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:r.Util.lf("{id:op}**")}},math_modulo:{name:r.Util.lf("division remainder"),tooltip:r.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:r.Util.lf("remainder of %1 ÷ %2")}},math_js_op:{name:r.Util.lf("math function"),tooltip:{sqrt:r.Util.lf("Returns the square root of the argument"),sin:r.Util.lf("Returns the sine of the argument"),cos:r.Util.lf("Returns the cosine of the argument"),tan:r.Util.lf("Returns the tangent of the argument"),atan2:r.Util.lf("Returns the arctangent of the quotient of the two arguments"),idiv:r.Util.lf("Returns the integer portion of the division operation on the two arguments"),imul:r.Util.lf("Returns the integer portion of the multiplication operation on the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","atan2","idiv","imul"]},category:"math",block:{sqrt:r.Util.lf("{id:op}square root"),sin:r.Util.lf("{id:op}sin"),cos:r.Util.lf("{id:op}cos"),tan:r.Util.lf("{id:op}tan"),atan2:r.Util.lf("{id:op}atan2"),idiv:r.Util.lf("{id:op}integer ÷"),imul:r.Util.lf("{id:op}integer ×")}},math_js_round:{name:r.Util.lf("rounding functions"),tooltip:{round:r.Util.lf("Increases the argument to the next higher whole number if its fractional part is more than one half"),ceil:r.Util.lf("Increases the argument to the next higher whole number"),floor:r.Util.lf("Decreases the argument to the next lower whole number"),trunc:r.Util.lf("Removes the fractional part of the argument")},url:"/blocks/math",operators:{OP:["round","ceil","floor","trunc"]},category:"math",block:{round:r.Util.lf("{id:op}round"),ceil:r.Util.lf("{id:op}ceiling"),floor:r.Util.lf("{id:op}floor"),trunc:r.Util.lf("{id:op}truncate")}},variables_change:{name:r.Util.lf("update the value of a number variable"),tooltip:r.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:r.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:r.Util.lf("a loop that repeats and increments an index"),tooltip:r.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:r.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:r.Util.lf("{id:repeat}do")}},variables_get:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:r.Util.lf("get the value of a variable"),tooltip:r.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:r.Util.lf("Create 'set %1'")}},variables_set:{name:r.Util.lf("assign the value of a variable"),tooltip:r.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:r.Util.lf("set %1 to %2")}},controls_if:{name:r.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:r.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:r.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:r.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:r.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:r.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:r.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:r.Util.lf("{id:logic}else if")}},lists_create_with:{name:r.Util.lf("create an array"),tooltip:r.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:r.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:r.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:r.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:r.Util.lf("value")}},lists_length:{name:r.Util.lf("array length"),tooltip:r.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:r.Util.lf("length of array %1")}},lists_index_get:{name:r.Util.lf("get a value in an array"),tooltip:r.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:r.Util.lf("%1 get value at %2")}},lists_index_set:{name:r.Util.lf("set a value in an array"),tooltip:r.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:r.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:r.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:r.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:r.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:r.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:r.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:r.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:r.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:r.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:r.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:r.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:r.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:r.Util.lf("{id:op}or")}},logic_negate:{name:r.Util.lf("logical negation"),tooltip:r.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:r.Util.lf("not %1")}},logic_boolean:{name:r.Util.lf("a `true` or `false` value"),tooltip:r.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:r.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:r.Util.lf("{id:boolean}false")}},text:{name:r.Util.lf("a piece of text"),tooltip:r.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:r.Util.lf("a piece of text")}},text_length:{name:r.Util.lf("number of characters in the string"),tooltip:r.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:r.Util.lf("length of %1")}},text_join:{name:r.Util.lf("join items to create text"),tooltip:r.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:r.Util.lf("join")}},procedures_defnoreturn:{name:r.Util.lf("define the function"),tooltip:r.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:r.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:r.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:r.Util.lf("call the function"),tooltip:r.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:r.Util.lf("call function")}},function_return:{name:r.Util.lf("return a value from within a function"),tooltip:r.Util.lf("Return a value from within a user-defined function."),url:"types/function/return",category:"functions",block:{message_with_value:r.Util.lf("return %1"),message_no_value:r.Util.lf("return")}},function_definition:{name:r.Util.lf("define the function"),tooltip:r.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{FUNCTIONS_EDIT_OPTION:r.Util.lf("Edit Function")}},function_call:{name:r.Util.lf("call the function"),tooltip:r.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{FUNCTIONS_CALL_TITLE:r.Util.lf("call"),FUNCTIONS_GO_TO_DEFINITION_OPTION:r.Util.lf("Go to Definition")}},function_call_output:{name:r.Util.lf("call the function with a return value"),tooltip:r.Util.lf("Call the user-defined function with a return value."),url:"types/function/call",category:"functions",block:{}}})[pxtc.ON_START_TYPE]={name:r.Util.lf("on start event"),tooltip:r.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:r.Util.lf("on start %1 %2")}},t[pxtc.PAUSE_UNTIL_TYPE]={name:r.Util.lf("pause until"),tooltip:r.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:r.Util.lf("pause until %1")}},t[pxtc.TS_BREAK_TYPE]={name:r.Util.lf("break"),tooltip:r.Util.lf("Break out of the current loop or switch"),url:"/blocks/loops/break",category:"loops",block:{message0:r.Util.lf("break")}},t[pxtc.TS_CONTINUE_TYPE]={name:r.Util.lf("continue"),tooltip:r.Util.lf("Skip current iteration and continues with the next iteration in the loop"),url:"/blocks/loops/continue",category:"loops",block:{message0:r.Util.lf("continue")}},r.Util.isTranslationMode()){const i=Blockly.Msg;r.Util.values(t).filter(e=>e.block).forEach(n=>{var e=Object.keys(n.block);n.translationIds=r.Util.values(n.block),e.forEach(t=>r.crowdin.inContextLoadAsync(n.block[t]).then(e=>{n.block[t]=e,/^[A-Z_]+$/.test(t)&&(i[t]=e)}))})}}i.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan"],binary:["atan2"],infix:["idiv","imul"]},i.ROUNDING_FUNCTIONS=["round","ceil","floor","trunc"],i.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},i.normalizeBlock=function(e,t=r.log){if(!e)return e;let n=e.replace(/(?:^|[^\\])([%$])\s+/g,"$1");return n!=e&&(t("block has extra spaces: "+e),e=n),(n=(e=n).replace(/([%$]\w+)\s*=\s*(\w+)/,"$1=$2"))!=e&&(t("block has space between %name and = : "+e),e=n),n=n.replace(/\s*\|\s*/g,"|")},i.compileInfo=function(n){const r={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},t=(1==n.kind||2==n.kind)&&!n.attributes.defaultInstance,s=!!n.attributes._def,a=s?n.attributes._def.parameters.slice(0):void 0,o=s?a.length:n.parameters?n.parameters.length:0,l=i.builtinFunctionInfo[n.qName],c=(s&&n.attributes._expandedDef&&a.push(...n.attributes._expandedDef.parameters),{}),u=a?a.filter(e=>!e.ref||(c[e.name]=e,!1)):[];if(t&&s&&a.length){const i=c.this||a[0],t=i.name;let e;i.shadowBlockId&&"variables_get"!==i.shadowBlockId||(e=i.varName||n.attributes.paramDefl[t]||n.attributes.paramDefl.this),r.thisParameter={actualName:f,definitionName:t,shadowBlockId:i.shadowBlockId,type:n.namespace,defaultValue:e,fieldEditor:d(t,f),fieldOptions:h(t,f),shadowOptions:p(t,f)}}if(n.parameters){let i=t&&!c.this?1:0;n.parameters.forEach((t,e)=>{let n;if(c[t.name]?n=c[t.name]:i<u.length&&(n=u[i],++i),n||!s){let e;t.options&&t.options.min&&t.options.max&&(e={min:t.options.min.value,max:t.options.max.value});const s=n?n.name:l?l.params[i++]:t.name,c=n&&("variables_get"===n.shadowBlockId||"lists_create_with"==n.shadowBlockId);r.parameters.push({actualName:t.name,type:t.type,defaultValue:c&&n.varName||t.default,definitionName:s,shadowBlockId:n&&n.shadowBlockId,isOptional:!!a&&a.indexOf(n)>=o,fieldEditor:d(s,t.name),fieldOptions:h(s,t.name),shadowOptions:p(s,t.name),range:e})}t.handlerParameters&&t.handlerParameters.forEach(t=>{r.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!a&&a.some(e=>e.ref&&e.name===t.name)})})})}return r.parameters.forEach(e=>{r.actualNameToParam[e.actualName]=e,r.definitionNameToParam[e.definitionName]=e}),r;function d(e,t){return n.attributes.paramFieldEditor&&(n.attributes.paramFieldEditor[e]||n.attributes.paramFieldEditor[t])}function h(e,t){return n.attributes.paramFieldEditorOptions&&(n.attributes.paramFieldEditorOptions[e]||n.attributes.paramFieldEditorOptions[t])}function p(e,t){return n.attributes.paramShadowOptions&&(n.attributes.paramShadowOptions[e]||n.attributes.paramShadowOptions[t])}},i.hasHandler=function(e){return e.parameters&&e.parameters.some(e=>{var t;return"() => void"==e.type||"Action"==e.type||!(null==(t=e.properties)||!t.length)||!(null==(t=e.handlerParameters)||!t.length)})},i.reporterTypeForArgType=function(e){let t="boolean"!==e&&"number"!==e&&"string"!==e?"argument_reporter_custom":"argument_reporter_"+e;return t},i.defaultIconForArgType=function(e=""){switch(e){case"number":return"calculator";case"string":return"text width";case"boolean":return"random";case"Array":return"list";default:return"align justify"}},i.parseFields=function(e){return e.split("|").map((e,t)=>{var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};let i=n[1];return{n:e,ni:t,pre:i=i&&i.trim(),p:n[2]}})},i.blockDefinitions=function(){return t||n(),t},i.getBlockDefinition=function(e){return t||n(),t[e]}}}(pxt=pxt||{}),function(u){{var l=u.BrowserUtils||(u.BrowserUtils={});function s(){return"undefined"!=typeof navigator}function e(){return s()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function o(){return s()&&/mobi/i.test(navigator.userAgent)}function c(){return s()&&/Mac/i.test(navigator.platform)}function d(){return!!navigator&&/Linux/i.test(navigator.platform)}function h(){return s()&&/arm/i.test(navigator.platform)}function p(){return s()&&/Edge/i.test(navigator.userAgent)}function f(){return s()&&/Trident/i.test(navigator.userAgent)}function m(){return!p()&&!f()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function g(){return!m()&&!p()&&!!navigator&&/(Macintosh|Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function b(){return!g()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function v(){return s()&&/Opera|OPR/i.test(navigator.userAgent)}function y(){return s()&&/Midori/i.test(navigator.userAgent)}function w(){return s()&&/Epiphany/i.test(navigator.userAgent)}function x(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function k(){return"undefined"!=typeof window&&!!window.pxtElectron}function A(){return"undefined"!=typeof window&&!!window.ipcRenderer}function T(){return k()||A()}function E(e){var t;try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&(e||!/nolocalhost=1/.test(window.location.href))&&!(null!=(t=null==u?void 0:u.webConfig)&&t.isStatic)}catch(e){return!1}}function C(){return"undefined"!=typeof window&&!!window.PointerEvent}function S(){return e()?"windows":c()?"mac":d()&&h()?"rpi":d()?"linux":"unknown"}function I(){return p()?"edge":w()?"epiphany":y()?"midori":v()?"opera":f()?"ie":m()?"chrome":g()?"safari":b()?"firefox":"unknown"}function P(){if(!s())return null;let e=[];return v()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),(e=w()?/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):y()?/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):g()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||/(Macintosh|iPod( touch)?|iPhone|iPad); (CPU|Intel).*?OS (X )?(\d+)/i.exec(navigator.userAgent):(m()?/(Chrome|Chromium)\/([0-9\.]+)/i:p()?/Edge\/([0-9\.]+)/i:f()?/(MSIE |rv:)([0-9\.]+)/i:/(Firefox|Seamonkey)\/([0-9\.]+)/i).exec(navigator.userAgent))&&0!=e.length?e[e.length-1]:null}l.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},l.hasNavigator=s,l.hasWindow=function(){return"undefined"!=typeof window},l.isWindows=e,l.isWindows10=function(){return s()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},l.isMobile=o,l.isIOS=function(){return s()&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)},l.isAndroid=function(){return s()&&/android/i.test(navigator.userAgent)},l.isMac=c,l.isLinux=d,l.isARM=h,l.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},l.isEdge=p,l.isChromiumEdge=function(){return s()&&/Edg\//i.test(navigator.userAgent)},l.isIE=f,l.isChrome=m,l.isSafari=g,l.isFirefox=b,l.isOpera=v,l.isMidori=y,l.isEpiphany=w,l.isTouchEnabled=x,l.isPxtElectron=k,l.isIpcRenderer=A,l.isElectron=T,l.isWinRT=()=>!1,l.isLocalHost=E,l.isLocalHostDev=function(){return E()&&!T()},l.isSkillmapEditor=function(){try{return/skill(?:s?)Map=1/.test(window.location.href)}catch(e){return!1}},l.isTabletSize=function(){return(null===window||void 0===window?void 0:window.innerWidth)<u.BREAKPOINT_TABLET},l.isComputerSize=function(){return(null===window||void 0===window?void 0:window.innerWidth)>=u.BREAKPOINT_TABLET},l.noSharedLocalStorage=function(){try{return/nosharedlocalstorage/i.test(window.location.href)}catch(e){return!1}},l.useOldTutorialLayout=function(){try{return/tutorialview=old/.test(window.location.href)}catch(e){return!1}},l.hasPointerEvents=C,l.hasSaveAs=function(){return p()||f()||b()},l.os=S,l.browser=I,l.browserVersion=P;let a=!1;function $(){return o()&&g()&&!/downloadWindowOpen=0/i.test(window.location.href)}function U(t,e,n){var i=$(),r=P(),s=parseInt(r||"0");if(i)n?n.location.href=t:window.open(t,"_self");else if(u.BrowserUtils.isSafari()&&(s<10||0==r.indexOf("10.0")||o())){let e=document.getElementById("downloader");e||(u.debug("injecting downloader iframe"),(e=document.createElement("iframe")).id="downloader",e.style.position="absolute",e.style.right="0",e.style.bottom="0",e.style.zIndex="-1",e.style.width="1px",e.style.height="1px",document.body.appendChild(e)),e.src=t}else/^data:/i.test(t)&&(u.BrowserUtils.isEdge()||u.BrowserUtils.isIE())?(i=atob(t.split(",")[1]),n=u.Util.stringToUint8Array(i),s=new Blob([n],{type:"img/png"}),window.navigator.msSaveOrOpenBlob(s,e)):"string"==typeof(r=window.document.createElement("a")).download?(r.href=t,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)):document.location.href=t}function H(e,t){let n="data";o()&&g()&&u.appTarget.appTheme.mobileSafariDownloadProtocol&&(n=u.appTarget.appTheme.mobileSafariDownloadProtocol);var i=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return(n=i?i[1]:n)+":"+t+";base64,"+e}function _(e,t,n={}){u.debug("trigger download");var{contentType:i="application/octet-stream",userContextWindow:r,onError:n,maintainObjectURL:s}=n,a=null==(a=window.URL)?void 0:a.createObjectURL,o=u.appTarget.appTheme.disableBlobObjectDownload;let l;try{if(a&&!o){const n=a(new Blob([u.Util.stringToUint8Array(atob(e))],{type:i}));U(n,t,r),s?l=n:window.setTimeout(()=>window.URL.revokeObjectURL(l),0)}else U(l=H(e,t),t,r)}catch(e){n&&n(e),u.debug("saving failed")}return l}function G(n){const i=document.createElement("img");return new Promise((e,t)=>{i.onload=()=>e(i),i.onerror=()=>e(void 0),i.crossOrigin="anonymous",i.src=n})}function N(e){return/^https?:\/\//i.test(e)?e:(window.MonacoPaths||{})[e]||(u.U.startsWith(e,u.webConfig.commitCdnUrl)?e:u.webConfig.commitCdnUrl+e)}l.isBrowserSupported=function(){var e,t,n,i,r,s;return!navigator||!!/bot|crawler|spider|crawling/i.test(navigator.userAgent)||(null==(e=(null==(e=u.appTarget)?void 0:e.unsupportedBrowsers)||(null==(e=window.pxtTargetBundle)?void 0:e.unsupportedBrowsers))||!e.some(e=>e.id==I()))&&(e=P(),i=parseInt(e||"0"),s=m()&&38<=i,r=b()&&31<=i,t=p(),n=g()&&9<=i,i=v()&&m()&&21<=i,s=s||r||t||n||i,r=y()||d()&&h()&&w(),s=(s=s&&!r)||/anybrowser=(true|1)/.test(window.location.href),a||(u.log(`Browser: ${I()} ${e} on `+S()),s||u.tickEvent("browser.unsupported",{useragent:navigator.userAgent}),a=!0),s)},l.devicePixelRatio=function(){var e,t;return"undefined"!=typeof window&&window.screen?(e=window.screen.systemXDPI,t=window.screen.logicalXDPI,void 0!==e&&void 0!==t&&t<e?e/t:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1):1},l.browserDownloadBinText=function(e,t,n){return _(ts.pxtc.encodeBase64(e),t,n)},l.browserDownloadText=function(e,t,n){return _(ts.pxtc.encodeBase64(u.Util.toUTF8(e)),t,n)},l.isBrowserDownloadInSameWindow=$,l.isBrowserDownloadWithinUserContext=function(){var e=P(),e=parseInt(e||"0");return o()&&g()&&11<=e||/downloadUserContext=1/i.test(window.location.href)},l.browserDownloadDataUri=U,l.browserDownloadUInt8Array=function(e,t,n){return _(ts.pxtc.encodeBase64(u.Util.uint8ArrayToString(e)),t,n)},l.toDownloadDataUri=H,l.browserDownloadBase64=_,l.loadImageAsync=G,l.loadCanvasAsync=function(e){return G(e).then(e=>{var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t})},l.scaleImageData=function(e,t){var n=document.createElement("canvas"),i=(n.width=e.width*t,n.height=e.height*t,n.getContext("2d"));return i.putImageData(e,0,0),i.imageSmoothingEnabled=!1,i.scale(t,t),i.drawImage(n,0,0),i.getImageData(0,0,e.width*t,e.height*t)},l.imageDataToPNG=function(e,t=1){var n,i;if(e)return(n=document.createElement("canvas")).width=e.width*t,n.height=e.height*t,(i=n.getContext("2d")).putImageData(e,0,0),i.imageSmoothingEnabled=!1,i.scale(t,t),i.drawImage(n,0,0),n.toDataURL("image/png")},l.encodeToPngAsync=function(t,e){const{width:s,height:a,pixelDensity:o=4,maxSize:l=1e6,text:c}=e||{};return new Promise((i,e)=>{const r=new Image;r.onload=function(){const t=document.createElement("canvas"),e=t.getContext("2d");t.width=(s||r.width)*o,t.height=(a||r.height)*o,c&&(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height)),e.drawImage(r,0,0,s,a,0,0,t.width,t.height);let n=t.toDataURL("image/png");for(;n.length>l;)t.width=t.width/2>>0,t.height=t.height/2>>0,u.debug(`screenshot size ${n.length}b, shrinking to ${t.width}x`+t.height),e.drawImage(r,0,0,s,a,0,0,t.width,t.height),n=t.toDataURL("image/png");c?u.lzmaCompressAsync(c).then(e=>{e=u.Util.encodeBlobAsync(t,e);i(e.toDataURL("image/png"))}):i(n)},r.onerror=e=>{u.reportError("png","png rendering failed"),i(void 0)},r.src=t})},l.resolveCdnUrl=N,l.loadStyleAsync=function(e,t){const i="style-"+(e=t?"rtl"+e:e);if(document.getElementById(i))return Promise.resolve();const r=N(e),n=u.Util.toArray(document.head.getElementsByTagName("link")).filter(e=>e.getAttribute("href")==r)[0];return n?(n.id||(n.id=i),Promise.resolve()):new Promise((e,t)=>{var n=document.createElement("link");n.href=r,n.rel="stylesheet",n.type="text/css",n.id=i,n.addEventListener("load",()=>e()),n.addEventListener("error",e=>t(e)),document.head.appendChild(n)})};let t,n,i,r={};function V(e,t){return e?t?(e.indexOf("/")==e.length-1?e.substring(0,e.length-1):e)+"/"+(0==t.indexOf("/")?t.substring(1):t):e:t}function z(){var e=s()&&window.navigator;return e&&e.storage&&e.storage.estimate?e.storage.estimate():Promise.resolve({})}l.loadScriptAsync=function(e){const i=N(e);let t=r[i];return t=t||(r[i]=new Promise((e,t)=>{u.debug("script: loading "+i);var n=document.createElement("script");n.type="text/javascript",n.addEventListener("load",()=>e()),n.addEventListener("error",e=>{delete r[i],t(e)}),n.src=i,n.async=!0,document.body.appendChild(n)}))},l.loadAjaxAsync=function(i){return new Promise((e,t)=>{let n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&(200==n.status?e(n.responseText):t(n.status))},n.open("GET",i,!0),n.send()})},l.loadBlocklyAsync=function(){if(!t){u.debug("blockly: delay load");let e=u.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());e=(e="undefined"==typeof Blockly?e.then(()=>u.BrowserUtils.loadScriptAsync("pxtblockly.js")):e).then(()=>{u.debug("blockly: loaded")}),t=e}return t},l.patchCdn=function(e){var t;return e&&((t=u.getOnlineCdnUrl())?e.replace("@cdnUrl@",t):e.replace(/@cdnUrl@\/(blob|commit)\/[a-f0-9]{40}\//,"./"))},l.initTheme=function(){const e=u.appTarget.appTheme;if(e&&e.accentColor&&((t=document.createElement("style")).type="text/css",t.appendChild(document.createTextNode(`.ui.accent { color: ${e.accentColor}; }
                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: ${e.accentColor}; }`)),document.getElementsByTagName("head")[0].appendChild(t)),u.Util.isUserLanguageRtl()){u.debug("rtl layout"),u.BrowserUtils.addClass(document.body,"rtl"),document.body.style.direction="rtl";const e=u.Util.toArray(document.head.getElementsByTagName("link")),n=e.filter(e=>u.Util.endsWith(e.getAttribute("href"),"semantic.css"))[0];if(n){const e=n.getAttribute("data-rtl");e&&(u.debug("swapping to "+e),n.setAttribute("href",e))}var t=e.filter(e=>u.Util.endsWith(e.getAttribute("href"),"blockly.css"))[0];if(t){const e=t.getAttribute("data-rtl");e&&(u.debug("swapping to "+e),t.setAttribute("href",e),t.removeAttribute("data-rtl"))}}},l.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)},l.urlJoin=V,l.joinURLs=function(...t){let n;if(t)for(let e=0;e<t.length;e++)n=V(n,t[e]);return n},l.storageEstimateAsync=z,l.scheduleStorageCleanup=s()&&navigator.storage&&navigator.storage.estimate?ts.pxtc.Util.throttle(function(){z().then(e=>(u.debug(`storage estimate: ${e.usage/e.quota*100>>0}%, ${e.usage/1e6>>0}/${e.quota/1e6>>0}Mb`),e.quota&&e.usage&&1e6<e.quota&&.9<e.usage/e.quota?(u.log("quota usage exceeded, clearing translations"),u.tickEvent("storage.cleanup"),O()):Promise.resolve())).catch(e=>{u.reportException(e)})},1e4,!1):()=>{},l.stressTranslationsAsync=function t(){let n="...";for(let e=0;e<16;++e)n+=n+Math.random();return console.log(`adding entry ${2*n.length} bytes`),u.U.delay(1).then(()=>W()).then(e=>e.setAsync("foobar",Math.random().toString(),"",null,void 0,n)).then(()=>u.BrowserUtils.storageEstimateAsync()).then(e=>!e.quota||e.usage/e.quota<.8?t():Promise.resolve())};class L{constructor(){this.translations={}}key(e,t,n){return e+`|${t}|`+(n||"master")}get(e,t,n){return this.translations[this.key(e,t,n)]}getAsync(e,t,n){return Promise.resolve(this.get(e,t,n))}set(e,t,n,i,r,s,a){this.translations[this.key(e,t,n)]={etag:i,time:r,strings:s,md:a}}setAsync(e,t,n,i,r,s){return this.set(e,t,n,i,u.Util.now(),r),Promise.resolve()}clearAsync(){return this.translations={},Promise.resolve()}}class B{constructor(e,t,n,i){this.name=e,this.version=t,this.upgradeHandler=n,this.quotaExceededHandler=i}throwIfNotOpened(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")}errorHandler(e,t,n){console.error(new Error(this.name+` IDBWrapper error for ${t}: `+e.message)),n(e),"QuotaExceededError"==e.name&&(u.log("storage quota exceeded..."),u.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler)&&this.quotaExceededHandler()}getObjectStore(e,t="readonly"){return this.throwIfNotOpened(),this._db.transaction([e],t).objectStore(e)}static deleteDatabaseAsync(i){return new Promise((e,t)=>{const n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(i);n.onsuccess=()=>e(),n.onerror=()=>t(n.error)})}openAsync(){return new Promise((e,t)=>{const n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(this.name,this.version);n.onsuccess=()=>{this._db=n.result,e()},n.onerror=()=>this.errorHandler(n.error,"open",t),n.onupgradeneeded=e=>this.upgradeHandler(e,n)})}getAsync(i,r){return new Promise((e,t)=>{const n=this.getObjectStore(i).get(r);n.onsuccess=()=>e(n.result),n.onerror=()=>this.errorHandler(n.error,"get",t)})}getAllAsync(r){return new Promise((e,t)=>{const n=this.getObjectStore(r).openCursor(),i=[];n.onsuccess=()=>{n.result?(i.push(n.result.value),n.result.continue()):e(i)},n.onerror=()=>this.errorHandler(n.error,"getAll",t)})}setAsync(r,s){return new Promise((e,t)=>{var n=this.getObjectStore(r,"readwrite");let i;(i=void 0!==s.id&&null!==s.id?n.put(s):n.add(s)).onsuccess=()=>e(),i.onerror=()=>this.errorHandler(i.error,"set",t)})}deleteAsync(i,r){return new Promise((e,t)=>{const n=this.getObjectStore(i,"readwrite").delete(r);n.onsuccess=()=>e(),n.onerror=()=>this.errorHandler(n.error,"delete",t)})}deleteAllAsync(i){return new Promise((e,t)=>{const n=this.getObjectStore(i,"readwrite").clear();n.onsuccess=()=>e(),n.onerror=()=>this.errorHandler(n.error,"deleteAll",t)})}}l.IDBWrapper=B;class F{constructor(e){this.db=e,this.mem=new L}static dbName(){return"__pxt_translations_"+(u.appTarget.id||"")}static createAsync(){function t(){const e=new B(F.dbName(),2,(e,t)=>{t.result.createObjectStore(F.TABLE,{keyPath:F.KEYPATH})},()=>{O().catch(e=>{})});return e.openAsync().then(()=>new F(e))}return t().catch(e=>(console.log("db: failed to open database, try delete entire store..."),B.deleteDatabaseAsync(F.dbName()).then(()=>t())))}getAsync(t,n,i){t=(t||"en-US").toLowerCase();var e=this.mem.key(t,n,i),r=this.mem.get(t,n,i);return r?Promise.resolve(r):this.db.getAsync(F.TABLE,e).then(e=>e?(this.mem.set(t,n,i,e.etag,e.time,e.strings),Promise.resolve(e)):Promise.resolve(void 0)).catch(e=>Promise.resolve(void 0))}setAsync(e,t,n,i,r,s){e=(e||"en-US").toLowerCase();var a=this.mem.key(e,t,n),o=u.Util.now(),e=(this.mem.set(e,t,n,i,o,r,s),r&&Object.keys(r).filter(e=>!r[e]).forEach(e=>delete r[e]),{id:a,etag:i,time:o,strings:r,md:s});return this.db.setAsync(F.TABLE,e).finally(()=>l.scheduleStorageCleanup()).catch(e=>(console.log(`db: set failed (${e.message}), recycling...`),this.clearAsync()))}clearAsync(){return this.db.deleteAllAsync(F.TABLE).then(()=>console.debug("db: all clean")).catch(e=>{console.error("db: failed to delete all")})}}function W(){return u.Util.isNodeJS?Promise.resolve(new L):n=n||F.createAsync().catch(()=>new L)}function O(){function t(){const t=F.dbName();return B.deleteDatabaseAsync(t).then(()=>{n=void 0}).catch(e=>{u.log("db: failed to delete "+t),n=void 0})}return n?n.then(e=>e.clearAsync()).catch(e=>t().then()):t()}function D(e){e=JSON.stringify(e)+u.appTarget.versions.pxt+"_"+u.appTarget.versions.target;return pxtc.U.sha256(e)}function R(e,t){return e+"|"+(t||"master")}F.TABLE="files",F.KEYPATH="id",l.translationDbAsync=W,l.clearTranslationDbAsync=O,l.getTutorialCodeHash=D;class j{constructor(e){this.db=e}static dbName(){return"__pxt_tutorialinfo_"+(u.appTarget.id||"")}static createAsync(){function t(){const e=new u.BrowserUtils.IDBWrapper(j.dbName(),2,(e,t)=>{t.result.createObjectStore(j.TABLE,{keyPath:j.KEYPATH})},()=>{u.BrowserUtils.IDBWrapper.deleteDatabaseAsync(j.dbName())});return e.openAsync().then(()=>new j(e))}return t().catch(e=>(console.log("db: failed to open tutorial info database, try delete entire store..."),u.BrowserUtils.IDBWrapper.deleteDatabaseAsync(j.dbName()).then(()=>t())))}getAsync(e,t,n){const i=R(e,n),r=D(t);return this.db.getAsync(j.TABLE,i).then(e=>{if(e&&e.hash==r&&u.Util.now()-(e.time||0)<864e5)return e;this.db.deleteAsync(j.TABLE,i)})}setAsync(e,t,n,i){u.perf.measureStart("tutorial info db setAsync"),R(e,i);i=D(n);return this.setWithHashAsync(e,t,i)}setWithHashAsync(e,n,t,i){u.perf.measureStart("tutorial info db setAsync");const r=R(e,i),s={};Object.keys(n).forEach(t=>{Object.keys(n[t]).forEach(e=>{s[e]=n[t][e]})});e={id:r,time:u.Util.now(),hash:t,snippets:n,blocks:s};return this.db.setAsync(j.TABLE,e).then(()=>{u.perf.measureEnd("tutorial info db setAsync")})}clearAsync(){return this.db.deleteAllAsync(j.TABLE).then(()=>console.debug("db: all clean")).catch(e=>{console.error("db: failed to delete all")})}}function M(e){return e.split(/\s+/).filter(e=>!!e)}function q(){var e=new RegExp(u.Util.escapeForRegex(u.Util.pxtLangCookieId)+"=(.*?)(?:;|$)").exec(document.cookie);return e&&e[1]||null}j.TABLE="info",j.KEYPATH="id",l.tutorialInfoDbAsync=function(){return i=i||j.createAsync()},l.clearTutorialInfoDbAsync=function(){function t(){const t=j.dbName();return B.deleteDatabaseAsync(t).then(()=>{i=void 0}).catch(e=>{u.log("db: failed to delete "+t),i=void 0})}return i?i.then(e=>e.clearAsync()).catch(e=>t().then()):t()},l.pointerEvents=C()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:x()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},l.getPageX=function(e){return("pageX"in e?e:e.changedTouches[0]).pageX},l.getPageY=function(e){return("pageY"in e?e:e.changedTouches[0]).pageY},l.getClientX=function(e){return("clientX"in e?e:e.changedTouches[0]).clientX},l.getClientY=function(e){return("clientY"in e?e:e.changedTouches[0]).clientY},l.popupWindow=function(e,t,n,i){try{const u=window.screenLeft||window.screenX,r=window.screenTop||window.screenY,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=s/2-n/2+u,l=a/2-i/2+r,c=window.open(e,t,"width="+n+", height="+i+", top="+l+", left="+o);return c.focus&&c.focus(),c}catch(t){return u.tickEvent("pxt.popupError",{url:e,msg:t.message}),null}},l.containsClass=function(n,e){return M(e).every(e=>{return e=e,(t=n).classList?t.classList.contains(e):!((t.className+"").split(/\s+/).indexOf(e)<0);var t})},l.addClass=function(n,e){M(e).forEach(e=>{var t;e=e,(t=n).classList?t.classList.add(e):(t.className+"").split(/\s+/).indexOf(e)<0&&(t.className.baseVal+=" "+e)})},l.removeClass=function(n,e){M(e).forEach(e=>{var t;t=e,(e=n).classList?e.classList.remove(t):e.className.baseVal=(e.className+"").split(/\s+/).filter(e=>e!=t).join(" ")})},l.getCookieLang=q,l.setCookieLang=function(e,t=!1){u.Util.allLanguages[e]&&e!==q()&&(u.tickEvent("menu.lang.setcookielang",{lang:e,docs:""+t}),(t=new Date).setTime(t.getTime()+24*u.Util.langCookieExpirationDays*60*60*1e3),document.cookie=`${u.Util.pxtLangCookieId}=${e}; expires=${t.toUTCString()}; path=/`)},l.cacheBustingUrl=function(e){return e&&(/[?&]rnd=/.test(e)?e:`${e}${0<e.indexOf("?")?"&":"?"}rnd=`+Math.random())}}}(pxt=pxt||{}),function(e){(e.cloud||(e.cloud={})).cloudStatus={none:{value:"none"},synced:{value:"synced",icon:"cloud-saved-b",tooltip:lf("Project saved to cloud"),shortStatus:lf("saved"),longStatus:lf("Saved to cloud"),indicator:""},justSynced:{value:"justSynced",icon:"cloud-saved-b",tooltip:lf("Project saved to cloud"),shortStatus:lf("saved!"),longStatus:lf("Saved to cloud!"),indicator:""},offline:{value:"offline",icon:"cloud-error-b",tooltip:lf("Unable to connect to cloud"),shortStatus:lf("offline"),longStatus:lf("Offline"),indicator:lf("offline")},syncing:{value:"syncing",icon:"cloud-saving-b",tooltip:lf("Saving project to cloud..."),shortStatus:lf("saving..."),longStatus:lf("Saving to cloud..."),indicator:lf("syncing...")},conflict:{value:"conflict",icon:"cloud-error-b",tooltip:lf("Project was edited in two places and the changes conflict"),shortStatus:lf("conflict!"),longStatus:lf("Project has a conflict!"),indicator:"!"},localEdits:{value:"localEdits",icon:"cloud-saving-b",tooltip:lf("Saving project to the cloud..."),shortStatus:lf("saving..."),longStatus:lf("Saving to cloud..."),indicator:"*"}}}(pxt=pxt||{}),function(e){var n;(n=e.commands||(e.commands={})).deployCoreAsync=void 0,n.deployFallbackAsync=void 0,n.hasDeployFn=()=>n.deployCoreAsync||n.deployFallbackAsync,n.deployAsync=(e,t)=>(n.deployCoreAsync||n.deployFallbackAsync)(e,t),n.patchCompileResultAsync=void 0,n.browserDownloadAsync=void 0,n.saveOnlyAsync=void 0,n.renderBrowserDownloadInstructions=void 0,n.renderUsbPairDialog=void 0,n.renderIncompatibleHardwareDialog=void 0,n.showUploadInstructionsAsync=void 0,n.saveProjectAsync=void 0,n.electronDeployAsync=void 0,n.webUsbPairDialogAsync=void 0,n.onTutorialCompleted=void 0}(pxt=pxt||{}),function(r){function e(){let e;return e||(e=r.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(e=>(e||r.reportError("lzma","failed to load"),e)),e}r.lzmaDecompressAsync=function(i){return e().then(t=>new Promise((n,e)=>{try{t.decompress(i,(e,t)=>{t&&r.debug("lzma decompression failed"),n(t?void 0:e)})}catch(e){e&&r.debug("lzma decompression failed"),n(void 0)}}))},r.lzmaCompressAsync=function(i){return e().then(t=>new Promise((n,e)=>{try{t.compress(i,7,(e,t)=>{t&&r.reportException(t),n(t?void 0:new Uint8Array(e))})}catch(e){r.reportException(e),n(void 0)}}))}}(pxt=pxt||{}),function(ce){{var e=ce.cpp||(ce.cpp={}),ue=pxtc.Util;let oe=ue.lf;const pe={"pxt::mkAction":1,"pxt::dumpPerfCounters":1,"pxt::deepSleep":1,"pxt::getConfig":1,"pxtrt::mkMap":1,"pxtrt::mapSet":1,"pxtrt::stclo":1,"pxtrt::mklocRef":1,"pxtrt::stlocRef":1,"pxtrt::ldlocRef":1,"pxtrt::panic":1};function de(n="namespace"){let i="",r="",e=(e,t="")=>{r!=e&&(r&&(i+="}\n"),e&&(i+=t||n+" "+e+" {\n"),r=e)},t="    ";return{setNs:e,clear:()=>{i="",r=""},write:e=>{e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,(e,t)=>t+" *"),i+=e+"\n"):i+="\n"},incrIndent:()=>{t+="    "},decrIndent:()=>{t=t.slice(4)},finish:()=>(e(""),i)}}function he(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=de,e.parseCppInt=he;let le={};class fe extends Error{constructor(e){super(e),this.isUserError=!0,this.message=e}}function l(t){if(!t)return"";let n="";for(let e=0;e<t.length;++e){var i=255&t[e];n+=37==i||127<i?"%"+i.toString(16):String.fromCharCode(i)}return decodeURIComponent(n)}function c(e){let t="",n=0;for(;n<e.length;n+=2)t=e[n]+e[n+1]+t;return ce.Util.assert(n==e.length),t}function s(n){var i=[65,20,14,47,184,47,162,187];e:for(let t=0;t<n.length;t+=16)if(n[t]==i[0]){for(let e=0;e<i.length;++e)if(n[t+e]!=i[e])continue e;var e,r=n[t+8]|n[t+9]<<8,s=n[t+10]|n[t+11]<<8|n[t+12]<<16|n[t+13]<<24,s=(t+=16)+r+s;if(!(s>n.length))return e=n.slice(t,t+r),r=n.slice(t+r,s),{meta:l(e),text:r}}return null}function t(e){function t(e){return ce.debug(e),Promise.reject(new Error(e))}let n;var i;if(ce.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0&&(i=ts.pxtc.UF2.toBin(e))&&(n=s(i.buf)),1179403647==ce.HF2.read32(e,0)&&(n=s(e)),!(n=58==e[0]?function(e){if(e){let n,i=0,r=0,s=0,a=0;if(e.split(/\r?\n/).forEach(e=>{var t=/^:10....0[0E]41140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(c(t[1]),16),r=parseInt(c(t[2]),16),s=i+r,n=new Uint8Array(s);else if(0<s&&(t=/^:10....0[0E](.*)(..)$/.exec(e))){let e=t[1];for(;0<s&&0<e.length;)n[a++]=parseInt(e[0]+e[1],16),e=e.slice(2),s--}}),n&&0==s&&a==n.length){var t=new Uint8Array(i),o=new Uint8Array(r);for(let e=0;e<i;++e)t[e]=n[e];for(let e=0;e<r;++e)o[e]=n[i+e];return{meta:l(t),text:o}}}}(l(e)||""):n)||!n.meta||!n.text)return t("This .hex file doesn't contain source.");let r=JSON.parse(n.meta);return r?"LZMA"==r.compression?ce.lzmaDecompressAsync(n.text).then(e=>{var t;return e?(t=e.slice(0,r.headerSize||r.metaSize||0),e=e.slice(t.length),t&&ce.Util.jsonCopyFrom(r,JSON.parse(t)),{meta:r,source:e}):null}):r.compression?t(`Compression type ${r.compression} not supported.`):Promise.resolve({source:l(n.text)}):t("This .hex file is not valid.")}e.PkgConflictError=fe,e.getExtensionInfo=function(t){var e,M={__appVariant:ce.appTargetVariant||""},L="dal.d.ts";let n="/source/",i="",B=[];for(e of t.sortedDeps(!0).sort((e,t)=>"this"==e.id?1:"this"==t.id?-1:ue.strcmp(e.id,t.id)))e.disablesVariant(ce.appTargetVariant)||e.resolvedDependencies().some(e=>e.disablesVariant(ce.appTargetVariant))?(i&&(i+=", "),i+=e.id,ce.debug(`disable variant ${ce.appTargetVariant} due to `+e.id)):(B.push(e),e.addSnapshot(M,[L,".h",".cpp"]));var r,F=JSON.stringify(M),s=le[F];if(s){ce.debug("Using cached extinfo");const t=ue.flatClone(s);return t.disabledDeps=i,t}ce.debug("Generating new extinfo");const g=pxtc.emptyExtInfo();g.disabledDeps=i;let a=ce.appTarget.compileService,o=(a=a||{gittag:"none",serviceId:"nocompile"},a=ue.clone(a),t.getTargetOptions());o=o||{isNative:!1,hasHex:!1,switches:{}};const j=!!a.platformioIni,l="codal"==a.buildEngine||"dockercodal"==a.buildEngine,$="dockermake"==a.buildEngine||"dockercross"==a.buildEngine,H="dockerespidf"==a.buildEngine,b=!(j||l||$||H),G=o.nativeType==pxtc.NATIVE_TYPE_VM;j?n="/src/":l||$?n="/pxtapp/":H&&(n="/main/");let V="// Configuration defines\n",v="\nPXT_SHIMS_BEGIN\n",y="",z="",W='#include "pxt.h"\n',c="",w=e=>c+=`   ${J}(${q}): ${e}
`,q=0,J="",x=de("namespace"),k=de("declare namespace"),A=de("declare namespace"),Y="",K={},X={};const Q={true:"1",false:"0",null:"0",NULL:"0"};function T(e){return e.trim().replace(/[\_\*]$/,"")}for(const t of B){if(0<=t.getFiles().indexOf(L)){const ue=t.host().readFile(t,L);ce.Util.assert(!!ue,"dal.d.ts not found in "+t.id),ue.split(/\r?\n/).forEach(e=>{e=/^\s*(\w+) = (.*),/.exec(e);e&&(Q[e[1]]=e[2])})}for(const ce of t.getFiles())(0<=["Makefile","sdkconfig.defaults","CMakeLists.txt"].indexOf(ce)||ue.endsWith(ce,".mk"))&&(g.generatedFiles["/"+ce]=t.host().readFile(t,ce))}let Z=["0","false","PXT_UTF8"],u={};function ee(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}o.switches.boxDebug&&(u.PXT_BOX_DEBUG=1),o.utf8&&(u.PXT_UTF8=1),o.switches.profile&&(u.PXT_PROFILE=1),o.switches.gcDebug&&(u.PXT_GC_DEBUG=1),o.switches.numFloat&&(u.PXT_USE_FLOAT=1),o.nativeType==pxtc.NATIVE_TYPE_VM&&(u.PXT_VM=1);let E=0,C=!1,S="",I="",P="",U=!1;function te(){k.setNs(""),k.write(""),k.write(""),(P||I)&&(k.write(I),k.write(P),P="",I="")}function ne(e,d){let h,t=(S="",I="",P="",U=!1,-1);function p(){var e=S.replace(/Methods$/,"");return e==S?null:e}function f(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return o.shortPointers&&w("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return T(e)}}function m(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":case"ramint_t":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";case"String":return"S";default:return ue.lookup(K,e)?"I":"_"+e.replace(/[\*_]+$/,"")}}e=e.replace(/^(\s*#\s*if\s+(\w+)\s*$)([^]*?)(^\s*#\s*(elif|else|endif)\s*$)/gm,(e,t,n,i,r)=>0<=Z.indexOf(n)&&!u[n]?t+i.replace(/[^\n]/g,"")+r:e),q=0,C=!1,E=0,A.setNs(""),k.setNs(""),e.split(/\r?\n/).forEach(c=>{++q;var u=ee(c),e=c,i=ee(e);if(C&&0<=i.indexOf("}")&&(C=!1,A.write("}")),C){var r=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(i);if(r){let e=r[1],t=r[3],n="";t?(t=t.trim(),null!=(r=ue.lookup(Q,t))&&(n="  // "+t,t=r),null==(E=he(t))&&w("cannot determine value of "+i)):(E++,t=E+""),A.write(`    ${T(e)} = ${t},`+n)}else A.write(e)}r=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(u);if(r&&(i=r[2],e=r[3],C=!0,E=-1,A.write(""),A.write(""),(P||I)&&(A.write(I),A.write(P),P="",I=""),A.write(`declare const enum ${T(i)} `+e),K[i]=!0,d||(x.setNs(S),x.write(`enum ${r[2]} : int;`))),u=c,!C&&!(/^\s*\/\*\*/.test(u)?(U=!0,I=u+"\n",/\*\//.test(u)&&(U=!1),1):U?(I+=u+"\n",/\*\//.test(u)&&(U=!1),1):/^\s*\/\/%/.test(u)&&(P+=u+"\n",1))){/^typedef.*;\s*$/.test(c)&&(x.setNs(S),x.write(c));let l=/^\s*namespace\s+(\w+)/.exec(c);if(l)S=l[1],p()?(te(),e=p(),k.setNs(S,`declare interface ${e} {`)):(P||I)&&(te(),k.setNs(T(S)),A.setNs(T(S)));else{if((l=/^PXT_ABI\((\w+)\)/.exec(c))&&!G&&(v+=`PXT_FNPTR(::${l[1]}),
`,z+=`extern "C" void ${l[1]}();
`,g.functions.push({name:l[1],argsFmt:[],value:0})),(l=/^\s*PXT_EXPORT\(([:\&\w]+)\)/.exec(c))&&(g.vmPointers||(g.vmPointers=[]),g.vmPointers.push(l[1])),(l=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(c))&&(g.commBase=parseInt(l[1])),l=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(c),!P||!l){if(l=/^\s*extern const (\w+) (\w+);/.exec(c),P&&l)return i={name:S+"::"+l[2],argsFmt:[],value:null},g.functions.push(i),G||(v+="PXT_FNPTR(&::"+i.name+"),\n"),void(P="");if(l=/^\s*(\w+)\s+(\w+)\s*;/.exec(c),P&&l){var u=pxtc.parseCommentString(P),e=(u.indexedInstanceNS&&(h=u,k.setNs(u.indexedInstanceNS),t=0),l[1]),i=l[2];if(h)return P=P.trim(),P+=` fixedInstance shim=${h.indexedInstanceShim}(${t++})`,k.write(""),k.write(I),k.write(P),k.write(`const ${i}: ${f(e)};`),I="",void(P="")}return P&&c.trim()?(w("declaration not understood: "+c),P="",void(I="")):void 0}{h=null;let t=pxtc.parseCommentString(P),e=(S||w("missing namespace declaration"),(l[1]+l[2]).replace(/\s+/g,"")),n=l[3],i=l[4],r=(P=P.trim().replace(/ \w+\.defl=\w+/g,""),[m(e)]),s=[],a=i.split(/,/).filter(e=>!!e).map(e=>{e=function(e,t){t=t.trim();let n=/(.*)=\s*(-?\w+)$/.exec(t),i="",r="";var s;return n&&(i=n[2],r="?",t=n[1].trim()),(n=/^(.*?)(\w+)$/.exec(t))?(s=n[2],e.paramDefl[s]&&(i=e.paramDefl[s],r="?"),e=i?ue.lookup(Q,i):null,(i=null!=e?e:i)&&(null==he(i)&&w("Invalid default value (non-integer): "+i),P+=` ${s}.defl=`+i),{name:s+r,type:n[1]}):(w("invalid argument: "+t),{name:"???",type:"int"})}(t,e);return r.push(m(e.type)),s.push(e.type.replace(/ /g,"")),e.name+": "+f(e.type)}),o={name:S+"::"+n,argsFmt:r,value:null};if(I&&(k.setNs(T(S)),k.write(""),k.write(I),/ImageLiteral/.test(l[4])&&!/imageLiteral=/.test(P)&&(P+=" imageLiteral=1"),P+=" shim="+o.name,k.write(P),n=T(n),p()?((u=(a[0]||"").replace(/^.*:\s*/,"").trim()).toLowerCase()!=p().toLowerCase()&&w(oe("Invalid first argument; should be of type '{0}', but is '{1}'",p(),u)),a.shift(),0==a.length&&/\bproperty\b/.test(P)?k.write(`${n}: ${f(e)};`):k.write(`${n}(${a.join(", ")}): ${f(e)};`)):k.write(`function ${n}(${a.join(", ")}): ${f(e)};`)),I="",P="",d||(x.setNs(S),x.write(`${e} ${n}(${i});`)),g.functions.push(o),b)v+="(uint32_t)(void*)::"+o.name+",\n";else if(G){if(ue.startsWith(o.name,"pxt::op_")||pe[o.name]||t.expose||!ue.startsWith(o.name,"pxt::")&&!ue.startsWith(o.name,"pxtrt::")){const c=function(a,o){if("FiberContext*"==o[0])return"::"+a.name;var e="_wrp_"+a.name.replace(/:/g,"_");if(!X[a.name]){X[a.name]=!0,y+=`
void ${e}(FiberContext *ctx) {
`;var l=o.length;let i=[],r=!1,s="";for(let n=0;n<l;++n){const u=a.argsFmt[n+1],d=o[n];let e="I"==u?"toInt":"B"==u?"numops::toBool":"";var c=n==l-1?"ctx->r0":`ctx->sp[${l-n-2}]`;let t="";switch(d){case"TValue":case"TNumber":break;case"Action":e="asRefAction";break;case"String":e="convertToString",t="ctx, ",r=!0;break;default:e=e||"as"+d.replace(/\*/g,"")}s+=`  ${d} a${n} = (${d}) ${e}(${t}${c});
`,i.push("a"+n)}r&&(y+="  auto prevSP = ctx->sp;\n"),y+=s,r&&(y+="  if (panicCode) { ctx->sp = prevSP; return; }\n");const u=`::${a.name}(${i.join(", ")})`;"V"==a.argsFmt[0]?y=y+`  ${u};
`+"  ctx->r0 = NULL;\n":"I"==a.argsFmt[0]?y+=`  ctx->r0 = fromInt(${u});
`:"B"==a.argsFmt[0]?y+=`  ctx->r0 = fromBool(${u});
`:y+=`  ctx->r0 = (TValue)${u};
`,r&&(y+="  ctx->sp = prevSP;\n"),1<l&&(y+=`  ctx->sp += ${l-1};
`),y+="}\n"}return e}(o,s),d=o.argsFmt.length-1;v+=`{ "${o.name}", (OpFun)(void*)${c}, ${d} },
`}}else v+="PXT_FNPTR(::"+o.name+"),\n"}}}})}const ie=ue.clone(a.yottaConfig||{}),d={},re={},se={};if(b&&o.hasHex&&(s=a,ue.assert(!!s.yottaCorePackage),ue.assert(!!s.githubCorePackage),ue.assert(!!s.gittag),N=s.githubCorePackage+"#"+a.gittag,g.yotta.dependencies[s.yottaCorePackage]=N),t){let e=!1;for(var h of B){c="";{p=void 0;r=void 0;var p=h;const O=p.config.platformio,D=(O&&O.dependencies&&ue.jsonCopyFrom(g.platformio.dependencies,O.dependencies),g.npmDependencies&&p.config.npmDependencies&&ue.jsonCopyFrom(g.npmDependencies,p.config.npmDependencies),p.config.codal);if(l&&D)for(const p of D.libraries||[]){const O=ce.github.parseRepoId(p),D=(O||ue.userError(oe("codal library {0} doesn't look like github repo",p)),ce.github.stringifyRepo(O)),R=ue.lookup(se,O.project);R?ce.github.stringifyRepo(R)!=D&&ue.userError(oe("conflict between codal libraries: {0} and {1}",ce.github.stringifyRepo(R),D)):se[O.project]=O}const R=p.config.yotta;if(R){if(R.dependencies&&ue.jsonCopyFrom(g.yotta.dependencies,R.dependencies),R.config){const ce=ue.jsonFlatten(R.config);for(const O of Object.keys(ce)){const D=ue.lookup(re,O),R=ce[O];if(!D||D.config.yotta.configIsJustDefaults)re[O]=p,ie[O]=R;else if(ie[O]!==R)if(!p.parent.config.yotta||!p.parent.config.yotta.ignoreConflicts)throw(r=new fe(oe("conflict on yotta setting {0} between extensions {1} and {2}",O,p.id,D.id))).pkg0=D,r.pkg1=p,r.settingName=O,r}}if(R.optionalConfig){const ce=ue.jsonFlatten(R.optionalConfig);for(const p of Object.keys(ce)){const ue=ce[p];d[p]=ue}}}}h==t?(e=!0,k.clear(),A.clear()):ue.assert(!e);const de=e=>ue.endsWith(e,".h"),he=".cpp",le=h.getFiles().filter(de).concat(h.getFiles().filter(e=>!de(e)));for(var f of le){const t=de(f);if(t||ue.endsWith(f,".cpp")){let e=h.config.name+"/"+f;("base"==h.config.name||/^core($|---)/.test(h.config.name))&&t&&(e=f),t&&(W+=`#include "${b?n.slice(1):""}${e}"
`);var m=h.readFile(f);null==m&&ue.userError(oe("C++ file {0} is missing in extension {1}.",f,h.config.name)),J=e,ne(m,t),g.extensionFiles[n+e]=m,0==h.level&&(g.onlyPublic=!1),h.verProtocol()&&"pub"!=h.verProtocol()&&"embed"!=h.verProtocol()&&(g.onlyPublic=!1)}(ue.endsWith(f,".c")||ue.endsWith(f,".S")||ue.endsWith(f,".s"))&&(m=h.readFile(f),g.extensionFiles[n+h.config.name+"/"+f.replace(/\.S$/,".s")]=m)}c&&(Y+=oe("Extension {0}:\n",h.id)+c)}e||(k.clear(),A.clear())}function _(t){return Object.keys(g.extensionFiles).concat(Object.keys(g.generatedFiles)).filter(e=>ue.endsWith(e,t)).map(e=>e.slice(1))}Y&&ue.userError(Y),ue.jsonCopyFrom(d,ie),ue.iterMap(d,(e,t)=>{null===t&&delete d[e]}),Object.keys(d).filter(e=>/-/.test(e)).forEach(e=>{var t=d[e];delete d[e],d[e.replace(/-/g,"_")]=t}),!b&&a.yottaConfigCompatibility&&Object.keys(d).forEach(e=>d["YOTTA_CFG_"+e]=d[e]),d.PXT_TARGET=JSON.stringify(ce.appTarget.id);var ae,s=ue.jsonUnFlatten(d);if($){var N={name:"pxt-app",private:!0,dependencies:g.npmDependencies};g.generatedFiles["/package.json"]=JSON.stringify(N,null,4)+"\n"}else if(H){const ce=ue.concatArrayLike([_(".c"),_(".cpp"),_(".s")]).map(e=>e.slice(n.length-1)).concat(["main.cpp"]);ce.push("pointers.cpp"),g.generatedFiles[n+"CMakeLists.txt"]="idf_component_register(\n  SRCS\n"+ce.map(e=>`    "${e}"
`).join("")+'  INCLUDE_DIRS\n    "."\n)\n'}else if(l){let e=a,n=ue.clone(e.codalDefinitions)||{},t=e.codalTarget;"string"==typeof t&&(t+=".json");N={target:t,definitions:n,config:n,application:"pxtapp",output_folder:"build",pxt_gitrepo:e.githubCorePackage,pxt_gittag:e.gittag,libraries:ue.values(se).map(e=>({name:e.project,url:"https://github.com/"+e.fullName,branch:e.tag||"master",type:"git"}))};0==N.libraries.length&&delete N.libraries,ue.iterMap(ue.jsonFlatten(s),(e,t)=>{e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),n[e]=t}),g.generatedFiles["/codal.json"]=JSON.stringify(N,null,4)+"\n",ce.debug("codal.json: "+g.generatedFiles["/codal.json"])}else if(j){const ce=a.platformioIni.slice();ce.push("lib_deps ="),ue.iterMap(g.platformio.dependencies,(e,t)=>{e=/[@#\/]/.test(t)?t:e+"@"+t;ce.push("  "+e)}),g.generatedFiles["/platformio.ini"]=ce.join("\n")+"\n"}else{g.yotta.config=s;let e="pxt-app";N={name:e=a.yottaBinary?a.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""):e,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:g.yotta.dependencies,targetDependencies:{},bin:"./source"};g.generatedFiles["/module.json"]=JSON.stringify(N,null,4)+"\n",ce.debug("module.json: "+g.generatedFiles["/module.json"])}for(ae of Object.keys(u))V+=`#define ${ae} ${u[ae]}
`;if(o.uf2Family&&(V+=`#define PXT_UF2_FAMILY ${o.uf2Family}
`),g.generatedFiles[n+"pointers.cpp"]=W+x.finish()+z+y+v+"\nPXT_SHIMS_END\n",g.generatedFiles[n+"pxtconfig.h"]=V,ce.debug("pxtconfig.h: "+g.generatedFiles[n+"pxtconfig.h"]),b&&(g.generatedFiles["/config.json"]=JSON.stringify(s,null,4)+"\n",ce.debug("yotta config.json: "+g.generatedFiles["/config.json"])),g.generatedFiles[n+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    release_fiber();\n    return 0;   // your program will never reach this line.\n}\n#endif\n',g.generatedFiles["/Makefile"]){let n="",e=(e,t)=>{n+=`${e} = ${_(t).join(" ")}\n`};e("PXT_C",".c"),e("PXT_CPP",".cpp"),e("PXT_S",".s"),e("PXT_HEADERS",".h"),n=n+"PXT_SOURCES := $(PXT_C) $(PXT_S) $(PXT_CPP)\n"+"PXT_OBJS := $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",g.generatedFiles["/Makefile.inc"]=n}g.generatedFiles["/functions.json"]=JSON.stringify(g.functions,null,1);N=g.extensionFiles,ue.jsonCopyFrom(N,g.generatedFiles),s={config:a.serviceId,tag:a.gittag,replaceFiles:N,dependencies:b?g.yotta.dependencies:null},N=JSON.stringify(s);return g.sha=ue.sha256(N),g.skipCloudBuild=!!a.skipCloudBuild,g.compileData=ts.pxtc.encodeBase64(ue.toUTF8(N)),g.shimsDTS=k.finish(),g.enumsDTS=A.finish(),(le=10<Object.keys(le).length?{}:le)[F]=g},e.unpackSourceFromHexFileAsync=function(e){if(e)return ce.Util.fileReadAsBufferAsync(e).then(e=>t(new Uint8Array(e)))},e.unpackSourceFromHexAsync=t}}(pxt=pxt||{}),function(u){{var i=u.hexloader||(u.hexloader={});const t={};let n,s={};function a(e){return t.hasOwnProperty(e.sha)||(t[e.sha]=function(t){let c="";return i.showLoading(u.U.lf("Compiling (this may take a minute)...")),u.tickEvent("cppcompile.start"),((e=t).skipCloudBuild?Promise.resolve({hex:["SKIP"]}):u.webConfig&&u.webConfig.isStatic?u.Util.requestAsync({url:`${u.webConfig.cdnUrl}hexcache/${e.sha}.hex`}).then(e=>{if(e.text){const u={enums:[],functions:[],hex:e.text.split(/\r?\n/)};return Promise.resolve(u)}return u.log("Hex info not found in bundled hex cache"),Promise.resolve()}).catch(e=>(u.log("Error fetching hex info from bundled hex cache"),Promise.resolve())):u.Cloud.localToken&&window&&u.BrowserUtils.isLocalHost()?(e="compile/"+e.sha,u.Cloud.localRequestAsync(e,void 0).then(e=>e.json).then(e=>e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve(void 0)).catch(e=>Promise.resolve(void 0))):Promise.resolve(void 0)).then(e=>{return e?(u.tickEvent("cppcompile.cachehit"),e):(n||(e=u.getOnlineCdnUrl(),n=e?Promise.resolve(e):(e=u.webConfig&&u.webConfig.isStatic,u.Cloud.privateGetAsync("clientconfig",e).then(e=>e.primaryCdnUrl)))).then(e=>(c=e+"/compile/"+t.sha,u.U.httpGetTextAsync(c+".hex"))).then(e=>e,e=>u.Cloud.privatePostAsync("compile/extension",{data:t.compileData},!0).then(l=>new Promise((n,e)=>{let i=0;const r=8e3,s=18e4,a=u.U.now(),o=()=>{if(i++,u.U.now()-a>s)return u.log("abandoning C++ build"),u.tickEvent("cppcompile.cancel",{retry:i}),n(null),null;let t=l.hex.replace(/\.hex/,".json");return u.log(`polling C++ build ${t} (attempt #${i})`),u.tickEvent("cppcompile.poll",{retry:i}),u.Util.httpGetJsonAsync(t).then(e=>{u.log("build log "+t.replace(/\.json$/,".log")),u.tickEvent("cppcompile.done",{success:null!=e&&e.success?1:0,retry:i,duration:u.U.now()-a}),e.success?(u.log("fetching "+c+".hex"),n(u.U.httpGetTextAsync(c+".hex"))):(u.log("build failed"),e.mbedresponse&&e.mbedresponse.result&&e.mbedresponse.result.exception&&u.log(e.mbedresponse.result.exception),n(null))},e=>(u.log(`waiting ${r/1e3|0}s for C++ build...`),setTimeout(o,r),null))};o()}))).then(e=>(i.hideLoading(),{hex:e&&e.split(/\r?\n/)}))}).finally(()=>{i.hideLoading()});var e}(e)),t[e.sha]}function o(n,i,r,e,s=10){return n.cacheStoreAsync(r,e).then(()=>n.cacheGetAsync(i)).then(e=>{let t;try{t=JSON.parse(e||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(e=>e!=r)).unshift(r);e=t.slice(s);return t=t.slice(0,s),u.U.promiseMapAll(e,e=>n.cacheStoreAsync(e,"[]")).then(()=>n.cacheStoreAsync(i,JSON.stringify(t)))})}function l(n,i,r){return n.cacheGetAsync(i).then(e=>{let t;try{t=JSON.parse(e||"[]")}catch(e){return console.error("invalid cache entry, clearing entry"),n.cacheStoreAsync(i,"[]")}return t[0]!=r?((t=t.filter(e=>e!=r)).unshift(r),n.cacheStoreAsync(i,JSON.stringify(t))):null})}i.showLoading=e=>{},i.hideLoading=()=>{},i.storeWithLimitAsync=o,i.recordGetAsync=l,i.getHexInfoAsync=function(i,n,e){if(!n.sha)return Promise.resolve(null);var t=s[n.sha];if(t)return Promise.resolve(t);u.debug("get hex info: "+n.sha);let r="hex-"+n.sha;return i.cacheGetAsync(r).then(e=>{let t;try{t=e?JSON.parse(e):null}catch(e){console.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(u.debug("cache hit, size="+e.length),t.hex=function(i){var s=[];for(let n=0;n<i.length;n++){var a=/^([@!])(....)$/.exec(i[n]);if(a){let e=parseInt(a[2],16),t=i[++n],r="";if("@"==a[1]){r="";let e=parseInt(t,16);for(;0<e--;)r+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else r=ts.pxtc.decodeBase64(t);u.Util.assert(0<r.length),u.Util.assert(r.length%16==0);for(let i=0;i<r.length;){var o=[16,e>>8&255,255&e,0];e+=16;for(let e=0;e<16;++e)o.push(r.charCodeAt(i++));let t=0;for(let e=0;e<o.length;++e)t+=o[e];o.push(255&-t);let n=":";for(let e=0;e<o.length;++e){var l=255&o[e];l<=15&&(n+="0"),n+=l.toString(16)}s.push(n.toUpperCase())}}else s.push(i[n])}return s}(t.hex),l(i,"hex-keys",r).then(()=>t)):a(n).then(e=>{var t=e.hex,n=(e.hex=function(r){let s=[],a=0;for(let i=0;i<r.length;i+=a){let e=-1,n="",t=(a=0,!1);for(;a<500;){var o=/^:10(....)00(.{32})(..)$/.exec(r[i+a]);if(!o)break;var l=o[2],c=/^0+$/.test(l),u=parseInt(o[1],16);if(-1==e)t=c,s.push((t?"@":"!")+o[1]),e=u-16;else{if(c!=t)break;if(e+16!=u)break}t||(n+=l),e=u,a++}if(0==a)s.push(r[i]),a=1;else if(t)s.push(a.toString(16));else{let t="";for(let e=0;e<n.length;e+=2)t+=String.fromCharCode(parseInt(n.slice(e,e+2),16));s.push(ts.pxtc.encodeBase64(t))}}return s}(e.hex),JSON.stringify(e));return e.hex=t,o(i,"hex-keys",r,n).then(()=>e)}).catch(e=>(u.reportException(e,{sha:n.sha}),Promise.resolve(null)))}).then(e=>(e&&((s=20<Object.keys(s).length?{}:s)[n.sha]=e),e))}}}(pxt=pxt||{}),function(p){function f(e,t,n={},i=null,r=null){if(s.testMode||e==s.TEST_KEY){const p={success:!0};return Promise.resolve({statusCode:200,headers:{},text:JSON.stringify(p),json:p})}return p.Util.multipartPostAsync(t,n,i,r)}function m(e,t,n,i,r){p.Util.assert(!!t&&!!n&&!!i);t="https://api.crowdin.com/api/project/"+t+"/";return r=r||{},s.testMode?delete r.key:r.key=n,e&&(r.branch=e),t+i+"?"+Object.keys(r).map(e=>e+"="+encodeURIComponent(r[e])).join("&")}function e(e){let t=0;return function(){if(10<t++)throw new Error("Too many API calls for "+e)}}function g(n,i,r,s,a){return s=t(s),p.debug(`create directory ${n||""}/`+s),a=a||e(s),f(r,m(n,i,r,"add-directory"),{json:"true",name:s}).then(e=>{if(p.debug("crowdin resp: "+e.statusCode),200==e.statusCode||400==e.statusCode)return Promise.resolve();if(500==e.statusCode&&e.text&&50===JSON.parse(e.text).error.code)return p.log("directory already exists"),Promise.resolve();var t=e.json||JSON.parse(e.text)||{error:{}};if(404==e.statusCode&&17==t.error.code){p.log("parent directory missing for "+s);const e=s.replace(/\/[^\/]+$/,"");if(e!=s)return g(n,i,r,e,a).then(()=>g(n,i,r,s,a))}throw new Error(`cannot create directory ${n||""}/${s}: ${e.statusCode} `+JSON.stringify(t))})}function t(e){return e.replace(/\\/g,"/")}function i(t,n){const i=p.appTarget.versions.pxtCrowdinBranch||"",r=p.appTarget.versions.targetCrowdinBranch||"";let s=[];if(t.forEach(e=>function t(n,i,r,s){const e=i.name,a=r?r+"/"+e:e;switch(i.fullName=a,i.branch=s||"",i.node_type){case"file":n.push(i);break;case"directory":(i.files||[]).forEach(e=>t(n,e,a,s));break;case"branch":(i.files||[]).forEach(e=>t(n,e,r,i.name))}}(s,e,"")),s=s.filter(e=>e.fullName.indexOf("/")<0?e.branch==i:e.branch==r),n&&(s=s.filter(e=>0==e.fullName.indexOf(n))),"core"!=p.appTarget.id){const t=p.appTarget.id+"/";s=s.filter(e=>e.fullName.indexOf("/")<0||e.fullName.substr(0,t.length)==t||0<=e.fullName.indexOf("common-docs"))}return s}function r(e,t){e=m("",e,t,"info",{json:"true"});return p.Util.httpGetTextAsync(e).then(e=>JSON.parse(e))}var s;(s=p.crowdin||(p.crowdin={})).KEY_VARIABLE="CROWDIN_KEY",s.testMode=!1,s.TEST_KEY="!!!testmode!!!",s.setTestMode=function(){p.crowdin.testMode=!0,p.log("CROWDIN TEST MODE - files will NOT be uploaded")},s.downloadTranslationsAsync=function(s,a,o,l,c={}){const e=m(s,a,o,"info",{json:"true"}),u={};return l=t(l),p.Util.httpGetTextAsync(e).then(e=>{e=JSON.parse(e);if(!e)throw new Error("info failed");let i=e.languages.filter(e=>"en"!=e.code);p.appTarget&&p.appTarget.appTheme&&p.appTarget.appTheme.availableLocales&&(i=i.filter(e=>-1<p.appTarget.appTheme.availableLocales.indexOf(e.code))),p.log("languages: "+i.map(e=>e.code).join(", "));const r=()=>{const t=i.pop();if(!t)return Promise.resolve();const n=m(s,a,o,"export-file",{file:l,language:t.code,export_translated_only:c.translatedOnly?"1":"0",export_approved_only:c.validatedOnly?"1":"0"});return p.log(`downloading ${t.name} - ${t.code} (${i.length} more)`),p.Util.httpGetTextAsync(n).then(e=>{try{const p=JSON.parse(e);p&&(u[t.code]=p)}catch(e){p.log(n+" "+e)}return r()}).then(()=>p.Util.delay(1e3))};return r()}).then(()=>u)},s.createDirectoryAsync=g,s.uploadTranslationAsync=function s(a,o,l,c,u){p.Util.assert(!!o),p.Util.assert(!!l);const d=e(c=t(c));function h(){return function r(e,t){return t.type="auto",t.json="",t.escape_quotes="0",d(),f(l,m(a,o,l,e),t,c,u).then(e=>{{var t;const n=e.statusCode,i=p.Util.jsonTryParse(e.text)||{};if(p.debug("upload result: "+n),404==n&&i.error&&8==i.error.code)return p.log("create new translation file: "+c),r("add-file",{});if(404==n&&17==(null==(t=i.error)?void 0:t.code))return g(a,o,l,c.replace(/\/[^\/]+$/,""),d).then(()=>h());if(i.success||53!=(null==(t=i.error)?void 0:t.code)){if(429==n&&55==(null==(t=i.error)?void 0:t.code))return p.log("Maximum concurrent requests reached, waiting 10s and retry..."),p.U.delay(1e4).then(()=>s(a,o,l,c,u));if(200==n||i.success)return Promise.resolve();throw new Error(`Error, upload translation: ${c}, ${n}, `+e.text)}return p.log(c+" being updated, waiting 5s and retry..."),p.U.delay(5e3).then(()=>s(a,o,l,c,u))}})}("update-file",{update_option:"update_as_unapproved"})}return h()},s.projectInfoAsync=r,s.listFilesAsync=function(e,t,n){return p.log("crowdin: listing files under "+n),r(e,t).then(e=>{if(e)return e=i(e.files,n),p.debug(`crowdin: found ${e.length} under `+n),e.map(e=>({fullName:e.fullName,branch:e.branch||""}));throw new Error("info failed")})},s.languageStatsAsync=function(e,t,n){e=m("",e,t,"language-status",{language:n,json:"true"});return p.Util.httpGetJsonAsync(e).then(e=>i(e.files))},s.inContextLoadAsync=function(i){const r=document.createElement("input");r.type="text",r.setAttribute("class","hidden"),r.value=i;var e=new Promise((t,e)=>{const n=new MutationObserver(()=>{var e;i!=r.value&&(e=p.Util.rlf(r.value),r.remove(),n.disconnect(),t(e))});n.observe(r,{attributes:!0})});return document.body.appendChild(r),e}}(pxt=pxt||{}),function(f){function E(e){return e?e.split(/\r?\n/):[]}function m(e,i,r={}){r.ignoreWhitespace&&(e=e.replace(/[\r\n]+$/,""),i=i.replace(/[\r\n]+$/,""));const s=E(e),a=E(i),o=Math.min(r.maxDiffSize||1024,s.length+a.length);if(0==o)return[];const l=65520<s.length?Uint32Array:Uint16Array,c={};let u=0;const d=t(s),h=t(a);function t(e){var t,n=new l(e.length);let i=0;for(t of e)r.ignoreWhitespace&&(t=t.replace(/\s+$/g,"").replace(/^\s+/g,"")),c.hasOwnProperty(t)?n[i]=c[t]:(++u,n[i]=u,c[t]=u),i++;return n}var n=new l(2*o+1);let p=-1;for(let e=0;e<=o;e++)null!=T(e,n)&&(p=e);if(-1==p)return null;var f=[];let m=null;for(let e=0;e<=p;e++){const i=f.length?f[f.length-1].slice(0):new l(2*p+1);if(f.push(i),null!=(m=T(e,i)))break}var g=[];let b=m;for(let n=f.length-1;0<=n;n--){const i=f[n];let t=0,e=0;var v=(t=b==-n||b!=n&&i[o+b-1]<i[o+b+1]?(e=b+1,i[o+e]):(e=b-1,i[o+e]+1))-b;for(let e=i[o+b]-t-1;0<=e;--e)g.push("  "+a[v+e]);e==b-1?g.push("- "+s[t-1]):0<v&&g.push("+ "+a[v-1]),b=e}if(g.reverse(),r.context==1/0||r.full)return g;let y=1,w=1,x=0;for(var k=[],A=r.context||3;x<g.length;){let e=x;for(;e<g.length&&" "==g[e][0];)e++;if(e==g.length)break;const i=e-A,E=i-x,r=(0<E&&(y+=E,w+=E,x=i),k.length),s=y,a=w;k.push("@@");let t=x,n=0;for(;t<g.length;){if(" "==g[t][0]){if(++n>2*A+2){t-=A+2;break}}else n=0;t++}for(;x<t;){switch(k.push(g[x]),g[x][0]){case"-":y++;break;case"+":w++;break;case" ":y++,w++}x++}k[r]=`@@ -${s},${y-s} +${a},${w-a} @@`}return k;function T(i,r){for(let n=-i;n<=i;n+=2){let e=0,t=(e=n==-i||n!=i&&r[o+n-1]<r[o+n+1]?r[o+n+1]:r[o+n-1]+1)-n;for(;e<d.length&&t<h.length&&d[e]==h[t];)e++,t++;if((r[o+n]=e)>=d.length&&t>=h.length)return n}return null}}function s(e){return E(e).map(e=>e.replace(/;\s*$/,"")).join("\n")}function g(e){e=/^@@ -(\d+),(\d+) \+(\d+),(\d+)/.exec(e);return e&&{oldStart:parseInt(e[1])-1,oldLength:parseInt(e[2]),newStart:parseInt(e[3])-1,newLength:parseInt(e[4])}}var e;(e=f.diff||(f.diff={})).toLines=E,e.compute=m,e.diff3=function(e,t,n,l,c){var u=i(e),d=i(n);if(u&&d){var h=E(e),p=E(n);let r=0,s=[],a=0,o=0;for(let i=0;i<u.length-1;)if(u[i]==a&&d[i]==o)s.push(h[a]),a++,o++,i++;else{let e=!0,t=!0,n=i;for(;n<u.length&&(u[n]!=a+n-i&&(e=!1),d[n]!=o+n-i&&(t=!1),null==u[n]||null==d[n]);)n++;if(f.U.assert(n<u.length),e)for(;o<d[n];)s.push(p[o++]);else if(t)for(;a<u[n];)s.push(h[a++]);else if(h.slice(a,u[n]).join("\n")==p.slice(o,d[n]).join("\n"))for(;a<u[n];)s.push(h[a++]);else{for(r++,s.push("<<<<<<< "+l);a<u[n];)s.push(h[a++]);for(s.push("=======");o<d[n];)s.push(p[o++]);s.push(">>>>>>> "+c)}i=n,a=u[n],o=d[n]}return{merged:s.join("\n"),numConflicts:r};function i(n){n=m(t,n,{context:1/0});if(n){var i,r=[];let e=0,t=0;for(i of n)"+"==i[0]?e++:"-"==i[0]?(r[t]=null,t++):" "==i[0]?(r[t]=e,e++,t++):f.U.oops();return r.push(e+1),r}}}},e.removeTrailingSemiColumns=s,e.split=function(e,t){var n=e.split(/-{10,}/,2);if(n.length<2)return{fileA:e,fileB:void 0};let i=n[0].replace(/\n$/,""),r=n[1].replace(/^\n/,"");return t&&t.removeTrailingSemiColumns&&(i=s(i),r=s(r)),{fileA:i,fileB:r}},e.parseDiffMarker=g,e.render=function(e,t,a={}){const o=m(e,t,a);if(!o)return f.dom.el("div",null,pxtc.Util.lf("Too many differences to render diff."));const l={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"};let c=0,u=0,d="";const h=f.dom.el("tbody"),n=f.dom.el("table",{class:"diffview "+(a.update?"update":"")},h);let p=null;return o.forEach((e,t)=>{var n=g(e),n=(n?(c=n.oldStart,u=n.newStart):("+"!=e[0]&&c++,"-"!=e[0]&&u++),o[t+1]?o[t+1][0]:""),i=o[t+2]?o[t+2][0]:"",r=e.slice(2);let s=f.dom.el("code",null,r);if(p)s=p,p=null;else if(!("-"!=e[0]||" "!=d&&"@"!=d||"+"!=n||" "!=i&&"@"!=i&&""!=i)){const a=function(e,t){var n=m(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!n)return{a:f.dom.el("div",{class:"inline-diff"},f.dom.el("code",null,e)),b:f.dom.el("div",{class:"inline-diff"},f.dom.el("code",null,t))};var i=[],r=[];for(let t=0;t<n.length;){let e=t;const m=n[t][0];for(;n[e]&&n[e][0]==m;)e++;var s=n.slice(t,e).map(e=>e.slice(2)).join("");" "==m?(i.push(f.dom.el("code",{class:"ch-common"},s)),r.push(f.dom.el("code",{class:"ch-common"},s))):"-"==m?i.push(f.dom.el("code",{class:"ch-removed"},s)):"+"==m?r.push(f.dom.el("code",{class:"ch-added"},s)):f.Util.oops(),t=e}return{a:f.dom.el("div",{class:"inline-diff"},i),b:f.dom.el("div",{class:"inline-diff"},r)}}(e.slice(2),o[t+1].slice(2));s=a.a,p=a.b}d=e[0],a.hideMarkerLine&&"@"==d||a.hideRemoved&&"-"==d||(r="@"==d,n=""+l[d],h.appendChild(f.dom.el("tr",{class:n},[!a.hideLineNumbers&&f.dom.el("td",{class:"line-a","data-content":c}),!a.hideLineNumbers&&f.dom.el("td",{class:"line-b","data-content":u}),r&&f.dom.el("td",{colspan:2,class:"change"},f.dom.el("code",null,e)),!a.hideMarker&&!r&&f.dom.el("td",{class:"marker","data-content":d}),!r&&f.dom.el("td",{class:"change"},s)])))}),n},e.resolveMergeConflictMarker=function(e,t,n,i){let r=f.diff.toLines(e),s=t;for(;s<r.length&&!/^<<<<<<<[^<]/.test(r[s]);)s++;let a=s+1;for(;a<r.length&&!/^=======$/.test(r[a]);)a++;let o=a+1;for(;o<r.length&&!/^>>>>>>>[^>]/.test(r[o]);)o++;if(o>=r.length)return f.debug(`diff marker mistmatch: ${r.length} -> ${s} ${a} `+o),e;if(r[s]=void 0,r[a]=void 0,r[o]=void 0,!n)for(let e=s;e<=a;++e)r[e]=void 0;if(!i)for(let e=a;e<=o;++e)r[e]=void 0;return r.filter(e=>void 0!==e).join("\n")},e.mergeDiff3Config=function(e,t,n){let i=f.Util.jsonTryParse(e),r=f.Util.jsonTryParse(t),s=f.Util.jsonTryParse(n);if(i&&!s)return e;if(!i)return n||t;if(!r&&s&&(r=s),i&&r&&s){delete i.installedVersion,delete r.installedVersion,delete s.installedVersion;const d={},h=f.U.unique(Object.keys(r).concat(Object.keys(i)).concat(Object.keys(s)),e=>e);for(const e of h){const t=i[e],n=r[e],h=s[e];if(JSON.stringify(t)==JSON.stringify(h))void 0!==t&&(d[e]=t);else switch(e){case"name":d[e]=(a=t,o=n,l=h,a==o||l!=o&&a==lf("Untitled")?l:a);break;case"version":d[e]=0<f.semver.strcmp(t,h)?t:h;break;case"languageRestriction":case"preferredEditor":case"targetVersion":d[e]=t;break;case"public":d[e]=t&&h;break;case"files":case"testFiles":{const f=c(t||[],n||[],h||[]);if(!f)return;d[e]=f.length?f:void 0;break}case"dependencies":case"testDependencies":{const f=u(t||{},n||{},h||{});if(Object.keys(f).length)return;d[e]=f;break}case"description":if(t&&!h)d[e]=t;else{if(t||!h)return;d[e]=h}break;default:return}}var a,o,l;return f.Package.stringifyConfig(d);function c(e,t,n){const i=[],r=f.U.unique(t.concat(e).concat(n),e=>e);for(const f of r){const r=-1<e.indexOf(f),s=-1<n.indexOf(f),a=-1<t.indexOf(f);r==s||s==a?r&&i.push(f):s&&i.push(f)}return i}function u(e,t,n){const i={},r=f.U.unique(Object.keys(t).concat(Object.keys(e)).concat(Object.keys(n)),e=>e);for(const s of r){const r=e[s],a=n[s],o=t[s];if(r==a)r&&(i[s]=r);else{const e=f.github.parseRepoId(r),t=f.github.parseRepoId(a);if(e&&t&&f.semver.tryParse(e.tag)&&f.semver.tryParse(t.tag)&&e.owner&&e.project&&e.owner==t.owner&&e.project==t.project){const n=(0<f.semver.strcmp(e.tag,t.tag)?e:t).tag;i[s]=`github:${e.owner}/${e.project}#`+n}else a==o?r&&(i[s]=r):a&&(i[s]=a)}}return i}}},e.hasMergeConflictMarker=function(e){return e&&/^(<<<<<<<[^<]|>>>>>>>[^>])/m.test(e)},e.reconstructConfig=function(t,n,e,i){let r={},s=e.tree.tree.map(e=>e.path).filter(e=>/\.(ts|blocks|md|jres|asm|json)$/.test(e)).filter(e=>e!=f.CONFIG_NAME);return(s=t.fileName?s.filter(e=>0===e.indexOf(t.fileName)).map(e=>e.slice(t.fileName.length+1)):s).find(e=>/\.ts$/.test(e))||(i.config.files.filter(e=>s.indexOf(e)<0).forEach(e=>{s.push(e),n[e]=i.files[e]}),f.Util.jsonCopyFrom(r,i.config.dependencies)),Object.keys(r).length||(r[f.appTarget.corepkg]="*"),{name:"",files:s,dependencies:r,preferredEditor:s.find(e=>/.blocks$/.test(e))?f.BLOCKS_PROJECT_NAME:f.JAVASCRIPT_PROJECT_NAME}}}(pxt=pxt||{}),function(i){var e;(e=i.discourse||(i.discourse={})).extractSharedIdFromPostUrl=function(e){return i.Util.httpGetJsonAsync(e+".json").then(e=>e.post_stream&&e.post_stream.posts&&e.post_stream.posts[0]&&e.post_stream.posts[0].link_counts.map(e=>i.Cloud.parseScriptId(e.url)).filter(e=>!!e)[0])},e.topicsByTag=function(n,e){e=`${n=n.replace(/\/$/,"")}/tag/${e}.json`;return i.Util.httpGetJsonAsync(e).then(e=>{const t=i.Util.toDictionary(e.users,e=>e.id.toString());return e.topic_list.topics.map(e=>({id:e.id,title:e.title,url:`${n}/t/${e.slug}/`+e.id,imageUrl:e.image_url,author:t[e.posters[0].user_id].username,cardType:"forumUrl"}))})}}(pxt=pxt||{}),function(o){{var w=o.docs||(o.docs={}),T=pxtc.Util;let y,x={},k={};var e="\x3c!-- @CMD@ @ARGS@ --\x3e";let A={parent:e,short:e,description:"\x3c!-- desc --\x3e",activities:"\x3c!-- activities --\x3e",explicitHints:"\x3c!-- hints --\x3e",flyoutOnly:"\x3c!-- flyout --\x3e",hideIteration:"\x3c!-- iter --\x3e",codeStart:"\x3c!-- start --\x3e",codeStop:"\x3c!-- stop --\x3e",autoOpen:"\x3c!-- autoOpen --\x3e",autoexpandOff:"\x3c!-- autoexpandOff --\x3e",preferredEditor:"\x3c!-- preferredEditor --\x3e",tutorialCodeValidation:"\x3c!-- tutorialCodeValidation --\x3e"};function t(e,t,n){return e.split(t).join(n)}function n(e){return e=t(e,"&","&amp;"),e=t(e,"<","&lt;"),e=t(e,">","&gt;"),e=t(e,'"',"&quot;"),t(e,"'","&#39;")}function E(e){return e&&n(e.replace(/\&([#a-z0-9A-Z]+);/g,(e,t)=>{switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}}))}w.htmlQuote=n,w.html2Quote=E;const _=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}],N=(w.requireMarked=()=>"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0,w.requireDOMSanitizer=()=>"undefined"!=typeof DOMPurify?DOMPurify.sanitize:"undefined"!=typeof require?require("DOMPurify").sanitize:void 0,e=>`<div class='ui negative message'>${n(e)}</div>`);function C(r){let s=T.clone(x),a=T.clone(k),o=T.clone(A),l={},c={},n=r.params,e=r.theme,u=(r.boxes=s,r.macros=a,r.settings=o,r.html=r.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,(e,t,n)=>{var t=function(t){for(var n,i={};t.trim();){let e=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(t);e?(n=e[3]||e[4]||e[5]||"",i[e[1].toLowerCase()]=n):i[(e=/^\s*(\S+)/.exec(t))[1]]="true",t=t.slice(e[0].length)}return i}(t),i=t["data-name"]||t.id;return i?(/box/.test(t.class)?s[i]=n:/aside/.test(t.class)?s[i]=`<!-- BEGIN-ASIDE ${i} -->${n}<!-- END-ASIDE -->`:/setting/.test(t.class)?o[i]=n:/menu/.test(t.class)?l[i]=n:/toc/.test(t.class)?c[i]=n:a[i]=n,`<!-- macro ${i} -->`):N("id or data-name missing on macro")}),(e,t)=>{let n=l.item,i={NAME:e.name};if(e.subitems)n=l["toc-dropdown"]||(0==t?l["top-dropdown"]:l["inner-dropdown"]),i.ITEMS=e.subitems.map(e=>u(e,t+1)).join("\n");else{if(/^-+$/.test(e.name)&&(n=l.divider),e.path&&!/^(https?:|\/)/.test(e.path))return N("Invalid link: "+e.path);i.LINK=e.path}return P(n,i,["ITEMS"])}),d=[{name:lf("Docs"),href:"/docs"}];var i=r.TOC||e.TOC||[];let h=[],p=e=>{for(var t of e.subitems||[])if(p(t))return h.push(e),!0;return!(!r.filepath||!e.path||0!=r.filepath.indexOf(e.path)||(h.push(e),0))},f=(i.forEach(p),(e,t)=>{let n=c.item,i={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?N("Invalid link: "+e.path):(/^\//.test(e.path)&&r.versionPath&&(e.path="/"+r.versionPath+e.path),i.LINK=e.path,0<=h.indexOf(e)?(i.ACTIVE="active",i.EXPANDED="true",d.push({name:e.name,href:e.path})):i.EXPANDED="false",e.subitems&&0<e.subitems.length?(n=c["toc-dropdown"]?""!==e.name?c["toc-dropdown"]:c["toc-dropdown-noLink"]:0==t?""!==e.name?c["top-dropdown"]:c["top-dropdown-noHeading"]:1==t?c["inner-dropdown"]:c["nested-dropdown"],i.ITEMS=e.subitems.map(e=>f(e,t+1)).join("\n")):/^-+$/.test(e.name)&&(n=c.divider),P(n,i,["ITEMS"]))}),t=(n.menu=(e.docMenu||[]).map(e=>u(e,0)).join("\n"),n.TOC=i.map(e=>f(e,0)).join("\n"),e.appStoreID&&(n.appstoremeta=`<meta name="apple-itunes-app" content="app-id=${T.htmlEscape(e.appStoreID)}"/>`),"");1<d.length&&(t=`
            <nav class="ui breadcrumb" aria-label="${lf("Breadcrumb")}">
                ${d.map((e,t)=>`<a class="${t==d.length-1?"active":""} section"
                        href="${E(e.href)}" aria-current="${t==d.length-1?"page":""}">${E(e.name)}</a>`).join('<i class="right chevron icon divider"></i>')}
            </nav>`),n.breadcrumb=t,e.boardName&&(n.boardname=E(e.boardName)),e.boardNickname&&(n.boardnickname=E(e.boardNickname)),e.driveDisplayName&&(n.drivename=E(e.driveDisplayName)),e.homeUrl&&(n.homeurl=E(e.homeUrl)),n.targetid=e.id||"???",n.targetname=e.name||"Microsoft MakeCode",n.docsheader=e.docsHeader||"Documentation",n.orgtitle="MakeCode";var i=e.docsLogo&&T.htmlEscape(e.docsLogo),m=(e.organizationWideLogo||e.organizationLogo)&&T.htmlEscape(e.organizationWideLogo||e.organizationLogo),g=e.organizationLogo&&T.htmlEscape(e.organizationLogo),i=(n.targetlogo=i?`<img aria-hidden="true" role="presentation" class="ui ${e.logoWide?"small":"mini"} image" src="${i}" />`:"",n.orglogo=m?`<img aria-hidden="true" role="presentation" class="ui image" src="${m}" />`:"",n.orglogomobile=g?`<img aria-hidden="true" role="presentation" class="ui image" src="${g}" />`:"",r.ghEditURLs||[]);if(i.length){let e='<p style="margin-top:1em">\n',t=lf("Edit this page on GitHub");for(var b of i)e+=`<a href="${b}"><i class="write icon"></i>${t}</a><br>
`,t=lf("Edit template of this page on GitHub");e+="</p>\n",n.github=e}else n.github="";var v,m=`
            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">${lf("Skip to main content")}</a>
        `,g=(n.accMenu=m,lf("Print this page")),i=(n.printBtn=`
            <button id="printbtn" class="circular ui icon right floated button hideprint" title="${g}" aria-label="${g}">
                <i class="icon print"></i>
            </button>
        `,`
            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="${lf("Side menu")}" role="menuitem" aria-expanded="false">
                <i class="content icon"></i>
            </a>
        `),m=(n.sidebarToggle=i,["tocsearch1","tocsearch2"].map(e=>`
                <input type="search" name="q" placeholder="${lf("Search...")}" aria-label="${lf("Search Documentation")}">
                <i onclick="document.getElementById('${e}').submit();" tabindex="0" class="search link icon" aria-label="${lf("Search")}" role="button"></i>
            `));n.searchBar1=m[0],n.searchBar2=m[1];let y="";e.accentColor&&(y+=`
.ui.accent { color: ${e.accentColor}; }
.ui.inverted.accent { background: ${e.accentColor}; }
`),n.targetstyle=y,n.tocclass=e.lightToc?"lighttoc":"inverted";for(v of Object.keys(e)){var w=e[v];void 0===n[v]&&"string"==typeof w&&(n[v]=w)}r.finish=()=>P(r.html,n,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","orglogo","orglogomobile","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}function S(e){e.image=function(e,t,n){let i='<img class="ui image" src="'+e+'" alt="'+n+'"';return t&&(i+=' title="'+t+'"'),i=(i+=' loading="lazy"')+(this.options.xhtml?"/>":">")},e.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?`<li class="${" "==t[1]?"unchecked":"checked"}">`+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},e.heading=function(e,t,n){let i=/(.*)#([\w\-]+)\s*$/.exec(e),r="";return r=i?(e=i[1],i[2]):n.toLowerCase().replace(/[^\w]+/g,"-"),(e=(e=e&&e.replace(/@(fullscreen|unplugged|showdialog|showhint)/gi,"")).trim()).match(/^\{([\s\S]+)\}$/)&&(e=e.substr(1,e.length-2)),`<h${t} id="${this.options.headerPrefix}${r}">${e}</h${t}>`}}function I(e,r){return e.replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,(e,t,n,i)=>"ifdef"==t&&r[n]||"ifndef"==t&&!r[n]?`<!-- ${t} ${n} -->${i}<!-- endif -->`:`<!-- ${t} ${n} endif -->`)}function P(e,i,r=[]){return e?e.replace(/@(\w+)@/g,(e,t)=>{let n=T.lookup(i,t)||"";return n+="",n=r.indexOf(t)<0?E(n):n}):""}w.prepTemplate=C,w.setupRenderer=S,w.renderConditionalMacros=I,w.renderMarkdown=function(a){let e=!0,o=(a.pubinfo||(e=!1,a.pubinfo={}),a.pubinfo);a.theme||(a.theme={}),delete a.pubinfo.private,o.time&&(n=parseInt(o.time),o.timems||(o.timems=1e3*n+""),o.humantime||(o.humantime=T.isoTime(n))),o.name&&(o.dirname=o.name.replace(/[^A-Za-z0-9_]/g,"-"),o.title=o.name),e&&(o.JSON=JSON.stringify(o,null,4).replace(/</g,"\\u003c"));let t=a.template,l=(t=I(t=t.replace(/<!--\s*@include\s+(\S+)\s*-->/g,(e,t)=>"\x3c!-- include "+t+" --\x3e\n"+((a.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"),o),{html:t=a.locale?U(t,a.locale).text:t,theme:a.theme,filepath:a.filepath,versionPath:a.versionPath,ghEditURLs:a.ghEditURLs,params:o,TOC:a.TOC}),s=(C(l),new(y=y||w.requireMarked()).Renderer);S(s);const c=s.link;s.link=function(e,t,n){var i=new RegExp("^[/#]").test(e),r=i?"":"_blank";return i&&l.versionPath&&(e="/"+l.versionPath+e),c.call(s,e,t,n).replace(/^<a /,`<a ${r?`target="${r}"`:""} rel="nofollow noopener" `)};var n=w.requireDOMSanitizer();y.setOptions({renderer:s,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:n,smartLists:!0,smartypants:!0});let i=a.markdown,r=(a.repo&&(i+=`
\`\`\`package
${a.repo.name.replace(/^pxt-/,"")}=github:${a.repo.fullName}#${a.repo.tag||"master"}
\`\`\`
`),i=(i=i.replace(/^\s*https?:\/\/(\S+)\s*$/gm,(e,t)=>{for(var i of _){let n=i.rx.exec(t);if(n)return i.cmd.replace(/\$(\d+)/g,(e,t)=>n[parseInt(t)]||"")+"\n"}return e})).replace(/@([a-z]+)@/gi,(e,t)=>{var n=o[t];return!n&&a.throwOnError&&T.userError("unknown macro "+t),n||"unknown macro"}),y(i)),u=(r=(r=r.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/(<img [^>]* src=")\/docs\/static\/([^">]+)"/g,(e,t,n)=>t+"/static/"+n+'"'),""),d=0;function h(e,t,n){let i=n;return e<=d&&(i=u+i,u="",d=0),i}r=r.replace(/<h(\d)[^>]+>\s*([~@])?\s*(.*?)<\/h\d>/g,(e,t,n,i)=>{var r,s=/^(\w+)\s+(.*)/.exec(i),i=s?s[1]:i,s=E(s?s[2]:""),i=E(i);if(t=parseInt(t),n){if("@"==n){let e=T.lookup(l.settings,i);if(null!=e)o[i]=s;else if(null==(e=T.lookup(l.macros,i)))return a.throwOnError&&T.userError("Unknown command: @"+i),N("Unknown command: @"+i);return h(t,0,P(e,{ARGS:s,CMD:i},["ARGS","CMD"]))}return i?(n=T.lookup(l.boxes,i))?(s=h(t,0,(r=n.split("@BODY@"))[0].replace("@ARGS@",s)),u=r[1],(r=n.match(/data-[^>\s]+/gi))&&0<=r.indexOf("data-inferred")&&(d=t),s):(a.throwOnError&&T.userError("Unknown box: ~ "+i),N("Unknown box: ~ "+i)):(n=u,u="",n)}return h(t,0,e)}),u&&(r+=u),o.title||(n=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(r))&&(o.title=E(n[1])),o.description||(n=/<p>([^]+?)<\/p>/.exec(r))&&(o.description=E(n[1]));var p,f,m,g,n=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(r)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(r);n&&(o.cardLogo=E(n[1])),o.twitter=E(a.theme.twitter||"@msmakecode");let b={main:""};r=(r=r.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,(e,t,n)=>{var i=T.lookup(b,t);return b[t]=(i||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),b.main=r,r="";for(p of Object.keys(b))r+=(f=p+"-container",m=b[p],P(l.boxes[f]||"@BODY@",{BODY:m},["BODY"]));o.body=r,o.name=o.title||"";for(g of Object.keys(a.theme)){var v=a.theme[g];"string"==typeof v&&(o["theme_"+g]=v)}return l.finish()},w.embedUrl=function(e,t,n,i){return`<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e+`#${t}:`+n}" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>`},w.runUrl=function(e,t,n){return`<div style="position:relative;height:0;padding-bottom:${t};overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e}?id=${encodeURIComponent(n)}" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>`},w.codeEmbedUrl=function(e,t,n){e=e+"---codeembed#pub:"+t;return`<div style="position:relative;height:calc(${n=Math.ceil(n||300)}px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e}" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>`};const l={b:1,strong:1,em:1};function U(e,i){const r={};function s(e){let t=/^(\s*)([^]*?)(\s*)$/.exec(e),n=t[2].replace(/\s+/g," ");return""==n||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(n)?null:((e=T.lookup(i,n))?n=e:r[n]="",t[1]+n+t[3])}function a(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+e.replace(/<([\/\w]+)([^<>]*)>/g,(e,t,n)=>{var i=t.replace(/^\//,"").toLowerCase();return 1===l[i]?"&llt;"+t+n+"&ggt;":e})).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,(e,t,n,i,r)=>{return"script"==n||"style"==n||null==(n=s(a(r)))?a(e):t+n})).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,(e,t,n,i)=>null==s(i)?e:t+n+'="'+i.replace(/"/g,"''")+'"')).replace(/^<start>/g,""),missing:r}}function b(e,i){let t=0,r=[{level:0,id:"",title:"",start:t,text:"",children:[]}],n=(e=e.replace(/\r/g,"")).split(/\n/),s={};for(var a of n){let e=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(a),n=null;if(i&&e)if(e[4])if(s[e[4]])e=null;else{n=function e(t,n){if(t.id==n)return t;for(var i of t.children)if(i=e(i,n))return i;return null}(i,e[4]);let t=e=>{e.id&&(s[e.id]=!0),e.children.forEach(t)};n&&t(n)}else e=null;if(e){var o={level:i?1:e[1].length,title:e[2].trim(),id:e[4]||"",start:t,text:"",children:[]};if(n){a="";for(let e=0;e<n.level;++e)a+="#";a=(a=(a+=" ")+(o.title||n.title))+(" #"+o.id)}for(;r[r.length-1].level>=o.level;)r.pop();r[r.length-1].children.push(o),r.push(o)}r[r.length-1].text+=a+"\n",t++}return r[0]}w.translate=U,w.buildTOC=function(e){if(!e)return null;var t=o.docs.requireMarked(),n=w.requireDOMSanitizer(),n={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:n,smartLists:!1,smartypants:!1};let i={name:"dummy",subitems:[]},r=[],s=(r.push(i),t.lexer(e,n)),a=!1;s.forEach(e=>{switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":a=!0;var t={name:"",path:"",subitems:[]};return void r.push(t);case"text":let i=r[r.length-1];0<=e.text.indexOf("[")?e.text.replace(/\[(.*?)\]\((.*?)\)/i,function(e,t,n){i.name=t,i.path=n.replace(".md","")}):a&&(i.name=e.text);break;case"list_item_end":case"loose_item_end":t=r.pop();r[r.length-1].subitems.push(t)}a=!1});t=i.subitems;return t&&0!=t.length?t:null};let g=!(w.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});w.augmentDocs=function r(e,t){if(g||(g=!0,n(i="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n","",i),n(i," ",i),n(i,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),n(i,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")),!t)return e;function n(e,t,n){var i=r(e,t).trim();if(i!=(n=n.trim()))throw console.log(`*** Template:
${e}
*** Input:
${t}
*** Expected:
${n}
*** Output:
`+i),new Error("augment docs test fail")}var i,s,a;let o=b(e,null),l=b(t,o),c={},u={};for(s of l.children)T.assert(0==s.children.length),T.assert(!!s.id),c[s.id]=s.text;let d=e=>{e.id&&void 0!==c[e.id]&&(u[e.id]=!0,e.text=c[e.id],e.children=[]),e.children.forEach(d)},h=(d(o),""),p=e=>{h+=e.text,e.children.forEach(p)},f=(p(o),""),m=l.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");m.trim()&&(f+=m.trim()+"\n");for(a of l.children)u[a.id]||(f+=a.text);return f&&(h+="## Couldn't apply replacement logic to:\n"+f),h}}}(pxt=pxt||{}),function(e){(e.dom||(e.dom={})).el=function(e,t,n){const i=document.createElement(e);return t&&Object.keys(t).forEach(e=>i.setAttribute(e,t[e]+"")),function t(e){Array.isArray(e)?e.forEach(e=>t(e)):"string"==typeof e?i.appendChild(document.createTextNode(e)):e instanceof HTMLElement&&i.appendChild(e)}(n),i}}(pxt=pxt||{}),function(l){function c(e){e=/```package\s+((.|\s)+?)\s*```/i.exec(e);let t;return e&&(t={},e[1].split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).map(e=>e.split("=")).forEach(e=>t[e[0]]=e[1]||"*")),t}function u(e){e=/```config\s+((.|\s)+?)\s*```/i.exec(e);let t=[];return e&&e[1].split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).map(e=>e.split("=")).filter(e=>"feature"==e[0]&&!!e[1]).forEach(e=>t.push(e[1])),t.length?t:void 0}function d(e){var t=/```jres\s+((.|\s)+?)\s*```/i.exec(e);if(t){const e=t[1],n=JSON.parse(e);return{jres:e,ts:l.emitTilemapsFromJRes(n)}}}function h(e){e=/```assetjson\s+((.|\s)+?)\s*```/i.exec(e);return e?l.tutorial.parseAssetJson(e[1]):{}}function s(e){let t=l.Util.jsonTryParse(e);return null!=(t=t&&!Array.isArray(t)?[t]:t)&&t.length||null!=(t=e.split(/^---$/gm).filter(e=>!!e).map(e=>{let i={};return e.replace(/^\s*(?:-|\*)\s+(\w+)\s*:\s*(.*)$/gm,(e,t,n)=>{if("flags"==t)i[t]=n.split(",");else if("otherAction"===t){const e=n.split(",").map(e=>null==e?void 0:e.trim());(i.otherActions||(i.otherActions=[])).push({url:e[0],editor:e[1],cardType:e[2]})}else i[t]=n;return""}),!!Object.keys(i).length&&i}).filter(e=>!!e))&&t.length?t:void 0}function t(e){if(!e)return[];const t=[];let n,i=!1,r="";return e.split(/\r?\n/).forEach(e=>{if(/^## /.test(e))n=e.substr(2).trim();else if(/^(### ~ |```)codecard$/.test(e))i=!0;else if(/^(### ~|```)$/.test(e)){if(i=!1,n&&r){const e=s(r);null!=e&&e.length?t.push({name:n,cards:e}):l.log("invalid gallery format")}r="",n=void 0}else i&&(r+=e+"\n")}),t.forEach(e=>e.cards.forEach(t=>{var e;!t.otherActions||t.otherActions.length||"tutorial"!=t.cardType&&"example"!=t.cardType||(e=["js"],l.appTarget.appTheme.python&&e.unshift("py"),t.otherActions=e.map(e=>({url:t.url,cardType:t.cardType,editor:e})))})),t}var e;(e=l.gallery||(l.gallery={})).parsePackagesFromMarkdown=c,e.parseFeaturesFromMarkdown=u,e.parseJResFromMarkdown=d,e.parseTemplateProjectJSON=h,e.parseExampleMarkdown=function(e,t){if(t){var n,i,r,s,a,o=/```(blocks?|typescript|python|spy|sim)\s+((.|\s)+?)\s*```/i.exec(t);if(o)return n=c(t),i=o[1],r=o[2],s=u(t),a=d(t),(e={name:e,filesOverride:{[l.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',["python"===o[1]?l.MAIN_PY:l.MAIN_TS]:r},dependencies:n,features:s,snippetType:i,source:r}).filesOverride=Object.assign(Object.assign({},e.filesOverride),h(t)),a&&(e.filesOverride[l.TILEMAP_JRES]=a.jres,e.filesOverride[l.TILEMAP_CODE]=a.ts),e}},e.parseCodeCards=s,e.parseCodeCardsHtml=function(e){let n,t=[];return Array.from(e.children).forEach(e=>{"UL"===e.tagName||"OL"===e.tagName?(n=n||{},Array.from(e.querySelectorAll("li")).forEach(e=>{var e=e.innerText,t=/^\s*(\w+)\s*:\s*(.*)$/.exec(e);if(t){const e=t[1];n[e]=t[2].trim(),"flags"===e&&(n[e]=n[e].split(/,\s*/))}})):"HR"==e.tagName&&(n&&t.push(n),n=void 0)}),n&&t.push(n),!(null==(t=0===t.length&&"CODE"===e.tagName?l.Util.jsonTryParse(e.textContent):t)||!t.length)&&t},e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return l.Cloud.markdownAsync(e).then(e=>t(e))},e.codeCardsToMarkdown=function(e){return`### ~ codecard

${(e||[]).map(t=>Object.keys(t).filter(e=>!!t[e]).map(e=>"otherActions"===e?t[e].map(e=>`* otherAction: ${e.url}, ${e.editor||""}, `+(e.cardType||"")).join("\n"):`* ${e}: `+t[e]).join("\n")).join("\n\n---\n\n")}

### ~
`}}(pxt=pxt||{}),function(o){o.GDBServer=class{constructor(e){this.io=e,this.q=new o.U.PromiseQueue,this.dataBuf="",this.numSent=0,this.pktSize=400,this.trace=!1,this.bmpMode=!0,this.targetInfo="",this.onEvent=e=>{},this.io.onData=e=>this.onData(e)}onData(e){for(this.dataBuf+=o.U.uint8ArrayToString(e);0<this.dataBuf.length;){var t=this.dataBuf[0];if("+"==t)this.dataBuf=this.dataBuf.slice(1);else if("$"==t||"%"==t){var n=this.decodeResp(this.dataBuf.slice(1));if(null==n)break;"$"==t?(this.io.sendPacketAsync(this.buildCmd("+")),this.onResponse?this.onResponse(n):0<this.numSent&&this.io.error("unexpected response: "+n)):this.onEvent(n)}else this.io.error("invalid character: "+t)}}buildCmd(t){if("+"==t)return o.U.stringToUint8Array(t);let n="";for(let e=0;e<t.length;++e){var i=t.charAt(e);"}"==i||"#"==i||"$"==i?n=(n+="}")+String.fromCharCode(32^i.charCodeAt(0)):n+=i}let r=0;t=n;for(let e=0;e<t.length;++e)r=r+t.charCodeAt(e)&255;return n="$"+t+"#"+("0"+r.toString(16)).slice(-2),o.U.stringToUint8Array(n)}decodeResp(i){let r="";for(let n=0;n<i.length;++n){var e=i[n];if("}"==e)++n,r+=String.fromCharCode(32^i.charCodeAt(n));else if("*"==e){++n;let e=i.charCodeAt(n)-29,t=r.charAt(r.length-1);for(;0<e--;)r+=t}else{if("#"==e)return 2==i.slice(n+1,n+3).length?(this.dataBuf=i.slice(n+3),r):null;r+=e}}return null}sendCmdOKAsync(e){return this.sendCmdAsync(e,e=>"OK"==e)}error(e){this.io.error(e),this.io.disconnectAsync()}sendCmdAsync(n,i){this.numSent++;const e=this.buildCmd(n);return this.q.enqueue("one",()=>null===i?this.io.sendPacketAsync(e).then(()=>null):new Promise(t=>{this.onResponse=e=>{this.onResponse=null,this.trace&&o.log(`GDB: '${n}' -> '${e}'`),void 0===i||i(e)||this.error(`Invalid GDB command response: '${n}' -> '${e}'`),t(e)},this.io.sendPacketAsync(e)}))}sendRCmdAsync(e){return this.sendMCmdAsync("qRcmd,"+o.U.toHex(o.U.stringToUint8Array(e)))}sendMCmdAsync(i){this.numSent++;const e=this.buildCmd(i);let r="";return this.q.enqueue("one",()=>new Promise(n=>{this.onResponse=e=>{var t;"OK"!=e&&"O"==e[0]?r+=(t=e.slice(1),o.U.uint8ArrayToString(o.U.fromHex(t))):("OK"!=e&&(r+=" - "+e),this.onResponse=null,this.trace&&o.log(`Final GDB: '${i}' -> '${r}'`),n(r))},this.io.sendPacketAsync(e)}))}write32Async(e,t){var n=new Uint8Array(4);return o.HF2.write32(n,0,t),this.writeMemAsync(e,n)}writeMemAsync(e,t){var n=this.pktSize/2-10;return o.U.assert(t.length<n),this.sendCmdOKAsync("M"+e.toString(16)+","+t.length.toString(16)+":"+o.U.toHex(t)).then(e=>{console.log(e)})}readMemAsync(e,i){const r=this.pktSize/2-6;if(i>r){const s=new Uint8Array(i),a=t=>{const n=Math.min(i-t,r);return 0==n?Promise.resolve(s):this.readMemAsync(e+t,n).then(e=>(o.U.memcpy(s,t,e),a(t+n)))};return a(0)}return this.sendCmdAsync("m"+e.toString(16)+","+i.toString(16)).then(e=>o.U.fromHex(e))}initBMPAsync(){return Promise.resolve().then(()=>this.sendRCmdAsync("swdp_scan")).then(e=>(this.targetInfo=e,this.sendCmdAsync("vAttach;1",e=>"T"==e[0]))).then(()=>{})}initAsync(){return o.U.delay(1e3).then(()=>this.sendCmdAsync("!")).then(()=>this.sendCmdAsync("qSupported")).then(e=>{let i={};return e=(e=";"+e+";").replace(/;([^;]+)[=:]([^:;]+)/g,(e,t,n)=>(i[t]=n,";")),this.pktSize=parseInt(i.PacketSize)||1024,o.log("GDB-server caps: "+JSON.stringify(i)+" "+e.replace(/;+/g,";")),this.bmpMode?this.initBMPAsync():this.sendCmdAsync("c").then(()=>{})})}}}(pxt=pxt||{}),function(a){{var o=a.github||(a.github={}),e;function l(){var e;return!!o.forceProxy||!a.U.isNodeJS&&!(null!=(e=null==(e=null==a?void 0:a.appTarget)?void 0:e.cloud)&&e.noGithubProxy)}o.token=null,o.forceProxy=!1;const _={};function r(r){var e;return r.method=null!=(e=r.method)?e:"GET",function t(e){var n;const i=a.U.clone(r);return o.token&&(i.headers||(i.headers={}),i.url==O?i.headers.Authorization="bearer "+o.token:(i.url=a.BrowserUtils.cacheBustingUrl(i.url),i.headers.Authorization="token "+o.token)),i.allowHttpErrors=null!=(n=i.allowHttpErrors)&&n,a.U.requestAsync(i).catch(e=>{if(a.tickEvent("github.error",{statusCode:e.statusCode}),o.handleGithubNetworkError&&o.handleGithubNetworkError(i,e))return t();throw e})}(o.token)}function c(e){return r({url:e,method:"GET"}).then(e=>e.json)}function u(e){return a.Cloud.apiRequestWithCdnAsync({url:"gh/"+e,forceLiveEndpoint:!0}).then(e=>e.json)}function d(e){a.log("github proxy error: "+e.message),a.debug(e)}o.isOrgAsync=function(e){return r({url:"https://api.github.com/orgs/"+e,method:"GET",allowHttpErrors:!0}).then(e=>200==e.statusCode)};class N{constructor(){this.configs={},this.packages={}}proxyWithCdnLoadPackageAsync(e,t){const n=e+"/"+t;var i=this.packages[n];return i?(a.debug(`github cache ${e}/${t}/text`),Promise.resolve(i)):u(I((i=E(e)).slug,t,i.fileName,"text")).then(e=>this.packages[n]={files:e})}cacheConfig(e,t){t=a.Package.parseAndValidConfig(t);return this.configs[e]=t,a.U.clone(t)}async loadConfigAsync(e,t){var n=e+"/"+(t=t||"master"),i=this.configs[n];if(i)return a.debug(`github cache ${e}/${t}/config`),a.U.clone(i);if(l())try{const l=await this.proxyWithCdnLoadPackageAsync(e,t);return this.cacheConfig(n,l.files[a.CONFIG_NAME])}catch(e){d(e)}i=await p(e,t,a.CONFIG_NAME);return this.cacheConfig(n,i)}async loadPackageAsync(e,t){if(t=t||"master",l())try{return await this.proxyWithCdnLoadPackageAsync(e,t).then(e=>a.U.clone(e))}catch(e){d(e)}return this.githubLoadPackageAsync(e,t)}githubLoadPackageAsync(r,n){return v(r,n).then(i=>{const t=r+"/"+i;var e=this.packages[t];return e?(a.debug(`github cache ${r}/${n}/text`),Promise.resolve(a.U.clone(e))):(a.log(`Downloading ${r}/${n} -> `+i),p(r,i,a.CONFIG_NAME).then(e=>{const n={files:{}};n.files[a.CONFIG_NAME]=e;e=JSON.parse(e);return a.U.promiseMapAll(a.allPkgFiles(e).slice(1),t=>p(r,i,t).then(e=>{n.files[t]=e})).then(()=>(this.packages[t]=n,a.U.clone(n)))}))})}}function h(t,e,n){return r({url:"https://api.github.com/repos/"+I(t.slug,"contents",t.fileName,n+"?ref="+e),method:"GET"}).then(e=>{e=e.json;return _[t.slug]=!0,e&&"base64"==e.encoding&&null!=e.content?atob(e.content):a.U.httpGetTextAsync(e.download_url)})}function p(e,t,n){const i=E(e);return _[i.slug]?h(i,t,n):a.U.requestAsync({url:"https://raw.githubusercontent.com/"+I(i.slug,t,i.fileName,n),allowHttpErrors:!0}).then(e=>200==e.statusCode?e.text:h(i,t,n))}function f(e,t,n,i){return r({url:/^https:/.test(e)?e:"https://api.github.com/repos/"+e,headers:n,method:i||"POST",data:t,successCodes:[200,201,202,204]}).then(e=>e.json)}function m(e,t){let n=1;for(;e.refs[t+n];)n++;return t+n}async function g(e,t,n){return await f(e+"/git/refs",{ref:"refs/heads/"+t,sha:n}),t}function b(e,n="tags",t,i){e=E(e),t=!!o.forceProxy||!(o.token&&!t)&&l();let r=null;t=t?a.U.httpGetJsonAsync(a.BrowserUtils.cacheBustingUrl(`${a.Cloud.apiRoot}gh/${e.slug}/refs`+(i?"?nocache=1":""))).then(t=>{var e=Object.keys(t.refs).filter(e=>a.U.startsWith(e,"refs/"+n+"/")).map(e=>({ref:e,object:{sha:t.refs[e]}}));return r=t.refs.HEAD,e}):c(`https://api.github.com/repos/${e.slug}/git/refs/${n}/?per_page=100`);let s=e=>e.replace(/^refs\/[^\/]+\//,"");return t.then(e=>{e.sort((e,t)=>a.semver.strcmp(s(e.ref),s(t.ref)));var t,n={};for(t of e)n[s(t.ref)]=t.object.sha;return{refs:n,head:r}},e=>404==e.statusCode?{refs:{}}:Promise.reject(e))}function i(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?c(e.object.url).then(e=>"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))):Promise.reject(new Error("Bad type "+e.object.type))}function v(e,t){if(/^[a-f0-9]{40}$/.test(t))return Promise.resolve(t);const n=E(e);return c(`https://api.github.com/repos/${n.slug}/git/refs/tags/`+t).then(i,e=>c(`https://api.github.com/repos/${n.slug}/git/refs/heads/`+t).then(i))}function y(e,t="master"){return o.db.loadConfigAsync(e,t)}function w(n,i){var e=E(n);return e?A(e,i)?(a.tickEvent("github.download.banned"),a.log("Github repo is banned"),Promise.resolve(void 0)):o.db.loadPackageAsync(e.fullName,e.tag).then(e=>{var t=U(i,n);if(t){const i=a.Package.parseAndValidConfig(e.files[a.CONFIG_NAME]);i&&(a.log(`auto-disable ${t.join(",")} due to targetconfig entry for `+n),i.disablesVariants=t,e.files[a.CONFIG_NAME]=a.Package.stringifyConfig(i))}return e}):(a.log("Unknown GitHub syntax"),Promise.resolve(void 0))}let s;function t(e){return a.Cloud.cdnApiUrl(`gh/${e.fullName}/icon`)}function x(e,t){var n;if(e)return(n={owner:e.owner.login.toLowerCase(),slug:e.full_name.toLowerCase(),fullName:((null==t?void 0:t.fullName)||e.full_name).toLowerCase(),fileName:null==(n=null==t?void 0:t.fileName)?void 0:n.toLocaleLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:null==t?void 0:t.tag,updatedAt:Math.round(new Date(e.updated_at).getTime()/1e3),fork:e.fork,private:e.private}).status=k(n,null==t?void 0:t.config),n}function k(e,t){return e?A(e,t)?s.Banned:(r=t=t,(i=n=e)&&r&&i.owner&&r.approvedOrgs&&r.approvedOrgs.some(e=>e.toLowerCase()==i.owner.toLowerCase())||n&&t&&n.fullName&&t.approvedRepos&&t.approvedRepos.some(e=>e.toLowerCase()==n.fullName.toLowerCase())?s.Approved:s.Unknown):s.Unknown;var n,i,r}function A(t,e){return n=t,(i=e)&&(!n||!n.owner||i.bannedOrgs&&i.bannedOrgs.some(e=>e.toLowerCase()==n.owner.toLowerCase()))||e&&(!t||!t.fullName||e.bannedRepos&&e.bannedRepos.some(e=>e.toLowerCase()==t.fullName.toLowerCase()));var n,i}async function T(e,t){e=E(e);if(e){var n,i,r=k(e,t);if(r!=s.Banned){if(l())try{return i=r,await u((n=e).slug).then(e=>{if(e)return{github:!0,owner:n.owner,fullName:n.fullName,fileName:n.fileName,slug:n.slug,name:n.fileName?e.name+"-"+n.fileName:e.name,description:e.description,defaultBranch:e.defaultBranch||"master",tag:n.tag,status:i}}).catch(e=>{a.reportException(e)})}catch(e){d(e)}return x(await c("https://api.github.com/repos/"+e.slug),{config:t,fullName:e.fullName,fileName:e.fileName,tag:e.tag})}}}function E(t){if(t){t=(t=t.trim()).replace(/\/$/,"");var n=/^https:\/\/([^./#]+)\.github\.io\/([^/#]+)\/?$/i.exec(t),n=(t=(t=(t=(t=n?`github:${n[1]}/`+n[2]:t).replace(/^github:/i,"")).replace(/^https:\/\/github\.com\//i,"")).replace(/\.git\b/i,""),/^([^#\/:]+)\/([^#\/:]+)(\/([^#]+))?(#([^\/:]*))?$/.exec(t));if(n){var t=n[1],i=n[2];let e=n[4];var n=n[6],r=e&&/^tree\/([^\/]+\/)/.exec(e);return r&&(e=e.slice(r[0].length)),{owner:t,project:i,slug:I(t,i),fullName:I(t,i,e),tag:n,fileName:e}}}}function C(e){return!!e&&"github:"==e.slice(0,7)}function S(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}function I(...e){return e.filter(e=>!!e).join("/")}function P(e,t){return e&&e.upgrades&&(t=E(t))?a.U.lookup(e.upgrades,t.fullName.toLowerCase()):null}function U(e,t){e=P(e,t),t=/^dv:(.*)/.exec(e);if(t){const e=t[1].split(/,/);return e.some(e=>!/^\w+$/.test(e))?null:e}return null}o.MemoryGithubDb=N,o.downloadTextAsync=p,o.db=new N,o.authenticatedUserAsync=function(){return o.token?c("https://api.github.com/user"):Promise.resolve(void 0)},o.getCommitsAsync=function(e,t){return c("https://api.github.com/repos/"+E(e).slug+"/commits?sha="+t).then(e=>e.map(e=>{var t=e.commit;return t.url=e.url,t.sha=e.sha,t}))},o.getCommitAsync=function(e,t){return c("https://api.github.com/repos/"+E(e).slug+"/git/commits/"+t).then(t=>c(t.tree.url+"?recursive=1").then(e=>(t.tree=e,t)))},o.createObjectAsync=function(e,t,n){return f(E(e).slug+"/git/"+t+"s",n).then(e=>e.sha)},o.postCommitComment=function(e,t,n,i,r){return f(E(e).slug+`/commits/${t}/comments`,{body:n,path:i,position:r}).then(e=>e.id)},o.fastForwardAsync=async function(e,t,n){return 200==(await r({url:`https://api.github.com/repos/${E(e).slug}/git/refs/heads/`+t,method:"PATCH",allowHttpErrors:!0,data:{sha:n,force:!1}})).statusCode},o.putFileAsync=async function(e,t,n){e=E(e);await r({url:"https://api.github.com/repos/"+a.github.join(e.slug,"contents",e.fileName,t),method:"PUT",allowHttpErrors:!0,data:{message:lf("Initialize empty repo"),content:btoa(a.U.toUTF8(n)),branch:"master"},successCodes:[201]})},o.createTagAsync=async function(e,t,n){await f(e+"/git/refs",{ref:"refs/tags/"+t,sha:n})},o.createReleaseAsync=async function(e,t,n){await f(e+"/releases",{tag_name:t,target_commitish:n,name:t,draft:!1,prerelease:!1})},o.createPRFromBranchAsync=async function(e,t,n,i,r){e=await f(e+"/pulls",{title:i,body:r||lf("Automatically created from MakeCode."),head:n,base:t,maintainer_can_modify:!0});return null==e?void 0:e.html_url},o.mergeAsync=function(t,e,n,i){return r({url:`https://api.github.com/repos/${E(t).slug}/merges`,method:"POST",successCodes:[201,204,409],data:{base:e,head:n,commit_message:i}}).then(e=>{if(201==e.statusCode||204==e.statusCode)return e.json.sha;if(409==e.statusCode)return null;throw a.U.userError(lf("Cannot merge in github.com/{1}; code: {2}",t,e.statusCode))})},o.getRefAsync=function(e,t){return c("https://api.github.com/repos/"+e+"/git/refs/heads/"+(t=t||"master")).then(i).catch(e=>{404!=e.statusCode&&Promise.reject(e)})},o.getNewBranchNameAsync=async function(e,t="patch-"){return m(await b(e,"heads"),t)},o.createNewBranchAsync=g,o.forkRepoAsync=async function(e,t,n="pr-"){var e=E(e),i=x(await f(e.slug+"/forks",{}),{fullName:e.fullName,fileName:e.fileName}),r=Date.now()+3e5;let s=null;for(;!s&&Date.now()<r;){await a.U.delay(1e3);try{s=await b(i.slug,"heads")}catch(e){}}if(s)return e=m(s,n),await g(i.slug,e,t),i.fullName+"#"+e;throw new Error(lf("Timeout waiting for fork"))},o.listRefsAsync=function(e,t="tags",n,i){return b(e,t,n,i).then(e=>Object.keys(e.refs))},o.listRefsExtAsync=b,o.pkgConfigAsync=y,o.downloadPackageAsync=w,o.downloadLatestPackageAsync=async function(e){var t=await a.packagesConfigAsync(),n=await a.github.latestVersionAsync(e.slug,t),i=e.fullName+"#"+n;return await a.github.downloadPackageAsync(i,t),{version:"github:"+i,config:await y(e.fullName,n)}},o.cacheProjectDependenciesAsync=async function(n){var i,e=null==(i=Object.keys(n.dependencies))?void 0:i.filter(e=>C(n.dependencies[e]));if(e.length){const i=await a.packagesConfigAsync();await Promise.all(e.map(async e=>{var t=n.dependencies[e];if(!await w(t,i))throw new Error(lf("Cannot load extension {0} from {1}",e,t))}))}},(e=s=o.GitRepoStatus||(o.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",o.listUserReposAsync=function(){return n('{\n  viewer {\n    repositories(first: 100, affiliations: [OWNER, COLLABORATOR], orderBy: {field: PUSHED_AT, direction: DESC}) {\n      nodes {\n        name\n        description\n        full_name: nameWithOwner\n        private: isPrivate\n        fork: isFork\n        updated_at: updatedAt\n        owner {\n          login\n        }\n        defaultBranchRef {\n          name\n        }\n        pxtjson: object(expression: "master:pxt.json") {\n          ... on Blob {\n            text\n          }\n        }\n        readme: object(expression: "master:README.md") {\n          ... on Blob {\n            text\n          }\n        }\n      }\n    }\n  }\n}').then(e=>e.data.viewer.repositories.nodes.filter(e=>e.pxtjson).filter(e=>{e.default_branch=e.defaultBranchRef.name;var t=a.Package.parseAndValidConfig(e.pxtjson&&e.pxtjson.text),e=e.readme&&e.readme.text;return!!t&&(t.supportedTargets?-1<t.supportedTargets.indexOf(a.appTarget.id):e&&-1<e.indexOf("PXT/"+a.appTarget.id))}).map(e=>x(e,{fullName:e.full_name})))},o.createRepoAsync=function(e,t,n){return f("https://api.github.com/user/repos",{name:e,description:t,private:!!n,has_issues:!0,has_projects:!1,has_wiki:!1,allow_rebase_merge:!1,allow_merge_commit:!0,delete_branch_on_merge:!1}).then(e=>x(e))},o.enablePagesAsync=async function(e){const t=E(e);let n;try{const a=await c(`https://api.github.com/repos/${t.slug}/pages`);a&&(n=a.html_url)}catch(e){}if(!n)try{n=(await f(`https://api.github.com/repos/${t.slug}/pages`,{source:{branch:"master",path:"/"}},{Accept:"application/vnd.github.switcheroo-preview+json"})).html_url}catch(e){a.tickEvent("github.pages.error"),a.reportException(e)}if(n){const t=await c("https://api.github.com/repos/"+e);if(t&&!t.homepage)try{await f("https://api.github.com/repos/"+e,{homepage:n},void 0,"PATCH")}catch(e){a.tickEvent("github.homepage.error")}}},o.repoIconUrl=function(e){if(e.status==s.Approved)return t(e)},o.mkRepoIconUrl=t,o.repoStatus=k,o.repoAsync=T,o.searchAsync=function(e,t){var n;return t?0<(n=e.split("|").map(E).filter(e=>!!e)).length?Promise.all(n.map(e=>T(e.fullName,t))).then(e=>e.filter(e=>e&&e.status!=s.Banned)):a.U.httpGetJsonAsync(`${a.Cloud.apiRoot}ghsearch/${a.appTarget.id}/${a.appTarget.platformid||a.appTarget.id}?q=`+encodeURIComponent(e)).then(e=>e.items.map(e=>x(e,{config:t,fullName:e.full_name})).filter(e=>e.status==s.Approved||t.allowUnapproved&&e.status==s.Unknown).filter(e=>!a.appTarget.appTheme.githubUrl||"https://github.com/"+e.fullName!=a.appTarget.appTheme.githubUrl.toLowerCase())).catch(e=>[]):Promise.resolve([])},o.parseRepoId=E,o.toGithubDependencyPath=function(e,t){let n="github:"+e;return t&&(n+="#"+t),n},o.isGithubId=C,o.stringifyRepo=S,o.normalizeRepoId=function(e){e=E(e);if(e)return e.tag=e.tag||"master",S(e)},o.join=I,o.upgradedPackageReference=function(e,t){const n=P(e,t);if(!n)return null;var i=/^min:(.*)/.exec(n),r=i&&a.semver.tryParse(i[1]);if(r){const e=E(t),n=a.semver.tryParse(e.tag);return n&&a.semver.cmp(n,r)<0?(e.tag=i[1],a.debug(`upgrading ${t} to `+i[1]),S(e)):(n||a.log(`not upgrading ${t} - cannot parse version`),null)}return U(e,t)||a.log(`invalid upgrade rule: ${t} -> `+n),t},o.upgradedPackageId=function(e,t){e=U(e,t);return e?t+"?dv="+e.join(","):t},o.latestVersionAsync=function(e,r,t,n){const s=E(e);return s?T(s.slug,r).then(i=>{if(i)return b(i.slug,"tags",t,n).then(t=>{var e=Object.keys(t.refs),e=a.semver.sortLatestTags(e),n=a.appTarget.versions&&a.semver.tryParse(a.appTarget.versions.target);if(n&&r.releases&&r.releases["v"+n.major]){const t=r.releases["v"+n.major].map(e=>a.github.parseRepoId(e)).filter(e=>e&&e.fullName.toLowerCase()==s.fullName.toLowerCase())[0];if(t){if(e.some(e=>e==t.tag))return a.debug(`approved release ${t.fullName}#${t.tag} for v`+n.major),Promise.resolve(t.tag);a.reportError("packages",`approved release ${t.fullName}#${t.tag} for v${n.major} not found anymore`,{repo:i.fullName})}}return e[0]?Promise.resolve(e[0]):t.head||v(i.slug,i.defaultBranch)})}):Promise.resolve(null)},o.resolveMonoRepoVersions=function(n){n=a.Util.clone(n);const i={};return Object.keys(n).map(e=>({id:e,ghid:o.parseRepoId(n[e])})).filter(e=>{return null==(e=e.ghid)?void 0:e.tag}).forEach(e=>{var t=e["ghid"];let n=i[t.slug];(n=n||(i[t.slug]={tag:t.tag,deps:[]})).deps.push(e),a.semver.strcmp(n.tag,t.tag)<0&&(a.debug("dep: resolve later monorepo tag to "+a.github.stringifyRepo(t)),n.tag=t.tag)}),a.U.values(i).forEach(t=>t.deps.forEach(e=>{e.ghid.tag!==t.tag&&(a.debug(`dep: ${a.github.stringifyRepo(e.ghid)} -> `+t.tag),e.ghid.tag=t.tag,n[e.id]=a.github.stringifyRepo(e.ghid))})),n},o.GIT_JSON=".git.json";const O="https://api.github.com/graphql";function n(e){e=JSON.stringify({query:e});return f(O,e)}o.lookupFile=function(e,t,n){if(!t)return null;const i=I(e.fileName,n);return t.tree.tree.find(e=>e.path==i)},o.ghGraphQLQueryAsync=n,o.findPRNumberforBranchAsync=function(e,t){e=E(e);return n(`
{
    repository(owner: ${JSON.stringify(e.owner)}, name: ${JSON.stringify(e.project)}) {
        pullRequests(last: 1, states: [OPEN, MERGED], headRefName: ${JSON.stringify(t)}) {
            edges {
                node {
                    number
                    state
                    mergeable
                    baseRefName
                    url
                    isDraft
                }
            }
        }
    }
}
`).then(e=>{var t=e.data.repository.pullRequests.edges[0];if(t&&t.node){const e=t.node;return{number:e.number,mergeable:e.mergeable,state:e.state,title:e.title,url:e.url,base:e.baseRefName}}return{number:-1}})},o.getPagesStatusAsync=function(e){return c(`https://api.github.com/repos/${e}/pages`).catch(e=>({status:null}))}}}(pxt=pxt||{}),function(e){e.REFCNT_FLASH="0xfffe",e.VTABLE_MAGIC=249,e.ValTypeObject=4,(e=e.BuiltInType||(e.BuiltInType={}))[e.BoxedString=1]="BoxedString",e[e.BoxedNumber=2]="BoxedNumber",e[e.BoxedBuffer=3]="BoxedBuffer",e[e.RefAction=4]="RefAction",e[e.RefImage=5]="RefImage",e[e.RefCollection=6]="RefCollection",e[e.RefRefLocal=7]="RefRefLocal",e[e.RefMap=8]="RefMap",e[e.RefMImage=9]="RefMImage",e[e.MMap=10]="MMap",e[e.BoxedString_SkipList=11]="BoxedString_SkipList",e[e.BoxedString_ASCII=12]="BoxedString_ASCII",e[e.ZPin=13]="ZPin",e[e.User0=16]="User0"}(pxt=pxt||{}),function(l){{var c=l.HF2||(l.HF2={});function o(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function u(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function d(e,t){return e[t]|e[t+1]<<8}function n(t){var n=new Uint8Array(4*t.length);for(let e=0;e<t.length;++e)o(n,4*e,t[e]);return n}c.HF2_CMD_BININFO=1,c.HF2_MODE_BOOTLOADER=1,c.HF2_MODE_USERSPACE=2,c.HF2_CMD_INFO=2,c.HF2_CMD_RESET_INTO_APP=3,c.HF2_CMD_RESET_INTO_BOOTLOADER=4,c.HF2_CMD_START_FLASH=5,c.HF2_CMD_WRITE_FLASH_PAGE=6,c.HF2_CMD_CHKSUM_PAGES=7,c.HF2_CMD_READ_WORDS=8,c.HF2_CMD_WRITE_WORDS=9,c.HF2_CMD_DMESG=16,c.HF2_FLAG_SERIAL_OUT=128,c.HF2_FLAG_SERIAL_ERR=192,c.HF2_FLAG_CMDPKT_LAST=64,c.HF2_FLAG_CMDPKT_BODY=0,c.HF2_FLAG_MASK=192,c.HF2_SIZE_MASK=63,c.HF2_STATUS_OK=0,c.HF2_STATUS_INVALID_CMD=1,c.HF2_STATUS_EXEC_ERR=2,c.HF2_STATUS_EVENT=128,c.HF2_CMD_JDS_CONFIG=32,c.HF2_CMD_JDS_SEND=33,c.HF2_EV_JDS_PACKET=8388640,c.CUSTOM_EV_JACDAC="jacdac",c.HF2_EV_MASK=8388608,c.write32=o,c.write16=u,c.read32=s,c.read16=d,c.encodeU32LE=n;let t=!(c.decodeU32LE=function(t){var n=[];for(let e=0;e<t.length;e+=4)n.push(s(t,e));return n});function h(e){t?l.log("HF2: "+e):l.debug("HF2: "+e)}c.enableLog=function(){t=!0};class i{constructor(a){var e;this.io=a,this.cmdSeq=l.U.randomUint32(),this.lock=new l.U.PromiseQueue,this.flashing=!1,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.icon=(null==(e=l.appTarget.appTheme.downloadDialogTheme)?void 0:e.deviceIcon)||"usb",this.msgs=new l.U.PromiseBuffer,this.eventHandlers={},this.jacdacAvailable=!1,this.onSerial=(e,t)=>{},this.onCustomEvent=(e,t)=>{};let o=[];a.onDeviceConnectionChanged=e=>this.disconnectAsync().then(()=>e&&this.reconnectAsync()),a.onSerial=(e,t)=>this.onSerial(e,t),a.onData=e=>{var i=e[0]&c.HF2_FLAG_MASK,t=63&e[0],n=new Uint8Array(t);if(l.U.memcpy(n,0,e,1,t),i&c.HF2_FLAG_SERIAL_OUT)this.onSerial(n,i==c.HF2_FLAG_SERIAL_ERR);else if(o.push(n),i!=c.HF2_FLAG_CMDPKT_BODY){l.U.assert(i==c.HF2_FLAG_CMDPKT_LAST);let e=0;for(var r of o)e+=r.length;let t=new Uint8Array(e),n=0;for(var s of o)l.U.memcpy(t,n,s),n+=s.length;o=[],t[2]&c.HF2_STATUS_EVENT?a.onEvent(t):this.msgs.push(t)}},a.onEvent=e=>{var t=s(e,0),n=l.U.lookup(this.eventHandlers,t+"");n?n(e.slice(4)):h("unhandled event: "+t.toString(16))},a.onError=e=>{h("recv error: "+e.message),this.autoReconnect&&(this.autoReconnect=!1,this.reconnectAsync().then(()=>{this.autoReconnect=!0},e=>{h("reconnect error: "+e.message)}))},this.onEvent(c.HF2_EV_JDS_PACKET,e=>{this.onCustomEvent(c.CUSTOM_EV_JACDAC,e)})}resetState(){this.lock=new l.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()}onEvent(e,t){l.U.assert(!!(e&c.HF2_EV_MASK)),this.eventHandlers[e+""]=t}sendCustomEventAsync(e,t){return e==c.CUSTOM_EV_JACDAC?this.jacdacAvailable?this.talkAsync(c.HF2_CMD_JDS_SEND,t).then(()=>{}):Promise.resolve():Promise.reject(new Error("invalid custom event type"))}reconnectAsync(){return this.resetState(),h("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(()=>this.initAsync()).catch(e=>{if(this.reconnectTries<5)return this.reconnectTries++,h(`error ${e.message}; reconnecting attempt #`+this.reconnectTries),l.U.delay(500).then(()=>this.reconnectAsync());throw e})}disconnectAsync(){return h("disconnect"),this.io.disconnectAsync()}error(e){return this.io.error(e)}talkAsync(e,t){if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(e=>e[0]);let n=8,i=(t&&(n+=t.length),new Uint8Array(n)),r=65535&++this.cmdSeq,s=(o(i,0,e),u(i,4,r),u(i,6,0),t&&l.U.memcpy(i,8,t,0,t.length),0),a=()=>this.msgs.shiftAsync(1e3).then(e=>{if(d(e,0)!=r){if(s<3)return s++,h(`message out of sync, (${r} vs ${d(e,0)}); will re-try`),a();this.error("out of sync")}let t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case c.HF2_STATUS_OK:return e.slice(4);case c.HF2_STATUS_INVALID_CMD:this.error("invalid command"+t);break;case c.HF2_STATUS_EXEC_ERR:this.error("execution error"+t);break;default:this.error("error "+e[2]+t)}return null});return this.sendMsgAsync(i).then(a)}sendMsgAsync(e){return this.sendMsgCoreAsync(e)}sendSerialAsync(e,t=!1){return this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)}sendMsgCoreAsync(i,e=0){let r=new Uint8Array(64),s=t=>{let n=i.length-t;if(n<=0)return Promise.resolve();63<n?(n=63,r[0]=c.HF2_FLAG_CMDPKT_BODY):r[0]=c.HF2_FLAG_CMDPKT_LAST,e&&(r[0]=1==e?c.HF2_FLAG_SERIAL_OUT:c.HF2_FLAG_SERIAL_ERR),r[0]|=n;for(let e=0;e<n;++e)r[e+1]=i[t+e];return this.io.sendPacketAsync(r).then(()=>s(t+n))};return this.lock.enqueue("out",()=>s(0))}switchToBootloaderAsync(){return this.bootloaderMode?Promise.resolve():(h("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(()=>this.talkAsync(c.HF2_CMD_START_FLASH).then(()=>{},e=>this.talkAsync(c.HF2_CMD_RESET_INTO_BOOTLOADER).then(()=>{},e=>{}).then(()=>this.reconnectAsync().catch(e=>{throw"devicenotfound"===e.type&&(e.type="repairbootloader"),e})))).then(()=>this.initAsync()).then(()=>{this.bootloaderMode||this.error("cannot switch into bootloader mode")}))}isFlashing(){return!!this.flashing}reflashAsync(e){h("reflash"),l.U.assert(l.appTarget.compile.useUF2);const t=e.outfiles[pxtc.BINARY_UF2],n=pxtc.UF2.parseFile(l.Util.stringToUint8Array(atob(t)));return this.flashing=!0,this.io.reconnectAsync().then(()=>this.flashAsync(n)).then(()=>l.U.delay(100)).finally(()=>this.flashing=!1).then(()=>this.reconnectAsync())}writeWordsAsync(e,t){return l.U.assert(t.length<=64),this.talkAsync(c.HF2_CMD_WRITE_WORDS,n([e,t.length].concat(t))).then(()=>{})}readWordsAsync(e,t){var n=new Uint8Array(8);return o(n,0,e),o(n,4,t),l.U.assert(t<=64),this.talkAsync(c.HF2_CMD_READ_WORDS,n)}pingAsync(){return this.rawMode?Promise.resolve():this.talkAsync(c.HF2_CMD_BININFO).then(e=>{})}maybeReconnectAsync(){return this.pingAsync().catch(e=>this.reconnectAsync().then(()=>this.pingAsync()))}flashAsync(i){let n=Date.now(),r=0,s=e=>{var t,n;return e>=i.length?Promise.resolve():(t=i[e],o(n=new Uint8Array(4+t.payloadSize),0,t.targetAddr),l.U.memcpy(n,4,t.data,0,t.payloadSize),this.talkAsync(c.HF2_CMD_WRITE_FLASH_PAGE,n).then(()=>s(e+1)))};return this.switchToBootloaderAsync().then(()=>{var e=256*i.length;return h(`Starting flash (${Math.round(e/1024)}kB).`),r=Date.now(),16384<this.pageSize?i:a(i,(e,t)=>this.readWordsAsync(e,t))}).then(e=>{e.length!=i.length&&(e=256*(i=e).length,h(`Performing partial flash (${Math.round(e/1024)}kB).`))}).then(()=>s(0)).then(()=>{var e=Date.now(),t=e-n,e=e-r;h(`Flashing done at ${Math.round(256*i.length/e*1e3/1024)} kB/s in ${t}ms (reset ${t-e}ms). Resetting.`)}).then(()=>this.talkAsync(c.HF2_CMD_RESET_INTO_APP).catch(e=>{})).then(()=>{})}initAsync(){return this.rawMode?Promise.resolve():Promise.resolve().then(()=>this.talkAsync(c.HF2_CMD_BININFO)).then(e=>(this.bootloaderMode=e[0]==c.HF2_MODE_BOOTLOADER,this.pageSize=s(e,4),this.flashSize=s(e,8)*this.pageSize,this.maxMsgSize=s(e,12),this.familyID=s(e,16),h(`Connected; msgSize ${this.maxMsgSize}B; flash ${this.flashSize/1024}kB; ${this.bootloaderMode?"bootloader":"application"} mode; family=0x`+this.familyID.toString(16)),this.talkAsync(c.HF2_CMD_INFO))).then(e=>{this.infoRaw=l.Util.fromUTF8Array(e),l.debug("Info: "+this.infoRaw);let i={};("Header: "+this.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,(e,t,n)=>(i[t.replace(/-/g,"")]=n,"")),this.info=i;e=/v(\d\S+)(\s+(\S+))?/.exec(this.info.Header);this.info.Parsed=e?{Version:e[1],Features:e[3]||""}:{Version:"?",Features:""},h(`Board-ID: ${this.info.BoardID} v${this.info.Parsed.Version} f`+this.info.Parsed.Features)}).then(()=>this.talkAsync(c.HF2_CMD_JDS_CONFIG,new Uint8Array([1])).then(()=>{this.jacdacAvailable=!0},e=>{this.jacdacAvailable=!1})).then(()=>{this.reconnectTries=0})}}function a(i,e){if(!l.appTarget.compile.flashChecksumAddr)return Promise.resolve(i);let t=pxtc.UF2.readBytes(i,l.appTarget.compile.flashChecksumAddr,48),r=pxtc.parseChecksumBlock(t);return r?(n=e,(l.appTarget.compile.flashChecksumAddr?n(l.appTarget.compile.flashChecksumAddr,12).then(e=>{let t=pxtc.parseChecksumBlock(e);return t?n(t.endMarkerPos,1).then(e=>s(e,0)!=t.endMarker?(l.log("end-marker mismatch"),null):t):null}):Promise.resolve(null)).then(e=>{if(!e)return i;let n=e.regions.filter(t=>r.regions.some(e=>t.checksum==e.checksum&&t.length==e.length&&t.start==e.start));if(0==n.length)return i;h("skipping flash at: "+n.map(e=>`${pxtc.assembler.tohex(e.start)} (${e.length/1024}kB)`).join(", "));let t=t=>n.some(e=>e.start<=t&&t<e.start+e.length);return i.filter(e=>!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1)))})):Promise.resolve(i);var n}c.Wrapper=i,c.mkHF2PacketIOWrapper=function(e){return l.debug("packetio: wrapper hf2"),new i(e)},c.onlyChangedBlocksAsync=a}}(pxt=pxt||{}),function(r){{var s=r.HWDBG||(r.HWDBG={}),m=r.Util,g=r.HF2;const A=g.read32;let h,e,n,t,p,f,a,o,i=!1;function b(e){return 1&e?e>>1:0!=e?2&e?e==s.taggedNull?null:e!=s.taggedFalse&&(e==s.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function l(e,t){var n;if(m.assert(!(3&e)),m.assert(0<=e),e<2097152)return n=new Uint8Array(t),e-=a.start,m.memcpy(n,0,a.buf,e,t),Promise.resolve(n);var i=o.maxMsgSize-32;if(i<t){for(var r=[];0<t;){var s=Math.min(i,t);r.push(l(e,s)),t-=s,e+=s}return Promise.all(r).then(m.uint8ArrayConcat)}return o.readWordsAsync(e,Math.ceil(t/4)).then(e=>e.length>t?e.slice(0,t):e)}function c(i){if("object"!=typeof i||!i)return Promise.resolve(i);if("number"!=typeof i.ptr)return Promise.resolve(i);{if(3&i.ptr)return Promise.resolve({unalignedPtr:i.ptr});let n=0;return l(i.ptr,56).then(t=>{n=g.read16(t,2);let e=t.length;return n==r.BuiltInType.BoxedString||n==r.BuiltInType.BoxedBuffer?e=g.read16(t,4)+6:n==r.BuiltInType.BoxedNumber&&(e=12),e>t.length?l(i.ptr+t.length,e-t.length).then(e=>m.uint8ArrayConcat([t,e])):e<t.length?t.slice(0,e):t}).then(e=>n==r.BuiltInType.BoxedString?m.uint8ArrayToString(e.slice(6)):n==r.BuiltInType.BoxedBuffer?{type:"buffer",data:e.slice(6)}:n==r.BuiltInType.BoxedNumber?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:n,refcnt:g.read16(e,0),data:e.slice(4)})}}function v(n){var e=[];for(let t of Object.keys(n))e.push(c(n[t]).then(e=>{n[t]=e}));return Promise.all(e).then(()=>{})}function y(e){let t=h.breakpoints,n=t[0],i=1/0;for(var r of t){var s=e-r.binAddr;0<=s&&s<i&&(i=s,n=r)}return n}function u(t){if(i)return Promise.resolve();let d;return i=!0,k().then(i=>{var e=g.decodeU32LE(t)[0],r={};for(let n of h.procDebugInfo[0].locals){let e=i.globals,t=(()=>{switch(n.type){case"uint32":return g.read32(e,n.index);case"int32":return 0|g.read32(e,n.index);case"uint16":return g.read16(e,n.index);case"int16":return g.read16(e,n.index)<<16>>16;case"uint8":return e[n.index];case"int8":return e[n.index]<<24>>24;default:return null}})();null===t&&(m.assert(0==(3&n.index)),t=b(g.read32(e,n.index))),r[n.name]=t}return p=y(e),d={type:"debugger",subtype:"breakpoint",breakpointId:p.id,globals:r,stackframes:[]},n(),o.talkAsync(1888490768)}).then(e=>{{var s=g.decodeU32LE(e),a=d;let n=p.binAddr,i=0,r=h.procDebugInfo.filter(e=>e.codeStartLoc<=n&&n<=e.codeEndLoc)[0];for(;r&&r!=h.procDebugInfo[0];){var o,l=y(n),c=m.clone(l);c.functionName=r.name,c.argumentNames=r.args&&r.args.map(e=>e.name),a.stackframes.push({locals:{},funcInfo:c,breakpointId:l.id});let e=a.stackframes[a.stackframes.length-1],t=0;for(o of r.locals)m.assert(o.index==t++),e.locals[o.name]=b(s[i++]);n=2147483646&s[i++];var u,c=f[n+""];for(u of r.args)e.locals[u.name]=b(s[i+(r.args.length-1-u.index)]);if(!c)break;r=c.from,i+=c.stack-r.localsMark}}e=[d.globals].concat(d.stackframes.map(e=>e.locals));return m.promiseMapAll(e,v)}).then(()=>s.postMessage(d))}function d(){i=!1,e=new Promise((e,t)=>{n=e})}function w(e=!1){return Promise.resolve().then(()=>o.talkAsync(665147697,g.encodeU32LE([e?1:3]))).then(d)}function x(){return e=e||Promise.resolve()}function k(){return(t?Promise.resolve(t):o.talkAsync(1409050336).then(e=>t={numGlobals:A(e,0),globalsPtr:A(e,4)})).then(e=>o.readWordsAsync(e.globalsPtr,e.numGlobals)).then(e=>({staticState:t,globals:e}))}s.taggedUndefined=0,s.taggedNull=6,s.taggedFalse=10,s.taggedTrue=66,s.postMessage=e=>console.log(e),s.decodeValue=b,s.heapExpandAsync=c,s.heapExpandMapAsync=v,s.startDebugAsync=function(r,e){return(o=e).onEvent(915601917,u),i=!1,h=null,t=null,Promise.resolve().then(()=>{h=r,f={};var e,t,n=[];for(e of r.procDebugInfo)n[e.idx]=e;for(t of r.procDebugInfo)for(var i of t.calls)f[i.addr+""]={from:t,to:n[i.procIndex],stack:i.stack}}).then(()=>{var e=h.outfiles[pxtc.BINARY_UF2],e=m.stringToUint8Array(atob(e));return a=pxtc.UF2.toBin(e),o.reflashAsync(h).then(()=>o.reconnectAsync())}).then(()=>o.talkAsync(287358355).catch(e=>{})).then(()=>m.delay(200)).then(()=>o.reconnectAsync()).then(d).then(x)},s.handleMessage=function(t){if(console.log("HWDBGMSG",t),"debugger"==t.type){let e=!1;switch(t.subtype){case"stepinto":e=!0;case"stepover":w(e)}}},s.resumeAsync=w,s.waitForHaltAsync=x,s.getHwStateAsync=k}}(pxt=pxt||{}),function(f){f.ImageConverter=class{logTime(){var e;this.start&&(e=Date.now()-this.start,f.debug("Icon creation: "+e+"ms"))}convert(e){this.start||(this.start=Date.now());let t=atob(e.slice(e.indexOf(",")+1)),n=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2);if(135===n&&(n=224|t.charCodeAt(1),i=t.charCodeAt(2)|t.charCodeAt(3)<<8,r=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=n&&228!=n)return null;if(!this.palette){var s=f.appTarget.runtime.palette.map(function(e){e=parseInt(e.replace(/#/,""),16);return[e>>0&255,e>>8&255,e>>16&255,255]});s[0][3]=0,this.palette=new Uint8Array(4*s.length);for(let e=0;e<s.length;++e)this.palette[4*e+0]=s[e][0],this.palette[4*e+1]=s[e][1],this.palette[4*e+2]=s[e][2],this.palette[4*e+3]=s[e][3]}return 225==n?this.genMonochrome(t,i,r):(e=(f.BrowserUtils.isEdge()||f.BrowserUtils.isIE())&&i<100&&r<100?3:1,this.genColor(t,i,r,e))}genMonochrome(t,n,i){var r=n+3&-4,s=54+this.palette.length,e=s+r*i,a=new Uint8Array(e);a[0]=66,a[1]=77,f.HF2.write32(a,2,e),f.HF2.write32(a,10,s),f.HF2.write32(a,14,40),f.HF2.write32(a,18,n),f.HF2.write32(a,22,-i),f.HF2.write16(a,26,1),f.HF2.write16(a,28,8),f.HF2.write32(a,38,2835),f.HF2.write32(a,42,2835),f.HF2.write32(a,46,this.palette.length>>2),a.set(this.palette,54);let o=4,l=s,c=1,u=t.charCodeAt(o++);for(let e=0;e<n;++e){l=s+e;for(let e=0;e<i;++e)a[l]=u&c?1:0,l+=r,256==(c<<=1)&&(c=1,u=t.charCodeAt(o++))}return"data:image/bmp;base64,"+btoa(f.U.uint8ArrayToString(a))}genColor(s,e,a,o){var t=e*(o=Math.max(1,0|o)),l=a*o,c=t<<2,e=138+c*l,u=new Uint8Array(e);u[0]=66,u[1]=77,f.HF2.write32(u,2,e),f.HF2.write32(u,10,138),f.HF2.write32(u,14,124),f.HF2.write32(u,18,t),f.HF2.write32(u,22,-l),f.HF2.write16(u,26,1),f.HF2.write16(u,28,32),f.HF2.write16(u,30,3),f.HF2.write32(u,38,2835),f.HF2.write32(u,42,2835),f.HF2.write32(u,54,16711680),f.HF2.write32(u,58,65280),f.HF2.write32(u,62,255),f.HF2.write32(u,66,4278190080),u[70]=66,u[71]=71,u[72]=82,u[73]=115;let d=4,h=138,p=!0;for(let r=0;r<t;r++){let t=!1,e=(h=138+(r<<2),d),n=s.charCodeAt(d++),i=t?(n>>4&15)<<2:(15&n)<<2;for(let e=0;e<l;e++)n&&(p=!1),u[h]=this.palette[i],u[h+1]=this.palette[i+1],u[h+2]=this.palette[i+2],u[h+3]=this.palette[i+3],h+=c,e%o==o-1&&(t&&(n=s.charCodeAt(d++)),t=!t,i=t?(n>>4&15)<<2:(15&n)<<2);if(p&&(u[141]=1),r%o==o-1)for(a%2||--d;3&d;)d++;else d=e}return"data:image/bmp;base64,"+btoa(f.U.uint8ArrayToString(u))}}}(pxt=pxt||{}),function(s){function a(){const t={"tsconfig.json":i.TS_CONFIG,"test.ts":`// ${lf("tests go here; this will not be compiled when this package is used as an extension.")}
`,"_config.yml":"makecode:\n  target: @TARGET@\n  platform: @PLATFORM@\n  home_url: @HOMEURL@\ntheme: jekyll-theme-slate\ninclude:\n  - assets\n  - README.md\n",Makefile:"all: deploy\n\nbuild:\n\tpxt build\n\ndeploy:\n\tpxt deploy\n\ntest:\n\tpxt test\n",Gemfile:"source 'https://rubygems.org'\ngem 'github-pages', group: :jekyll_plugins","README.md":`
> ${lf("Open this page at {0}","[https://@REPOOWNER@.github.io/@REPONAME@/](https://@REPOOWNER@.github.io/@REPONAME@/)")}

## ${lf("Use as Extension")}

${lf("This repository can be added as an **extension** in MakeCode.")}

* ${lf("open [@HOMEURL@](@HOMEURL@)")}
* ${lf("click on **New Project**")}
* ${lf("click on **Extensions** under the gearwheel menu")}
* ${lf("search for **https://github.com/@REPO@** and import")}

## ${lf("Edit this project")} ![${lf("Build status badge")}](https://github.com/@REPO@/workflows/MakeCode/badge.svg)

${lf("To edit this repository in MakeCode.")}

* ${lf("open [@HOMEURL@](@HOMEURL@)")}
* ${lf("click on **Import** then click on **Import URL**")}
* ${lf("paste **https://github.com/@REPO@** and click import")}

## ${lf("Blocks preview")}

${lf("This image shows the blocks code from the last commit in master.")}
${lf("This image may take a few minutes to refresh.")}

![${lf("A rendered view of the blocks")}](https://github.com/@REPO@/raw/master/.github/makecode/blocks.png)

#### ${lf("Metadata (used for search, rendering)")}

* for PXT/@TARGET@
<script src="https://makecode.com/gh-pages-embed.js"></script><script>makeCodeRender("{{ site.makecode.home_url }}", "{{ site.github.owner_name }}/{{ site.github.repository_name }}");</script>
`,".gitignore":"# MakeCode\nbuilt\nnode_modules\nyotta_modules\nyotta_targets\npxt_modules\n_site\n*.db\n*.tgz\n.header.json\n.simstate.json\n",".vscode/settings.json":'{\n    "editor.formatOnType": true,\n    "files.autoSave": "afterDelay",\n    "files.watcherExclude": {\n        "**/.git/objects/**": true,\n        "**/built/**": true,\n        "**/node_modules/**": true,\n        "**/yotta_modules/**": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules/**": true\n    },\n    "files.associations": {\n        "*.blocks": "html",\n        "*.jres": "json"\n    },\n    "search.exclude": {\n        "**/built": true,\n        "**/node_modules": true,\n        "**/yotta_modules": true,\n        "**/yotta_targets": true,\n        "**/pxt_modules": true\n    }\n}',".github/workflows/makecode.yml":"name: MakeCode\n\non: [push]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [14.x]\n\n    steps:\n      - uses: actions/checkout@v1\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v1\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: npm install\n        run: |\n          npm install -g pxt\n          pxt target @TARGET@\n      - name: build\n        run: |\n          pxt install\n          pxt build --cloud\n        env:\n          CI: true\n",".github/workflows/cfg-check.yml":"name: Check pxt.json\n\non:\n  push:\n    branches:\n      - 'master'\n      - 'main'\n\njobs:\n  check-cfg:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node-version: [14.x]\n    steps:\n      - uses: actions/checkout@v2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v1\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: npm install\n        run: |\n          npm install -g pxt\n          pxt target @TARGET@\n      - name: Checkout current state\n        run: |\n          git checkout -- .\n          git clean -fd\n      - name: Fix files listed in config if necessary\n        run: pxt checkpkgcfg\n      - name: Create Pull Request\n        uses: peter-evans/create-pull-request@v3\n        continue-on-error: true\n        with:\n          title: 'Removing missing files from pxt.json'\n          commit-message: 'Removing missing files from pxt.json'\n          delete-branch: true\n",".vscode/tasks.json":'\n// A task runner that calls the MakeCode (PXT) compiler\n{\n    "version": "2.0.0",\n    "tasks": [{\n        "label": "pxt deploy",\n        "type": "shell",\n        "command": "pxt deploy --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt build",\n        "type": "shell",\n        "command": "pxt build --local",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt install",\n        "type": "shell",\n        "command": "pxt install",\n        "group": "build",\n        "problemMatcher": [ "$tsc" ]\n    }, {\n        "label": "pxt clean",\n        "type": "shell",\n        "command": "pxt clean",\n        "group": "test",\n        "problemMatcher": [ "$tsc" ]\n    }]\n}\n'},n=e();return n&&Object.keys(n).forEach(e=>t[e]=n[e]),t}function e(){var e=s.appTarget.bundledpkgs[s.template.TEMPLATE_PRJ];if(e)return delete(e=s.Util.clone(e))[s.CONFIG_NAME],e}var i;(i=s.template||(s.template={})).TS_CONFIG='{\n    "compilerOptions": {\n        "target": "ES5",\n        "noImplicitAny": true,\n        "outDir": "built",\n        "rootDir": "."\n    },\n    "exclude": ["pxt_modules/**/*test.ts"]\n}\n',i.defaultFiles=a,i.targetTemplateFiles=e,i.TEMPLATE_PRJ="template",i.packageFiles=function(e){var t=s.appTarget.blocksprj||s.appTarget.tsprj,n=s.U.clone(t.config),i=(delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.preferredEditor=n.files.find(e=>/\.blocks$/.test(e))?s.BLOCKS_PROJECT_NAME:s.JAVASCRIPT_PROJECT_NAME,n.name=e,n.public=!0,n.version||(n.version="0.0.0"),{}),r=a();for(const s in r)i[s]=r[s];for(const s in t.files)"README.md"!=s&&(i[s]=t.files[s]);e=Object.keys(i).filter(e=>/\.(blocks|md|ts|asm|cpp|h|py)$/.test(e));return n.files=e.filter(e=>!/test/.test(e)),n.testFiles=e.filter(e=>/test/.test(e)),n.supportedTargets=[s.appTarget.id],i[s.CONFIG_NAME]=s.Package.stringifyConfig(n),i},i.packageFilesFixup=function(n,e){const i=JSON.parse(n[s.CONFIG_NAME]);e&&s.Util.jsonMergeFrom(i,e),s.webConfig&&(Object.keys(s.webConfig).forEach(e=>i[e.toLowerCase()]=s.webConfig[e]),i.platform=s.appTarget.platformid||s.appTarget.id,i.target=s.appTarget.id,i.docs=s.appTarget.appTheme.homeUrl||"./",i.homeurl=s.appTarget.appTheme.homeUrl||"???"),s.U.iterMap(n,(e,t)=>{t=t.replace(/@([A-Z]+)@/g,(e,t)=>i[t.toLowerCase()]||""),n[e]=t})}}(pxt=pxt||{}),function(b){{var e=b.blocks||(b.blocks={}),t,n;let m,g;(t=m=e.NT||(e.NT={}))[t.Prefix=0]="Prefix",t[t.Postfix=1]="Postfix",t[t.Infix=2]="Infix",t[t.Block=3]="Block",t[t.NewLine=4]="NewLine",(t=g=e.GlueMode||(e.GlueMode={}))[t.None=0]="None",t[t.WithSpace=1]="WithSpace",t[t.NoSpace=2]="NoSpace";const x=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];function i(e){return"`"+e.replace(/[\\`${}]/g,e=>"\\"+e)+"`"}function r(e){return 20<e.length&&/\n/.test(e)?i(e):JSON.stringify(e)}function s(e,t,n){return{type:e,op:t,children:n}}function a(){return s(m.NewLine,"",[])}function o(e,t){return s(m.Prefix,e,t)}function l(e,t,n){return s(m.Infix,t,null==e?[n]:[e,n])}function v(e){return o(e,[])}function c(e){return s(m.Block,"",e)}function y(e){return o("",e)}function u(e,t=!1){var n=[];for(const i of e)t?(0<n.length&&n.push(v(",")),n.push(a())):0<n.length&&n.push(v(", ")),n.push(i);return t&&n.push(a()),y(n)}function d(e,t,n=!1,i=!1){return y(i?[l(t[0],".",v(e)),v("("),u(t.slice(1),n),v(")")]:[v(e),v("("),u(t,n),v(")")])}function h(e,t,n,i){return d(e+"."+t,n,i)}function p(e,t){return b.U.assert(2==t.length),l(t[0],e,t[1])}e.backtickLit=i,e.stringLit=r,e.mkNode=s,e.mkNewLine=a,e.mkPrefix=o,e.mkPostfix=function(e,t){return s(m.Postfix,t,e)},e.mkInfix=l,e.mkText=v,e.mkBlock=c,e.mkGroup=y,e.mkStmt=function(...e){var t=e[e.length-1];return t&&t.type==m.Block||e.push(a()),y(e)},e.mkCommaSep=u,(n=t=e.Helpers||(e.Helpers={})).mkArrayLiteral=function(e,t){return y([v("["),u(e,t),v("]")])},n.mkNumberLiteral=function(e){return v(e.toString())},n.mkBooleanLiteral=function(e){return v(e?"true":"false")},n.mkStringLiteral=function(e){return v(r(e))},n.mkPropertyAccess=function(e,t){return y([l(t,".",v(e))])},n.mkCall=d,n.stdCall=function(e,t,n){return d(e,t,n)},n.extensionCall=function(e,t,n){return d(e,t,n,!0)},n.namespaceCall=h,n.mathCall=function(e,t){return h("Math",e,t,!1)},n.mkGlobalRef=v,n.mkSimpleCall=p,n.mkWhile=function(e,t){return y([v("while ("),e,v(")"),c(t)])},n.mkComment=function(e){return v("// "+e)},n.mkMultiComment=function(e){let i=[v("/**"),a()];return e.split("\n").forEach((e,t,n)=>{e&&(i.push(v(" * "+e)),i.push(a()),t<n.length-1)&&(i.push(v(" * ")),i.push(a()))}),y(i.concat([v(" */"),a()]))},n.mkAssign=function(e,t){return p("=",[e,t])},n.mkParenthesizedExpression=function(e){return w(f([e]).output)?e:y([v("("),e,v(")")])},e.H=t;const k={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};function f(e){let a=[],o={},l="",c="",u=[{}],d=0;function h(e){"string"==typeof e&&(d+=(e.match(/\n/g)||[]).length),l+=e}e=y(e);return function e(n,i){if(n.type!=m.Infix)for(var t of n.children)e(t,-1);else{let t=[];var r,s=b.U.lookup(k,n.op);function a(e){"P"==e[0]&&(e=e.slice(1)),t.push(v(e))}null==s&&b.U.oops("bad infix op: "+n.op),s<i&&a("("),1==n.children.length?(a(n.op),e(n.children[0],s),t.push(n.children[0])):(r=3!=s&&"**"!=n.op,e(n.children[0],r?s:s+.1),t.push(n.children[0]),"."==n.op?a("."):a(" "+n.op+" "),e(n.children[1],r?s+.1:s),t.push(n.children[1])),s<i&&a(")"),n.type=m.Prefix,n.op="",n.children=t}}(e,-1),function r(e){e.glueToBlock&&(f(),e.glueToBlock==g.WithSpace)&&h(" ");let t=d,n=l.length;switch(e.type){case m.Infix:b.U.oops("no infix should be left");break;case m.NewLine:h("\n"+c);break;case m.Block:!function(e){let t=e.noFinalNewline?"":"\n";if(0==e.children.length)return p(" {\n\t\n}"+t);let n=b.U.clone(u[u.length-1]||{});u.push(n),c+="    "," "!=l[l.length-1]&&p(" "),p("{\n");for(var i of e.children)r(i);c=c.slice(4),f(),p("\n}"+t),u.pop()}(e);break;case m.Prefix:e.canIndentInside?h(e.op.replace(/\n/g,"\n"+c+"    ")):h(e.op),e.children.forEach(r);break;case m.Postfix:e.children.forEach(r),e.canIndentInside?h(e.op.replace(/\n/g,"\n"+c+"    ")):h(e.op)}let i=d,s=Math.max(l.length,1);if(e.id)if(o[e.id]){const b=o[e.id];b.startLine=Math.min(b.startLine,t),b.endLine=Math.max(b.endLine,i),b.startPos=Math.min(b.startPos,n),b.endPos=Math.max(b.endPos,s)}else{const b={id:e.id,startLine:t,startPos:n,endLine:i,endPos:s};o[e.id]=b,a.push(b)}}(e),l||h("\n"),{output:l,sourceMap:a};function p(e){h(e.replace(/\n/g,"\n"+c))}function f(){l=l.replace(/\n *$/,function(){return d--,""})}}function w(n){if("("===n[0]&&")"===n[n.length-1]){let t=1;for(let e=1;e<n.length;e++){var i=n[e];if("("===i)t++;else if(")"===i&&0===--t)return e===n.length-1}}return!1}e.flattenNode=f,e.isReservedWord=function(e){return-1!==x.indexOf(e)},e.isParenthesized=w}}(pxt=pxt||{}),function(c){{var a=c.sprite||(c.sprite={});const x=[".","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];a.BLOCKLY_TILESET_TYPE="BLOCKLY_TILESET_TYPE",a.TILE_PREFIX="tile",a.TILE_NAMESPACE="myTiles",a.IMAGES_NAMESPACE="myImages",a.IMAGE_PREFIX="image",a.ANIMATION_NAMESPACE="myAnimations",a.ANIMATION_PREFIX="anim";class k{constructor(e,t,n=0,i=0,r){this.width=e,this.height=t,this.x0=n,this.y0=i,this.width||(this.width=16),this.height||(this.height=16),this.buf=r||new Uint8ClampedArray(this.dataLength())}static fromData(e){return new k(e.width,e.height,e.x0,e.y0,e.data)}set(e,t,n){e<this.width&&t<this.height&&0<=e&&0<=t&&(e=this.coordToIndex(e,t),this.setCore(e,n))}get(e,t){return e<this.width&&t<this.height&&0<=e&&0<=t?(e=this.coordToIndex(e,t),this.getCore(e)):0}copy(n=0,i=0,e=this.width,r=this.height){var s=new k(e,r);s.x0=n,s.y0=i;for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.set(t,e,this.get(n+t,i+e));return s}apply(n,i=!1){var r;for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++)!(r=n.get(t,e))&&i||this.set(n.x0+t,n.y0+e,r)}equals(t){if(this.width!==t.width||this.height!==t.height||this.x0!==t.x0||this.y0!==t.y0||this.buf.length!==t.buf.length)return!1;for(let e=0;e<this.buf.length;e++)if(this.buf[e]!==t.buf[e])return!1;return!0}data(){return{width:this.width,height:this.height,x0:this.x0,y0:this.y0,data:this.buf}}resize(e,t){return s(this,e,t)}coordToIndex(e,t){return e+t*this.width}getCore(e){var t=Math.floor(e/2);return e%2==0?15&this.buf[t]:(240&this.buf[t])>>4}setCore(e,t){var n=Math.floor(e/2);this.buf[n]=e%2==0?240&this.buf[n]|15&t:15&this.buf[n]|(15&t)<<4}dataLength(){return Math.ceil(this.width*this.height/2)}}a.Bitmap=k;class A extends k{static fromData(e){return new A(e.width,e.height,e.x0,e.y0,e.data)}copy(n=0,i=0,e=this.width,r=this.height){var s=new A(e,r);s.x0=n,s.y0=i;for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.set(t,e,this.get(n+t,i+e));return s}resize(e,t){return u(this,e,t)}getCore(e){return this.buf[e]}setCore(e,t){this.buf[e]=t}dataLength(){return this.width*this.height}}a.Tilemap=A;class T{constructor(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0}cloneData(){var e=this.tilemap.copy(),t={tileWidth:this.tileset.tileWidth,tiles:this.tileset.tiles.map(e=>Object.assign(Object.assign({},e),{bitmap:k.fromData(e.bitmap).copy().data()}))},n=k.fromData(this.layers).copy().data();return new T(e,t,n)}equals(t){if(!this.tilemap.equals(t.tilemap)||this.tileset.tileWidth!=t.tileset.tileWidth||this.tileset.tiles.length!=t.tileset.tiles.length||!e(this.layers,t.layers))return!1;for(let e=0;e<this.tileset.tiles.length;e++)if(!c.assetEquals(this.tileset.tiles[e],t.tileset.tiles[e]))return!1;return!0}}function n(e){return t(atob(e.slice(e.indexOf(",")+1)))}function t(r){let e=r.charCodeAt(0),s=r.charCodeAt(1),a=r.charCodeAt(2);135===e&&(e=224|r.charCodeAt(1),s=r.charCodeAt(2)|r.charCodeAt(3)<<8,a=r.charCodeAt(4)|r.charCodeAt(5)<<8,r=r.slice(4));var o=new c.sprite.Bitmap(s,a);let l=4;if(225===e){let n=1,i=r.charCodeAt(l++);for(let t=0;t<s;++t)for(let e=0;e<a;++e)o.set(t,e,i&n?1:0),256==(n<<=1)&&(n=1,i=r.charCodeAt(l++))}else for(let t=0;t<s;t++){for(let e=0;e<a;e+=2){var n=r.charCodeAt(l++);o.set(t,e,15&n),e!=a-1&&o.set(t,e+1,n>>4&15)}for(;3&l;)l++}return o}function o(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:hex)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);var t=parseInt(e.substr(0,2),16)|parseInt(e.substr(2,2),16)<<8,n=parseInt(e.substr(4,2),16)|parseInt(e.substr(6,2),16)<<8,e=b(e.substring(8));return A.fromData({width:t,height:n,x0:0,y0:0,data:e})}function i(e){return""+r(e.width,2)+r(e.height,2)+v(e.data().data)}function l(e,i){return(e=e.replace(/[\[\]]/g,""))?e.split(",").filter(e=>!!e.trim()).map(e=>{var t=e,n=i;if(0===(t=t.trim()).indexOf("img"))return e=d(t),n.createNewTile(e.data());switch(t){case"myTiles.tile0":case"myTiles.transparency16":return n.getTransparency(16);case"myTiles.transparency8":return n.getTransparency(8);case"myTiles.transparency32":return n.getTransparency(32);default:return n.resolveTile(t)}}):[]}function r(e,t){let n=e.toString(16);var i=t<<1;for(1&n.length&&(n="0"+n);n.length<i;)n+="0";return n}function s(e,t,n){t=new k(t,n);return t.apply(e),t}function u(e,t,n){t=new A(t,n);return t.apply(e),t}function d(e){const n=(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n")).split("\n"),i=[];let r=0;for(let e=0;e<n.length;e++){const k=n[e],s=[];for(let e=0;e<k.length;e++)switch(k[e]){case"0":case".":s.push(0);break;case"1":case"#":s.push(1);break;case"2":case"T":s.push(2);break;case"3":case"t":s.push(3);break;case"4":case"N":s.push(4);break;case"5":case"n":s.push(5);break;case"6":case"G":s.push(6);break;case"7":case"g":s.push(7);break;case"8":s.push(8);break;case"9":s.push(9);break;case"a":case"A":case"R":s.push(10);break;case"b":case"B":case"P":s.push(11);break;case"c":case"C":case"p":s.push(12);break;case"d":case"D":case"O":s.push(13);break;case"e":case"E":case"Y":s.push(14);break;case"f":case"F":case"W":s.push(15);break;default:if(!/\s/.test(k[e]))return}s.length&&(i.push(s),r=Math.max(r,s.length))}const s=i.length,a=new k(r,s);for(let t=0;t<s;t++){const n=i[t];for(let e=0;e<r;e++)e<n.length?a.set(e,t,n[e]):a.set(e,t,0)}return a}function h(e){let t="";return t="python"===e?'img("""':"img`"}function p(e){let t="";return t+="python"===e?'""")':"`"}function f(n,i){if(!n||0===n.height||0===n.width)return"";let r=h(i);if(n){const i=300<n.width*n.height?"":" ";for(let t=0;t<n.height;t++){r+="\n";for(let e=0;e<n.width;e++)r+=x[n.get(e,t)]+i}}return r=(r+="\n")+p(i)}function e(e,t){return c.sprite.Bitmap.fromData(e).equals(c.sprite.Bitmap.fromData(t))}function m(e){switch(e){case 8:return"TileScale.Eight";case 16:return"TileScale.Sixteen";case 32:return"TileScale.ThirtyTwo";default:return Math.floor(Math.log2(e)).toString()}}function g(e){switch(e=e.replace(/\s/g,"")){case"TileScale.Eight":return 8;case"TileScale.Sixteen":return 16;case"TileScale.ThirtyTwo":return 32;default:return Math.pow(2,parseInt(e))}}function b(t){var n=new Uint8ClampedArray(t.length>>1);for(let e=0;e<t.length;e+=2)n[e>>1]=parseInt(t.slice(e,e+2),16);return n}function v(t){var n="0123456789abcdef";let i="";for(let e=0;e<t.length;++e)i=(i+=n[t[e]>>4])+n[15&t[e]];return i}function y(e,t,n){e[t]=255&n,e[t+1]=n>>8&255}function w(e){e=function(e){if(e){if(6===e.length)return parseInt("0x"+e);if(7===e.length)return parseInt("0x"+e.substr(1))}return 0}(e);return[e>>16&255,e>>8&255,255&e]}a.TilemapData=T,a.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){e+=this.width*t;this.mask[e>>3]|=1<<(7&e)}get(e,t){e+=this.width*t;return this.mask[e>>3]>>(7&e)&1}},a.encodeTilemap=function(e,t){return e?`tiles.createTilemap(${n=e.tilemap,n?`hex\`${i(n)}\``:"hex``"}, ${f(k.fromData(e.layers),t)}, [${e.tileset.tiles.map(e=>e.id)}], ${m(e.tileset.tileWidth)})`:"null";var n},a.decodeTilemap=function(e,t,n){var i,r,s;return(e=c.Util.htmlUnescape(e).trim()).trim()?(i=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),r=(e=e.substr(i.length+1)).substr(0,e.indexOf(",")),s=(e=e.substr(r.length+1)).substr(0,e.lastIndexOf("]")+1),e=e=e.substr(s.length+1),new T(o(i),{tiles:l(s,n),tileWidth:g(e)},d(r).data())):null},a.trimTilemapTileset=function(e){const n=e.tileset.tiles.slice(),i=e.tilemap,r={};r[n[0].id]=!0;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)r[n[i.get(t,e)].id]=!0;const t=e.editedTiles||[],s=n.filter(e=>r[e.id]||"*"===e.id.charAt(0)||-1!==t.indexOf(e.id));if(s.length!==n.length){var a=[];for(let e=0;e<n.length;e++)a.push(s.indexOf(n[e]));for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)i.set(t,e,a[i.get(t,e)]);e.tileset.tiles=s}},a.isEmptyTilemap=function(e){var n=e.tileset.tiles,i=e.tilemap,r=n[0].id;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)if(n[i.get(t,e)].id!==r)return!1;return!0},a.computeAverageColor=function(n,e){var i=e.map(w),r=[0,0,0];let s=0;for(let t=0;t<n.width;t++)for(let e=0;e<n.height;e++){var a=n.get(t,e);if(a){++s;const n=i[a];r[0]+=n[0],r[1]+=n[1],r[2]+=n[2]}}return s?"#"+function(t){let n="";for(let e=0;e<t.length;++e)n+=("0"+t[e].toString(16)).slice(-2);return n}(r.map(e=>Math.floor(e/s))):"#00000000"},a.getBitmap=function(e,t){e=e.apis.byQName[t];return e?n(e.attributes.jresURL):null},a.getBitmapFromJResURL=n,a.hexToBitmap=t,a.filterItems=function(e,t){const r=(t=t.filter(e=>!!e).map(e=>e.toLowerCase())).filter(e=>0!==e.indexOf("!")),s=t.filter(e=>0===e.indexOf("!")&&1<e.length).map(e=>e.substring(1));return e.filter(e=>{return i=e,r.every(t=>{const n="?"+t;return i.tags.some(e=>e===t||e===n)})&&(n=e,s.every(t=>!n.tags.some(e=>e===t)));var n,i})},a.getGalleryItems=function(e,t){i=e.apis,r=t;let n=c.Util.values(i.byQName).filter(e=>{return 4===e.kind&&e.attributes.fixedInstance&&((e=e.retType)==r||!(!(e=i.byQName[e])||!e.extendsTypes)&&0<=e.extendsTypes.indexOf(r))});var i,r;n=n.filter(e=>e.namespace!=a.TILE_NAMESPACE);{e=n;const s=new c.ImageConverter;e.forEach(e=>{e.attributes.jresURL&&!e.attributes.iconURL&&0==e.attributes.jresURL.indexOf("data:image/x-mkcd-f")&&(e.attributes.iconURL=s.convert(e.attributes.jresURL))})}return n.map(e=>{var t=(e.attributes.tags||"").split(" ").filter(e=>!!e).map(e=>c.Util.startsWith(e,"category-")?e:e.toLowerCase());return{qName:e.qName,src:e.attributes.iconURL,alt:e.qName,tags:t}})},a.base64EncodeBitmap=function(e){const n=k.fromData(e),t=pxtc.f4EncodeImg(e.width,e.height,4,(e,t)=>n.get(e,t));return btoa(c.U.uint8ArrayToString(b(t)))},a.tilemapLiteralToTilemap=o,a.hexEncodeTilemap=i,a.formatByte=r,a.resizeBitmap=s,a.resizeTilemap=u,a.imageLiteralToBitmap=d,a.encodeAnimationString=function(e,t){const n=e.map(e=>e.data),i=new Uint8ClampedArray(8+n[0].length*n.length);y(i,0,t),y(i,2,e[0].width),y(i,4,e[0].height),y(i,6,e.length);let r=8;return n.forEach(e=>{i.set(e,r),r+=e.length}),btoa(c.sprite.uint8ArrayToHex(i))},a.addMissingTilemapTilesAndReferences=function(e,t){var n=e.getProjectTiles(t.data.tileset.tileWidth,!0);t.data.projectReferences=[];for(const i of n.tiles)t.data.tileset.tiles.some(e=>e.id===i.id)||t.data.tileset.tiles.push(i),e.isAssetUsed(i,null,[t.id])&&t.data.projectReferences.push(i.id)},a.updateTilemapReferencesFromResult=function(t,n){var i=n.data;if(i.deletedTiles)for(const c of i.deletedTiles)t.deleteTile(c);if(i.editedTiles)for(const c of i.editedTiles){const n=i.tileset.tiles.findIndex(e=>e.id===c),e=i.tileset.tiles[n];e&&(i.tileset.tiles[n]=t.updateTile(e))}for(let e=0;e<i.tileset.tiles.length;e++){const n=i.tileset.tiles[e];n.jresData||(i.tileset.tiles[e]=t.resolveTile(n.id))}c.sprite.trimTilemapTileset(i)},a.imageLiteralFromDimensions=function(t,n,i,e){let r=h(e);var s=300<t*n?"":" ";for(let e=0;e<n;e++){r+="\n";for(let e=0;e<t;e++)r+=x[i]+s}return r=(r+="\n")+p(e)},a.bitmapToImageLiteral=f,a.bitmapEquals=e,a.tileWidthToTileScale=m,a.tileScaleToTileWidth=g,a.hexToUint8Array=b,a.uint8ArrayToHex=v,a.colorStringToRGB=w}}(pxt=pxt||{}),function(s){var a=s.sprite||(s.sprite={});{var e=a.legacy||(a.legacy={});const n=new RegExp(`^\\s*${a.TILE_NAMESPACE}\\s*\\.\\s*${a.TILE_PREFIX}(\\d+)\\s*$`);class l{constructor(e,t,n){this.tilemap=e,this.tileset=t,this.layers=n,this.nextId=0}}function o(e){return(e=e.replace(/[\[\]]/g,""))?e.split(",").filter(e=>!!e.trim()).map(e=>{return 0===(e=(e=e).trim()).indexOf("img")?{data:a.imageLiteralToBitmap(e).data()}:(t=n.exec(e))?{data:null,projectId:Number(t[1])}:{data:null,qualifiedName:e};var t}):[]}e.LegacyTilemapData=l,e.decodeTilemap=function(e,t){var n,i,r;return null!=(e=null==(n=s.Util.htmlUnescape(e))?void 0:n.trim())&&e.trim()?(n=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),i=(e=e.substr(n.length+1)).substr(0,e.indexOf(",")),r=(e=e.substr(i.length+1)).substr(0,e.lastIndexOf("]")+1),e=e=e.substr(r.length+1),new l(a.tilemapLiteralToTilemap(n),{tiles:o(r),tileWidth:a.tileScaleToTileWidth(e)},a.imageLiteralToBitmap(i).data())):new l(new a.Tilemap(16,16),{tileWidth:16,tiles:[]},new a.Bitmap(16,16).data())},e.tileToBlocklyVariable=function(e){return`${e.projectId};${e.data.width};${e.data.height};`+pxtc.Util.toHex(e.data.data)},e.blocklyVariableToTile=function(e){e=e.split(";");return 4!==e.length?null:{projectId:parseInt(e[0]),data:{width:parseInt(e[1]),height:parseInt(e[2]),data:new Uint8ClampedArray(pxtc.Util.fromHex(e[3])),x0:0,y0:0}}}}}(pxt=pxt||{}),function(i){{var e=i.storage||(i.storage={});class a{constructor(){this.items={}}removeItem(e){delete this.items[e]}getItem(e){return this.items[e]}setItem(e,t){this.items[e]=t}clear(){this.items={}}}class o{constructor(e){this.storageId=e}targetKey(e){return this.storageId+"/"+e}removeItem(e){window.localStorage.removeItem(this.targetKey(e))}getItem(e){return window.localStorage[this.targetKey(e)]}setItem(e,t){window.localStorage[this.targetKey(e)]=t}clear(){var t=this.targetKey(""),n=[];for(let e=0;e<window.localStorage.length;++e){var i=window.localStorage.key(e);0==i.indexOf(t)&&n.push(i)}n.forEach(e=>window.localStorage.removeItem(e))}}function r(){var e;return i.appTarget?i.appTarget.id:(e=window.pxtConfig)?e.targetId:(e=window.pxtTargetBundle)?e.id:""}let n;function s(){if(!n){var t=r();let e=!1;if(!i.shell.isSandboxMode())try{window.localStorage[t]="1",window.localStorage[t],e=!0}catch(e){}e?(n=new o(t),i.debug("storage: local under "+t)):(n=new a,i.debug("storage: in memory"))}}e.storageId=r,e.setLocal=function(e,t){s(),n.setItem(e,t)},e.getLocal=function(e){return s(),n.getItem(e)},e.removeLocal=function(e){s(),n.removeItem(e)},e.clearLocal=function(){s(),n.clear()}}}(pxt=pxt||{}),function(s){var e=s.storage||(s.storage={});{e=e.shared||(e.shared={});const l="http://localhost:3232/api/store/";function a(){return s.BrowserUtils.isLocalHostDev()&&!s.BrowserUtils.noSharedLocalStorage()}function o(){return s.BrowserUtils.isChromiumEdge()?"chromium-edge":s.BrowserUtils.browser()}e.getAsync=async function(e,t){if(a()){e+="-"+o();const a=await s.Util.requestAsync({url:""+l+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"GET",allowHttpErrors:!0});return a.json||a.text||void 0}{const l=s.storage.getLocal(e+":"+t),a=s.Util.jsonTryParse(l);return a||l}},e.setAsync=async function(e,t,n){if(void 0===n)await s.storage.shared.delAsync(e,t);else{var i="object"==typeof n?JSON.stringify(n):n.toString();if(a()){e+="-"+o();const a={type:"object"==typeof n?"json":"text",val:i},r=JSON.stringify(a);await s.Util.requestAsync({url:""+l+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"POST",data:r})}else s.storage.setLocal(e+":"+t,i)}},e.delAsync=async function(e,t){a()?(e+="-"+o(),await s.Util.requestAsync({url:""+l+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"DELETE",allowHttpErrors:!0})):s.storage.removeLocal(e+":"+t)}}}(pxt=pxt||{}),function(u){const i=["name","version","description","license","dependencies","files","testFiles","testDependencies","fileDependencies","public","targetVersions","supportedTargets","preferredEditor","languageRestriction","additionalFilePath","additionalFilePaths"];class d{constructor(e,t,n,i){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,this.ignoreTests=!1,this.cppOnly=!1,i&&(this.level=i.level+1),this.addedBy=[i]}static stringifyConfig(e){var t=e,n={};for(const e of i)t.hasOwnProperty(e)&&(n[e]=t[e]);for(const e of Object.keys(t))n.hasOwnProperty(e)||(n[e]=t[e]);return JSON.stringify(n,null,4)+"\n"}static parseAndValidConfig(e){const t=u.Util.jsonTryParse(e);return t&&void 0!==t.name&&"string"==typeof t.name&&t.files&&Array.isArray(t.files)&&t.files.every(e=>"string"==typeof e)&&t.dependencies&&Object.keys(t.dependencies).every(e=>"string"==typeof t.dependencies[e])&&t}static getConfigAsync(t,n,i){return Promise.resolve().then(()=>{if(u.github.isGithubId(i)){const t=u.github.parseRepoId(i);return u.packagesConfigAsync().then(e=>u.github.repoAsync(t.fullName,e)).then(e=>e?u.github.pkgConfigAsync(t.fullName,t.tag):null)}var e=u.patching.upgradePackageReference(t,n,i),e=u.appTarget.bundledpkgs[e];return JSON.parse(e[u.CONFIG_NAME])})}static corePackages(){const t=u.appTarget.bundledpkgs;return Object.keys(t).map(e=>JSON.parse(t[e][u.CONFIG_NAME])).filter(e=>!!e)}disablesVariant(e){return this.config&&this.config.disablesVariants&&0<=this.config.disablesVariants.indexOf(e)}invalid(){return/^invalid:/.test(this.version())}version(){return this.resolvedVersion||this._verspec}verProtocol(){var e=this.version().split(":");return 1<e.length?e[0]:""}verArgument(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()}targetVersion(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0}commonDownloadAsync(){const e=this.verProtocol();if("pub"==e)return u.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==e)return u.packagesConfigAsync().then(e=>u.github.downloadPackageAsync(this.verArgument(),e)).then(e=>e.files);if("embed"==e){const e=u.getEmbeddedScript(this.verArgument());return Promise.resolve(e)}if("pkg"!=e)return Promise.resolve(null);{const e=(this.parent||this).readFile(this.verArgument()),t=ts.pxtc.Util.jsonTryParse(e);return t||u.log("unable to find "+this.verArgument()),Promise.resolve(t)}}host(){return this.parent._host}readFile(e){return this.host().readFile(this,e)}readGitJson(){var e=this.readFile(u.github.GIT_JSON);return u.Util.jsonTryParse(e)}resolveDep(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null}saveConfig(){var e=u.U.clone(this.config),e=(delete e.additionalFilePaths,u.Package.stringifyConfig(e));this.host().writeFile(this,u.CONFIG_NAME,e)}setPreferredEditor(e){this.config.preferredEditor!=e&&(this.config.preferredEditor=e,this.saveConfig())}getPreferredEditor(){let e=this.config.preferredEditor;if(e)return e;{if(!(0<=this.getFiles().indexOf(u.MAIN_BLOCKS)))return u.JAVASCRIPT_PROJECT_NAME;const e=this.readFile(u.MAIN_BLOCKS),t=this.readFile(u.MAIN_TS);return!e&&t?u.JAVASCRIPT_PROJECT_NAME:u.BLOCKS_PROJECT_NAME}}parseJRes(e={}){for(const t of this.getFiles())u.U.endsWith(t,".jres")&&n(JSON.parse(this.readFile(t)),e);return e}resolveVersionAsync(){var e;let t=this._verspec;if(u.getEmbeddedScript(this.id))this.resolvedVersion=t="embed:"+this.id;else if(t&&"*"!=t){if("github"==this.verProtocol()){const n=u.github.parseRepoId(this._verspec);n&&!n.tag&&this.parent&&(u.debug("dep: unbound github extensions, trying to resolve tag"),e=u.semver.sortLatestTags(u.Util.values((null==(e=this.parent)?void 0:e.deps)||{}).map(e=>u.github.parseRepoId(e.version())).filter(e=>(null==e?void 0:e.slug)===n.slug).map(e=>e.tag))[0])&&(n.tag=e,this.resolvedVersion=t=u.github.stringifyRepo(n),u.debug(`dep: github patched ${this._verspec} to `+t))}}else this.configureAsInvalidPackage(lf("version not specified for {0}",this.id)),t=this._verspec;return Promise.resolve(t)}downloadAsync(){return this.resolveVersionAsync().then(e=>{if(this.invalid())u.debug("skip download of invalid package "+this.id);else if(/^embed:/.test(e)||this.installedVersion!=e)return u.debug("downloading "+e),this.host().downloadPackageAsync(this).then(()=>{this.loadConfig(),u.debug(`installed ${this.id} /`+e)})})}loadConfig(){var e;0!=this.level&&this.invalid()||((e=this.readFile(u.CONFIG_NAME))||u.U.userError(`extension ${this.id} is missing `+u.CONFIG_NAME),this.parseConfig(e),0!=this.level&&(this.installedVersion=this.version()),this.saveConfig())}validateConfig(){this.config.dependencies||u.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||u.U.userError("Missing files in config of: "+this.id),"string"==typeof this.config.name&&this.config.name||(this.config.name=lf("Untitled")),this.config.targetVersions&&this.config.targetVersions.target&&this.config.targetVersions.targetId===u.appTarget.id&&u.appTarget.versions&&0<u.semver.majorCmp(this.config.targetVersions.target,u.appTarget.versions.target)&&u.U.userError(lf("{0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,u.appTarget.versions.target))}isPackageInUse(n,e=this.readFile(u.MAIN_TS)){let i=null;var t=u.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(t=>{Object.keys(t.map).forEach(e=>{t.map[e]===n&&(i=new RegExp(e,"g"))})}),(i=i||new RegExp(n+"\\.","g")).test(e)}upgradePackagesAsync(){return this.config||this.loadConfig(),u.packagesConfigAsync().then(i=>{let r=0,s={};return u.U.iterMap(this.config.dependencies,(e,t)=>{var n;u.github.isGithubId(t)&&(n=u.github.upgradedPackageReference(i,t))&&n!=t&&(u.log(`upgrading dep ${e}: ${t} -> `+n),s[t]=n,this.config.dependencies[e]=n,r++)}),r&&this.saveConfig(),r&&s})}getMissingPackages(r,s){const e=u.patching.computePatches(this.targetVersion(),"missingPackage"),a={};return s&&e&&e.forEach(i=>{Object.keys(i.map).forEach(e=>{const t=new RegExp(e,"g"),n=i.map[e];s.replace(t,e=>(r.dependencies[n]||(a[n]="*"),""))})}),a}findConflictsAsync(e,o){let l,c=[];return Promise.resolve().then(()=>"string"==typeof e?d.getConfigAsync(this.targetVersion(),e,o):Promise.resolve(e)).then(a=>{if(l=a){const a=l.yotta?u.U.jsonFlatten(l.yotta.config):null;this.parent.sortedDeps().forEach(t=>{if(l.core&&t.config.core&&l.name!=t.config.name){const a=new u.cpp.PkgConflictError(lf("conflict between core extensions {0} and {1}",l.name,t.id));a.pkg0=t,void c.push(a)}else{let e=!1;if(a){const o=t.config||JSON.parse(t.readFile(u.CONFIG_NAME));if(o&&o.yotta&&t.config.yotta.config){var n=u.U.jsonFlatten(o.yotta.config);for(const s of Object.keys(a)){var i=n[s],r=l.yotta.configIsJustDefaults||o.yotta.configIsJustDefaults;if(n.hasOwnProperty(s)&&i!==a[s]&&!r&&(!t.parent.config.yotta||!t.parent.config.yotta.ignoreConflicts)){const a=new u.cpp.PkgConflictError(lf("conflict on yotta setting {0} between extensions {1} and {2}",s,l.name,t.id));a.pkg0=t,a.settingName=s,c.push(a),e=!0}}}}if(!e&&l.name===t.id&&t._verspec!==o&&!/^file:/.test(t._verspec)&&!/^file:/.test(o)){const a=/^github:/.test(t._verspec)&&u.github.parseRepoId(t._verspec),l=/^github:/.test(o)&&u.github.parseRepoId(o);if(!a||!l||a.fullName!==l.fullName||l.tag&&u.semver.strcmp(a.tag,l.tag)<0){const a=new u.cpp.PkgConflictError(lf("version mismatch for extension {0} (installed: {1}, installing: {2})",t.id,t._verspec,o));a.pkg0=t,a.isVersionConflict=!0,c.push(a)}}}})}return Object.keys(l.dependencies).reduce((e,t)=>e.then(()=>this.findConflictsAsync(t,l.dependencies[t])).then(e=>c.push.apply(c,e)),Promise.resolve())}).then(()=>{const i=e=>{const t=[];return e.addedBy.forEach(e=>{e.id!==this.id&&(t.push.apply(i(e)),t.push(e))}),t},e=[];return c.forEach(n=>{e.push.apply(e,i(n.pkg0).map(e=>{var t=new u.cpp.PkgConflictError(n.isVersionConflict?lf("a dependency of {0} has a version mismatch with extension {1} (installed: {1}, installing: {2})",e.id,l.name,n.pkg0._verspec,o):lf("conflict on yotta setting {0} between extensions {1} and {2}",n.settingName,l.name,n.pkg0.id));return t.pkg0=e,t}))}),c.push.apply(c,e),c=c.filter((t,n)=>{for(let e=0;e<n;++e)if(t.pkg0.id===c[e].pkg0.id)return!1;return!0})})}configureAsInvalidPackage(e){u.log(`invalid package ${this.id}: `+e),this._verspec="invalid:"+this.id,this.config={name:this.id,description:e,dependencies:{},files:[]}}parseConfig(e,t){try{const u=JSON.parse(e);this.config=u}catch(e){this.configureAsInvalidPackage(lf("Syntax error in pxt.json")),u.tickEvent("package.invalidConfigEncountered")}var n=JSON.stringify(this.config);for(const e in this.config.dependencies){const t=u.patching.upgradePackageReference(this.targetVersion(),e,this.config.dependencies[e]);t!=e&&(delete this.config.dependencies[e],t)&&(this.config.dependencies[t]="*")}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=n&&this.saveConfig(),this.validateConfig()}patchCorePackage(){u.Util.assert(u.appTarget.simulator&&u.appTarget.simulator.dynamicBoardDefinition),u.Util.assert(0==this.level);const e=Object.keys(this.config.dependencies).filter(e=>!!e&&(e==u.BLOCKS_PROJECT_NAME||e==u.JAVASCRIPT_PROJECT_NAME||JSON.parse((u.appTarget.bundledpkgs[e]||{})[u.CONFIG_NAME]||"{}").core));if(0==e.length){const e=u.Package.corePackages();e.length&&this.config.dependencies[e[0].name]}else 1<e.length&&(e.pop(),e.forEach(e=>{u.log("removing core package "+e),delete this.config.dependencies[e]}))}resolvedDependencies(){return Object.keys(this.dependencies()).map(e=>this.resolveDep(e))}dependencies(e=!1){if(!this.config)return{};const n=u.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&u.Util.iterMap(this.config.testDependencies,(e,t)=>{"*"==t&&!u.appTarget.bundledpkgs[e]||(n[e]=t)}),e&&this.config.cppDependencies&&u.Util.jsonMergeFrom(n,this.config.cppDependencies),n}loadAsync(a=!1,e){if(this.isLoaded)return Promise.resolve();let t=Promise.resolve();0!=this.level||u.appTarget.multiVariants||u.setAppTargetVariant(null),this.isLoaded=!0;const n=this.readFile(u.CONFIG_NAME),o=(null==n?a||u.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):t=t.then(()=>this.parseConfig(n)),0!=this.level||a||(t=t.then(()=>this.upgradePackagesAsync().then(()=>{}))),a&&(t=t.then(()=>this.downloadAsync())),0==this.level&&a&&(t=t.then(()=>this.upgradePackagesAsync()).then(e=>e?(Object.keys(e).forEach(e=>u.tickEvent("package.doubleload",{extension:e})),u.log("upgraded, downloading again"),u.debug(e),this.downloadAsync()):Promise.resolve())),u.appTarget.simulator&&u.appTarget.simulator.dynamicBoardDefinition&&(t=(t=0==this.level?t.then(()=>this.patchCorePackage()):t).then(()=>{var e,t;this.config.compileServiceVariant&&u.setAppTargetVariant(this.config.compileServiceVariant),this.config.files.indexOf("board.json")<0||((e=u.appTarget.simulator.boardDefinition=JSON.parse(this.readFile("board.json"))).id=this.config.name,u.appTarget.appTheme.boardName=e.boardName||lf("board"),u.appTarget.appTheme.driveDisplayName=e.driveDisplayName||lf("DRIVE"),e=e=>{var t,n=/^pkg:\/\/(.*)/.exec(e);return n?(n=n[1],t=this.readFile(n),u.U.toDataUri(t,u.U.getMime(n))):e},"object"==typeof(t=u.appTarget.simulator.boardDefinition).visual&&((t=t.visual).image=e(t.image),t.outlineImage=e(t.outlineImage)))})),(e,t)=>{if(u.debug(`version spec mismatch: ${e._verspec} != `+t),/^github:/.test(e._verspec)&&/^github:/.test(t)){var n=u.github.parseRepoId(e._verspec),i=u.github.parseRepoId(t);if(null!=n&&n.slug&&(null==n?void 0:n.slug)===(null==i?void 0:i.slug)){n=(null==n?void 0:n.tag)||(null==(n=e.config)?void 0:n.version),i=u.semver.strcmp(n,i.tag);if(0==i)return void u.debug("resolved version are "+n);if(i<0)return void u.debug(`auto-upgraded ${t} to `+n)}}/^file:/.test(e._verspec)||/^file:/.test(t)?u.debug("ignore file: mismatch issues"):e.configureAsInvalidPackage(lf("version mismatch"))}),r=async(e,t,n=!1)=>{e=e||t.dependencies(n),u.debug(`deps: ${t.id}->`+Object.keys(e).join(", ")),e=u.github.resolveMonoRepoVersions(e),u.debug(`deps: resolved ${t.id}->`+Object.keys(e).join(", "));for(var i of Object.keys(e)){var r=e[i]||"*",s=(u.debug(`dep: load ${t.id}.${i}${n?"++":""}: `+r),"hw"==i&&u.hwVariant&&(i="hw---"+u.hwVariant),t.resolveDep(i));s?(s.invalid()||s._verspec===r||o(s,r),!s.invalid()&&n||(s.level=Math.min(s.level,t.level+1),s.addedBy.push(t))):(s=new d(i,r,t.parent,t),n&&(s.cppOnly=!0),t.parent.deps[i]=s,await(t.parent.deps[i.replace(/---.*/,"")]=s).loadAsync(a))}};return t.then(()=>r(null,this)).then(()=>{if(this.config.palette&&u.appTarget.runtime&&(u.appTarget.runtime.palette=u.U.clone(this.config.palette),this.config.paletteNames)&&(u.appTarget.runtime.paletteNames=this.config.paletteNames),this.config.screenSize&&u.appTarget.runtime&&(u.appTarget.runtime.screenSize=u.U.clone(this.config.screenSize)),0!==this.level)return Promise.resolve(null);{var e=this.readFile(u.MAIN_TS);if(!e)return Promise.resolve(null);const i=this.getMissingPackages(this.config,e);let n=!1;return Object.keys(i).reduce((e,t)=>e.then(()=>this.findConflictsAsync(t,i[t])).then(e=>{if(e.length){const i=e.map(e=>e.pkg0.id).join(", "),n=e.map(e=>e.settingName).filter(e=>!!e).join(", ");return u.log(`skipping missing package ${t} because it conflicts with the following packages: ${i} (conflicting settings: ${n})`),Promise.resolve(null)}{u.log("adding missing package "+t),n=!0,this.config.dependencies[t]="*";const e={};return e[t]=i[t],r(e,this)}}),Promise.resolve(null)).then(()=>(n&&(this.saveConfig(),this.validateConfig()),Promise.resolve(null)))}}).then(()=>0!=this.level?Promise.resolve():Promise.all(u.U.values(this.parent.deps).map(e=>r(null,e,!0)))).then(()=>{u.debug("  installed "+this.id)})}getFiles(){let e;e=0!=this.level||this.ignoreTests?this.config.files.slice(0):this.config.files.concat(this.config.testFiles||[]);const t=this.config.fileDependencies;return e=this.config.fileDependencies?e.filter(n=>{const i=e=>{if("!"==(e=e.trim())[0])return!i(e.slice(1));if(/^[\w-]+$/.test(e)){const u=this.parent.resolveDep(e);return!(!u||u.cppOnly)}var t=/^target:(\w+)$/.exec(e);return t?t[1]==u.appTarget.id||t[1]==u.appTarget.platformid:(d.depWarnings[e]||(d.depWarnings[e]=!0,u.log(`invalid dependency expression: ${e} in ${this.id}/`+n)),!1)},e=u.U.lookup(t,n);return!e||!e.trim()||e.split("||").some(e=>e.split("&&").every(i))}):e}addSnapshot(e,n=[""]){for(let t of this.getFiles())n.some(e=>u.U.endsWith(t,e))&&(e[this.id+"/"+t]=this.readFile(t));e[this.id+"/"+u.CONFIG_NAME]=this.readFile(u.CONFIG_NAME)}packageLocalizationStringsAsync(n){const i=u.appTarget.id,e=[this.config.name+"-jsdoc",this.config.name],r={},s=u.appTarget.appTheme||{};return this.config.skipLocalization?Promise.resolve(r):u.Util.liveLocalizationEnabled()&&"this"!=this.id&&u.appTarget.bundledpkgs[this.id]?(u.debug("loading live translations for "+this.id),Promise.all(e.map(t=>u.Util.downloadLiveTranslationsAsync(n,i+`/${t}-strings.json`,s.crowdinBranch).then(e=>{e&&Object.keys(e).length?u.Util.jsonMergeFrom(r,e):(u.tickEvent("translations.livetranslationsfailed",{filename:t}),u.Util.jsonMergeFrom(r,this.bundledStringsForFile(n,t)))}).catch(e=>{u.tickEvent("translations.livetranslationsfailed",{filename:t}),u.log(`error while downloading ${i}/${t}-strings.json`),u.Util.jsonMergeFrom(r,this.bundledStringsForFile(n,t))}))).then(()=>r)):(e.map(e=>this.bundledStringsForFile(n,e)).filter(e=>!!e).forEach(e=>u.Util.jsonMergeFrom(r,e)),Promise.resolve(r))}bundledStringsForFile(e,t){let n={},[i,r,s]=u.Util.normalizeLanguageCode(e);var e=this.config.files,a=`_locales/${i}/${t}-strings.json`;return n=-1<e.indexOf(a)||s&&(-1<e.indexOf(a=`_locales/${s}/${t}-strings.json`)||r&&-1<e.indexOf(a=`_locales/${r}/${t}-strings.json`))?JSON.parse(this.readFile(a)):n}}function n(a,o={}){var l,c=a["*"]||{};for(l of Object.keys(a))if("*"!=l){let e=a[l],t=(e="string"==typeof e?{data:e}:e).namespace||c.namespace||"",n=(t&&(t+="."),e.id||t+l),i=e.icon,r=e.mimeType||c.mimeType,s=e.dataEncoding||c.dataEncoding||"base64";i||"base64"!=s||"image/png"!=r&&"image/jpeg"!=r||(i="data:"+r+";base64,"+e.data),o[n]={id:n,data:e.data,dataEncoding:s,icon:i,namespace:t,mimeType:r,tilemapTile:e.tilemapTile,displayName:e.displayName,tileset:e.tileset}}return o}d.depWarnings={},u.Package=d,u.MainPackage=class extends d{constructor(e){super("this","file:.",null,null),this._host=e,this.deps={},(this.parent=this).addedBy=[this],this.level=0,this.deps[this.id]=this}installAllAsync(e){return this.loadAsync(!0,e)}sortedDeps(n=!1){let i={},r=[];const s=e=>e.config?Object.keys(e.config.cppDependencies||{}).length:0,a=e=>{var t;e&&!u.U.lookup(i,e.id)&&(i[e.id]=!0,(t=Object.keys(e.dependencies(n)).map(e=>this.resolveDep(e))).sort((e,t)=>s(t)-s(e)||u.U.strcmp(e.id,t.id)),t.forEach(a),r.push(e.id))};return a(this),r.map(e=>this.resolveDep(e))}localizationStringsAsync(t){const n={};return Promise.all(u.Util.values(this.deps).map(e=>e.packageLocalizationStringsAsync(t).then(t=>{t&&Object.keys(t).forEach(e=>{n[e]||(n[e]=t[e])})}))).then(()=>{const t=u.U.getLocalizedStrings();return Object.keys(n).forEach(e=>{!u.U.startsWith(e,"{id:subcategory}")&&!u.U.startsWith(e,"{id:group}")||t[e]||(t[e]=n[e])}),u.U.setLocalizedStrings(t),Promise.resolve(n)})}getTargetOptions(){let t=u.U.clone(u.appTarget.compile);return u.U.assert(!!t),t.utf8||this.sortedDeps(!0).forEach(e=>{e.config&&e.config.utf8&&(u.debug("forcing utf8 mode: pkg="+e.id),t.utf8=!0)}),t}getJRes(){if(!this._jres){this._jres={};for(const u of this.sortedDeps())u.parseJRes(this._jres);var e=(u.appTarget.runtime&&u.appTarget.runtime.palette?u.appTarget.runtime.palette:["#000000","#ffffff"]).map(e=>("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)).join("");this._jres.__palette={id:"__palette",data:e,dataEncoding:"hex",mimeType:"application/x-palette"}}return this._jres}updateJRes(){this._jres&&this.parseJRes(this._jres)}resolveBannedCategories(){if(void 0===this._resolvedBannedCategories){let t=[];u.appTarget&&u.appTarget.runtime&&u.appTarget.runtime.bannedCategories&&u.appTarget.runtime.bannedCategories.length&&(t=u.appTarget.runtime.bannedCategories.slice(),Object.keys(this.deps).map(e=>this.deps[e]).filter(e=>!!e).map(e=>u.Util.jsonTryParse(e.readFile(u.CONFIG_NAME))).filter(e=>e&&e.requiredCategories).forEach(e=>e.requiredCategories.forEach(e=>{e=t.indexOf(e);-1<e&&t.splice(e,1)})),this._resolvedBannedCategories=t),this._resolvedBannedCategories=t,this._resolvedBannedCategories.length||(this._resolvedBannedCategories=null)}return this._resolvedBannedCategories}async getCompileOptionsAsync(s=this.getTargetOptions()){var e,t,n={sourceFiles:[],fileSystem:{},target:s,name:this.config?this.config.name:""};const a=(e,t)=>{this.config.files.indexOf(e)<0&&u.U.userError(lf("please add '{0}' to \"files\" in {1}",e,u.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",this.host().readFile(this,e,!0)!==t&&(u.debug(`updating ${e} (size=${t.length})...`),this.host().writeFile(this,e,t,!0))};let o=!1;const i=async e=>{var t={extinfo:null,target:null},n=u.appTargetVariant;e&&u.setAppTargetVariant(e,{temporary:!0});try{var i=u.cpp.getExtensionInfo(this),r=(o||!i.shimsDTS&&!i.enumsDTS||(o=!0,i.shimsDTS&&a("shims.d.ts",i.shimsDTS),i.enumsDTS&&a("enums.d.ts",i.enumsDTS)),s.isNative?await this.host().getHexInfoAsync(i):null),i=u.U.flatClone(i);s.keepCppFiles||(delete i.compileData,delete i.generatedFiles,delete i.extensionFiles),i.hexinfo=r,t.extinfo=i,t.target=u.appTarget.compile}finally{e&&u.setAppTargetVariant(n,{temporary:!0})}return t};await this.loadAsync(),n.bannedCategories=this.resolveBannedCategories(),n.target.preferredEditor=this.getPreferredEditor(),u.debug("building: "+this.sortedDeps().map(e=>e.config.name).join(", "));let r=null;for(t of e=u.appTarget.multiVariants?u.appTargetVariant?[u.appTargetVariant]:u.appTarget.alwaysMultiVariant||u.appTarget.compile.switches.multiVariant?u.appTarget.multiVariants:[u.appTarget.multiVariants[0]]:[null]){r&&u.debug("building for "+t);const a=await i(t),o=a.extinfo;o.appVariant=t,o.outputPrefix=1!=e.length&&t?t+"-":"",r?n.otherMultiVariants.push(a):(r=o,n.otherMultiVariants=[])}if(n.extinfo=r,!u.appTarget.compile.shortPointers&&"vm"!=u.appTarget.compile.nativeType&&!this.config.binaryonly&&n.target.isNative){const s=await this.filesToBePublishedAsync(!0),a=JSON.stringify({name:this.config.name,comment:this.config.description,status:"unpublished",scriptId:this.installedVersion,cloudId:u.CLOUD_ID+u.appTarget.id,editor:this.getPreferredEditor(),targetVersions:u.appTarget.versions}),o=JSON.stringify(s),i=await u.lzmaCompressAsync(a+o);i&&(n.embedMeta=JSON.stringify({compression:"LZMA",headerSize:a.length,textSize:o.length,name:this.config.name,eURL:u.appTarget.appTheme.embedUrl,eVER:u.appTarget.versions?u.appTarget.versions.target:"",pxtTarget:u.appTarget.id}),n.embedBlob=ts.pxtc.encodeBase64(u.U.uint8ArrayToString(i)))}for(const u of this.sortedDeps())for(const s of u.getFiles())if(/\.(ts|asm|py)$/.test(s)){let e=s;0<u.level&&(e="pxt_modules/"+u.id+"/"+s),n.sourceFiles.push(e),n.fileSystem[e]=u.readFile(s)}n.jres=this.getJRes();var l=u.appTarget.runtime&&u.appTarget.runtime.functionsOptions;return n.allowedArgumentTypes=l&&l.extraFunctionEditorTypes&&l.extraFunctionEditorTypes.map(e=>e.typeName).concat("number","boolean","string"),n}prepareConfigToBePublished(){const i=u.U.clone(this.config);return delete i.installedVersion,delete i.additionalFilePath,delete i.additionalFilePaths,i.targetVersions||(i.targetVersions=u.Util.clone(u.appTarget.versions)),u.U.iterMap(i.dependencies,(e,t)=>{if(!t||/^(file|workspace):/.test(t)){t="*";try{const i=this.resolveDep(e).readGitJson();var n;i&&i.repo&&((n=u.github.parseRepoId(i.repo)).tag=i.commit.tag||i.commit.sha,t=u.github.stringifyRepo(n))}catch(e){}i.dependencies[e]=t}}),i}filesToBePublishedAsync(i=!1){const r={};return this.loadAsync().then(()=>{i||this.config.public||u.U.userError('Only packages with "public":true can be published');var e,t,n=this.prepareConfigToBePublished();r[u.CONFIG_NAME]=u.Package.stringifyConfig(n);for(e of this.getFiles())e!=u.CONFIG_NAME&&(null==(t=this.readFile(e))&&u.U.userError("referenced file missing: "+e),r[e]=t);return u.U.sortObjectFields(r)})}saveToJsonAsync(){return this.filesToBePublishedAsync(!0).then(e=>({meta:{cloudId:u.CLOUD_ID+u.appTarget.id,targetVersions:u.appTarget.versions,editor:this.getPreferredEditor(),name:this.config.name},source:JSON.stringify(e,null,2)}))}compressToFileAsync(){return this.saveToJsonAsync().then(e=>u.lzmaCompressAsync(JSON.stringify(e,null,2)))}computePartDefinitions(i){if(!i||!i.length)return{};let r={};return this.sortedDeps().forEach(n=>{var t=n.readFile("pxtparts.json");if(t)try{let e=JSON.parse(t);Object.keys(e).forEach(t=>{if(0<=i.indexOf(t)){t=r[t]=e[t];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){let e=n.readFile(t.visual.image);e||u.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),/^data:image\/svg\+xml/.test(e)||(e="data:image/svg+xml,"+encodeURIComponent(e)),t.visual.image=e}}})}catch(e){u.reportError("parts","invalid pxtparts.json file")}}),r}},u.inflateJRes=n,u.allPkgFiles=function(e){return[u.CONFIG_NAME].concat(e.files||[]).concat(e.testFiles||[])},u.isPkgBeta=function(e){return e&&/\bbeta\b/.test(e.description)}}(pxt=pxt||{}),function(l){{var c=l.packetio||(l.packetio={});let i,n,r,s,a,o=()=>{};function u(){if(a)return a;let e=Promise.resolve();if(i){l.debug("packetio: disconnect");const t=i;e=e.then(()=>t.disconnectAsync()).then(()=>t.io.disposeAsync()).catch(e=>{l.reportException(e)}).finally(()=>{n=void 0,i=void 0,a=void 0}),o&&(e=e.then(()=>o())),a=e}return e}c.isActive=function(){return!!i},c.isConnected=function(){return!!i&&i.io.isConnected()},c.isConnecting=function(){return!!i&&i.io.isConnecting()},c.icon=function(){var e;return!!i&&(i.icon||(null==(e=l.appTarget.appTheme.downloadDialogTheme)?void 0:e.deviceIcon)||"usb")},c.unsupportedParts=function(){return null!=i&&i.unsupportedParts?i.unsupportedParts():[]},c.disconnectAsync=u,c.configureEvents=function(e,t,n){o=e,r=t,s=n,i&&(i.io.onConnectionChanged=o,i.onSerial=r,i.onCustomEvent=n)},c.sendCustomEventAsync=function(e,t){return i?i.sendCustomEventAsync(e,t):Promise.resolve()},c.initAsync=function(t=!1){if(l.debug("packetio: init "+(t?"(force)":"")),!n){let e=Promise.resolve();t&&(e=e.then(()=>u())),n=e.then(()=>i?Promise.resolve(i):c.mkPacketIOAsync?(l.debug("packetio: new wrapper"),c.mkPacketIOAsync().then(e=>(e.onConnectionChanged=o,i=c.mkPacketIOWrapper(e),r&&(i.onSerial=r),s&&(i.onCustomEvent=s),o&&o(),i))):(l.debug("packetio: not defined, skipping"),Promise.resolve(void 0))).finally(()=>{n=void 0})}return n}}}(pxt=pxt||{}),function(s){var e;(e=s.patching||(s.patching={})).computePatches=function(e,n){const i=s.appTarget.compile?s.appTarget.compile.patches:void 0;if(i){const r=s.semver.tryParse(e||"0.0.0")||s.semver.tryParse("0.0.0");let t=[];return Object.keys(i).filter(e=>s.semver.inRange(e,r)).forEach(e=>t=t.concat(i[e])),(t=n?t.filter(e=>e.type==n):t).length?t:void 0}},e.upgradePackageReference=function(e,t,n){if("*"!=n)return t;n=s.patching.computePatches(e,"package");let i=t;return n&&n.forEach(t=>{Object.keys(t.map).forEach(e=>{i==e&&(i=t.map[e])})}),i},e.patchJavaScript=function(e,t){e=s.patching.computePatches(e);let i=t;return e&&(e.filter(e=>"api"===e.type).forEach(n=>{Object.keys(n.map).forEach(e=>{var t=new RegExp(e,"g");i=i.replace(t,n.map[e])})}),e.filter(e=>"userenum"===e.type).forEach(n=>{Object.keys(n.map).forEach(e=>{var t=new RegExp("enum\\s+"+e+"\\s*{","gm"),t=(i=i.replace(t,`enum ${n.map[e]} {`),new RegExp(`(^|[^_a-zA-Z0-9])${e}(\\s*\\.)`,"g"));i=i.replace(t,`$1${n.map[e]}$2`)})})),i}}(pxt=pxt||{}),function(e){e.react||(e.react={})}(pxt=pxt||{}),function(a){function s(n,i){if(n){if(i){let t=n.major-i.major||n.minor-i.minor||n.patch-i.patch;if(t)return t;if(0==n.pre.length&&0<i.pre.length)return 1;if(0<n.pre.length&&0==i.pre.length)return-1;for(let e=0;e<n.pre.length+1;++e){var r=n.pre[e],s=i.pre[e];if(!r)return s?-1:0;if(!s)return 1;if(/^\d+$/.test(r)){if(!/^\d+$/.test(s))return-1;if(t=parseInt(r)-parseInt(s))return t}else{if(/^\d+$/.test(s))return 1;if(t=a.U.strcmp(r,s))return t}}return 0}return-1}return i?1:0}function o(e,t){t=l(e)||l(t);return t||a.U.userError(a.U.lf("'{0}' doesn't look like a semantic version number",e)),t}function l(e){if(!e)return null;if("*"===e)return{major:Number.MAX_SAFE_INTEGER,minor:Number.MAX_SAFE_INTEGER,patch:Number.MAX_SAFE_INTEGER,pre:[],build:[]};/^v\d/i.test(e)&&(e=e.slice(1));e=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return e?{major:parseInt(e[1]),minor:parseInt(e[2]),patch:parseInt(e[3]),pre:e[5]?e[5].split("."):[],build:e[7]?e[7].split("."):[]}:null}function c(e){let t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function t(e,t){var n=l(e),i=l(t);return n||i?s(n,i):a.U.strcmp(e,t)}function u(e,t){var n,e=e.split(" - ");return 2==e.length&&(n=l(e[0]),e=l(e[1]),!(!n||!e))&&(!t||(n=s(n,t),t=s(t,e),n<=0&&t<0))}var n;(n=a.semver||(a.semver={})).cmp=s,n.parse=o,n.tryParse=l,n.normalize=function(e){return c(o(e))},n.stringify=c,n.majorCmp=function(e,t){e=l(e),t=l(t);return e.major-t.major},n.strcmp=t,n.inRange=u,n.sortLatestTags=function(e){e=e.filter(e=>!!n.tryParse(e));return e.sort(t),e.reverse(),e},n.test=function(){console.log("Test semver");var n=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"];for(let t=0;t<n.length;++t){var i=o(n[t]);console.log(n[t],i),a.U.assert(c(i)==n[t]);for(let e=0;e<n.length;++e){var r=s(i,o(n[e]));console.log(n[t],n[e],r),t<e?a.U.assert(r<0):t>e?a.U.assert(0<r):a.U.assert(0==r)}}var e=l("1.2.3");a.U.assert(u("0.1.2 - 2.2.3",e)),a.U.assert(u("1.2.3 - 2.2.3",e)),a.U.assert(!u("0.0.0 - 1.2.3",e)),a.U.assert(!u("1.2.4 - 4.2.3",e)),a.U.assert(!u("0.0.0 - 0.0.1",e))}}(pxt=pxt||{}),function(e){{var v=e.pxtc||(e.pxtc={}),u;function t(e){return v.Util.values(e.byQName).filter(e=>e.attributes.block&&/^{[^:]+:[^}]+}/.test(e.attributes.block)).forEach(e=>{e.attributes.block=e.attributes.block.replace(/^{[^:]+:[^}]+}/,"")}),e}v.assert=v.Util.assert,v.oops=v.Util.oops,v.U=v.Util,v.ON_START_TYPE="pxt-on-start",v.ON_START_COMMENT="on start",v.HANDLER_COMMENT="code goes here",v.TS_STATEMENT_TYPE="typescript_statement",v.TS_DEBUGGER_TYPE="debugger_keyword",v.TS_BREAK_TYPE="break_keyword",v.TS_CONTINUE_TYPE="continue_keyword",v.TS_OUTPUT_TYPE="typescript_expression",v.TS_RETURN_STATEMENT_TYPE="function_return",v.PAUSE_UNTIL_TYPE="pxt_pause_until",v.COLLAPSED_BLOCK="pxt_collapsed_block",v.FUNCTION_DEFINITION_TYPE="function_definition",v.BINARY_JS="binary.js",v.BINARY_ASM="binary.asm",v.BINARY_HEX="binary.hex",v.BINARY_UF2="binary.uf2",v.BINARY_ELF="binary.elf",v.BINARY_PXT64="binary.pxt64",v.BINARY_ESP="binary.bin",v.NATIVE_TYPE_THUMB="thumb",v.NATIVE_TYPE_VM="vm",v.BuildSourceMapHelpers=function(r,t,n){const e=e=>{const t=e.split("\n").map(e=>e.length),n=t.reduce(({lens:e,sum:t},n)=>({lens:[...e,t+n+1],sum:t+n+1}),{lens:[],sum:0}).lens;return{posToLineCol:i=>{var e=n.reduce((e,t,n)=>i<t?e:n+1,0);return[e,t[e]-(n[e]-i)+1]},lineColToPos:(e,t)=>(n[e-1]||0)+t}},s={ts:e(t),py:e(n)},a=e=>e.endPos-e.startPos,i=(e,t)=>{const{startPos:n,endPos:i}=e;return r.filter(e=>e[t].startPos<=n&&i<=e[t].endPos)},o=(e,n)=>{e=i(e,n);return e.reduce((e,t)=>a(t[n])<a(e[n])?t:e,e[0])},l={allOverlaps:e=>i(e,"ts"),smallestOverlap:e=>o(e,"ts")},c={allOverlaps:e=>i(e,"py"),smallestOverlap:e=>o(e,"py")},u=(i,r)=>e=>{e=e;var t,[e,n]=[s[i].lineColToPos(e.line,e.column),e.length],e=o({startPos:e,endPos:e+n},i);if(e)return[n,t]=s[r].posToLineCol(e[r].startPos),{fileName:"main."+r,start:e[r].startPos,length:a(e[r]),line:n,column:t}},d=u("ts","py"),h=u("py","ts");return{ts:Object.assign(Object.assign(Object.assign({},s.ts),l),{locToLoc:d,getText:e=>t.substring(e.startPos,e.endPos)}),py:Object.assign(Object.assign(Object.assign({},s.py),c),{locToLoc:h,getText:e=>n.substring(e.startPos,e.endPos)})}},v.computeUsedParts=function(t,e){if(!t.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];let n=[];if(Object.keys(t.usedSymbols).forEach(e=>{var e=t.usedSymbols[e];e&&e.attributes.parts&&(e=e.attributes.parts)&&e.split(/[ ,]+/).forEach(e=>{0<e.length&&n.indexOf(e)<0&&n.push(e)})}),e){const t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&("ignorebuiltin"===e?n=n.filter(e=>-1===t.indexOf(e)):"onlybuiltin"===e&&(n=n.filter(e=>0<=t.indexOf(e))))}return n.sort(),n=n.reverse()},v.buildSimJsInfo=function(e){return{js:e.outfiles[v.BINARY_JS],targetVersion:pxt.appTarget.versions.target,fnArgs:e.usedArguments,parts:v.computeUsedParts(e,"ignorebuiltin"),usedBuiltinParts:v.computeUsedParts(e,"onlybuiltin")}},v.blocksCategory=function(e){e=e?e.attributes.blockNamespace||e.namespace:void 0;return e?v.Util.capitalize(e.split(".")[0]):void 0},v.getBlocksInfo=function(t,e){var n,i,r,s;let h=[];const p={},f={},m={},a={},o={};function l(n,i){const r="get"==n,s="set"==n,a="number"==i.retType,o=r?f:s?p:m,l=i.namespace+"."+i.retType;let c=v.U.lookup(o,l);if(!c){const p=`@${n}@`;let e,t;if(i.attributes.blockCombineShadow){const n=i.attributes.blockCombineShadow,r=n.match(/^([^,.]*),?([^,.]*)$/);r&&3==r.length&&(e=r[1].trim(),0!=(t=r[2].trim()).length||v.Util.endsWith(n,",")||(t=e,e=""))}var u=`${i.attributes.blockSetVariable||i.namespace.toLocaleLowerCase()}=`+(e||""),d="value="+(t||"");(c=o[l]={attributes:{blockId:`${a?i.namespace:l}_blockCombine_`+n,callingConvention:0,group:i.attributes.group,paramDefl:{},jsDoc:r?v.U.lf("Read value of a property on an object"):v.U.lf("Update value of property on an object")},name:p,namespace:i.namespace,fileName:i.fileName,qName:l+"."+p,pkg:i.pkg,kind:2,parameters:[{name:"property",description:r?v.U.lf("the name of the property to read"):v.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:s?v.U.lf("the new value of the property"):v.U.lf("the amount by which to change the property"),type:i.retType}].slice(0,r?1:2),retType:r?i.retType:"void",combinedProperties:[]}).attributes.block=r?v.U.lf("%{0} %property",u):s?v.U.lf("set %{0} %property to %{1}",u,d):v.U.lf("change %{0} %property by %{1}",u,d),w(c.attributes),pxt.Util.isTranslationMode()&&(c.attributes.translationId=c.attributes.block,c.attributes.block=r?`%${u} %property`:s?`set %${u} %property to %`+d:`change %${u} %property by %`+d,w(c.attributes),pxt.crowdin.inContextLoadAsync(c.attributes.translationId).then(e=>{c.attributes.block=e,w(c.attributes)})),h.push(c)}c.combinedProperties.push(i.qName)}for(i of v.Util.values(t.byQName)){if("ENUM_GET"===i.attributes.shim&&i.attributes.enumName&&i.attributes.blockId){let e=!1;if(a[i.attributes.enumName]&&(console.warn(`Enum block ${i.attributes.blockId} trying to overwrite enum `+i.attributes.enumName),e=!0),i.attributes.enumMemberName||(console.warn(`Enum block ${i.attributes.blockId} should specify enumMemberName`),e=!0),i.attributes.enumPromptHint||(console.warn(`Enum block ${i.attributes.blockId} should specify enumPromptHint`),e=!0),i.attributes.enumInitialMembers&&i.attributes.enumInitialMembers.length||(console.warn(`Enum block ${i.attributes.blockId} should specify enumInitialMembers`),e=!0),e)continue;const t=parseInt(i.attributes.enumStartValue);a[i.attributes.enumName]={blockId:i.attributes.blockId,name:i.attributes.enumName,memberName:i.attributes.enumMemberName,firstValue:isNaN(t)?void 0:t,isBitMask:i.attributes.enumIsBitMask,isHash:i.attributes.enumIsHash,initialMembers:i.attributes.enumInitialMembers,promptHint:i.attributes.enumPromptHint}}if("KIND_GET"===i.attributes.shim&&i.attributes.blockId){const n=i.attributes.kindNamespace||i.attributes.blockNamespace||i.namespace;if(o[n]){console.warn("More than one block defined for kind "+n);continue}const y=[];if(t.byQName[n])for(const e of v.Util.values(t.byQName))e.namespace===n&&e.attributes.isKind&&y.push(e.name);o[n]={blockId:i.attributes.blockId,name:n,memberName:i.attributes.kindMemberName||n,initialMembers:y,promptHint:i.attributes.enumPromptHint||v.Util.lf("Create a new kind..."),createFunctionName:i.attributes.kindCreateFunction||"create"}}if(i.attributes.blockCombine)/@set/.test(i.name)||l("get",i),i.isReadOnly||("number"==i.retType&&l("change",i),l("set",i));else if(i.attributes.block&&!i.attributes.fixedInstance&&7!=i.kind&&5!=i.kind&&9!=i.kind&&8!=i.kind){if(i.attributes.blockId||(i.attributes.blockId=i.qName.replace(/\./g,"_")),"true"==i.attributes.block){let e=v.U.uncapitalize(i.name);1!=i.kind&&2!=i.kind||(e+=" %"+i.namespace.toLowerCase());const h=null!=(n=null==(n=i.parameters)?void 0:n.filter(e=>!y(e)))?n:[];for(var c of h)e+=" %"+c.name;i.attributes.block=e,w(i.attributes)}h.push(i)}}for(r of h){var u=v.U.lookup(t.byQName,r.namespace);if(u){var d,g=u.attributes,b=r.attributes;for(d of["blockNamespace","color","blockGap"])void 0===b[d]&&g[d]&&(b[d]=g[d])}}return{apis:t,blocks:h=e&&(s=e).length?h.filter(e=>{e=(e.attributes.blockNamespace||e.namespace).split(".")[0];return-1===s.indexOf(e)}):h,blocksById:pxt.Util.toDictionary(h,e=>e.attributes.blockId),enumsByName:a,kindsByName:o}},v.tsSnippetToPySnippet=function(e,t){const n={true:"True",false:"False",null:"None"}[e];if(n)return n;if(t&&6==t.kind||!t&&e.includes(".")){const t=e.lastIndexOf("."),n=e.substr(0,t);var i=e.substr(t+1);return n+"."+v.U.snakify(i).toUpperCase()}return e},v.apiLocalizationStrings={},v.localizeApisAsync=async function(l,e){const c=v.Util.userLanguage();if("en"==c)return Promise.resolve(t(l));const u=c.toLowerCase(),d=u+"|jsdoc",h=u+"|block",p=await e.localizationStringsAsync(c);v.apiLocalizationStrings&&v.Util.jsonMergeFrom(p,v.apiLocalizationStrings);e=v.Util.values(l.byQName).filter(e=>e.attributes._translatedLanguageCode!==c);return await v.Util.promiseMapAll(e,async i=>{var e;const t=i.attributes.useLoc||i.attributes.blockAliasFor,r=t&&l.byQName[t],n=(i.attributes._untranslatedJsDoc&&(i.attributes.jsDoc=i.attributes._untranslatedJsDoc),i.attributes._untranslatedBlock&&(i.attributes.jsDoc=i.attributes._untranslatedBlock),(e,t)=>{var n;return p[i.qName+e]||(null==(n=i.attributes.locs)?void 0:n[t])||r&&(p[r.qName+e]||(null==(n=r.attributes.locs)?void 0:n[t]))}),s=n("",d);s&&(i.attributes._untranslatedJsDoc||(i.attributes._untranslatedJsDoc=i.attributes.jsDoc),i.attributes.jsDoc=s),null!=(a=i.parameters)&&a.forEach(e=>{var t="|param|"+e.name,t=n(t,u+t);t&&(e.description=t)});var a=p["{id:category}"+v.Util.capitalize(i.qName)];let o=p[i.qName+"|block"]||(null==(e=i.attributes.locs)?void 0:e[h]);if(!o&&r){const v=p[r.qName+"|block"]||(null==(e=r.attributes.locs)?void 0:e[h]);i.attributes.block===(r.attributes._untranslatedBlock||r.attributes.block)&&v&&(o=v)}if(o&&pxt.Util.isTranslationMode()&&(i.attributes.translationId=o,o=await pxt.crowdin.inContextLoadAsync(o)),a)i.attributes.block?i.attributes.block=o||i.attributes.block:i.attributes.block=a,w(i.attributes);else if(i.attributes.block&&o){const v=pxt.blocks.compileInfo(i),l=i.attributes.block;i.attributes.block=pxt.blocks.normalizeBlock(o,e=>{pxt.tickEvent("loc.normalized",{block:i.attributes.block,lang:c,error:e})}),i.attributes._untranslatedBlock||(i.attributes._untranslatedBlock=l),l!=i.attributes.block&&(w(i.attributes),function(e,t){if(e.parameters.length!=t.parameters.length)return pxt.debug("Localized block has extra or missing parameters"),0;for(const n of e.parameters){const e=t.actualNameToParam[n.actualName];if(!e||n.type!=e.type||n.shadowBlockId!=e.shadowBlockId)return pxt.debug(`Parameter ${n.actualName} type or shadow block does not match after localization`),0}return 1}(v,pxt.blocks.compileInfo(i))||(pxt.log(`block has non matching arguments: ${l} vs `+i.attributes.block),pxt.reportError("loc.errors","invalid translations",{block:i.attributes.blockId,lang:c}),i.attributes.block=l,w(i.attributes)))}else w(i.attributes);i.attributes._translatedLanguageCode=c}),t(l)},v.emptyExtInfo=function(){let e=pxt.appTarget.compileService;var t=!!(e=e||{}).platformioIni,n="dockermake"==e.buildEngine||"dockercross"==e.buildEngine||"dockerespidf"==e.buildEngine,i={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?i.platformio={dependencies:{}}:n?i.npmDependencies={}:i.yotta={config:{},dependencies:{}},i};const o=["weight","imageLiteral","topblockWeight"],f=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","enumIsBitMask","enumIsHash","decompileIndirectFixedInstances","topblock","callInDebugger","duplicateShadowOnDrag","argsNullable"];function y(e){return"Action"===e.type||/^\([^\)]*\)\s*=>/.test(e.type)}function w(n){var e;function t(e){return n._shadowOverrides&&e.parameters.forEach(e=>{var t=n._shadowOverrides[e.name];"unset"===t?delete e.shadowBlockId:null!=t&&(e.shadowBlockId=t)}),e}n.block&&(e=n.block.split("||"),n._def=t(i(e[0])),n._def||pxt.debug("Unable to parse block def for id: "+n.blockId),e[1]&&(n._expandedDef=t(i(e[1]))),e[1])&&!n._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+n.blockId)}function i(i){const n=[];let r,s=0;for(;s<i.length;s++){const a=i[s],o=s;let t;switch(a){case"*":case"_":const n=h(e=>e==a),r="_"===a?2:0;1===n.length?t={kind:1<<r,content:n}:2===n.length?t={kind:2<<r,content:n}:3===n.length?t={kind:3<<r,content:n}:s=o;break;case"`":const e=p("`");void 0===e?s=o:t={kind:256,content:e};break;case"|":t={kind:32};break;case"\\":s<i.length-1&&(t={kind:16,content:i[1+s++]});break;case"[":const c=p("]");if(void 0!==c&&"("===i[1+s++]){const i=p(")");if(void 0!==i){t={kind:512,content:c,type:i};break}}s=o;break;case"$":case"%":const u=h(e=>/[a-zA-Z0-9_=]/.test(e),!0).split("=");if(2<u.length)s=o;else{let e;if("("===i[s+1]){const i=s;++s,(e=p(")"))||(s=i)}t={kind:"$"===a?1024:64,content:u[0],type:u[1],name:e}}}t?(r&&n.push({kind:128,content:r}),r=void 0,n.push(t)):r?r+=a:r=a}r&&n.push({kind:128,content:r});const a=[],o=[];let l=[],c=0,u="",d=[];for(let e=0;e<n.length;e++){const r=n[e].kind,s=l[l.length-1];if(15&r)if(m(n[e].content),r&c)if(s&r){l.pop();const i=s&(c^=r)|r&c;i&&l.push(i)}else f();else c|=r,l.push(r);else 144&r?u+=n[e].content:1120&r&&t();if(64==r){const r={kind:"param",name:n[e].content,shadowBlockId:n[e].type,ref:!1};n[e].name&&(r.varName=n[e].name),a.push(r),o.push(r)}else if(1024==r){const r={kind:"param",name:n[e].content,shadowBlockId:n[e].type,ref:!0};n[e].name&&(r.varName=n[e].name),a.push(r),o.push(r)}else 256==r?(m(),d.push({kind:"image",uri:n[e].content})):512==r?(m(),d.push({kind:"label",text:n[e].content,cssClass:n[e].type})):32==r&&a.push({kind:"break"})}return t(),{parts:a,parameters:o};function h(e,t=!1){let n="";for(t&&s++;s<i.length&&e(i[s]);)n+=i[s],++s;return n&&s--,n}function p(t){var e=h(e=>e!==t,!0);if(i[s+1]===t)return++s,e}function f(){let e="",t=[];for(const n of d)n.kind?(t.push({content:e,styles:0}),t.push(n),e=""):(e+=n.content,n.endingToken&&(e+=n.endingToken));d=t,e&&d.push({content:e,styles:0}),l=[],c=0}function t(){for(m(),c&&f();d.length;){var e,t=d.shift();t.kind?a.push(t):t.content&&(e=[],10&t.styles&&e.push("bold"),5&t.styles&&e.push("italics"),a.push({kind:"label",text:t.content,style:e}))}}function m(e){d.push({content:u,styles:c,endingToken:e}),u=""}}function p(n){var i=e=>n[e]+(n[e+1]<<8)+(n[e+2]<<16)+(n[e+3]<<24)>>>0;if(!n||512!=n.length||i(0)!=u.UF2_MAGIC_START0||i(4)!=u.UF2_MAGIC_START1||i(n.length-4)!=u.UF2_MAGIC_END)return null;let e=i(8),r=i(16),s=(476<r&&(r=256),null),t=0,a=0;if(e&u.UF2_FLAG_FILE){let e=n.slice(32+r),t=e.indexOf(0);0<=t&&(e=e.slice(0,t)),s=v.U.fromUTF8Array(e),a=i(28)}return e&u.UF2_FLAG_FAMILY_ID_PRESENT&&(t=i(28)),{flags:e,targetAddr:i(12),payloadSize:r,blockNo:i(20),numBlocks:i(24),fileSize:a,familyId:t,data:n.slice(32,32+r),filename:s}}function a(e,t){return!!e&&e.targetAddr<=t&&t<e.targetAddr+e.payloadSize}function d(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function r(e){return{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0,familyId:(e="string"==typeof e?parseInt(e):e)||0}}function s(t){for(let e=0;e<t.blocks.length;++e)d(t.blocks[e],20,e),d(t.blocks[e],24,t.blocks.length),t.filename&&d(t.blocks[e],28,t.filesize)}function h(t,e,n,i=0){let r=t.currBlock,s=e>>8,a=256-(255&e);if(n.length>a){var o=new Uint8Array(n);for(h(t,e,o.slice(0,a));a<n.length;){var l=Math.min(a+256,n.length);h(t,e+a,o.slice(a,l)),a=l}}else{if(s!=t.currPtr){r=null;for(let e=0;e<t.ptrs.length;++e)if(t.ptrs[e]==s){r=t.blocks[e];break}if(!r){r=new Uint8Array(512),t.filename?i|=u.UF2_FLAG_FILE:t.familyId&&(i|=u.UF2_FLAG_FAMILY_ID_PRESENT),d(r,0,u.UF2_MAGIC_START0),d(r,4,u.UF2_MAGIC_START1),d(r,8,i),d(r,12,s<<8),d(r,16,256),d(r,20,t.blocks.length),d(r,28,t.familyId),d(r,508,u.UF2_MAGIC_END);for(let e=32;e<288;++e)r[e]=255;t.filename&&v.U.memcpy(r,288,v.U.toUTF8Array(t.filename)),t.blocks.push(r),t.ptrs.push(s)}t.currPtr=s,t.currBlock=r}var c=32+(255&e);for(let e=0;e<n.length;++e)r[c+e]=n[e];t.filesize=Math.max(t.filesize,n.length+e)}}v.parseCommentString=function(e){let l={paramDefl:{},callingConvention:0,_source:e},c=!0;for(;c;)c=!1,e=e.replace(/\/\/%[ \t]*([\w\.-]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,(e,t,n,i,r,s,a)=>{let o=r?JSON.parse(r):n?r||s||a:"true";if(o=o||"",v.U.startsWith(t,"block.loc."))l.locs||(l.locs={}),l.locs[t.slice("block.loc.".length).toLowerCase()+"|block"]=o;else if(v.U.startsWith(t,"jsdoc.loc."))l.locs||(l.locs={}),l.locs[t.slice("jsdoc.loc.".length).toLowerCase()+"|jsdoc"]=o;else if(v.U.contains(t,".loc.")){l.locs||(l.locs={});const v=t.slice(0,t.indexOf(".loc.")),e=t.slice(t.indexOf(".loc.")+".loc.".length);l.locs[e+"|param|"+v]=o}else if(v.U.endsWith(t,".defl"))-1<o.indexOf(" ")?l.paramDefl[t.slice(0,t.length-5)]=`"${o}"`:l.paramDefl[t.slice(0,t.length-5)]=o,l.explicitDefaults||(l.explicitDefaults=[]),l.explicitDefaults.push(t.slice(0,t.length-5));else if(v.U.endsWith(t,".shadow"))l._shadowOverrides||(l._shadowOverrides={}),l._shadowOverrides[t.slice(0,t.length-7)]=o;else if(v.U.endsWith(t,".fieldEditor"))l.paramFieldEditor||(l.paramFieldEditor={}),l.paramFieldEditor[t.slice(0,t.length-12)]=o;else if(v.U.contains(t,".fieldOptions.")){l.paramFieldEditorOptions||(l.paramFieldEditorOptions={});const v=t.slice(0,t.indexOf(".fieldOptions.")),e=t.slice(t.indexOf(".fieldOptions.")+14,t.length);l.paramFieldEditorOptions[v]||(l.paramFieldEditorOptions[v]={}),l.paramFieldEditorOptions[v][e]=o}else if(v.U.contains(t,".shadowOptions.")){l.paramShadowOptions||(l.paramShadowOptions={});const v=t.slice(0,t.indexOf(".shadowOptions.")),e=t.slice(t.indexOf(".shadowOptions.")+15,t.length);l.paramShadowOptions[v]||(l.paramShadowOptions[v]={}),l.paramShadowOptions[v][e]=o}else v.U.endsWith(t,".min")?(l.paramMin||(l.paramMin={}),l.paramMin[t.slice(0,t.length-4)]=o):v.U.endsWith(t,".max")?(l.paramMax||(l.paramMax={}),l.paramMax[t.slice(0,t.length-4)]=o):l[t]=o;return c=!0,"//% "});for(var t of o)"string"==typeof l[t]&&(l[t]=parseInt(l[t]));for(var n of f)"string"==typeof l[n]&&(l[n]="true"==l[n]||"1"==l[n]);if(l.trackArgs&&(l.trackArgs=l.trackArgs.split(/[ ,]+/).map(e=>parseInt(e)||0)),l.enumInitialMembers&&(l.enumInitialMembers=l.enumInitialMembers.split(/[ ,]+/)),l.blockExternalInputs&&!l.inlineInputMode&&(l.inlineInputMode="external"),l.paramHelp={},l.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,(e,t)=>(t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,(e,t,n)=>{if(l.paramHelp[t]=n,!l.paramDefl[t]){n=/\beg\.?:\s*(.+)/.exec(n);if(n&&n[1]){n=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(n[1]);if(n){let e=n[1]||n[2]||n[3];-1<(e=e||"").indexOf(" ")?l.paramDefl[t]=`"${e}"`:l.paramDefl[t]=e}}}return""}),l.jsDoc+=t,"")),l.jsDoc=l.jsDoc.trim(),l.async&&(l.callingConvention=1),l.promise&&(l.callingConvention=2),l.jres&&(l.whenUsed=!0),l.subcategories)try{l.subcategories=JSON.parse(l.subcategories)}catch(e){l.subcategories=void 0}if(l.groups)try{l.groups=JSON.parse(l.groups)}catch(e){l.groups=void 0}if(l.groupIcons)try{l.groupIcons=JSON.parse(l.groupIcons)}catch(e){l.groupIcons=void 0}if(l.groupHelp)try{l.groupHelp=JSON.parse(l.groupHelp)}catch(e){l.groupHelp=void 0}return w(l),l},v.parameterTypeIsArrowFunction=y,v.updateBlockDef=w,v.parseBlockDefinition=i,v.parseChecksumBlock=function(t,n=0){var e=pxt.HF2.read32(t,n);if(133083260!=(2147483647&e))return pxt.log("no checksum block magic"),null;var i=pxt.HF2.read32(t,n+4),r=pxt.HF2.read32(t,n+8);if(3&i)return pxt.log("invalid end marker position"),null;var s=1<<(255&r);if(s!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+s),null;var a={magic:e,endMarkerPos:i,endMarker:r,regions:[]};for(let e=n+12;e<t.length-7;e+=8){var o={start:s*pxt.HF2.read16(t,e),length:s*pxt.HF2.read16(t,e+2),checksum:pxt.HF2.read32(t,e+4)};if(!o.length||!o.checksum)break;a.regions.push(o)}return a},(u=v.UF2||(v.UF2={})).UF2_MAGIC_START0=171066965,u.UF2_MAGIC_START1=2656915799,u.UF2_MAGIC_END=179400496,u.UF2_FLAG_NONE=0,u.UF2_FLAG_NOFLASH=1,u.UF2_FLAG_FILE=4096,u.UF2_FLAG_FAMILY_ID_PRESENT=8192,u.parseBlock=p,u.parseFile=function(t){var n=[];for(let e=0;e<t.length;e+=512){var i=p(t.slice(e,e+512));i&&n.push(i)}return n},u.toBin=function(t,n){if(t.length<512)return null;let i=-1,r=-1,s=[];for(let e=0;e<t.length;++e){var a=512*e,o=p(t.slice(a,512+a));if(o){if(n&&o.targetAddr+256>n)break;-1==i&&(i=o.targetAddr,r=i);var l=o.targetAddr-i;l<0||l%4||1048576<l||(0<l&&s.push(new Uint8Array(l)),s.push(t.slice(32+a,32+a+o.payloadSize)),i=o.targetAddr+o.payloadSize)}}let e=0;for(var c of s)e+=c.length;if(0==e)return null;let u=new Uint8Array(e),d=0;for(var h of s)for(let e=0;e<h.length;++e)u[d++]=h[e];return{buf:u,start:r}},u.readBytes=function(t,n,i){let r,s=new Uint8Array(i);for(let e=0;e<i;++e,++n)(r=a(r,n)?r:t.filter(e=>a(e,n))[0])&&(s[e]=r.data[n-r.targetAddr]);return s},u.newBlockFile=r,u.finalizeFile=s,u.concatFiles=function(e){for(var t of e)s(t),t.filename=null;var n,i=r();i.blocks=v.U.concat(e.map(e=>e.blocks));for(n of e)n.blocks=[];return i},u.serializeFile=function(e){s(e);let t="";for(var n of e.blocks)t+=v.Util.uint8ArrayToString(n);return t},u.readBytesFromFile=function e(t,n,i){let r,s=n>>8;if(s==t.currPtr)r=t.currBlock;else{for(let e=0;e<t.ptrs.length;++e)if(t.ptrs[e]==s){r=t.blocks[e];break}r&&(t.currPtr=s,t.currBlock=r)}var a,o;return r?(a=new Uint8Array(i),o=Math.min(i,256-(255&n)),v.U.memcpy(a,0,r,32+(255&n),o),0<(i=i-o)&&(n=e(t,n+o,i),v.U.memcpy(a,o,n)),a):null},u.writeBytes=h,u.writeHex=function(t,n){let i="0000";for(let e=0;e<n.length;++e){var r=/:02000004(....)/.exec(n[e]);if(r&&(i=r[1]),r=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(n[e])){var s=parseInt(i+r[1],16),a=r[2],o=[];for(let e=0;e<a.length;e+=2)o.push(parseInt(a[e]+a[e+1],16));h(t,s,o)}}}}}(ts=ts||{}),function(c){{var e=c.shell||(c.shell={}),t;let s,a,o=((t=s=e.EditorLayoutType||(e.EditorLayoutType={}))[t.IDE=0]="IDE",t[t.Sandbox=1]="Sandbox",t[t.Widget=2]="Widget",!(t[t.Controller=3]="Controller")),l=!1;function n(){if(void 0===a){if(c.BrowserUtils.hasWindow()){const e=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||c.BrowserUtils.isIFrame(),t=/nosandbox=1/i.test(window.location.href),n=/controller=1/i.test(window.location.href)&&c.BrowserUtils.isIFrame(),u=/readonly=1/i.test(window.location.href),i=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href),r=/noproject=1/i.test(window.location.href);if(a=s.IDE,t?a=s.Widget:n?a=s.Controller:e&&(a=s.Sandbox),n&&u&&(o=!0),n&&r&&(l=!0),i)switch(i[1].toLowerCase()){case"widget":a=s.Widget;break;case"sandbox":a=s.Sandbox;break;case"ide":a=s.IDE}}else a=s.Sandbox;c.debug(`shell: layout type ${s[a]}, readonly `+u())}}function i(){return n(),a==s.Sandbox}function u(){return!c.BrowserUtils.hasWindow()||i()&&!/[?&]edit=1/i.test(window.location.href)||r()&&o}function r(){return n(),a==s.Controller}e.layoutTypeClass=function(){return n(),c.shell.EditorLayoutType[a].toLowerCase()},e.isSandboxMode=i,e.isReadOnly=u,e.isNoProject=function(){return l},e.isControllerMode=r,e.isPyLangPref=function(){return"py"==c.storage.getLocal("editorlangpref")},e.getEditorLanguagePref=function(){return c.storage.getLocal("editorlangpref")},e.setEditorLanguagePref=function(e){e.match(/prj$/)&&(e=e.replace(/prj$/,"")),c.storage.setLocal("editorlangpref",e)},e.getToolboxAnimation=function(){return c.storage.getLocal("toolboxanimation")},e.setToolboxAnimation=function(){c.storage.setLocal("toolboxanimation","1")}}}(pxt=pxt||{}),function(e){{var t=e.skillmap||(e.skillmap={});t.USER_VERSION="0.0.1";class n{constructor(){this.db=new e.BrowserUtils.IDBWrapper(n.databaseName,n.version,(e,t)=>{t=t.result;e.oldVersion<1&&(t.createObjectStore(n.projectTable,{keyPath:n.projectKey}),t.createObjectStore(n.userTable,{keyPath:n.userKey}))})}initAsync(){return this.db.openAsync()}getAllProjectsAsync(){return this.db.getAllAsync(n.projectTable).then(e=>e.map(e=>e.project).filter(e=>!e.deleted))}deleteProjectAsync(e){return this.getProjectAsync(e).then(e=>{e.deleted=!0,this.saveProjectAsync(e)})}getProjectAsync(e){return this.db.getAsync(n.projectTable,e).then(e=>{return null==(e=e)?void 0:e.project})}saveProjectAsync(e){return this.db.setAsync(n.projectTable,{id:e.header.id,project:e})}getUserStateAsync(){return this.db.getAsync(n.userTable,"local-user").then(e=>{return null==(e=e)?void 0:e.user})}saveUserStateAsync(e){return this.db.setAsync(n.userTable,{id:"local-user",user:e})}}n.version=6,n.databaseName="local-skill-map",n.projectTable="projects",n.projectKey="id",n.userTable="users",n.userKey="id",t.IndexedDBWorkspace=n}}(pxt=pxt||{}),function(n){var e;(e=n.streams||(n.streams={})).createStreamAsync=function(e,t){return n.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(e=>e)},e.postPayloadAsync=function(e,t){return n.Util.assert(!!e.privatekey),n.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}}(pxt=pxt||{}),function(n){{var r=n.svgUtil||(n.svgUtil={}),e;let t,i;(e=t=r.PatternUnits||(r.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox",(e=i=r.LengthUnit||(r.LengthUnit={}))[e.em=0]="em",e[e.ex=1]="ex",e[e.px=2]="px",e[e.in=3]="in",e[e.cm=4]="cm",e[e.mm=5]="mm",e[e.pt=6]="pt",e[e.pc=7]="pc",e[e.percent=8]="percent";class o{constructor(e){this.el=s(e)}attr(t){return Object.keys(t).forEach(e=>{this.setAttribute(e,t[e])}),this}setAttribute(e,t){return this.el.setAttribute(e,t.toString()),this}setAttributeNS(e,t,n){return this.el.setAttributeNS(e,t,n.toString()),this}id(e){return this.setAttribute("id",e)}setClass(...e){return this.setAttribute("class",e.join(" "))}appendClass(e){return n.BrowserUtils.addClass(this.el,e),this}removeClass(e){n.BrowserUtils.removeClass(this.el,e)}title(e){this.titleElement||(this.titleElement=s("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e}setVisible(e){return this.setAttribute("visibility",e?"visible":"hidden")}}r.BaseElement=o;class l extends o{draw(e){e=function(e){switch(e){case"text":return new f;case"circle":return new g;case"rect":return new m;case"line":return new b;case"polygon":return new w;case"polyline":return new y;case"path":return new x;default:return new p(e)}}(e);return this.el.appendChild(e.el),e}element(e,t){return t(this.draw(e)),this}group(){var e=new c;return this.el.appendChild(e.el),e}appendChild(e){this.el.appendChild(e.el)}onDown(e){return r.events.down(this.el,e),this}onUp(e){return r.events.up(this.el,e),this}onMove(e){return r.events.move(this.el,e),this}onEnter(e){return r.events.enter(this.el,e),this}onLeave(e){return r.events.leave(this.el,e),this}onClick(e){return r.events.click(this.el,e),this}}r.DrawContext=l,r.SVG=class extends l{constructor(e){super("svg"),e&&e.appendChild(this.el)}define(e){return this.defs||(this.defs=new d(this.el)),e(this.defs),this}};class c extends l{constructor(e){super("g"),e&&e.appendChild(this.el)}translate(e,t){return this.left=e,this.top=t,this.updateTransform()}scale(e){return this.scaleFactor=e,this.updateTransform()}def(){return new d(this.el)}style(){return new h(this.el)}updateTransform(){let e="";return null!=this.left&&(e+=`translate(${this.left} ${this.top})`),null!=this.scaleFactor&&(e+=` scale(${this.scaleFactor})`),this.setAttribute("transform",e),this}}r.Group=c;class u extends l{constructor(){super("pattern")}units(e){return this.setAttribute("patternUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}contentUnits(e){return this.setAttribute("patternContentUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}size(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this}}r.Pattern=u;class d extends o{constructor(e){super("defs"),e.appendChild(this.el)}create(e,t){let n;switch(e){case"path":n=new x;break;case"pattern":n=new u;break;case"radialGradient":n=new T;break;case"linearGradient":n=new A;break;case"clipPath":n=new E;break;default:n=new o(e)}return n.id(t),this.el.appendChild(n.el),n}}r.DefsElement=d;class h extends o{constructor(e){super("style"),e.appendChild(this.el)}content(e){this.el.textContent=e}}r.StyleElement=h;class p extends l{at(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this}moveTo(e,t){return this.at(e,t)}fill(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this}opacity(e){return this.setAttribute("fill-opacity",e)}stroke(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this}strokeWidth(e){return this.setAttribute("stroke-width",e)}strokeOpacity(e){return this.setAttribute("stroke-opacity",e)}clipPath(e){return this.setAttribute("clip-path",e)}}r.Drawable=p;class f extends p{constructor(e){super("text"),null!=e&&this.text(e)}text(e){return this.el.textContent=e,this}fontFamily(e){return this.setAttribute("font-family",e)}fontSize(e,t){return this.setAttribute("font-size",a(e,t))}offset(e,t,n){return 0!==e&&this.setAttribute("dx",a(e,n)),0!==t&&this.setAttribute("dy",a(t,n)),this}anchor(e){return this.setAttribute("text-anchor",e)}}r.Text=f;class m extends p{constructor(){super("rect")}width(e,t=i.px){return this.setAttribute("width",a(e,t))}height(e,t=i.px){return this.setAttribute("height",a(e,t))}corner(e){return this.corners(e,e)}corners(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}size(e,t,n=i.px){return this.width(e,n),this.height(t,n),this}}r.Rect=m;class g extends p{constructor(){super("circle")}at(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this}radius(e){return this.setAttribute("r",e)}}r.Circle=g;class b extends p{constructor(){super("line")}at(e,t,n,i){return this.from(e,t),null!=n&&null!=i&&this.to(n,i),this}from(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this}to(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this}}r.Line=b;class v extends p{points(e){return this.setAttribute("points",e)}with(e){return this.points(e.map(({x:e,y:t})=>e+" "+t).join(","))}}r.PolyElement=v;class y extends v{constructor(){super("polyline")}}r.Polyline=y;class w extends v{constructor(){super("polygon")}}r.Polygon=w;class x extends p{constructor(){super("path"),this.d=new C}update(){return this.setAttribute("d",this.d.toAttribute())}path(e){return e(this.d),this.update()}}r.Path=x,r.Image=class extends p{constructor(){super("image")}src(e){return this.setAttributeNS("http://www.w3.org/1999/xlink","href",e)}width(e,t=i.px){return this.setAttribute("width",a(e,t))}height(e,t=i.px){return this.setAttribute("height",a(e,t))}size(e,t,n=i.px){return this.width(e,n),this.height(t,n),this}};class k extends o{units(e){return this.setAttribute("gradientUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}stop(e,t,n){var i=s("stop");return i.setAttribute("offset",e+"%"),null!=t&&i.setAttribute("stop-color",t),null!=n&&i.setAttribute("stop-opacity",n),this.el.appendChild(i),this}}r.Gradient=k;class A extends k{constructor(){super("linearGradient")}start(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this}end(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this}}r.LinearGradient=A;class T extends k{constructor(){super("radialGradient")}center(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this}focus(e,t,n){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",n),this}radius(e){return this.setAttribute("r",e)}}r.RadialGradient=T;class E extends l{constructor(){super("clipPath")}clipPathUnits(e){return e?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")}}function s(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}r.ClipPath=E;class C{constructor(){this.ops=[]}clear(){this.ops=[]}moveTo(e,t){return this.op("M",e,t)}moveBy(e,t){return this.op("m",e,t)}lineTo(e,t){return this.op("L",e,t)}lineBy(e,t){return this.op("l",e,t)}cCurveTo(e,t,n,i,r,s){return this.op("C",e,t,n,i,r,s)}cCurveBy(e,t,n,i,r,s){return this.op("c",e,t,n,i,r,s)}qCurveTo(e,t,n,i){return this.op("Q",e,t,n,i)}qCurveBy(e,t,n,i){return this.op("q",e,t,n,i)}sCurveTo(e,t,n,i){return this.op("S",e,t,n,i)}sCurveBy(e,t,n,i){return this.op("s",e,t,n,i)}tCurveTo(e,t){return this.op("T",e,t)}tCurveBy(e,t){return this.op("t",e,t)}arcTo(e,t,n,i,r,s,a){return this.op("A",e,t,n,i?1:0,r?1:0,s,a)}arcBy(e,t,n,i,r,s,a){return this.op("a",e,t,n,i?1:0,r?1:0,s,a)}close(){return this.op("z")}toAttribute(){return this.ops.map(e=>e.op+" "+e.args.join(" ")).join(" ")}op(e,...t){return this.ops.push({op:e,args:t}),this}}function a(e,t){switch(t){case i.em:return e+"em";case i.ex:return e+"ex";case i.px:return e+"px";case i.in:return e+"in";case i.cm:return e+"cm";case i.mm:return e+"mm";case i.pt:return e+"pt";case i.pc:return e+"pc";case i.percent:return e+"%";default:return e.toString()}}r.PathContext=C}}(pxt=pxt||{}),function(e){function n(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function i(){return"undefined"!=typeof window&&!!window.PointerEvent}(e=(e=e.svgUtil||(e.svgUtil={})).events||(e.events={})).isTouchEnabled=n,e.hasPointerEvents=i,e.down=function(e,t){i()?e.addEventListener("pointerdown",t):n()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){i()?e.addEventListener("pointerup",t):(n(),e.addEventListener("mouseup",t))},e.enter=function(e,t){i()?e.addEventListener("pointerover",e=>{t(!!(1&e.buttons))}):n()?e.addEventListener("touchstart",e=>{t(!0)}):e.addEventListener("mouseover",e=>{t(!!(1&e.buttons))})},e.leave=function(e,t){i()?e.addEventListener("pointerleave",t):n()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){i()?e.addEventListener("pointermove",t):n()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}}(pxt=pxt||{}),function(e){e=e.svgUtil||(e.svgUtil={});{var t=e.helpers||(e.helpers={});class n extends e.Text{at(e,t){return this.cx=e,this.cy=t,this.rePosition(),this}text(e,t=12){return super.text(e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this}rePosition(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))}}t.CenteredText=n}}(pxt=pxt||{}),function(d){d.IMAGE_MIME_TYPE="image/x-mkcd-f4",d.TILEMAP_MIME_TYPE="application/mkcd-tilemap",d.ANIMATION_MIME_TYPE="application/mkcd-animation";class t{constructor(){this.assets=[],this.takenNames={},this.listeners=[]}add(e){return this.takenNames[e.id]?this.update(e.id,e):(e=s(e),this.takenNames[e.id]=!0,this.takenNames[h(e)]=!0,e.meta.displayName&&e.meta.displayName!==e.id&&(this.takenNames[e.meta.displayName]&&(e.meta.displayName=this.generateNewDisplayName(e.meta.displayName)),this.takenNames[e.meta.displayName]=!0),this.assets.push(e),s(e))}getSnapshot(t){return(t?this.assets.filter(e=>t(e)):this.assets).map(s)}update(e,t){let n;return this.takenNames[e]?l(this.lookupByID(e),t)?n=t:(this.removeByID(e),n=this.add(t),this.notifyListener(t.internalID)):n=this.add(t),n}removeByID(t){var e=this.lookupByID(t);this.assets=this.assets.filter(e=>e.id!==t),delete this.takenNames[t],e&&delete this.takenNames[h(e)],null!=e&&e.meta.displayName&&delete this.takenNames[null==e?void 0:e.meta.displayName]}getByID(e){e=this.lookupByID(e);return e&&s(e)}getByDisplayName(e){if(this.takenNames[e])for(const t of this.assets)if(t.meta.displayName===e||h(t)===e)return s(t)}isIDTaken(e){return!!this.takenNames[e]}clone(){var e=new t;return e.assets=this.getSnapshot(),e.takenNames=Object.assign({},this.takenNames),e}serializeToJRes(e={}){for(const t of this.assets)i(t,e);return e}addListener(e,t){this.listeners.push({internalID:e,callback:t})}removeListener(t){this.listeners=this.listeners.filter(e=>e.callback!==t)}diff(e){let t={before:[],after:[]},n={};for(const i of e.assets){n[i.internalID]=!0;const e=this.lookupByInternalID(i.internalID);e&&l(i,e)||(t.before.push(i),t.after.push(e))}for(const e of this.assets.filter(e=>!n[e.internalID]))t.before.push(null),t.after.push(e);return t}applyDiff(e,t=!1){var n=t?e.after:e.before,i=t?e.before:e.after;d.Util.assert(n.length===i.length);for(let e=0;e<n.length;e++)n[e]?(this.removeByInternalID(n[e].internalID),i[e]&&this.assets.push(i[e]),this.notifyListener(n[e].internalID)):(this.assets.push(i[e]),this.notifyListener(i[e].internalID));this.takenNames={};for(const e of this.assets)d.Util.assert(!this.takenNames[e.id]),this.takenNames[e.id]=!0,this.takenNames[h(e)]=!0,e.meta.displayName&&(e.meta.displayName!==e.id&&d.Util.assert(!this.takenNames[e.meta.displayName]),this.takenNames[e.meta.displayName]=!0)}lookupByID(e){for(const t of this.assets)if(t.id===e)return t;return null}lookupByInternalID(e){for(const t of this.assets)if(t.internalID===e)return t;return null}removeByInternalID(t){this.assets=this.assets.filter(e=>e.internalID!==t)}notifyListener(e){for(const t of this.listeners)t.internalID===e&&t.callback()}generateNewDisplayName(e){e=e.replace(/\d+$/,"");let t=0;for(;this.takenNames[e+t];)++t;return e+t}}function r(e){var t=[];for(const i of Object.keys(e)){var n=e[i];n.mimeType===d.TILEMAP_MIME_TYPE&&t.push(n)}return t}function a(e,t){return`
    helpers._registerFactory("${e}", function(name: string) {
        switch(helpers.stringTrim(name)) {
`+t.map(e=>e.keys.filter(e=>!!e).map(e=>`            case "${e}":`).join("\n")+`return ${e.expression};`).join("\n")+"\n        }\n        return null;\n    })\n"}function n(e){return d.sprite.Bitmap.fromData(e).copy().data()}function o(e,t){var n=atob(e.data),n=d.U.fromHex(n),i=n[1]|n[2]<<8,r=n[3]|n[4]<<8,e={tileWidth:n[0],tiles:e.tileset.map(e=>t&&t(e)||{id:e})},s=n.slice(5,5+i*r),a=new d.sprite.Tilemap(i,r,0,0,new Uint8ClampedArray(s)),n=n.slice(5+s.length),s=new d.sprite.Bitmap(i,r,0,0,new Uint8ClampedArray(n)).data();return new d.sprite.TilemapData(a,e,s)}function s(e){switch(e.meta=Object.assign({},e.meta),e.type){case"tile":case"image":return Object.assign(Object.assign({},e),{bitmap:n(e.bitmap)});case"animation":return Object.assign(Object.assign({},e),{frames:e.frames.map(e=>n(e))});case"tilemap":return Object.assign(Object.assign({},e),{data:e.data.cloneData()})}}function i(e,t){var n,i,r,s,a=e.id.substr(e.id.lastIndexOf(".")+1);switch(e.type){case"image":t[a]=e.jresData,e.meta.displayName&&(t[a]={data:e.jresData,mimeType:d.IMAGE_MIME_TYPE,displayName:e.meta.displayName});break;case"tile":t[a]={data:e.jresData,mimeType:d.IMAGE_MIME_TYPE,tilemapTile:!0,displayName:e.meta.displayName};break;case"tilemap":n=e.data,i=e.id,r=e.meta.displayName,o=n.tilemap.data(),(s=new Uint8ClampedArray(5+o.data.length+n.layers.data.length))[0]=n.tileset.tileWidth,s[1]=255&o.width,s[2]=o.width>>8&255,s[3]=255&o.height,s[4]=o.height>>8&255,s.set(o.data,5),s.set(n.layers.data,5+o.data.length);var o={id:i,mimeType:d.TILEMAP_MIME_TYPE,data:btoa(d.sprite.uint8ArrayToHex(s)),tileset:n.tileset.tiles.map(e=>e.id),displayName:r};t[o.id]=o;break;case"animation":t[a]={namespace:(i=e).id.substr(0,i.id.lastIndexOf(".")),id:i.id.substr(i.id.lastIndexOf(".")+1),mimeType:d.ANIMATION_MIME_TYPE,data:d.sprite.encodeAnimationString(i.frames,i.interval),displayName:i.meta.displayName}}}function l(e,t){if(e==t)return!0;if(e.id!==t.id||e.type!==t.type||!p(e.meta.tags,t.meta.tags)||!p(e.meta.blockIDs,t.meta.blockIDs)||e.meta.displayName!==t.meta.displayName)return!1;switch(e.type){case"image":case"tile":return d.sprite.bitmapEquals(e.bitmap,t.bitmap);case"animation":return e.interval===t.interval&&p(e.frames,t.frames,d.sprite.bitmapEquals);case"tilemap":return e.data.equals(t.data)}}function c(e){e=/^\s*(?:(?:assets\s*\.\s*(image|tile|animation|tilemap))|(tilemap))\s*(?:`|\(""")([^`"]+)(?:`|"""\))\s*$/m.exec(e);if(e)return{type:e[1]||e[2],name:e[3].trim()}}function h(e){return u(e.type,e.id)}function u(e,t,n=!1){let i;switch(e){case"image":i=d.sprite.IMAGES_NAMESPACE+".";break;case"tile":i=d.sprite.TILE_NAMESPACE+".";break;case"tilemap":i="";break;case"animation":i=d.sprite.ANIMATION_NAMESPACE+"."}if(i)if(t.startsWith(i)){const d=t.substr(i.length);if(-1===d.indexOf("."))return d}else if(!n)return null;return t}function p(t,n,i=(e,t)=>e===t){if(t!=n){if(!t&&n||!n&&t||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(!i(t[e],n[e]))return!1}return!0}function f(e){var t=atob(e.data),n=new Uint8ClampedArray(d.U.fromHex(t)),t=m(n,0),i=m(n,2),r=m(n,4),s=m(n,6),a=Math.ceil(i*r/2);let o=8;var l=[];for(let e=0;e<s;e++){const d=n.slice(o,o+a);l.push({x0:0,y0:0,width:i,height:r,data:d}),o+=a}let c=e.id;return{type:"animation",internalID:0,id:c=c.startsWith(e.namespace)?c:(c=e.namespace+"."+c).replace(/\.\./g,"."),interval:t,frames:l,meta:{displayName:e.displayName}}}function m(e,t){return e[t]|e[t+1]<<8}d.TilemapProject=class{constructor(){this.needsRebuild=!0,this.nextID=0,this.nextInternalID=0,this.committedState={revision:0,tilemaps:new t,tiles:new t,animations:new t,images:new t},this.state={revision:this.nextID++,tilemaps:new t,tiles:new t,animations:new t,images:new t},this.gallery={revision:0,tilemaps:new t,tiles:new t,animations:new t,images:new t},this.undoStack=[],this.redoStack=[]}getNewInternalId(){return this.nextInternalID++}createNewImage(e=16,t=16){var n=this.generateNewID("image"),e=new d.sprite.Bitmap(e,t).data(),t={internalID:this.getNewInternalId(),id:n,type:"image",bitmap:e,meta:{},jresData:d.sprite.base64EncodeBitmap(e)};return this.state.images.add(t)}createNewAnimation(e=16,t=16){var n=this.generateNewID("animation"),e=new d.sprite.Bitmap(e,t).data(),t={internalID:this.getNewInternalId(),id:n,type:"animation",frames:[e],interval:500,meta:{}};return this.state.animations.add(t)}createNewAnimationFromData(e,t=500,n){var i=this.generateNewID("animation"),i={internalID:this.getNewInternalId(),id:i,type:"animation",frames:e,interval:t,meta:{displayName:n}};return this.state.animations.add(i)}getGalleryTiles(t){return this.extensionTileSets?this.extensionTileSets.map(e=>e.tileSets.find(e=>e.tileWidth===t)).filter(e=>null==e?void 0:e.tiles.length):null}getProjectImages(){return this.state.images.getSnapshot()}getProjectTiles(t,e){var n=this.state.tiles.getSnapshot(e=>e.bitmap.width===t);return 0===n.length?e?(this.createNewTile(new d.sprite.Bitmap(t,t).data()),this.getProjectTiles(t,!1)):null:{tileWidth:t,tiles:n}}createNewTile(e,t,n){this.onChange(),t&&!this.isNameTaken("tile",t)||(t=this.generateNewID("tile"));t={internalID:this.getNewInternalId(),id:t,type:"tile",jresData:d.sprite.base64EncodeBitmap(e),bitmap:e,meta:{displayName:n},isProjectTile:!0};return this.state.tiles.add(t)}createNewProjectImage(e,t){this.onChange();t={internalID:this.getNewInternalId(),id:this.generateNewID("image"),type:"image",jresData:d.sprite.base64EncodeBitmap(e),meta:{displayName:t},bitmap:e};return this.state.images.add(t)}updateTile(t){this.onChange();var e=this.resolveProjectTileByInternalID(t.internalID);if(e){if(this.state.tiles.update(e.id,t),e.id!==t.id||!d.sprite.bitmapEquals(e.bitmap,t.bitmap))for(const d of this.getAssets("tilemap"))d.data.tileset.tiles.some(e=>e.internalID===t.internalID)&&(d.data.tileset.tiles=d.data.tileset.tiles.map(e=>e.internalID===t.internalID?t:e),this.updateTilemap(d.id,d.data));return t}return null}deleteTile(e){this.onChange(),this.state.tiles.removeByID(e)}getProjectTilesetJRes(){var e={};return this.state.tiles.serializeToJRes(e),this.state.tilemaps.serializeToJRes(e),e["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:d.sprite.TILE_NAMESPACE},e}getProjectAssetsJRes(){var e={};return this.state.images.serializeToJRes(e),this.state.animations.serializeToJRes(e),e["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:d.sprite.IMAGES_NAMESPACE},e}getTilemap(e){return this.state.tilemaps.getByID(e)}updateTilemap(e,t){var n=this.state.tilemaps.getByID(e);return n?(this.onChange(),n=Object.assign(Object.assign({},n),{data:t}),this.state.tilemaps.update(e,n),n):null}createNewTilemap(e,t,n=16,i=16){return this.createNewTilemapFromData(this.blankTilemap(t,n,i),e)}blankTilemap(e,t=16,n=16){var i=new d.sprite.Tilemap(t,n),t=new d.sprite.Bitmap(t,n),n={tileWidth:e,tiles:[this.getTransparency(e)]};return new d.sprite.TilemapData(i,n,t.data())}resolveTile(e){return this.lookupAsset("tile",e)}resolveProjectTileByInternalID(t){return this.state.tiles.getSnapshot(e=>e.internalID===t)[0]}resolveTileByBitmap(e){const t=d.sprite.base64EncodeBitmap(e);return this.state.tiles.getSnapshot(e=>e.jresData===t)[0]}getTransparency(e){var t=d.sprite.TILE_NAMESPACE+".transparency"+e;let n=this.state.tiles.getByID(t);return n||(e=new d.sprite.Bitmap(e,e).data(),n={internalID:this.getNewInternalId(),id:t,type:"tile",bitmap:e,jresData:d.sprite.base64EncodeBitmap(e),meta:{},isProjectTile:!0},this.state.tiles.add(n))}createNewTilemapFromData(e,t){this.onChange();t=this.generateNewIDInternal("tilemap",t||lf("level"));return this.state.tilemaps.add({internalID:this.getNewInternalId(),id:t,type:"tilemap",meta:{displayName:t},data:e}),[t,e]}cloneState(){return{revision:this.state.revision,images:this.state.images.clone(),tilemaps:this.state.tilemaps.clone(),animations:this.state.animations.clone(),tiles:this.state.tiles.clone()}}undo(){var e;this.state.revision!==this.committedState.revision&&this.pushUndo(),this.undoStack.length&&(e=this.undoStack.pop(),this.state.tiles.applyDiff(e.tiles,!0),this.state.images.applyDiff(e.images,!0),this.state.tilemaps.applyDiff(e.tilemaps,!0),this.state.animations.applyDiff(e.animations,!0),this.state.revision=e.beforeRevision,this.redoStack.push(e),this.committedState=this.cloneState(),this.needsRebuild=!0)}redo(){var e;this.redoStack.length&&(e=this.redoStack.pop(),this.state.tiles.applyDiff(e.tiles),this.state.images.applyDiff(e.images),this.state.tilemaps.applyDiff(e.tilemaps),this.state.animations.applyDiff(e.animations),this.state.revision=e.afterRevision,this.undoStack.push(e),this.committedState=this.cloneState(),this.needsRebuild=!0)}pushUndo(){this.undoStack.length&&this.committedState.revision===this.state.revision||(this.redoStack=[],this.undoStack.push({beforeRevision:this.committedState.revision,afterRevision:this.state.revision,tiles:this.state.tiles.diff(this.committedState.tiles),images:this.state.images.diff(this.committedState.images),tilemaps:this.state.tilemaps.diff(this.committedState.tilemaps),animations:this.state.animations.diff(this.committedState.animations)}),this.committedState=this.cloneState(),this.cleanupTemporaryAssets())}revision(){return this.state.revision}encodeTilemap(e,t){var n=e.tilemap.data(),i=new Uint8ClampedArray(5+n.data.length+e.layers.data.length);return i[0]=e.tileset.tileWidth,i[1]=255&n.width,i[2]=n.width>>8&255,i[3]=255&n.height,i[4]=n.height>>8&255,i.set(n.data,5),i.set(e.layers.data,5+n.data.length),{id:t,mimeType:d.TILEMAP_MIME_TYPE,data:btoa(d.sprite.uint8ArrayToHex(i)),tileset:e.tileset.tiles.map(e=>e.id)}}forceUpdate(){this.onChange()}isNameTaken(t,e){var n=e=>{switch(t){case"image":return this.state.images.isIDTaken(e)||this.gallery.images.isIDTaken(e);case"tile":return this.state.tiles.isIDTaken(e)||this.gallery.tiles.isIDTaken(e);case"tilemap":return this.state.tilemaps.isIDTaken(e)||this.gallery.tilemaps.isIDTaken(e);case"animation":return this.state.animations.isIDTaken(e)||this.gallery.animations.isIDTaken(e)}},i=u(t,e),r=i&&i!==e;return n(e)||r&&n(i)}isAssetUsed(n,i,r){var s,a,o;if(0<((null==(a=null==(s=n.meta)?void 0:s.blockIDs)?void 0:a.filter(e=>!r||(null==r?void 0:r.indexOf(e))<0))||[]).length)return!0;if("tile"==n.type)for(const d of this.getAssets("tilemap"))if(!(0<=(null==r?void 0:r.indexOf(d.id)))&&d.data.tileset.tiles.some(e=>e.id===n.id))return!0;if(i){const s=d.Util.escapeForRegex(h(n)),a=d.Util.escapeForRegex(null==(o=n.meta)?void 0:o.displayName)||"";let e;switch(n.type){case"tile":e=`myTiles.${s}|assets.tile\`${s}\``,a&&(e+=`|assets.tile\`${a}\``);break;case"tilemap":e=`tilemap\`${s}\``;break;case"animation":e=`assets.animation\`${s}\``,a&&(e+=`|assets.animation\`${a}\``);break;default:e=`assets.image\`${s}\``,a&&(e+=`|assets.image\`${a}\``)}var l=new RegExp(e,"gm");let t;switch(n.type){case"tile":t=`myTiles.${s}|assets.tile("""${s}""")`,a&&(t+=`|assets.tile("""${a}""")`);break;case"tilemap":t=`assets.tilemap("""${s}""")`;break;case"animation":t=`assets.animation("""${s}""")`,a&&(t+=`|assets.animation("""${a}""")`);break;default:t=`assets.image("""${s}""")`,a&&(t+=`|assets.image("""${a}""")`)}var c,u=new RegExp(t,"gm");for(c of Object.keys(i))if(!(0<=(null==r?void 0:r.indexOf(c)))){const n=i[c];if(c.match(/((?!\.g).{2}|^.{0,1})\.ts$/i)){if(n.content.match(l))return!0}else if(c.endsWith(".py")&&n.content.match(u))return!0}}return!1}lookupAsset(e,t){switch(e){case"image":return this.state.images.getByID(t)||this.gallery.images.getByID(t);case"tile":return this.state.tiles.getByID(t)||this.gallery.tiles.getByID(t);case"tilemap":return this.state.tilemaps.getByID(t)||this.gallery.tilemaps.getByID(t);case"animation":return this.state.animations.getByID(t)||this.gallery.animations.getByID(t)}}lookupAssetByName(e,t){switch(e){case"image":return this.state.images.getByDisplayName(t);case"tile":return this.state.tiles.getByDisplayName(t);case"tilemap":return this.state.tilemaps.getByDisplayName(t);case"animation":return this.state.animations.getByDisplayName(t)}}getAssets(e){switch(e){case"image":return this.state.images.getSnapshot();case"tile":return this.state.tiles.getSnapshot();case"tilemap":return this.state.tilemaps.getSnapshot();case"animation":return this.state.animations.getSnapshot()}}getGalleryAssets(e){switch(e){case"image":return this.gallery.images.getSnapshot();case"tile":return this.gallery.tiles.getSnapshot();case"tilemap":return this.gallery.tilemaps.getSnapshot();case"animation":return this.gallery.animations.getSnapshot()}}lookupBlockAsset(e,t){var n=e=>{return-1!==(null==(e=null==(e=e.meta)?void 0:e.blockIDs)?void 0:e.indexOf(t))};switch(e){case"image":return this.state.images.getSnapshot(n)[0];case"tile":return this.state.tiles.getSnapshot(n)[0];case"tilemap":return this.state.tilemaps.getSnapshot(n)[0];case"animation":return this.state.animations.getSnapshot(n)[0]}}updateAsset(e){switch(this.onChange(),e.type){case"image":return this.state.images.update(e.id,e);case"tile":return this.updateTile(e);case"tilemap":return this.state.tilemaps.update(e.id,e);case"animation":return this.state.animations.update(e.id,e)}}duplicateAsset(e,t){this.onChange();var n=s(e),i=t||(null==(t=n.meta)?void 0:t.displayName);let r;switch(e.type){case"image":r=this.createNewProjectImage(n.bitmap,i);break;case"tile":r=this.createNewTile(n.bitmap,null,i);break;case"tilemap":const[e,t]=this.createNewTilemapFromData(n.data,i);r=this.getTilemap(e);break;case"animation":r=this.createNewAnimationFromData(n.frames,n.interval,i)}return r}removeAsset(e){switch(this.onChange(),e.type){case"image":return this.state.images.removeByID(e.id);case"tile":return this.state.tiles.removeByID(e.id);case"tilemap":return this.state.tilemaps.removeByID(e.id);case"animation":return this.state.animations.removeByID(e.id)}}addChangeListener(e,t){switch(e.type){case"image":this.state.images.addListener(e.internalID,t);break;case"tile":this.state.tiles.addListener(e.internalID,t);break;case"tilemap":this.state.tilemaps.addListener(e.internalID,t);break;case"animation":this.state.animations.addListener(e.internalID,t)}}removeChangeListener(e,t){switch(e){case"image":this.state.images.removeListener(t);break;case"tile":this.state.tiles.removeListener(t);break;case"tilemap":this.state.tilemaps.removeListener(t);break;case"animation":this.state.animations.removeListener(t)}}loadPackage(e){const t=e.sortedDeps();this.extensionTileSets=[];for(const e of t){const t="this"===e.id,r=this.readImages(e.parseJRes(),t);for(const e of r)("tile"===e.type?(t?this.state:this.gallery).tiles:"image"===e.type?(t?this.state:this.gallery).images:(t?this.state:this.gallery).animations).add(e)}for(const t of r(e.parseJRes()))this.state.tilemaps.add({internalID:this.getNewInternalId(),type:"tilemap",id:t.id,meta:{displayName:t.displayName||t.id},data:o(t,e=>this.resolveTile(e))});this.committedState=this.cloneState(),this.undoStack=[],this.redoStack=[]}loadTilemapJRes(e,t=!1){e=d.inflateJRes(e);var n=this.readImages(e,!0).filter(e=>"tile"===e.type);let i={};for(const d of n){if(t){const e=this.resolveTileByBitmap(d.bitmap);if(e){i[d.id]=e.id;continue}}const e=this.createNewTile(d.bitmap,d.id,d.meta.displayName);e.id!==d.id&&(i[d.id]=e.id)}for(const d of r(e))this.state.tilemaps.add({internalID:this.getNewInternalId(),type:"tilemap",id:d.id,meta:{displayName:d.displayName||d.id},data:o(d,e=>(i[e]&&(e=i[e]),this.resolveTile(e)))})}loadAssetsJRes(e){e=d.inflateJRes(e);var t=[];for(const i of Object.keys(e)){var n=e[i];if(n.tilemapTile)this.state.tiles.add(this.generateImage(n,"tile"));else if(n.mimeType===d.IMAGE_MIME_TYPE)this.state.images.add(this.generateImage(n,"image"));else if(n.mimeType===d.ANIMATION_MIME_TYPE){const[d,e]=this.generateAnimation(n);e?t.push(d):this.state.animations.add(d)}}for(const d of t)this.state.animations.add(this.inflateAnimation(d,this.state.images.getSnapshot()))}removeInactiveBlockAssets(i){function e(e){var t=e.getSnapshot(e=>{return!e.meta.displayName&&(null==(e=e.meta.blockIDs)?void 0:e.some(e=>-1===i.indexOf(e)))}),n=[];for(const e of t)1!==e.meta.blockIDs.length&&(e.meta.blockIDs=e.meta.blockIDs.filter(e=>-1!==i.indexOf(e)),0!==e.meta.blockIDs.length)||n.push(e);for(const i of n)e.removeByID(i.id)}e(this.state.images),e(this.state.tiles),e(this.state.tilemaps),e(this.state.animations)}generateImage(e,t){return{internalID:this.getNewInternalId(),type:t,id:e.id,meta:{displayName:e.displayName},jresData:e.data,bitmap:d.sprite.getBitmapFromJResURL(`data:${d.IMAGE_MIME_TYPE};base64,`+e.data).data()}}generateAnimation(t){if("json"!==t.dataEncoding)return[Object.assign(Object.assign({},f(t)),{internalID:this.getNewInternalId()}),!1];{let e;try{e=JSON.parse(t.data)}catch(e){console.warn("could not parse json data of '"+t.id+"'")}return[{internalID:this.getNewInternalId(),type:"animation",meta:{displayName:t.displayName},id:t.id,frames:[],frameIds:e.frames,interval:100,flippedHorizontal:e.flippedHorizontal},!0]}}inflateAnimation(e,n){return e.frames=e.frameIds.map(t=>n.find(e=>e.id===t).bitmap),e.flippedHorizontal&&(e.frames=e.frames.map(e=>{var n=d.sprite.Bitmap.fromData(e),i=new d.sprite.Bitmap(e.width,e.height);for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)i.set(t,e,n.get(n.width-t-1,e));return i.data()})),e}generateNewID(e){switch(e){case"animation":return this.generateNewIDInternal("animation",d.sprite.ANIMATION_PREFIX,d.sprite.ANIMATION_NAMESPACE);case"image":return this.generateNewIDInternal("image",d.sprite.IMAGE_PREFIX,d.sprite.IMAGES_NAMESPACE);case"tile":return this.generateNewIDInternal("tile",d.sprite.TILE_PREFIX,d.sprite.TILE_NAMESPACE);case"tilemap":return this.generateNewIDInternal("tilemap",lf("level"))}}generateNewIDInternal(e,t,n){t=t.replace(/\d+$/,"");var i=n?n+"."+t:t;let r=1;for(;this.isNameTaken(e,i+r);)++r;return i+r}onChange(){this.needsRebuild=!0,this.state.revision=this.nextID++}readImages(e,t=!1){var n=[],i=[];for(const s of Object.keys(e)){var r=e[s];if(r.tilemapTile){const d=this.generateImage(r,"tile");d.isProjectTile=t,n.push(d)}else if(r.mimeType===d.IMAGE_MIME_TYPE)n.push(this.generateImage(r,"image"));else if(r.mimeType===d.ANIMATION_MIME_TYPE){const[d,e]=this.generateAnimation(r);(e?i:n).push(d)}}for(const d of i)n.push(this.inflateAnimation(d,n));return n}cleanupTemporaryAssets(){for(const e of this.state.images.getSnapshot(e=>{return!(e.meta.displayName||null!=(e=e.meta.blockIDs)&&e.length)}))this.state.images.removeByID(e.id)}},d.emitTilemapsFromJRes=function(e){const t=Object.keys(e);let n="";var i=[],r=[];for(const a of t)if("*"!==a){const t=e[a];if(t.tilemapTile&&(n=(n+="    //% fixedInstance jres blockIdentity=images._tile\n")+`    export const ${a} = image.ofBuffer(hex\`\`);
`,r.push({keys:[t.displayName,u("tile",a,!0)],expression:a})),t.mimeType===d.TILEMAP_MIME_TYPE){const e=o(t);i.push({keys:[t.displayName,u("tilemap",t.id)],expression:d.sprite.encodeTilemap(e,"typescript")})}}i.length&&(n+=a("tilemap",i)),r.length&&(n+=a("tile",r));var s=lf("Auto-generated code. Do not edit.");return`// ${s}
namespace ${d.sprite.TILE_NAMESPACE} {
${n}
}
// ${s}
`},d.emitProjectImages=function(e){const n=Object.keys(e);var t="",i=[],r=[];for(const a of n)if("*"!==a){const n=e[a];if("string"==typeof n||n.mimeType===d.IMAGE_MIME_TYPE){let e,t=[u("image",a,!0)];"string"==typeof n?e=d.sprite.bitmapToImageLiteral(d.sprite.getBitmapFromJResURL(n),"typescript"):(e=d.sprite.bitmapToImageLiteral(d.sprite.getBitmapFromJResURL(n.data),"typescript"),t.push(n.displayName)),i.push({keys:t,expression:e})}else if(n.mimeType===d.ANIMATION_MIME_TYPE){const e=f(n);r.push({keys:[n.displayName,u("animation",a,!0)],expression:`[${e.frames.map(e=>d.sprite.bitmapToImageLiteral(d.sprite.Bitmap.fromData(e),"typescript")).join(", ")}]`})}}var s=lf("Auto-generated code. Do not edit."),t=(t+=a("image",i))+a("animation",r);return`// ${s}
namespace ${d.sprite.IMAGES_NAMESPACE} {
${t}
}
// ${s}
`},d.cloneAsset=s,d.assetEquals=l,d.validateAssetName=function(e){return!!e&&!/[\u0000-\u001f\u0021-\u002c\u002e\u002f\u003a-\u0040\u005b-\u005e\u0060\u007b-\u007f]/.test(e)},d.getTSReferenceForAsset=function(e,t=!1){var n,i=null!=(n=e.meta)&&n.displayName?e.meta.displayName:h(e);if(!i)return"image"===e.type||"tile"===e.type?e.id:void 0;var r=t?'("""':"`",s=t?'""")':"`";switch(e.type){case"tile":return"assets.tile"+r+i+s;case"image":return"assets.image"+r+i+s;case"animation":return"assets.animation"+r+i+s;case"tilemap":return"tilemap"+r+i+s}},d.parseAssetTSReference=c,d.lookupProjectAssetByTSReference=function(e,t){var n=c(e);if(n){const{type:e,name:i}=n;switch(e){case"tile":return t.lookupAssetByName("tile",i);case"image":return t.lookupAssetByName("image",i);case"tilemap":return t.lookupAssetByName("tilemap",i)||t.lookupAsset("tilemap",i);case"animation":return t.lookupAssetByName("animation",i)}}},d.getDefaultAssetDisplayName=function(e){switch(e){case"image":return lf("myImage");case"tile":return lf("myTile");case"tilemap":return lf("level");case"animation":return lf("myAnim");default:return lf("asset")}},d.getShortIDForAsset=h}(pxt=pxt||{}),function(r){{var e=r.toolbox||(r.toolbox={});e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd",topblocks:"#aa8f00",recipes:"#717171"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:"",topblocks:"",recipes:""};let i="";function n(e){e=function(e,t){let n=0,i=0,r=0;var s=Math.floor(e/60),e=e/60-s,a=.55*t,o=t*(1-.45*e),l=t*(1-.45*(1-e));switch(s){case 1:n=o,i=t,r=a;break;case 2:n=a,i=t,r=l;break;case 3:n=a,i=o,r=t;break;case 4:n=l,i=a,r=t;break;case 5:n=t,i=a,r=o;break;case 6:case 0:n=t,i=l,r=a}return[Math.floor(n),Math.floor(i),Math.floor(r)]}(e,165.75);return"#"+t(e[0])+t(e[1])+t(e[2])}function t(e){e=e.toString(16);return 1==e.length?"0"+e:e}e.appendToolboxIconCss=function(e,t){var n;-1<i.indexOf(e)||(1===t.length?(n=r.Util.unicodeToChar(t),i+=`
                .blocklyTreeIcon.${e}::before {
                    content: "${n}";
                }
            `):i+=`
                .blocklyTreeIcon.${e} {
                    background-image: url("${r.Util.pathJoin(r.webConfig.commitCdnUrl,encodeURI(t))}")!important;
                    width: 30px;
                    height: 100%;
                    background-size: 20px !important;
                    background-repeat: no-repeat !important;
                    background-position: 50% 50% !important;
                }
            `)},e.getNamespaceColor=function(e){return e=e.toLowerCase(),r.appTarget.appTheme.blockColors&&r.appTarget.appTheme.blockColors[e]?r.appTarget.appTheme.blockColors[e]:r.toolbox.blockColors[e]||""},e.getNamespaceIcon=function(e){return e=e.toLowerCase(),r.appTarget.appTheme.blockIcons&&r.appTarget.appTheme.blockIcons[e]?r.appTarget.appTheme.blockIcons[e]:r.toolbox.blockIcons[e]||""},e.advancedTitle=function(){return r.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return r.Util.lf("{id:category}Extensions")},e.recipesTitle=function(){return r.Util.lf("{id:category}Tutorials")},e.convertColor=function(e){e=(t=e)?"0x"==t.substring(0,2)?"#"+t.substring(2):t:"#000000";var t=parseInt(e);return isNaN(t)?e:n(t)},e.hueToRgb=n,e.fadeColor=function(t,n,i){(t=t.replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);let r="#";for(let e=0;e<3;e++){var s=parseInt(t.substr(2*e,2),16),s=(s=Math.round(Math.min(Math.max(0,i?s+s*n:s-s*n),255))).toString(16);r+=("00"+s).substr(s.length)}return r}}}(pxt=pxt||{}),function(x){{var e=x.tutorial||(x.tutorial={});const E=/^##[^#](.*)$([\s\S]*?)(?=^##[^#]|$(?![\r\n]))/gim,C=/^###[^#](.*)$([\s\S]*?)(?=^###[^#]|$(?![\r\n]))/gim;function k(e,t,a){let n=t||E,o=[];if(e.replace(n,function(e,t,n){var{header:i,hint:r,requiredBlocks:s}=function(t,e,n){let i,r,s=t=A(t);if(e){const e=/#+ ~ tutorialhint([\s\S]*)/i;s=t.replace(e,function(e,t){return i=t,""})}else{const e=/(^[\s\S]*?\S)\s*((```|\[?\!\[[\s\S]+?\]\(\S+?\)\]?)[\s\S]*)/im;t=t.match(e);if(t&&2<t.length&&(s=t[1].trim(),i=t[2].trim(),n)){let e=t[2].trim();e=e.replace(/``` *(requiredTutorialBlock)\s*\n([\s\S]*?)\n```/gim,function(e,t,n){return r=`{
${n}
}`,""}),i=e}}return{header:s,hint:i,requiredBlocks:r}}(n=n.trim(),a&&a.explicitHints,a.tutorialCodeValidation),n={title:t.match(/^\{.*\}$/)?void 0:t.replace(/@(fullscreen|unplugged|showdialog|showhint|tutorialCompleted|resetDiff)/gi,"").trim(),contentMd:n,headerContentMd:i};return/@(fullscreen|unplugged|showdialog|showhint)/i.test(t)&&(n.showHint=!0),/@(unplugged|showdialog)/i.test(t)&&(n.showDialog=!0),/@tutorialCompleted/.test(t)&&(n.tutorialCompleted=!0),/@resetDiff/.test(t)&&(n.resetDiff=!0),r&&(n.hintContentMd=r),a.tutorialCodeValidation&&s&&(n.requiredBlockMd=s),o.push(n),""}),0!=e.indexOf("# Not found"))return o;x.debug("tutorial not found")}function A(e){return e&&e.replace(/```(filterblocks|package|ghost|config|template|jres|assetjson|customts)\s*\n([\s\S]*?)\n```/gim,"").trim()}function T(e){if(e)return e=JSON.parse(e),{[x.TILEMAP_JRES]:e[x.TILEMAP_JRES],[x.TILEMAP_CODE]:e[x.TILEMAP_CODE],[x.IMAGES_JRES]:e[x.IMAGES_JRES],[x.IMAGES_CODE]:e[x.IMAGES_CODE]}}e.parseTutorial=function(n){const{metadata:t,body:i}=function(){const i={},e=n.replace(/### @(\S+) ([ \S]+)/gi,function(e,t,n){try{i[t]=JSON.parse(n)}catch(e){i[t]=n}return""}),t=i;return void 0!==t.explicitHints&&x.appTarget.appTheme&&x.appTarget.appTheme.tutorialExplicitHints&&(t.explicitHints=!0),{metadata:t,body:e}}(),{steps:r,activities:s}=function(t,n){if(n&&n.activities){var o=n;let s=[],a=[];return t.replace(E,function(e,t,n){let i=a.length,r=(a.push({name:t||lf("Activity {0}",i),step:s.length}),k(n,C,o));return r=r.map(e=>(e.activity=i,e)),s=s.concat(r),""}),{steps:s,activities:a}}{let e=k(t,null,n);return{steps:e=!e||e.length<1?k(t,C,n):e,activities:null}}}(i,t),a=(o=i.match(/^#[^#](.*)$/im))&&1<o.length?o[1].trim():null;if(r){var{code:o,templateCode:l,editor:c,language:u,jres:d,assetJson:h,customTs:p,tutorialValidationRulesStr:f}=function(e){let t;let i,r,s,a,o,l,c=[];return e.replace(/((?!.)\s)+/g,"\n").replace(/``` *(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template|python|jres|assetjson|customts|tutorialValidationRules|requiredTutorialBlock)\s*\n([\s\S]*?)\n```/gim,function(e,t,n){switch(t){case"block":case"blocks":case"requiredTutorialBlock":case"filterblocks":if(u(x.BLOCKS_PROJECT_NAME))break;return;case"spy":case"python":if(!u(x.PYTHON_PROJECT_NAME))return;"python"==t&&(s=t);break;case"typescript":case"ts":case"javascript":case"js":if(u(x.JAVASCRIPT_PROJECT_NAME))break;return;case"template":r=n;break;case"jres":i=n;break;case"assetjson":a=n;break;case"customts":o=n,n="";break;case"tutorialValidationRules":l=n}return c.push("python"==t?`
${n}
`:`{
${n}
}`),""}),t=t||x.BLOCKS_PROJECT_NAME,{code:c,templateCode:r,editor:t,language:s,jres:i,assetJson:a,customTs:o,tutorialValidationRulesStr:l};function u(e){return t&&t!=e?(x.debug("tutorial ambiguous: contains snippets of different types"),0):(t=e,1)}}(i);let e;if(t.tutorialCodeValidation){e=x.Util.jsonTryParse(f);{var m=e;var g=a;var b=Object.keys(m);for(let e=0;e<b.length;e++){var v={ruleName:b[e],enabled:m[b[e]]?"true":"false",tutorial:g};x.tickEvent("tutorial.validation.setValidationRules",v)}}}if(!0===t.diffs||!1!==t.diffs&&!0!==t.noDiffs&&(c==x.BLOCKS_PROJECT_NAME&&x.appTarget.appTheme.tutorialBlocksDiff||c!=x.BLOCKS_PROJECT_NAME&&x.appTarget.appTheme.tutorialTextDiff)){f=r;var y=s;let l;function w(e){const a={typescript:"diff",spy:"diffspy",blocks:"diffblocks",python:"diff"},o=/\s*(\/\/|#)\s*@highlight/gm;return e&&e.replace(/```(typescript|spy|python|blocks|ghost|template)((?:.|[\r\n])+)```/,function(e,t,n){var i=l,r=/^(template|ghost)$/.test(t),s=o.test(n);return n=n.replace(/^\n+/,"").replace(/\n+$/,""),s&&(n=n.replace(o,"")),l=n,!i||s||r?e:`\`\`\`${a[t]}
${i}
----------
${n}
\`\`\``})}f.forEach((e,t)=>{if((e.resetDiff||y&&y.find(e=>e.step==t))&&(l=void 0),e.hintContentMd){const y=w(e.hintContentMd);if(y&&y!=e.hintContentMd)return void(e.hintContentMd=y)}if(e.headerContentMd){const y=w(e.headerContentMd);y&&y!=e.headerContentMd&&(e.headerContentMd=y)}})}f=T(h);return r.forEach(e=>{e.contentMd=A(e.contentMd),e.headerContentMd=A(e.headerContentMd),e.hintContentMd=A(e.hintContentMd),e.requiredBlockMd=A(e.requiredBlockMd)}),{editor:c,title:a,steps:r,activities:s,code:o,templateCode:l,metadata:t,language:u,jres:d,assetFiles:f,customTs:p,tutorialValidationRules:e}}},e.getMetadataRegex=function(){return/``` *(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template|python|jres|assetjson|customts|tutorialValidationRules|requiredTutorialBlock)\s*\n([\s\S]*?)\n```/gim},e.highlight=function(n){let i=n.textContent;if(i=(i=i.replace(/img\s*\(\s*"{3}[\s\da-f.#tngrpoyw]*"{3}\s*\)/g,'img(""" """)')).replace(/img\s*`[\s\da-f.#tngrpoyw]*`\s*/g,"img` `"),/@highlight/.test(i)){n.textContent="";var r=i.split("\n");for(let t=0;t<r.length;++t){0<t&&t<r.length&&n.appendChild(document.createTextNode("\n"));let e=r[t];if(/@highlight/.test(e)){if(void 0!==(e=r[++t])){const i=document.createElement("span");i.className="highlight-line",i.textContent=e,n.appendChild(i)}}else n.appendChild(document.createTextNode(e))}}else n.textContent=i},e.getTutorialOptions=function(e,t,n,i,r){var s=x.tutorial.parseTutorial(e);if(s)return{options:{tutorial:t,tutorialName:s.title||n,tutorialReportId:i,tutorialStep:0,tutorialReady:!0,tutorialHintCounter:0,tutorialStepInfo:s.steps,tutorialActivityInfo:s.activities,tutorialMd:e,tutorialCode:s.code,tutorialRecipe:!!r,templateCode:s.templateCode,autoexpandStep:!(null!=(t=s.metadata)&&t.autoexpandOff),metadata:s.metadata,language:s.language,jres:s.jres,assetFiles:s.assetFiles,customTs:s.customTs,tutorialValidationRules:s.tutorialValidationRules},editor:s.editor};throw new Error(lf("Invalid tutorial format"))},e.parseCachedTutorialInfo=function(e,i){let r=x.Util.jsonTryParse(e);return r?x.BrowserUtils.tutorialInfoDbAsync().then(e=>{if(i&&r[i]){var t=r[i];t.usedBlocks&&t.hash&&e.setWithHashAsync(i,t.snippetBlocks,t.hash)}else for(var n of Object.keys(r)){const i=r[n];i.usedBlocks&&i.hash&&e.setWithHashAsync(n,i.snippetBlocks,i.hash)}}).catch(e=>{}):Promise.resolve()},e.resolveLocalizedMarkdown=function(e,t,n){var n=(n||e.fileName||"README")+".md",[e,i,r]=x.Util.normalizeLanguageCode(x.Util.userLanguage()),r=e&&i&&r?t[`_locales/${e}/`+n]||t[`_locales/${r}/`+n]||t[`_locales/${i}/`+n]:t[`_locales/${e}/`+n];return r||t[n]},e.parseAssetJson=T}}(pxt=pxt||{}),function(u){(u.tutorial||(u.tutorial={})).validate=async function(n,e,i){var t,r=function(t){var n=[];if(null!=t){var i=Object.keys(t);for(let e=0;e<i.length;e++){var r=i[e],r={ruleName:r,ruleTurnOn:t[r]};n.push(r)}}return n}(n.tutorialValidationRules);if(0<r.length&&0<e.length){const i=function(t){var n={};for(let e=0;e<t.length;e++)n[t[e]]||(n[t[e]]=0),n[t[e]]=n[t[e]]+1;return n}(e.map(e=>e.type)),{tutorialStepInfo:a,tutorialStep:o}=n,l=(a[o],t=n,await u.BrowserUtils.tutorialInfoDbAsync().then(e=>e.getAsync(t.tutorial,t.tutorialCode).then(e=>null!=e&&e.snippets?Promise.resolve(e.snippets):Promise.resolve(void 0)))),c=function(e,t){var n=e["tutorialStep"],e=e.tutorialStepInfo[n].hintContentMd;let i="";null!=e&&e.replace(/((?!.)\s)+/g,"\n").replace(/``` *(block|blocks)\s*\n([\s\S]*?)\n```/gim,function(e,t,n){return i=`{
${n}
}`,""});n=u.BrowserUtils.getTutorialCodeHash([i]);let r={};return r=null!=t?t[n]:r}(n,l);for(let t=0;t<r.length;t++){let e=r[t];var s=r[t].ruleName;if(r[t].ruleTurnOn)switch(s){case"exact":e=function(t,n,e){e.isStrict=!0;var i=Object.keys(t);let r=[],s=[],a=(null!=n&&(r=Object.keys(n)),i.length>=r.length);i=lf("These are the blocks you seem to be missing:");for(let e=0;e<r.length;e++){var o=r[e];(!t[o]||t[o]<n[o])&&(s.push(o),a=!1)}return e.ruleMessage=i,e.ruleStatus=a,e.blockIds=s,e}(i,c,e);break;case"atleast":e=function(t,e,n){var i=Object.keys(t),r=Object.keys(null!=e?e:{});let s=i.length>=r.length;for(let e=0;e<r.length;e++)if(!t[r[e]]){s=!1;break}return n.ruleStatus=s,n}(i,c,e);break;case"required":e=function(t,e,n){n.isStrict=!0,Object.keys(t);let i=[],r=[],s=(null!=e&&(i=Object.keys(e)),!0);e=lf("You are required to have the following block:");for(let e=0;e<i.length;e++){var a=i[e];t[a]||(r.push(a),s=!1)}return n.ruleMessage=e,n.ruleStatus=s,n.blockIds=r,n}(i,function(e,t){var n=e["tutorialStep"],e=e.tutorialStepInfo[n].requiredBlockMd,n=u.BrowserUtils.getTutorialCodeHash([e]);let i={};return i=null!=t?t[n]:i}(n,l),e)}}}return r}}(pxt=pxt||{}),function(i){{var r=i.pxtc||(i.pxtc={}),e;let n;r.flattenDiagnosticMessageText=function(i,r){if("string"==typeof i)return i;{let e=i,t="",n=0;for(;e;){if(n){t+=r;for(let e=0;e<n;e++)t+="  "}t+=e.messageText,n++,e=e.next}return t}},(e=n=r.ScriptTarget||(r.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",r.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&s(e,t)},r.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(e=e,t>=n.ES5?a(e,l):a(e,u))},r.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],r.keywordTypes=["boolean","number","string"],r.escapeIdentifier=function(e){if(!e)return"_";let t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,e=>i.pxtc.isIdentifierPart(e.charCodeAt(0),i.pxtc.ScriptTarget.ES5)?e:"");return t=t&&i.pxtc.isIdentifierStart(t.charCodeAt(0),i.pxtc.ScriptTarget.ES5)&&-1===r.reservedWords.indexOf(t)?t:"_"+t};const o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],l=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],c=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],u=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function s(e,t){return t>=n.ES5?a(e,o):a(e,c)}function a(i,r){if(!(i<r[0])){let e,t=0,n=r.length;for(;t+1<n;){if(e=t+(n-t)/2,r[e-=e%2]<=i&&i<=r[1+e])return!0;i<r[e]?n=e:t=2+e}}return!1}r.isUnicodeIdentifierStart=s,(e=r.DiagnosticCategory||(r.DiagnosticCategory={}))[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Message=2]="Message"}}(ts=ts||{}),function(s){{var i=s.webBluetooth||(s.webBluetooth={}),e;function t(){return!!navigator&&!!navigator.bluetooth&&"TextDecoder"in window&&s.appTarget.appTheme.bluetoothUartConsole&&s.appTarget.appTheme.bluetoothUartFilters&&0<s.appTarget.appTheme.bluetoothUartFilters.length}function n(){return!!navigator&&!!navigator.bluetooth&&!!s.appTarget.appTheme.bluetoothPartialFlashing}i.isAvailable=function(){return t()||n()},i.hasConsole=t,i.hasPartialFlash=n,i.isValidUUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(e)};class o{constructor(e,t){this.connectionTimeout=2e4,this.connectPromise=void 0,this.id=e,this.aliveToken=t}debug(e){s.debug(this.id+": "+e)}alivePromise(e){return new Promise((t,n)=>{this.aliveToken.isCancelled()&&n(new Error),e.then(e=>t(e),e=>n(e))})}cancelConnect(){this.connectPromise=void 0}createConnectPromise(){return Promise.resolve()}connectAsync(){return this.connectPromise||(this.connectPromise=this.alivePromise(this.createConnectPromise())),s.Util.promiseTimeout(this.connectionTimeout,this.connectPromise,"connection timeout").then(()=>this.aliveToken.throwIfCancelled()).catch(e=>{throw this.connectPromise=void 0,e})}disconnect(){this.cancelConnect()}kill(){this.disconnect(),this.aliveToken.cancel()}}i.BLERemote=o;class l extends o{constructor(e,t,n){super(e,t.aliveToken),this.device=t,this.autoReconnect=n,this.autoReconnectDelay=1e3,this.disconnectOnAutoReconnect=!1,this.reconnectPromise=void 0,this.failedConnectionServicesVersion=-1,this.handleDisconnected=this.handleDisconnected.bind(this),this.device.device.addEventListener("gattserverdisconnected",this.handleDisconnected)}handleDisconnected(e){this.aliveToken.isCancelled()||(this.disconnect(),this.autoReconnect&&!this.reconnectPromise&&(this.reconnectPromise=s.U.delay(this.autoReconnectDelay).then(()=>this.exponentialBackoffConnectAsync(8,500)).finally(()=>this.reconnectPromise=void 0)))}exponentialBackoffConnectAsync(t,n){return this.debug("retry connect"),this.aliveToken.throwIfCancelled(),this.connectAsync().then(()=>{this.aliveToken.throwIfCancelled(),this.debug("reconnect success"),this.reconnectPromise=void 0}).catch(e=>(this.debug("reconnect error "+e.message),this.aliveToken.throwIfCancelled(),this.device.isPaired?this.autoReconnect?0==t?(this.debug("give up, max tries"),void(this.reconnectPromise=void 0)):this.failedConnectionServicesVersion==this.device.servicesVersion?(this.debug("services haven't changed, giving up"),void(this.reconnectPromise=void 0)):(this.debug(`retry connect ${n}ms... (${t} tries left)`),this.device.connected&&(this.failedConnectionServicesVersion=this.device.servicesVersion),this.disconnectOnAutoReconnect&&this.device.disconnect(),s.U.delay(n).then(()=>this.exponentialBackoffConnectAsync(--t,1.8*n))):(this.debug("autoreconnect disabled"),void(this.reconnectPromise=void 0)):(this.debug("give up, device unpaired"),void(this.reconnectPromise=void 0))))}}i.BLEService=l;class c extends l{constructor(e,t,n,i){super(e,t,!0),this.device=t,this.serviceUUID=n,this.txCharacteristicUUID=i,this.handleValueChanged=this.handleValueChanged.bind(this)}createConnectPromise(){return this.debug("connecting"),this.device.connectAsync().then(()=>this.alivePromise(this.device.gatt.getPrimaryService(this.serviceUUID))).then(e=>(this.debug("service connected"),this.service=e,this.alivePromise(this.service.getCharacteristic(this.txCharacteristicUUID)))).then(e=>(this.debug("tx characteristic connected"),this.txCharacteristic=e,this.txCharacteristic.addEventListener("characteristicvaluechanged",this.handleValueChanged),this.txCharacteristic.startNotifications())).then(()=>{s.tickEvent("webble.connected",{id:this.id})})}handlePacket(e){}handleValueChanged(e){e=e.target.value;this.handlePacket(e)}disconnect(){if(super.disconnect(),this.txCharacteristic&&this.device&&this.device.connected)try{this.txCharacteristic.stopNotifications(),this.txCharacteristic.removeEventListener("characteristicvaluechanged",this.handleValueChanged)}catch(e){s.log(this.id+": error "+e.message)}this.service=void 0,this.txCharacteristic=void 0}}i.BLETXService=c;class u extends c{constructor(e){super("hf2",e,u.SERVICE_UUID,u.CHARACTERISTIC_TX_UUID),this.device=e}handlePacket(n){var e=n.getUint8(0);switch(192&e){case u.BLEHF2_FLAG_SERIAL_OUT:case u.BLEHF2_FLAG_SERIAL_ERR:var i=Math.min(n.byteLength-1,-193&e);let t="";for(let e=0;e<i;++e)t+=String.fromCharCode(n.getUint8(e+1));t&&window.postMessage({type:"serial",id:this.device.name||"hf2",data:t},"*")}}}u.SERVICE_UUID="b112f5e6-2679-30da-a26e-0273b6043849",u.CHARACTERISTIC_TX_UUID="b112f5e6-2679-30da-a26e-0273b604384a",u.BLEHF2_FLAG_SERIAL_OUT=128,u.BLEHF2_FLAG_SERIAL_ERR=192,i.HF2Service=u;class d extends c{constructor(e){super("uart",e,d.SERVICE_UUID,d.CHARACTERISTIC_TX_UUID),this.device=e}handlePacket(e){e=(new window.TextDecoder).decode(e);e&&window.postMessage({type:"serial",id:this.device.name||"uart",data:e},"*")}}let r;d.SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",d.CHARACTERISTIC_TX_UUID="6e400002-b5a3-f393-e0a9-e50e24dcca9e",i.UARTService=d,(e=r=r||{})[e.Idle=1]="Idle",e[e.StatusRequested=2]="StatusRequested",e[e.PairingModeRequested=4]="PairingModeRequested",e[e.RegionDALRequested=8]="RegionDALRequested",e[e.RegionMakeCodeRequested=16]="RegionMakeCodeRequested",e[e.Flash=32]="Flash",e[e.EndOfTransmision=64]="EndOfTransmision",e[e.USBFlashRequired=128]="USBFlashRequired";class h extends l{constructor(e){super("partial flashing",e,!1),this.device=e,this.state=r.Idle,this.disconnectOnAutoReconnect=!0,this.handleCharacteristic=this.handleCharacteristic.bind(this)}clearFlashData(){this.version=0,this.mode=0,this.regions=[],this.chunkDelay=h.CHUNK_MIN_DELAY,this.hex=void 0,this.bin=void 0,this.magicOffset=void 0,this.dalHash=void 0,this.makeCodeHash=void 0,this.flashReject=void 0,this.flashResolve=void 0,this.flashOffset=void 0}createConnectPromise(){return this.debug("connecting to partial flash service"),this.device.connectAsync().then(()=>this.alivePromise(this.device.gatt.getPrimaryService(h.SERVICE_UUID))).then(e=>(this.debug("connecting to characteristic"),this.alivePromise(e.getCharacteristic(h.CHARACTERISTIC_UUID)))).then(e=>(this.debug("starting notifications"),this.pfCharacteristic=e,this.pfCharacteristic.startNotifications(),this.pfCharacteristic.addEventListener("characteristicvaluechanged",this.handleCharacteristic),this.state==r.PairingModeRequested?(this.debug("checking pairing mode"),this.autoReconnect=!1,this.pfCharacteristic.writeValue(new Uint8Array([h.STATUS]))):Promise.resolve()))}disconnect(){if(super.disconnect(),this.flashPacketToken&&this.flashPacketToken.cancel(),this.pfCharacteristic&&this.device.connected)try{this.pfCharacteristic.stopNotifications(),this.pfCharacteristic.removeEventListener("characteristicvaluechanged",this.handleCharacteristic)}catch(e){s.log("ble: partial flash disconnect error "+e.message)}this.pfCharacteristic=void 0}findMarker(n,i){if(this.bin)for(;n+i.length<this.bin.length;n+=16){let t=!0;for(let e=0;e<i.length;++e)if(i[e]!=this.bin[n+e]){t=!1;break}if(t)return n}return-1}flashAsync(e){return this.hex?(this.debug("flashing already in progress"),Promise.resolve()):(this.device.pauseLog(),this.createFlashPromise(e).finally(()=>this.device.resumeLogOnDisconnection()))}createFlashPromise(e){if(this.hex)return this.debug("flashing already in progress"),Promise.resolve();this.clearFlashData(),this.hex=e;var e=ts.pxtc.UF2.newBlockFile(),t=(ts.pxtc.UF2.writeHex(e,this.hex.split(/\r?\n/)),s.appTarget.compile.flashUsableEnd),e=(this.bin=ts.pxtc.UF2.toBin(s.U.stringToUint8Array(ts.pxtc.UF2.serializeFile(e)),t).buf,this.debug("bin bytes "+this.bin.length),this.magicOffset=this.findMarker(0,h.MAGIC_MARKER),this.debug("magic block "+this.magicOffset.toString(16)),this.magicOffset<0&&(this.debug("magic block not found, not a valid HEX file"),s.U.userError(lf("Invalid file"))),this.debug("bytes to flash "+(this.bin.length-this.magicOffset)),this.magicOffset+h.MAGIC_MARKER.length);return this.dalHash=s.Util.toHex(this.bin.slice(e,e+8)),this.makeCodeHash=s.Util.toHex(this.bin.slice(e+8,e+16)),this.debug("DAL hash "+this.dalHash),this.debug("MakeCode hash "+this.makeCodeHash),this.connectAsync().then(()=>new Promise((e,t)=>(this.flashResolve=e,this.flashReject=t,this.debug("check service version"),this.state=r.StatusRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.STATUS]))))).then(()=>{},e=>{s.log("pf: error "+e.message),this.clearFlashData()})}checkStateTransition(e,t){return!!(this.state&t)||(this.debug(`flash cmd ${e} in state ${this.state.toString(16)} `),this.flashReject(new Error),this.clearFlashData(),!1)}handleCharacteristic(e){this.aliveToken.isCancelled()&&(this.flashReject(new Error),this.clearFlashData());var t=event.target.value,n=new Uint8Array(t.buffer),i=n[0];if(this.state!=r.Idle)switch(i){case h.STATUS:this.checkStateTransition(i,r.StatusRequested|r.PairingModeRequested)&&(this.version=n[1],this.mode=n[2],this.debug(`flash service version ${this.version} mode `+this.mode),this.debug("reading DAL region"),this.state=r.RegionDALRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.REGION_INFO,h.REGION_DAL])).then(()=>{}));break;case h.REGION_INFO:if(this.checkStateTransition(i,r.RegionDALRequested|r.RegionMakeCodeRequested)){const e=this.regions[n[1]]={start:n[2]<<24|n[3]<<16|n[4]<<8|n[5],end:n[6]<<24|n[7]<<16|n[8]<<8|n[9],hash:s.Util.toHex(n.slice(10))};if(this.debug(`read region ${n[1]} start ${e.start.toString(16)} end ${e.end.toString(16)} hash `+e.hash),n[1]==h.REGION_DAL){if(e.hash!=this.dalHash)return s.tickEvent("webble.flash.DALrequired"),this.debug("DAL hash does not match, partial flashing not possible"),this.state=r.USBFlashRequired,this.flashReject(new Error("USB flashing required")),void this.clearFlashData();this.debug("DAL hash match, reading makecode region"),this.state=r.RegionMakeCodeRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.REGION_INFO,h.REGION_MAKECODE])).then(()=>{})}else if(n[1]==h.REGION_MAKECODE)if(e.start!=this.magicOffset&&(this.debug("magic offset and MakeCode region.start not matching"),s.U.userError(lf("Invalid file"))),e.hash==this.makeCodeHash)s.tickEvent("webble.flash.noop"),this.debug("MakeCode hash matches, same code!"),this.debug("restart application mode"),this.pfCharacteristic.writeValue(new Uint8Array([h.RESET,h.MODE_APPLICATION])).then(()=>{this.state=r.Idle,this.flashResolve(),this.clearFlashData()});else{if(this.mode!=h.MODE_PAIRING)return this.debug("application mode, reset into pairing mode"),this.state=r.PairingModeRequested,this.autoReconnect=!0,void this.pfCharacteristic.writeValue(new Uint8Array([h.RESET,h.MODE_PAIRING])).then(()=>{});this.flashOffset=e.start,this.flashPacketNumber=0,this.debug("starting to flash from address "+this.flashOffset.toString(16)),this.flashNextPacket()}}break;case h.FLASH_DATA:if(this.checkStateTransition(i,r.Flash))switch(n[1]){case h.PACKET_OUT_OF_ORDER:this.debug("packet out of order"),this.flashPacketToken.cancel(),this.flashPacketNumber+=4,this.chunkDelay=Math.min(this.chunkDelay+10,h.CHUNK_MAX_DELAY),this.flashNextPacket();break;case h.PACKET_WRITTEN:this.chunkDelay=Math.max(this.chunkDelay-1,h.CHUNK_MIN_DELAY),this.flashOffset+=64,this.flashPacketNumber+=4,this.flashOffset>=this.bin.length?(this.debug("end transmission"),this.state=r.EndOfTransmision,this.pfCharacteristic.writeValue(new Uint8Array([h.END_OF_TRANSMISSION])).finally(()=>{this.flashResolve&&this.flashResolve(),this.clearFlashData()})):this.flashNextPacket()}break;default:this.debug("unknown message "+s.Util.toHex(n)),this.disconnect()}}flashNextPacket(){this.state=r.Flash,this.flashPacketToken=new s.Util.CancellationToken,this.flashPacketToken.startOperation();const t=this.bin.slice(this.flashOffset,this.flashOffset+64);this.debug(`flashing ${this.flashOffset.toString(16)} / ${this.bin.length.toString(16)} ${(this.flashOffset-this.magicOffset)/(this.bin.length-this.magicOffset)*100>>0}%`);let n=new Uint8Array(20);s.U.delay(this.chunkDelay).then(()=>{this.flashPacketToken.throwIfCancelled(),n[0]=h.FLASH_DATA,n[1]=this.flashOffset>>8&255,n[2]=this.flashOffset>>0&255,n[3]=this.flashPacketNumber;for(let e=0;e<16;e++)n[4+e]=t[e];return this.pfCharacteristic.writeValue(n)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),n[0]=h.FLASH_DATA,n[1]=this.flashOffset>>24&255,n[2]=this.flashOffset>>16&255,n[3]=this.flashPacketNumber+1;for(let e=0;e<16;e++)n[4+e]=t[16+e]||0;return this.pfCharacteristic.writeValue(n)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),n[0]=h.FLASH_DATA,n[1]=0,n[2]=0,n[3]=this.flashPacketNumber+2;for(let e=0;e<16;e++)n[4+e]=t[32+e]||0;return this.pfCharacteristic.writeValue(n)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),n[0]=h.FLASH_DATA,n[1]=0,n[2]=0,n[3]=this.flashPacketNumber+3;for(let e=0;e<16;e++)n[4+e]=t[48+e]||0;return this.pfCharacteristic.writeValue(n)}).then(()=>{const e=this.flashOffset,t=()=>s.U.delay(500).then(()=>{if(e!=this.flashOffset||this.flashPacketToken.isCancelled()||this.aliveToken.isCancelled()||this.state!=r.Flash)return Promise.resolve();this.debug("packet transfer deadlock, force restart"),n[0]=h.FLASH_DATA,n[1]=0,n[2]=0,n[3]=-1;for(let e=0;e<16;e++)n[4+e]=0;return this.pfCharacteristic.writeValue(n).then(()=>t())});t().catch(e=>{this.flashReject&&(this.flashReject(new Error("failed packet transfer")),this.clearFlashData())})}).catch(()=>{this.flashPacketToken.resolveCancel()})}}h.SERVICE_UUID="e97dd91d-251d-470a-a062-fa1922dfa9a8",h.CHARACTERISTIC_UUID="e97d3b10-251d-470a-a062-fa1922dfa9a8",h.REGION_INFO=0,h.FLASH_DATA=1,h.PACKET_OUT_OF_ORDER=170,h.PACKET_WRITTEN=255,h.END_OF_TRANSMISSION=2,h.STATUS=238,h.RESET=255,h.MODE_PAIRING=0,h.MODE_APPLICATION=1,h.REGION_SOFTDEVICE=0,h.REGION_DAL=1,h.REGION_MAKECODE=2,h.MAGIC_MARKER=s.Util.fromHex("708E3B92C615A841C49866C975EE5197"),h.CHUNK_MIN_DELAY=0,h.CHUNK_MAX_DELAY=75,i.PartialFlashingService=h;class p extends o{constructor(e){super("ble",new s.Util.CancellationToken),this.device=void 0,this.services=[],this.pendingResumeLogOnDisconnection=!1,this.servicesVersion=0,this.device=e,this.handleDisconnected=this.handleDisconnected.bind(this),this.handleServiceAdded=this.handleServiceAdded.bind(this),this.handleServiceChanged=this.handleServiceChanged.bind(this),this.handleServiceRemoved=this.handleServiceRemoved.bind(this),this.device.addEventListener("gattserverdisconnected",this.handleDisconnected),this.device.addEventListener("serviceadded",this.handleServiceAdded),this.device.addEventListener("servicechanged",this.handleServiceChanged),this.device.addEventListener("serviceremoved",this.handleServiceRemoved),t()&&(this.services.push(this.uartService=new d(this)),this.services.push(this.hf2Service=new u(this))),n()&&this.services.push(this.partialFlashingService=new h(this)),this.aliveToken.startOperation()}startServices(){this.services.filter(e=>e.autoReconnect).forEach(e=>e.connectAsync().catch(()=>{}))}pauseLog(){this.uartService&&(this.uartService.autoReconnect=!1,this.uartService.disconnect()),this.hf2Service&&(this.hf2Service.autoReconnect=!1,this.hf2Service.disconnect())}resumeLogOnDisconnection(){this.pendingResumeLogOnDisconnection=!0}resumeLog(){this.uartService&&(this.uartService.autoReconnect=!0,this.uartService.connectAsync().catch(()=>{})),this.hf2Service&&(this.hf2Service.autoReconnect=!0,this.hf2Service.connectAsync().catch(()=>{}))}get isPaired(){return this===i.bleDevice}get name(){return this.device.name||"?"}get connected(){return this.device&&this.device.gatt&&this.device.gatt.connected}get gatt(){return this.device.gatt}createConnectPromise(){return this.debug("connecting gatt server"),this.alivePromise(this.device.gatt.connect().then(()=>this.debug("gatt server connected")))}handleServiceAdded(e){this.debug("service added"),this.servicesVersion++}handleServiceRemoved(e){this.debug("service removed"),this.servicesVersion++}handleServiceChanged(e){this.debug("service changed"),this.servicesVersion++}handleDisconnected(e){this.debug("disconnected"),this.disconnect(),this.pendingResumeLogOnDisconnection&&(this.pendingResumeLogOnDisconnection=!1,s.U.delay(500).then(()=>this.resumeLog()))}disconnect(){if(super.disconnect(),this.services.forEach(e=>e.disconnect()),this.connected){this.debug("disconnect");try{this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect()}catch(e){this.debug("gatt disconnect error "+e.message)}}}}function a(){if(i.bleDevice)return Promise.resolve();s.log("ble: requesting device");var e=[];return t()&&(e.push(d.SERVICE_UUID),e.push(u.SERVICE_UUID)),n()&&e.push(h.SERVICE_UUID),navigator.bluetooth.requestDevice({filters:s.appTarget.appTheme.bluetoothUartFilters,optionalServices:e}).then(e=>(s.log("ble: received device "+e.name),i.bleDevice=new p(e),i.bleDevice.startServices(),i.bleDevice.connectAsync()))}i.BLEDevice=p,i.bleDevice=void 0,i.isPaired=function(){return!!i.bleDevice},i.pairAsync=function(){return i.bleDevice&&(i.bleDevice.kill(),i.bleDevice=void 0),a().catch(e=>{i.bleDevice&&i.bleDevice.aliveToken&&i.bleDevice.aliveToken.resolveCancel(),s.log("ble: error "+e.message)})},i.flashAsync=function(e,t){s.tickEvent("webble.flash");const n=e.outfiles[ts.pxtc.BINARY_HEX];return a().then(()=>i.bleDevice.partialFlashingService.flashAsync(n)).then(()=>s.tickEvent("webble.flash.success")).catch(e=>{throw s.tickEvent("webble.fail.fail",{message:e.message}),e})}}}(pxt=pxt||{}),function(r){{var s=r.usb||(r.usb={});class l extends Error{constructor(e){super(e),this.message=e}}s.USBError=l,s.filters=[{classCode:255,subclassCode:42}];let e,i,t=!0;s.setFilters=function(e){t=!1,s.filters=e};class c{constructor(){this.ready=!1,this.connecting=!1,this.readLoopStarted=!1,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onError=e=>{},this.onEvent=e=>{},this.enabled=!1,this.handleUSBConnected=this.handleUSBConnected.bind(this),this.handleUSBDisconnected=this.handleUSBDisconnected.bind(this)}enable(){this.enabled||(this.enabled=!0,this.log("registering webusb events"),navigator.usb.addEventListener("disconnect",this.handleUSBDisconnected,!1),navigator.usb.addEventListener("connect",this.handleUSBConnected,!1))}disable(){this.enabled&&(this.enabled=!1,this.log("unregistering webusb events"),navigator.usb.removeEventListener("disconnect",this.handleUSBDisconnected),navigator.usb.removeEventListener("connect",this.handleUSBConnected))}disposeAsync(){return this.disable(),Promise.resolve()}handleUSBDisconnected(e){this.log("device disconnected"),e.device==this.dev&&(this.log("clear device"),this.clearDev(),this.onDeviceConnectionChanged)&&this.onDeviceConnectionChanged(!1)}handleUSBConnected(e){e=e.device;this.log("device connected "+e.serialNumber),this.dev||this.connecting||(this.log("attach device"),this.onDeviceConnectionChanged&&this.onDeviceConnectionChanged(!0))}clearDev(){this.dev&&(this.dev=null,this.epIn=null,this.epOut=null,this.onConnectionChanged)&&this.onConnectionChanged()}error(e){throw new l(r.U.lf("USB error on device {0} ({1})",this.dev.productName,e))}log(e){r.debug("webusb: "+e)}disconnectAsync(){return this.ready=!1,this.dev?(this.log("close device"),this.dev.close().catch(e=>{}).then(()=>(this.clearDev(),r.U.delay(500)))):Promise.resolve()}reconnectAsync(){return this.log("reconnect"),this.setConnecting(!0),this.disconnectAsync().then(n).then(e=>this.connectAsync(e)).finally(()=>this.setConnecting(!1))}setConnecting(e){e!=this.connecting&&(this.connecting=e,this.onConnectionChanged)&&this.onConnectionChanged()}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.ready}async connectAsync(t){if(this.log(`trying to connect (${t.length} devices)`),0==t.length){const r=new Error("Device not found.");throw r.type="devicenotfound",r}this.setConnecting(!0);try{var e;this.lastKnownDeviceSerialNumber&&((e=t.find(e=>e.serialNumber===this.lastKnownDeviceSerialNumber))?(this.log("last known device spotted"),t.splice(t.indexOf(e),1),t.unshift(e)):(this.log("delay for last known device"),await r.U.delay(2e3)));for(let e=0;e<t.length;++e){var n=t[e];this.dev=n,this.log(`connect device: ${n.manufacturerName} `+n.productName),this.log(`serial number: ${n.serialNumber} ${this.lastKnownDeviceSerialNumber===n.serialNumber?"(last known device)":""} `);try{return void await this.initAsync()}catch(e){this.dev=void 0,this.log("connection failed, "+e.message)}}var i=new Error(r.U.lf("Device in use or not found."));throw i.type="devicelocked",i}finally{this.setConnecting(!1)}}sendPacketAsync(e){return this.dev?(r.Util.assert(e.length<=64),this.epOut?this.dev.transferOut(this.epOut.endpointNumber,e).then(e=>{"ok"!=e.status&&this.error("USB OUT transfer failed")}):this.dev.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.iface.interfaceNumber},e).then(e=>{"ok"!=e.status&&this.error("USB CTRL OUT transfer failed")})):Promise.reject(new Error("Disconnected"))}readLoop(){if(!this.readLoopStarted){this.readLoopStarted=!0,this.log("start read loop");let t=()=>{this.ready?this.recvPacketAsync().then(e=>{e[0]?(this.onData(e),t()):r.U.delay(500).then(t)},e=>{this.dev&&this.onError(e),r.U.delay(300).then(t)}):r.U.delay(300).then(t)};t()}}recvPacketAsync(){var e=e=>{"ok"!=e.status&&this.error("USB IN transfer failed");e=new Uint8Array(e.data.buffer);return 0==e.length?this.recvPacketAsync():e};return this.dev?(this.epIn?this.dev.transferIn(this.epIn.endpointNumber,64):this.dev.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.iface.interfaceNumber},64)).then(e):Promise.reject(new Error("Disconnected"))}initAsync(){if(!this.dev)return Promise.reject(new Error("Disconnected"));let n=this.dev;return this.log("open device"),n.open().then(()=>(this.log("select configuration"),n.selectConfiguration(1))).then(()=>{this.log("got "+n.configurations[0].interfaces.length+" interfaces");var e=n.configurations[0].interfaces.filter(e=>{var t,n=e.alternates[0];for(t of s.filters)if((null==t.classCode||n.interfaceClass===t.classCode)&&!(null!=t.subclassCode&&n.interfaceSubclass!==t.subclassCode||null!=t.protocolCode&&n.interfaceProtocol!==t.protocolCode)){if(0==n.endpoints.length)return!0;if(2==n.endpoints.length&&n.endpoints.every(e=>64==e.packetSize))return!0}return!1}),t=e[e.length-1];return this.log(e.length+" matching interfaces; picking "+(t?"#"+t.interfaceNumber:"n/a")),t||this.error("cannot find supported USB interface"),this.altIface=t.alternates[0],this.iface=t,this.altIface.endpoints.length?(this.log("using dedicated endpoints"),this.epIn=this.altIface.endpoints.filter(e=>"in"==e.direction)[0],this.epOut=this.altIface.endpoints.filter(e=>"out"==e.direction)[0],r.Util.assert(64==this.epIn.packetSize),r.Util.assert(64==this.epOut.packetSize)):this.log("using ctrl pipe"),this.log("claim interface"),n.claimInterface(t.interfaceNumber)}).then(()=>{this.log("device ready"),this.lastKnownDeviceSerialNumber=this.dev.serialNumber,this.ready=!0,t&&this.readLoop(),this.onConnectionChanged&&this.onConnectionChanged()})}}async function n(){r.log("webusb: get devices");try{return await navigator.usb.getDevices()||[]}catch(e){return r.reportException(e),[]}}async function a(){var e;if(void 0===i)if(r.debug("webusb: checking availability"),null!=(t=null==(e=r.appTarget)?void 0:e.compile)&&t.webUSB)if(r.BrowserUtils.isElectron()||r.BrowserUtils.isWinRT())r.debug("webusb: off, electron or winrt"),r.tickEvent("webusb.off",{reason:"electronwinrt"}),i=!1;else{var t=navigator.usb;if(t){var n=/Windows NT (\d+\.\d+)/.exec(navigator.userAgent);if(n&&parseFloat(n[1])<6.3)r.debug("webusb: off, older windows version"),r.tickEvent("webusb.off",{reason:"oldwindows"}),i=!1;else{try{await t.getDevices()}catch(e){return r.debug("webusb: off, security exception"),r.tickEvent("webusb.off",{reason:"security"}),void(i=!1)}i=!0}}else r.debug("webusb: off, not impl"),r.tickEvent("webusb.off",{reason:"notimpl"}),i=!1}else i=!1}function o(){return void 0===i&&(console.error("checkAvailableAsync not called"),a()),!!i}s.pairAsync=function(){return navigator.usb.requestDevice({filters:s.filters}).then(e=>!!e).catch(e=>{if("NotFoundError"!=e.name)throw e})},s.mkWebUSBHIDPacketIOAsync=function(){return r.debug("packetio: mk webusb io"),(e=e||new c).enable(),Promise.resolve(e)},s.isEnabled=!1,s.setEnabled=function(e){o()||(e=!1),s.isEnabled=e},s.checkAvailableAsync=a,s.isAvailable=o}}(pxt=pxt||{}),function(s){{var e=s.worker||(s.worker={}),i=s.Util;let n={};function a(s){let a={},o=0,e=new i.PromiseQueue,t=new Promise((e,t)=>{a.ready=e});return e.enqueue("main",()=>t),{opAsync:function(i,r){return e.enqueue("main",()=>new Promise((t,n)=>{var e=""+o++;a[e]=e=>{e?e.errorMessage?n(new Error(e.errorMessage)):t(e):n(new Error("no response"))},s({id:e,op:i,arg:r})}))},recvHandler:e=>{var t;a.hasOwnProperty(e.id)&&(t=a[e.id],delete a[e.id],t(e.result))}}}function r(e){let t=new Worker(e),n=a(e=>t.postMessage(e));return t.onmessage=e=>{s.perf.measureStart("webworker recvHandler"),n.recvHandler(e.data),s.perf.measureEnd("webworker recvHandler")},n}e.getWorker=function(e){let t=n[e];return t=t||(n[e]=r(e))},e.wrap=a,e.makeWebWorker=r,e.makeWebSocket=function(e,t=null){let n=new WebSocket(e),i=[],r=a(e=>{e=JSON.stringify(e);i?i.push(e):n.send(e)});return n.onmessage=e=>{e=JSON.parse(e.data);t&&null==e.id?t(e):r.recvHandler(e)},n.onopen=e=>{s.debug("socket opened");for(var t of i)n.send(t);i=null},n.onclose=e=>{s.debug("socket closed")},n.onerror=e=>{s.debug("socket errored")},r}}}(pxt=pxt||{}),function(s){function a(){o.apiKey||s.U.userError("YouTube API key missing")}var o;(o=s.youtube||(s.youtube={})).apiKey=void 0,o.playlistItemToCodeCard=function(e){return{name:e.snippet.title.replace(/[^-]*-/,"").trim(),description:e.snippet.description.split(/\n\s+/,1)[0].trim(),youTubeId:e.snippet.resourceId.videoId,youTubePlaylistId:e.snippet.playlistId,imageUrl:(e=e.snippet.thumbnails)&&(null==(e=e.medium||e.high||e.standard||e.default)?void 0:e.url)||""}},o.playlistInfoAsync=function(e){a();e=`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${e}&key=`+o.apiKey;return s.Util.httpGetJsonAsync(e).then(e=>e.items[0])},o.listPlaylistVideosAsync=async function(t){a();let n,i=[];do{let e=`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${t}&key=`+o.apiKey;n&&(e+="&pageToken="+n);var r=await s.Util.httpGetJsonAsync(e);i=i.concat(r.items),n=r.nextPageToken}while(n);return s.options.debug&&s.debug(JSON.stringify(i,null,2)),i},o.watchUrl=function(e,t){let n;return e?(n="https://www.youtube.com/watch?v="+e,t&&(n+="&list="+t)):t&&(n="https://www.youtube.com/playlist?list="+t),n}}(pxt=pxt||{}),function(e){var m=e.pxtc||(e.pxtc={});{var g=m.assembler||(m.assembler={});function b(e,...n){return e.replace(/{(\d+)}/g,(e,t)=>n[+t])}g.debug=!1,g.lf=b;let e=f("opcode name doesn't match","<name>");class r{constructor(e,t,n,i,r){this.opcode=n,this.mask=i,this.is32bit=r,this.canBeShared=!1,m.assert((n&i)==n),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,e=>this.ei.encoders[e]?this.ei.encoders[e].pretty:e);r=o(t);this.name=r[0],this.args=r.slice(1)}emit(r){var s=r.words;if(s[0]!=this.name)return e;let a=this.opcode,o=1,l=0,c=[],u=null,d=null,h=null;for(let e=0;e<this.args.length;++e){let n=this.args[e],i=s[o++];if("$"==n[0]){let e=this.ei.encoders[n],t=null;if(e.isRegister){if(null==(t=this.ei.registerNo(i)))return f("expecting register name",i);this.ei.isPush(this.opcode)?l++:this.ei.isPop(this.opcode)&&l--}else if(e.isImmediate){if(i=i.replace(/^#/,""),null==(t=r.bin.parseOneInt(i)))return f("expecting number",i);this.ei.isAddSP(this.opcode)?l=-t/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(l=t/this.ei.wordSize())}else if(e.isRegList){if("{"!=i)return f("expecting {",i);for(t=0;"}"!=s[o];){if(!(i=s[o++]))return f("expecting }",s[o-2]);var p=this.ei.registerNo(i);if(null==p)return f("expecting register name",i);if(t&1<<p)return f("duplicate register name",i);t|=1<<p,this.ei.isPush(this.opcode)?l++:this.ei.isPop(this.opcode)&&l--,","==s[o]&&o++}i=s[o++]}else if(e.isLabel){if(i=i.replace(/^#/,""),/^[+-]?\d+$/.test(i))t=parseInt(i,10),u="rel"+t;else if(/^0x[0-9a-fA-F]+$/.test(i))t=parseInt(i,16),u="abs"+t;else if(u=i,null==(t=this.ei.getAddressFromLabel(r.bin,this,i,e.isWordAligned))){if(r.bin.finalEmit)return f("unknown label",i);t=8}if(this.ei.is32bit(this)){d=t,h=i;continue}}else m.oops();if(null==t)return f("didn't understand it",i);if(c.push(t),null==(t=e.encode(t)))return f("argument out of range or mis-aligned",i);m.assert(0==(a&t)),a|=t}else if(n!=i)return f("expecting "+n,i)}return s[o]?f("trailing tokens",s[o]):this.ei.is32bit(this)?this.ei.emit32(a,d,r.bin.normalizeExternalLabel(h)):{stack:l,opcode:a,numArgs:c,labelName:r.bin.normalizeExternalLabel(u)}}toString(){return this.friendlyFmt}}g.Instruction=r;class l{constructor(e,t){this.bin=e,this.text=t}getOpExt(){return this.instruction?this.instruction.code:""}getOp(){return this.instruction?this.instruction.name:""}update(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),this.text=(e="    "+e)+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=o(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")}}g.Line=l;class a{constructor(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=e=>e,this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.equs={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}emitShort(e){m.assert(0<=e&&e<=65535),this.buf.push(e)}emitOpCode(e){this.emitShort(e)}location(){return 2*this.buf.length}pc(){return this.location()+this.baseOffset}parseOneInt(e){if(!e)return null;if(/^\d+$/.test(e))return parseInt(e,10);var t=e.indexOf("-");if(0<t)return this.parseOneInt(e.slice(0,t))-this.parseOneInt(e.slice(t+1));let n=1;if(0<=e.indexOf("*"))for(var i;i=/^([^\*]*)\*(.*)$/.exec(e);){var r=this.parseOneInt(i[1]);if(null==r)return null;n*=r,e=i[2]}if("-"==e[0]?(n*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),/^\d+$/.test(e))return n*parseInt(e,10);if(m.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(m.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(m.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;var s,t=/(.*)>>(\d+)$/.exec(e);if(t)return s=this.parseOneInt(t[1]),(s&=~(-16777216&this.baseOffset))>>parseInt(t[2]);let a=null;return"0"==e[0]&&("x"==e[1]||"X"==e[1]?(s=/^0x([a-f0-9]+)$/i.exec(e))&&(a=parseInt(s[1],16)):"b"!=e[1]&&"B"!=e[1]||(t=/^0b([01]+)$/i.exec(e))&&(a=parseInt(t[1],2))),0<=e.indexOf("@")&&((s=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=n&&this.directiveError(b("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(s[1])?a=this.ei.wordSize()*this.ei.computeStackOffset(s[1],this.stack-this.stackpointers[s[1]]+parseInt(s[2])):this.directiveError(b("saved stack not found"))),s=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(s[1])&&null!=(a=this.lookupLabel(s[1],!0))&&("fn"==s[2]?a=this.ei.toFnPtr(a,this.baseOffset,s[1]):0<=(a>>=1)&&a<=65535?"hi"==s[2]?a=a>>8&255:"lo"==s[2]?a&=255:m.oops():(this.directiveError(b("@hi/lo out of range")),a=null)),null==a&&this.looksLikeLabel(e)&&null!=(a=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(a+=this.baseOffset),null==a||isNaN(a)?null:a*n}looksLikeLabel(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)}scopedName(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e}lookupLabel(e,t=!1){let n=null,i=this.scopedName(e);return this.labels.hasOwnProperty(i)?(n=this.labels[i],n=this.ei.postProcessRelAddress(this,n)):this.lookupExternalLabel&&null!=(n=this.lookupExternalLabel(e))&&(n=this.ei.postProcessAbsAddress(this,n)),null==(n=null==n&&this.equs.hasOwnProperty(i)?this.equs[i]:n)&&t&&(this.finalEmit?this.directiveError(b("unknown label: {0}",e)):n=11111),n}align(e){for(m.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)}pushError(e,t=""){e={scope:this.scope,message:b("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(e),this.throwOnError)throw new Error(e.message)}directiveError(e){this.pushError(e)}emitString(e,t=!1){function n(e,t){return 255&(e.charCodeAt(t)||0)}let i,r=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(r&&null!=(i=function(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,(e,t)=>t).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,(e,t)=>"\\u00"+t).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}(r[2])))if(this.align(2),t)for(let e=0;e<i.length;e++)this.emitShort(i.charCodeAt(e));else for(let e=0;e<i.length+1;e+=2)this.emitShort(n(i,e+1)<<8|n(i,e));else this.directiveError(b("expecting string"))}parseNumber(e){e=this.parseOneInt(e.shift());return null==e?null:e}parseNumbers(e){e=e.slice(1);for(var t=[];;){var n=this.parseNumber(e);if(null==n){this.directiveError(b("cannot parse number at '{0}'",e[0]));break}if(t.push(n),","!=e[0]){if(null==e[0])break;this.directiveError(b("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t}emitSpace(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(b("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(b("only even space supported"));else{var n=255&t[1];n|=n<<8;for(let e=0;e<t[0];e+=2)this.emitShort(n)}}emitBytes(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(let e=0;e<t.length;e+=2){var n=t[e],i=t[e+1];0<=n&&i<=255&&0<=i&&n<=255?this.emitShort(255&n|(255&i)<<8):this.directiveError(b("expecting uint8"))}}emitHex(e){e.slice(1).forEach(t=>{if(","!=t)if(t.length%4!=0)this.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(t))for(let e=0;e<t.length;e+=4){var n=parseInt(t.slice(e,e+4),16);this.emitShort((255&n)<<8|n>>8&255)}else this.directiveError(".hex needs a hex number")})}handleDirective(e){let t,n=e.words,i=()=>{2!=n.length&&this.directiveError(b("expecting one argument"))};switch(n[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".utf16":this.emitString(e.text,!0);break;case".align":if(i(),null!=(t=this.parseOneInt(n[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(b("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(b("expecting number"));break;case".balign":if(i(),null!=(t=this.parseOneInt(n[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(b("expecting 2, 4, 8, or 16"))}else this.directiveError(b("expecting number"));break;case".p2align":i(),null!=(t=this.parseOneInt(n[1]))?this.align(1<<t):this.directiveError(b("expecting number"));break;case".byte":this.emitBytes(n);break;case".hex":this.emitHex(n);break;case".hword":case".short":case".2bytes":this.parseNumbers(n).forEach(e=>{-32768<=e&&e<=65535?this.emitShort(65535&e):this.directiveError(b("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(n).forEach(e=>{-2147483648<=e&&e<=4294967295?(this.emitShort(65535&e),this.emitShort(e>>16&65535)):this.directiveError(b("expecting int32"))});break;case".skip":case".space":this.emitSpace(n);break;case".set":case".equ":/^\w+$/.test(n[1])||this.directiveError(b("expecting name"));var r=this.parseNumbers(n.slice(","==n[2]||"="==n[2]?2:1));1!=r.length&&this.directiveError(b("expecting one value")),void 0!==this.equs[n[1]]&&this.equs[n[1]]!=r[0]&&this.directiveError(b("redefinition of {0}",n[1])),this.equs[n[1]]=r[0];break;case".startaddr":this.location()&&this.directiveError(b(".startaddr can be only be specified at the beginning of the file")),i(),this.baseOffset=this.parseOneInt(n[1]);break;case"@stackmark":i(),this.stackpointers[n[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[n[1]]?this.directiveError(b("no such saved stack")):this.stackpointers[n[1]]!=this.stack&&this.directiveError(b("stack mismatch")));break;case"@scope":this.scope=n[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":i(),this.stack+=this.parseOneInt(n[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":(n=n.filter(e=>","!=e)).shift();var r=this.parseOneInt(n[1]),s=n[2]?this.parseOneInt(n[2]):4;if(null==this.lookupLabel(n[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr)||this.directiveError(b("PXT_COMM_BASE not defined"));this.commPtr&s-1;)this.commPtr++;this.labels[this.scopedName(n[0])]=this.commPtr-this.baseOffset,this.commPtr+=r}break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(n[0])||this.directiveError(b("unknown directive"))}}handleOneInstruction(e,t){var n=t.emit(e);return!n.error&&(this.stack+=n.stack,this.checkStack&&this.stack<0&&this.pushError(b("stack underflow")),e.location=this.location(),e.opcode=n.opcode,e.stack=n.stack,this.emitOpCode(n.opcode),null!=n.opcode2&&this.emitOpCode(n.opcode2),null!=n.opcode3&&this.emitOpCode(n.opcode3),e.instruction=t,e.numArgs=n.numArgs,!0)}handleInstruction(i){if(!i.instruction||!this.handleOneInstruction(i,i.instruction)){var r=e=>this.ei.instructions.hasOwnProperty(e)?this.ei.instructions[e]:[];if(!i.instruction){var s=r(i.words[0]);for(let e=0;e<s.length;++e)if(this.handleOneInstruction(i,s[e]))return}let e=i.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),n="",t=r(e).concat(r(e+"s"));0<t.length&&t.forEach(e=>{var t=e.emit(i);n+=b("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(b("assembly error"),n)}}buildLine(e,t){let n=e=>{e=new l(this,e);return e.scope=this.scope,e.lineNo=this.currLineNo,t.push(e),e},i=n(e),r=o(i.text)||[],s=(i.words=r)[0]||"";if(":"==s.charAt(s.length-1)){var a=/^([\.\w]+):$/.exec(r[0]);if(a){if(i.type="label",i.text=a[1]+":",i.words=[a[1]],!(1<r.length))return;r.shift(),(i=n(e.replace(/^[^:]*:/,""))).words=r,s=r[0]||""}}a=s.charAt(0);"."==a||"@"==a?(i.type="directive","@scope"==i.words[0]&&this.handleDirective(i)):0==i.words.length?i.type="empty":i.type="instruction"}prepLines(e){this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(e=>{10<this.errors.length||(this.currLineNo++,this.realCurrLineNo++,this.buildLine(e,this.lines))})}iterLines(){this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(e=>{var t,n;10<this.errors.length||0==(this.currLine=e).words.length||("label"==e.type?(t=this.scopedName(e.words[0]),this.prevLabel=t,this.finalEmit?(null!=this.equs[t]&&this.directiveError(b(".equ redefined as label")),null==(n=this.labels[t])&&m.oops(),0==this.errors.length&&n!=this.location()&&m.oops(`invalid location: ${this.location()} != ${n} at `+t),m.assert(0<this.errors.length||n==this.location()),this.reallyFinalEmit&&(this.stackAtLabel[t]=this.stack)):this.labels.hasOwnProperty(t)?this.directiveError(b("label redefinition")):this.inlineMode&&/^_/.test(t)?this.directiveError(b("labels starting with '_' are reserved for the compiler")):this.labels[t]=this.location(),e.location=this.location()):"directive"==e.type?this.handleDirective(e):"instruction"==e.type?this.handleInstruction(e):"empty"!=e.type&&m.oops())})}getSource(i,e=1,t=0){let n=0,r=e=>{var e=this.labels[e]||n,t=e-n;return n=e,t},s=this.buf?this.location():0,a=r("_code_end"),o=r("_helpers_end"),l=r("_vtables_end"),c=r("_literals_end"),u=n,d=s+this.baseOffset&16777215,h=(t&&t<d&&m.U.userError(b("program too big by {0} bytes!",d-t)),b("; total bytes: {0} ({1}% of {2}k flash with {3} free)",d,(100*d/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-d)),p=b("; generated code sizes (bytes): {0} (incl. {1} user, {2} helpers, {3} vtables, {4} lits); src size {5}\n",u,a,o,l,c,s-u)+b("; assembly: {0} lines; density: {1} bytes/stmt; ({2} stmts)\n",this.lines.length,Math.round(100*a/e)/100,e)+h+"\n"+this.stats+"\n\n",f=!1;return this.lines.forEach((t,n)=>{if("_stored_program"==t.words[0])p+='_stored_program: .string "..."\n',f=!0;else if(f)f=!1;else{let e=t.text;if(i){if("@stackempty"==t.words[0]&&this.lines[n-1].text==t.text)return;if(!(e=e.replace(/; WAS: .*/,"")).trim())return}!g.debug||"label"!=t.type&&"instruction"!=t.type||(e+=` 	; 0x`+(t.location+this.baseOffset).toString(16)),p+=e+"\n"}}),p}peepHole(){var t=this.lines.filter(e=>"empty"!=e.type);for(let e=0;e<t.length;++e){var n,i,r=t[e];/^user/.test(r.scope)||(n=t[e+1])&&(i=t[e+2],"instruction"==r.type)&&this.ei.peephole(r,n,i)}}clearLabels(){this.labels={},this.commPtr=0}peepPass(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),m.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=b("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))}getLabels(){return this.userLabelsCache||(this.userLabelsCache=m.U.mapMap(this.labels,(e,t)=>t+this.baseOffset)),this.userLabelsCache}emit(e){if(m.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(b("stack misaligned at the end of the file")),0<this.errors.length)||(this.ei.expandLdlit(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length))){for(let e=0;e<5&&(pxt.debug("Peephole OPT, pass "+e),this.peepPass(5==e),0!=this.peepOps);++e);pxt.debug("emit done")}}}function o(t){let n=[],i="";e:for(let e=0;e<t.length;++e)switch(t[e]){case"[":case"]":case"!":case"{":case"}":case",":i&&(n.push(i),i=""),n.push(t[e]);break;case" ":case"\t":case"\r":case"\n":i&&(n.push(i),i="");break;case";":break e;default:i+=t[e]}return i&&(n.push(i),i=""),n[0]?n:null}function f(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function s(e){return(e<0||65535<e?"0x"+e.toString(16):"0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}g.File=a,g.VMFile=class extends a{constructor(e){super(e)}},g.AbstractProcessor=class{constructor(){this.file=null,this.addEnc=(e,t,n)=>{t={name:e,pretty:t,encode:n,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return this.encoders[e]=t},this.inrange=(e,t,n)=>Math.floor(t)!=t||t<0||e<t?null:n,this.inminmax=(e,t,n,i)=>Math.floor(n)!=n||n<e||t<n?null:i,this.inseq=(e,t)=>{e=e.indexOf(t);return e<0?null:e},this.inrangeSigned=(e,t,n)=>Math.floor(t)!=t||(t<-(e+1)||e<t)?null:n&(e<<1|1),this.addInst=(e,t,n,i)=>{e=new r(this,e,t,n,i);return this.instructions.hasOwnProperty(e.name)||(this.instructions[e.name]=[]),this.instructions[e.name].push(e),e},this.encoders={},this.instructions={}}toFnPtr(e,t,n){return e}wordSize(){return-1}computeStackOffset(e,t){return t}is32bit(e){return!1}emit32(e,t,n){return null}postProcessRelAddress(e,t){return t}postProcessAbsAddress(e,t){return t}peephole(e,t,n){}registerNo(e){return null}getAddressFromLabel(e,t,n,i=0){return null}isPop(e){return!1}isPush(e){return!1}isAddSP(e){return!1}isSubSP(e){return!1}testAssembler(){m.assert(!1)}expandLdlit(e){}},g.emitErr=f,g.expectError=function(e,t){e=new a(e);e.emit(t),0==e.errors.length&&m.oops("ASMTEST: expecting error for: "+t)},g.tohex=s,g.expect=function(e,t){let n=[],i=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,(e,t)=>(n.push(parseInt(t.slice(0,4),16)),8==t.length&&n.push(parseInt(t.slice(4,8),16)),"")),r=new a(e);r.throwOnError=!0,r.disablePeepHole=!0,r.emit(i),0<r.errors.length&&(console.debug(r.errors[0].message),m.oops("ASMTEST: not expecting errors")),r.buf.length!=n.length&&m.oops("ASMTEST: wrong buf len");for(let e=0;e<n.length;++e)r.buf[e]!=n[e]&&m.oops("ASMTEST: wrong buf content at "+e+" , exp:"+s(n[e])+", got: "+s(r.buf[e]))}}}(ts=ts||{}),function(o){{var i=o.Cloud||(o.Cloud={}),r=pxtc.Util;i.apiRoot=o.BrowserUtils.isLocalHost()||r.isNodeJS?"https://www.makecode.com/api/":"/api/",i.accessToken="";let n=!(i.localToken="");function s(e){let t=new Error(r.lf("Cannot access {0} while offline",e));return t.isOffline=!0,o.U.delay(1e3).then(()=>Promise.reject(t))}function l(e,t){return o.U.requestAsync({url:"/api/"+e,headers:{Authorization:i.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function c(){return o.webConfig&&!o.webConfig.isStatic&&!o.BrowserUtils.isLocalHost()&&!!o.webConfig.cdnUrl}function e(e){var t;return e=e.replace(/^\//,""),c()?(t=(t=new Date).getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2),e.indexOf("?")<0?e+="?":e+="&",o.webConfig.cdnUrl+"/api/"+(e+="cdn="+t)):i.apiRoot+e}function u(t){return c()?(t.url=e(t.url),r.requestAsync(t).catch(e=>a(t,e))):d(t)}function a(e,t){return 0==t.statusCode?(n&&(n=!1,i.onOffline()),s(e.url)):Promise.reject(t)}function d(t){var e;return t.url=null!=(e=o.webConfig)&&e.isStatic&&!t.forceLiveEndpoint?o.webConfig.relprefix+t.url:i.apiRoot+t.url,t.allowGzipPost=!0,i.isOnline()||o.BrowserUtils.isPxtElectron()?(t.headers||(t.headers={}),o.BrowserUtils.isLocalHost()?i.localToken&&(t.headers.Authorization=i.localToken):i.accessToken&&(t.headers["x-td-access-token"]=i.accessToken),r.requestAsync(t).catch(e=>a(t,e))):s(t.url)}function t(){return navigator&&navigator.onLine}i.onOffline=()=>{},i.hasAccessToken=function(){return!!i.accessToken},i.localRequestAsync=l,i.useCdnApi=c,i.cdnApiUrl=e,i.apiRequestWithCdnAsync=u,i.privateRequestAsync=d,i.privateGetTextAsync=function(e,t){return d({url:e,headers:t}).then(e=>e.text)},i.privateGetAsync=function(e,t=!1){return d({url:e,forceLiveEndpoint:t}).then(e=>e.json)},i.downloadTargetConfigAsync=function(){var e;return i.isOnline()?(e=o.appTarget.versions&&o.appTarget.versions.target,e=o.webConfig&&o.webConfig.isStatic?"targetconfig.json":`config/${o.appTarget.id}/targetconfig`+(e?"/v"+e:""),o.BrowserUtils.isLocalHost()?l(e).then(e=>e?e.json:void 0):u({url:e}).then(e=>e.json)):Promise.resolve(void 0)},i.downloadScriptFilesAsync=function(e){return d({url:e+"/text",forceLiveEndpoint:!0}).then(e=>JSON.parse(e.text))},i.markdownAsync=async function(t,n){var e=o.BrowserUtils.isLocalHostDev()?0:36e5,i=24*e*7;n=n||o.Util.userLanguage();const r=await o.BrowserUtils.translationDbAsync(),s=await r.getAsync(n,t,""),a=async()=>{try{var e=await function(e,t,n){var i=null==(i=o.webConfig)?void 0:i.isStatic,r=o.appTarget.versions&&o.appTarget.versions.target||"?";let s;if(i){s=e;const o=/\/?docs\//.test(s),t=/\.\w+$/.test(s);if(!o){const o="/"===s[0];s="docs"+(o?"":"/")+s}t||(s+=".md")}else s=`md/${o.appTarget.id}/${e.replace(/^\//,"")}?targetVersion=`+encodeURIComponent(r);if("en"!=t&&(s+=`${i?"?":"&"}lang=`+encodeURIComponent(t)),o.BrowserUtils.isLocalHost()&&!o.Util.liveLocalizationEnabled())return l(s).then(e=>404==e.statusCode?d({url:s,method:"GET"}).then(e=>({md:e.text,etag:e.headers.etag})):{md:e.text,etag:void 0});{const o=n&&!c()?{"If-None-Match":n}:void 0;return u({url:s,method:"GET",headers:o}).then(e=>({md:e.text,etag:e.headers.etag}))}}(t,n,null==s?void 0:s.etag);return(!s||e.md&&s.md!==e.md?(await r.setAsync(n,t,"",e.etag,void 0,e.md),e):s).md}catch(e){return""}};if(s){const t=Date.now()-s.time,n=t>e;if(t>i)o.tickEvent("markdown.update.wait");else if(n&&(o.tickEvent("markdown.update.background"),a()),s.md)return s.md}return a()},i.privateDeleteAsync=function(e){return d({url:e,method:"DELETE"}).then(e=>e.json)},i.privatePostAsync=function(e,t,n=!1){return d({url:e,data:t||{},forceLiveEndpoint:n}).then(e=>e.json)},i.isLoggedIn=function(){return!!i.accessToken},i.isNavigatorOnline=t,i.isOnline=function(){return n="undefined"!=typeof navigator&&t()?!0:n},i.getServiceUrl=function(){return i.apiRoot.replace(/\/api\/$/,"")},i.getUserId=function(){var e=/^0(\w+)\./.exec(i.accessToken);return e?e[1]:null},i.parseScriptId=function(t){var n=o.appTarget;if(t&&n.appTheme&&n.cloud&&n.cloud.sharing){let e=["makecode.com"];n.appTheme.embedUrl&&e.push(n.appTheme.embedUrl),n.appTheme.shareUrl&&e.push(n.appTheme.shareUrl);n=`^((https://)?(?:${(e=r.unique(e,e=>e).map(e=>r.escapeForRegex(r.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase())).join("|")})/)?(?:v[0-9]+/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$`,n=new RegExp(n,"i").exec(t.trim()),t=n&&(!n[1]||0<=e.indexOf(r.escapeForRegex(n[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase()))&&(n[3]||n[4])?n[3]||n[4]:null;return t&&("_"==t[0]&&13==t.length||23==t.length&&/^[0-9\-]+$/.test(t))?t:void 0}}}}(pxt=pxt||{}),function(e){(e.pxtc||(e.pxtc={})).f4EncodeImg=function(e,n,i,r){let t=[135,i,255&e,e>>8,255&n,n>>8,0,0].map(c).join(""),s=4,a=0,o=0,l=e=>{a|=e<<o,o==8-i?(t+=c(a),s++,a=0,o=0):o+=i};for(let t=0;t<e;++t){for(let e=0;e<n;++e)l(r(t,e));for(;0!=o;)l(0);if(1<i)for(;3&s;)l(0)}return t;function c(e){return("0"+e.toString(16)).slice(-2)}}}(ts=ts||{}),function(e){function s(e){let t="";switch(e){case 0:t="C5";break;case 1:t="B";break;case 2:t="A";break;case 3:t="G";break;case 4:t="F";break;case 5:t="E";break;case 6:t="D";break;case 7:t="C"}return t}function i(e){let t=-1;switch(e){case"C5":t=0;break;case"B":t=1;break;case"A":t=2;break;case"G":t=3;break;case"F":t=4;break;case"E":t=5;break;case"D":t=6;break;case"C":t=7}return t}e.MelodyArray=class{constructor(e){this.numCols=8,this.numRows=8,this.polyphonic=!1,e&&(this.tempo=e),this.resetMelody()}setTempo(e){this.tempo=e}getArray(){return this.melody}setArray(e){this.melody=e}getColor(e){return 0}getValue(e,t){return this.melody[e][t]}getWidth(){return this.numCols}getHeight(){return this.numRows}updateMelody(e,t){var n=!this.melody[e][t];if(n&&!this.polyphonic)for(let e=0;e<this.numRows;e++)this.melody[e][t]=!1;this.melody[e][t]=n}getStringRepresentation(){let t="",i=new Array(this.numCols),r=0;for(let n=0;n<this.numRows;n++){let t=0;i[n]=[];for(let e=0;e<this.numCols;e++)this.melody[e][n]&&(i[n].push(s(e)),t++);t>r&&(r=t)}if(0==r)return"- - - - - - - - ";for(let e=0;e<r;e++)for(let e=0;e<this.numCols;e++)i[e]&&0<i[e].length?t+=i[e].shift()+" ":t+="- ";return t}parseNotes(e){var n=(e=e.trim()).split(" ");for(let t=0;t<n.length;t++){for(let e=0;e<this.numRows;e++)this.melody[e][t]=!1;"-"!=n[t]&&(this.melody[i(n[t])][t]=!0)}}setPolyphonic(e){this.polyphonic=e}isPolyphonic(){return this.polyphonic}resetMelody(){this.melody=new Array(this.numCols);for(let e=0;e<this.numCols;e++)this.melody[e]=new Array(this.numRows).fill(!1)}},e.rowToNote=s,e.noteToRow=i,e.getColorClass=function(e){let t="melody-default";switch(e){case 0:t="melody-red";break;case 1:t="melody-orange";break;case 2:t="melody-yellow";break;case 3:t="melody-green";break;case 4:t="melody-teal";break;case 5:t="melody-blue";break;case 6:t="melody-purple";break;case 7:t="melody-violet"}return t}}(pxtmelody=pxtmelody||{}),function(s){function c(e,t,n){var i=document.createElement(e),r=t,s=n;if(r)for(const s of Object.keys(r))"className"===s?i.setAttribute("class",r[s]+""):i.setAttribute(s,r[s]+"");return s&&i.addEventListener("click",s),i}s.MelodyGallery=class{constructor(){this.value=null,this.visible=!1,this.timeouts=[],this.numSamples=s.SampleMelodies.length,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("id","melody-editor-gallery-outer"),this.contentDiv=document.createElement("div"),this.contentDiv.setAttribute("id","melody-editor-gallery"),this.itemBackgroundColor="#DCDCDC",this.itemBorderColor="white",this.initStyles(),this.containerDiv.appendChild(this.contentDiv),this.containerDiv.style.display="none",this.contentDiv.addEventListener("animationend",()=>{this.visible||(this.containerDiv.style.display="none")}),this.contentDiv.addEventListener("wheel",e=>{e.stopPropagation()},!0)}getElement(){return this.containerDiv}getValue(){return this.value}show(e){this.pending=e,this.containerDiv.style.display="block",this.buildDom(),this.visible=!0,pxt.BrowserUtils.removeClass(this.contentDiv,"hidden-above"),pxt.BrowserUtils.addClass(this.contentDiv,"shown")}hide(){this.visible=!1,pxt.BrowserUtils.removeClass(this.contentDiv,"shown"),pxt.BrowserUtils.addClass(this.contentDiv,"hidden-above"),this.value=null,this.stopMelody()}clearDomReferences(){this.contentDiv=null,this.containerDiv=null}layout(e,t,n){this.containerDiv.style.left=e+"px",this.containerDiv.style.top=t+"px",this.containerDiv.style.height=n+"px"}buildDom(){for(;this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild);var t=s.SampleMelodies;this.buttons=[];for(let e=0;e<t.length;e++)this.mkButton(t[e],e,"255px","45px")}initStyles(){var e=document.createElement("style");e.textContent="\n            #melody-editor-gallery {\n                margin-top: -100%;\n            }\n\n            #melody-editor-gallery.hidden-above {\n                margin-top: -100%;\n                animation: slide-up 0.2s 0s ease;\n            }\n\n            #melody-editor-gallery.shown {\n                margin-top: 0px;\n                animation: slide-down 0.2s 0s ease;\n            }\n\n            @keyframes slide-down {\n                0% {\n                    margin-top: -100%;\n                }\n                100% {\n                    margin-top: 0px;\n                }\n            }\n\n            @keyframes slide-up {\n                0% {\n                    margin-top: 0px;\n                }\n                100% {\n                    margin-top: -100%;\n                }\n            }\n            ",this.containerDiv.appendChild(e)}mkButton(e,t,n,i){var r=c("div",{className:"melody-gallery-button melody-editor-card",role:"menuitem",id:":"+t}),s=c("i",{className:"music icon melody-icon"}),a=c("div",{className:"melody-editor-text"}),o=(a.innerText=e.name,this.createColorBlock(e)),l=c("div",{className:"melody-editor-button left-button",role:"button",title:e.name},()=>this.handleSelection(e)),s=(l.appendChild(s),l.appendChild(a),l.appendChild(o),r.appendChild(l),c("div",{className:"melody-editor-button right-button",role:"button",title:lf("Preview {0}",e.name)},()=>this.togglePlay(e,t))),a=c("i",{className:"play icon"});this.buttons[t]=a,s.appendChild(a),r.appendChild(s),this.contentDiv.appendChild(r)}handleSelection(e){var t;this.pending&&(t=this.pending,this.pending=void 0,t(e.notes))}playNote(e,t,n){let i=0;switch(e){case"C5":i=523;break;case"B":i=494;break;case"A":i=440;break;case"G":i=392;break;case"F":i=349;break;case"E":i=330;break;case"D":i=294;break;case"C":i=262}this.timeouts.push(setTimeout(()=>{pxt.AudioContextManager.tone(i)},t*this.getDuration(n))),this.timeouts.push(setTimeout(()=>{pxt.AudioContextManager.stop()},(t+1)*this.getDuration(n)))}getDuration(e){return 6e4/e}previewMelody(t){this.stopMelody();var n=t.notes.split(" ");for(let e=0;e<n.length;e++)this.playNote(n[e],e,t.tempo)}togglePlay(e,t){let n=this.buttons[t];pxt.BrowserUtils.containsClass(n,"play icon")?(this.resetPlayIcons(),pxt.BrowserUtils.removeClass(n,"play icon"),pxt.BrowserUtils.addClass(n,"stop icon"),this.previewMelody(e),this.timeouts.push(setTimeout(()=>{pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon")},e.notes.split(" ").length*this.getDuration(e.tempo)))):(pxt.BrowserUtils.removeClass(n,"stop icon"),pxt.BrowserUtils.addClass(n,"play icon"),this.stopMelody())}stopMelody(){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop()}resetPlayIcons(){for(let e=0;e<this.numSamples;e++){var t=this.buttons[e];if(pxt.BrowserUtils.containsClass(t,"stop icon")){pxt.BrowserUtils.removeClass(t,"stop icon"),pxt.BrowserUtils.addClass(t,"play icon");break}}}createColorBlock(e){var t=document.createElement("div"),n=(pxt.BrowserUtils.addClass(t,"melody-color-block"),e.notes.split(" "));for(let e=0;e<n.length;e++){var i=s.getColorClass(s.noteToRow(n[e])),r=document.createElement("div");0==e?pxt.BrowserUtils.addClass(r,"left-edge sliver "+i):e==n.length-1?pxt.BrowserUtils.addClass(r,"right-edge sliver "+i):pxt.BrowserUtils.addClass(r,"sliver "+i),t.appendChild(r)}return t}}}(pxtmelody=pxtmelody||{}),function(e){class t{constructor(e,t,n){this.name=e,this.notes=t,this.tempo=n}}e.MelodyInfo=t,e.SampleMelodies=[new t(lf("Scale"),"C5 B A G F E D C",120),new t(lf("Reverse"),"C D E F G A B C5",120),new t(lf("Mystery"),"E B C5 A B G A F",120),new t(lf("Gilroy"),"A F E F D G E F",120),new t(lf("Falling"),"C5 A B G A F G E",120),new t(lf("Hopeful"),"G B A G C5 B A B",120),new t(lf("Tokyo"),"B A G A G F A C5",120),new t(lf("Paris"),"G F G A - F E D",120),new t(lf("Rising"),"E D G F B A C5 B",120),new t(lf("Sitka"),"C5 G B A F A C5 B",120)]}(pxtmelody=pxtmelody||{}),function(s){var e;(e=s.winrt||(s.winrt={})).browserDownloadAsync=function(t,e,n){let i;return s.winrt.promisify(Windows.Storage.ApplicationData.current.temporaryFolder.createFileAsync(e,Windows.Storage.CreationCollisionOption.replaceExisting).then(e=>Windows.Storage.FileIO.writeTextAsync(i=e,t)).then(()=>Windows.System.Launcher.launchFileAsync(i)).then(e=>{}))},e.saveOnlyAsync=function(i){const r=s.appTarget.compile.useUF2,e=r?[".uf2"]:[".hex"],t=new Windows.Storage.Pickers.FileSavePicker;return t.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.documentsLibrary,t.fileTypeChoices.insert("MakeCode binary file",e),t.suggestedFileName=i.downloadFileBaseName,s.winrt.promisify(t.pickSaveFileAsync().then(t=>{if(t){let e=r?i.outfiles[pxtc.BINARY_UF2]:i.outfiles[pxtc.BINARY_HEX];s.isOutputText()||(e=atob(e));const n=[];return s.Util.stringToUint8Array(e).forEach(e=>n.push(e)),Windows.Storage.FileIO.writeBytesAsync(t,n).then(()=>!0)}return Promise.resolve(!1)}))}}(pxt=pxt||{}),function(l){{var c=l.winrt||(l.winrt={});class e{constructor(){this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onEvent=e=>{},this.onError=e=>{},this.connecting=!1,this.handleInputReport=this.handleInputReport.bind(this)}disposeAsync(){return Promise.resolve()}error(e){throw new Error(l.U.lf("USB/HID error ({0})",e))}setConnecting(e){this.connecting=e,this.onConnectionChanged&&this.onConnectionChanged()}isConnecting(){return this.connecting}isConnected(){return!!this.dev}reconnectAsync(){return this.disconnectAsync().then(()=>this.initAsync())}isSwitchingToBootloader(){a=!0,this.dev&&(o=!0)}disconnectAsync(){if(this.dev){var e=this.dev;delete this.dev;try{e.close()}catch(e){}this.onConnectionChanged&&this.onConnectionChanged()}return Promise.resolve()}sendPacketAsync(t){if(!this.dev)return Promise.resolve();var n=[0];for(let e=0;e<Math.max(t.length,64);++e)n.push(t[e]||0);var e=new Windows.Storage.Streams.DataWriter,e=(e.writeBytes(n),e.detachBuffer()),i=this.dev.createOutputReport(0);return i.data=e,l.winrt.promisify(this.dev.sendOutputReportAsync(i).then(e=>{}))}handleInputReport(e){for(var t=Windows.Storage.Streams.DataReader.fromBuffer(e.report.data),n=[];t.unconsumedBufferLength;)n.push(t.readByte());65==n.length&&0===n[0]&&n.shift(),this.onData(new Uint8Array(n))}initAsync(t=!1){l.Util.assert(!this.dev,"HID interface not properly reseted");const n=Windows.Devices,i=n.HumanInterfaceDevice.HidDevice,r=()=>{var e=new Error(l.U.lf("Device not found"));return e.type="devicenotfound",Promise.reject(e)},e=u.reduce((e,t)=>e.then(e=>e&&e.length?Promise.resolve(e):n.Enumeration.DeviceInformation.findAllAsync(t,null)),Promise.resolve(null));let s;return this.setConnecting(!0),e.then(e=>{if(!e||!e[0])return l.debug("no hid device found"),Promise.reject(new Error("no hid device found"));l.debug(`hid enumerate ${e.length} devices`);e=e[0];return l.debug(`hid connect to ${e.name} (${e.id})`),s=e.id,i.fromIdAsync(e.id,Windows.Storage.FileAccessMode.readWrite)}).then(e=>{return this.dev=e,this.dev?(l.debug("hid device version "+this.dev.version),this.dev.addEventListener("inputreportreceived",this.handleInputReport),Promise.resolve()):(l.debug("can't connect to hid device"),e=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(s).currentStatus,l.reportError("winrt_device","could not connect to HID device; device status: "+e),Promise.reject(new Error("can't connect to hid device")))}).finally(()=>{this.setConnecting(!1)}).catch(e=>t?r():c.bootloaderViaBaud(this).then(()=>this.initAsync(!0)).catch(()=>r()))}}c.WinRTPacketIO=e,c.packetIO=void 0,c.mkWinRTPacketIOAsync=function(){return l.debug("packetio: mk winrt packetio"),c.packetIO=new e,c.packetIO.initAsync().catch(e=>(c.packetIO=void 0,Promise.reject(e))).then(()=>c.packetIO)};const u=[],d=[];let s=0,a=!1,o=!1;c.initWinrtHid=function(t,n){const e=Windows.Devices,i=Windows.Devices.Enumeration.DeviceInformation,r=e.HumanInterfaceDevice.HidDevice;l.appTarget&&l.appTarget.compile&&l.appTarget.compile.hidSelectors&&l.appTarget.compile.hidSelectors.forEach(e=>{e=r.getDeviceSelector(parseInt(e.usagePage),parseInt(e.usageId),parseInt(e.vid),parseInt(e.pid));u.indexOf(e)<0&&u.push(e)}),u.forEach(e=>{e=i.createWatcher(e,null);e.addEventListener("added",e=>{l.debug("new hid device detected: "+e.id),a?a=!1:1===++s&&t&&t()}),e.addEventListener("removed",e=>{l.debug("hid device closed: "+e.id),o?o=!1:0<--s&&t?t():0===s&&n&&(n(),c.packetIO=void 0)}),e.addEventListener("updated",e=>{}),d.push(e)}),d.filter(e=>!e.status).forEach(e=>e.start())}}}(pxt=pxt||{}),function(c){{var e=c.winrt||(c.winrt={});let n,i,l={};function r(e){if(!e)return Promise.resolve([]);const t=Windows.Devices,n=t.SerialCommunication.SerialDevice,i=t.Enumeration.DeviceInformation,r=[];return e.forEach(e=>{e=n.getDeviceSelectorFromUsbVidPid(parseInt(e.vid),parseInt(e.pid));r.push(e)}),r.reduce((e,t)=>{let n;return e.then(e=>(n=e,i.findAllAsync(t,null))).then(t=>{if(n)for(let e=0;e<t.length;++e)n.push(t[e]);else n=t;return Promise.resolve(n)})},Promise.resolve(null)).then(e=>e?c.U.promiseMapAll(e,e=>c.winrt.promisify(n.fromIdAsync(e.id))):Promise.resolve([]))}function s(t){i&&!i.test(t.name)||(c.debug(`serial port added ${t.name} - `+t.id),l[t.id]={info:t},Windows.Devices.SerialCommunication.SerialDevice.fromIdAsync(t.id).then(e=>{l[t.id].device=e,function t(n){let i=l[n];if(!i)return;if(!i.device){let e=Windows.Devices.Enumeration.DeviceAccessInformation.createFromId(n).currentStatus;return void c.reportError("winrt_device","could not connect to serial device; device status: "+e)}const e=Windows.Storage.Streams;i.device.baudRate=115200;let r=i.device.inputStream,s=new e.DataReader(r);s.inputStreamOptions=e.InputStreamOptions.partial;let a={},o=()=>{l[n]&&!i.cancellingDeferred&&(i.readingOperation=s.loadAsync(32),i.readingOperation.then(e=>{let t=s.readString(4*Math.floor(s.unconsumedBufferLength/4));c.Util.bufferSerial(a,t,n),setTimeout(()=>o(),1)},e=>{i.readingOperation.operation.status===Windows.Foundation.AsyncStatus.canceled?(s.detachStream(),s.close(),i.cancellingDeferred&&setTimeout(()=>i.cancellingDeferred.resolve(),25)):setTimeout(()=>t(n),1e3)}))};setTimeout(()=>o(),100)}(t.id)}))}function a(e){delete l[e.id]}function o(e){var t=l[e.id];t&&t.info.update(e)}e.initSerial=function(){var t=!(!c.appTarget.serial||!(c.appTarget.serial.nameFilter||c.appTarget.serial.vendorId&&c.appTarget.serial.productId));if(c.appTarget.serial&&c.appTarget.serial.log&&t){t=Windows.Devices.SerialCommunication.SerialDevice;let e;e=c.appTarget.serial.vendorId&&c.appTarget.serial.productId?t.getDeviceSelectorFromUsbVidPid(parseInt(c.appTarget.serial.vendorId),parseInt(c.appTarget.serial.productId)):(i=new RegExp(c.appTarget.serial.nameFilter),t.getDeviceSelector()),(n=Windows.Devices.Enumeration.DeviceInformation.createWatcher(e,null)).addEventListener("added",s),n.addEventListener("removed",a),n.addEventListener("updated",o),n.start()}},e.suspendSerialAsync=function(){n&&(n.stop(),n.removeEventListener("added",s),n.removeEventListener("removed",a),n.removeEventListener("updated",o),n=void 0);let i=Promise.resolve();return Object.keys(l).forEach(e=>{var t=l[e],n=t.readingOperation;if(n){const e=c.Util.defer();t.cancellingDeferred=e,i=i.then(()=>c.U.promiseTimeout(500,e.promise).catch(e=>{c.reportError("winrt_device","could not cancel reading operation for a device: "+e.message)})),n.cancel()}}),i.then(()=>{Object.keys(l).forEach(e=>{e=l[e];e.device&&e.device.close()}),l={}})},e.bootloaderViaBaud=function(t){if(!(c.appTarget&&c.appTarget.compile&&c.appTarget.compile.useUF2&&c.appTarget.simulator&&c.appTarget.simulator.boardDefinition&&c.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo))return Promise.reject(new Error("device does not support switching to bootloader via baudrate"));let n;var e=c.appTarget.simulator.boardDefinition.bootloaderBaudSwitchInfo;return r([{vid:e.vid,pid:e.pid,usageId:void 0,usagePage:void 0}]).then(e=>e&&0!==e.length?((n=e).length&&t.isSwitchingToBootloader(),n.forEach(e=>{e.baudRate=1200,e.close()}),c.U.delay(1500)):Promise.reject(new Error("no serial devices to switch into bootloader")))},e.connectSerialDevicesAsync=r}}(pxt=pxt||{}),function(s){{var a=s.winrt||(s.winrt={});function o(){return"undefined"!=typeof Windows}function l(){return o()?(t.resolve(null),t.promise.then(e=>Promise.resolve(e&&e.kind===Windows.ApplicationModel.Activation.ActivationKind.file))):Promise.resolve(!1)}function n(){return o()?Promise.resolve().then(()=>a.packetIO?(s.log("disconnecting packetIO"),a.packetIO.disconnectAsync()):Promise.resolve()).catch(e=>{e.message="error disconnecting packetIO: "+e.message,s.reportException(e)}).then(()=>(s.log("suspending serial"),a.suspendSerialAsync())).catch(e=>{e.message="error suspending serial: "+e.message,s.reportException(e)}):Promise.resolve()}function c(e){Windows.UI.WebUI.WebUIApplication.removeEventListener("activated",c),t.resolve(e)}function u(e){s.log("suspending");const t=e.suspendingOperation.getDeferral();return n().then(()=>t.complete(),e=>t.complete()).then()}function d(e){s.log("resuming"),a.packetIO&&(s.log("reconnet pack io"),a.packetIO.reconnectAsync()),a.initSerial()}let t,r;function h(e,t=!1){e.kind===Windows.ApplicationModel.Activation.ActivationKind.file&&(e=e.files.getAt(0))&&e.isOfType(Windows.Storage.StorageItemTypes.file)&&Windows.Storage.FileIO.readBufferAsync(e).then(e=>{for(var t=[],n=Windows.Storage.Streams.DataReader.fromBuffer(e);n.unconsumedBufferLength;)t.push(n.readByte());return n.close(),s.cpp.unpackSourceFromHexAsync(new Uint8Array(t))}).then(e=>r(e,{openHomeIfFailed:t}))}s.BrowserUtils.isWinRT=o,a.promisify=function(e){return new Promise((t,n)=>{e.then(e=>t(e),e=>n(e))})},a.toArray=function(t){var n=[],i=t.length;for(let e=0;e<i;++e)n.push(t[e]);return n},a.isWindows=function(){return!!navigator&&/Win32/i.test(navigator.platform)},a.isWinRT=o,a.initAsync=function(e){if(!o()||s.BrowserUtils.isIFrame())return Promise.resolve();const t=Windows.UI.Core,n=t.SystemNavigationManager.getForCurrentView(),i=Windows.UI.WebUI.WebUIApplication;return i.addEventListener("suspending",u),i.addEventListener("resuming",d),n.onbackrequested=e=>{s.log("BACK NAVIGATION"),n.appViewBackButtonVisibility=t.AppViewBackButtonVisibility.collapsed,e.handled=!0},a.initSerial(),l().then(()=>{e&&(r=e,i.removeEventListener("activated",c),i.addEventListener("activated",h))})},a.captureInitialActivation=function(){o()&&(t=s.Util.defer(),Windows.UI.WebUI.WebUIApplication.addEventListener("activated",c))},a.loadActivationProject=function(){return t.promise.then(e=>h(e,!0))},a.hasActivationProjectAsync=l,a.releaseAllDevicesAsync=n}}(pxt=pxt||{}),function(a){var o=a.winrt||(a.winrt={});{var e=o.workspace||(o.workspace={}),l=a.Util;let s;function c(...e){return e.join("\\")}function u(e){e=c(s.path,e);return a.debug("winrt: reading "+e),o.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(e).then(e=>Windows.Storage.FileIO.readTextAsync(e)))}function d(e,t,n){e=c(s.path,e);return a.debug("winrt: writing "+c(e,t)),o.promisify(Windows.Storage.StorageFolder.getFolderFromPathAsync(e)).then(e=>e.createFileAsync(t,Windows.Storage.CreationCollisionOption.replaceExisting)).then(e=>Windows.Storage.FileIO.writeTextAsync(e,n)).then(()=>{})}function h(e,t=null){t=new Error(t||"Error "+e);throw t.statusCode=e,t}e.fileApiAsync=function(e,t){var n,i,r;if(l.startsWith(e,"pkg/"))return n=e.slice(4),t?(i=n,r=t,a.debug("winrt: writing package at "+i),o.promisify(s.createFolderAsync(i,Windows.Storage.CreationCollisionOption.openIfExists)).then(()=>l.promiseMapAll(r.files,t=>u(c(i,t.name)).then(e=>{if(t.name!=a.SIMSTATE_JSON&&t.name!=a.ASSETS_FILE){if(t.name==a.CONFIG_NAME)try{JSON.parse(t.content).name||(a.log("Trying to save invalid JSON config"),h(410))}catch(e){a.log("Trying to save invalid format JSON config"),h(410)}e!==t.prevContent&&(a.log(`merge error for ${t.name}: previous content changed...`),h(409))}},e=>{}))).then(()=>l.promiseMapAll(r.files,e=>d(i,e.name,e.content))).then(()=>d(i,m,JSON.stringify(r.header,null,4))).then(()=>p(i,!1))):p(n,!0);if("list"==e)return(s?Promise.resolve():(t=Windows.Storage.ApplicationData.current.localFolder,a.debug("winrt: initializing workspace"),o.promisify(t.createFolderAsync(a.appTarget.id,Windows.Storage.CreationCollisionOption.openIfExists)).then(e=>{s=e,a.debug("winrt: initialized workspace at "+s.path)}).then(()=>{}))).then(f);throw h(404)};const m=".header.json";function p(i,r){return a.debug("winrt: reading package under "+i),u(c(i,a.CONFIG_NAME)).then(e=>{const n=JSON.parse(e);return l.promiseMapAll(a.allPkgFiles(n),n=>{return t=c(i,n),e=c(s.path,t),a.debug("winrt: "+e),o.promisify(Windows.Storage.StorageFile.getFileFromPathAsync(e).then(e=>e.getBasicPropertiesAsync().then(e=>({name:t,mtime:e.dateModified.getTime()})))).then(e=>{const t={name:n,mtime:e?e.mtime:null};return null!=e&&r?u(c(i,n)).then(e=>(t.content=e,t)):t});var t,e}).then(e=>{const t={path:i,header:null,config:n,files:e};return u(c(i,m)).then(e=>{e&&(t.header=JSON.parse(e))},e=>{}).then(()=>t)})})}function f(){return o.promisify(s.getFoldersAsync()).then(e=>l.promiseMapAll(e,e=>p(e.name,!1))).then(e=>Promise.resolve({pkgs:e}))}function t(){return o.promisify(s.deleteAsync(Windows.Storage.StorageDeleteOption.default).then(()=>{s=void 0}))}e.getProvider=function(e){return{listAsync:e.listAsync,getAsync:e.getAsync,setAsync:e.setAsync,resetAsync:t}}}}(pxt=pxt||{}),function(r){{var s=r.editor||(r.editor={}),a;let e,t,n,i;(a=e=s.SimState||(s.SimState={}))[a.Stopped=0]="Stopped",a[a.Pending=1]="Pending",a[a.Starting=2]="Starting",a[a.Running=3]="Running",s.isBlocks=function(e){return r.U.endsWith(e.name,".blocks")},(a=t=s.ErrorListState||(s.ErrorListState={})).HeaderOnly="errorListHeader",a.Expanded="errorListExpanded",(a=n=s.FilterState||(s.FilterState={}))[a.Hidden=0]="Hidden",a[a.Visible=1]="Visible",a[a.Disabled=2]="Disabled",s.initExtensionsAsync=e=>Promise.resolve({}),s.initFieldExtensionsAsync=e=>Promise.resolve({}),s.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",s.initEditorExtensionsAsync=function(){if(!i&&(i=Promise.resolve(),r.appTarget)&&r.appTarget.appTheme&&r.appTarget.appTheme.extendFieldEditors){const e={};i=i.then(()=>r.BrowserUtils.loadBlocklyAsync()).then(()=>r.BrowserUtils.loadScriptAsync("fieldeditors.js")).then(()=>r.editor.initFieldExtensionsAsync(e)).then(e=>{e.fieldEditors&&e.fieldEditors.forEach(e=>{r.blocks.registerFieldEditor(e.selector,e.editor,e.validator)})})}return i}}}(pxt=pxt||{}),function(a){{var e=a.editor||(a.editor={});const l={};function o(e,t,n,i){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:n,error:i},"*")}function s(i){return new Promise((e,t)=>{var n=a.Util.clone(i);n.id=ts.pxtc.Util.guidGen(),i.response&&(l[n.id]={resolve:e,reject:t}),window.parent.postMessage(n,"*"),i.response||e(void 0)})}e.bindEditorMessages=function(n){const t=(a.appTarget.appTheme.allowParentController||a.shell.isControllerMode())&&a.BrowserUtils.isIFrame(),i=a.appTarget.appTheme.allowPackageExtensions,s=a.appTarget.appTheme.allowSimulatorTelemetry;(t||i||s)&&window.addEventListener("message",e=>{const r=e.data;if(!r||!/^pxt(host|editor|pkgext|sim)$/.test(r.type))return!1;if("pxtpkgext"===r.type&&i)n().then(e=>{e.handleExtensionRequest(r)});else if("pxtsim"===r.type&&s){const n=r;"event"===n.action&&(n.category||n.message?a.reportError(n.category,n.message,n.data):a.tickEvent(n.tick,n.data))}else if(t){let t,e=Promise.resolve();if("pxthost"==r.type){const n=l[r.id];n?e=e.then(()=>n.resolve(r)):a.debug("pxthost: unknown request "+r.id)}else"pxteditor"==r.type&&(e=e.then(()=>n().then(n=>{const i=r;switch(a.debug("pxteditor: "+i.action),i.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then(()=>n.openJavaScript());case"switchpython":return Promise.resolve().then(()=>n.openPython());case"switchblocks":return Promise.resolve().then(()=>n.openBlocks());case"startsimulator":return Promise.resolve().then(()=>n.startSimulator());case"restartsimulator":return Promise.resolve().then(()=>n.restartSimulator());case"hidesimulator":return Promise.resolve().then(()=>n.collapseSimulator());case"showsimulator":return Promise.resolve().then(()=>n.expandSimulator());case"closeflyout":return Promise.resolve().then(()=>n.closeFlyout());case"unloadproject":return Promise.resolve().then(()=>n.unloadProjectAsync());case"saveproject":return n.saveProjectAsync();case"redo":return Promise.resolve().then(()=>{var e=n.editor;e&&e.hasRedo()&&e.redo()});case"undo":return Promise.resolve().then(()=>{var e=n.editor;e&&e.hasUndo()&&e.undo()});case"setscale":{const a=r;return Promise.resolve().then(()=>n.editor.setScale(a.scale))}case"stopsimulator":{const a=r;return Promise.resolve().then(()=>n.stopSimulator(a.unload))}case"newproject":{const a=r;return Promise.resolve().then(()=>n.newProject(a.options))}case"importproject":{const a=r;return Promise.resolve().then(()=>n.importProjectAsync(a.project,{filters:a.filters,searchBar:a.searchBar}))}case"openheader":{const a=r;return n.openProjectByHeaderIdAsync(a.headerId)}case"startactivity":{const i=r;let e,t=i.path;return/^([jt]s|py|blocks?):/i.test(t)&&(e=/^py:/i.test(t)?a.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(t)?a.JAVASCRIPT_PROJECT_NAME:a.BLOCKS_PROJECT_NAME,t=t.substr(t.indexOf(":")+1)),Promise.resolve().then(()=>n.startActivity({activity:i.activityType,path:t,title:i.title,editor:e,previousProjectHeaderId:i.previousProjectHeaderId,carryoverPreviousCode:i.carryoverPreviousCode}))}case"importtutorial":{const a=r;return Promise.resolve().then(()=>n.importTutorialAsync(a.markdown))}case"proxytosim":{const a=r;return Promise.resolve().then(()=>n.proxySimulatorMessage(a.content))}case"renderblocks":{const a=r;return Promise.resolve().then(()=>n.renderBlocksAsync(a)).then(e=>e.xml.then(e=>{t=e.xml}))}case"renderpython":{const a=r;return Promise.resolve().then(()=>n.renderPythonAsync(a)).then(e=>{t=e.python})}case"toggletrace":{const a=r;return Promise.resolve().then(()=>n.toggleTrace(a.intervalSpeed))}case"settracestate":{const a=r;return Promise.resolve().then(()=>n.setTrace(a.enabled,a.intervalSpeed))}case"setsimulatorfullscreen":{const a=r;return Promise.resolve().then(()=>n.setSimulatorFullScreen(a.enabled))}case"togglehighcontrast":return Promise.resolve().then(()=>n.toggleHighContrast());case"togglegreenscreen":return Promise.resolve().then(()=>n.toggleGreenScreen());case"print":return Promise.resolve().then(()=>n.printCode());case"pair":return n.pairAsync();case"info":return Promise.resolve().then(()=>{t={versions:a.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:a.appTarget.appTheme.availableLocales}});case"shareproject":{const a=r;return n.anonymousPublishHeaderByIdAsync(a.headerId).then(e=>{t=e})}case"savelocalprojectstocloud":{const a=r;return n.saveLocalProjectsToCloudAsync(a.headerIds).then(e=>{t={headerIdMap:e}})}case"requestprojectcloudstatus":{const a=r;return n.requestProjectCloudStatus(a.headerIds)}case"convertcloudprojectstolocal":{const a=r;return n.convertCloudProjectsToLocal(a.userId)}case"setlanguagerestriction":{const a=r;if("no-blocks"===a.restriction)throw console.warn("no-blocks language restriction is not supported"),new Error("no-blocks language restriction is not supported");return n.setLanguageRestrictionAsync(a.restriction)}}return Promise.resolve()})));e.then(()=>o(r,t,!0,void 0),e=>o(r,t,!1,e))}return!0},!1)},e.enableControllerAnalytics=function(){if(a.appTarget.appTheme.allowParentController&&a.BrowserUtils.isIFrame()){const n=a.tickEvent,i=(a.tickEvent=function(e,t){n&&n(e,t),s({type:"pxthost",action:"event",tick:e,response:!1,data:t})},a.reportException),r=(a.reportException=function(e,t){i&&i(e,t);try{s({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}},a.reportError);a.reportError=function(e,t,n){r&&r(e,t,n),s({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:n})}}},e.shouldPostHostMessages=function(){return a.appTarget.appTheme.allowParentController&&a.BrowserUtils.isIFrame()},e.postHostMessageAsync=s}}(pxt=pxt||{}),function(r){function n(e){return"experiments-"+("object"==typeof e?e.id:e)}function i(){const n=r.savedAppTheme(),i={},e=s();return e.forEach(e=>{var t=a(e);n[e.id]=!!t,t&&(i[e.id]=t?1:0)}),e.length&&Object.keys(i).length&&(r.tickEvent("experiments.loaded",i),r.reloadAppTargetVariant()),r.appTarget.appTheme}function s(){const t=r.appTarget.appTheme.experiments;return t?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419",enableOnline:!0},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release"),enableOnline:!0},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"accessibleBlocks",name:lf("Accessible Blocks"),description:lf("Use the WASD keys to move and modify blocks."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6850"},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")},{id:"blocksErrorList",name:lf("Blocks Error List"),description:lf("Show an error list panel for Blocks")}].filter(e=>-1<t.indexOf(e.id)&&!(r.BrowserUtils.isPxtElectron()&&e.enableOnline)):[]}function a(e){return!!r.storage.getLocal(n(e))}function t(e,t){t!=a(e)&&(t?r.storage.setLocal(n(e),"1"):r.storage.removeLocal(n(e)),i())}var e;(e=(e=r.editor||(r.editor={})).experiments||(e.experiments={})).syncTheme=i,e.all=s,e.clear=function(){s().forEach(e=>r.storage.removeLocal(n(e))),i()},e.someEnabled=function(){return s().some(e=>a(e))},e.isEnabled=a,e.toggle=function(e){t(e,!a(e))},e.state=function(){const t={};return s().forEach(e=>t[e.id]=a(e)),JSON.stringify(t)},e.setState=t}(pxt=pxt||{}),function(s){function a(e){var t=s.appTarget.appTheme.invertedMonaco,n=!(!s.appTarget.appTheme.monacoFieldEditors||!s.appTarget.appTheme.monacoFieldEditors.length),i=s.BrowserUtils.isAndroid(),e=monaco.editor.create(e,{model:null,ariaLabel:s.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:n,glyphMargin:n||s.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!i,comments:!i,strings:!i},acceptSuggestionOnCommitCharacter:!i,acceptSuggestionOnEnter:i?"off":"on",accessibilitySupport:i?"off":"on"});return e.layout(),e}var e;(e=s.vs||(s.vs={})).syncModels=function(t,r,s,e){if(!e){let e=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),i={};t.sortedDeps().forEach(n=>{n.getFiles().forEach(e=>{var t=n.id+"/"+e;/\.(ts)$/.test(e)&&t!=s&&(monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]||(e=n.readFile(e)||"\n",r[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(e,t)),i[t]="1")})}),Object.keys(e).filter(e=>/\.(ts)$/.test(e)&&!i[e]).forEach(e=>{r[e].dispose()})}},e.initMonacoAsync=function(r){return new Promise((n,e)=>{if("object"==typeof window.monaco)n(a(r));else{let t=window.MonacoPaths,e=()=>{var e=window.require;e.config({paths:t}),e(["vs/editor/editor.main"],()=>{monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript&&(monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setWorkerOptions({customWorkerPath:s.webConfig.typeScriptWorkerJs}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1})),n(a(r))})};var i;window.require?e():((i=document.createElement("script")).type="text/javascript",i.src=t["vs/loader"],i.addEventListener("load",e),document.body.appendChild(i))}})},e.createEditor=a}(pxt=pxt||{}),function(n){(n.workspace||(n.workspace={})).freshHeader=function(e,t){return{target:n.appTarget.id,targetVersion:n.appTarget.versions.target,name:e,meta:{},editor:n.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:n.U.guidGen(),recentUse:t,modificationTime:t,cloudUserId:null,cloudCurrent:!1,cloudVersion:null,cloudLastSyncTime:0,isDeleted:!1}}}(pxt=pxt||{}),function(e){{e=e.editor||(e.editor={});const n={};e.registerMonacoFieldEditor=function(e,t){n[e]=t},e.getMonacoFieldEditor=function(e){return n[e]}}}(pxt=pxt||{}),function(i){(i.editor||(i.editor={})).MonacoReactFieldEditor=class{getId(){return"image-editor"}showEditorAsync(e,t,n){return this.fileType=e,this.editrange=t,this.host=n,this.initAsync().then(()=>{var e=this.textToValue(n.getText(t));return e?(this.fv=i.react.getFieldEditorView(this.getFieldEditorId(),e,this.getOptions()),this.fv.onHide(()=>{this.onClosed()}),this.fv.show(),new Promise((e,t)=>{this.resolver=e,this.rejecter=t})):Promise.resolve(null)})}onClosed(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)}dispose(){this.onClosed()}initAsync(){return Promise.resolve()}textToValue(e){return null}resultToText(e){return e+""}getFieldEditorId(){return""}getOptions(){return null}}}(pxt=pxt||{}),function(s){{var e=s.editor||(s.editor={}),t="image-editor";class n extends e.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`");var t=s.parseAssetTSReference(e);if(t){const{type:e,name:n}=t,i=n.trim(),r=s.react.getTilemapProject();this.isAsset=!0;t=r.lookupAssetByName("image",i);if(t)return t;{const e=r.createNewImage();return i&&!r.isNameTaken("image",i)&&s.validateAssetName(i)&&(e.meta.displayName=i),e}}return{type:"image",id:"",internalID:0,bitmap:s.sprite.imageLiteralToBitmap(e).data(),meta:{},jresData:""}}resultToText(e){var t;if(null!=(t=e.meta)&&t.displayName){const t=s.react.getTilemapProject();return e=this.isAsset||t.lookupAsset(e.type,e.id)?t.updateAsset(e):t.createNewProjectImage(e.bitmap,e.meta.displayName),this.isAsset=!0,s.getTSReferenceForAsset(e,this.isPython)}return s.sprite.bitmapToImageLiteral(s.sprite.Bitmap.fromData(e.bitmap),this.isPython?"python":"typescript")}getFieldEditorId(){return"image-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}}e.MonacoSpriteEditor=n,e.spriteEditorDefinition={id:t,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:img|assets\\s*\\.\\s*image)\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},e.registerMonacoFieldEditor(t,e.spriteEditorDefinition)}}(pxt=pxt||{}),function(r){{var e=r.editor||(r.editor={}),t="tilemap-editor";class n extends e.MonacoReactFieldEditor{textToValue(e){var e=this.readTilemap(e),t=r.react.getTilemapProject();return r.sprite.addMissingTilemapTilesAndReferences(t,e),e}readTilemap(t){var n=r.react.getTilemapProject();if(/^\s*tiles\s*\./.test(t)&&(this.isTilemapLiteral=!1,t)){try{return{type:"tilemap",id:"",internalID:0,meta:{},data:r.sprite.decodeTilemap(t,"typescript",n)}}catch(e){}return null}this.isTilemapLiteral=!0;var t=/^\s*(tilemap(?:8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(t),e=(t[2]||t[3]||"").trim();let i;if(this.tilemapLiteral=t[1],e&&(t=ts.pxtc.escapeIdentifier(e),i=n.getTilemap(t)),!i){let e=16;"tilemap8"===this.tilemapLiteral?e=8:"tilemap32"===this.tilemapLiteral&&(e=32);const[t]=n.createNewTilemap(void 0,e,16,16);i=n.getTilemap(t),t}return i}resultToText(e){var t=r.react.getTilemapProject();return t.pushUndo(),r.sprite.updateTilemapReferencesFromResult(t,e),this.isTilemapLiteral?(t.updateAsset(e),r.getTSReferenceForAsset(e,"python"===this.fileType)):r.sprite.encodeTilemap(e.data,"typescript"===this.fileType?"typescript":"python")}getFieldEditorId(){return"tilemap-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}getCreateTilemapRange(){var t=this.editrange.getStartPosition();let e,n=this.editrange.getEndPosition(),i=1;for(;;){e=new monaco.Range(n.lineNumber,n.column,n.lineNumber+1,0);var r=this.host.getText(e);for(let e=0;e<r.length;e++)if("("===r.charAt(e))i++;else if(")"===r.charAt(e)&&0===--i){const i=new monaco.Position(n.lineNumber,n.column+e+2);return monaco.Range.fromPositions(t,i)}if((n=e.getEndPosition()).lineNumber>t.lineNumber+20)return null}}}e.MonacoTilemapEditor=n,e.tilemapEditorDefinition={id:t,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},e.registerMonacoFieldEditor(t,e.tilemapEditorDefinition)}}(pxt=pxt||{}),function(e){{e=e.accessibility||(e.accessibility={});let t;e.makeFocusable=function(e){e.setAttribute("focusable","true"),e.setAttribute("tabindex","0")},e.enableKeyboardInteraction=function(e,t,n){t&&e.addEventListener("keydown",e=>{e="number"==typeof e.which?e.which:e.keyCode;32!==e&&13!==e||t()}),n&&e.addEventListener("keyup",e=>{e="number"==typeof e.which?e.which:e.keyCode;32!==e&&13!==e||n()})},e.setAria=function(e,t,n){t&&!e.hasAttribute("role")&&e.setAttribute("role",t),n&&!e.hasAttribute("aria-label")&&e.setAttribute("aria-label",n)},e.setLiveContent=function(e){t||((t=document.createElement("div")).setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-hidden","false"),t.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(t)),t.textContent!==e&&(t.textContent=e)}}}(pxsim=pxsim||{}),function(f){const u="blue",d="orange",r=e=>0<e.reduce((e,t)=>e+(t?1:0),0);function m(e,t){var n,i,r={};for(n in e)r[n]=e[n];for(i in t)r[i]=t[i];return r}function c(e){f.U.assert(!!e,"Invalid pin: "+e);e=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(e);return e?e[2]:void 0}function h(e){return"-Z"===e.orientation&&"male"===e.style}f.readPin=c;class t{constructor(e){this.availablePowerPins={top:{fiveVolt:f.mkRange(26,51).map(e=>({type:"breadboard",row:"+",col:""+e})),threeVolt:f.mkRange(26,51).map(e=>({type:"breadboard",row:"+",col:""+e})),ground:f.mkRange(26,51).map(e=>({type:"breadboard",row:"-",col:""+e}))},bottom:{fiveVolt:f.mkRange(1,26).map(e=>({type:"breadboard",row:"+",col:""+e})),threeVolt:f.mkRange(1,26).map(e=>({type:"breadboard",row:"+",col:""+e})),ground:f.mkRange(1,26).map(e=>({type:"breadboard",row:"-",col:""+e}))}},this.opts=e}allocPartIRs(s,a,d){let o=[];const l=(i,e,r,t)=>{var s=[];for(let n=0;n<i.numberOfPins;n++){let e,t=i.pinDefinitions[n];if("string"==typeof t.target)e=t.target;else{var a=t.target.pinInstantiationIdx;if(!r||void 0===r[a])return void console.log(`error: parts no pin found for PinInstantiationIdx: ${a}. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)`);e=r[a]}var a=i.visual.pinLocations[n],o=d.yOffset+a.y,l=Math.round(o/i.visual.pinDistance),o=o-l*i.visual.pinDistance,c=d.xOffset+a.x,u=Math.round(c/i.visual.pinDistance),l={partRelativeRowIdx:l,partRelativeColIdx:u,xOffset:c-u*i.visual.pinDistance,yOffset:o};s.push({def:t,loc:a,target:e,bbFit:l})}return{name:e,def:i,pins:s,partParams:t||{},bbFit:d}},e=s.instantiations||[];return s.instantiation&&e.push(s.instantiation),e.forEach(e=>{if("singleton"===e.kind)o.push(l(s,a));else if("function"===e.kind){let r=e,t=r.fullyQualifiedName.split(","),n={};t.forEach(e=>{this.opts.fnArgs[e]&&this.opts.fnArgs[e].forEach(e=>{n[e]=1})});e=Object.keys(n);e&&e.length?e.forEach(e=>{e=e.split(",");if(e.length!=r.argumentRoles.length)console.log(`error: parts mismatch between number of arguments at callsite (function name: ${t}) vs number of argument roles in part definition (part: ${a}).`);else{let n=[],i={};e.forEach((e,t)=>{var t=r.argumentRoles[t];void 0!==t.partParameter&&(i[t.partParameter]=e),void 0!==t.pinInstantiationIdx&&(t=t.pinInstantiationIdx,e=c(e),n[t]=e)}),o.push(l(s,a,n,i))}}):console.log("error: parts failed to read pin(s) from callsite for: "+t)}}),o.filter(e=>!!e)}computePartDimensions(e,t){let n=e.visual.pinLocations,i=e.pinDefinitions,r=e.numberOfPins;f.U.assert(n.length===r,`Mismatch between "numberOfPins" and length of "visual.pinLocations" for "${t}"`),f.U.assert(i.length===r,`Mismatch between "numberOfPins" and length of "pinDefinitions" for "${t}"`),f.U.assert(0<r,`Part "${t}" has no pins`);let s,a,o,l,c=n.map((e,t)=>{return n={idx:t},e=e,t=i[t],m(m(n,e),t);var n}).filter(e=>"-Z"===e.orientation),u=0<c.length,d=e.visual.pinDistance;var h,p;return u?(t=c[0],h=Math.ceil(t.x/d),p=Math.ceil(t.y/d),s=h*d-t.x,a=p*d-t.y,o=Math.ceil((s+e.visual.width)/d)+1,l=Math.ceil((a+e.visual.height)/d)+1):(o=Math.ceil(e.visual.width/d),l=Math.ceil(e.visual.height/d),s=o*d-e.visual.width,a=l*d-e.visual.height),{xOffset:s,yOffset:a,rowCount:l,colCount:o}}allocColumns(e){var t=e.length,n=f.visuals.BREADBOARD_MID_COLS-e.map(e=>e.colCount).reduce((e,t)=>e+t,0);n<=0&&console.log("Not enough breadboard space!");let i=Math.floor(n/(t-1+2)),r=n-i*(t-1),s=Math.floor(r/2),a=(Math.ceil(r/2),1+s);return e.map(e=>{var t=a;return a+=e.colCount+i,t})}placeParts(e){const i=f.visuals.BREADBOARD_MID_ROWS+2;let r=this.allocColumns(e.map(e=>e.bbFit)),s=e.map(e=>{let t=i-e.bbFit.rowCount,n=Math.floor(t/2);return n=(n=4<n?4:n)<1?1:n});return e.map((e,t)=>{var n=s[t];return m({startColumnIdx:r[t],startRowIdx:n},e)})}nextColor(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=f.visuals.GPIO_WIRE_COLORS.map(e=>e)),this.availableWireColors.pop()}allocWireIRs(l){let c=[],e=l.pins.map((e,t)=>{let n,i,r=e.target,s=l.startColumnIdx+e.bbFit.partRelativeColIdx,a=f.visuals.getColumnName(s),o=l.startRowIdx+e.bbFit.partRelativeRowIdx;return 7<=o&&(o-=2),n=h(e.def)?{type:"breadboard",row:o<5?"j":"a",col:a,style:e.def.style}:{type:"breadboard",row:f.visuals.getRowName(o),col:a,xOffset:e.bbFit.xOffset/l.def.visual.pinDistance,yOffset:e.bbFit.yOffset/l.def.visual.pinDistance,style:e.def.style},i="ground"===r?u:"threeVolt"===r?"red":"fiveVolt"===r?d:"number"==typeof e.def.colorGroup?c[e.def.colorGroup]||(c[e.def.colorGroup]=this.nextColor()):this.nextColor(),{start:n,end:r,color:i,pinIdx:t}});return m(l,{wires:e})}allocLocation(n,i){if("ground"===n||"threeVolt"===n||"fiveVolt"==n){if("ground"===n&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===n&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};if("fiveVolt"===n&&this.powerUsage.singleFiveVolt)return{type:"dalboard",pin:this.getBoardFiveVoltPin()};f.U.assert(!!i.referenceBBPin);var i=this.opts.getBBCoord(i.referenceBBPin),r=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(e=>this.opts.getBBCoord(e));r[0]&&r[1]||console.debug(`No more available "${n}" locations!`);let e,t=0==f.visuals.findClosestCoordIdx(i,r);t?"ground"===n?e=this.availablePowerPins.top.ground:"threeVolt"===n?e=this.availablePowerPins.top.threeVolt:"fiveVolt"===n&&(e=this.availablePowerPins.top.fiveVolt):"ground"===n?e=this.availablePowerPins.bottom.ground:"threeVolt"===n?e=this.availablePowerPins.bottom.threeVolt:"fiveVolt"===n&&(e=this.availablePowerPins.bottom.fiveVolt);r=e.map(e=>this.opts.getBBCoord(e)),i=f.visuals.findClosestCoordIdx(i,r),r=e[i];return(t?(this.availablePowerPins.top.ground.splice(i,1),this.availablePowerPins.top):(this.availablePowerPins.bottom.ground.splice(i,1),this.availablePowerPins.bottom)).threeVolt.splice(i,1),r}if("breadboard"===n.type)return n;if("MOSI"===n||"MISO"===n||"SCK"===n)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:this.opts.boardDef.spiPins[n]};if("SDA"===n||"SCL"===n)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:this.opts.boardDef.i2cPins[n]};f.U.assert("string"==typeof n,"Unknown location type: "+n);i=this.opts.boardDef.gpioPinMap[n]||n;return i?{type:"dalboard",pin:i}:void console.debug("unknown pin location for "+n)}getBoardGroundPin(){var e=this.opts.boardDef.groundPins&&this.opts.boardDef.groundPins[0]||null;return e||console.debug("No available ground pin on board!"),e}getBoardThreeVoltPin(){var e=this.opts.boardDef.threeVoltPins&&this.opts.boardDef.threeVoltPins[0]||null;return e||console.debug("No available 3.3V pin on board!"),e}getBoardFiveVoltPin(){var e=this.opts.boardDef.fiveVoltPins&&this.opts.boardDef.fiveVoltPins[0]||null;return e||console.debug("No available 5V pin on board!"),e}allocPowerWires(e){var t=this.getBoardGroundPin(),n=this.getBoardThreeVoltPin(),i=this.getBoardFiveVoltPin();let r,s,a=(s=this.opts.boardDef.attachPowerOnRight?(r={type:"breadboard",row:"-",col:"50"},{type:"breadboard",row:"-",col:"25"}):(r={type:"breadboard",row:"-",col:"26"},{type:"breadboard",row:"-",col:"1"}),[]),o=[],l=[];e.bottomGround&&e.topGround&&a.push({start:this.allocLocation("ground",{referenceBBPin:r}),end:this.allocLocation("ground",{referenceBBPin:s}),color:u}),e.topGround?a.push({start:this.allocLocation("ground",{referenceBBPin:r}),end:{type:"dalboard",pin:t},color:u}):e.bottomGround&&a.push({start:this.allocLocation("ground",{referenceBBPin:s}),end:{type:"dalboard",pin:t},color:u}),e.bottomThreeVolt&&e.bottomGround?o.push({start:this.allocLocation("threeVolt",{referenceBBPin:r}),end:this.allocLocation("threeVolt",{referenceBBPin:s}),color:"red"}):e.bottomFiveVolt&&e.bottomGround&&l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:r}),end:this.allocLocation("fiveVolt",{referenceBBPin:s}),color:d}),e.topThreeVolt?o.push({start:this.allocLocation("threeVolt",{referenceBBPin:r}),end:{type:"dalboard",pin:n},color:"red"}):e.bottomThreeVolt&&o.push({start:this.allocLocation("threeVolt",{referenceBBPin:s}),end:{type:"dalboard",pin:n},color:d}),e.topFiveVolt&&!e.topThreeVolt?l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:r}),end:{type:"dalboard",pin:i},color:"red"}):e.bottomFiveVolt&&!e.bottomThreeVolt&&l.push({start:this.allocLocation("fiveVolt",{referenceBBPin:s}),end:{type:"dalboard",pin:i},color:d});t=[];0<a.length&&t.push({wireIndices:a.map((e,t)=>t)});let c=a.length;return 0<o.length&&t.push({wireIndices:o.map((e,t)=>t+c)}),0<l.length&&t.push({wireIndices:o.map((e,t)=>t+c+o.length)}),{wires:a.concat(o).concat(l),assembly:t}}allocWire(e){const n=[e.start,e.end],i=n.map(e=>"ground"===e||"threeVolt"===e||"fiveVolt"===e);let r=n.map((e,t)=>i[t]?void 0:this.allocLocation(e,{}));if((r=r.map((e,t)=>{return e||(e=r[1-t],this.allocLocation(n[t],{referenceBBPin:e}))}))[0]&&r[1])return{start:r[0],end:r[1],color:e.color}}allocPart(i){var e=i.pins.filter(e=>h(e.def)).map(e=>{let t=i.startRowIdx+e.bbFit.partRelativeRowIdx;7<=t&&(t-=2);var n=f.visuals.getRowName(t),e=i.startColumnIdx+e.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:f.visuals.getColumnName(e)}});return{name:i.name,visual:i.def.visual,bbFit:i.bbFit,startColumnIdx:i.startColumnIdx,startRowIdx:i.startRowIdx,breadboardConnections:e,params:i.partParams,simulationBehavior:i.def.simulationBehavior}}allocAll(){var e=this.opts.partsList.map(e=>({name:e,def:this.opts.partDefs[e]})).filter(e=>!!e.def);if(0<e.length){let n=e.map(e=>this.computePartDimensions(e.def,e.name)),i=[];e.forEach((e,t)=>{t=n[t],e=this.allocPartIRs(e.def,e.name,t);i=i.concat(e)});var e=this.placeParts(i).map(e=>this.allocWireIRs(e)),t=e.map(e=>e.wires).reduce((e,t)=>e.concat(t),[]).map(e=>{return e=[e.start,e.end],t=e.map(e=>"ground"===e),n=e.map(e=>"threeVolt"===e),i=e.map(e=>"fiveVolt"===e),e=e.map(t=>{{let e=!1;return"string"!=typeof t&&"breadboard"===t.type&&(t=t.row,e=0<=["a","b","c","d","e"].indexOf(t)),e}}),t=r(t),n=r(n),i=r(i),e=r(e),{topGround:t&&!e,topThreeVolt:n&&!e,topFiveVolt:i&&!e,bottomGround:t&&e,bottomThreeVolt:n&&e,bottomFiveVolt:i&&e,singleGround:t,singleThreeVolt:n,singleFiveVolt:i};var t,n,i}),t=(this.powerUsage=((t=t.reduce((e,t)=>({topGround:e.topGround||t.topGround,topThreeVolt:e.topThreeVolt||t.topThreeVolt,topFiveVolt:e.topFiveVolt||t.topFiveVolt,bottomGround:e.bottomGround||t.bottomGround,bottomThreeVolt:e.bottomThreeVolt||t.bottomThreeVolt,bottomFiveVolt:e.bottomFiveVolt||t.bottomFiveVolt,singleGround:t.singleGround?null===e.singleGround:e.singleGround,singleThreeVolt:t.singleThreeVolt?null===e.singleThreeVolt:e.singleThreeVolt,singleFiveVolt:t.singleFiveVolt?null===e.singleFiveVolt:e.singleFiveVolt}),{topGround:!1,topThreeVolt:!1,topFiveVolt:!1,bottomGround:!1,bottomThreeVolt:!1,bottomFiveVolt:!1,singleGround:null,singleThreeVolt:null,singleFiveVolt:null})).singleGround&&(t.topGround=t.bottomGround=!1),t.singleThreeVolt&&(t.topThreeVolt=t.bottomThreeVolt=!1),t.singleFiveVolt&&(t.topFiveVolt=t.bottomFiveVolt=!1),t),this.allocPowerWires(this.powerUsage)),e=e.map((e,t)=>{var n=this.allocPart(e),i=e.wires.map(e=>this.allocWire(e));if(!i.some(e=>!e)){const r=[];return e.wires.forEach((e,t)=>{r[e.pinIdx]=t}),{part:n,wires:i,assembly:e.def.assembly.map(e=>({part:e.part,wireIndices:(e.pinIndices||[]).map(e=>r[e])}))}}}).filter(e=>!!e),t=[t].concat(e).filter(e=>e.assembly&&e.assembly.length),e=!t.some(e=>e.part&&e.part.breadboardConnections&&0<e.part.breadboardConnections.length||e.wires&&e.wires.some(e=>"breadboard"==e.end.type&&"croc"!=e.end.style||"breadboard"==e.start.type&&"croc"!=e.start.style));return{partsAndWires:t,wires:[],parts:[],hideBreadboard:e}}return{partsAndWires:[],wires:[],parts:[]}}}f.allocateDefinitions=function(e){return new t(e).allocAll()}}(pxsim=pxsim||{}),function(e){{var s=e.protocol||(e.protocol={});class t{constructor(e){this.seq=0,this.type=e}}s.Message=t,s.Response=class extends t{constructor(e,t){super("response"),this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};class n extends t{constructor(e,t){super("event"),this.event=e,t&&(this.body=t)}}s.Event=n,s.Source=class{constructor(e,t,n=0,i,r){this.name=e,this.path=t,this.sourceReference=n,i&&(this.origin=i),r&&(this.adapterData=r)}},s.Scope=class{constructor(e,t,n=!1){this.name=e,this.variablesReference=t,this.expensive=n}},s.StackFrame=class{constructor(e,t,n,i=0,r=0){this.id=e,this.source=n,this.line=i,this.column=r,this.name=t}},s.Thread=class{constructor(e,t){this.id=e,this.name=t||"Thread #"+e}},s.Variable=class{constructor(e,t,n=0,i,r){this.name=e,this.value=t,this.variablesReference=n,"number"==typeof r&&(this.namedVariables=r),"number"==typeof i&&(this.indexedVariables=i)}},s.Breakpoint=class{constructor(e,t,n,i){this.verified=e;"number"==typeof t&&(this.line=t),"number"==typeof n&&(this.column=n),i&&(this.source=i)}},s.Module=class{constructor(e,t){this.id=e,this.name=t}},s.CompletionItem=class{constructor(e,t,n=0){this.label=e,this.start=t,this.length=n}},s.StoppedEvent=class extends n{constructor(e,t,n=null){super("stopped"),this.body={reason:e,threadId:t},n&&(this.body.text=n)}},s.ContinuedEvent=class extends n{constructor(e,t){super("continued"),this.body={threadId:e},"boolean"==typeof t&&(this.body.allThreadsContinued=t)}},s.InitializedEvent=class extends n{constructor(){super("initialized")}},s.TerminatedEvent=class extends n{constructor(e){super("terminated"),"boolean"==typeof e&&(this.body={restart:e})}},s.OutputEvent=class extends n{constructor(e,t="console",n){super("output"),this.body={category:t,output:e},void 0!==n&&(this.body.data=n)}},s.ThreadEvent=class extends n{constructor(e,t){super("thread"),this.body={reason:e,threadId:t}}},s.BreakpointEvent=class extends n{constructor(e,t){super("breakpoint"),this.body={reason:e,breakpoint:t}}},s.ModuleEvent=class extends n{constructor(e,t){super("module"),this.body={reason:e,module:t}}};class i{constructor(){this._pendingRequests={}}start(e){this._sequence=1,this.host=e,this.host.onData(e=>{var t;"request"===e.type?this.dispatchRequest(e):"response"===e.type&&(t=this._pendingRequests[(e=e).seq])&&(delete this._pendingRequests[e.seq],t(e))})}stop(){this.host&&this.host.close()}sendEvent(e){this.send("event",e)}sendResponse(e){0<e.seq?console.error("attempt to send more than one response for command "+e.command):this.send("response",e)}sendRequest(t,e,n,i){const r={command:t};if(e&&0<Object.keys(e).length&&(r.arguments=e),this.send("request",r),i){this._pendingRequests[r.seq]=i;const t=setTimeout(()=>{clearTimeout(t);var e=this._pendingRequests[r.seq];e&&(delete this._pendingRequests[r.seq],e(new s.Response(r,"timeout")))},n)}}send(e,t){if(t.type=e,t.seq=this._sequence++,this.host){const e=JSON.stringify(t);this.host.send(e)}}dispatchRequest(e){}}s.ProtocolServer=i;class a extends i{constructor(){super(...arguments),this._debuggerLinesStartAt1=!1,this._debuggerColumnsStartAt1=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0}shutdown(){}dispatchRequest(e){var t=new s.Response(e);try{if("initialize"===e.command){var n=e.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null);else{const e=t;e.body={},this.initializeRequest(e,n)}}else"launch"===e.command?this.launchRequest(t,e.arguments):"attach"===e.command?this.attachRequest(t,e.arguments):"disconnect"===e.command?this.disconnectRequest(t,e.arguments):"setBreakpoints"===e.command?this.setBreakPointsRequest(t,e.arguments):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(t,e.arguments):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(t,e.arguments):"configurationDone"===e.command?this.configurationDoneRequest(t,e.arguments):"continue"===e.command?this.continueRequest(t,e.arguments):"next"===e.command?this.nextRequest(t,e.arguments):"stepIn"===e.command?this.stepInRequest(t,e.arguments):"stepOut"===e.command?this.stepOutRequest(t,e.arguments):"stepBack"===e.command?this.stepBackRequest(t,e.arguments):"restartFrame"===e.command?this.restartFrameRequest(t,e.arguments):"goto"===e.command?this.gotoRequest(t,e.arguments):"pause"===e.command?this.pauseRequest(t,e.arguments):"stackTrace"===e.command?this.stackTraceRequest(t,e.arguments):"scopes"===e.command?this.scopesRequest(t,e.arguments):"variables"===e.command?this.variablesRequest(t,e.arguments):"setVariable"===e.command?this.setVariableRequest(t,e.arguments):"source"===e.command?this.sourceRequest(t,e.arguments):"threads"===e.command?this.threadsRequest(t):"evaluate"===e.command?this.evaluateRequest(t,e.arguments):"stepInTargets"===e.command?this.stepInTargetsRequest(t,e.arguments):"gotoTargets"===e.command?this.gotoTargetsRequest(t,e.arguments):"completions"===e.command?this.completionsRequest(t,e.arguments):this.customRequest(e.command,t,e.arguments)}catch(e){this.sendErrorResponse(t,1104,"{_stack}",{_exception:e.message,_stack:e.stack})}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,this.sendResponse(e)}disconnectRequest(e,t){this.sendResponse(e),this.shutdown()}launchRequest(e,t){this.sendResponse(e)}attachRequest(e,t){this.sendResponse(e)}setBreakPointsRequest(e,t){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t){this.sendResponse(e)}configurationDoneRequest(e,t){this.sendResponse(e)}continueRequest(e,t){this.sendResponse(e)}nextRequest(e,t){this.sendResponse(e)}stepInRequest(e,t){this.sendResponse(e)}stepOutRequest(e,t){this.sendResponse(e)}stepBackRequest(e,t){this.sendResponse(e)}restartFrameRequest(e,t){this.sendResponse(e)}gotoRequest(e,t){this.sendResponse(e)}pauseRequest(e,t){this.sendResponse(e)}sourceRequest(e,t){this.sendResponse(e)}threadsRequest(e){this.sendResponse(e)}stackTraceRequest(e,t){this.sendResponse(e)}scopesRequest(e,t){this.sendResponse(e)}variablesRequest(e,t){this.sendResponse(e)}setVariableRequest(e,t){this.sendResponse(e)}evaluateRequest(e,t){this.sendResponse(e)}stepInTargetsRequest(e,t){this.sendResponse(e)}gotoTargetsRequest(e,t){this.sendResponse(e)}completionsRequest(e,t){this.sendResponse(e)}customRequest(e,t,n){this.sendErrorResponse(t,1014,"unrecognized request",null)}sendErrorResponse(e,t,n,i){let r;"number"==typeof t?(r={id:t,format:n},i&&(r.variables=i),r.showUser=!0):r=t,e.success=!1,a.formatPII(r.format,!0,r.variables),e.body||(e.body={}),e.body.error=r,this.sendResponse(e)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?a.uri2path(e):a.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?a.uri2path(e):a.path2uri(e):e}static path2uri(e){let t=e.replace(/\\/g,"/");return"/"!==t[0]&&(t="/"+t),encodeURI("file://"+t)}static uri2path(e){return e}static formatPII(e,n,i){return e.replace(a._formatPIIRegexp,function(e,t){return!(n&&0<t.length&&"_"!==t[0])&&i[t]&&i.hasOwnProperty(t)?i[t]:e})}}a._formatPIIRegexp=/{([^}]+)}/g,s.DebugSession=a}}(pxsim=pxsim||{}),function(e){function o(e){e=e.replace(/\\/g,"/");const t=[];return e.split("/").forEach(e=>{".."===e&&t.length?t.pop():e&&"."!==e&&t.push(e)}),t}(e=e.util||(e.util={})).injectPolyphils=function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return void 0!==e&&null!=e&&this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError("this is null or not defined");let t=Object(this),n=t.length>>>0,i=arguments[1],r=i>>0,s=r<0?Math.max(n+r,0):Math.min(r,n),a=arguments[2],o=void 0===a?n:a>>0,l=o<0?Math.max(n+o,0):Math.min(o,n);for(;s<l;)t[s]=e,s++;return t}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{writable:!0,enumerable:!0,value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this);const n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");var i=arguments[1];let r=0;for(;r<n;){const n=t[r];if(e.call(i,n,r,t))return n;r++}}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint8Array.prototype.some||Object.defineProperty(Uint8Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint16Array.prototype.some||Object.defineProperty(Uint16Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint32Array.prototype.some||Object.defineProperty(Uint32Array.prototype,"some",{value:Array.prototype.some,writable:!0,enumerable:!0}),Uint8Array.prototype.reverse||Object.defineProperty(Uint8Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint16Array.prototype.reverse||Object.defineProperty(Uint16Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Uint32Array.prototype.reverse||Object.defineProperty(Uint32Array.prototype,"reverse",{value:Array.prototype.reverse,writable:!0,enumerable:!0}),Math.imul||(Math.imul=function(e,t){var n=65535&e,i=65535&t;return n*i+((e>>>16&65535)*i+n*(t>>>16&65535)<<16>>>0)|0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");var n=Object(e);for(let e=1;e<arguments.length;e++){var i=arguments[e];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},writable:!0,configurable:!0}),Promise.prototype.finally||(Promise.prototype.finally=Promise.prototype.finally||{finally(t){const n=e=>Promise.resolve(t()).then(e);return this.then(e=>n(()=>e),e=>n(()=>Promise.reject(e)))}}.finally)},e.Lazy=class{constructor(e){this._func=e,this._evaluated=!1}get value(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value}},e.getNormalizedParts=o,e.normalizePath=function(e){return o(e).join("/")},e.relativePath=function(e,t){var n=o(e),i=o(t);let r=0;for(;n[r]===i[r]&&++r!==n.length&&r!==i.length;);var s=n.slice(r),a=i.slice(r);for(let e=0;e<s.length;e++)a.unshift("..");return a.join("/")},e.pathJoin=function(...e){let t="";return e.forEach(e=>{e.replace(/\\/g,"/"),e.lastIndexOf("/")===e.length-1&&(e=e.slice(0,e.length-1)),t+="/"+e}),t},e.toArray=function(t){if(Array.isArray(t))return t;var n=[];for(let e=0;e<t.length;++e)n.push(t[e]);return n}}(pxsim=pxsim||{}),function(a){function c(e,t){switch(typeof e){case"string":case"number":case"boolean":return e;case"function":return{text:"(function)",type:"function"};case"undefined":return null;case"object":var n,i;return e?e instanceof a.RefObject?(t&&(t[e.id]=e),i=(n=a.RefObject.toDebugString(e)).startsWith("[")?"array":n,{id:e.id,preview:n,hasFields:null!==e.fields||n.startsWith("["),type:i}):e._width&&e._height?{text:e._width+"x"+e._height,type:"image"}:{text:"(object)",type:"object"}:null;default:throw new Error}}function o(e,n,t,i){{var r=e,s;e=t;const l={};for(s of Object.keys(r))/^__/.test(s)||!/___\d+$/.test(s)||i&&-1===i.indexOf(s)||(l[s]=c(r[s],n));if(r.fields&&e)for(var a of e)a=a.substring(a.lastIndexOf(".")+1),l[a]=c(function(e,t){let n={pc:0,arg0:t,fn:e,parent:{}};for(;n.fn;)n=n.fn(n);return n.retval}(r.vtable.iface[a],r),n);if(r.fields)for(var o of Object.keys(r.fields).filter(e=>!e.startsWith("_")))l[o]=c(r.fields[o],n);else Array.isArray(r.data)&&r.data.forEach((e,t)=>{l[t]=c(e,n)});return l}}a.getWarningMessage=function(e){let t={type:"debugger",subtype:"warning",breakpointIds:[],message:e},n=a.runtime.currFrame;for(;null!=n;)t.breakpointIds.push(n.lastBrkId),n=n.parent;return t},a.BreakpointMap=class{constructor(e){this.fileMap={},this.idMap={},e.forEach(e=>{var[t,n]=e;this.fileMap[n.source.path]||(this.fileMap[n.source.path]=[]),this.fileMap[n.source.path].push(e),this.idMap[t]=n});for(const e in this.fileMap){var t=this.fileMap[e];this.fileMap[e]=t.sort(([,e],[,t])=>e.line===t.line?t.endLine===e.endLine?e.column-t.column:t.endLine-e.endLine:e.line-t.line)}}getById(e){return this.idMap[e]}verifyBreakpoint(e,t){var n=this.fileMap[e];let i;if(n)for(const[e,r]of n)r.line<=t.line&&r.endLine>=t.line&&(i=[e,r]);return i?(i[1].verified=!0,i):[-1,{verified:!1}]}},a.dumpHeap=o,a.injectEnvironmentGlobals=function(e,t){var n=a.runtime.environmentGlobals;if(Object.keys(n).length){const i=e.environmentGlobals={};Object.keys(n).forEach(e=>i[e]=c(a.runtime.environmentGlobals[e],t))}},a.getBreakpointMsg=function(e,t,n){for(var i={},r={type:"debugger",subtype:"breakpoint",breakpointId:t,globals:o(a.runtime.globals,i,void 0,n),stackframes:[]};null!=e;){var s=function(n,i){var e=n.fn?n.fn.info:null;if(e){var t={thisParam:c(n.argL,i),params:[]};if(e.argumentNames){const o=e.argumentNames;t.params=o.map((e,t)=>({name:e,value:c(n["arg"+t],i)}))}return{locals:o(n,i),funcInfo:e,breakpointId:n.lastBrkId,callLocationId:n.callLocIdx,arguments:t}}}(e,i);s&&r.stackframes.push(s),e=e.parent}return{msg:r,heap:i}};class t extends a.protocol.DebugSession{constructor(e){super(),this.driver=new a.SimulatorDriver(e,{onDebuggerBreakpoint:e=>this.onDebuggerBreakpoint(e),onDebuggerWarning:e=>this.onDebuggerWarning(e),onDebuggerResume:()=>this.onDebuggerResume(),onStateChanged:e=>this.onStateChanged(e)})}runCode(e,t,n,i,r){this.breakpoints=i,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new a.protocol.InitializedEvent),this.driver.run(e,{parts:t,fnArgs:n,boardDefinition:r})}stopSimulator(e=!1){this.driver.stop(e)}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsConfigurationDoneRequest=!0,this.sendResponse(e)}disconnectRequest(e,t){this.sendResponse(e),this.shutdown()}launchRequest(e,t){this.projectDir||(this.projectDir=a.util.normalizePath(t.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(e)}setBreakPointsRequest(n,i){n.body={breakpoints:[]};const r=[];i.breakpoints.forEach(e=>{var t;this.breakpoints?([e,t]=this.breakpoints.verifyBreakpoint(a.util.relativePath(this.projectDir,i.source.path),e),n.body.breakpoints.push(t),t.verified&&r.push(e)):n.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(r),this.sendResponse(n)}continueRequest(e,t){this.driver.resume(a.SimulatorDebuggerCommand.Resume),this.sendResponse(e)}nextRequest(e,t){this.driver.resume(a.SimulatorDebuggerCommand.StepOver),this.sendResponse(e)}stepInRequest(e,t){this.driver.resume(a.SimulatorDebuggerCommand.StepInto),this.sendResponse(e)}stepOutRequest(e,t){this.driver.resume(a.SimulatorDebuggerCommand.StepOut),this.sendResponse(e)}pauseRequest(e,t){this.driver.resume(a.SimulatorDebuggerCommand.Pause),this.sendResponse(e)}threadsRequest(e){e.body={threads:[{id:t.THREAD_ID,name:"main"}]},this.sendResponse(e)}stackTraceRequest(e,t){if(this.lastBreak){const t=this.state.getFrames();e.body={stackFrames:t}}this.sendResponse(e)}scopesRequest(e,t){this.state&&(e.body={scopes:this.state.getScopes(t.frameId)}),this.sendResponse(e)}variablesRequest(e,t){this.state&&(e.body={variables:this.state.getVariables(t.variablesReference)}),this.sendResponse(e)}onDebuggerBreakpoint(e){this.lastBreak=e,this.state=new n(this.lastBreak,this.breakpoints,this.projectDir),e.exceptionMessage?(e=e.exceptionMessage.replace(/___\d+/g,""),this.sendEvent(new a.protocol.StoppedEvent("exception",t.THREAD_ID,e))):this.sendEvent(new a.protocol.StoppedEvent("breakpoint",t.THREAD_ID))}onDebuggerWarning(e){}onDebuggerResume(){this.sendEvent(new a.protocol.ContinuedEvent(t.THREAD_ID,!0))}onStateChanged(e){switch(e){case a.SimulatorState.Paused:break;case a.SimulatorState.Running:this.sendEvent(new a.protocol.ContinuedEvent(t.THREAD_ID,!0));break;case a.SimulatorState.Stopped:this.sendEvent(new a.protocol.TerminatedEvent)}}fixBreakpoints(){for(const t in this.breakpoints.idMap){var e=this.breakpoints.idMap[t];e.source.path=a.util.pathJoin(this.projectDir,e.source.path),e.line=this.convertDebuggerLineToClient(e.line),e.endLine=this.convertDebuggerLineToClient(e.endLine),e.column=this.convertDebuggerColumnToClient(e.column),e.endColumn=this.convertDebuggerColumnToClient(e.endColumn)}}}t.THREAD_ID=1,a.SimDebugSession=t;class n{constructor(e,t,n){this._message=e,this._map=t,this._dir=n,this._currentId=1,this._frames={},this._vars={};e=this.nextId();this._vars[e]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:e,expensive:!1}}getFrames(){return this._message.stackframes.map((e,t)=>{var n=this._map.getById(e.breakpointId);if(n)return{id:(this._frames[e.breakpointId]=e).breakpointId,name:e.funcInfo?e.funcInfo.functionName:0===t?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(e=>!!e)}getScopes(e){var t=this._frames[e];if(t){const e=this.nextId();return this._vars[e]=this.getVariableValues(t.locals),[{name:"Locals",variablesReference:e,expensive:!1},this._globalScope]}return[this._globalScope]}getVariables(e){e=this._vars[e];return e&&e.value||[]}getVariableValues(s){return new a.util.Lazy(()=>{var n=[];for(const r in s){var i=s[r];let e,t=0;null===i?e="null":void 0===i?e="undefined":"object"==typeof i?(e="(object)",t=this.nextId(),this._vars[t]=this.getVariableValues(i)):e=i.toString();i=r.substr(0,r.lastIndexOf("___"));n.push({name:i,value:e,variablesReference:t})}return n})}nextId(){return this._currentId++}}}(pxsim=pxsim||{}),function(a){function o(e=0){function t(){try{window.print()}catch(e){}}e?setTimeout(t,e):t()}function l(e,t){i({type:"pxtsim",action:"event",tick:e,data:t})}function i(e){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}function n(){setInterval(()=>{a.Runtime.postMessage({type:"simulator",command:"reload"})},3e3)}a.print=o;{var r=a.Embed||(a.Embed={});function c(e){e.origin;var t,n=e.data||{},e=n.type;if(e)switch(e){case"run":d(n);break;case"instructions":a.instructions.renderInstructions(n);break;case"stop":u();break;case"mute":h(n.mute);break;case"stopsound":a.AudioContextManager.stopAll();break;case"print":o();break;case"recorder":var i=n;if(s)switch(i.action){case"start":s.startRecording(i.width);break;case"stop":s.stopRecording()}break;case"screenshot":a.Runtime.postScreenshotAsync(n);break;case"custom":a.handleCustomMessage&&a.handleCustomMessage(n);break;case"pxteditor":break;case"debugger":s&&s.handleDebuggerMsg(n);break;case"simulator":var r=n;switch(r.command){case"focus":l("simulator.focus",{timestamp:r.timestamp});break;case"blur":l("simulator.blur",{timestamp:r.timestamp})}default:t=n,s&&!s.dead&&s.board.receiveMessage(t)}}let s;function u(){s&&(s.kill(),s.board)&&s.board.kill()}function d(e){u(),e.mute&&h(e.mute),e.localizedStrings&&a.localization.setLocalizedStrings(e.localizedStrings);const t=new a.Runtime(e);(s=t).board.initAsync(e).then(()=>{t===s&&t.run(e=>{a.dumpLivePointers(),a.Runtime.postMessage({type:"toplevelcodefinished"})})})}function h(e){a.AudioContextManager.mute(e)}r.start=function(){if(window.addEventListener("message",c,!1),r.frameid=window.location.hash.slice(1),"serviceWorker"in navigator&&-1!==window.location.href.indexOf("---simulator")&&!a.U.isLocalHost()){const a=window.location.pathname,t=a.substring(1,a.indexOf("---"));navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",e=>{e=e.data;e&&"serviceworker"===e.type&&"activated"===e.state&&e.ref===t&&n()});var e=window.location.href.replace(/---simulator.*$/,"---simserviceworker");navigator.serviceWorker.register(e).then(function(e){console.log("Simulator ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("Simulator ServiceWorker registration failed: ",e)})}a.Runtime.postMessage({type:"ready",frameid:r.frameid})},r.stop=u,r.run=d}a.tickEvent=l,a.reportError=function(e,t,n){i({type:"pxtsim",action:"event",tick:"error",category:e,message:t,data:n})},a.reload=n}(pxsim=pxsim||{}),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(e){pxsim.Embed.start()}),function(x){{var e=x.instructions||(x.instructions={});const l=e=>e+"x",[n,i]=[816*.95,1056*.95],r=n-86.4,s=i-86.4,[a,c]=[1,1],u=r/c-48*c,d=`
            .instr-panel {
                margin: 20px;
                padding: 24px;
                border-width: 4px;
                border-color: gray;
                border-style: solid;
                border-radius: 20px;
                display: inline-block;
                width: ${u}px;
                height: ${s/a-48*a}px;
                position: relative;
                overflow: hidden;
                page-break-inside: avoid;
            }
            .board-svg {
                margin: 0 auto;
                display: block;
                position: absolute;
                bottom: 24px;
                left: ${(u-465)/2+24}px;
            }
            .panel-num-outer {
                position: absolute;
                left: -4px;
                top: -4px;
                width: 120px;
                height: 120px;
                border-width: 4px;
                border-style: solid;
                border-color: gray;
                border-radius: 20px 0 20px 0;
            }
            .panel-num {
                margin: 10px 0;
                text-align: center;
                font-size: 80px;
            }
            .cmp-div {
                display: inline-block;
            }
            .reqs-div {
                margin-left: 144px;
                margin-top: 5px;
            }
            .partslist-wire,
            .partslist-cmp {
                margin: 10px;
            }
            .partslist-wire {
                display: inline-block;
            }
            `;function o(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i={l:0,t:0,w:0,h:0},r=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=(n.appendChild(r),r.appendChild(e.el),{viewBox:`${e.x} ${e.y} ${e.w} `+e.h,preserveAspectRatio:"xMidYMid"});i.w=e.w,i.h=e.h;var a,o,l,c,e=e=>{i.h*=e,i.w*=e,s.width=i.w,s.height=i.h},e=(t.cmpScale&&e(t.cmpScale),t.cmpWidth&&t.cmpWidth<i.w?e(t.cmpWidth/i.w):t.cmpHeight&&t.cmpHeight<i.h&&e(t.cmpHeight/i.h),x.svg.hydrate(r,s),i.l),u=i.t,d=i.w,h=i.h,p=e=>{var t;e<i.l&&(t=i.l-e,i.l=e,i.w+=t)},f=e=>{var t=i.l+i.w;t<e&&(e=e-t,i.w+=e)},m=e=>{var t;e<i.t&&(t=i.t-e,i.t=e,i.h+=t)},g=e=>{var t=i.t+i.h;t<e&&(e=e-t,i.h+=e)},[b,v]=[-.3,.3],y=[1.4,1],w=(t&&t.top&&(c=(w=t.topSize)/y[0],[o,a]=[e+d/2,u-3-(l=w/y[1])/2],w=x.visuals.mkTxt(o,a,w,0,t.top,b,v),x.U.addClass(w,"cmp-lbl"),n.appendChild(w),w=c*t.top.length,m(a-l/2),p(o-w/2),f(o+w/2)),t&&t.bot&&(a=(c=t.botSize)/y[0],[o,w]=[e+d/2,u+h+3+(l=c/y[1])/2],c=x.visuals.mkTxt(o,w,c,0,t.bot,b,v),x.U.addClass(c,"cmp-lbl"),n.appendChild(c),c=a*t.bot.length,g(w+l/2),p(o-c/2),f(o+c/2)),t&&t.right&&(w=(a=t.rightSize)/y[1],[o,c]=[e+d+5+(l=a/y[0]*t.right.length)/2,u+h/2],d=x.visuals.mkTxt(o,c,a,0,t.right,b,v),x.U.addClass(d,"cmp-lbl"),n.appendChild(d),m(c-w/2),f(o+l/2),g(c+w/2)),t&&t.left&&(d=(a=t.leftSize)/y[1],[o,l]=[e-5-(f=a/y[0]*t.left.length)/2,u+h/2],c=x.visuals.mkTxt(o,l,a,0,t.left,b,v),x.U.addClass(c,"cmp-lbl"),n.appendChild(c),m(l-d/2),p(o-f/2),g(l+d/2)),{viewBox:`${i.l} ${i.t} ${i.w} `+i.h,width:1.7*i.w,height:1.7*i.h,preserveAspectRatio:"xMidYMid"}),e=(x.svg.hydrate(n,w),document.createElement("div"));return e.appendChild(n),e}function h(e,t){let n,i=x.runtime.board;return o(n="wire"==e?x.visuals.mkWirePart([0,0],t.wireClr||"red",t.crocClips):"string"==typeof(e=e).builtIn?(0,i.builtinPartVisuals[e.builtIn])([0,0]):x.visuals.mkGenericPartSVG(e),t)}function p(e,t,n=!1){t={state:x.runtime.board,boardDef:e.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:e.allAlloc.requiresBreadboard,partDefs:e.cmpDefs,maxWidth:t+"px",fnArgs:e.fnArgs,wireframe:n,partsList:[]},e=new x.visuals.BoardHost(x.visuals.mkBoardView({visual:t.boardDef.visual,boardDef:t.boardDef,wireframe:t.wireframe}),t),n=e.getView();return x.U.addClass(n,"board-svg"),e}function f(){var e=document.createElement("div");return x.U.addClass(e,"instr-panel"),e}function t(t,e){e.boardDef.pinStyles||(e.boardDef.pinStyles={}),e.configData&&x.setConfigData(e.configData.cfg,e.configData.cfgKey);var n,i={type:"run",code:"",boardDefinition:e.boardDef,partDefinitions:e.partDefinitions},i=(x.runtime=new x.Runtime(i),x.runtime.board=null,x.initCurrentRuntime(i),document.createElement("style")),i=(i.textContent+=d,document.head.appendChild(i),e.partDefinitions),r=new x.visuals.Breadboard({}),s=function(e){let t=x.allocateDefinitions(e),r=[],s=[],a=1,n=(t.partsAndWires.forEach(e=>{let n=e.part,i=e.wires;e.assembly.forEach((e,t)=>{e.part&&n&&(s[a+t]=[n]),e.wireIndices&&0<e.wireIndices.length&&i&&(r[a+t]=e.wireIndices.map(e=>i[e]))}),a+=e.assembly.length}),a-1),i=t.partsAndWires.map(e=>e.part).filter(e=>!!e),o=t.partsAndWires.map(e=>e.wires||[]).reduce((e,t)=>e.concat(t),[]),l={},c=[];return o.forEach(e=>{l[e.color]||(l[e.color]=[],c.push(e.color)),l[e.color].push(e)}),{boardDef:e.boardDef,cmpDefs:e.partDefs,fnArgs:e.fnArgs,allAlloc:t,stepToWires:r,stepToCmps:s,allWires:o,allCmps:i,lastStep:n,colorToWires:l,allWireColors:c}}({boardDef:e.boardDef,partDefs:i,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:r.getCoord.bind(r)}),i=(s.allAlloc.requiresBreadboard=!0,i=s,r=document.getElementById("front-panel"),(n=p(i,400,!1)).addAll(i.allAlloc),r.appendChild(n.getView()),function(i){let r=f();var e=o((e=i.boardDef,x.visuals.mkBoardView({visual:e.visual,boardDef:e}).getView()),{left:l(1),leftSize:30,cmpScale:.17}),e=(r.appendChild(e),o(new x.visuals.Breadboard({}).getSVGAndSize(),{left:l(1),leftSize:30,cmpScale:.25}));return r.appendChild(e),i.allCmps.forEach(e=>{let t=1;"buttonpair"===e.visual.builtIn&&(t=2);e=h(e.visual,{left:l(t),leftSize:30,cmpScale:.3});x.U.addClass(e,"partslist-cmp"),r.appendChild(e)}),i.allWireColors.forEach(e=>{var t=i.colorToWires[e].length,n=i.boardDef.pinStyles[e]||"female",t=h("wire",{left:l(t),leftSize:20,wireClr:e,cmpScale:.23,crocClips:"croc"==n});x.U.addClass(t,"partslist-wire"),r.appendChild(t)}),r}(s));t.appendChild(i);for(let e=0;e<=s.lastStep;e++){var a=function(e,n){var t=f(),i=p(n,465,!0),r=i,s=e,a=n,o=r.getView();0<s&&x.U.addClass(o,"grayed");for(let n=0;n<=s;n++){var l=a.stepToCmps[n],l=(l&&l.forEach(e=>{var t=r.addPart(e);n===s&&(e.breadboardConnections.forEach(e=>r.highlightBreadboardPin(e)),x.U.addClass(t.element,"notgrayed"))}),a.stepToWires[n]);l&&l.forEach(e=>{var t=r.addWire(e);t&&n===s&&("breadboard"==e.start.type?r.highlightBreadboardPin(e.start):r.highlightBoardPin(e.start.pin),"breadboard"==e.end.type?r.highlightBreadboardPin(e.end):r.highlightBoardPin(e.end.pin),r.highlightWire(t))})}t.appendChild(i.getView()),o=document.createElement("div"),x.U.addClass(o,"panel-num-outer"),x.U.addClass(o,"noselect"),t.appendChild(o),i=document.createElement("div"),x.U.addClass(i,"panel-num"),i.textContent=e+1+"",o.appendChild(i);let c=document.createElement("div"),u=(x.U.addClass(c,"reqs-div"),t.appendChild(c),n.stepToWires[e]||[]),d=e=>{var t,n;return"breadboard"===e.type?({row:t,col:n}=e,`(${t},${n})`):e.pin};return u.forEach(e=>{let t=!1;"dalboard"==e.end.type&&(t="croc"==n.boardDef.pinStyles[e.end.pin]);e=h("wire",{top:d(e.end),topSize:10,bot:d(e.start),botSize:10,wireClr:e.color,cmpHeight:40,crocClips:t});x.U.addClass(e,"cmp-div"),c.appendChild(e)}),(n.stepToCmps[e]||[]).forEach(s=>{("buttonpair"===s.visual.builtIn?[s.breadboardConnections[0],s.breadboardConnections[2]]:[s.breadboardConnections[0]]).forEach((e,t)=>{let n;var i;n=e?({row:e,col:i}=e,`(${e},${i})`):"";let r=1.5;"buttonpair"===s.visual.builtIn&&(r*=.5);e=h(s.visual,{top:n,topSize:10,cmpHeight:50,cmpScale:r});x.U.addClass(e,"cmp-div"),c.appendChild(e)})}),t}(e,s);t.appendChild(a)}e.print&&x.print(2e3)}e.renderParts=t,e.renderInstructions=function(e){document.getElementById("proj-title").innerText=e.options.name||"",t(document.body,e.options)}}}(pxsim=pxsim||{}),function(d){function i(e,t="sim: check failed"){if(!e)throw new Error(t)}d.quiet=!1,d.check=i,d.title="";let e,t,n,r,s,a={},o={};d.getConfig=function(e){return o.hasOwnProperty(e+"")?o[e+""]:null},d.getConfigKey=function(e){return a.hasOwnProperty(e)?a[e]:null},d.getAllConfigKeys=function(){return Object.keys(a)},d.setConfigKey=function(e,t){a[e]=t},d.setConfig=function(e,t){o[e]=t},d.setConfigData=function(e,t){o=e,a=t},d.getConfigData=function(){return{cfg:o,cfgKey:a}},d.setTitle=function(e){d.title=e};class l{constructor(){d.runtime?this.id=d.runtime.registerLiveObject(this):this.id=0}destroy(){}scan(e){throw d.U.userError("scan not implemented")}gcKey(){throw d.U.userError("gcKey not implemented")}gcSize(){throw d.U.userError("gcSize not implemented")}gcIsStatic(){return!1}print(){d.runtime&&d.runtime.refCountingDebug&&console.log("RefObject id:"+this.id)}toDebugString(){return"(object)"}static toAny(e){return e&&e.toAny?e.toAny():e}static toDebugString(e){return null===e?"null":void 0===e?"undefined;":e.vtable&&e.vtable.name?e.vtable.name:e.toDebugString?e.toDebugString():"string"==typeof e?JSON.stringify(e):e.toString()}}d.RefObject=l;class c{constructor(e,t,n){this.func=e,this.caps=t,this.args=n}}d.FnWrapper=c;class u extends l{constructor(){super(...arguments),this.fields={}}scan(e){for(var t of Object.keys(this.fields))e(t,this.fields[t])}gcKey(){return this.vtable.name}gcSize(){return this.vtable.numFields+1}destroy(){this.fields=null,this.vtable=null}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefRecord id:${this.id} (${this.vtable.name})`)}}d.RefRecord=u;class h extends l{constructor(){super(...arguments),this.fields=[]}scan(t){for(let e=0;e<this.fields.length;++e)t("_cap"+e,this.fields[e])}gcKey(){return d.functionName(this.func)}gcSize(){return this.fields.length+3}isRef(e){return i(0<=e&&e<this.fields.length),e<this.len}ldclo(e){return i(0<=(e>>=2)&&e<this.fields.length),this.fields[e]}destroy(){this.fields=null,this.func=null}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefAction id:${this.id} len:`+this.fields.length)}}d.RefAction=h;{var p=e=d.pxtcore||(d.pxtcore={});p.seedAddRandom=function(e){},p.mkAction=function(t,e){var n=new h;n.len=t,n.func=e;for(let e=0;e<t;++e)n.fields.push(null);return n},p.runAction=function(e,t){d.getResume()(e instanceof h?new c(e.func,e.fields,t):new c(e,null,t))};let u={};p.dumpPerfCounters=function(){if(d.runtime&&d.runtime.perfCounters){let e="calls,us,name\n";for(var t of d.runtime.perfCounters){t.lastFew.sort();const d=t.lastFew[t.lastFew.length>>1];e+=`${t.numstops},${t.value},${t.name},${d}\n`}{var i=e;let n="";const o=(e,t)=>{n+=e.length>=t?e:("              "+e).slice(-t)},l=e=>o(""+Math.round(e),6),c=(e,t)=>{o(Math.round(t)+"",8),n+=" /",l(e),n+=" =",l(t/e)};for(var r of i.split(/\n/))if(r&&/^\d/.test(r)){const i=r.split(/,/);let e=u[i[2]];e||(u[i[2]]=e={stops:0,us:0,meds:[]}),r=i[2],n+=25<=r.length?r:(r+"                         ").slice(0,25);var r=parseInt(i[0]),s=parseInt(i[1]),a=(c(r,s),n+=" |",c(r-e.stops,s-e.us),n+=" ~",parseInt(i[3])),a=(l(a),10<e.meds.length&&e.meds.shift(),e.meds.push(a),e.meds.slice()),a=(a.sort((e,t)=>e-t),a[a.length>>1]);n+=" ~~",l(a),e.stops=r,e.us=s,n+="\n"}console.log(n)}}}}class f extends l{constructor(){super(...arguments),this.v=void 0}scan(e){e("*",this.v)}gcKey(){return"LOC"}gcSize(){return 2}destroy(){}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefRefLocal id:${this.id} v:`+this.v)}}d.RefRefLocal=f;class m extends l{constructor(){super(...arguments),this.vtable=d.mkMapVTable(),this.data=[]}scan(e){for(var t of this.data)e(t.key,t.val)}gcKey(){return"{...}"}gcSize(){return 2*this.data.length+4}findIdx(t){t+="";for(let e=0;e<this.data.length;++e)if(this.data[e].key==t)return e;return-1}destroy(){super.destroy();for(let e=0;e<this.data.length;++e)this.data[e].val=0;this.data=[]}print(){d.runtime&&d.runtime.refCountingDebug&&console.log(`RefMap id:${this.id} size:`+this.data.length)}toAny(){const t={};return this.data.forEach(e=>{t[e.key]=l.toAny(e.val)}),t}}function g(){d.runtime&&d.runtime.dumpLivePointers()}var b;function v(e,t){return t+="",e instanceof u?e.fields[t]:(t=e.findIdx(t))<0?void 0:e.data[t].val}function y(e,t,n){var i;t+="",e instanceof u?e.fields[t]=n:(i=e.findIdx(t))<0?e.data.push({key:t,val:n}):e.data[i].val=n}d.RefMap=m,d.dumpLivePointers=g,(p=t=d.numops||(d.numops={})).toString=function(e){return null===e?"null":void 0===e?"undefined":e.toString()},p.toBoolDecr=function(e){return!!e},p.toBool=function(e){return!!e},(p=n=d.langsupp||(d.langsupp={})).toInt=function(e){return 0|e},p.toFloat=function(e){return e},p.ignore=function(e){return e},(p=e=d.pxtcore||(d.pxtcore={})).ptrOfLiteral=function(e){return e},p.debugMemLeaks=function(){g()},p.templateHash=function(){return 0},p.programHash=function(){return 0},p.programName=function(){return d.title},p.programSize=function(){return 0},p.afterProgramPage=function(){return 0},p.getConfig=function(e,t){e=d.getConfig(e);return null==e?t:e},p.toInt=function(e){return e>>0},p.toUInt=function(e){return e>>>0},p.toDouble=function(e){return e},p.toFloat=function(e){return e},p.fromInt=function(e){return e},p.fromUInt=function(e){return e},p.fromDouble=function(e){return e},p.fromFloat=function(e){return e},p.fromBool=function(e){return!!e},(b=r=d.pxtrt||(d.pxtrt={})).toInt8=function(e){return(255&e)<<24>>24},b.toInt16=function(e){return(65535&e)<<16>>16},b.toInt32=function(e){return 0|e},b.toUInt32=function(e){return e>>>0},b.toUInt8=function(e){return 255&e},b.toUInt16=function(e){return 65535&e},b.nullFix=function(e){return null==e||!1===e?0:!0===e?1:e},b.nullCheck=function(e){null==e&&d.U.userError("Dereferencing null/undefined value.")},b.panic=function(e){d.U.userError("PANIC! Code "+e)},b.stringToBool=function(e){return e?1:0},b.ptrToBool=function(e){return e?1:0},b.emptyToNull=function(e){return""==e?0:e},b.ldlocRef=function(e){return e.v},b.stlocRef=function(e,t){e.v=t},b.mklocRef=function(){return new f},b.stclo=function(e,t,n){return i(0<=t&&t<e.fields.length),i(null===e.fields[t]),e.fields[t]=n,e},b.runtimeWarning=function(e){d.Runtime.postMessage(d.getWarningMessage(e))},b.mkMap=function(){return new m},b.mapGet=function(e,t){return v(e,b.mapKeyNames[t])},b.mapSet=function(e,t,n){return y(e,b.mapKeyNames[t],n)},b.mapGetByString=v,b.mapDeleteByString=function(e,t){e instanceof m||b.panic(923);t=e.findIdx(t);return 0<=t&&e.data.splice(t,1),!0},b.mapSetGeneric=y,b.mapGetGeneric=v,b.mapSetByString=y,b.keysOf=function(e){var t=new d.RefCollection;if(e instanceof m)for(var n of e.data)t.push(n.key);return t},(p=e=d.pxtcore||(d.pxtcore={})).mkClassInstance=function(e){i(!!e.methods);var t=new u;return t.vtable=e,t},p.switch_eq=function(e,t){return e==t},p.typeOf=function(e){return typeof e},(p=s=d.thread||(d.thread={})).panic=r.panic,p.pause=function(e){let t=d.getResume();d.runtime.schedule(()=>{t()},e)},p.runInBackground=function(e){d.runtime.runFiberAsync(e)},p.forever=function(t){r.nullCheck(t),function e(){d.runtime.runFiberAsync(t).then(()=>d.U.delay(20)).then(e)}()}}(pxsim=pxsim||{}),function(s){class t extends s.RefObject{constructor(){super(),this.data=[]}scan(t){for(let e=0;e<this.data.length;++e)t("["+e+"]",this.data[e])}gcKey(){return"[...]"}gcSize(){return this.data.length+2}toArray(){return this.data.slice(0)}toAny(){return this.data.map(e=>s.RefObject.toAny(e))}toDebugString(){let t="[";for(let e=0;e<this.data.length;++e){0<e&&(t+=",");var n=s.RefObject.toDebugString(this.data[e]);if(100<t.length+n.length){0==e&&(t+=n.substr(0,100)),t+="...";break}t+=n}return t+="]"}destroy(){var t=this.data;for(let e=0;e<t.length;++e)t[e]=0;this.data=[]}isValidIndex(e){return 0<=e&&e<this.data.length}push(e){this.data.push(e)}pop(){return this.data.pop()}getLength(){return this.data.length}setLength(e){this.data.length=e}getAt(e){return this.data[e]}setAt(e,t){this.data[e]=t}insertAt(e,t){this.data.splice(e,0,t)}removeAt(e){return this.data.splice(e,1)[0]}indexOf(e,t){return this.data.indexOf(e,t)}print(){}}let e,n,i,r,a,o,l,c;var u;function d(e){return e<<16>>16}function h(e,t){return s.pxtrt.nullFix(e)==s.pxtrt.nullFix(t)}function p(e,t){if(s.pxtrt.nullCheck(e),e.isValidIndex(t))return e.removeAt(t)}function f(e,t,n){return s.pxtrt.nullCheck(e),e.indexOf(t,n)}s.RefCollection=t,(g=e=s.Array_||(s.Array_={})).mk=function(){return new t},g.isArray=function(e){return e instanceof t},g.length=function(e){return s.pxtrt.nullCheck(e),e.getLength()},g.setLength=function(e,t){s.pxtrt.nullCheck(e),e.setLength(t)},g.push=function(e,t){s.pxtrt.nullCheck(e),e.push(t)},g.pop=function(e,t){return s.pxtrt.nullCheck(e),e.pop()},g.getAt=function(e,t){return s.pxtrt.nullCheck(e),e.getAt(t)},g.removeAt=p,g.insertAt=function(e,t,n){s.pxtrt.nullCheck(e),e.insertAt(t,n)},g.setAt=function(e,t,n){s.pxtrt.nullCheck(e),e.setAt(t,n)},g.indexOf=f,g.removeElement=function(e,t){s.pxtrt.nullCheck(e);t=f(e,t,0);return 0<=t?(p(e,t),1):0},(g=n=s.Math_||(s.Math_={})).imul=Math.imul||function(e,t){var n=65535&e,i=65535&t;return n*i+((e>>>16&65535)*i+n*(t>>>16&65535)<<16>>>0)|0},g.idiv=function(e,t){return(0|e)/(0|t)|0},g.round=function(e){return Math.round(e)},g.roundWithPrecision=function(e,t){if((t|=0)<=0)return Math.round(e);if(0==e)return 0;let n=0;for(;0==n&&t<21;){var i=Math.pow(10,t++);n=Math.round(e*i+Number.EPSILON)/i}return n},g.ceil=function(e){return Math.ceil(e)},g.floor=function(e){return Math.floor(e)},g.sqrt=function(e){return Math.sqrt(e)},g.pow=function(e,t){return Math.pow(e,t)},g.clz32=function(e){return Math.clz32(e)},g.log=function(e){return Math.log(e)},g.log10=function(e){return Math.log10(e)},g.log2=function(e){return Math.log2(e)},g.exp=function(e){return Math.exp(e)},g.sin=function(e){return Math.sin(e)},g.sinh=function(e){return Math.sinh(e)},g.cos=function(e){return Math.cos(e)},g.cosh=function(e){return Math.cosh(e)},g.tan=function(e){return Math.tan(e)},g.tanh=function(e){return Math.tanh(e)},g.asin=function(e){return Math.asin(e)},g.asinh=function(e){return Math.asinh(e)},g.acos=function(e){return Math.acos(e)},g.acosh=function(e){return Math.acosh(e)},g.atan=function(e){return Math.atan(e)},g.atanh=function(e){return Math.atanh(e)},g.atan2=function(e,t){return Math.atan2(e,t)},g.trunc=function(e){return 0<e?Math.floor(e):Math.ceil(e)},g.random=function(){return Math.random()},g.randomRange=function(e,t){var n;return e==t?e:(t<e&&(n=e,e=t,t=n),Math.floor(e)==e&&Math.floor(t)==t?e+Math.floor(Math.random()*(t-e+1)):e+Math.random()*(t-e))},(g=i=s.Number_||(s.Number_={})).lt=function(e,t){return e<t},g.le=function(e,t){return e<=t},g.neq=function(e,t){return!h(e,t)},g.eq=h,g.eqDecr=function(e,t){return s.pxtrt.nullFix(e)==s.pxtrt.nullFix(t)},g.gt=function(e,t){return t<e},g.ge=function(e,t){return t<=e},g.div=function(e,t){return 0|Math.floor(e/t)},g.mod=function(e,t){return e%t},g.bnot=function(e){return~e},g.toString=function(e){return e+""},(g=r=s.thumb||(s.thumb={})).adds=function(e,t){return e+t|0},g.subs=function(e,t){return e-t|0},g.divs=function(e,t){return 0|Math.floor(e/t)},g.muls=function(e,t){return n.imul(e,t)},g.ands=function(e,t){return e&t},g.orrs=function(e,t){return e|t},g.eors=function(e,t){return e^t},g.lsls=function(e,t){return e<<t},g.lsrs=function(e,t){return e>>>t},g.asrs=function(e,t){return e>>t},g.bnot=function(e){return~e},g.ignore=function(e){return e},(g=a=s.avr||(s.avr={})).adds=function(e,t){return d(e+t)},g.subs=function(e,t){return d(e-t)},g.divs=function(e,t){return d(Math.floor(e/t))},g.muls=function(e,t){return d(n.imul(e,t))},g.ands=function(e,t){return d(e&t)},g.orrs=function(e,t){return d(e|t)},g.eors=function(e,t){return d(e^t)},g.lsls=function(e,t){return d(e<<t)},g.lsrs=function(e,t){return(65535&e)>>>t},g.asrs=function(e,t){return d(e>>t)},g.bnot=function(e){return~e},g.ignore=function(e){return e},(g=o=s.String_||(s.String_={})).stringConv=function(e){const t=s.getResume();e instanceof s.RefRecord&&e.vtable.toStringMethod?s.runtime.runFiberAsync(e.vtable.toStringMethod,e).then(()=>{t(s.runtime.currFrame.retval+"")}):t(e+"")},g.mkEmpty=function(){return""},g.fromCharCode=function(e){return String.fromCharCode(e)},g.toNumber=function(e){return parseFloat(e)},g.concat=function(e,t){return e+t},g.substring=function(e,t,n){return s.pxtrt.nullCheck(e),e.slice(t,t+n)},g.equals=function(e,t){return e==t},g.compare=function(e,t){return e==t?0:e<t?-1:1},g.compareDecr=function(e,t){return e==t?0:e<t?-1:1},g.length=function(e){return e.length},g.substr=function(e,t,n){return e.substr(t,n)},g.charAt=function(e,t){return e.charAt(t)},g.charCodeAt=function(e,t){return s.pxtrt.nullCheck(e),n=e,i=t,s.pxtrt.nullCheck(n),0<=i&&i<n.length?e.charCodeAt(t):0;var n,i},g.indexOf=function(e,t,n){return s.pxtrt.nullCheck(e),null==t?-1:e.indexOf(t,n)},g.lastIndexOf=function(e,t,n){return s.pxtrt.nullCheck(e),null==t?-1:e.lastIndexOf(t,n)},g.includes=function(e,t,n){return s.pxtrt.nullCheck(e),null!=t&&e.includes(t,n)},(g=l=s.Boolean_||(s.Boolean_={})).toString=function(e){return e?"true":"false"},g.bang=function(e){return!e};class m extends s.RefObject{constructor(e){super(),this.data=e,this.isStatic=!1}scan(e){}gcKey(){return"Buffer"}gcSize(){return 2+(this.data.length+3>>2)}gcIsStatic(){return this.isStatic}print(){}toDebugString(){return c.toHex(this)}}s.RefBuffer=m;{var g=c=s.BufferMethods||(s.BufferMethods={});let r;function b(e){let t=function(){switch(e){case r.Int8LE:return-1;case r.UInt8LE:return 1;case r.Int16LE:return-2;case r.UInt16LE:return 2;case r.Int32LE:return-4;case r.UInt32LE:return 4;case r.Int8BE:return-10;case r.UInt8BE:return 10;case r.Int16BE:return-20;case r.UInt16BE:return 20;case r.Int32BE:return-40;case r.UInt32BE:return 40;case r.Float32LE:return 4;case r.Float32BE:return 40;case r.Float64LE:return 8;case r.Float64BE:return 80;default:throw s.U.userError("bad format")}}(),n=!1,i=(t<0&&(n=!0,t=-t),!1);return 10<=t&&(i=!0,t/=10),{size:t,signed:n,swap:i,isFloat:e>=r.Float32LE}}function v(e){return new m(new Uint8Array(e))}function y(e,t){return s.pxtrt.nullCheck(e),0<=t&&t<e.data.length}function w(e,t){return y(e,t)?e.data[t]:0}function x(e){e.isStatic&&s.U.userError("Writing to read only buffer.")}function k(e,t,n){y(e,t)&&(x(e),e.data[t]=n)}function A(e,t,n=0,i=-1){n<0||n>e.data.length||(i<0&&(i=e.data.length),i=Math.min(i,e.data.length-n),x(e),e.data.fill(t,n,n+i))}function T(t,n,i,r,s){if(i.buffer===t.buffer)T(t,n,i.slice(r,r+s),0,s);else for(let e=0;e<s;++e)t[n+e]=i[r+e]}(u=r=g.NumberFormat||(g.NumberFormat={}))[u.Int8LE=1]="Int8LE",u[u.UInt8LE=2]="UInt8LE",u[u.Int16LE=3]="Int16LE",u[u.UInt16LE=4]="UInt16LE",u[u.Int32LE=5]="Int32LE",u[u.Int8BE=6]="Int8BE",u[u.UInt8BE=7]="UInt8BE",u[u.Int16BE=8]="Int16BE",u[u.UInt16BE=9]="UInt16BE",u[u.Int32BE=10]="Int32BE",u[u.UInt32LE=11]="UInt32LE",u[u.UInt32BE=12]="UInt32BE",u[u.Float32LE=13]="Float32LE",u[u.Float64LE=14]="Float64LE",u[u.Float32BE=15]="Float32BE",u[u.Float64BE=16]="Float64BE",g.getNumber=function(t,e,n){var i=b(e);if(i.isFloat)return e=t.data.buffer.slice(n,n+i.size),i.swap&&new Uint8Array(e).reverse(),new(4==i.size?Float32Array:Float64Array)(e)[0];let r=0;for(let e=0;e<i.size;++e){r<<=8;var s=i.swap?n+e:n+i.size-e-1;r|=t.data[s]}return i.signed?(e=32-8*i.size,r=r<<e>>e):r>>>=0,r},g.setNumber=function(t,e,n,i){var r=b(e);if(r.isFloat){var s=new Uint8Array(r.size);4==r.size?new Float32Array(s.buffer)[0]=i:new Float64Array(s.buffer)[0]=i,r.swap&&s.reverse();for(let e=0;e<r.size;++e)t.data[n+e]=s[e]}else for(let e=0;e<r.size;++e){var a=r.swap?n+r.size-e-1:n+e;t.data[a]=255&i,i>>=8}},g.createBuffer=v,g.createBufferFromHex=function(t){var n=v(t.length>>1);for(let e=0;e<t.length;e+=2)n.data[e>>1]=parseInt(t.slice(e,e+2),16);return n.isStatic=!0,n},g.isReadOnly=function(e){return e.isStatic},g.getBytes=function(e){return e.data},g.getUint8=w,g.getByte=w,g.setUint8=function(e,t,n){k(e,t,n)},g.setByte=k,g.length=function(e){return e.data.length},g.fill=A,g.slice=function(e,t,n){return t=Math.min(e.data.length,t),n<0&&(n=e.data.length),n=Math.min(n,e.data.length-t),new m(e.data.slice(t,t+n))},g.toHex=function(t){var n="0123456789abcdef";let i="";for(let e=0;e<t.data.length;++e)i=(i+=n[t.data[e]>>4])+n[15&t.data[e]];return i},g.toString=function(e){return s.U.fromUTF8Array(e.data)};const E=-2147483648;g.shift=function(e,t,n,i){i<0&&(i=e.data.length-n),n<0||n+i>e.data.length||n+i<n||0==i||0==t||t==E||0!=i&&0!=t&&t!=E&&(t<=-i||i<=t?A(e,0):(x(e),t<0?(T(e.data,n+(t=-t),e.data,n,i-t),e.data.fill(0,n,n+t)):(T(e.data,n,e.data,n+t,i-=t),e.data.fill(0,n+i,n+i+t))))},g.rotate=function(s,a,o,l){if(l<0&&(l=s.data.length-o),!(o<0||o+l>s.data.length||o+l<o||0==l||0==a||a==E)){x(s),a<0&&(a+=l<<8),(a%=l)<0&&(a+=l);let e=s.data,t=a,n=0,i=t,r=l;for(;n!=i;){var c=e[n+o];e[n+++o]=e[i+o],e[i+++o]=c,i==r?i=t:n==t&&(t=i)}}},g.write=function(e,t,n,i=0,r=-1){r<0&&(r=n.data.length),i<0||t<0||t>e.data.length||(r=Math.min(n.data.length-i,e.data.length-t))<0||(x(e),T(e.data,t,n.data,i,r))}}}(pxsim=pxsim||{}),function(t){(t.control||(t.control={})).createBufferFromUTF8=function(e){return new t.RefBuffer(t.U.toUTF8Array(e))}}(pxsim=pxsim||{}),function(e){{e=e.localization||(e.localization={});let i={};function r(e,i){return 0==i.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,t,n){let r=i[parseInt(t)],s="",a=/^:f(\d*)\.(\d+)/.exec(n);if(a){let e=parseInt(a[2]),t=parseInt(a[1])||0,n=/^0/.test(a[1])?"0":" ",i=r.toFixed(e);if(0<t&&0<e&&(t+=e+1),0<t)for(;i.length<t;)i=n+i;s=i}else s=":x"==n?"0x"+r.toString(16):void 0===r?"(undef)":null===r?"(null)":r.toString?r.toString():r+"";return":a"==n?/^\s*[euioah]/.test(s.toLowerCase())?s="an "+s:/^\s*[bcdfgjklmnpqrstvwxz]/.test(s.toLowerCase())&&(s="a "+s):":s"==n?s=1==r?"":"s":":q"==n?s=o(s):":jq"==n?s=l(s):":uri"==n?s=encodeURIComponent(s).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==n?s=encodeURI(s).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==n&&(s=(100*r).toFixed(1).toString()+"%"),s})}function o(e){return e&&e.replace(/([^\w .!?\-$])/g,e=>"&#"+e.charCodeAt(0)+";")}function l(e){return e.replace(/[^\w .!?\-$]/g,e=>{e=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-e.length)+e})}e.setLocalizedStrings=function(e){i=e||{}},e.lf=function(e,...t){let n=i[e]||e;return r(n=n.replace(/^\{(id|loc):[^\}]+\}/g,""),t)},e.fmt_va=r,e.htmlEscape=o,e.jsStringQuote=l}}(pxsim=pxsim||{}),function(pxsim){const MIN_MESSAGE_WAIT_MS=200;let tracePauseMs=0,U,pxtcore;!function(e){function t(e){return e.split(/\s+/).filter(e=>!!e)}function n(e){for(;e.firstChild;)e.removeChild(e.firstChild)}let i;e.containsClass=function(n,e){return t(e).every(e=>{return e=e,(t=n).classList?t.classList.contains(e):!((t.className+"").split(/\s+/).indexOf(e)<0);var t})},e.addClass=function(n,e){t(e).forEach(e=>{var t;e=e,(t=n).classList?t.classList.add(e):(t.className+"").split(/\s+/).indexOf(e)<0&&(t.className.baseVal+=" "+e)})},e.removeClass=function(n,e){t(e).forEach(e=>{var t;t=e,(e=n).classList?e.classList.remove(t):e.className.baseVal=(e.className+"").split(/\s+/).filter(e=>e!=t).join(" ")})},e.remove=function(e){e.parentElement.removeChild(e)},e.removeChildren=n,e.clear=function(e){n(e)},e.assert=function(e,t="Assertion failed"){if(!e)throw new Error(t)},e.repeatMap=function(t,n){t=t||0;var i=[];for(let e=0;e<t;++e)i.push(n(e));return i},e.userError=function(e){e=new Error(e);throw e.isUserError=!0,e},e.now=function(){return Date.now()},e.perfNowUs=function(){return 1e3*(i=i||("undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now))()};const r=Promise.resolve();async function s(t,n,i){let r=0;const s=[],a=[];for(let e=0;e<t;e++){const t=(async()=>{for(;r<n.length;){var e=r++,t=n[e];a[e]=await i(t)}})();s.push(t)}try{await Promise.all(s)}catch(t){throw r=n.length,t}return a}function a(){return"undefined"!=typeof window&&!!window.pxtElectron}function o(){return"undefined"!=typeof window&&!!window.ipcRenderer}function l(){return a()||o()}function c(){try{return"undefined"!=typeof window&&/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)}catch(e){return!1}}e.nextTick=function(e){r.then(e)},e.delay=async function(t,e){e=await e;return await new Promise(e=>setTimeout(()=>e(),t)),e},e.promiseMapAll=function(e,t){return Promise.all(e.map(e=>t(e)))},e.promiseMapAllSeries=function(e,t){return s(1,e,t)},e.promisePoolAsync=s,e.promiseTimeout=async function(n,e,i){let r,s;var t=new Promise((e,t)=>{s=e,r=setTimeout(()=>{s=void 0,clearTimeout(r),t(i||`Promise timed out after ${n}ms`)},n)});return Promise.race([e,t]).then(e=>(s&&(clearTimeout(r),s()),e))},e.stringToUint8Array=function(t){var n=t.length,i=new Uint8Array(n);for(let e=0;e<n;++e)i[e]=255&t.charCodeAt(e);return i},e.uint8ArrayToString=function(t){let n=t.length,i="";for(let e=0;e<n;++e)i+=String.fromCharCode(t[e]);return i},e.fromUTF8=function(t){if(!t)return"";let n="";for(let e=0;e<t.length;++e){var i=255&t.charCodeAt(e);n+=37==i||127<i?"%"+i.toString(16):t.charAt(e)}return decodeURIComponent(n)},e.toUTF8=function(n,i){let r="";if(n)for(let t=0;t<n.length;++t){let e=n.charCodeAt(t);var s;e<=127?r+=n.charAt(t):e<=2047?r+=String.fromCharCode(192|e>>6,128|63&e):(!i&&55296<=e&&e<=56319&&(s=n.charCodeAt(++t),isNaN(s)||(e=65536+(e-55296<<10)+(s-56320))),r+=e<=65535?String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e):String.fromCharCode(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return r},e.toUTF8Array=function(e){return(new TextEncoder).encode(e)},e.fromUTF8Array=function(e){return(new TextDecoder).decode(e)},e.isPxtElectron=a,e.isIpcRenderer=o,e.isElectron=l,e.isLocalHost=c,e.isLocalHostDev=function(){return c()&&!l()},e.unique=function(e,n){let i=[],r={};return e.forEach(e=>{var t=n(e);r.hasOwnProperty(t)||(r[t]=null,i.push(e))}),i}}(U=pxsim.U||(pxsim.U={}));class BreakLoopException{}function getResume(){return pxsim.runtime.getResume()}pxsim.BreakLoopException=BreakLoopException,function(e){function t(e){var t=pxsim.runtime.currTryFrame(),n=(t||U.userError("unhandled exception: "+e),t.handlerFrame);throw(pxsim.runtime.currFrame=n).pc=t.handlerPC,n.tryFrame=t.parent,n.thrownValue=e,n.hasThrownValue=!0,new BreakLoopException}e.beginTry=function(e){pxsim.runtime.currFrame.tryFrame={parent:pxsim.runtime.currTryFrame(),handlerPC:e,handlerFrame:pxsim.runtime.currFrame}},e.endTry=function(){var e=pxsim.runtime.currFrame;e.tryFrame=e.tryFrame.parent},e.throwValue=t,e.getThrownValue=function(){var e=pxsim.runtime.currFrame;return U.assert(e.hasThrownValue),e.hasThrownValue=!1,e.thrownValue},e.endFinally=function(){var e=pxsim.runtime.currFrame;e.hasThrownValue&&(e.hasThrownValue=!1,t(e.thrownValue))}}(pxtcore=pxsim.pxtcore||(pxsim.pxtcore={})),pxsim.getResume=getResume;const SERIAL_BUFFER_LENGTH=16;class BaseBoard{constructor(){this.messageListeners=[],this.serialOutBuffer="",this.messages=[],this.lastSerialTime=0,this.debouncedPostAll=()=>{var e=Date.now();e-this.lastSerialTime>MIN_MESSAGE_WAIT_MS?(clearTimeout(this.serialTimeout),this.messages.length&&(Runtime.postMessage({type:"bulkserial",data:this.messages,id:pxsim.runtime.id,sim:!0}),this.messages=[],this.lastSerialTime=e)):this.serialTimeout=setTimeout(this.debouncedPostAll,50)},this.id=pxsim.Embed.frameid||"b"+Math.round(2147483647*Math.random()),this.bus=new pxsim.EventBus(pxsim.runtime,this)}updateView(){}receiveMessage(e){pxsim.runtime&&!pxsim.runtime.dead&&this.dispatchMessage(e)}dispatchMessage(e){for(const t of this.messageListeners)t(e)}addMessageListener(e){this.messageListeners.push(e)}get storedState(){return this.runOptions?(this.runOptions.storedState||(this.runOptions.storedState={}),this.runOptions.storedState):{}}initAsync(e){return this.runOptions=e,Promise.resolve()}setStoredState(e,t){null==t?delete this.storedState[e]:this.storedState[e]=t,Runtime.postMessage({type:"simulator",command:"setstate",stateKey:e,stateValue:t})}onDebuggerResume(){}screenshotAsync(e){return Promise.resolve(void 0)}kill(){}writeSerial(e){this.serialOutBuffer+=e,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(this.messages.push({time:Date.now(),data:this.serialOutBuffer}),this.debouncedPostAll(),this.serialOutBuffer="")}}pxsim.BaseBoard=BaseBoard;class CoreBoard extends BaseBoard{constructor(){super(),this.updateSubscribers=[],this.updateView=()=>{this.updateSubscribers.forEach(e=>e())},this.builtinParts={},this.builtinVisuals={},this.builtinPartVisuals={}}kill(){super.kill(),pxsim.AudioContextManager.stopAll()}}pxsim.CoreBoard=CoreBoard;class BareBoard extends BaseBoard{}function initBareRuntime(){pxsim.runtime.board=new BareBoard;var e=pxsim;e.basic={pause:pxsim.thread.pause,showNumber:e=>{var t=getResume();console.log("SHOW NUMBER:",e),U.nextTick(t)}},e.serial={writeString:e=>pxsim.runtime.board.writeSerial(e)},e.pins={createBuffer:pxsim.BufferMethods.createBuffer},e.control={inBackground:pxsim.thread.runInBackground,createBuffer:pxsim.BufferMethods.createBuffer,dmesg:e=>console.log("DMESG: "+e),deviceDalVersion:()=>"sim",__log:(e,t)=>console.log("LOG: "+t.trim())}}let LogType;pxsim.initBareRuntime=initBareRuntime,function(e){e[e.UserSet=0]="UserSet",e[e.BackAdd=1]="BackAdd",e[e.BackRemove=2]="BackRemove"}(LogType=LogType||{});class EventQueue{constructor(e,t){this.runtime=e,this.valueToArgs=t,this.max=5,this.events=[],this.awaiters=[],this._handlers=[],this._addRemoveLog=[]}push(e,t){if(0<this.awaiters.length)if(t){const e=this.awaiters.shift();e&&e()}else{const e=this.awaiters.slice();this.awaiters=[],e.forEach(e=>e())}return 0==this.handlers.length||this.events.length>this.max||(this.events.push(e),this.lock)?Promise.resolve():this.poke()}poke(){this.lock=!0;var e=this.events;return this.events=[],U.promiseMapAllSeries(e,t=>U.promiseMapAllSeries(this.handlers,e=>this.runtime.runFiberAsync(e,...this.valueToArgs?this.valueToArgs(t):[t]))).then(()=>0<this.events.length?this.poke():(this.lock=!1,this._addRemoveLog.forEach(e=>{e.log===LogType.BackAdd?this.addHandler(e.act):e.log===LogType.BackRemove?this.removeHandler(e.act):this.setHandler(e.act)}),this._addRemoveLog=[],Promise.resolve()))}get handlers(){return this._handlers}setHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.UserSet}):this._handlers=[e]}addHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.BackAdd}):-1==this._handlers.indexOf(e)&&this._handlers.push(e)}removeHandler(e){this.lock?this._addRemoveLog.push({act:e,log:LogType.BackRemove}):-1!=(e=this._handlers.indexOf(e))&&this._handlers.splice(e,1)}addAwaiter(e){this.awaiters.push(e)}}function bind(e){const i=e.arg0,r=e.fn;return e=>{let t=0;for(;e.hasOwnProperty("arg"+t);)t++;var n=e;for(let e=t;0<e;e--)n["arg"+e]=n["arg"+(e-1)];return e.arg0=i,r(e)}}function _leave(e,t){return e.parent.retval=t,e.parent}function syntheticRefAction(t){return pxtcore.mkAction(0,e=>_leave(e,t(e)))}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;class TimeoutScheduled{constructor(e,t,n,i){this.id=e,this.fn=t,this.totalRuntime=n,this.timestampCall=i}}pxsim.TimeoutScheduled=TimeoutScheduled;class PausedTimeout{constructor(e,t){this.fn=e,this.timeRemaining=t}}function mkVTable(e){return{name:e.name,numFields:e.numFields,classNo:e.classNo,methods:e.methods,iface:e.iface,lastSubtypeNo:e.lastSubtypeNo,toStringMethod:e.toStringMethod,maxBgInstances:e.maxBgInstances}}pxsim.PausedTimeout=PausedTimeout,pxsim.mkVTable=mkVTable;let mapVTable=null;function mkMapVTable(){return mapVTable=mapVTable||mkVTable({name:"_Map",numFields:0,classNo:0,lastSubtypeNo:0,methods:null})}function functionName(e){e=e.info;return e?`${e.functionName} (${e.fileName}:${e.line+1}:${e.column+1})`:"()"}pxsim.mkMapVTable=mkMapVTable,pxsim.functionName=functionName;class Runtime{constructor(msg){this.numGlobals=1e3,this.dead=!1,this.running=!1,this.idleTimer=void 0,this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0,this.startTime=0,this.startTimeUs=0,this.pausedTime=0,this.lastPauseTimestamp=0,this.globals={},this.environmentGlobals={},this.otherFrames=[],this.loopLock=null,this.loopLockWaitList=[],this.heapSnapshots=[],this.timeoutsScheduled=[],this.timeoutsPausedOnBreakpoint=[],this.pausedOnBreakpoint=!1,this.traceDisabled=!1,this.perfOffset=0,this.perfElapsed=0,this.perfStack=0,this.refCountingDebug=!1,this.refObjId=1,this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;let threadId=0,breakpoints=null,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),userGlobals,__this=this;this.traceDisabled=!!msg.traceDisabled;const evalIface={runtime:this,oops:oops,doNothing:doNothing,pxsim:pxsim,globals:this.globals,setupYield:setupYield,maybeYield:maybeYield,setupDebugger:setupDebugger,isBreakFrame:isBreakFrame,breakpoint:breakpoint,trace:trace,checkStack:checkStack,leave:_leave,checkResumeConsumed:checkResumeConsumed,setupResume:setupResume,setupLambda:setupLambda,checkSubtype:checkSubtype,failedCast:failedCast,buildResume:buildResume,mkVTable:mkVTable,bind:bind,leaveAccessor:leaveAccessor};function oops(e){throw new Error("sim error: "+e)}function doNothing(e){return e.pc=-1,_leave(e,e.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;)__this.loopLockWaitList.shift()()}let yieldReset=()=>{};function setupYield(e){yieldReset=e}function loopForSchedule(e){const t=new Object,n=e.pc;return __this.loopLock=t,__this.otherFrames.push(e),()=>{__this.dead||(U.assert(e.pc==n),U.assert(__this.loopLock===t),__this.loopLock=null,loop(e),flushLoopLock())}}function maybeYield(e,t,n){if(__this.pausedOnBreakpoint)return!1;__this.cleanScheduledExpired(),yieldReset();var i=Date.now();return 20<=i-lastYield&&(lastYield=i,e.pc=t,e.r0=n,setTimeout(loopForSchedule(e),5),!0)}function setupDebugger(e,t){return(breakpoints=new Uint8Array(e))[0]=msg.breakOnStart?1:0,userGlobals=t,breakpoints}function isBreakFrame(t){if(!breakFrame)return!0;for(let e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(t,n,e,i){let r={};__this.loopLock=r,U.assert(!dbgResume),U.assert(!dbgHeap),t.pc=n,t.r0=i;var{msg:i,heap:e}=pxsim.getBreakpointMsg(t,e,userGlobals);return dbgHeap=e,pxsim.injectEnvironmentGlobals(i,e),Runtime.postMessage(i),breakpoints[0]=0,breakFrame=null,__this.pauseScheduled(),dbgResume=e=>{if(dbgResume=null,dbgHeap=null,__this.dead)return null;switch(__this.resumeAllPausedScheduled(),__this.board.onDebuggerResume(),pxsim.runtime=__this,U.assert(t.pc==n),breakpoints[0]=0,breakFrame=null,e.subtype){case"resume":break;case"stepover":breakpoints[0]=1,breakFrame=t;break;case"stepinto":breakpoints[0]=1;break;case"stepout":breakpoints[0]=1,breakFrame=t.parent||t}U.assert(__this.loopLock==r),__this.loopLock=null,__this.otherFrames.push(t),loop(t),flushLoopLock()},null}function trace(e,t,n,i){if(setupResume(t,n),"<main>"===i.functionName||"main.ts"===i.fileName){if(!pxsim.runtime.traceDisabled){const n=pxsim.getBreakpointMsg(t,e,userGlobals)["msg"];n.subtype="trace",Runtime.postMessage(n)}pxsim.thread.pause(tracePauseMs||1)}else pxsim.thread.pause(0);checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var n=t;if(n.setBreakpoints&&breakpoints){breakpoints.fill(0);for(var i of n.setBreakpoints)breakpoints[i]=1}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakpoints[0]=1,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t);break;case"variables":n=t;let e;if(dbgHeap){const t=dbgHeap[n.variablesReference];void 0!==t&&(e=pxsim.dumpHeap(t,dbgHeap,n.fields))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:t.seq,variables:e})}}function removeFrame(t){var n=__this.otherFrames;for(let e=n.length-1;0<=e;--e)if(n[e]===t)return n.splice(e,1);U.userError("frame cannot be removed!")}function loop(t){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock),__this.perfStartRuntime(),removeFrame(t);try{for(pxsim.runtime=__this;t;)__this.currFrame=t,__this.currFrame.overwrittenPC=!1,t=t.fn(t),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(t=__this.currFrame);__this.perfStopRuntime()}catch(e){var n,i;e instanceof BreakLoopException?U.nextTick(loopForSchedule(__this.currFrame)):(__this.perfStopRuntime(),__this.errorHandler?__this.errorHandler(e):(console.error("Simulator crashed, no error handler",e.stack),{msg:n,heap:i}=pxsim.getBreakpointMsg(t,t.lastBrkId,userGlobals),pxsim.injectEnvironmentGlobals(n,i),n.exceptionMessage=e.message,n.exceptionStack=e.stack,Runtime.postMessage(n),__this.postError&&__this.postError(e)))}}}function checkStack(e){100<e&&U.userError("Stack overflow")}function actionCall(e){return e.depth=e.parent.depth+1,checkStack(e.depth),e.pc=0,e}function setupTop(e){e=setupTopCore(e);return setupResume(e,0),e}function setupTopCore(e){let t={parent:null,pc:0,depth:0,threadId:++threadId,fn:()=>(e&&e(t.retval),null)};return t}function topCall(e,t){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0);t={parent:setupTopCore(t),fn:e,depth:0,pc:0};__this.otherFrames=[t],loop(actionCall(t))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(e,t){currResume=buildResume(e,t)}function leaveAccessor(t,n){if(t.stage2Call){var i={pc:0,fn:null,depth:t.depth,parent:t.parent};let e=1;for(;t.hasOwnProperty("arg"+e);)i["arg"+(e-1)]=t["arg"+e],e++;return setupLambda(i,n),i}return t.parent.retval=n,t.parent}function setupLambda(e,t,n){if(n){const t=e;for(let e=1;e<n;++e)t["arg"+(e-1)]=t["arg"+e];delete t["arg"+(n-1)]}t instanceof pxsim.RefAction?(e.fn=t.func,e.caps=t.fields):"function"==typeof t?e.fn=t:oops("calling non-function")}function checkSubtype(e,t){return!!e&&(t===(e=e.vtable)||e&&t.classNo<=e.classNo&&e.classNo<=t.lastSubtypeNo)}function failedCast(e){pxsim.control&&pxsim.control.dmesgValue&&pxsim.control.dmesgValue(e),oops("failed cast on "+e)}function buildResume(r,t){currResume&&oops("already has resume"),r.pc=t;let n=Date.now(),s=(__this.otherFrames.push(r),i=>{if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var e=Date.now();if(3<e-n&&(lastYield=e),U.assert(r.pc==t),i instanceof pxsim.FnWrapper){let e=i,t={parent:r,fn:e.func,lambdaArgs:e.args,pc:0,caps:e.caps,depth:r.depth+1},n={};return __this.loopLock=n,removeFrame(r),__this.otherFrames.push(t),U.nextTick(()=>{U.assert(__this.loopLock===n),__this.loopLock=null,loop(actionCall(t)),flushLoopLock()})}return r.retval=i,loop(r)}__this.loopLockWaitList.push(()=>s(i))}});return s}const entryPoint=msg.code&&eval(msg.code)(evalIface);this.run=e=>topCall(entryPoint,e),this.getResume=()=>{currResume||oops("noresume");var e=currResume;return currResume=null,e},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=e=>{currResume=null,0<=e&&(this.currFrame.pc=e),this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}registerLiveObject(e){return this.refObjId++}runningTime(){return U.now()-this.startTime-this.pausedTime}runningTimeUs(){return 4294967295&U.perfNowUs()-this.startTimeUs>>0}runFiberAsync(n,i,r,s){return new Promise((e,t)=>U.nextTick(()=>{(pxsim.runtime=this).setupTop(e),pxtcore.runAction(n,[i,r,s])}))}currTryFrame(){for(let e=this.currFrame;e;e=e.parent)if(e.tryFrame)return e.tryFrame;return null}traceObjects(){const s={};for(;2<this.heapSnapshots.length;)this.heapSnapshots.shift();const t={count:0,size:0,name:"TOTAL"},n={TOTAL:t};function a(e,t,n=null){if(t instanceof pxsim.RefObject)if(!t.gcIsStatic()){var i=s[t.id];if(i)return n&&i.pointers.push([n,e]);const r={obj:t,path:null,pointers:[[n,e]]};s[t.id]=r,t.scan((e,t)=>{t instanceof pxsim.RefObject&&!s[t.id]&&a(e,t,r)})}}this.heapSnapshots.push({visited:s,statsByType:n});for(var e of Object.keys(this.globals))a(e.replace(/___\d+$/,""),this.globals[e]);const i=this.otherFrames.slice();this.currFrame&&i.indexOf(this.currFrame)<0&&i.unshift(this.currFrame);for(const s of this.getThreads()){const t="Thread-"+this.rootFrame(s).threadId;for(let e=s;e;e=e.parent){const s=t+"."+functionName(e.fn);for(var r of Object.keys(e))if(/^(r0|arg\d+|.*___\d+)/.test(r)){const i=e[r];i instanceof pxsim.RefObject&&a(s+"."+(r=r.replace(/___.*/,"")),i)}if(e.caps)for(var o of e.caps)a(s+".cap",o)}}const l=Object.keys(s).map(e=>s[e]),c=(l.sort((e,t)=>t.obj.gcSize()-e.obj.gcSize()),t=>{if(null==t.path){let e="";t.path="(cycle)";for(var[n,i]of t.pointers){if(null==n)return void(t.path=i);c(n);n=n.path+"."+i;(!e||e.length>n.length)&&(e=n)}t.path=e}});l.forEach(c);var u=[t];for(const s of l){const a=s.obj.gcSize(),i=s.obj.gcKey(),l=(n.hasOwnProperty(i)||u.push(n[i]={count:0,size:0,name:i}),n[i]);l.size+=a,l.count++,t.size+=a,t.count++}u.sort((e,t)=>e.size-t.size);let d="";const h=e=>("        "+e.toString()).slice(-7);for(const s of u)d+=h(4*s.size)+h(s.count)+" "+s.name+"\n";var p=e=>h(4*e.obj.gcSize())+" "+e.obj.gcKey()+" "+e.path,f=l.slice(0,20).map(p).join("\n");let m="";if(3<=this.heapSnapshots.length){const s=this.heapSnapshots[this.heapSnapshots.length-3].visited,t=this.heapSnapshots[this.heapSnapshots.length-2].visited,a=e=>e instanceof pxsim.RefRecord&&!!(e.vtable&&e.vtable.maxBgInstances&&n[e.gcKey()].count<=e.vtable.maxBgInstances);m=l.filter(e=>!s[e.obj.id]&&t[e.obj.id]).filter(e=>!a(e.obj)).map(p).join("\n")}return"Threads:\n"+this.threadInfo()+"\n\nSummary:\n"+d+"\n\nLarge Objects:\n"+f+"\n\nNew Objects:\n"+m}getThreads(){var e=this.otherFrames.slice();return this.currFrame&&e.indexOf(this.currFrame)<0&&e.unshift(this.currFrame),e}rootFrame(e){let t=e;for(;t.parent;)t=t.parent;return t}threadInfo(){var e;let t="";for(e of this.getThreads()){t+=`Thread ${this.rootFrame(e).threadId}:
`;for(var n of pxsim.getBreakpointMsg(e,e.lastBrkId).msg.stackframes){n=n.funcInfo;t+=`   at ${n.functionName} (${n.fileName}:${n.line+1}:${n.column+1})
`}t+="\n"}return t}static postMessage(e){e&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(e,"*"),Runtime.messagePosted)&&Runtime.messagePosted(e)}static postScreenshotAsync(t){var e=pxsim.runtime&&pxsim.runtime.board;return(e?e.screenshotAsync().catch(e=>{console.debug("screenshot failed")}):Promise.resolve(void 0)).then(e=>Runtime.postMessage({type:"screenshot",data:e,delay:t&&t.delay}))}static requestToggleRecording(){var e=pxsim.runtime;e&&Runtime.postMessage({type:"recorder",action:e.recording?"stop":"start"})}restart(){this.kill(),setTimeout(()=>pxsim.Runtime.postMessage({type:"simulator",command:"restart"}),500)}kill(){this.dead=!0,this.stopRecording(),this.stopIdle(),this.setRunning(!1)}updateDisplay(){this.board.updateView(),this.postFrame()}startRecording(e){!this.recording&&this.running&&(this.recording=!0,this.recordingTimer=setInterval(()=>this.postFrame(),66),this.recordingLastImageData=void 0,this.recordingWidth=e)}stopRecording(){this.recording&&(this.recordingTimer&&clearInterval(this.recordingTimer),this.recording=!1,this.recordingTimer=0,this.recordingLastImageData=void 0,this.recordingWidth=void 0)}postFrame(){if(this.recording&&this.running){let r=pxsim.U.now();this.board.screenshotAsync(this.recordingWidth).then(t=>{if(this.recordingLastImageData&&t&&this.recordingLastImageData.data.byteLength==t.data.byteLength){const r=this.recordingLastImageData.data,n=t.data,i=r.byteLength;let e=0;for(e=0;e<i&&r[e]==n[e];++e);if(e==i)return}this.recordingLastImageData=t,Runtime.postMessage({type:"screenshot",data:t,time:r})})}}queueDisplayUpdate(){this.numDisplayUpdates++}maybeUpdateDisplay(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())}setRunning(e){this.running!=e&&(this.running=e,this.running?(this.startTime=U.now(),this.startTimeUs=U.perfNowUs(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"running"})):(this.stopRecording(),this.stopIdle(),Runtime.postMessage({type:"status",frameid:pxsim.Embed.frameid,runtimeid:this.id,state:"killed"})),this.stateChanged)&&this.stateChanged()}dumpLivePointers(){}setupPerfCounters(e){e&&e.length&&(this.perfCounters=e.map(e=>new PerfCounter(e)))}perfStartRuntime(){0!==this.perfOffset?this.perfStack++:this.perfOffset=U.perfNowUs()-this.perfElapsed}perfStopRuntime(){this.perfStack?this.perfStack--:(this.perfElapsed=this.perfNow(),this.perfOffset=0)}perfNow(){return 0===this.perfOffset&&U.userError("bad time now"),U.perfNowUs()-this.perfOffset|0}startPerfCounter(e){this.perfCounters&&((e=this.perfCounters[e]).start&&U.userError("startPerf"),e.start=this.perfNow())}stopPerfCounter(t){if(this.perfCounters){var t=this.perfCounters[t],n=(t.start||U.userError("stopPerf"),this.perfNow()-t.start);t.start=0,t.value+=n,t.numstops++;let e=t.lastFewPtr++;e>=t.lastFew.length&&(e=0,t.lastFewPtr=1),t.lastFew[e]=n}}startIdle(){void 0===this.idleTimer&&(this.idleTimer=setInterval(()=>{var e;this.running&&!this.pausedOnBreakpoint&&(e=this.board.bus)&&e.queueIdle()},20))}stopIdle(){void 0!==this.idleTimer&&(clearInterval(this.idleTimer),this.idleTimer=void 0)}schedule(t,e){if(e<=0&&(e=0),this.pausedOnBreakpoint)return this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(t,e)),-1;const n=U.now(),i=new TimeoutScheduled(-1,t,e,n);return i.id=setTimeout(()=>{var e=this.timeoutsScheduled.indexOf(i);0<=e&&this.timeoutsScheduled.splice(e,1),t()},e),this.timeoutsScheduled.push(i),i.id}pauseScheduled(){this.pausedOnBreakpoint=!0,this.timeoutsScheduled.forEach(e=>{clearTimeout(e.id);let t=U.now()-e.timestampCall,n=e.totalRuntime-t;n<=0&&(n=1),this.timeoutsPausedOnBreakpoint.push(new PausedTimeout(e.fn,n))}),this.lastPauseTimestamp=U.now(),this.timeoutsScheduled=[]}resumeAllPausedScheduled(){this.pausedOnBreakpoint=!1,this.timeoutsPausedOnBreakpoint.forEach(e=>{this.schedule(e.fn,e.timeRemaining)}),this.lastPauseTimestamp&&(this.pausedTime+=U.now()-this.lastPauseTimestamp,this.lastPauseTimestamp=0),this.timeoutsPausedOnBreakpoint=[]}cleanScheduledExpired(){let n=U.now();this.timeoutsScheduled=this.timeoutsScheduled.filter(e=>{var t=n-e.timestampCall;return e.totalRuntime>t})}}pxsim.Runtime=Runtime;class PerfCounter{constructor(e){this.name=e,this.start=0,this.numstops=0,this.value=0,this.lastFew=new Uint32Array(32),this.lastFewPtr=0}}pxsim.PerfCounter=PerfCounter}(pxsim=pxsim||{}),function(l){let r,i;var e;(e=r=l.SimulatorState||(l.SimulatorState={}))[e.Unloaded=0]="Unloaded",e[e.Stopped=1]="Stopped",e[e.Pending=2]="Pending",e[e.Starting=3]="Starting",e[e.Running=4]="Running",e[e.Paused=5]="Paused",e[e.Suspended=6]="Suspended",(e=i=l.SimulatorDebuggerCommand||(l.SimulatorDebuggerCommand={}))[e.StepInto=0]="StepInto",e[e.StepOver=1]="StepOver",e[e.StepOut=2]="StepOut",e[e.Resume=3]="Resume",e[e.Pause=4]="Pause";const s="pxtdriver";l.SimulatorDriver=class{constructor(e,t={}){this.container=e,this.options=t,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.breakpointsSet=!1,this._runOptions={},this.state=r.Unloaded,this._allowedOrigins=[],this.frameCleanupTimeout=void 0,this.debuggerSeq=1,this.debuggerResolvers={},this._allowedOrigins.push(window.location.origin),t.parentOrigin&&this._allowedOrigins.push(t.parentOrigin),this._allowedOrigins.push(this.getSimUrl().origin);const n=null==t?void 0:t.messageSimulators;n&&Object.keys(n).map(e=>n[e]).forEach(e=>{this._allowedOrigins.push(new URL(e.url).origin),e.localHostUrl&&this._allowedOrigins.push(new URL(e.localHostUrl).origin)}),this._allowedOrigins=l.U.unique(this._allowedOrigins,e=>e)}isDebug(){return this._runOptions&&!!this._runOptions.debug}isTracing(){return this._runOptions&&!!this._runOptions.trace}hasParts(){return this._runOptions&&this._runOptions.parts&&!!this._runOptions.parts.length}setDirty(){this.state==l.SimulatorState.Running&&this.suspend()}setPending(){this.setState(r.Pending)}focus(){var e=this.simFrames()[0];e&&e.focus()}registerDependentEditor(e){e&&(this._dependentEditors||(this._dependentEditors=[]),this._dependentEditors.push(e))}dependentEditors(){return this._dependentEditors&&(this._dependentEditors=this._dependentEditors.filter(e=>!!e.parent),this._dependentEditors.length||(this._dependentEditors=void 0)),this._dependentEditors}setStarting(){this.setState(r.Starting)}setHwDebugger(e){e?(this.hwdbg=e,this.setState(r.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(r.Running),this.stop())}handleHwDebuggerMsg(e){this.hwdbg&&this.handleMessage(e)}setThemes(e){l.U.assert(e&&0<e.length),this.themes=e}startRecording(e){this.simFrames()[0]&&this.postMessage({type:"recorder",action:"start",source:s,width:e})}stopRecording(){this.postMessage({type:"recorder",source:s,action:"stop"})}setFrameState(e){var t=e.nextElementSibling,n=t.nextElementSibling;switch(this.state){case r.Pending:case r.Starting:t.style.display="",t.className="",n.style.display="";break;case r.Stopped:case r.Suspended:l.U.addClass(e,this.state==r.Stopped||this._runOptions&&this._runOptions.autoRun?this.stoppedClass:this.invalidatedClass),this._runOptions&&this._runOptions.autoRun?t.style.display="none":(t.style.display="",t.className="videoplay xicon icon"),n.style.display="none",this.scheduleFrameCleanup();break;default:l.U.removeClass(e,this.stoppedClass),l.U.removeClass(e,this.invalidatedClass),t.style.display="none",n.style.display="none"}}setState(e){this.state!=e&&(this.state=e,this.freeze(this.state==r.Paused),this.simFrames().forEach(e=>this.setFrameState(e)),this.options.onStateChanged)&&this.options.onStateChanged(this.state)}freeze(e){const n="pause-overlay";e?l.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(e=>{var t;e.querySelector("div."+n)||((t=document.createElement("div")).className=n,t.onclick=e=>(e.preventDefault(),!1),e.appendChild(t))}):l.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(e=>e.parentElement.removeChild(e))}simFrames(e=!1){var t=l.util.toArray(this.container.getElementsByTagName("iframe")),n=this.loanedIFrame();return n&&!e&&t.unshift(n),t}getSimUrl(){var t=this.options.simUrl||(window.pxtConfig||{}).simUrl||location.origin+"/sim/simulator.html";try{return new URL(t)}catch(e){return new URL(t,location.origin)}}postMessage(n,i,r){var e;if(this.hwdbg)this.hwdbg.postMessage(n);else{var s=this.dependentEditors();let t=this.simFrames();r&&(t=t.filter(e=>e.id===r));const o=n;if(i&&null!=o&&o.broadcast){const r=!(null==(e=this._currentRuntime)||!e.single),o=window.parent&&window.parent!==window.window?window.parent:window.opener;if(this.options.nestedEditorSim&&o){if(i!==o){const l=this.options.parentOrigin||window.location.origin;o.postMessage(n,l)}}else if(s)s.forEach(e=>{i!==e&&e.postMessage(n,window.location.origin)});else if(!r){const i="messagepacket"===n.type&&n.channel,r=i&&this.options.messageSimulators&&this.options.messageSimulators[i];if(r){s=t.find(e=>e.dataset.messagechannel===i);if(s)s.dataset.runid!=this.runId&&this.startFrame(s);else{const e=(l.U.isLocalHost()&&/localhostmessagesims=1/i.test(window.location.href)&&r.localHostUrl||r.url).replace("$PARENT_ORIGIN$",encodeURIComponent(this.options.parentOrigin||""));var a=this.createFrame(e);this.container.appendChild(a),(s=a.firstElementChild).dataset.messagechannel=i,l.U.addClass(a,"simmsg"),l.U.addClass(a,"simmsg"+i),r.permanent&&(s.dataset.permanent="true"),this.startFrame(s),t=this.simFrames()}}else{const l=t.filter(e=>!e.dataset.messagechannel);l.length<2?(this.container.appendChild(this.createFrame()),t=this.simFrames()):l[1].dataset.runid!=this.runId&&this.startFrame(l[1])}}}for(let e=0;e<t.length;++e){const r=t[e];if((!i||r.contentWindow!=i)&&r.contentWindow&&(this.postMessageCore(r,n),"recorder"==n.type)&&"start"==n.action)break}}}postMessageCore(e,t){var n,i,r;if(e.contentWindow.postMessage(t,e.dataset.origin),l.U.isLocalHostDev()&&null!=(n=null==(n=pxt)?void 0:n.appTarget)&&n.id)try{e.contentWindow.postMessage(t,`https://trg-${null==(r=null==(i=pxt)?void 0:i.appTarget)?void 0:r.id}.userpxt.io/---simulator`)}catch(e){}}createFrame(e){var t=document.createElement("div");t.className="simframe ui embed";const n=document.createElement("iframe");n.id="sim-frame-"+this.nextId(),n.title=l.localization.lf("Simulator"),n.allowFullscreen=!0,n.setAttribute("allow","autoplay"),n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.className="no-select";var e=(e||this.getSimUrl())+"#"+n.id,e=(n.src=e,n.frameBorder="0",n.dataset.runid=this.runId,n.dataset.origin=new URL(e).origin||"*",t.appendChild(n),document.createElement("i")),i=(e.className="videoplay xicon icon",e.style.display="none",e.onclick=e=>(e.preventDefault(),this.state!=r.Running&&this.state!=r.Starting&&(this.options.restart?this.options.restart():this.start()),n.focus(),!1),t.appendChild(e),document.createElement("div"));return i.className="ui active loader",e.style.display="none",t.appendChild(i),this._runOptions&&this.applyAspectRatioToFrame(n),t}preload(e){this.simFrames().length||(this.container.appendChild(this.createFrame()),this.applyAspectRatio(e),this.setStarting())}stop(e=!1,t=!1){this.clearDebugger(),this.postMessage({type:"stop",source:s}),this.setState(t?r.Starting:r.Stopped),e&&this.unload()}suspend(){this.postMessage({type:"stop",source:s}),this.setState(r.Suspended)}unload(){this.cancelFrameCleanup(),l.U.removeChildren(this.container),this.setState(r.Unloaded),this._runOptions=void 0,this._currentRuntime=void 0,this.runId=void 0}mute(e){this._currentRuntime&&(this._currentRuntime.mute=e),this.postMessage({type:"mute",source:s,mute:e})}stopSound(){this.postMessage({type:"stopsound",source:s})}isLoanedSimulator(e){return!!this.loanedSimulator&&this.loanedIFrame()==e}loanSimulator(){return this.loanedSimulator||(this.loanedSimulator=this.container.firstElementChild||this.createFrame(),this.loanedSimulator.parentNode&&this.container.removeChild(this.loanedSimulator)),this.loanedSimulator}unloanSimulator(){this.loanedSimulator&&(this.loanedSimulator.parentNode&&this.loanedSimulator.parentNode.removeChild(this.loanedSimulator),this.container.insertBefore(this.loanedSimulator,this.container.firstElementChild),delete this.loanedSimulator)}loanedIFrame(){return this.loanedSimulator&&this.loanedSimulator.parentNode&&this.loanedSimulator.querySelector("iframe")}cancelFrameCleanup(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=void 0)}scheduleFrameCleanup(){this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(()=>{this.frameCleanupTimeout=void 0,this.cleanupFrames()},5e3)}applyAspectRatio(t){(t||this._runOptions)&&this.simFrames().forEach(e=>this.applyAspectRatioToFrame(e,t))}applyAspectRatioToFrame(e,t){var n;let i=t;if(void 0===i){const t=parseFloat(e.dataset.aspectratio);isNaN(t)||(i=t)}if(void 0===i){const t=e.dataset.messagechannel;if(t){const e=null==(n=null==(n=null==(n=this.options)?void 0:n.messageSimulators)?void 0:n[t])?void 0:n.aspectRatio;e&&(i=e)}}void 0===i&&(i=(null==(t=this._runOptions)?void 0:t.aspectRatio)||1.22),e.parentElement.style.paddingBottom=100/i+"%"}cleanupFrames(){var e=this.simFrames(!0);e.shift(),e.filter(e=>!e.dataset.permanent).forEach(e=>{this.state!=r.Stopped&&e.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(e.parentElement):e.parentElement.remove())})}hide(t){var e;this.suspend(),this.options.removeElement&&((e=this.simFrames()).forEach(e=>{this.options.removeElement(e.parentElement,t)}),0==e.length)&&t&&t()}unhide(){this.options.unhideElement&&this.simFrames().forEach(e=>{this.options.unhideElement(e.parentElement)})}run(e,t={}){this._runOptions=t,this.runId=this.nextId(),this._currentRuntime={type:"run",source:s,boardDefinition:t.boardDefinition,parts:t.parts,builtinParts:t.builtinParts,fnArgs:t.fnArgs,code:e,partDefinitions:t.partDefinitions,mute:t.mute,highContrast:t.highContrast,light:t.light,cdnUrl:t.cdnUrl,localizedStrings:t.localizedStrings,refCountingDebug:t.refCountingDebug,version:t.version,clickTrigger:t.clickTrigger,breakOnStart:t.breakOnStart,storedState:t.storedState,ipc:t.ipc,single:t.single,dependencies:t.dependencies},this.start()}restart(){this.stop(),this.cleanupFrames(),this.start()}areBreakpointsSet(){return this.breakpointsSet}start(){if(this.clearDebugger(),this.addEventListeners(),this.applyAspectRatio(),this.scheduleFrameCleanup(),this._currentRuntime){this.breakpointsSet=!1;let e=this.simFrames()[0];var t;e?this.startFrame(e):(t=this.createFrame(),this.container.appendChild(t),e=t.firstElementChild),this.debuggingFrame=e.id,this.setState(r.Running),this.setTraceInterval(this.traceInterval)}}startFrame(e){var t;return!(!this._currentRuntime||!e.contentWindow||((t=JSON.parse(JSON.stringify(this._currentRuntime))).frameCounter=++this.frameCounter,t.options={theme:this.themes[this.nextFrameId++%this.themes.length]},t.id=t.options.theme+"-"+this.nextId(),e.dataset.runid=this.runId,e.dataset.runtimeid=t.id,e.id!==this.debuggingFrame&&(t.traceDisabled=!0,t.breakOnStart=!1),this.postMessageCore(e,t),this.traceInterval&&this.setTraceInterval(this.traceInterval),this.applyAspectRatioToFrame(e),this.setFrameState(e),0))}handleMessage(e,t){switch(e.type||""){case"ready":{const r=e.frameid,t=document.getElementById(r);t&&(this.startFrame(t),this.options.revealElement)&&this.options.revealElement(t),this.options.onSimulatorReady&&this.options.onSimulatorReady();break}case"status":{const t=e.frameid,n=document.getElementById(t);if(n){const t=e;if(t.runtimeid==n.dataset.runtimeid)switch(t.state){case"running":this.setState(r.Running);break;case"killed":this.setState(r.Stopped)}}break}case"simulator":this.handleSimulatorCommand(e);break;case"serial":case"pxteditor":case"screenshot":case"custom":case"recorder":case"addextensions":break;case"aspectratio":{const r=e,t=r.frameid,i=document.getElementById(t);i&&(i.dataset.aspectratio=r.value+"",this.applyAspectRatioToFrame(i));break}case"debugger":this.handleDebuggerMessage(e);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:this.postMessage(e,t)}}addEventListeners(){this.listener||(this.listener=e=>{this.hwdbg||!l.U.isLocalHost()&&this._allowedOrigins.indexOf(e.origin)<0||this.handleMessage(e.data,e.source)},window.addEventListener("message",this.listener,!1))}removeEventListeners(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)}resume(e){let t;switch(e){case i.Resume:t="resume",this.setState(r.Running);break;case i.StepInto:t="stepinto",this.setState(r.Running);break;case i.StepOut:t="stepout",this.setState(r.Running);break;case i.StepOver:t="stepover",this.setState(r.Running);break;case i.Pause:t="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:t,source:s})}setBreakpoints(e){this.breakpointsSet=!0,this.postDebuggerMessage("config",{setBreakpoints:e},void 0,this.debuggingFrame)}setTraceInterval(e){this.traceInterval=e,this.postDebuggerMessage("traceConfig",{interval:e})}variablesAsync(e,t){return this.postDebuggerMessageAsync("variables",{variablesReference:e,fields:t},this.debuggingFrame).then(e=>e,e=>{})}handleSimulatorCommand(e){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(e)}clearDebugger(){const t=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(e=>{e=this.debuggerResolvers[e].reject;e(t)}),this.debuggerResolvers={},this.debuggerSeq++}handleDebuggerMessage(e){if("trace"!==e.subtype&&console.log("DBG-MSG",e.subtype,e),e.seq){const r=this.debuggerResolvers[e.seq]["resolve"];r&&r(e)}switch(e.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(e);break;case"breakpoint":var t=e;if(this.state==r.Running){t.exceptionMessage?this.suspend():(this.setState(r.Paused),1<this.simFrames(!0).length&&this.resume(i.Pause)),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(t);let e=t.exceptionMessage+"\n";for(var n of t.stackframes){n=n.funcInfo;e+=`   at ${n.functionName} (${n.fileName}:${n.line+1}:${n.column+1})
`}t.exceptionMessage&&console.error(e)}else console.error("debugger: trying to pause from "+this.state);break;case"trace":{const i=e;this.state==r.Running&&this.options.onTraceMessage&&this.options.onTraceMessage(i);break}default:t=e.req_seq;if(t){const r=this.debuggerResolvers[t]["resolve"];r&&(delete this.debuggerResolvers[t],r(e))}}}postDebuggerMessageAsync(i,r={},s){return new Promise((e,t)=>{var n=this.debuggerSeq++;this.debuggerResolvers[n.toString()]={resolve:e,reject:t},this.postDebuggerMessage(i,r,n,s)})}postDebuggerMessage(e,t={},n,i){t=JSON.parse(JSON.stringify(t));t.type="debugger",t.subtype=e,t.source=s,n&&(t.seq=n),this.postMessage(t,void 0,i)}nextId(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")}get stoppedClass(){return this.options&&this.options.stoppedClass||"grayscale"}get invalidatedClass(){return this.options&&this.options.invalidatedClass||"sepia"}}}(pxsim=pxsim||{}),function(C){function e(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function t(){return"undefined"!=typeof window&&!!window.PointerEvent}C.mkRange=function(e,t){for(var n=[];e<t;e++)n.push(e);return n},C.EventBus=class{constructor(e,t,n){this.runtime=e,this.board=t,this.valueToArgs=n,this.queues={},this.backgroundHandlerFlag=!1,this.nextNotifyEvent=1024,this.schedulerID=15,this.idleEventID=2,this.board.addMessageListener(this.handleMessage.bind(this))}handleMessage(e){"eventbus"===e.type&&this.queue(e.id,e.eventid,e.value)}setBackgroundHandlerFlag(){this.backgroundHandlerFlag=!0}setNotify(e,t){this.notifyID=e,this.notifyOneID=t}setIdle(e,t){this.schedulerID=e,this.idleEventID=t}start(e,t,n,i=!1){n=(n?"back":"fore")+":"+e+":"+t;return!this.queues[n]&&i&&(this.queues[n]=new C.EventQueue(this.runtime,this.valueToArgs)),this.queues[n]}listen(e,t,n){e==this.schedulerID&&t==this.idleEventID&&this.runtime.startIdle();e=this.start(e,t,this.backgroundHandlerFlag,!0);this.backgroundHandlerFlag?e.addHandler(n):e.setHandler(n),this.backgroundHandlerFlag=!1}removeBackgroundHandler(t){Object.keys(this.queues).forEach(e=>{e.startsWith("back:")&&this.queues[e].removeHandler(t)})}getQueues(e,t,n){var i=[this.start(0,0,n)];return 0==e&&0==t||(t&&i.push(this.start(0,t,n)),e&&i.push(this.start(e,0,n)),e&&t&&i.push(this.start(e,t,n))),i}queue(e,t,n=null){if(!C.runtime.pausedOnBreakpoint){const i=this.notifyID&&this.notifyOneID&&e==this.notifyOneID;i&&(e=this.notifyID);e=this.getQueues(e,t,!0).concat(this.getQueues(e,t,!1));this.lastEventValue=t,this.lastEventTimestampUs=C.U.perfNowUs(),C.U.promiseMapAllSeries(e,e=>e?e.push(n,i):Promise.resolve())}}queueIdle(){this.schedulerID&&this.idleEventID&&this.queue(this.schedulerID,this.idleEventID)}wait(e,t,n){this.start(e,t,!1,!0).addAwaiter(n)}getLastEventValue(){return this.lastEventValue}getLastEventTime(){return 4294967295&this.lastEventTimestampUs-C.runtime.startTimeUs}},C.AnimationQueue=class{constructor(n){this.runtime=n,this.queue=[],this.process=()=>{var e,t=this.queue[0];t&&!this.runtime.dead&&(n=this.runtime,e=t.frame(),n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===e?(this.queue.shift(),this.queue[0]&&(this.queue[0].setTimeoutHandle=setTimeout(this.process,this.queue[0].interval)),t.whenDone(!1)):t.setTimeoutHandle=setTimeout(this.process,t.interval))}}cancelAll(){var e,t=this.queue;this.queue=[];for(e of t)e.whenDone(!0),e.setTimeoutHandle&&clearTimeout(e.setTimeoutHandle)}cancelCurrent(){var e=this.queue[0];e&&(this.queue.shift(),e.whenDone(!0),e.setTimeoutHandle)&&clearTimeout(e.setTimeoutHandle)}enqueue(e){e.whenDone||(e.whenDone=()=>{}),this.queue.push(e),1==this.queue.length&&this.process()}executeAsync(n){return C.U.assert(!n.whenDone),new Promise((e,t)=>{n.whenDone=e,this.enqueue(n)})}};{var n=C.AudioContextManager||(C.AudioContextManager={});let y,i,r,s,a=0,w=!1;function S(){return y=y||function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()}function o(){p(0),a=0,s&&s.pause()}function l(){o(),u()}function c(e,t){e.gain.value&&e.gain.setTargetAtTime(0,S().currentTime,.015),setTimeout(()=>{e.disconnect(),t&&t.disconnect()},450)}n.mute=function(e){w=e,l();var t=S();!e&&t&&"suspended"===t.state&&t.resume()},n.stopAll=l,n.stop=function(){if(o(),r){try{c(r,i)}catch(e){}r=void 0,i=void 0}},n.frequency=function(){return a};const I=[null,"triangle","sawtooth","sine"];let x,k,A=[],T=[];const P=[];class U{mute(){this.gain?c(this.gain,this.generator):this.generator&&(this.generator.stop(),this.generator.disconnect()),this.gain=null,this.generator=null}remove(){var e=P.indexOf(this);0<=e&&P.splice(e,1),this.mute()}}let E=1;function u(){for(E++;P.length;)P[0].remove()}function d(l){const c=E;let u=S(),d=0,h=new U,p=-1,f=-1,m=0;5<P.length&&P[0].remove(),P.push(h);const g=(e,t)=>e/1024/4*(t?.5:1),b=()=>{h.mute(),m=0,p=-1,f=-1},v=()=>{if(d>=l.data.length||!l.data[d])return C.U.delay(m).then(b);var e=l.data[d],t=C.BufferMethods.getNumber(l,C.BufferMethods.NumberFormat.UInt16LE,d+2),n=C.BufferMethods.getNumber(l,C.BufferMethods.NumberFormat.UInt16LE,d+4),i=C.BufferMethods.getNumber(l,C.BufferMethods.NumberFormat.UInt16LE,d+6),r=C.BufferMethods.getNumber(l,C.BufferMethods.NumberFormat.UInt16LE,d+8),s=C.BufferMethods.getNumber(l,C.BufferMethods.NumberFormat.UInt16LE,d+10),a=11<=e&&e<=15,o=4==e||16<=e&&e<=18,i=g(i,a),r=g(r,a);if(!u||c!=E)return C.U.delay(n);if(p!=e||f!=t||t!=s){if(h.generator)return C.U.delay(m).then(()=>(b(),v()));if(h.generator=w?null:function(e,t){let n,i=I[e];if(i)(r=S().createOscillator()).type=i,r.frequency.value=t;else{if(4==e)n=function(){if(!k){var n=(k=S().createBuffer(1,131072,S().sampleRate)).getChannelData(0);let t=251771520;for(let e=0;e<131072;e+=4)32768&(t=(t=(t^=t<<13)^t>>17)^t<<5)?(n[e]=1,n[e+1]=1,n[e+2]=-1,n[e+3]=-1):(n[e]=0,n[e+1]=0,n[e+2]=0,n[e+3]=0)}return k}();else if(5==e)n=function(){if(!x){var n=(x=S().createBuffer(1,1e5,S().sampleRate)).getChannelData(0);let t=251771520;for(let e=0;e<1e5;e++)t=(t=(t^=t<<13)^t>>17)^t<<5,n[e]=(1023&t)/512-1}return x}();else if(11<=e&&e<=15)n=function(t){if(!T[t]){var e=S().createBuffer(1,1024,S().sampleRate),n=e.getChannelData(0);for(let e=0;e<1024;e++)n[e]=e<t/100*1024?1:-1;T[t]=e}return T[t]}(10*(e-10));else{if(!(16<=e&&e<=18))return null;n=function(t){if(!A[t]){var e=S().createBuffer(1,1024,S().sampleRate),n=e.getChannelData(0),i=[770763591,3356908179],r=[15,31,63];for(let e=0;e<1024;e+=4){var s=e/4;0!=(i[(s&=r[t-4])>>5]&1<<(31&s))?(n[e]=1,n[e+1]=1,n[e+2]=-1,n[e+3]=-1):(n[e]=0,n[e+1]=0,n[e+2]=0,n[e+3]=0)}A[t]=e}return A[t]}(e-16+4)}var r=S().createBufferSource();r.buffer=n,r.loop=!0,4==e||16<=e&&e<=18?r.playbackRate.value=t/(S().sampleRate/4):5!=e&&(r.playbackRate.value=t/(S().sampleRate/1024))}return r}(e,t),!h.generator)return C.U.delay(n);if(p=e,f=t,h.gain=u.createGain(),h.gain.gain.value=0,h.gain.gain.setTargetAtTime(i,y.currentTime,.015),s!=t)if(null!=h.generator.frequency)h.generator.frequency.linearRampToValueAtTime(s,u.currentTime+(m+n)/1e3);else if(null!=h.generator.playbackRate){const C=o?4:1024;h.generator.playbackRate.linearRampToValueAtTime(s/(S().sampleRate/C),u.currentTime+(m+n)/1e3)}h.generator.connect(h.gain),h.gain.connect(u.destination),h.generator.start()}d+=12,h.gain.gain.setValueAtTime(i,u.currentTime+m/1e3),m+=n;a=0!==r&&50<n?(m-50)/1e3:(m-10)/1e3;return h.gain.gain.linearRampToValueAtTime(r,u.currentTime+a),v()};return v().then(()=>h.remove())}function h(e,t){if(!(e<0)){a=e;var n=S();if(n){t=Math.max(0,Math.min(1,t));try{i||(i=n.createOscillator(),(r=n.createGain()).gain.value=0,i.type="triangle",i.connect(r),r.connect(n.destination),i.start(0)),p(t)}catch(e){return i=void 0,void(r=void 0)}i.frequency.value=e,p(t)}}}function p(e){null!=r&&r.gain&&r.gain.setTargetAtTime(w?0:e,y.currentTime,.015)}n.muteAllChannels=u,n.queuePlayInstructions=function(e,t){const n=E;C.U.delay(e).then(()=>n!=E?Promise.resolve():d(t))},n.playInstructionsAsync=d,n.tone=h,n.setCurrentToneGain=p,n.playBufferAsync=function(i){return i?new Promise(e=>{function t(){e&&e(),e=void 0}var n="data:audio/wav;base64,"+window.btoa(function(t){let n=t.length,i="";for(let e=0;e<n;++e)i+=String.fromCharCode(t[e]);return i}(i.data));s=new Audio(n),w&&(s.volume=0),s.onended=()=>t(),s.onpause=()=>t(),s.onerror=()=>t(),s.play()}):Promise.resolve()},n.playPCMBufferStreamAsync=function(u,d,e=.3,h){return new Promise(r=>{let s=[],a=S().currentTime,o=!1;function l(){const e=h&&h();for(;!o&&s.length<3&&!e;){const e=u();if(!e||!e.length){o=!0;break}i=n=t=void 0;var t=e,n=S().createBuffer(1,t.length,d);if(n.copyToChannel)n.copyToChannel(t,0);else{const d=n.getChannelData(0);for(let e=0;e<t.length;e++)d[e]=t[e]}var i=S().createBufferSource();s.push(i),i.connect(c.gain),i.buffer=n,i.addEventListener("ended",()=>{s.shift().disconnect(),l()}),i.start(a),a+=n.duration}o&&0===s.length&&(c.remove(),r&&r(),r=void 0)}const c=new U;c.gain=S().createGain(),c.gain.gain.value=0,w||c.gain.gain.setValueAtTime(e,S().currentTime),c.gain.connect(S().destination),5<P.length&&P[0].remove(),P.push(c),l()})},n.sendMidiMessage=function(e){var t,n,i,e=e.data;e.length&&(t=e[0]>>4,n=15&e[0],i=e[1]||0,i=440*Math.pow(2,(i-69)/12),e=e[2]||0,8==t||9==t&&0==e?o():9==t&&(h(i,1),9==n)&&setTimeout(()=>o(),500))}}C.isTouchEnabled=e,C.hasPointerEvents=t,C.pointerEvents=t()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:e()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim=pxsim||{}),function(A){function r(t,n){return e=>e*(n/t)}function n(e,t){var n=e[0]-t[0],e=e[1]-t[1];return n*n+e*e}var t;(t=A.visuals||(A.visuals={})).translateEl=function(e,t){A.svg.hydrate(e,{transform:`translate(${t[0]} ${t[1]})`})},t.composeSVG=function(e){var[t,n]=[e.el1,e.el2];A.U.assert(0==t.x&&0==t.y&&0==n.x&&0==n.y,"el1 and el2 x,y offsets not supported");let i=(e,t,n)=>A.svg.hydrate(e,{x:t,y:n}),r=(e,t,n)=>A.svg.hydrate(e,{width:t+"px",height:n+"px"}),s=e.scaleUnit2,a=e.scaleUnit2/e.scaleUnit1,o=t.w*a,l=t.h*a;r(t.el,o,l);var c=+n.w,u=+n.h;r(n.el,c,u);let[d,h,p,f]=e.margin,m=e.middleMargin,g=Math.max(o,c),b=h+(g-o)/2,v=d,y=(i(t.el,b,v),h+(g-c)/2),w=v+l+m;i(n.el,y,w);var x,c=[v,v+l,w,w+u],u=A.svg.elt("svg",{version:"1.0",viewBox:`0 0 ${h+g+f} `+(d+l+m+u+p),class:"sim-bb"}),k=(x=u,k=e.maxWidth,e=e.maxHeight,k&&A.svg.hydrate(x,{width:k}),e&&A.svg.hydrate(x,{height:e}),i(u,0,0),A.svg.child(u,"g"));return u.appendChild(t.el),u.appendChild(n.el),{under:k,over:A.svg.child(u,"g"),host:u,edges:c,scaleUnit:s,toHostCoord1:e=>{var[e,t]=e;return[e*a+b,t*a+v]},toHostCoord2:e=>{var[e,t]=e;return[+e+y,+t+w]}}},t.mkScaleFn=r,t.mkImageSVG=function(e){var t=r(e.imageUnitDist,e.targetUnitDist),n=t(e.width),t=t(e.height),i=A.svg.elt("image",{width:n,height:t});return i.setAttributeNS("http://www.w3.org/1999/xlink","href",""+e.image),{el:i,w:n,h:t,x:0,y:0}},t.findDistSqrd=n,t.findClosestCoordIdx=function(t,e){return e.map(e=>n(t,e)).reduce((e,t,n,i)=>t<i[e]?n:e,0)},t.mkTxt=function(e,t,n,i,r,s,a){var o=A.svg.elt("text"),s=(s=s||-.33333)*n*r.length;return A.svg.hydrate(o,{style:`font-size:${n}px;`,transform:`translate(${e} ${t}) rotate(${i}) translate(${s} ${(a=a||.3)*n})`}),A.U.addClass(o,"noselect"),o.textContent=r,o},t.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],t.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},t.mapWireColor=function(e){return t.WIRE_COLOR_MAP[e]||e},t.PIN_DIST=15,t.rgbToHsl=function(e){let t,n,i,[r,s,a]=e,[o,l,c]=[r/255,s/255,a/255],u=Math.min(o,l,c),d=Math.max(o,l,c),h=d-u,p=d+u;return i=p/2*100,n=0==h?t=0:(d===o?t=(l-c)/h%6*60:d===l?t=60*((c-o)/h+2):d===c&&(t=60*((o-l)/h+4)),50<i?h/(2-p)*100:h/p*100),[Math.floor(t),Math.floor(n),Math.floor(i)]}}(pxsim=pxsim||{}),function(o){var i,e;function r(e,t,n){e={class:e,d:t},n&&(e.title=n),t=i.elt("path");return i.hydrate(t,e),t}function s(e,t=!1){var n=i.elt("linearGradient");return i.hydrate(n,{id:e,x1:"0%",y1:"0%",x2:t?"100%":"0%",y2:t?"0%":"100%"}),i.child(n,"stop",{offset:"0%"}),i.child(n,"stop",{offset:"100%"}),i.child(n,"stop",{offset:"100%"}),i.child(n,"stop",{offset:"100%"}),n}function n(e){var t=i.elt("title");return t.textContent=e,t}(e=i=o.svg||(o.svg={})).parseString=function(e){return(new DOMParser).parseFromString(e,"image/svg+xml").getElementsByTagName("svg").item(0)},e.toDataUri=function(e){return"data:image/svg+xml,"+encodeURI(e)},e.cursorPoint=function(e,t,n){return e.x=null!=n.clientX?n.clientX:n.pageX,e.y=null!=n.clientY?n.clientY:n.pageY,e.matrixTransform(t.getScreenCTM().inverse())},e.rotateElement=function(e,t,n,i){e.setAttribute("transform",`translate(${t},${n}) rotate(${i+90}) translate(${-t},${-n})`)},e.hydrate=function(e,t){for(var n in t)"title"==n?i.title(e,t[n]):e.setAttributeNS(null,n,t[n])},e.elt=function(e,t){e=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&i.hydrate(e,t),e},e.child=function(e,t,n){t=i.elt(t,n);return e.appendChild(t),t},e.mkPath=r,e.path=function(e,t,n,i){t=r(t,n,i);return e.appendChild(t),t},e.fill=function(e,t){e.style.fill=t},e.filter=function(e,t){e.style.filter=t},e.fills=function(e,t){e.forEach(e=>e.style.fill=t)},e.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},e.onClick=function(t,n){let i=!1;o.pointerEvents.down.forEach(e=>t.addEventListener(e,e=>i=!0,!1)),t.addEventListener(o.pointerEvents.up,e=>!i||(i=!1,n(e),e.preventDefault(),!1),!1)},e.buttonEvents=function(t,n,i,r,s){let a=!1;o.pointerEvents.down.forEach(e=>t.addEventListener(e,e=>(a=!0,i&&i(e),!0),!1)),t.addEventListener(o.pointerEvents.move,e=>!a||(n&&n(e),e.preventDefault(),!1),!1),t.addEventListener(o.pointerEvents.up,e=>{a=!1,r&&r(e)},!1),t.addEventListener(o.pointerEvents.leave,e=>{a=!1,r&&r(e)},!1),t.addEventListener("keydown",e=>{a=!1,s&&s(e)})},e.mkLinearGradient=s,e.linearGradient=function(e,t,n=!1){t=s(t,n);return e.appendChild(t),t},e.setGradientColors=function(e,t,n){e&&(e.childNodes[0].style.stopColor=t,e.childNodes[1].style.stopColor=t,e.childNodes[2].style.stopColor=n,e.childNodes[3].style.stopColor=n)},e.setGradientValue=function(e,t){e.childNodes[1].getAttribute("offset")!=t&&(e.childNodes[1].setAttribute("offset",t),e.childNodes[2].setAttribute("offset",t))},e.animate=function(e,t){o.U.addClass(e,t);t=e.parentElement;t&&(t.removeChild(e),t.appendChild(e))},e.mkTitle=n,e.title=function(e,t){t=n(t);return e.appendChild(t),t},e.toHtmlColor=function(e){return`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&1})`}}(pxsim=pxsim||{}),function(e){class t{constructor(e){this.id=e}}e.Button=t,e.ButtonPairState=class{constructor(e){this.props=e,this.usesButtonAB=!1,this.aBtn=new t(this.props.ID_BUTTON_A),this.bBtn=new t(this.props.ID_BUTTON_B),this.abBtn=new t(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0}}}(pxsim=pxsim||{}),(pxsim||(pxsim={})).CompassState=class{constructor(){this.usesHeading=!1,this.heading=90}},(pxsim||(pxsim={})).FileSystemState=class{constructor(){this.files={}}append(e,t){this.files[e]=(this.files[e]||"")+t}remove(e){delete this.files[e]}},(pxsim||(pxsim={})).LightSensorState=class{constructor(){this.usesLightLevel=!1,this.lightLevel=128}},function(l){var c;(c=l.visuals||(l.visuals={})).mkBoardView=e=>{var t=e.visual;return new c.GenericBoardSvg({visualDef:t,boardDef:e.boardDef,wireframe:e.wireframe})},c.BoardHost=class{constructor(e,t){this.parts=[],this.boardView=e,(this.opts=t).boardDef.pinStyles||(t.boardDef.pinStyles={}),this.state=t.state;let n=t.partsList,i=0<n.length||t.forceBreadboardLayout;if(i){this.breadboard=new c.Breadboard({wireframe:t.wireframe});const e=t.boardDef.marginWhenBreadboarding||[0,0,40,0],s=c.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[e[0],e[1],20,e[3]],middleMargin:e[2],maxWidth:t.maxWidth,maxHeight:t.maxHeight}),a=s.under,o=s.over;this.view=s.host;var r=s.edges,r=(this.fromMBCoord=s.toHostCoord1,this.fromBBCoord=s.toHostCoord2,this.partGroup=o,this.partOverGroup=l.svg.child(this.view,"g"),this.style=l.svg.child(this.view,"style",{}),this.defs=l.svg.child(this.view,"defs",{}),this.wireFactory=new c.WireFactory(a,o,r,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this)),l.allocateDefinitions({boardDef:t.boardDef,partDefs:t.partDefs,fnArgs:t.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:n}));(r.partsAndWires.length||t.forceBreadboardLayout)&&(this.addAll(r),r.requiresBreadboard||t.forceBreadboardRender)?r.hideBreadboard&&this.breadboard&&this.breadboard.hide():i=!1}if(!i){delete this.breadboard,delete this.wireFactory,delete this.partOverGroup,delete this.partGroup,delete this.style,delete this.defs,delete this.fromBBCoord,delete this.fromMBCoord;const c=this.boardView.getView().el;this.view=c,this.partGroup=l.svg.child(this.view,"g"),this.partOverGroup=l.svg.child(this.view,"g"),t.maxWidth&&l.svg.hydrate(this.view,{width:t.maxWidth}),t.maxHeight&&l.svg.hydrate(this.view,{height:t.maxHeight})}this.state.updateSubscribers.push(()=>this.updateState())}highlightBoardPin(e){this.boardView.highlightPin(e)}highlightBreadboardPin(e){this.breadboard.highlightLoc(e)}highlightWire(e){e.wires.forEach(e=>{l.U.addClass(e,"highlight"),e.style.visibility="visible"}),l.U.addClass(e.endG,"highlight")}getView(){return this.view}screenshotAsync(r){var e=this.view.cloneNode(!0);e.setAttribute("width",this.view.width.baseVal.value+""),e.setAttribute("height",this.view.height.baseVal.value+"");const t=(new XMLSerializer).serializeToString(e),s="data:image/svg+xml,"+encodeURIComponent(t.replace(/\s+/g," ").replace(/"/g,"'"));return new Promise((n,e)=>{const i=document.createElement("img");i.onload=()=>{var e=document.createElement("canvas"),t=(e.width=i.width,e.height=i.height,0<r?(e.width=r,e.height=i.height*r/i.width|0):e.width<200?(e.width*=2,e.height*=2):480<e.width&&(e.width/=2,e.height/=2),e.getContext("2d"));t.drawImage(i,0,0,e.width,e.height),n(t.getImageData(0,0,e.width,e.height))},i.onerror=e=>{console.log(e),n(void 0)},i.src=s})}updateState(){this.parts.forEach(e=>e.updateState())}getBBCoord(e){e=this.breadboard.getCoord(e);return this.fromBBCoord(e)}getPinCoord(e){var t=this.boardView.getCoord(e);if(t)return this.fromMBCoord(t);console.error("Unable to find coord for pin: "+e)}getLocCoord(e){let t;return(t="breadboard"===e.type?this.getBBCoord(e):(e=e.pin,this.getPinCoord(e)))||console.debug("Unknown location: "+name),t}getPinStyle(e){return"breadboard"!=e.type&&this.opts.boardDef.pinStyles[e.pin]||"female"}addPart(e){let t=null;e.simulationBehavior?(n=e.simulationBehavior,i=this.state.builtinVisuals[n],n=this.state.builtinParts[n],(t=i()).init(this.state.bus,n,this.view,e.params)):(i=e.visual,t=new c.GenericPart(i)),this.parts.push(t),this.partGroup.appendChild(t.element),t.overElement&&this.partOverGroup.appendChild(t.overElement),t.defs&&t.defs.forEach(e=>this.defs.appendChild(e)),this.style.textContent+=t.style||"";var n=e.startColumnIdx,i=e.startRowIdx,i={type:"breadboard",row:c.getRowName(i),col:c.getColumnName(n),xOffset:e.bbFit.xOffset/e.visual.pinDistance,yOffset:e.bbFit.yOffset/e.visual.pinDistance},n=this.getBBCoord(i),i=(t.moveToCoord(n),`sim-${e.name}-cmp`);return l.U.addClass(t.element,i),l.U.addClass(t.element,"sim-cmp"),t.updateTheme(),t.updateState(),t}addWire(e){return this.wireFactory.addWire(e.start,e.end,e.color)}addAll(i){i.partsAndWires.forEach(e=>{var t=e.wires,n=t&&t.every(e=>this.wireFactory.checkWire(e.start,e.end)),e=(n&&t.forEach(e=>i.wires.push(this.addWire(e))),e.part);!e||t&&!n||i.parts.push(this.addPart(e))}),i.requiresBreadboard=!!i.wires.length||!!i.parts.length}}}(pxsim=pxsim||{}),function(k){{var A=k.visuals||(k.visuals={});A.BREADBOARD_MID_ROWS=10,A.BREADBOARD_MID_COLS=30;const U=[4,4],e=A.BREADBOARD_MID_ROWS+U.length,_=[4,9,14,19],t=25+_.length,N=15*(A.BREADBOARD_MID_COLS+3),O=15*(e+4+5.5),D=O*(2/3),R=.16666666666666669*O,n=15*(A.BREADBOARD_MID_COLS-1),M=(N-n)/2,L=R+(D-15*(e-1))/2,B=15*(t-1),F=(N-B)/2,j=(R-15)/2,$=F,H=j+R+D,i="abcdefghij".split("").reverse();function T(e){return""+(e+1)}function E(e){return i[e]}function C(o){let l=o.xOffset||0,t=o.yOffset||0,c=[],u=k.svg.elt("g"),d=o.colStartIdx||0,n=o.rowStartIdx||0,h=e=>e?e.slice(0,e.length):[],p=(e,t)=>{let n,i=0;for(;0<=(n=e.indexOf(t));)e.splice(n,1),i+=1;return i},f=0,m=h(o.rowIdxsWithGap);for(let e=0;e<o.rowCount;e++){let i=0,r=h(o.colIdxsWithGap),s=t+e*o.pinDist+f*o.pinDist,a=e+n;for(let n=0;n<o.colCount;n++){let t=l+n*o.pinDist+i*o.pinDist,e=n+d;const f=e=>(k.svg.hydrate(e.el,"circle"==e.el.tagName?{cx:t,cy:s}:{x:t-.5*e.w,y:s-.5*e.h}),u.appendChild(e.el),e.el);var g=f(o.mkPin()),b=f(o.mkHoverPin()),v=o.getRowName(a),y=o.getColName(e),w=o.getGroupName?o.getGroupName(a,e):null,g={el:g,hoverEl:b,cx:t,cy:s,row:v,col:y,group:w};c.push(g),i+=p(r,e)}f+=p(m,a)}return{g:u,allPins:c}}function S(){var e=k.svg.elt("rect");return k.svg.hydrate(e,{class:"sim-bb-pin",rx:2,ry:2,width:6,height:6}),{el:e,w:6,h:6,x:0,y:0}}function I(){var e=k.svg.elt("rect");return k.svg.hydrate(e,{class:"sim-bb-pin-hover",rx:2,ry:2,width:6*1.3,height:6*1.3}),{el:e,w:6*1.3,h:6*1.3,x:0,y:0}}function P(e,t,n,i,r,s,a){let o=A.mkTxt(e,t,n,i,r),l=(k.U.addClass(o,"sim-bb-label"),a&&a.forEach(e=>k.U.addClass(o,e)),A.mkTxt(e,t,1.3*n,i,r));return k.U.addClass(l,"sim-bb-label-hover"),a&&a.forEach(e=>k.U.addClass(l,e)),{el:o,hoverEl:l,txt:r,group:s}}A.getColumnName=T,A.getRowName=E,A.mkGrid=C,A.Breadboard=class{constructor(e){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),e.wireframe&&k.U.addClass(this.bb,"sim-bb-outline")}hide(){this.bb.style.display="none"}updateLocation(e,t){k.svg.hydrate(this.bb,{x:e+"px",y:t+"px"})}getPin(e,t){e=this.rowColToPin[e];return e&&e[t]||null}getCoord(e){var{row:e,col:t,xOffset:n,yOffset:i}=e,e=this.getPin(e,t);return e?[e.cx+15*(n||0),e.cy+15*(i||0)]:null}getPinDist(){return 15}buildDom(){this.bb=k.svg.elt("svg",{version:"1.0",viewBox:`0 0 ${N} `+O,class:"sim-bb",width:N+"px",height:O+"px"}),this.styleEl=k.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=k.svg.child(this.bb,"defs",{}),k.svg.child(this.bb,"rect",{class:"sim-bb-background",width:N,height:O,rx:4.5,ry:4.5});let i="sim-bb-channel-grad",e=k.svg.elt("linearGradient");k.svg.hydrate(e,{id:i,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(e),k.svg.child(e,"stop",{offset:"0%",style:"stop-color: #AAA;"}),k.svg.child(e,"stop",{offset:"20%",style:"stop-color: #CCC;"}),k.svg.child(e,"stop",{offset:"80%",style:"stop-color: #CCC;"}),k.svg.child(e,"stop",{offset:"100%",style:"stop-color: #AAA;"});var t=(e,t,n)=>{n=k.svg.child(this.bb,"rect",{class:"sim-bb-channel "+(n||""),y:e-t/2,width:N,height:t});return n.setAttribute("fill",`url(#${i})`),n};t(R+D/2,15,"sim-bb-mid-channel"),t(R,.75,"sim-bb-sml-channel"),t(R+D,.75,"sim-bb-sml-channel");const n=(e,t)=>(e<A.BREADBOARD_MID_ROWS/2?"b":"t")+T(t),r=e=>0===e?"-":"+",s=(e,t)=>{t=t<25?"b":"t";return r(e)+t};var t=C({xOffset:M,yOffset:L,rowCount:A.BREADBOARD_MID_ROWS,colCount:A.BREADBOARD_MID_COLS,pinDist:15,mkPin:S,mkHoverPin:I,getRowName:E,getColName:T,getGroupName:n,rowIdxsWithGap:U}),t=(t.g,this.allPins=this.allPins.concat(t.allPins),C({xOffset:$,yOffset:H,rowCount:2,colCount:25,pinDist:15,mkPin:S,mkHoverPin:I,getRowName:r,getColName:T,getGroupName:s,colIdxsWithGap:_})),t=(t.g,this.allPins=this.allPins.concat(t.allPins),C({xOffset:F,yOffset:j,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:S,mkHoverPin:I,getRowName:r,getColName:T,getGroupName:s,colIdxsWithGap:_.map(e=>e+25)})),a=(t.g,this.allPins=this.allPins.concat(t.allPins),this.allPins.forEach(e=>{var{el:e,row:t,col:n,hoverEl:i}=e,t=`(${t},${n})`;k.svg.hydrate(e,{title:t}),k.svg.hydrate(i,{title:t})}),this.allPins.forEach(e=>{let t=this.rowColToPin[e.row];(t=t||(this.rowColToPin[e.row]={}))[e.col]=e}),(e,t,n,i,r,s)=>{var[e,t]=this.getCoord({type:"breadboard",row:e,col:t});return P(e+n,t+i,10.5,-90,r,s)});for(let e=0;e<A.BREADBOARD_MID_COLS;e++){var o=T(e),l=a(E(0),o,0,-15,o,n(0,e)),l=(this.allLabels.push(l),A.BREADBOARD_MID_ROWS-1),o=a(E(l),o,0,15,o,n(l,e));this.allLabels.push(o)}for(let e=0;e<A.BREADBOARD_MID_ROWS;e++){var c=E(e),u=a(c,"1",-15,0,c),u=(this.allLabels.push(u),a(c,T(A.BREADBOARD_MID_COLS-1),15,0,c));this.allLabels.push(u)}let d=[P(13.05,R+D+12,30,-90,"-",s(0,0),["sim-bb-blue"]),P(12,R+D+R-12,25.5,-90,"+",s(1,0),["sim-bb-red"]),P(N-12+1.05,R+D+12,30,-90,"-",s(0,24),["sim-bb-blue"]),P(N-12,R+D+R-12,25.5,-90,"+",s(1,24),["sim-bb-red"])],h=(this.allLabels=this.allLabels.concat(d),[P(13.05,12,30,-90,"-",s(0,25),["sim-bb-blue"]),P(12,R-12,25.5,-90,"+",s(1,25),["sim-bb-red"]),P(N-12+1.05,12,30,-90,"-",s(0,49),["sim-bb-blue"]),P(N-12,R-12,25.5,-90,"+",s(1,49),["sim-bb-red"])]),p=(this.allLabels=this.allLabels.concat(h),{});this.allLabels.forEach(e=>{var t=e["txt"];(p[t]=p[t]||[]).push(e)}),this.allPins.forEach(t=>{let{row:e,col:n}=t,i=this.rowColToLbls[e]||(this.rowColToLbls[e]={}),r=i[n]||(i[n]=[]);"-"===t.row||"+"===t.row?Number(n)<=25?d.filter(e=>e.group==t.group).forEach(e=>r.push(e)):h.filter(e=>e.group==t.group).forEach(e=>r.push(e)):(p[e].forEach(e=>r.push(e)),p[n].forEach(e=>r.push(e)))});const f=22.5+B,m=(f-B)/2,g=(e,t,n,i)=>{var r=k.svg.elt("rect");return k.svg.hydrate(r,{class:"sim-bb-bar "+i,x:e,y:t-1.5,width:f,height:3}),{el:r,group:n}};t=[g($-m,H-9,s(0,49),"sim-bb-blue"),g($-m,15+H+9,s(1,49),"sim-bb-red"),g(F-m,j-9,s(0,0),"sim-bb-blue"),g(F-m,15+j+9,s(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(t),this.allPowerBars.forEach(e=>this.bb.appendChild(e.el));let b=this.allPins.map(e=>e.group).filter((e,t,n)=>n.indexOf(e)==t),v=b.map(e=>k.svg.elt("g")),y=(v.forEach(e=>k.U.addClass(e,"sim-bb-pin-group")),v.forEach((e,t)=>k.U.addClass(e,"group-"+b[t])),{}),w=(b.forEach((e,t)=>y[e]=v[t]),{}),x=(this.allPins.forEach((e,t)=>{var n=e.group;(w[n]||(w[n]=[])).push(e)}),b.forEach(e=>{var t=w[e],[t,n]=[t.map(e=>e.cx),t.map(e=>e.cy)],i=e=>e.reduce((e,t)=>e<t?e:t),r=e=>e.reduce((e,t)=>t<e?e:t),[t,i,r,n]=[i(t),r(t),i(n),r(n)],s=k.svg.elt("rect"),i=Math.max(i-t,1e-4),n=Math.max(n-r,1e-4);k.svg.hydrate(s,{x:t,y:r,width:i,height:n}),k.U.addClass(s,"sim-bb-group-wire"),y[e].appendChild(s)}),this.allPins.forEach(e=>{var t=y[e.group];t.appendChild(e.el),t.appendChild(e.hoverEl)}),k.svg.elt("g"));k.svg.hydrate(x,{class:"sim-bb-group-misc"}),v.push(x),this.allLabels.forEach(e=>{var t;(e.group?((t=y[e.group]).appendChild(e.el),t):(x.appendChild(e.el),x)).appendChild(e.hoverEl)}),v.forEach(e=>this.bb.appendChild(e))}getSVGAndSize(){return{el:this.bb,y:0,x:0,w:N,h:O}}highlightLoc(e){var{row:e,col:t}=e,{}=this.rowColToPin[e][t];this.rowColToLbls[e][t].forEach(e=>{k.U.addClass(e.el,"highlight"),k.U.addClass(e.hoverEl,"highlight")})}}}}(pxsim=pxsim||{}),function(f){{var m=f.visuals||(f.visuals={});m.BOARD_SYTLE=`
        .noselect {
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none;   /* Chrome/Safari/Opera */
            -khtml-user-select: none;    /* Konqueror */
            -moz-user-select: none;      /* Firefox */
            -ms-user-select: none;       /* Internet Explorer/Microsoft Edge */
            user-select: none;           /* Non-prefixed version, currently
                                            not supported by any browser */
        }

        .sim-board-pin {
            fill:#999;
            stroke:#000;
            stroke-width:${m.PIN_DIST/3}px;
        }
        .sim-board-pin-lbl {
            fill: #333;
        }
        .gray-cover {
            fill:#FFF;
            opacity: 0.3;
            stroke-width:0;
            visibility: hidden;
        }
        .sim-board-pin-hover {
            visibility: hidden;
            pointer-events: all;
            stroke-width:${m.PIN_DIST/6}px;
        }
        .sim-board-pin-hover:hover {
            visibility: visible;
        }
        .sim-board-pin-lbl {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-lbl {
            visibility: visible;
        }
        .sim-board-pin-lbl {
            fill: #555;
        }
        .sim-board-pin-lbl-hover {
            fill: red;
        }
        .sim-board-outline .sim-board-pin-lbl-hover {
            fill: black;
        }
        .sim-board-pin-lbl,
        .sim-board-pin-lbl-hover {
            font-family:"Lucida Console", Monaco, monospace;
            pointer-events: all;
            stroke-width: 0;
        }
        .sim-board-pin-lbl-hover {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,
        .sim-board-pin-lbl.highlight {
            visibility: hidden;
        }
        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,
        .sim-board-pin-lbl-hover.highlight {
            visibility: visible;
        }
        /* Graying out */
        .grayed .sim-board-pin-lbl:not(.highlight) {
            fill: #AAA;
        }
        .grayed .sim-board-pin:not(.highlight) {
            fill:#BBB;
            stroke:#777;
        }
        .grayed .gray-cover {
            visibility: inherit;
        }
        .grayed .sim-cmp:not(.notgrayed) {
            opacity: 0.3;
        }
        /* Highlighting */
        .sim-board-pin-lbl.highlight {
            fill: #000;
            font-weight: bold;
        }
        .sim-board-pin.highlight {
            fill:#999;
            stroke:#000;
        }
        `;const g=.7*m.PIN_DIST,b=1.5*g,v=.66666*m.PIN_DIST,y=.66666*m.PIN_DIST+m.PIN_DIST/3;let p=0;m.GenericBoardSvg=class{constructor(e){this.props=e,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=p++;let s=e.visualDef,t=e.wireframe&&s.outlineImage?s.outlineImage:s.image,n=m.mkImageSVG({image:t,width:s.width,height:s.height,imageUnitDist:s.pinDist,targetUnitDist:m.PIN_DIST}),a=m.mkScaleFn(s.pinDist,m.PIN_DIST);this.width=n.w,this.height=n.h;var i=n.el;this.element=f.svg.elt("svg"),f.svg.hydrate(this.element,{version:"1.0",viewBox:`0 0 ${this.width} `+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),e.wireframe&&f.U.addClass(this.element,"sim-board-outline"),this.style=f.svg.child(this.element,"style",{}),this.style.textContent+=m.BOARD_SYTLE,this.defs=f.svg.child(this.element,"defs",{}),this.g=f.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(i),this.background=i,f.svg.hydrate(i,{class:"sim-board"});const o=()=>{var e=f.svg.elt("circle"),t=v;return f.svg.hydrate(e,{class:"sim-board-pin",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},l=()=>{var e=f.svg.elt("circle"),t=y;return f.svg.hydrate(e,{class:"sim-board-pin-hover",r:t/2}),{el:e,w:t,h:t,x:0,y:0}},c=()=>{var e=f.svg.elt("rect"),t=v;return f.svg.hydrate(e,{class:"sim-board-pin",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}},u=()=>{var e=f.svg.elt("rect"),t=y;return f.svg.hydrate(e,{class:"sim-board-pin-hover",width:t,height:t}),{el:e,w:t,h:t,x:0,y:0}};let r=s.pinBlocks.map((t,e)=>{var n=a(t.x)+m.PIN_DIST/2,i=a(t.y)+m.PIN_DIST/2,r=t.labels.length,n=m.mkGrid({xOffset:n,yOffset:i,rowCount:1,colCount:r,pinDist:m.PIN_DIST,mkPin:s.useCrocClips?o:c,mkHoverPin:s.useCrocClips?l:u,getRowName:()=>""+(e+1),getColName:e=>t.labels[e],getGroupName:()=>t.labels.join(" ")});return n.allPins,n.g,f.U.addClass(n.g,"sim-board-pin-group"),n}),d=[];r.forEach((e,n)=>e.allPins.forEach((e,t)=>{this.allPins.push(e),d.push(s.pinBlocks[n])})),this.allPins.forEach(e=>{var t=e.col;f.svg.hydrate(e.el,{title:t}),f.svg.hydrate(e.hoverEl,{title:t})}),this.allPins.forEach(e=>{this.pinNmToPin[e.col]=e});const h=(e,t,n,i,r)=>{let s,a;return s="below"===r?(a=e,t+12+.25*n*i.length):(a=e,t-11-.32*n*i.length),m.mkTxt(a,s,n,-90,i)};this.allLabels=this.allPins.map((e,t)=>{var n,i,r,t=d[t];return n=e.cx,i=e.cy,e=e.col,t=t.labelPosition||"above",r=h(n,i,g,e,t),f.U.addClass(r,"sim-board-pin-lbl"),n=h(n,i,b,e,t),f.U.addClass(n,"sim-board-pin-lbl-hover"),{el:r,hoverEl:n,txt:e}}),this.allPins.forEach((e,t)=>{t=this.allLabels[t];this.pinNmToLbl[e.col]=t}),this.allPins.forEach((e,t)=>{t=this.allLabels[t];this.g.appendChild(e.el),this.g.appendChild(e.hoverEl),this.g.appendChild(t.el),this.g.appendChild(t.hoverEl)})}findPin(e){let t=this.pinNmToPin[e];return t=!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])?this.pinNmToPin[e]:t}findPinLabel(e){let t=this.pinNmToLbl[e];return t=!t&&this.props.boardDef.gpioPinMap&&(e=this.props.boardDef.gpioPinMap[e])?this.pinNmToLbl[e]:t}getCoord(e){e=this.findPin(e);return e?[e.cx,e.cy]:null}mkGrayCover(e,t,n,i){var r=f.svg.elt("rect");return f.svg.hydrate(r,{x:e,y:t,width:n,height:i,class:"gray-cover"}),r}getView(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}}getPinDist(){return m.PIN_DIST}highlightPin(e){var t=this.findPinLabel(e),e=this.findPin(e);t&&e&&(f.U.addClass(t.el,"highlight"),f.U.addClass(t.hoverEl,"highlight"),f.U.addClass(e.el,"highlight"),f.U.addClass(e.hoverEl,"highlight"))}}}}(pxsim=pxsim||{}),function(t){function n(e){return i.mkImageSVG({image:e.image,width:e.width,height:e.height,imageUnitDist:e.pinDistance,targetUnitDist:i.PIN_DIST})}var i;(i=t.visuals||(t.visuals={})).mkGenericPartSVG=n,i.GenericPart=class{constructor(e){this.style="",this.defs=[];e=n(e).el;this.element=t.svg.elt("g"),this.element.appendChild(e)}moveToCoord(e){i.translateEl(this.element,e)}init(e,t,n){}updateState(){}updateTheme(){}}}(pxsim=pxsim||{}),function(v){{var y=v.visuals||(v.visuals={}),e;const o=y.PIN_DIST/2.5;function i(e){return e.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function w(e,t,n,i){var r=e=>e[0]+", "+e[1],[s,a]=e,[o,l]=t,c=l-a,e=v.svg.mkPath("sim-bb-wire",`M${r(e)} C${r([s,a+c*n])} ${r([o,l-c*n])} `+r(t));return v.U.addClass(e,"wire-stroke-"+i),e}function x(e,t,n){var i=e=>e[0]+", "+e[1],e=v.svg.mkPath("sim-bb-wire",`M${i(e)} L`+i(t));return v.U.addClass(e,"wire-stroke-"+n),e}function r(e,t){var n=y.PIN_DIST/4,i=v.svg.elt("circle"),r=e[0],e=e[1],s=o/2+n/2;return v.svg.hydrate(i,{cx:r,cy:e,r:s,class:"sim-bb-wire-end"}),v.U.addClass(i,"wire-fill-"+t),i.style["stroke-width"]=n+"px",i}function a(e,t){var n=.24*y.PIN_DIST,i=10*n,r=2*n,s=6*n,a=y.PIN_DIST/4,[e,o]=e,t=t?-1:1,l=v.svg.elt("g"),c=v.svg.elt("rect"),u=e-r/2,d=o-i/2,h=(v.svg.hydrate(c,{x:u,y:d,width:r,height:i,rx:.5,ry:.5,class:"sim-bb-wire-end"}),c.style["stroke-width"]=a+"px",v.svg.elt("rect")),o=o+t*(i/2+s/2)-s/2;return v.svg.hydrate(h,{x:e-n/2,y:o,width:n,height:s,class:"sim-bb-wire-bare-end"}),h.style.fill="#bbb",l.appendChild(h),l.appendChild(c),{el:l,x:u-a,y:Math.min(d,o),w:r+2*a,h:i+s}}function b(e,t){var n=.24*y.PIN_DIST,i=4*n,r=10*n,s=3.5*n,n=3.5*n,a=y.PIN_DIST/4,[e,o]=e,l=t?-1:1,c=v.svg.elt("g"),u=v.svg.elt("polygon"),d=e-i/2,h=o-r/2,p=t?.15:.3,f=t?.7:1-.7,t=t?.3:.15,p=(v.svg.hydrate(u,{points:[[d+i*p,h],[d+i*(1-p),h],[d+i,h+r*f],[d+i*(1-t),h+r],[d+i*t,h+r],[d,h+r*f]].map(e=>e[0]+","+e[1]).join(" ")}),v.svg.hydrate(u,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),u.style["stroke-width"]=a+"px",v.svg.elt("rect")),t=s,f=o+l*(r/2+t/2)-t/2;return v.svg.hydrate(p,{x:e-n/2,y:f,width:n,height:t,class:"sim-bb-wire-bare-end"}),c.appendChild(p),c.appendChild(u),{el:c,x:d-a,y:Math.min(h,f),w:i+2*a,h:r+t}}y.WIRES_CSS=`
        .sim-bb-wire {
            fill:none;
            stroke-linecap: round;
            stroke-width:${o}px;
            pointer-events: none;
        }
        .sim-bb-wire-end {
            stroke:#333;
            fill:#333;
        }
        .sim-bb-wire-bare-end {
            fill: #ccc;
        }
        .sim-bb-wire-hover {
            stroke-width: ${o}px;
            visibility: hidden;
            stroke-dasharray: ${y.PIN_DIST/10},${y.PIN_DIST/1.5};
            /*stroke-opacity: 0.4;*/
        }
        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {
            stroke: #777;
            fill: #777;
        }
        .grayed .sim-bb-wire:not(.highlight) {
            stroke: #CCC;
        }
        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {
            stroke: red;
            fill: red;
        }
        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {
            stroke: #FFF;
            fill: #FFF;
        }
        `,(e=y.WireEndStyle||(y.WireEndStyle={}))[e.BBJumper=0]="BBJumper",e[e.OpenJumper=1]="OpenJumper",e[e.Croc=2]="Croc",y.mkWirePart=function(e,t,n=!1){var i=v.svg.elt("g"),[e,r]=e,o=[e-15,r-50],l=[e+15,r+50],r=(t=y.mapWireColor(t),e=(n?b:a)(o,!0),function(e){var t=e=>e[0]+", "+e[1],[n,i]=o,[r,s]=l,a=s-i,a=v.svg.mkPath("sim-bb-wire",`M${t(o)} C${t([n,i+.8*a])} ${t([r,s-.8*a])} `+t(l));return a.style.stroke=e,{el:a,x:Math.min(n,r),y:Math.min(i,s),w:Math.abs(n-r),h:Math.abs(i-s)}}(t)),n=a(l,!1),t=(i.appendChild(r.el),i.appendChild(e.el),i.appendChild(n.el),Math.min(e.x,n.x)),r=Math.max(e.x+e.w,n.x+n.w),s=Math.min(e.y,n.y);return{el:i,x:t,y:s,w:r-t,h:Math.max(e.y+e.h,n.y+n.h)-s}},y.WireFactory=class{constructor(e,t,n,i,r,s){this.nextWireId=0,this.styleEl=i,this.styleEl.textContent+=y.WIRES_CSS,this.underboard=e,this.overboard=t,this.boardEdges=n,this.getLocCoord=r,this.getPinStyle=s}indexOfMin(t){let n=0,i=t[0];for(let e=1;e<t.length;e++)t[e]<i&&(i=t[e],n=e);return n}closestEdgeIdx(t){var e=this.boardEdges.map(e=>Math.abs(t[1]-e));return this.indexOfMin(e)}closestEdge(e){return this.boardEdges[this.closestEdgeIdx(e)]}drawWire(o,l,e){var c=[],u=v.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),d=e=>{var t=y.PIN_DIST/2,n=this.closestEdge(e),n=n-e[1]<0?n-t:n+t;return[e[0],n]},h=this.nextWireId++,p=i(e),t=r(o,p),n=r(l,p),f=v.svg.child(u,"g",{class:"sim-bb-wire-ends-g"}),m=(f.appendChild(t),f.appendChild(n),this.closestEdgeIdx(o)),g=this.closestEdgeIdx(l);if(m==g){var b=x(o,l,p);u.appendChild(b),c.push(b)}else{let e,t,n=d(o),i=d(l),r=x(o,n,p),s=x(l,i,p),a=(t=1!=m&&2!=m||1!=g&&2!=g?(e=x(n,i,p),x(n,i,p)):(e=w(n,i,.7,p),w(n,i,.7,p)),v.U.addClass(t,"sim-bb-wire-hover"),u.appendChild(r),c.push(r),u.appendChild(s),c.push(s),this.underboard.appendChild(e),c.push(e),u.appendChild(t),c.push(t),"sim-bb-wire-id-"+h);b=e=>v.U.addClass(e,a);b(f),b(t),this.styleEl.textContent+=`
                    .${a}:hover ~ .${a}.sim-bb-wire-hover {
                        visibility: visible;
                    }`}d=`
                .wire-stroke-${p} {
                    stroke: ${y.mapWireColor(e)};
                }
                .wire-fill-${p} {
                    fill: ${y.mapWireColor(e)};
                }
                `;return this.styleEl.textContent+=d,{endG:f,end1:t,end2:n,wires:c}}drawWireWithCrocs(s,a,e,o=!1){var l=[],c=v.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),u=e=>{var t=y.PIN_DIST/2,n=this.closestEdge(e),n=n-e[1]<0?n-t:n+t;return[e[0],n]},d=this.nextWireId++,h=i(e),t=r(s,h),p=a,[n,f]=a;[n,f]=a=[n,f+40];var m=[n,f+-17],n=(o?function(){var e=.24*y.PIN_DIST,t=4*e,n=1.2*e,i=10*e,r=y.PIN_DIST/4,[s,a]=m,o=v.svg.elt("g"),l=v.svg.elt("rect"),c=s-n/2,u=a+10-t/2,d=(v.svg.hydrate(l,{x:c,y:u,width:n,height:t,rx:.5,ry:.5,class:"sim-bb-wire-end"}),l.style["stroke-width"]=r+"px",v.svg.elt("rect")),a=a+10+-1*(t/2+i/2)-i/2;return v.svg.hydrate(d,{x:s-e/2,y:a,width:e,height:i,class:"sim-bb-wire-bare-end"}),d.style.fill="#bbb",o.appendChild(d),o.appendChild(l),{el:o,x:c-r,y:Math.min(u,a),w:n+2*r,h:t+i}}():b(m,!0)).el,f=v.svg.child(c,"g",{class:"sim-bb-wire-ends-g"}),g=(f.appendChild(t),this.closestEdgeIdx(s)),p=this.closestEdgeIdx(p);if(g==p){o=x(s,a,h);c.appendChild(o),l.push(o)}else{let e,t,n=u(s),i=x(s,n,h),r=(t=1!=g&&2!=g||1!=p&&2!=p?(e=x(n,a,h),x(n,a,h)):(e=w(n,a,.7,h),w(n,a,.7,h)),v.U.addClass(t,"sim-bb-wire-hover"),c.appendChild(i),l.push(i),this.underboard.appendChild(e),l.push(e),"sim-bb-wire-id-"+d);const o=e=>v.U.addClass(e,r);o(f),o(t),this.styleEl.textContent+=`
                    .${r}:hover ~ .${r}.sim-bb-wire-hover {
                        visibility: visible;
                    }`}f.appendChild(n);o=`
                .wire-stroke-${h} {
                    stroke: ${y.mapWireColor(e)};
                }
                .wire-fill-${h} {
                    fill: ${y.mapWireColor(e)};
                }
                `;return this.styleEl.textContent+=o,{endG:f,end1:t,end2:n,wires:l}}checkWire(e,t){e=this.getLocCoord(e),t=this.getLocCoord(t);return!!e&&!!t}addWire(e,t,n){var i,r=this.getLocCoord(e),s=this.getLocCoord(t);if(r&&s)return i=this.getPinStyle(t),"dalboard"==t.type&&"croc"==i?this.drawWireWithCrocs(r,s,n):this.drawWire(r,s,n);console.debug(`unable to allocate wire for ${e} or `+t)}}}}(pxsim=pxsim||{});